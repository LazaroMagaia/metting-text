var aMe=Object.defineProperty;var cMe=(e,r,i)=>r in e?aMe(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i;var _ve=(e,r,i)=>cMe(e,typeof r!="symbol"?r+"":r,i);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function i(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerPolicy&&(p.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?p.credentials="include":h.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(h){if(h.ep)return;h.ep=!0;const p=i(h);fetch(h.href,p)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production_min;function requireReact_production_min(){if(hasRequiredReact_production_min)return react_production_min;hasRequiredReact_production_min=1;var e=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),g=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),_e=Symbol.for("react.lazy"),cN=Symbol.iterator;function dN(SN){return SN===null||typeof SN!="object"?null:(SN=cN&&SN[cN]||SN["@@iterator"],typeof SN=="function"?SN:null)}var fN={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mN=Object.assign,EN={};function RN(SN,oH,fH){this.props=SN,this.context=oH,this.refs=EN,this.updater=fH||fN}RN.prototype.isReactComponent={},RN.prototype.setState=function(SN,oH){if(typeof SN!="object"&&typeof SN!="function"&&SN!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,SN,oH,"setState")},RN.prototype.forceUpdate=function(SN){this.updater.enqueueForceUpdate(this,SN,"forceUpdate")};function IN(){}IN.prototype=RN.prototype;function t0(SN,oH,fH){this.props=SN,this.context=oH,this.refs=EN,this.updater=fH||fN}var aH=t0.prototype=new IN;aH.constructor=t0,mN(aH,RN.prototype),aH.isPureReactComponent=!0;var pH=Array.isArray,SH=Object.prototype.hasOwnProperty,vH={current:null},AH={key:!0,ref:!0,__self:!0,__source:!0};function UH(SN,oH,fH){var xH,l5={},w5=null,H5=null;if(oH!=null)for(xH in oH.ref!==void 0&&(H5=oH.ref),oH.key!==void 0&&(w5=""+oH.key),oH)SH.call(oH,xH)&&!AH.hasOwnProperty(xH)&&(l5[xH]=oH[xH]);var d6=arguments.length-2;if(d6===1)l5.children=fH;else if(1<d6){for(var C6=Array(d6),fK=0;fK<d6;fK++)C6[fK]=arguments[fK+2];l5.children=C6}if(SN&&SN.defaultProps)for(xH in d6=SN.defaultProps,d6)l5[xH]===void 0&&(l5[xH]=d6[xH]);return{$$typeof:e,type:SN,key:w5,ref:H5,props:l5,_owner:vH.current}}function zH(SN,oH){return{$$typeof:e,type:SN.type,key:oH,ref:SN.ref,props:SN.props,_owner:SN._owner}}function CH(SN){return typeof SN=="object"&&SN!==null&&SN.$$typeof===e}function HH(SN){var oH={"=":"=0",":":"=2"};return"$"+SN.replace(/[=:]/g,function(fH){return oH[fH]})}var VH=/\/+/g;function KH(SN,oH){return typeof SN=="object"&&SN!==null&&SN.key!=null?HH(""+SN.key):oH.toString(36)}function IH(SN,oH,fH,xH,l5){var w5=typeof SN;(w5==="undefined"||w5==="boolean")&&(SN=null);var H5=!1;if(SN===null)H5=!0;else switch(w5){case"string":case"number":H5=!0;break;case"object":switch(SN.$$typeof){case e:case r:H5=!0}}if(H5)return H5=SN,l5=l5(H5),SN=xH===""?"."+KH(H5,0):xH,pH(l5)?(fH="",SN!=null&&(fH=SN.replace(VH,"$&/")+"/"),IH(l5,oH,fH,"",function(fK){return fK})):l5!=null&&(CH(l5)&&(l5=zH(l5,fH+(!l5.key||H5&&H5.key===l5.key?"":(""+l5.key).replace(VH,"$&/")+"/")+SN)),oH.push(l5)),1;if(H5=0,xH=xH===""?".":xH+":",pH(SN))for(var d6=0;d6<SN.length;d6++){w5=SN[d6];var C6=xH+KH(w5,d6);H5+=IH(w5,oH,fH,C6,l5)}else if(C6=dN(SN),typeof C6=="function")for(SN=C6.call(SN),d6=0;!(w5=SN.next()).done;)w5=w5.value,C6=xH+KH(w5,d6++),H5+=IH(w5,oH,fH,C6,l5);else if(w5==="object")throw oH=String(SN),Error("Objects are not valid as a React child (found: "+(oH==="[object Object]"?"object with keys {"+Object.keys(SN).join(", ")+"}":oH)+"). If you meant to render a collection of children, use an array instead.");return H5}function MH(SN,oH,fH){if(SN==null)return SN;var xH=[],l5=0;return IH(SN,xH,"","",function(w5){return oH.call(fH,w5,l5++)}),xH}function GH(SN){if(SN._status===-1){var oH=SN._result;oH=oH(),oH.then(function(fH){(SN._status===0||SN._status===-1)&&(SN._status=1,SN._result=fH)},function(fH){(SN._status===0||SN._status===-1)&&(SN._status=2,SN._result=fH)}),SN._status===-1&&(SN._status=0,SN._result=oH)}if(SN._status===1)return SN._result.default;throw SN._result}var yH={current:null},TH={transition:null},NH={ReactCurrentDispatcher:yH,ReactCurrentBatchConfig:TH,ReactCurrentOwner:vH};function gH(){throw Error("act(...) is not supported in production builds of React.")}return react_production_min.Children={map:MH,forEach:function(SN,oH,fH){MH(SN,function(){oH.apply(this,arguments)},fH)},count:function(SN){var oH=0;return MH(SN,function(){oH++}),oH},toArray:function(SN){return MH(SN,function(oH){return oH})||[]},only:function(SN){if(!CH(SN))throw Error("React.Children.only expected to receive a single React element child.");return SN}},react_production_min.Component=RN,react_production_min.Fragment=i,react_production_min.Profiler=h,react_production_min.PureComponent=t0,react_production_min.StrictMode=o,react_production_min.Suspense=A,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NH,react_production_min.act=gH,react_production_min.cloneElement=function(SN,oH,fH){if(SN==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+SN+".");var xH=mN({},SN.props),l5=SN.key,w5=SN.ref,H5=SN._owner;if(oH!=null){if(oH.ref!==void 0&&(w5=oH.ref,H5=vH.current),oH.key!==void 0&&(l5=""+oH.key),SN.type&&SN.type.defaultProps)var d6=SN.type.defaultProps;for(C6 in oH)SH.call(oH,C6)&&!AH.hasOwnProperty(C6)&&(xH[C6]=oH[C6]===void 0&&d6!==void 0?d6[C6]:oH[C6])}var C6=arguments.length-2;if(C6===1)xH.children=fH;else if(1<C6){d6=Array(C6);for(var fK=0;fK<C6;fK++)d6[fK]=arguments[fK+2];xH.children=d6}return{$$typeof:e,type:SN.type,key:l5,ref:w5,props:xH,_owner:H5}},react_production_min.createContext=function(SN){return SN={$$typeof:g,_currentValue:SN,_currentValue2:SN,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},SN.Provider={$$typeof:p,_context:SN},SN.Consumer=SN},react_production_min.createElement=UH,react_production_min.createFactory=function(SN){var oH=UH.bind(null,SN);return oH.type=SN,oH},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(SN){return{$$typeof:C,render:SN}},react_production_min.isValidElement=CH,react_production_min.lazy=function(SN){return{$$typeof:_e,_payload:{_status:-1,_result:SN},_init:GH}},react_production_min.memo=function(SN,oH){return{$$typeof:x,type:SN,compare:oH===void 0?null:oH}},react_production_min.startTransition=function(SN){var oH=TH.transition;TH.transition={};try{SN()}finally{TH.transition=oH}},react_production_min.unstable_act=gH,react_production_min.useCallback=function(SN,oH){return yH.current.useCallback(SN,oH)},react_production_min.useContext=function(SN){return yH.current.useContext(SN)},react_production_min.useDebugValue=function(){},react_production_min.useDeferredValue=function(SN){return yH.current.useDeferredValue(SN)},react_production_min.useEffect=function(SN,oH){return yH.current.useEffect(SN,oH)},react_production_min.useId=function(){return yH.current.useId()},react_production_min.useImperativeHandle=function(SN,oH,fH){return yH.current.useImperativeHandle(SN,oH,fH)},react_production_min.useInsertionEffect=function(SN,oH){return yH.current.useInsertionEffect(SN,oH)},react_production_min.useLayoutEffect=function(SN,oH){return yH.current.useLayoutEffect(SN,oH)},react_production_min.useMemo=function(SN,oH){return yH.current.useMemo(SN,oH)},react_production_min.useReducer=function(SN,oH,fH){return yH.current.useReducer(SN,oH,fH)},react_production_min.useRef=function(SN){return yH.current.useRef(SN)},react_production_min.useState=function(SN){return yH.current.useState(SN)},react_production_min.useSyncExternalStore=function(SN,oH,fH){return yH.current.useSyncExternalStore(SN,oH,fH)},react_production_min.useTransition=function(){return yH.current.useTransition()},react_production_min.version="18.3.1",react_production_min}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production_min()),react.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production_min;function requireReactJsxRuntime_production_min(){if(hasRequiredReactJsxRuntime_production_min)return reactJsxRuntime_production_min;hasRequiredReactJsxRuntime_production_min=1;var e=requireReact(),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,h=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function g(C,A,x){var _e,cN={},dN=null,fN=null;x!==void 0&&(dN=""+x),A.key!==void 0&&(dN=""+A.key),A.ref!==void 0&&(fN=A.ref);for(_e in A)o.call(A,_e)&&!p.hasOwnProperty(_e)&&(cN[_e]=A[_e]);if(C&&C.defaultProps)for(_e in A=C.defaultProps,A)cN[_e]===void 0&&(cN[_e]=A[_e]);return{$$typeof:r,type:C,key:dN,ref:fN,props:cN,_owner:h.current}}return reactJsxRuntime_production_min.Fragment=i,reactJsxRuntime_production_min.jsx=g,reactJsxRuntime_production_min.jsxs=g,reactJsxRuntime_production_min}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production_min()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports);var client$1={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min;function requireScheduler_production_min(){return hasRequiredScheduler_production_min||(hasRequiredScheduler_production_min=1,function(e){function r(TH,NH){var gH=TH.length;TH.push(NH);e:for(;0<gH;){var SN=gH-1>>>1,oH=TH[SN];if(0<h(oH,NH))TH[SN]=NH,TH[gH]=oH,gH=SN;else break e}}function i(TH){return TH.length===0?null:TH[0]}function o(TH){if(TH.length===0)return null;var NH=TH[0],gH=TH.pop();if(gH!==NH){TH[0]=gH;e:for(var SN=0,oH=TH.length,fH=oH>>>1;SN<fH;){var xH=2*(SN+1)-1,l5=TH[xH],w5=xH+1,H5=TH[w5];if(0>h(l5,gH))w5<oH&&0>h(H5,l5)?(TH[SN]=H5,TH[w5]=gH,SN=w5):(TH[SN]=l5,TH[xH]=gH,SN=xH);else if(w5<oH&&0>h(H5,gH))TH[SN]=H5,TH[w5]=gH,SN=w5;else break e}}return NH}function h(TH,NH){var gH=TH.sortIndex-NH.sortIndex;return gH!==0?gH:TH.id-NH.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;e.unstable_now=function(){return p.now()}}else{var g=Date,C=g.now();e.unstable_now=function(){return g.now()-C}}var A=[],x=[],_e=1,cN=null,dN=3,fN=!1,mN=!1,EN=!1,RN=typeof setTimeout=="function"?setTimeout:null,IN=typeof clearTimeout=="function"?clearTimeout:null,t0=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function aH(TH){for(var NH=i(x);NH!==null;){if(NH.callback===null)o(x);else if(NH.startTime<=TH)o(x),NH.sortIndex=NH.expirationTime,r(A,NH);else break;NH=i(x)}}function pH(TH){if(EN=!1,aH(TH),!mN)if(i(A)!==null)mN=!0,GH(SH);else{var NH=i(x);NH!==null&&yH(pH,NH.startTime-TH)}}function SH(TH,NH){mN=!1,EN&&(EN=!1,IN(UH),UH=-1),fN=!0;var gH=dN;try{for(aH(NH),cN=i(A);cN!==null&&(!(cN.expirationTime>NH)||TH&&!HH());){var SN=cN.callback;if(typeof SN=="function"){cN.callback=null,dN=cN.priorityLevel;var oH=SN(cN.expirationTime<=NH);NH=e.unstable_now(),typeof oH=="function"?cN.callback=oH:cN===i(A)&&o(A),aH(NH)}else o(A);cN=i(A)}if(cN!==null)var fH=!0;else{var xH=i(x);xH!==null&&yH(pH,xH.startTime-NH),fH=!1}return fH}finally{cN=null,dN=gH,fN=!1}}var vH=!1,AH=null,UH=-1,zH=5,CH=-1;function HH(){return!(e.unstable_now()-CH<zH)}function VH(){if(AH!==null){var TH=e.unstable_now();CH=TH;var NH=!0;try{NH=AH(!0,TH)}finally{NH?KH():(vH=!1,AH=null)}}else vH=!1}var KH;if(typeof t0=="function")KH=function(){t0(VH)};else if(typeof MessageChannel<"u"){var IH=new MessageChannel,MH=IH.port2;IH.port1.onmessage=VH,KH=function(){MH.postMessage(null)}}else KH=function(){RN(VH,0)};function GH(TH){AH=TH,vH||(vH=!0,KH())}function yH(TH,NH){UH=RN(function(){TH(e.unstable_now())},NH)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(TH){TH.callback=null},e.unstable_continueExecution=function(){mN||fN||(mN=!0,GH(SH))},e.unstable_forceFrameRate=function(TH){0>TH||125<TH?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):zH=0<TH?Math.floor(1e3/TH):5},e.unstable_getCurrentPriorityLevel=function(){return dN},e.unstable_getFirstCallbackNode=function(){return i(A)},e.unstable_next=function(TH){switch(dN){case 1:case 2:case 3:var NH=3;break;default:NH=dN}var gH=dN;dN=NH;try{return TH()}finally{dN=gH}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(TH,NH){switch(TH){case 1:case 2:case 3:case 4:case 5:break;default:TH=3}var gH=dN;dN=TH;try{return NH()}finally{dN=gH}},e.unstable_scheduleCallback=function(TH,NH,gH){var SN=e.unstable_now();switch(typeof gH=="object"&&gH!==null?(gH=gH.delay,gH=typeof gH=="number"&&0<gH?SN+gH:SN):gH=SN,TH){case 1:var oH=-1;break;case 2:oH=250;break;case 5:oH=1073741823;break;case 4:oH=1e4;break;default:oH=5e3}return oH=gH+oH,TH={id:_e++,callback:NH,priorityLevel:TH,startTime:gH,expirationTime:oH,sortIndex:-1},gH>SN?(TH.sortIndex=gH,r(x,TH),i(A)===null&&TH===i(x)&&(EN?(IN(UH),UH=-1):EN=!0,yH(pH,gH-SN))):(TH.sortIndex=oH,r(A,TH),mN||fN||(mN=!0,GH(SH))),TH},e.unstable_shouldYield=HH,e.unstable_wrapCallback=function(TH){var NH=dN;return function(){var gH=dN;dN=NH;try{return TH.apply(this,arguments)}finally{dN=gH}}}}(scheduler_production_min)),scheduler_production_min}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production_min()),scheduler.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production_min;function requireReactDom_production_min(){if(hasRequiredReactDom_production_min)return reactDom_production_min;hasRequiredReactDom_production_min=1;var e=requireReact(),r=requireScheduler();function i(z){for(var C_="https://reactjs.org/docs/error-decoder.html?invariant="+z,hN=1;hN<arguments.length;hN++)C_+="&args[]="+encodeURIComponent(arguments[hN]);return"Minified React error #"+z+"; visit "+C_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,h={};function p(z,C_){g(z,C_),g(z+"Capture",C_)}function g(z,C_){for(h[z]=C_,z=0;z<C_.length;z++)o.add(C_[z])}var C=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),A=Object.prototype.hasOwnProperty,x=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_e={},cN={};function dN(z){return A.call(cN,z)?!0:A.call(_e,z)?!1:x.test(z)?cN[z]=!0:(_e[z]=!0,!1)}function fN(z,C_,hN,gN){if(hN!==null&&hN.type===0)return!1;switch(typeof C_){case"function":case"symbol":return!0;case"boolean":return gN?!1:hN!==null?!hN.acceptsBooleans:(z=z.toLowerCase().slice(0,5),z!=="data-"&&z!=="aria-");default:return!1}}function mN(z,C_,hN,gN){if(C_===null||typeof C_>"u"||fN(z,C_,hN,gN))return!0;if(gN)return!1;if(hN!==null)switch(hN.type){case 3:return!C_;case 4:return C_===!1;case 5:return isNaN(C_);case 6:return isNaN(C_)||1>C_}return!1}function EN(z,C_,hN,gN,t3,sH,mH){this.acceptsBooleans=C_===2||C_===3||C_===4,this.attributeName=gN,this.attributeNamespace=t3,this.mustUseProperty=hN,this.propertyName=z,this.type=C_,this.sanitizeURL=sH,this.removeEmptyString=mH}var RN={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(z){RN[z]=new EN(z,0,!1,z,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(z){var C_=z[0];RN[C_]=new EN(C_,1,!1,z[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(z){RN[z]=new EN(z,2,!1,z.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(z){RN[z]=new EN(z,2,!1,z,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(z){RN[z]=new EN(z,3,!1,z.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(z){RN[z]=new EN(z,3,!0,z,null,!1,!1)}),["capture","download"].forEach(function(z){RN[z]=new EN(z,4,!1,z,null,!1,!1)}),["cols","rows","size","span"].forEach(function(z){RN[z]=new EN(z,6,!1,z,null,!1,!1)}),["rowSpan","start"].forEach(function(z){RN[z]=new EN(z,5,!1,z.toLowerCase(),null,!1,!1)});var IN=/[\-:]([a-z])/g;function t0(z){return z[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(z){var C_=z.replace(IN,t0);RN[C_]=new EN(C_,1,!1,z,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(z){var C_=z.replace(IN,t0);RN[C_]=new EN(C_,1,!1,z,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(z){var C_=z.replace(IN,t0);RN[C_]=new EN(C_,1,!1,z,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(z){RN[z]=new EN(z,1,!1,z.toLowerCase(),null,!1,!1)}),RN.xlinkHref=new EN("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(z){RN[z]=new EN(z,1,!1,z.toLowerCase(),null,!0,!0)});function aH(z,C_,hN,gN){var t3=RN.hasOwnProperty(C_)?RN[C_]:null;(t3!==null?t3.type!==0:gN||!(2<C_.length)||C_[0]!=="o"&&C_[0]!=="O"||C_[1]!=="n"&&C_[1]!=="N")&&(mN(C_,hN,t3,gN)&&(hN=null),gN||t3===null?dN(C_)&&(hN===null?z.removeAttribute(C_):z.setAttribute(C_,""+hN)):t3.mustUseProperty?z[t3.propertyName]=hN===null?t3.type===3?!1:"":hN:(C_=t3.attributeName,gN=t3.attributeNamespace,hN===null?z.removeAttribute(C_):(t3=t3.type,hN=t3===3||t3===4&&hN===!0?"":""+hN,gN?z.setAttributeNS(gN,C_,hN):z.setAttribute(C_,hN))))}var pH=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,SH=Symbol.for("react.element"),vH=Symbol.for("react.portal"),AH=Symbol.for("react.fragment"),UH=Symbol.for("react.strict_mode"),zH=Symbol.for("react.profiler"),CH=Symbol.for("react.provider"),HH=Symbol.for("react.context"),VH=Symbol.for("react.forward_ref"),KH=Symbol.for("react.suspense"),IH=Symbol.for("react.suspense_list"),MH=Symbol.for("react.memo"),GH=Symbol.for("react.lazy"),yH=Symbol.for("react.offscreen"),TH=Symbol.iterator;function NH(z){return z===null||typeof z!="object"?null:(z=TH&&z[TH]||z["@@iterator"],typeof z=="function"?z:null)}var gH=Object.assign,SN;function oH(z){if(SN===void 0)try{throw Error()}catch(hN){var C_=hN.stack.trim().match(/\n( *(at )?)/);SN=C_&&C_[1]||""}return`
`+SN+z}var fH=!1;function xH(z,C_){if(!z||fH)return"";fH=!0;var hN=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(C_)if(C_=function(){throw Error()},Object.defineProperty(C_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(C_,[])}catch(s5){var gN=s5}Reflect.construct(z,[],C_)}else{try{C_.call()}catch(s5){gN=s5}z.call(C_.prototype)}else{try{throw Error()}catch(s5){gN=s5}z()}}catch(s5){if(s5&&gN&&typeof s5.stack=="string"){for(var t3=s5.stack.split(`
`),sH=gN.stack.split(`
`),mH=t3.length-1,DH=sH.length-1;1<=mH&&0<=DH&&t3[mH]!==sH[DH];)DH--;for(;1<=mH&&0<=DH;mH--,DH--)if(t3[mH]!==sH[DH]){if(mH!==1||DH!==1)do if(mH--,DH--,0>DH||t3[mH]!==sH[DH]){var FH=`
`+t3[mH].replace(" at new "," at ");return z.displayName&&FH.includes("<anonymous>")&&(FH=FH.replace("<anonymous>",z.displayName)),FH}while(1<=mH&&0<=DH);break}}}finally{fH=!1,Error.prepareStackTrace=hN}return(z=z?z.displayName||z.name:"")?oH(z):""}function l5(z){switch(z.tag){case 5:return oH(z.type);case 16:return oH("Lazy");case 13:return oH("Suspense");case 19:return oH("SuspenseList");case 0:case 2:case 15:return z=xH(z.type,!1),z;case 11:return z=xH(z.type.render,!1),z;case 1:return z=xH(z.type,!0),z;default:return""}}function w5(z){if(z==null)return null;if(typeof z=="function")return z.displayName||z.name||null;if(typeof z=="string")return z;switch(z){case AH:return"Fragment";case vH:return"Portal";case zH:return"Profiler";case UH:return"StrictMode";case KH:return"Suspense";case IH:return"SuspenseList"}if(typeof z=="object")switch(z.$$typeof){case HH:return(z.displayName||"Context")+".Consumer";case CH:return(z._context.displayName||"Context")+".Provider";case VH:var C_=z.render;return z=z.displayName,z||(z=C_.displayName||C_.name||"",z=z!==""?"ForwardRef("+z+")":"ForwardRef"),z;case MH:return C_=z.displayName||null,C_!==null?C_:w5(z.type)||"Memo";case GH:C_=z._payload,z=z._init;try{return w5(z(C_))}catch{}}return null}function H5(z){var C_=z.type;switch(z.tag){case 24:return"Cache";case 9:return(C_.displayName||"Context")+".Consumer";case 10:return(C_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return z=C_.render,z=z.displayName||z.name||"",C_.displayName||(z!==""?"ForwardRef("+z+")":"ForwardRef");case 7:return"Fragment";case 5:return C_;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return w5(C_);case 8:return C_===UH?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof C_=="function")return C_.displayName||C_.name||null;if(typeof C_=="string")return C_}return null}function d6(z){switch(typeof z){case"boolean":case"number":case"string":case"undefined":return z;case"object":return z;default:return""}}function C6(z){var C_=z.type;return(z=z.nodeName)&&z.toLowerCase()==="input"&&(C_==="checkbox"||C_==="radio")}function fK(z){var C_=C6(z)?"checked":"value",hN=Object.getOwnPropertyDescriptor(z.constructor.prototype,C_),gN=""+z[C_];if(!z.hasOwnProperty(C_)&&typeof hN<"u"&&typeof hN.get=="function"&&typeof hN.set=="function"){var t3=hN.get,sH=hN.set;return Object.defineProperty(z,C_,{configurable:!0,get:function(){return t3.call(this)},set:function(mH){gN=""+mH,sH.call(this,mH)}}),Object.defineProperty(z,C_,{enumerable:hN.enumerable}),{getValue:function(){return gN},setValue:function(mH){gN=""+mH},stopTracking:function(){z._valueTracker=null,delete z[C_]}}}}function D4(z){z._valueTracker||(z._valueTracker=fK(z))}function i4(z){if(!z)return!1;var C_=z._valueTracker;if(!C_)return!0;var hN=C_.getValue(),gN="";return z&&(gN=C6(z)?z.checked?"true":"false":z.value),z=gN,z!==hN?(C_.setValue(z),!0):!1}function L6(z){if(z=z||(typeof document<"u"?document:void 0),typeof z>"u")return null;try{return z.activeElement||z.body}catch{return z.body}}function X5(z,C_){var hN=C_.checked;return gH({},C_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:hN??z._wrapperState.initialChecked})}function B5(z,C_){var hN=C_.defaultValue==null?"":C_.defaultValue,gN=C_.checked!=null?C_.checked:C_.defaultChecked;hN=d6(C_.value!=null?C_.value:hN),z._wrapperState={initialChecked:gN,initialValue:hN,controlled:C_.type==="checkbox"||C_.type==="radio"?C_.checked!=null:C_.value!=null}}function y5(z,C_){C_=C_.checked,C_!=null&&aH(z,"checked",C_,!1)}function k5(z,C_){y5(z,C_);var hN=d6(C_.value),gN=C_.type;if(hN!=null)gN==="number"?(hN===0&&z.value===""||z.value!=hN)&&(z.value=""+hN):z.value!==""+hN&&(z.value=""+hN);else if(gN==="submit"||gN==="reset"){z.removeAttribute("value");return}C_.hasOwnProperty("value")?M6(z,C_.type,hN):C_.hasOwnProperty("defaultValue")&&M6(z,C_.type,d6(C_.defaultValue)),C_.checked==null&&C_.defaultChecked!=null&&(z.defaultChecked=!!C_.defaultChecked)}function Q5(z,C_,hN){if(C_.hasOwnProperty("value")||C_.hasOwnProperty("defaultValue")){var gN=C_.type;if(!(gN!=="submit"&&gN!=="reset"||C_.value!==void 0&&C_.value!==null))return;C_=""+z._wrapperState.initialValue,hN||C_===z.value||(z.value=C_),z.defaultValue=C_}hN=z.name,hN!==""&&(z.name=""),z.defaultChecked=!!z._wrapperState.initialChecked,hN!==""&&(z.name=hN)}function M6(z,C_,hN){(C_!=="number"||L6(z.ownerDocument)!==z)&&(hN==null?z.defaultValue=""+z._wrapperState.initialValue:z.defaultValue!==""+hN&&(z.defaultValue=""+hN))}var g6=Array.isArray;function W5(z,C_,hN,gN){if(z=z.options,C_){C_={};for(var t3=0;t3<hN.length;t3++)C_["$"+hN[t3]]=!0;for(hN=0;hN<z.length;hN++)t3=C_.hasOwnProperty("$"+z[hN].value),z[hN].selected!==t3&&(z[hN].selected=t3),t3&&gN&&(z[hN].defaultSelected=!0)}else{for(hN=""+d6(hN),C_=null,t3=0;t3<z.length;t3++){if(z[t3].value===hN){z[t3].selected=!0,gN&&(z[t3].defaultSelected=!0);return}C_!==null||z[t3].disabled||(C_=z[t3])}C_!==null&&(C_.selected=!0)}}function HK(z,C_){if(C_.dangerouslySetInnerHTML!=null)throw Error(i(91));return gH({},C_,{value:void 0,defaultValue:void 0,children:""+z._wrapperState.initialValue})}function f8(z,C_){var hN=C_.value;if(hN==null){if(hN=C_.children,C_=C_.defaultValue,hN!=null){if(C_!=null)throw Error(i(92));if(g6(hN)){if(1<hN.length)throw Error(i(93));hN=hN[0]}C_=hN}C_==null&&(C_=""),hN=C_}z._wrapperState={initialValue:d6(hN)}}function X6(z,C_){var hN=d6(C_.value),gN=d6(C_.defaultValue);hN!=null&&(hN=""+hN,hN!==z.value&&(z.value=hN),C_.defaultValue==null&&z.defaultValue!==hN&&(z.defaultValue=hN)),gN!=null&&(z.defaultValue=""+gN)}function G7(z){var C_=z.textContent;C_===z._wrapperState.initialValue&&C_!==""&&C_!==null&&(z.value=C_)}function _ee(z){switch(z){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function k8(z,C_){return z==null||z==="http://www.w3.org/1999/xhtml"?_ee(C_):z==="http://www.w3.org/2000/svg"&&C_==="foreignObject"?"http://www.w3.org/1999/xhtml":z}var e9,BQ=function(z){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(C_,hN,gN,t3){MSApp.execUnsafeLocalFunction(function(){return z(C_,hN,gN,t3)})}:z}(function(z,C_){if(z.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in z)z.innerHTML=C_;else{for(e9=e9||document.createElement("div"),e9.innerHTML="<svg>"+C_.valueOf().toString()+"</svg>",C_=e9.firstChild;z.firstChild;)z.removeChild(z.firstChild);for(;C_.firstChild;)z.appendChild(C_.firstChild)}});function W7(z,C_){if(C_){var hN=z.firstChild;if(hN&&hN===z.lastChild&&hN.nodeType===3){hN.nodeValue=C_;return}}z.textContent=C_}var H7={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ure=["Webkit","ms","Moz","O"];Object.keys(H7).forEach(function(z){ure.forEach(function(C_){C_=C_+z.charAt(0).toUpperCase()+z.substring(1),H7[C_]=H7[z]})});function Eee(z,C_,hN){return C_==null||typeof C_=="boolean"||C_===""?"":hN||typeof C_!="number"||C_===0||H7.hasOwnProperty(z)&&H7[z]?(""+C_).trim():C_+"px"}function cJ(z,C_){z=z.style;for(var hN in C_)if(C_.hasOwnProperty(hN)){var gN=hN.indexOf("--")===0,t3=Eee(hN,C_[hN],gN);hN==="float"&&(hN="cssFloat"),gN?z.setProperty(hN,t3):z[hN]=t3}}var dre=gH({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mee(z,C_){if(C_){if(dre[z]&&(C_.children!=null||C_.dangerouslySetInnerHTML!=null))throw Error(i(137,z));if(C_.dangerouslySetInnerHTML!=null){if(C_.children!=null)throw Error(i(60));if(typeof C_.dangerouslySetInnerHTML!="object"||!("__html"in C_.dangerouslySetInnerHTML))throw Error(i(61))}if(C_.style!=null&&typeof C_.style!="object")throw Error(i(62))}}function gee(z,C_){if(z.indexOf("-")===-1)return typeof C_.is=="string";switch(z){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uJ=null;function GQ(z){return z=z.target||z.srcElement||window,z.correspondingUseElement&&(z=z.correspondingUseElement),z.nodeType===3?z.parentNode:z}var Tee=null,q7=null,K7=null;function lre(z){if(z=k9(z)){if(typeof Tee!="function")throw Error(i(280));var C_=z.stateNode;C_&&(C_=_Z(C_),Tee(z.stateNode,z.type,C_))}}function z7(z){q7?K7?K7.push(z):K7=[z]:q7=z}function hre(){if(q7){var z=q7,C_=K7;if(K7=q7=null,lre(z),C_)for(z=0;z<C_.length;z++)lre(C_[z])}}function $J(z,C_){return z(C_)}function pre(){}var See=!1;function fre(z,C_,hN){if(See)return z(C_,hN);See=!0;try{return $J(z,C_,hN)}finally{See=!1,(q7!==null||K7!==null)&&(pre(),hre())}}function s4(z,C_){var hN=z.stateNode;if(hN===null)return null;var gN=_Z(hN);if(gN===null)return null;hN=gN[C_];e:switch(C_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(gN=!gN.disabled)||(z=z.type,gN=!(z==="button"||z==="input"||z==="select"||z==="textarea")),z=!gN;break e;default:z=!1}if(z)return null;if(hN&&typeof hN!="function")throw Error(i(231,C_,typeof hN));return hN}var yee=!1;if(C)try{var t9={};Object.defineProperty(t9,"passive",{get:function(){yee=!0}}),window.addEventListener("test",t9,t9),window.removeEventListener("test",t9,t9)}catch{yee=!1}function WQ(z,C_,hN,gN,t3,sH,mH,DH,FH){var s5=Array.prototype.slice.call(arguments,3);try{C_.apply(hN,s5)}catch(R5){this.onError(R5)}}var Y7=!1,n9=null,r9=!1,Ree=null,_re={onError:function(z){Y7=!0,n9=z}};function lae(z,C_,hN,gN,t3,sH,mH,DH,FH){Y7=!1,n9=null,WQ.apply(_re,arguments)}function Ere(z,C_,hN,gN,t3,sH,mH,DH,FH){if(lae.apply(this,arguments),Y7){if(Y7){var s5=n9;Y7=!1,n9=null}else throw Error(i(198));r9||(r9=!0,Ree=s5)}}function e7(z){var C_=z,hN=z;if(z.alternate)for(;C_.return;)C_=C_.return;else{z=C_;do C_=z,C_.flags&4098&&(hN=C_.return),z=C_.return;while(z)}return C_.tag===3?hN:null}function mre(z){if(z.tag===13){var C_=z.memoizedState;if(C_===null&&(z=z.alternate,z!==null&&(C_=z.memoizedState)),C_!==null)return C_.dehydrated}return null}function gre(z){if(e7(z)!==z)throw Error(i(188))}function Tre(z){var C_=z.alternate;if(!C_){if(C_=e7(z),C_===null)throw Error(i(188));return C_!==z?null:z}for(var hN=z,gN=C_;;){var t3=hN.return;if(t3===null)break;var sH=t3.alternate;if(sH===null){if(gN=t3.return,gN!==null){hN=gN;continue}break}if(t3.child===sH.child){for(sH=t3.child;sH;){if(sH===hN)return gre(t3),z;if(sH===gN)return gre(t3),C_;sH=sH.sibling}throw Error(i(188))}if(hN.return!==gN.return)hN=t3,gN=sH;else{for(var mH=!1,DH=t3.child;DH;){if(DH===hN){mH=!0,hN=t3,gN=sH;break}if(DH===gN){mH=!0,gN=t3,hN=sH;break}DH=DH.sibling}if(!mH){for(DH=sH.child;DH;){if(DH===hN){mH=!0,hN=sH,gN=t3;break}if(DH===gN){mH=!0,gN=sH,hN=t3;break}DH=DH.sibling}if(!mH)throw Error(i(189))}}if(hN.alternate!==gN)throw Error(i(190))}if(hN.tag!==3)throw Error(i(188));return hN.stateNode.current===hN?z:C_}function bee(z){return z=Tre(z),z!==null?HQ(z):null}function HQ(z){if(z.tag===5||z.tag===6)return z;for(z=z.child;z!==null;){var C_=HQ(z);if(C_!==null)return C_;z=z.sibling}return null}var vee=r.unstable_scheduleCallback,t7=r.unstable_cancelCallback,hae=r.unstable_shouldYield,pae=r.unstable_requestPaint,Q6=r.unstable_now,fae=r.unstable_getCurrentPriorityLevel,Cee=r.unstable_ImmediatePriority,kK=r.unstable_UserBlockingPriority,qQ=r.unstable_NormalPriority,_ae=r.unstable_LowPriority,Sre=r.unstable_IdlePriority,KQ=null,_8=null;function Eae(z){if(_8&&typeof _8.onCommitFiberRoot=="function")try{_8.onCommitFiberRoot(KQ,z,void 0,(z.current.flags&128)===128)}catch{}}var E8=Math.clz32?Math.clz32:Tae,mae=Math.log,gae=Math.LN2;function Tae(z){return z>>>=0,z===0?32:31-(mae(z)/gae|0)|0}var AY=64,J7=4194304;function i9(z){switch(z&-z){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return z&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return z&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return z}}function K6(z,C_){var hN=z.pendingLanes;if(hN===0)return 0;var gN=0,t3=z.suspendedLanes,sH=z.pingedLanes,mH=hN&268435455;if(mH!==0){var DH=mH&~t3;DH!==0?gN=i9(DH):(sH&=mH,sH!==0&&(gN=i9(sH)))}else mH=hN&~t3,mH!==0?gN=i9(mH):sH!==0&&(gN=i9(sH));if(gN===0)return 0;if(C_!==0&&C_!==gN&&!(C_&t3)&&(t3=gN&-gN,sH=C_&-C_,t3>=sH||t3===16&&(sH&4194240)!==0))return C_;if(gN&4&&(gN|=hN&16),C_=z.entangledLanes,C_!==0)for(z=z.entanglements,C_&=gN;0<C_;)hN=31-E8(C_),t3=1<<hN,gN|=z[hN],C_&=~t3;return gN}function Sae(z,C_){switch(z){case 1:case 2:case 4:return C_+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return C_+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yre(z,C_){for(var hN=z.suspendedLanes,gN=z.pingedLanes,t3=z.expirationTimes,sH=z.pendingLanes;0<sH;){var mH=31-E8(sH),DH=1<<mH,FH=t3[mH];FH===-1?(!(DH&hN)||DH&gN)&&(t3[mH]=Sae(DH,C_)):FH<=C_&&(z.expiredLanes|=DH),sH&=~DH}}function zQ(z){return z=z.pendingLanes&-1073741825,z!==0?z:z&1073741824?1073741824:0}function Rre(){var z=AY;return AY<<=1,!(AY&4194240)&&(AY=64),z}function Iee(z){for(var C_=[],hN=0;31>hN;hN++)C_.push(z);return C_}function s9(z,C_,hN){z.pendingLanes|=C_,C_!==536870912&&(z.suspendedLanes=0,z.pingedLanes=0),z=z.eventTimes,C_=31-E8(C_),z[C_]=hN}function yae(z,C_){var hN=z.pendingLanes&~C_;z.pendingLanes=C_,z.suspendedLanes=0,z.pingedLanes=0,z.expiredLanes&=C_,z.mutableReadLanes&=C_,z.entangledLanes&=C_,C_=z.entanglements;var gN=z.eventTimes;for(z=z.expirationTimes;0<hN;){var t3=31-E8(hN),sH=1<<t3;C_[t3]=0,gN[t3]=-1,z[t3]=-1,hN&=~sH}}function wee(z,C_){var hN=z.entangledLanes|=C_;for(z=z.entanglements;hN;){var gN=31-E8(hN),t3=1<<gN;t3&C_|z[gN]&C_&&(z[gN]|=C_),hN&=~t3}}var tK=0;function YQ(z){return z&=-z,1<z?4<z?z&268435455?16:536870912:4:1}var Aee,o9,bre,JQ,vre,XQ=!1,QQ=[],dJ=null,lJ=null,hJ=null,a9=new Map,c9=new Map,pJ=[],Rae="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Oee(z,C_){switch(z){case"focusin":case"focusout":dJ=null;break;case"dragenter":case"dragleave":lJ=null;break;case"mouseover":case"mouseout":hJ=null;break;case"pointerover":case"pointerout":a9.delete(C_.pointerId);break;case"gotpointercapture":case"lostpointercapture":c9.delete(C_.pointerId)}}function u9(z,C_,hN,gN,t3,sH){return z===null||z.nativeEvent!==sH?(z={blockedOn:C_,domEventName:hN,eventSystemFlags:gN,nativeEvent:sH,targetContainers:[t3]},C_!==null&&(C_=k9(C_),C_!==null&&o9(C_)),z):(z.eventSystemFlags|=gN,C_=z.targetContainers,t3!==null&&C_.indexOf(t3)===-1&&C_.push(t3),z)}function bae(z,C_,hN,gN,t3){switch(C_){case"focusin":return dJ=u9(dJ,z,C_,hN,gN,t3),!0;case"dragenter":return lJ=u9(lJ,z,C_,hN,gN,t3),!0;case"mouseover":return hJ=u9(hJ,z,C_,hN,gN,t3),!0;case"pointerover":var sH=t3.pointerId;return a9.set(sH,u9(a9.get(sH)||null,z,C_,hN,gN,t3)),!0;case"gotpointercapture":return sH=t3.pointerId,c9.set(sH,u9(c9.get(sH)||null,z,C_,hN,gN,t3)),!0}return!1}function Cre(z){var C_=i7(z.target);if(C_!==null){var hN=e7(C_);if(hN!==null){if(C_=hN.tag,C_===13){if(C_=mre(hN),C_!==null){z.blockedOn=C_,vre(z.priority,function(){bre(hN)});return}}else if(C_===3&&hN.stateNode.current.memoizedState.isDehydrated){z.blockedOn=hN.tag===3?hN.stateNode.containerInfo:null;return}}}z.blockedOn=null}function fJ(z){if(z.blockedOn!==null)return!1;for(var C_=z.targetContainers;0<C_.length;){var hN=$Q(z.domEventName,z.eventSystemFlags,C_[0],z.nativeEvent);if(hN===null){hN=z.nativeEvent;var gN=new hN.constructor(hN.type,hN);uJ=gN,hN.target.dispatchEvent(gN),uJ=null}else return C_=k9(hN),C_!==null&&o9(C_),z.blockedOn=hN,!1;C_.shift()}return!0}function Ire(z,C_,hN){fJ(z)&&hN.delete(C_)}function vae(){XQ=!1,dJ!==null&&fJ(dJ)&&(dJ=null),lJ!==null&&fJ(lJ)&&(lJ=null),hJ!==null&&fJ(hJ)&&(hJ=null),a9.forEach(Ire),c9.forEach(Ire)}function d9(z,C_){z.blockedOn===C_&&(z.blockedOn=null,XQ||(XQ=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,vae)))}function l9(z){function C_(t3){return d9(t3,z)}if(0<QQ.length){d9(QQ[0],z);for(var hN=1;hN<QQ.length;hN++){var gN=QQ[hN];gN.blockedOn===z&&(gN.blockedOn=null)}}for(dJ!==null&&d9(dJ,z),lJ!==null&&d9(lJ,z),hJ!==null&&d9(hJ,z),a9.forEach(C_),c9.forEach(C_),hN=0;hN<pJ.length;hN++)gN=pJ[hN],gN.blockedOn===z&&(gN.blockedOn=null);for(;0<pJ.length&&(hN=pJ[0],hN.blockedOn===null);)Cre(hN),hN.blockedOn===null&&pJ.shift()}var n7=pH.ReactCurrentBatchConfig,ZQ=!0;function Cae(z,C_,hN,gN){var t3=tK,sH=n7.transition;n7.transition=null;try{tK=1,_z(z,C_,hN,gN)}finally{tK=t3,n7.transition=sH}}function Iae(z,C_,hN,gN){var t3=tK,sH=n7.transition;n7.transition=null;try{tK=4,_z(z,C_,hN,gN)}finally{tK=t3,n7.transition=sH}}function _z(z,C_,hN,gN){if(ZQ){var t3=$Q(z,C_,hN,gN);if(t3===null)qee(z,C_,gN,k4,hN),Oee(z,gN);else if(bae(t3,z,C_,hN,gN))gN.stopPropagation();else if(Oee(z,gN),C_&4&&-1<Rae.indexOf(z)){for(;t3!==null;){var sH=k9(t3);if(sH!==null&&Aee(sH),sH=$Q(z,C_,hN,gN),sH===null&&qee(z,C_,gN,k4,hN),sH===t3)break;t3=sH}t3!==null&&gN.stopPropagation()}else qee(z,C_,gN,null,hN)}}var k4=null;function $Q(z,C_,hN,gN){if(k4=null,z=GQ(gN),z=i7(z),z!==null)if(C_=e7(z),C_===null)z=null;else if(hN=C_.tag,hN===13){if(z=mre(C_),z!==null)return z;z=null}else if(hN===3){if(C_.stateNode.current.memoizedState.isDehydrated)return C_.tag===3?C_.stateNode.containerInfo:null;z=null}else C_!==z&&(z=null);return k4=z,null}function wre(z){switch(z){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fae()){case Cee:return 1;case kK:return 4;case qQ:case _ae:return 16;case Sre:return 536870912;default:return 16}default:return 16}}var _J=null,Nee=null,o4=null;function Are(){if(o4)return o4;var z,C_=Nee,hN=C_.length,gN,t3="value"in _J?_J.value:_J.textContent,sH=t3.length;for(z=0;z<hN&&C_[z]===t3[z];z++);var mH=hN-z;for(gN=1;gN<=mH&&C_[hN-gN]===t3[sH-gN];gN++);return o4=t3.slice(z,1<gN?1-gN:void 0)}function eZ(z){var C_=z.keyCode;return"charCode"in z?(z=z.charCode,z===0&&C_===13&&(z=13)):z=C_,z===10&&(z=13),32<=z||z===13?z:0}function tZ(){return!0}function h9(){return!1}function q4(z){function C_(hN,gN,t3,sH,mH){this._reactName=hN,this._targetInst=t3,this.type=gN,this.nativeEvent=sH,this.target=mH,this.currentTarget=null;for(var DH in z)z.hasOwnProperty(DH)&&(hN=z[DH],this[DH]=hN?hN(sH):sH[DH]);return this.isDefaultPrevented=(sH.defaultPrevented!=null?sH.defaultPrevented:sH.returnValue===!1)?tZ:h9,this.isPropagationStopped=h9,this}return gH(C_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var hN=this.nativeEvent;hN&&(hN.preventDefault?hN.preventDefault():typeof hN.returnValue!="unknown"&&(hN.returnValue=!1),this.isDefaultPrevented=tZ)},stopPropagation:function(){var hN=this.nativeEvent;hN&&(hN.stopPropagation?hN.stopPropagation():typeof hN.cancelBubble!="unknown"&&(hN.cancelBubble=!0),this.isPropagationStopped=tZ)},persist:function(){},isPersistent:tZ}),C_}var X7={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(z){return z.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},p9=q4(X7),f9=gH({},X7,{view:0,detail:0}),Pee=q4(f9),_9,E9,m9,nZ=gH({},f9,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lee,button:0,buttons:0,relatedTarget:function(z){return z.relatedTarget===void 0?z.fromElement===z.srcElement?z.toElement:z.fromElement:z.relatedTarget},movementX:function(z){return"movementX"in z?z.movementX:(z!==m9&&(m9&&z.type==="mousemove"?(_9=z.screenX-m9.screenX,E9=z.screenY-m9.screenY):E9=_9=0,m9=z),_9)},movementY:function(z){return"movementY"in z?z.movementY:E9}}),EJ=q4(nZ),g9=gH({},nZ,{dataTransfer:0}),wae=q4(g9),Aae=gH({},f9,{relatedTarget:0}),Dee=q4(Aae),Oae=gH({},X7,{animationName:0,elapsedTime:0,pseudoElement:0}),Nae=q4(Oae),Q7=gH({},X7,{clipboardData:function(z){return"clipboardData"in z?z.clipboardData:window.clipboardData}}),Pae=q4(Q7),Z7=gH({},X7,{data:0}),kee=q4(Z7),Dae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},f6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lae(z){var C_=this.nativeEvent;return C_.getModifierState?C_.getModifierState(z):(z=kae[z])?!!C_[z]:!1}function Lee(){return Lae}var Mae=gH({},f9,{key:function(z){if(z.key){var C_=Dae[z.key]||z.key;if(C_!=="Unidentified")return C_}return z.type==="keypress"?(z=eZ(z),z===13?"Enter":String.fromCharCode(z)):z.type==="keydown"||z.type==="keyup"?f6[z.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lee,charCode:function(z){return z.type==="keypress"?eZ(z):0},keyCode:function(z){return z.type==="keydown"||z.type==="keyup"?z.keyCode:0},which:function(z){return z.type==="keypress"?eZ(z):z.type==="keydown"||z.type==="keyup"?z.keyCode:0}}),Mee=q4(Mae),Uae=gH({},nZ,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ore=q4(Uae),xae=gH({},f9,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lee}),Uee=q4(xae),Vae=gH({},X7,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fae=q4(Vae),Nre=gH({},nZ,{deltaX:function(z){return"deltaX"in z?z.deltaX:"wheelDeltaX"in z?-z.wheelDeltaX:0},deltaY:function(z){return"deltaY"in z?z.deltaY:"wheelDeltaY"in z?-z.wheelDeltaY:"wheelDelta"in z?-z.wheelDelta:0},deltaZ:0,deltaMode:0}),jae=q4(Nre),mJ=[9,13,27,32],xee=C&&"CompositionEvent"in window,T9=null;C&&"documentMode"in document&&(T9=document.documentMode);var Bae=C&&"TextEvent"in window&&!T9,Vee=C&&(!xee||T9&&8<T9&&11>=T9),rZ=" ",Pre=!1;function Dre(z,C_){switch(z){case"keyup":return mJ.indexOf(C_.keyCode)!==-1;case"keydown":return C_.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kre(z){return z=z.detail,typeof z=="object"&&"data"in z?z.data:null}var l4=!1;function Gae(z,C_){switch(z){case"compositionend":return kre(C_);case"keypress":return C_.which!==32?null:(Pre=!0,rZ);case"textInput":return z=C_.data,z===rZ&&Pre?null:z;default:return null}}function Wae(z,C_){if(l4)return z==="compositionend"||!xee&&Dre(z,C_)?(z=Are(),o4=Nee=_J=null,l4=!1,z):null;switch(z){case"paste":return null;case"keypress":if(!(C_.ctrlKey||C_.altKey||C_.metaKey)||C_.ctrlKey&&C_.altKey){if(C_.char&&1<C_.char.length)return C_.char;if(C_.which)return String.fromCharCode(C_.which)}return null;case"compositionend":return Vee&&C_.locale!=="ko"?null:C_.data;default:return null}}var Hae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lre(z){var C_=z&&z.nodeName&&z.nodeName.toLowerCase();return C_==="input"?!!Hae[z.type]:C_==="textarea"}function Fee(z,C_,hN,gN){z7(gN),C_=uZ(C_,"onChange"),0<C_.length&&(hN=new p9("onChange","change",null,hN,gN),z.push({event:hN,listeners:C_}))}var S9=null,y9=null;function Mre(z){aZ(z,0)}function $7(z){var C_=aX(z);if(i4(C_))return z}function qae(z,C_){if(z==="change")return C_}var Ure=!1;if(C){var eX;if(C){var jee="oninput"in document;if(!jee){var xre=document.createElement("div");xre.setAttribute("oninput","return;"),jee=typeof xre.oninput=="function"}eX=jee}else eX=!1;Ure=eX&&(!document.documentMode||9<document.documentMode)}function Vre(){S9&&(S9.detachEvent("onpropertychange",eY),y9=S9=null)}function eY(z){if(z.propertyName==="value"&&$7(y9)){var C_=[];Fee(C_,y9,z,GQ(z)),fre(Mre,C_)}}function Kae(z,C_,hN){z==="focusin"?(Vre(),S9=C_,y9=hN,S9.attachEvent("onpropertychange",eY)):z==="focusout"&&Vre()}function zae(z){if(z==="selectionchange"||z==="keyup"||z==="keydown")return $7(y9)}function K4(z,C_){if(z==="click")return $7(C_)}function Yae(z,C_){if(z==="input"||z==="change")return $7(C_)}function Jae(z,C_){return z===C_&&(z!==0||1/z===1/C_)||z!==z&&C_!==C_}var L8=typeof Object.is=="function"?Object.is:Jae;function R9(z,C_){if(L8(z,C_))return!0;if(typeof z!="object"||z===null||typeof C_!="object"||C_===null)return!1;var hN=Object.keys(z),gN=Object.keys(C_);if(hN.length!==gN.length)return!1;for(gN=0;gN<hN.length;gN++){var t3=hN[gN];if(!A.call(C_,t3)||!L8(z[t3],C_[t3]))return!1}return!0}function Bee(z){for(;z&&z.firstChild;)z=z.firstChild;return z}function Fre(z,C_){var hN=Bee(z);z=0;for(var gN;hN;){if(hN.nodeType===3){if(gN=z+hN.textContent.length,z<=C_&&gN>=C_)return{node:hN,offset:C_-z};z=gN}e:{for(;hN;){if(hN.nextSibling){hN=hN.nextSibling;break e}hN=hN.parentNode}hN=void 0}hN=Bee(hN)}}function jre(z,C_){return z&&C_?z===C_?!0:z&&z.nodeType===3?!1:C_&&C_.nodeType===3?jre(z,C_.parentNode):"contains"in z?z.contains(C_):z.compareDocumentPosition?!!(z.compareDocumentPosition(C_)&16):!1:!1}function Bre(){for(var z=window,C_=L6();C_ instanceof z.HTMLIFrameElement;){try{var hN=typeof C_.contentWindow.location.href=="string"}catch{hN=!1}if(hN)z=C_.contentWindow;else break;C_=L6(z.document)}return C_}function iZ(z){var C_=z&&z.nodeName&&z.nodeName.toLowerCase();return C_&&(C_==="input"&&(z.type==="text"||z.type==="search"||z.type==="tel"||z.type==="url"||z.type==="password")||C_==="textarea"||z.contentEditable==="true")}function Xae(z){var C_=Bre(),hN=z.focusedElem,gN=z.selectionRange;if(C_!==hN&&hN&&hN.ownerDocument&&jre(hN.ownerDocument.documentElement,hN)){if(gN!==null&&iZ(hN)){if(C_=gN.start,z=gN.end,z===void 0&&(z=C_),"selectionStart"in hN)hN.selectionStart=C_,hN.selectionEnd=Math.min(z,hN.value.length);else if(z=(C_=hN.ownerDocument||document)&&C_.defaultView||window,z.getSelection){z=z.getSelection();var t3=hN.textContent.length,sH=Math.min(gN.start,t3);gN=gN.end===void 0?sH:Math.min(gN.end,t3),!z.extend&&sH>gN&&(t3=gN,gN=sH,sH=t3),t3=Fre(hN,sH);var mH=Fre(hN,gN);t3&&mH&&(z.rangeCount!==1||z.anchorNode!==t3.node||z.anchorOffset!==t3.offset||z.focusNode!==mH.node||z.focusOffset!==mH.offset)&&(C_=C_.createRange(),C_.setStart(t3.node,t3.offset),z.removeAllRanges(),sH>gN?(z.addRange(C_),z.extend(mH.node,mH.offset)):(C_.setEnd(mH.node,mH.offset),z.addRange(C_)))}}for(C_=[],z=hN;z=z.parentNode;)z.nodeType===1&&C_.push({element:z,left:z.scrollLeft,top:z.scrollTop});for(typeof hN.focus=="function"&&hN.focus(),hN=0;hN<C_.length;hN++)z=C_[hN],z.element.scrollLeft=z.left,z.element.scrollTop=z.top}}var Qae=C&&"documentMode"in document&&11>=document.documentMode,gJ=null,b9=null,v9=null,a5=!1;function Gre(z,C_,hN){var gN=hN.window===hN?hN.document:hN.nodeType===9?hN:hN.ownerDocument;a5||gJ==null||gJ!==L6(gN)||(gN=gJ,"selectionStart"in gN&&iZ(gN)?gN={start:gN.selectionStart,end:gN.selectionEnd}:(gN=(gN.ownerDocument&&gN.ownerDocument.defaultView||window).getSelection(),gN={anchorNode:gN.anchorNode,anchorOffset:gN.anchorOffset,focusNode:gN.focusNode,focusOffset:gN.focusOffset}),v9&&R9(v9,gN)||(v9=gN,gN=uZ(b9,"onSelect"),0<gN.length&&(C_=new p9("onSelect","select",null,C_,hN),z.push({event:C_,listeners:gN}),C_.target=gJ)))}function sZ(z,C_){var hN={};return hN[z.toLowerCase()]=C_.toLowerCase(),hN["Webkit"+z]="webkit"+C_,hN["Moz"+z]="moz"+C_,hN}var tX={animationend:sZ("Animation","AnimationEnd"),animationiteration:sZ("Animation","AnimationIteration"),animationstart:sZ("Animation","AnimationStart"),transitionend:sZ("Transition","TransitionEnd")},Gee={},Wee={};C&&(Wee=document.createElement("div").style,"AnimationEvent"in window||(delete tX.animationend.animation,delete tX.animationiteration.animation,delete tX.animationstart.animation),"TransitionEvent"in window||delete tX.transitionend.transition);function C9(z){if(Gee[z])return Gee[z];if(!tX[z])return z;var C_=tX[z],hN;for(hN in C_)if(C_.hasOwnProperty(hN)&&hN in Wee)return Gee[z]=C_[hN];return z}var Hee=C9("animationend"),Wre=C9("animationiteration"),Hre=C9("animationstart"),I9=C9("transitionend"),nX=new Map,qre="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function TJ(z,C_){nX.set(z,C_),p(C_,[z])}for(var rX=0;rX<qre.length;rX++){var w9=qre[rX],oZ=w9.toLowerCase(),Zae=w9[0].toUpperCase()+w9.slice(1);TJ(oZ,"on"+Zae)}TJ(Hee,"onAnimationEnd"),TJ(Wre,"onAnimationIteration"),TJ(Hre,"onAnimationStart"),TJ("dblclick","onDoubleClick"),TJ("focusin","onFocus"),TJ("focusout","onBlur"),TJ(I9,"onTransitionEnd"),g("onMouseEnter",["mouseout","mouseover"]),g("onMouseLeave",["mouseout","mouseover"]),g("onPointerEnter",["pointerout","pointerover"]),g("onPointerLeave",["pointerout","pointerover"]),p("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),p("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),p("onBeforeInput",["compositionend","keypress","textInput","paste"]),p("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),p("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),p("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var A9="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$ae=new Set("cancel close invalid load scroll toggle".split(" ").concat(A9));function Kre(z,C_,hN){var gN=z.type||"unknown-event";z.currentTarget=hN,Ere(gN,C_,void 0,z),z.currentTarget=null}function aZ(z,C_){C_=(C_&4)!==0;for(var hN=0;hN<z.length;hN++){var gN=z[hN],t3=gN.event;gN=gN.listeners;e:{var sH=void 0;if(C_)for(var mH=gN.length-1;0<=mH;mH--){var DH=gN[mH],FH=DH.instance,s5=DH.currentTarget;if(DH=DH.listener,FH!==sH&&t3.isPropagationStopped())break e;Kre(t3,DH,s5),sH=FH}else for(mH=0;mH<gN.length;mH++){if(DH=gN[mH],FH=DH.instance,s5=DH.currentTarget,DH=DH.listener,FH!==sH&&t3.isPropagationStopped())break e;Kre(t3,DH,s5),sH=FH}}}if(r9)throw z=Ree,r9=!1,Ree=null,z}function TK(z,C_){var hN=C_[Yee];hN===void 0&&(hN=C_[Yee]=new Set);var gN=z+"__bubble";hN.has(gN)||(iX(C_,z,2,!1),hN.add(gN))}function cZ(z,C_,hN){var gN=0;C_&&(gN|=4),iX(hN,z,gN,C_)}var z4="_reactListening"+Math.random().toString(36).slice(2);function O9(z){if(!z[z4]){z[z4]=!0,o.forEach(function(hN){hN!=="selectionchange"&&($ae.has(hN)||cZ(hN,!1,z),cZ(hN,!0,z))});var C_=z.nodeType===9?z:z.ownerDocument;C_===null||C_[z4]||(C_[z4]=!0,cZ("selectionchange",!1,C_))}}function iX(z,C_,hN,gN){switch(wre(C_)){case 1:var t3=Cae;break;case 4:t3=Iae;break;default:t3=_z}hN=t3.bind(null,C_,hN,z),t3=void 0,!yee||C_!=="touchstart"&&C_!=="touchmove"&&C_!=="wheel"||(t3=!0),gN?t3!==void 0?z.addEventListener(C_,hN,{capture:!0,passive:t3}):z.addEventListener(C_,hN,!0):t3!==void 0?z.addEventListener(C_,hN,{passive:t3}):z.addEventListener(C_,hN,!1)}function qee(z,C_,hN,gN,t3){var sH=gN;if(!(C_&1)&&!(C_&2)&&gN!==null)e:for(;;){if(gN===null)return;var mH=gN.tag;if(mH===3||mH===4){var DH=gN.stateNode.containerInfo;if(DH===t3||DH.nodeType===8&&DH.parentNode===t3)break;if(mH===4)for(mH=gN.return;mH!==null;){var FH=mH.tag;if((FH===3||FH===4)&&(FH=mH.stateNode.containerInfo,FH===t3||FH.nodeType===8&&FH.parentNode===t3))return;mH=mH.return}for(;DH!==null;){if(mH=i7(DH),mH===null)return;if(FH=mH.tag,FH===5||FH===6){gN=sH=mH;continue e}DH=DH.parentNode}}gN=gN.return}fre(function(){var s5=sH,R5=GQ(hN),b5=[];e:{var S5=nX.get(z);if(S5!==void 0){var L5=p9,V5=z;switch(z){case"keypress":if(eZ(hN)===0)break e;case"keydown":case"keyup":L5=Mee;break;case"focusin":V5="focus",L5=Dee;break;case"focusout":V5="blur",L5=Dee;break;case"beforeblur":case"afterblur":L5=Dee;break;case"click":if(hN.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L5=EJ;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L5=wae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L5=Uee;break;case Hee:case Wre:case Hre:L5=Nae;break;case I9:L5=Fae;break;case"scroll":L5=Pee;break;case"wheel":L5=jae;break;case"copy":case"cut":case"paste":L5=Pae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L5=Ore}var j5=(C_&4)!==0,VK=!j5&&z==="scroll",QH=j5?S5!==null?S5+"Capture":null:S5;j5=[];for(var WH=s5,t5;WH!==null;){t5=WH;var C5=t5.stateNode;if(t5.tag===5&&C5!==null&&(t5=C5,QH!==null&&(C5=s4(WH,QH),C5!=null&&j5.push(N9(WH,C5,t5)))),VK)break;WH=WH.return}0<j5.length&&(S5=new L5(S5,V5,null,hN,R5),b5.push({event:S5,listeners:j5}))}}if(!(C_&7)){e:{if(S5=z==="mouseover"||z==="pointerover",L5=z==="mouseout"||z==="pointerout",S5&&hN!==uJ&&(V5=hN.relatedTarget||hN.fromElement)&&(i7(V5)||V5[NY]))break e;if((L5||S5)&&(S5=R5.window===R5?R5:(S5=R5.ownerDocument)?S5.defaultView||S5.parentWindow:window,L5?(V5=hN.relatedTarget||hN.toElement,L5=s5,V5=V5?i7(V5):null,V5!==null&&(VK=e7(V5),V5!==VK||V5.tag!==5&&V5.tag!==6)&&(V5=null)):(L5=null,V5=s5),L5!==V5)){if(j5=EJ,C5="onMouseLeave",QH="onMouseEnter",WH="mouse",(z==="pointerout"||z==="pointerover")&&(j5=Ore,C5="onPointerLeave",QH="onPointerEnter",WH="pointer"),VK=L5==null?S5:aX(L5),t5=V5==null?S5:aX(V5),S5=new j5(C5,WH+"leave",L5,hN,R5),S5.target=VK,S5.relatedTarget=t5,C5=null,i7(R5)===s5&&(j5=new j5(QH,WH+"enter",V5,hN,R5),j5.target=t5,j5.relatedTarget=VK,C5=j5),VK=C5,L5&&V5)t:{for(j5=L5,QH=V5,WH=0,t5=j5;t5;t5=r7(t5))WH++;for(t5=0,C5=QH;C5;C5=r7(C5))t5++;for(;0<WH-t5;)j5=r7(j5),WH--;for(;0<t5-WH;)QH=r7(QH),t5--;for(;WH--;){if(j5===QH||QH!==null&&j5===QH.alternate)break t;j5=r7(j5),QH=r7(QH)}j5=null}else j5=null;L5!==null&&zre(b5,S5,L5,j5,!1),V5!==null&&VK!==null&&zre(b5,VK,V5,j5,!0)}}e:{if(S5=s5?aX(s5):window,L5=S5.nodeName&&S5.nodeName.toLowerCase(),L5==="select"||L5==="input"&&S5.type==="file")var G5=qae;else if(Lre(S5))if(Ure)G5=Yae;else{G5=zae;var t6=Kae}else(L5=S5.nodeName)&&L5.toLowerCase()==="input"&&(S5.type==="checkbox"||S5.type==="radio")&&(G5=K4);if(G5&&(G5=G5(z,s5))){Fee(b5,G5,hN,R5);break e}t6&&t6(z,S5,s5),z==="focusout"&&(t6=S5._wrapperState)&&t6.controlled&&S5.type==="number"&&M6(S5,"number",S5.value)}switch(t6=s5?aX(s5):window,z){case"focusin":(Lre(t6)||t6.contentEditable==="true")&&(gJ=t6,b9=s5,v9=null);break;case"focusout":v9=b9=gJ=null;break;case"mousedown":a5=!0;break;case"contextmenu":case"mouseup":case"dragend":a5=!1,Gre(b5,hN,R5);break;case"selectionchange":if(Qae)break;case"keydown":case"keyup":Gre(b5,hN,R5)}var Z5;if(xee)e:{switch(z){case"compositionstart":var a6="onCompositionStart";break e;case"compositionend":a6="onCompositionEnd";break e;case"compositionupdate":a6="onCompositionUpdate";break e}a6=void 0}else l4?Dre(z,hN)&&(a6="onCompositionEnd"):z==="keydown"&&hN.keyCode===229&&(a6="onCompositionStart");a6&&(Vee&&hN.locale!=="ko"&&(l4||a6!=="onCompositionStart"?a6==="onCompositionEnd"&&l4&&(Z5=Are()):(_J=R5,Nee="value"in _J?_J.value:_J.textContent,l4=!0)),t6=uZ(s5,a6),0<t6.length&&(a6=new kee(a6,z,null,hN,R5),b5.push({event:a6,listeners:t6}),Z5?a6.data=Z5:(Z5=kre(hN),Z5!==null&&(a6.data=Z5)))),(Z5=Bae?Gae(z,hN):Wae(z,hN))&&(s5=uZ(s5,"onBeforeInput"),0<s5.length&&(R5=new kee("onBeforeInput","beforeinput",null,hN,R5),b5.push({event:R5,listeners:s5}),R5.data=Z5))}aZ(b5,C_)})}function N9(z,C_,hN){return{instance:z,listener:C_,currentTarget:hN}}function uZ(z,C_){for(var hN=C_+"Capture",gN=[];z!==null;){var t3=z,sH=t3.stateNode;t3.tag===5&&sH!==null&&(t3=sH,sH=s4(z,hN),sH!=null&&gN.unshift(N9(z,sH,t3)),sH=s4(z,C_),sH!=null&&gN.push(N9(z,sH,t3))),z=z.return}return gN}function r7(z){if(z===null)return null;do z=z.return;while(z&&z.tag!==5);return z||null}function zre(z,C_,hN,gN,t3){for(var sH=C_._reactName,mH=[];hN!==null&&hN!==gN;){var DH=hN,FH=DH.alternate,s5=DH.stateNode;if(FH!==null&&FH===gN)break;DH.tag===5&&s5!==null&&(DH=s5,t3?(FH=s4(hN,sH),FH!=null&&mH.unshift(N9(hN,FH,DH))):t3||(FH=s4(hN,sH),FH!=null&&mH.push(N9(hN,FH,DH)))),hN=hN.return}mH.length!==0&&z.push({event:C_,listeners:mH})}var ece=/\r\n?/g,tce=/\u0000|\uFFFD/g;function dZ(z){return(typeof z=="string"?z:""+z).replace(ece,`
`).replace(tce,"")}function lZ(z,C_,hN){if(C_=dZ(C_),dZ(z)!==C_&&hN)throw Error(i(425))}function P9(){}var hZ=null,Kee=null;function pZ(z,C_){return z==="textarea"||z==="noscript"||typeof C_.children=="string"||typeof C_.children=="number"||typeof C_.dangerouslySetInnerHTML=="object"&&C_.dangerouslySetInnerHTML!==null&&C_.dangerouslySetInnerHTML.__html!=null}var sX=typeof setTimeout=="function"?setTimeout:void 0,nce=typeof clearTimeout=="function"?clearTimeout:void 0,Yre=typeof Promise=="function"?Promise:void 0,rce=typeof queueMicrotask=="function"?queueMicrotask:typeof Yre<"u"?function(z){return Yre.resolve(null).then(z).catch(ice)}:sX;function ice(z){setTimeout(function(){throw z})}function zee(z,C_){var hN=C_,gN=0;do{var t3=hN.nextSibling;if(z.removeChild(hN),t3&&t3.nodeType===8)if(hN=t3.data,hN==="/$"){if(gN===0){z.removeChild(t3),l9(C_);return}gN--}else hN!=="$"&&hN!=="$?"&&hN!=="$!"||gN++;hN=t3}while(hN);l9(C_)}function OY(z){for(;z!=null;z=z.nextSibling){var C_=z.nodeType;if(C_===1||C_===3)break;if(C_===8){if(C_=z.data,C_==="$"||C_==="$!"||C_==="$?")break;if(C_==="/$")return null}}return z}function fZ(z){z=z.previousSibling;for(var C_=0;z;){if(z.nodeType===8){var hN=z.data;if(hN==="$"||hN==="$!"||hN==="$?"){if(C_===0)return z;C_--}else hN==="/$"&&C_++}z=z.previousSibling}return null}var oX=Math.random().toString(36).slice(2),m8="__reactFiber$"+oX,D9="__reactProps$"+oX,NY="__reactContainer$"+oX,Yee="__reactEvents$"+oX,sce="__reactListeners$"+oX,oce="__reactHandles$"+oX;function i7(z){var C_=z[m8];if(C_)return C_;for(var hN=z.parentNode;hN;){if(C_=hN[NY]||hN[m8]){if(hN=C_.alternate,C_.child!==null||hN!==null&&hN.child!==null)for(z=fZ(z);z!==null;){if(hN=z[m8])return hN;z=fZ(z)}return C_}z=hN,hN=z.parentNode}return null}function k9(z){return z=z[m8]||z[NY],!z||z.tag!==5&&z.tag!==6&&z.tag!==13&&z.tag!==3?null:z}function aX(z){if(z.tag===5||z.tag===6)return z.stateNode;throw Error(i(33))}function _Z(z){return z[D9]||null}var Jee=[],cX=-1;function M8(z){return{current:z}}function rK(z){0>cX||(z.current=Jee[cX],Jee[cX]=null,cX--)}function iK(z,C_){cX++,Jee[cX]=z.current,z.current=C_}var SJ={},g4=M8(SJ),Y4=M8(!1),yJ=SJ;function s7(z,C_){var hN=z.type.contextTypes;if(!hN)return SJ;var gN=z.stateNode;if(gN&&gN.__reactInternalMemoizedUnmaskedChildContext===C_)return gN.__reactInternalMemoizedMaskedChildContext;var t3={},sH;for(sH in hN)t3[sH]=C_[sH];return gN&&(z=z.stateNode,z.__reactInternalMemoizedUnmaskedChildContext=C_,z.__reactInternalMemoizedMaskedChildContext=t3),t3}function T4(z){return z=z.childContextTypes,z!=null}function EZ(){rK(Y4),rK(g4)}function Jre(z,C_,hN){if(g4.current!==SJ)throw Error(i(168));iK(g4,C_),iK(Y4,hN)}function uX(z,C_,hN){var gN=z.stateNode;if(C_=C_.childContextTypes,typeof gN.getChildContext!="function")return hN;gN=gN.getChildContext();for(var t3 in gN)if(!(t3 in C_))throw Error(i(108,H5(z)||"Unknown",t3));return gH({},hN,gN)}function mZ(z){return z=(z=z.stateNode)&&z.__reactInternalMemoizedMergedChildContext||SJ,yJ=g4.current,iK(g4,z),iK(Y4,Y4.current),!0}function Xre(z,C_,hN){var gN=z.stateNode;if(!gN)throw Error(i(169));hN?(z=uX(z,C_,yJ),gN.__reactInternalMemoizedMergedChildContext=z,rK(Y4),rK(g4),iK(g4,z)):rK(Y4),iK(Y4,hN)}var PY=null,gZ=!1,Xee=!1;function Qre(z){PY===null?PY=[z]:PY.push(z)}function Zre(z){gZ=!0,Qre(z)}function RJ(){if(!Xee&&PY!==null){Xee=!0;var z=0,C_=tK;try{var hN=PY;for(tK=1;z<hN.length;z++){var gN=hN[z];do gN=gN(!0);while(gN!==null)}PY=null,gZ=!1}catch(t3){throw PY!==null&&(PY=PY.slice(z+1)),vee(Cee,RJ),t3}finally{tK=C_,Xee=!1}}return null}var dX=[],lX=0,hX=null,TZ=0,g8=[],L4=0,o7=null,DY=1,kY="";function a7(z,C_){dX[lX++]=TZ,dX[lX++]=hX,hX=z,TZ=C_}function $re(z,C_,hN){g8[L4++]=DY,g8[L4++]=kY,g8[L4++]=o7,o7=z;var gN=DY;z=kY;var t3=32-E8(gN)-1;gN&=~(1<<t3),hN+=1;var sH=32-E8(C_)+t3;if(30<sH){var mH=t3-t3%5;sH=(gN&(1<<mH)-1).toString(32),gN>>=mH,t3-=mH,DY=1<<32-E8(C_)+t3|hN<<t3|gN,kY=sH+z}else DY=1<<sH|hN<<t3|gN,kY=z}function Qee(z){z.return!==null&&(a7(z,1),$re(z,1,0))}function pX(z){for(;z===hX;)hX=dX[--lX],dX[lX]=null,TZ=dX[--lX],dX[lX]=null;for(;z===o7;)o7=g8[--L4],g8[L4]=null,kY=g8[--L4],g8[L4]=null,DY=g8[--L4],g8[L4]=null}var J4=null,o8=null,RK=!1,T8=null;function eie(z,C_){var hN=Q4(5,null,null,0);hN.elementType="DELETED",hN.stateNode=C_,hN.return=z,C_=z.deletions,C_===null?(z.deletions=[hN],z.flags|=16):C_.push(hN)}function tie(z,C_){switch(z.tag){case 5:var hN=z.type;return C_=C_.nodeType!==1||hN.toLowerCase()!==C_.nodeName.toLowerCase()?null:C_,C_!==null?(z.stateNode=C_,J4=z,o8=OY(C_.firstChild),!0):!1;case 6:return C_=z.pendingProps===""||C_.nodeType!==3?null:C_,C_!==null?(z.stateNode=C_,J4=z,o8=null,!0):!1;case 13:return C_=C_.nodeType!==8?null:C_,C_!==null?(hN=o7!==null?{id:DY,overflow:kY}:null,z.memoizedState={dehydrated:C_,treeContext:hN,retryLane:1073741824},hN=Q4(18,null,null,0),hN.stateNode=C_,hN.return=z,z.child=hN,J4=z,o8=null,!0):!1;default:return!1}}function Zee(z){return(z.mode&1)!==0&&(z.flags&128)===0}function L9(z){if(RK){var C_=o8;if(C_){var hN=C_;if(!tie(z,C_)){if(Zee(z))throw Error(i(418));C_=OY(hN.nextSibling);var gN=J4;C_&&tie(z,C_)?eie(gN,hN):(z.flags=z.flags&-4097|2,RK=!1,J4=z)}}else{if(Zee(z))throw Error(i(418));z.flags=z.flags&-4097|2,RK=!1,J4=z}}}function SZ(z){for(z=z.return;z!==null&&z.tag!==5&&z.tag!==3&&z.tag!==13;)z=z.return;J4=z}function M9(z){if(z!==J4)return!1;if(!RK)return SZ(z),RK=!0,!1;var C_;if((C_=z.tag!==3)&&!(C_=z.tag!==5)&&(C_=z.type,C_=C_!=="head"&&C_!=="body"&&!pZ(z.type,z.memoizedProps)),C_&&(C_=o8)){if(Zee(z))throw yZ(),Error(i(418));for(;C_;)eie(z,C_),C_=OY(C_.nextSibling)}if(SZ(z),z.tag===13){if(z=z.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(i(317));e:{for(z=z.nextSibling,C_=0;z;){if(z.nodeType===8){var hN=z.data;if(hN==="/$"){if(C_===0){o8=OY(z.nextSibling);break e}C_--}else hN!=="$"&&hN!=="$!"&&hN!=="$?"||C_++}z=z.nextSibling}o8=null}}else o8=J4?OY(z.stateNode.nextSibling):null;return!0}function yZ(){for(var z=o8;z;)z=OY(z.nextSibling)}function c7(){o8=J4=null,RK=!1}function RZ(z){T8===null?T8=[z]:T8.push(z)}var bZ=pH.ReactCurrentBatchConfig;function LY(z,C_,hN){if(z=hN.ref,z!==null&&typeof z!="function"&&typeof z!="object"){if(hN._owner){if(hN=hN._owner,hN){if(hN.tag!==1)throw Error(i(309));var gN=hN.stateNode}if(!gN)throw Error(i(147,z));var t3=gN,sH=""+z;return C_!==null&&C_.ref!==null&&typeof C_.ref=="function"&&C_.ref._stringRef===sH?C_.ref:(C_=function(mH){var DH=t3.refs;mH===null?delete DH[sH]:DH[sH]=mH},C_._stringRef=sH,C_)}if(typeof z!="string")throw Error(i(284));if(!hN._owner)throw Error(i(290,z))}return z}function vZ(z,C_){throw z=Object.prototype.toString.call(C_),Error(i(31,z==="[object Object]"?"object with keys {"+Object.keys(C_).join(", ")+"}":z))}function nie(z){var C_=z._init;return C_(z._payload)}function $ee(z){function C_(QH,WH){if(z){var t5=QH.deletions;t5===null?(QH.deletions=[WH],QH.flags|=16):t5.push(WH)}}function hN(QH,WH){if(!z)return null;for(;WH!==null;)C_(QH,WH),WH=WH.sibling;return null}function gN(QH,WH){for(QH=new Map;WH!==null;)WH.key!==null?QH.set(WH.key,WH):QH.set(WH.index,WH),WH=WH.sibling;return QH}function t3(QH,WH){return QH=DJ(QH,WH),QH.index=0,QH.sibling=null,QH}function sH(QH,WH,t5){return QH.index=t5,z?(t5=QH.alternate,t5!==null?(t5=t5.index,t5<WH?(QH.flags|=2,WH):t5):(QH.flags|=2,WH)):(QH.flags|=1048576,WH)}function mH(QH){return z&&QH.alternate===null&&(QH.flags|=2),QH}function DH(QH,WH,t5,C5){return WH===null||WH.tag!==6?(WH=e$(t5,QH.mode,C5),WH.return=QH,WH):(WH=t3(WH,t5),WH.return=QH,WH)}function FH(QH,WH,t5,C5){var G5=t5.type;return G5===AH?R5(QH,WH,t5.props.children,C5,t5.key):WH!==null&&(WH.elementType===G5||typeof G5=="object"&&G5!==null&&G5.$$typeof===GH&&nie(G5)===WH.type)?(C5=t3(WH,t5.props),C5.ref=LY(QH,WH,t5),C5.return=QH,C5):(C5=$Z(t5.type,t5.key,t5.props,null,QH.mode,C5),C5.ref=LY(QH,WH,t5),C5.return=QH,C5)}function s5(QH,WH,t5,C5){return WH===null||WH.tag!==4||WH.stateNode.containerInfo!==t5.containerInfo||WH.stateNode.implementation!==t5.implementation?(WH=t$(t5,QH.mode,C5),WH.return=QH,WH):(WH=t3(WH,t5.children||[]),WH.return=QH,WH)}function R5(QH,WH,t5,C5,G5){return WH===null||WH.tag!==7?(WH=WY(t5,QH.mode,C5,G5),WH.return=QH,WH):(WH=t3(WH,t5),WH.return=QH,WH)}function b5(QH,WH,t5){if(typeof WH=="string"&&WH!==""||typeof WH=="number")return WH=e$(""+WH,QH.mode,t5),WH.return=QH,WH;if(typeof WH=="object"&&WH!==null){switch(WH.$$typeof){case SH:return t5=$Z(WH.type,WH.key,WH.props,null,QH.mode,t5),t5.ref=LY(QH,null,WH),t5.return=QH,t5;case vH:return WH=t$(WH,QH.mode,t5),WH.return=QH,WH;case GH:var C5=WH._init;return b5(QH,C5(WH._payload),t5)}if(g6(WH)||NH(WH))return WH=WY(WH,QH.mode,t5,null),WH.return=QH,WH;vZ(QH,WH)}return null}function S5(QH,WH,t5,C5){var G5=WH!==null?WH.key:null;if(typeof t5=="string"&&t5!==""||typeof t5=="number")return G5!==null?null:DH(QH,WH,""+t5,C5);if(typeof t5=="object"&&t5!==null){switch(t5.$$typeof){case SH:return t5.key===G5?FH(QH,WH,t5,C5):null;case vH:return t5.key===G5?s5(QH,WH,t5,C5):null;case GH:return G5=t5._init,S5(QH,WH,G5(t5._payload),C5)}if(g6(t5)||NH(t5))return G5!==null?null:R5(QH,WH,t5,C5,null);vZ(QH,t5)}return null}function L5(QH,WH,t5,C5,G5){if(typeof C5=="string"&&C5!==""||typeof C5=="number")return QH=QH.get(t5)||null,DH(WH,QH,""+C5,G5);if(typeof C5=="object"&&C5!==null){switch(C5.$$typeof){case SH:return QH=QH.get(C5.key===null?t5:C5.key)||null,FH(WH,QH,C5,G5);case vH:return QH=QH.get(C5.key===null?t5:C5.key)||null,s5(WH,QH,C5,G5);case GH:var t6=C5._init;return L5(QH,WH,t5,t6(C5._payload),G5)}if(g6(C5)||NH(C5))return QH=QH.get(t5)||null,R5(WH,QH,C5,G5,null);vZ(WH,C5)}return null}function V5(QH,WH,t5,C5){for(var G5=null,t6=null,Z5=WH,a6=WH=0,e4=null;Z5!==null&&a6<t5.length;a6++){Z5.index>a6?(e4=Z5,Z5=null):e4=Z5.sibling;var F6=S5(QH,Z5,t5[a6],C5);if(F6===null){Z5===null&&(Z5=e4);break}z&&Z5&&F6.alternate===null&&C_(QH,Z5),WH=sH(F6,WH,a6),t6===null?G5=F6:t6.sibling=F6,t6=F6,Z5=e4}if(a6===t5.length)return hN(QH,Z5),RK&&a7(QH,a6),G5;if(Z5===null){for(;a6<t5.length;a6++)Z5=b5(QH,t5[a6],C5),Z5!==null&&(WH=sH(Z5,WH,a6),t6===null?G5=Z5:t6.sibling=Z5,t6=Z5);return RK&&a7(QH,a6),G5}for(Z5=gN(QH,Z5);a6<t5.length;a6++)e4=L5(Z5,QH,a6,t5[a6],C5),e4!==null&&(z&&e4.alternate!==null&&Z5.delete(e4.key===null?a6:e4.key),WH=sH(e4,WH,a6),t6===null?G5=e4:t6.sibling=e4,t6=e4);return z&&Z5.forEach(function(G8){return C_(QH,G8)}),RK&&a7(QH,a6),G5}function j5(QH,WH,t5,C5){var G5=NH(t5);if(typeof G5!="function")throw Error(i(150));if(t5=G5.call(t5),t5==null)throw Error(i(151));for(var t6=G5=null,Z5=WH,a6=WH=0,e4=null,F6=t5.next();Z5!==null&&!F6.done;a6++,F6=t5.next()){Z5.index>a6?(e4=Z5,Z5=null):e4=Z5.sibling;var G8=S5(QH,Z5,F6.value,C5);if(G8===null){Z5===null&&(Z5=e4);break}z&&Z5&&G8.alternate===null&&C_(QH,Z5),WH=sH(G8,WH,a6),t6===null?G5=G8:t6.sibling=G8,t6=G8,Z5=e4}if(F6.done)return hN(QH,Z5),RK&&a7(QH,a6),G5;if(Z5===null){for(;!F6.done;a6++,F6=t5.next())F6=b5(QH,F6.value,C5),F6!==null&&(WH=sH(F6,WH,a6),t6===null?G5=F6:t6.sibling=F6,t6=F6);return RK&&a7(QH,a6),G5}for(Z5=gN(QH,Z5);!F6.done;a6++,F6=t5.next())F6=L5(Z5,QH,a6,F6.value,C5),F6!==null&&(z&&F6.alternate!==null&&Z5.delete(F6.key===null?a6:F6.key),WH=sH(F6,WH,a6),t6===null?G5=F6:t6.sibling=F6,t6=F6);return z&&Z5.forEach(function(Jie){return C_(QH,Jie)}),RK&&a7(QH,a6),G5}function VK(QH,WH,t5,C5){if(typeof t5=="object"&&t5!==null&&t5.type===AH&&t5.key===null&&(t5=t5.props.children),typeof t5=="object"&&t5!==null){switch(t5.$$typeof){case SH:e:{for(var G5=t5.key,t6=WH;t6!==null;){if(t6.key===G5){if(G5=t5.type,G5===AH){if(t6.tag===7){hN(QH,t6.sibling),WH=t3(t6,t5.props.children),WH.return=QH,QH=WH;break e}}else if(t6.elementType===G5||typeof G5=="object"&&G5!==null&&G5.$$typeof===GH&&nie(G5)===t6.type){hN(QH,t6.sibling),WH=t3(t6,t5.props),WH.ref=LY(QH,t6,t5),WH.return=QH,QH=WH;break e}hN(QH,t6);break}else C_(QH,t6);t6=t6.sibling}t5.type===AH?(WH=WY(t5.props.children,QH.mode,C5,t5.key),WH.return=QH,QH=WH):(C5=$Z(t5.type,t5.key,t5.props,null,QH.mode,C5),C5.ref=LY(QH,WH,t5),C5.return=QH,QH=C5)}return mH(QH);case vH:e:{for(t6=t5.key;WH!==null;){if(WH.key===t6)if(WH.tag===4&&WH.stateNode.containerInfo===t5.containerInfo&&WH.stateNode.implementation===t5.implementation){hN(QH,WH.sibling),WH=t3(WH,t5.children||[]),WH.return=QH,QH=WH;break e}else{hN(QH,WH);break}else C_(QH,WH);WH=WH.sibling}WH=t$(t5,QH.mode,C5),WH.return=QH,QH=WH}return mH(QH);case GH:return t6=t5._init,VK(QH,WH,t6(t5._payload),C5)}if(g6(t5))return V5(QH,WH,t5,C5);if(NH(t5))return j5(QH,WH,t5,C5);vZ(QH,t5)}return typeof t5=="string"&&t5!==""||typeof t5=="number"?(t5=""+t5,WH!==null&&WH.tag===6?(hN(QH,WH.sibling),WH=t3(WH,t5),WH.return=QH,QH=WH):(hN(QH,WH),WH=e$(t5,QH.mode,C5),WH.return=QH,QH=WH),mH(QH)):hN(QH,WH)}return VK}var fX=$ee(!0),rie=$ee(!1),U9=M8(null),CZ=null,_X=null,ete=null;function tte(){ete=_X=CZ=null}function nte(z){var C_=U9.current;rK(U9),z._currentValue=C_}function rte(z,C_,hN){for(;z!==null;){var gN=z.alternate;if((z.childLanes&C_)!==C_?(z.childLanes|=C_,gN!==null&&(gN.childLanes|=C_)):gN!==null&&(gN.childLanes&C_)!==C_&&(gN.childLanes|=C_),z===hN)break;z=z.return}}function u7(z,C_){CZ=z,ete=_X=null,z=z.dependencies,z!==null&&z.firstContext!==null&&(z.lanes&C_&&(X4=!0),z.firstContext=null)}function a4(z){var C_=z._currentValue;if(ete!==z)if(z={context:z,memoizedValue:C_,next:null},_X===null){if(CZ===null)throw Error(i(308));_X=z,CZ.dependencies={lanes:0,firstContext:z}}else _X=_X.next=z;return C_}var d7=null;function ite(z){d7===null?d7=[z]:d7.push(z)}function iie(z,C_,hN,gN){var t3=C_.interleaved;return t3===null?(hN.next=hN,ite(C_)):(hN.next=t3.next,t3.next=hN),C_.interleaved=hN,tY(z,gN)}function tY(z,C_){z.lanes|=C_;var hN=z.alternate;for(hN!==null&&(hN.lanes|=C_),hN=z,z=z.return;z!==null;)z.childLanes|=C_,hN=z.alternate,hN!==null&&(hN.childLanes|=C_),hN=z,z=z.return;return hN.tag===3?hN.stateNode:null}var bJ=!1;function IZ(z){z.updateQueue={baseState:z.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sie(z,C_){z=z.updateQueue,C_.updateQueue===z&&(C_.updateQueue={baseState:z.baseState,firstBaseUpdate:z.firstBaseUpdate,lastBaseUpdate:z.lastBaseUpdate,shared:z.shared,effects:z.effects})}function MY(z,C_){return{eventTime:z,lane:C_,tag:0,payload:null,callback:null,next:null}}function vJ(z,C_,hN){var gN=z.updateQueue;if(gN===null)return null;if(gN=gN.shared,P6&2){var t3=gN.pending;return t3===null?C_.next=C_:(C_.next=t3.next,t3.next=C_),gN.pending=C_,tY(z,hN)}return t3=gN.interleaved,t3===null?(C_.next=C_,ite(gN)):(C_.next=t3.next,t3.next=C_),gN.interleaved=C_,tY(z,hN)}function l7(z,C_,hN){if(C_=C_.updateQueue,C_!==null&&(C_=C_.shared,(hN&4194240)!==0)){var gN=C_.lanes;gN&=z.pendingLanes,hN|=gN,C_.lanes=hN,wee(z,hN)}}function oie(z,C_){var hN=z.updateQueue,gN=z.alternate;if(gN!==null&&(gN=gN.updateQueue,hN===gN)){var t3=null,sH=null;if(hN=hN.firstBaseUpdate,hN!==null){do{var mH={eventTime:hN.eventTime,lane:hN.lane,tag:hN.tag,payload:hN.payload,callback:hN.callback,next:null};sH===null?t3=sH=mH:sH=sH.next=mH,hN=hN.next}while(hN!==null);sH===null?t3=sH=C_:sH=sH.next=C_}else t3=sH=C_;hN={baseState:gN.baseState,firstBaseUpdate:t3,lastBaseUpdate:sH,shared:gN.shared,effects:gN.effects},z.updateQueue=hN;return}z=hN.lastBaseUpdate,z===null?hN.firstBaseUpdate=C_:z.next=C_,hN.lastBaseUpdate=C_}function wZ(z,C_,hN,gN){var t3=z.updateQueue;bJ=!1;var sH=t3.firstBaseUpdate,mH=t3.lastBaseUpdate,DH=t3.shared.pending;if(DH!==null){t3.shared.pending=null;var FH=DH,s5=FH.next;FH.next=null,mH===null?sH=s5:mH.next=s5,mH=FH;var R5=z.alternate;R5!==null&&(R5=R5.updateQueue,DH=R5.lastBaseUpdate,DH!==mH&&(DH===null?R5.firstBaseUpdate=s5:DH.next=s5,R5.lastBaseUpdate=FH))}if(sH!==null){var b5=t3.baseState;mH=0,R5=s5=FH=null,DH=sH;do{var S5=DH.lane,L5=DH.eventTime;if((gN&S5)===S5){R5!==null&&(R5=R5.next={eventTime:L5,lane:0,tag:DH.tag,payload:DH.payload,callback:DH.callback,next:null});e:{var V5=z,j5=DH;switch(S5=C_,L5=hN,j5.tag){case 1:if(V5=j5.payload,typeof V5=="function"){b5=V5.call(L5,b5,S5);break e}b5=V5;break e;case 3:V5.flags=V5.flags&-65537|128;case 0:if(V5=j5.payload,S5=typeof V5=="function"?V5.call(L5,b5,S5):V5,S5==null)break e;b5=gH({},b5,S5);break e;case 2:bJ=!0}}DH.callback!==null&&DH.lane!==0&&(z.flags|=64,S5=t3.effects,S5===null?t3.effects=[DH]:S5.push(DH))}else L5={eventTime:L5,lane:S5,tag:DH.tag,payload:DH.payload,callback:DH.callback,next:null},R5===null?(s5=R5=L5,FH=b5):R5=R5.next=L5,mH|=S5;if(DH=DH.next,DH===null){if(DH=t3.shared.pending,DH===null)break;S5=DH,DH=S5.next,S5.next=null,t3.lastBaseUpdate=S5,t3.shared.pending=null}}while(!0);if(R5===null&&(FH=b5),t3.baseState=FH,t3.firstBaseUpdate=s5,t3.lastBaseUpdate=R5,C_=t3.shared.interleaved,C_!==null){t3=C_;do mH|=t3.lane,t3=t3.next;while(t3!==C_)}else sH===null&&(t3.shared.lanes=0);wJ|=mH,z.lanes=mH,z.memoizedState=b5}}function aie(z,C_,hN){if(z=C_.effects,C_.effects=null,z!==null)for(C_=0;C_<z.length;C_++){var gN=z[C_],t3=gN.callback;if(t3!==null){if(gN.callback=null,gN=hN,typeof t3!="function")throw Error(i(191,t3));t3.call(gN)}}}var x9={},nY=M8(x9),V9=M8(x9),h7=M8(x9);function p7(z){if(z===x9)throw Error(i(174));return z}function AZ(z,C_){switch(iK(h7,C_),iK(V9,z),iK(nY,x9),z=C_.nodeType,z){case 9:case 11:C_=(C_=C_.documentElement)?C_.namespaceURI:k8(null,"");break;default:z=z===8?C_.parentNode:C_,C_=z.namespaceURI||null,z=z.tagName,C_=k8(C_,z)}rK(nY),iK(nY,C_)}function EX(){rK(nY),rK(V9),rK(h7)}function ste(z){p7(h7.current);var C_=p7(nY.current),hN=k8(C_,z.type);C_!==hN&&(iK(V9,z),iK(nY,hN))}function ote(z){V9.current===z&&(rK(nY),rK(V9))}var CK=M8(0);function OZ(z){for(var C_=z;C_!==null;){if(C_.tag===13){var hN=C_.memoizedState;if(hN!==null&&(hN=hN.dehydrated,hN===null||hN.data==="$?"||hN.data==="$!"))return C_}else if(C_.tag===19&&C_.memoizedProps.revealOrder!==void 0){if(C_.flags&128)return C_}else if(C_.child!==null){C_.child.return=C_,C_=C_.child;continue}if(C_===z)break;for(;C_.sibling===null;){if(C_.return===null||C_.return===z)return null;C_=C_.return}C_.sibling.return=C_.return,C_=C_.sibling}return null}var ate=[];function cte(){for(var z=0;z<ate.length;z++)ate[z]._workInProgressVersionPrimary=null;ate.length=0}var NZ=pH.ReactCurrentDispatcher,PZ=pH.ReactCurrentBatchConfig,f7=0,IK=null,qK=null,c4=null,_7=!1,mX=!1,UY=0,ace=0;function S4(){throw Error(i(321))}function ute(z,C_){if(C_===null)return!1;for(var hN=0;hN<C_.length&&hN<z.length;hN++)if(!L8(z[hN],C_[hN]))return!1;return!0}function dte(z,C_,hN,gN,t3,sH){if(f7=sH,IK=C_,C_.memoizedState=null,C_.updateQueue=null,C_.lanes=0,NZ.current=z===null||z.memoizedState===null?Tte:cce,z=hN(gN,t3),mX){sH=0;do{if(mX=!1,UY=0,25<=sH)throw Error(i(301));sH+=1,c4=qK=null,C_.updateQueue=null,NZ.current=gie,z=hN(gN,t3)}while(mX)}if(NZ.current=sY,C_=qK!==null&&qK.next!==null,f7=0,c4=qK=IK=null,_7=!1,C_)throw Error(i(300));return z}function gX(){var z=UY!==0;return UY=0,z}function rY(){var z={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return c4===null?IK.memoizedState=c4=z:c4=c4.next=z,c4}function a8(){if(qK===null){var z=IK.alternate;z=z!==null?z.memoizedState:null}else z=qK.next;var C_=c4===null?IK.memoizedState:c4.next;if(C_!==null)c4=C_,qK=z;else{if(z===null)throw Error(i(310));qK=z,z={memoizedState:qK.memoizedState,baseState:qK.baseState,baseQueue:qK.baseQueue,queue:qK.queue,next:null},c4===null?IK.memoizedState=c4=z:c4=c4.next=z}return c4}function E7(z,C_){return typeof C_=="function"?C_(z):C_}function F9(z){var C_=a8(),hN=C_.queue;if(hN===null)throw Error(i(311));hN.lastRenderedReducer=z;var gN=qK,t3=gN.baseQueue,sH=hN.pending;if(sH!==null){if(t3!==null){var mH=t3.next;t3.next=sH.next,sH.next=mH}gN.baseQueue=t3=sH,hN.pending=null}if(t3!==null){sH=t3.next,gN=gN.baseState;var DH=mH=null,FH=null,s5=sH;do{var R5=s5.lane;if((f7&R5)===R5)FH!==null&&(FH=FH.next={lane:0,action:s5.action,hasEagerState:s5.hasEagerState,eagerState:s5.eagerState,next:null}),gN=s5.hasEagerState?s5.eagerState:z(gN,s5.action);else{var b5={lane:R5,action:s5.action,hasEagerState:s5.hasEagerState,eagerState:s5.eagerState,next:null};FH===null?(DH=FH=b5,mH=gN):FH=FH.next=b5,IK.lanes|=R5,wJ|=R5}s5=s5.next}while(s5!==null&&s5!==sH);FH===null?mH=gN:FH.next=DH,L8(gN,C_.memoizedState)||(X4=!0),C_.memoizedState=gN,C_.baseState=mH,C_.baseQueue=FH,hN.lastRenderedState=gN}if(z=hN.interleaved,z!==null){t3=z;do sH=t3.lane,IK.lanes|=sH,wJ|=sH,t3=t3.next;while(t3!==z)}else t3===null&&(hN.lanes=0);return[C_.memoizedState,hN.dispatch]}function lte(z){var C_=a8(),hN=C_.queue;if(hN===null)throw Error(i(311));hN.lastRenderedReducer=z;var gN=hN.dispatch,t3=hN.pending,sH=C_.memoizedState;if(t3!==null){hN.pending=null;var mH=t3=t3.next;do sH=z(sH,mH.action),mH=mH.next;while(mH!==t3);L8(sH,C_.memoizedState)||(X4=!0),C_.memoizedState=sH,C_.baseQueue===null&&(C_.baseState=sH),hN.lastRenderedState=sH}return[sH,gN]}function cie(){}function uie(z,C_){var hN=IK,gN=a8(),t3=C_(),sH=!L8(gN.memoizedState,t3);if(sH&&(gN.memoizedState=t3,X4=!0),gN=gN.queue,pte(j9.bind(null,hN,gN,z),[z]),gN.getSnapshot!==C_||sH||c4!==null&&c4.memoizedState.tag&1){if(hN.flags|=2048,CJ(9,lie.bind(null,hN,gN,t3,C_),void 0,null),wK===null)throw Error(i(349));f7&30||die(hN,C_,t3)}return t3}function die(z,C_,hN){z.flags|=16384,z={getSnapshot:C_,value:hN},C_=IK.updateQueue,C_===null?(C_={lastEffect:null,stores:null},IK.updateQueue=C_,C_.stores=[z]):(hN=C_.stores,hN===null?C_.stores=[z]:hN.push(z))}function lie(z,C_,hN,gN){C_.value=hN,C_.getSnapshot=gN,hie(C_)&&m7(z)}function j9(z,C_,hN){return hN(function(){hie(C_)&&m7(z)})}function hie(z){var C_=z.getSnapshot;z=z.value;try{var hN=C_();return!L8(z,hN)}catch{return!0}}function m7(z){var C_=tY(z,1);C_!==null&&j8(C_,z,1,-1)}function DZ(z){var C_=rY();return typeof z=="function"&&(z=z()),C_.memoizedState=C_.baseState=z,z={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:E7,lastRenderedState:z},C_.queue=z,z=z.dispatch=SX.bind(null,IK,z),[C_.memoizedState,z]}function CJ(z,C_,hN,gN){return z={tag:z,create:C_,destroy:hN,deps:gN,next:null},C_=IK.updateQueue,C_===null?(C_={lastEffect:null,stores:null},IK.updateQueue=C_,C_.lastEffect=z.next=z):(hN=C_.lastEffect,hN===null?C_.lastEffect=z.next=z:(gN=hN.next,hN.next=z,z.next=gN,C_.lastEffect=z)),z}function TX(){return a8().memoizedState}function g7(z,C_,hN,gN){var t3=rY();IK.flags|=z,t3.memoizedState=CJ(1|C_,hN,void 0,gN===void 0?null:gN)}function kZ(z,C_,hN,gN){var t3=a8();gN=gN===void 0?null:gN;var sH=void 0;if(qK!==null){var mH=qK.memoizedState;if(sH=mH.destroy,gN!==null&&ute(gN,mH.deps)){t3.memoizedState=CJ(C_,hN,sH,gN);return}}IK.flags|=z,t3.memoizedState=CJ(1|C_,hN,sH,gN)}function hte(z,C_){return g7(8390656,8,z,C_)}function pte(z,C_){return kZ(2048,8,z,C_)}function fte(z,C_){return kZ(4,2,z,C_)}function pie(z,C_){return kZ(4,4,z,C_)}function fie(z,C_){if(typeof C_=="function")return z=z(),C_(z),function(){C_(null)};if(C_!=null)return z=z(),C_.current=z,function(){C_.current=null}}function LZ(z,C_,hN){return hN=hN!=null?hN.concat([z]):null,kZ(4,4,fie.bind(null,C_,z),hN)}function B9(){}function _ie(z,C_){var hN=a8();C_=C_===void 0?null:C_;var gN=hN.memoizedState;return gN!==null&&C_!==null&&ute(C_,gN[1])?gN[0]:(hN.memoizedState=[z,C_],z)}function Eie(z,C_){var hN=a8();C_=C_===void 0?null:C_;var gN=hN.memoizedState;return gN!==null&&C_!==null&&ute(C_,gN[1])?gN[0]:(z=z(),hN.memoizedState=[z,C_],z)}function _te(z,C_,hN){return f7&21?(L8(hN,C_)||(hN=Rre(),IK.lanes|=hN,wJ|=hN,z.baseState=!0),C_):(z.baseState&&(z.baseState=!1,X4=!0),z.memoizedState=hN)}function Ete(z,C_){var hN=tK;tK=hN!==0&&4>hN?hN:4,z(!0);var gN=PZ.transition;PZ.transition={};try{z(!1),C_()}finally{tK=hN,PZ.transition=gN}}function mie(){return a8().memoizedState}function iY(z,C_,hN){var gN=OJ(z);if(hN={lane:gN,action:hN,hasEagerState:!1,eagerState:null,next:null},IJ(z))mte(C_,hN);else if(hN=iie(z,C_,hN,gN),hN!==null){var t3=V4();j8(hN,z,gN,t3),gte(hN,C_,gN)}}function SX(z,C_,hN){var gN=OJ(z),t3={lane:gN,action:hN,hasEagerState:!1,eagerState:null,next:null};if(IJ(z))mte(C_,t3);else{var sH=z.alternate;if(z.lanes===0&&(sH===null||sH.lanes===0)&&(sH=C_.lastRenderedReducer,sH!==null))try{var mH=C_.lastRenderedState,DH=sH(mH,hN);if(t3.hasEagerState=!0,t3.eagerState=DH,L8(DH,mH)){var FH=C_.interleaved;FH===null?(t3.next=t3,ite(C_)):(t3.next=FH.next,FH.next=t3),C_.interleaved=t3;return}}catch{}finally{}hN=iie(z,C_,t3,gN),hN!==null&&(t3=V4(),j8(hN,z,gN,t3),gte(hN,C_,gN))}}function IJ(z){var C_=z.alternate;return z===IK||C_!==null&&C_===IK}function mte(z,C_){mX=_7=!0;var hN=z.pending;hN===null?C_.next=C_:(C_.next=hN.next,hN.next=C_),z.pending=C_}function gte(z,C_,hN){if(hN&4194240){var gN=C_.lanes;gN&=z.pendingLanes,hN|=gN,C_.lanes=hN,wee(z,hN)}}var sY={readContext:a4,useCallback:S4,useContext:S4,useEffect:S4,useImperativeHandle:S4,useInsertionEffect:S4,useLayoutEffect:S4,useMemo:S4,useReducer:S4,useRef:S4,useState:S4,useDebugValue:S4,useDeferredValue:S4,useTransition:S4,useMutableSource:S4,useSyncExternalStore:S4,useId:S4,unstable_isNewReconciler:!1},Tte={readContext:a4,useCallback:function(z,C_){return rY().memoizedState=[z,C_===void 0?null:C_],z},useContext:a4,useEffect:hte,useImperativeHandle:function(z,C_,hN){return hN=hN!=null?hN.concat([z]):null,g7(4194308,4,fie.bind(null,C_,z),hN)},useLayoutEffect:function(z,C_){return g7(4194308,4,z,C_)},useInsertionEffect:function(z,C_){return g7(4,2,z,C_)},useMemo:function(z,C_){var hN=rY();return C_=C_===void 0?null:C_,z=z(),hN.memoizedState=[z,C_],z},useReducer:function(z,C_,hN){var gN=rY();return C_=hN!==void 0?hN(C_):C_,gN.memoizedState=gN.baseState=C_,z={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:z,lastRenderedState:C_},gN.queue=z,z=z.dispatch=iY.bind(null,IK,z),[gN.memoizedState,z]},useRef:function(z){var C_=rY();return z={current:z},C_.memoizedState=z},useState:DZ,useDebugValue:B9,useDeferredValue:function(z){return rY().memoizedState=z},useTransition:function(){var z=DZ(!1),C_=z[0];return z=Ete.bind(null,z[1]),rY().memoizedState=z,[C_,z]},useMutableSource:function(){},useSyncExternalStore:function(z,C_,hN){var gN=IK,t3=rY();if(RK){if(hN===void 0)throw Error(i(407));hN=hN()}else{if(hN=C_(),wK===null)throw Error(i(349));f7&30||die(gN,C_,hN)}t3.memoizedState=hN;var sH={value:hN,getSnapshot:C_};return t3.queue=sH,hte(j9.bind(null,gN,sH,z),[z]),gN.flags|=2048,CJ(9,lie.bind(null,gN,sH,hN,C_),void 0,null),hN},useId:function(){var z=rY(),C_=wK.identifierPrefix;if(RK){var hN=kY,gN=DY;hN=(gN&~(1<<32-E8(gN)-1)).toString(32)+hN,C_=":"+C_+"R"+hN,hN=UY++,0<hN&&(C_+="H"+hN.toString(32)),C_+=":"}else hN=ace++,C_=":"+C_+"r"+hN.toString(32)+":";return z.memoizedState=C_},unstable_isNewReconciler:!1},cce={readContext:a4,useCallback:_ie,useContext:a4,useEffect:pte,useImperativeHandle:LZ,useInsertionEffect:fte,useLayoutEffect:pie,useMemo:Eie,useReducer:F9,useRef:TX,useState:function(){return F9(E7)},useDebugValue:B9,useDeferredValue:function(z){var C_=a8();return _te(C_,qK.memoizedState,z)},useTransition:function(){var z=F9(E7)[0],C_=a8().memoizedState;return[z,C_]},useMutableSource:cie,useSyncExternalStore:uie,useId:mie,unstable_isNewReconciler:!1},gie={readContext:a4,useCallback:_ie,useContext:a4,useEffect:pte,useImperativeHandle:LZ,useInsertionEffect:fte,useLayoutEffect:pie,useMemo:Eie,useReducer:lte,useRef:TX,useState:function(){return lte(E7)},useDebugValue:B9,useDeferredValue:function(z){var C_=a8();return qK===null?C_.memoizedState=z:_te(C_,qK.memoizedState,z)},useTransition:function(){var z=lte(E7)[0],C_=a8().memoizedState;return[z,C_]},useMutableSource:cie,useSyncExternalStore:uie,useId:mie,unstable_isNewReconciler:!1};function U8(z,C_){if(z&&z.defaultProps){C_=gH({},C_),z=z.defaultProps;for(var hN in z)C_[hN]===void 0&&(C_[hN]=z[hN]);return C_}return C_}function G9(z,C_,hN,gN){C_=z.memoizedState,hN=hN(gN,C_),hN=hN==null?C_:gH({},C_,hN),z.memoizedState=hN,z.lanes===0&&(z.updateQueue.baseState=hN)}var W9={isMounted:function(z){return(z=z._reactInternals)?e7(z)===z:!1},enqueueSetState:function(z,C_,hN){z=z._reactInternals;var gN=V4(),t3=OJ(z),sH=MY(gN,t3);sH.payload=C_,hN!=null&&(sH.callback=hN),C_=vJ(z,sH,t3),C_!==null&&(j8(C_,z,t3,gN),l7(C_,z,t3))},enqueueReplaceState:function(z,C_,hN){z=z._reactInternals;var gN=V4(),t3=OJ(z),sH=MY(gN,t3);sH.tag=1,sH.payload=C_,hN!=null&&(sH.callback=hN),C_=vJ(z,sH,t3),C_!==null&&(j8(C_,z,t3,gN),l7(C_,z,t3))},enqueueForceUpdate:function(z,C_){z=z._reactInternals;var hN=V4(),gN=OJ(z),t3=MY(hN,gN);t3.tag=2,C_!=null&&(t3.callback=C_),C_=vJ(z,t3,gN),C_!==null&&(j8(C_,z,gN,hN),l7(C_,z,gN))}};function Tie(z,C_,hN,gN,t3,sH,mH){return z=z.stateNode,typeof z.shouldComponentUpdate=="function"?z.shouldComponentUpdate(gN,sH,mH):C_.prototype&&C_.prototype.isPureReactComponent?!R9(hN,gN)||!R9(t3,sH):!0}function xY(z,C_,hN){var gN=!1,t3=SJ,sH=C_.contextType;return typeof sH=="object"&&sH!==null?sH=a4(sH):(t3=T4(C_)?yJ:g4.current,gN=C_.contextTypes,sH=(gN=gN!=null)?s7(z,t3):SJ),C_=new C_(hN,sH),z.memoizedState=C_.state!==null&&C_.state!==void 0?C_.state:null,C_.updater=W9,z.stateNode=C_,C_._reactInternals=z,gN&&(z=z.stateNode,z.__reactInternalMemoizedUnmaskedChildContext=t3,z.__reactInternalMemoizedMaskedChildContext=sH),C_}function Sie(z,C_,hN,gN){z=C_.state,typeof C_.componentWillReceiveProps=="function"&&C_.componentWillReceiveProps(hN,gN),typeof C_.UNSAFE_componentWillReceiveProps=="function"&&C_.UNSAFE_componentWillReceiveProps(hN,gN),C_.state!==z&&W9.enqueueReplaceState(C_,C_.state,null)}function Ste(z,C_,hN,gN){var t3=z.stateNode;t3.props=hN,t3.state=z.memoizedState,t3.refs={},IZ(z);var sH=C_.contextType;typeof sH=="object"&&sH!==null?t3.context=a4(sH):(sH=T4(C_)?yJ:g4.current,t3.context=s7(z,sH)),t3.state=z.memoizedState,sH=C_.getDerivedStateFromProps,typeof sH=="function"&&(G9(z,C_,sH,hN),t3.state=z.memoizedState),typeof C_.getDerivedStateFromProps=="function"||typeof t3.getSnapshotBeforeUpdate=="function"||typeof t3.UNSAFE_componentWillMount!="function"&&typeof t3.componentWillMount!="function"||(C_=t3.state,typeof t3.componentWillMount=="function"&&t3.componentWillMount(),typeof t3.UNSAFE_componentWillMount=="function"&&t3.UNSAFE_componentWillMount(),C_!==t3.state&&W9.enqueueReplaceState(t3,t3.state,null),wZ(z,hN,t3,gN),t3.state=z.memoizedState),typeof t3.componentDidMount=="function"&&(z.flags|=4194308)}function yX(z,C_){try{var hN="",gN=C_;do hN+=l5(gN),gN=gN.return;while(gN);var t3=hN}catch(sH){t3=`
Error generating stack: `+sH.message+`
`+sH.stack}return{value:z,source:C_,stack:t3,digest:null}}function yte(z,C_,hN){return{value:z,source:null,stack:hN??null,digest:C_??null}}function MZ(z,C_){try{console.error(C_.value)}catch(hN){setTimeout(function(){throw hN})}}var uce=typeof WeakMap=="function"?WeakMap:Map;function UZ(z,C_,hN){hN=MY(-1,hN),hN.tag=3,hN.payload={element:null};var gN=C_.value;return hN.callback=function(){Z9||(Z9=!0,x4=gN),MZ(z,C_)},hN}function Rte(z,C_,hN){hN=MY(-1,hN),hN.tag=3;var gN=z.type.getDerivedStateFromError;if(typeof gN=="function"){var t3=C_.value;hN.payload=function(){return gN(t3)},hN.callback=function(){MZ(z,C_)}}var sH=z.stateNode;return sH!==null&&typeof sH.componentDidCatch=="function"&&(hN.callback=function(){MZ(z,C_),typeof gN!="function"&&(AJ===null?AJ=new Set([this]):AJ.add(this));var mH=C_.stack;this.componentDidCatch(C_.value,{componentStack:mH!==null?mH:""})}),hN}function yie(z,C_,hN){var gN=z.pingCache;if(gN===null){gN=z.pingCache=new uce;var t3=new Set;gN.set(C_,t3)}else t3=gN.get(C_),t3===void 0&&(t3=new Set,gN.set(C_,t3));t3.has(hN)||(t3.add(hN),z=Gie.bind(null,z,C_,hN),C_.then(z,z))}function bte(z){do{var C_;if((C_=z.tag===13)&&(C_=z.memoizedState,C_=C_!==null?C_.dehydrated!==null:!0),C_)return z;z=z.return}while(z!==null);return null}function Rie(z,C_,hN,gN,t3){return z.mode&1?(z.flags|=65536,z.lanes=t3,z):(z===C_?z.flags|=65536:(z.flags|=128,hN.flags|=131072,hN.flags&=-52805,hN.tag===1&&(hN.alternate===null?hN.tag=17:(C_=MY(-1,1),C_.tag=2,vJ(hN,C_,1))),hN.lanes|=1),z)}var dce=pH.ReactCurrentOwner,X4=!1;function M4(z,C_,hN,gN){C_.child=z===null?rie(C_,null,hN,gN):fX(C_,z.child,hN,gN)}function bie(z,C_,hN,gN,t3){hN=hN.render;var sH=C_.ref;return u7(C_,t3),gN=dte(z,C_,hN,gN,sH,t3),hN=gX(),z!==null&&!X4?(C_.updateQueue=z.updateQueue,C_.flags&=-2053,z.lanes&=~t3,VY(z,C_,t3)):(RK&&hN&&Qee(C_),C_.flags|=1,M4(z,C_,gN,t3),C_.child)}function vie(z,C_,hN,gN,t3){if(z===null){var sH=hN.type;return typeof sH=="function"&&!Hte(sH)&&sH.defaultProps===void 0&&hN.compare===null&&hN.defaultProps===void 0?(C_.tag=15,C_.type=sH,Cie(z,C_,sH,gN,t3)):(z=$Z(hN.type,null,gN,C_,C_.mode,t3),z.ref=C_.ref,z.return=C_,C_.child=z)}if(sH=z.child,!(z.lanes&t3)){var mH=sH.memoizedProps;if(hN=hN.compare,hN=hN!==null?hN:R9,hN(mH,gN)&&z.ref===C_.ref)return VY(z,C_,t3)}return C_.flags|=1,z=DJ(sH,gN),z.ref=C_.ref,z.return=C_,C_.child=z}function Cie(z,C_,hN,gN,t3){if(z!==null){var sH=z.memoizedProps;if(R9(sH,gN)&&z.ref===C_.ref)if(X4=!1,C_.pendingProps=gN=sH,(z.lanes&t3)!==0)z.flags&131072&&(X4=!0);else return C_.lanes=z.lanes,VY(z,C_,t3)}return Cte(z,C_,hN,gN,t3)}function vte(z,C_,hN){var gN=C_.pendingProps,t3=gN.children,sH=z!==null?z.memoizedState:null;if(gN.mode==="hidden")if(!(C_.mode&1))C_.memoizedState={baseLanes:0,cachePool:null,transitions:null},iK(bX,R4),R4|=hN;else{if(!(hN&1073741824))return z=sH!==null?sH.baseLanes|hN:hN,C_.lanes=C_.childLanes=1073741824,C_.memoizedState={baseLanes:z,cachePool:null,transitions:null},C_.updateQueue=null,iK(bX,R4),R4|=z,null;C_.memoizedState={baseLanes:0,cachePool:null,transitions:null},gN=sH!==null?sH.baseLanes:hN,iK(bX,R4),R4|=gN}else sH!==null?(gN=sH.baseLanes|hN,C_.memoizedState=null):gN=hN,iK(bX,R4),R4|=gN;return M4(z,C_,t3,hN),C_.child}function oY(z,C_){var hN=C_.ref;(z===null&&hN!==null||z!==null&&z.ref!==hN)&&(C_.flags|=512,C_.flags|=2097152)}function Cte(z,C_,hN,gN,t3){var sH=T4(hN)?yJ:g4.current;return sH=s7(C_,sH),u7(C_,t3),hN=dte(z,C_,hN,gN,sH,t3),gN=gX(),z!==null&&!X4?(C_.updateQueue=z.updateQueue,C_.flags&=-2053,z.lanes&=~t3,VY(z,C_,t3)):(RK&&gN&&Qee(C_),C_.flags|=1,M4(z,C_,hN,t3),C_.child)}function Iie(z,C_,hN,gN,t3){if(T4(hN)){var sH=!0;mZ(C_)}else sH=!1;if(u7(C_,t3),C_.stateNode===null)q9(z,C_),xY(C_,hN,gN),Ste(C_,hN,gN,t3),gN=!0;else if(z===null){var mH=C_.stateNode,DH=C_.memoizedProps;mH.props=DH;var FH=mH.context,s5=hN.contextType;typeof s5=="object"&&s5!==null?s5=a4(s5):(s5=T4(hN)?yJ:g4.current,s5=s7(C_,s5));var R5=hN.getDerivedStateFromProps,b5=typeof R5=="function"||typeof mH.getSnapshotBeforeUpdate=="function";b5||typeof mH.UNSAFE_componentWillReceiveProps!="function"&&typeof mH.componentWillReceiveProps!="function"||(DH!==gN||FH!==s5)&&Sie(C_,mH,gN,s5),bJ=!1;var S5=C_.memoizedState;mH.state=S5,wZ(C_,gN,mH,t3),FH=C_.memoizedState,DH!==gN||S5!==FH||Y4.current||bJ?(typeof R5=="function"&&(G9(C_,hN,R5,gN),FH=C_.memoizedState),(DH=bJ||Tie(C_,hN,DH,gN,S5,FH,s5))?(b5||typeof mH.UNSAFE_componentWillMount!="function"&&typeof mH.componentWillMount!="function"||(typeof mH.componentWillMount=="function"&&mH.componentWillMount(),typeof mH.UNSAFE_componentWillMount=="function"&&mH.UNSAFE_componentWillMount()),typeof mH.componentDidMount=="function"&&(C_.flags|=4194308)):(typeof mH.componentDidMount=="function"&&(C_.flags|=4194308),C_.memoizedProps=gN,C_.memoizedState=FH),mH.props=gN,mH.state=FH,mH.context=s5,gN=DH):(typeof mH.componentDidMount=="function"&&(C_.flags|=4194308),gN=!1)}else{mH=C_.stateNode,sie(z,C_),DH=C_.memoizedProps,s5=C_.type===C_.elementType?DH:U8(C_.type,DH),mH.props=s5,b5=C_.pendingProps,S5=mH.context,FH=hN.contextType,typeof FH=="object"&&FH!==null?FH=a4(FH):(FH=T4(hN)?yJ:g4.current,FH=s7(C_,FH));var L5=hN.getDerivedStateFromProps;(R5=typeof L5=="function"||typeof mH.getSnapshotBeforeUpdate=="function")||typeof mH.UNSAFE_componentWillReceiveProps!="function"&&typeof mH.componentWillReceiveProps!="function"||(DH!==b5||S5!==FH)&&Sie(C_,mH,gN,FH),bJ=!1,S5=C_.memoizedState,mH.state=S5,wZ(C_,gN,mH,t3);var V5=C_.memoizedState;DH!==b5||S5!==V5||Y4.current||bJ?(typeof L5=="function"&&(G9(C_,hN,L5,gN),V5=C_.memoizedState),(s5=bJ||Tie(C_,hN,s5,gN,S5,V5,FH)||!1)?(R5||typeof mH.UNSAFE_componentWillUpdate!="function"&&typeof mH.componentWillUpdate!="function"||(typeof mH.componentWillUpdate=="function"&&mH.componentWillUpdate(gN,V5,FH),typeof mH.UNSAFE_componentWillUpdate=="function"&&mH.UNSAFE_componentWillUpdate(gN,V5,FH)),typeof mH.componentDidUpdate=="function"&&(C_.flags|=4),typeof mH.getSnapshotBeforeUpdate=="function"&&(C_.flags|=1024)):(typeof mH.componentDidUpdate!="function"||DH===z.memoizedProps&&S5===z.memoizedState||(C_.flags|=4),typeof mH.getSnapshotBeforeUpdate!="function"||DH===z.memoizedProps&&S5===z.memoizedState||(C_.flags|=1024),C_.memoizedProps=gN,C_.memoizedState=V5),mH.props=gN,mH.state=V5,mH.context=FH,gN=s5):(typeof mH.componentDidUpdate!="function"||DH===z.memoizedProps&&S5===z.memoizedState||(C_.flags|=4),typeof mH.getSnapshotBeforeUpdate!="function"||DH===z.memoizedProps&&S5===z.memoizedState||(C_.flags|=1024),gN=!1)}return Ite(z,C_,hN,gN,sH,t3)}function Ite(z,C_,hN,gN,t3,sH){oY(z,C_);var mH=(C_.flags&128)!==0;if(!gN&&!mH)return t3&&Xre(C_,hN,!1),VY(z,C_,sH);gN=C_.stateNode,dce.current=C_;var DH=mH&&typeof hN.getDerivedStateFromError!="function"?null:gN.render();return C_.flags|=1,z!==null&&mH?(C_.child=fX(C_,z.child,null,sH),C_.child=fX(C_,null,DH,sH)):M4(z,C_,DH,sH),C_.memoizedState=gN.state,t3&&Xre(C_,hN,!0),C_.child}function wie(z){var C_=z.stateNode;C_.pendingContext?Jre(z,C_.pendingContext,C_.pendingContext!==C_.context):C_.context&&Jre(z,C_.context,!1),AZ(z,C_.containerInfo)}function Aie(z,C_,hN,gN,t3){return c7(),RZ(t3),C_.flags|=256,M4(z,C_,hN,gN),C_.child}var wte={dehydrated:null,treeContext:null,retryLane:0};function H9(z){return{baseLanes:z,cachePool:null,transitions:null}}function Oie(z,C_,hN){var gN=C_.pendingProps,t3=CK.current,sH=!1,mH=(C_.flags&128)!==0,DH;if((DH=mH)||(DH=z!==null&&z.memoizedState===null?!1:(t3&2)!==0),DH?(sH=!0,C_.flags&=-129):(z===null||z.memoizedState!==null)&&(t3|=1),iK(CK,t3&1),z===null)return L9(C_),z=C_.memoizedState,z!==null&&(z=z.dehydrated,z!==null)?(C_.mode&1?z.data==="$!"?C_.lanes=8:C_.lanes=1073741824:C_.lanes=1,null):(mH=gN.children,z=gN.fallback,sH?(gN=C_.mode,sH=C_.child,mH={mode:"hidden",children:mH},!(gN&1)&&sH!==null?(sH.childLanes=0,sH.pendingProps=mH):sH=nQ(mH,gN,0,null),z=WY(z,gN,hN,null),sH.return=C_,z.return=C_,sH.sibling=z,C_.child=sH,C_.child.memoizedState=H9(hN),C_.memoizedState=wte,z):Ate(C_,mH));if(t3=z.memoizedState,t3!==null&&(DH=t3.dehydrated,DH!==null))return lce(z,C_,mH,gN,DH,t3,hN);if(sH){sH=gN.fallback,mH=C_.mode,t3=z.child,DH=t3.sibling;var FH={mode:"hidden",children:gN.children};return!(mH&1)&&C_.child!==t3?(gN=C_.child,gN.childLanes=0,gN.pendingProps=FH,C_.deletions=null):(gN=DJ(t3,FH),gN.subtreeFlags=t3.subtreeFlags&14680064),DH!==null?sH=DJ(DH,sH):(sH=WY(sH,mH,hN,null),sH.flags|=2),sH.return=C_,gN.return=C_,gN.sibling=sH,C_.child=gN,gN=sH,sH=C_.child,mH=z.child.memoizedState,mH=mH===null?H9(hN):{baseLanes:mH.baseLanes|hN,cachePool:null,transitions:mH.transitions},sH.memoizedState=mH,sH.childLanes=z.childLanes&~hN,C_.memoizedState=wte,gN}return sH=z.child,z=sH.sibling,gN=DJ(sH,{mode:"visible",children:gN.children}),!(C_.mode&1)&&(gN.lanes=hN),gN.return=C_,gN.sibling=null,z!==null&&(hN=C_.deletions,hN===null?(C_.deletions=[z],C_.flags|=16):hN.push(z)),C_.child=gN,C_.memoizedState=null,gN}function Ate(z,C_){return C_=nQ({mode:"visible",children:C_},z.mode,0,null),C_.return=z,z.child=C_}function xZ(z,C_,hN,gN){return gN!==null&&RZ(gN),fX(C_,z.child,null,hN),z=Ate(C_,C_.pendingProps.children),z.flags|=2,C_.memoizedState=null,z}function lce(z,C_,hN,gN,t3,sH,mH){if(hN)return C_.flags&256?(C_.flags&=-257,gN=yte(Error(i(422))),xZ(z,C_,mH,gN)):C_.memoizedState!==null?(C_.child=z.child,C_.flags|=128,null):(sH=gN.fallback,t3=C_.mode,gN=nQ({mode:"visible",children:gN.children},t3,0,null),sH=WY(sH,t3,mH,null),sH.flags|=2,gN.return=C_,sH.return=C_,gN.sibling=sH,C_.child=gN,C_.mode&1&&fX(C_,z.child,null,mH),C_.child.memoizedState=H9(mH),C_.memoizedState=wte,sH);if(!(C_.mode&1))return xZ(z,C_,mH,null);if(t3.data==="$!"){if(gN=t3.nextSibling&&t3.nextSibling.dataset,gN)var DH=gN.dgst;return gN=DH,sH=Error(i(419)),gN=yte(sH,gN,void 0),xZ(z,C_,mH,gN)}if(DH=(mH&z.childLanes)!==0,X4||DH){if(gN=wK,gN!==null){switch(mH&-mH){case 4:t3=2;break;case 16:t3=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:t3=32;break;case 536870912:t3=268435456;break;default:t3=0}t3=t3&(gN.suspendedLanes|mH)?0:t3,t3!==0&&t3!==sH.retryLane&&(sH.retryLane=t3,tY(z,t3),j8(gN,z,t3,-1))}return QZ(),gN=yte(Error(i(421))),xZ(z,C_,mH,gN)}return t3.data==="$?"?(C_.flags|=128,C_.child=z.child,C_=gce.bind(null,z),t3._reactRetry=C_,null):(z=sH.treeContext,o8=OY(t3.nextSibling),J4=C_,RK=!0,T8=null,z!==null&&(g8[L4++]=DY,g8[L4++]=kY,g8[L4++]=o7,DY=z.id,kY=z.overflow,o7=C_),C_=Ate(C_,gN.children),C_.flags|=4096,C_)}function Nie(z,C_,hN){z.lanes|=C_;var gN=z.alternate;gN!==null&&(gN.lanes|=C_),rte(z.return,C_,hN)}function Ote(z,C_,hN,gN,t3){var sH=z.memoizedState;sH===null?z.memoizedState={isBackwards:C_,rendering:null,renderingStartTime:0,last:gN,tail:hN,tailMode:t3}:(sH.isBackwards=C_,sH.rendering=null,sH.renderingStartTime=0,sH.last=gN,sH.tail=hN,sH.tailMode=t3)}function Nte(z,C_,hN){var gN=C_.pendingProps,t3=gN.revealOrder,sH=gN.tail;if(M4(z,C_,gN.children,hN),gN=CK.current,gN&2)gN=gN&1|2,C_.flags|=128;else{if(z!==null&&z.flags&128)e:for(z=C_.child;z!==null;){if(z.tag===13)z.memoizedState!==null&&Nie(z,hN,C_);else if(z.tag===19)Nie(z,hN,C_);else if(z.child!==null){z.child.return=z,z=z.child;continue}if(z===C_)break e;for(;z.sibling===null;){if(z.return===null||z.return===C_)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}gN&=1}if(iK(CK,gN),!(C_.mode&1))C_.memoizedState=null;else switch(t3){case"forwards":for(hN=C_.child,t3=null;hN!==null;)z=hN.alternate,z!==null&&OZ(z)===null&&(t3=hN),hN=hN.sibling;hN=t3,hN===null?(t3=C_.child,C_.child=null):(t3=hN.sibling,hN.sibling=null),Ote(C_,!1,t3,hN,sH);break;case"backwards":for(hN=null,t3=C_.child,C_.child=null;t3!==null;){if(z=t3.alternate,z!==null&&OZ(z)===null){C_.child=t3;break}z=t3.sibling,t3.sibling=hN,hN=t3,t3=z}Ote(C_,!0,hN,null,sH);break;case"together":Ote(C_,!1,null,null,void 0);break;default:C_.memoizedState=null}return C_.child}function q9(z,C_){!(C_.mode&1)&&z!==null&&(z.alternate=null,C_.alternate=null,C_.flags|=2)}function VY(z,C_,hN){if(z!==null&&(C_.dependencies=z.dependencies),wJ|=C_.lanes,!(hN&C_.childLanes))return null;if(z!==null&&C_.child!==z.child)throw Error(i(153));if(C_.child!==null){for(z=C_.child,hN=DJ(z,z.pendingProps),C_.child=hN,hN.return=C_;z.sibling!==null;)z=z.sibling,hN=hN.sibling=DJ(z,z.pendingProps),hN.return=C_;hN.sibling=null}return C_.child}function hce(z,C_,hN){switch(C_.tag){case 3:wie(C_),c7();break;case 5:ste(C_);break;case 1:T4(C_.type)&&mZ(C_);break;case 4:AZ(C_,C_.stateNode.containerInfo);break;case 10:var gN=C_.type._context,t3=C_.memoizedProps.value;iK(U9,gN._currentValue),gN._currentValue=t3;break;case 13:if(gN=C_.memoizedState,gN!==null)return gN.dehydrated!==null?(iK(CK,CK.current&1),C_.flags|=128,null):hN&C_.child.childLanes?Oie(z,C_,hN):(iK(CK,CK.current&1),z=VY(z,C_,hN),z!==null?z.sibling:null);iK(CK,CK.current&1);break;case 19:if(gN=(hN&C_.childLanes)!==0,z.flags&128){if(gN)return Nte(z,C_,hN);C_.flags|=128}if(t3=C_.memoizedState,t3!==null&&(t3.rendering=null,t3.tail=null,t3.lastEffect=null),iK(CK,CK.current),gN)break;return null;case 22:case 23:return C_.lanes=0,vte(z,C_,hN)}return VY(z,C_,hN)}var K9,z9,Pte,Y9;K9=function(z,C_){for(var hN=C_.child;hN!==null;){if(hN.tag===5||hN.tag===6)z.appendChild(hN.stateNode);else if(hN.tag!==4&&hN.child!==null){hN.child.return=hN,hN=hN.child;continue}if(hN===C_)break;for(;hN.sibling===null;){if(hN.return===null||hN.return===C_)return;hN=hN.return}hN.sibling.return=hN.return,hN=hN.sibling}},z9=function(){},Pte=function(z,C_,hN,gN){var t3=z.memoizedProps;if(t3!==gN){z=C_.stateNode,p7(nY.current);var sH=null;switch(hN){case"input":t3=X5(z,t3),gN=X5(z,gN),sH=[];break;case"select":t3=gH({},t3,{value:void 0}),gN=gH({},gN,{value:void 0}),sH=[];break;case"textarea":t3=HK(z,t3),gN=HK(z,gN),sH=[];break;default:typeof t3.onClick!="function"&&typeof gN.onClick=="function"&&(z.onclick=P9)}mee(hN,gN);var mH;hN=null;for(s5 in t3)if(!gN.hasOwnProperty(s5)&&t3.hasOwnProperty(s5)&&t3[s5]!=null)if(s5==="style"){var DH=t3[s5];for(mH in DH)DH.hasOwnProperty(mH)&&(hN||(hN={}),hN[mH]="")}else s5!=="dangerouslySetInnerHTML"&&s5!=="children"&&s5!=="suppressContentEditableWarning"&&s5!=="suppressHydrationWarning"&&s5!=="autoFocus"&&(h.hasOwnProperty(s5)?sH||(sH=[]):(sH=sH||[]).push(s5,null));for(s5 in gN){var FH=gN[s5];if(DH=t3!=null?t3[s5]:void 0,gN.hasOwnProperty(s5)&&FH!==DH&&(FH!=null||DH!=null))if(s5==="style")if(DH){for(mH in DH)!DH.hasOwnProperty(mH)||FH&&FH.hasOwnProperty(mH)||(hN||(hN={}),hN[mH]="");for(mH in FH)FH.hasOwnProperty(mH)&&DH[mH]!==FH[mH]&&(hN||(hN={}),hN[mH]=FH[mH])}else hN||(sH||(sH=[]),sH.push(s5,hN)),hN=FH;else s5==="dangerouslySetInnerHTML"?(FH=FH?FH.__html:void 0,DH=DH?DH.__html:void 0,FH!=null&&DH!==FH&&(sH=sH||[]).push(s5,FH)):s5==="children"?typeof FH!="string"&&typeof FH!="number"||(sH=sH||[]).push(s5,""+FH):s5!=="suppressContentEditableWarning"&&s5!=="suppressHydrationWarning"&&(h.hasOwnProperty(s5)?(FH!=null&&s5==="onScroll"&&TK("scroll",z),sH||DH===FH||(sH=[])):(sH=sH||[]).push(s5,FH))}hN&&(sH=sH||[]).push("style",hN);var s5=sH;(C_.updateQueue=s5)&&(C_.flags|=4)}},Y9=function(z,C_,hN,gN){hN!==gN&&(C_.flags|=4)};function RX(z,C_){if(!RK)switch(z.tailMode){case"hidden":C_=z.tail;for(var hN=null;C_!==null;)C_.alternate!==null&&(hN=C_),C_=C_.sibling;hN===null?z.tail=null:hN.sibling=null;break;case"collapsed":hN=z.tail;for(var gN=null;hN!==null;)hN.alternate!==null&&(gN=hN),hN=hN.sibling;gN===null?C_||z.tail===null?z.tail=null:z.tail.sibling=null:gN.sibling=null}}function y4(z){var C_=z.alternate!==null&&z.alternate.child===z.child,hN=0,gN=0;if(C_)for(var t3=z.child;t3!==null;)hN|=t3.lanes|t3.childLanes,gN|=t3.subtreeFlags&14680064,gN|=t3.flags&14680064,t3.return=z,t3=t3.sibling;else for(t3=z.child;t3!==null;)hN|=t3.lanes|t3.childLanes,gN|=t3.subtreeFlags,gN|=t3.flags,t3.return=z,t3=t3.sibling;return z.subtreeFlags|=gN,z.childLanes=hN,C_}function Pie(z,C_,hN){var gN=C_.pendingProps;switch(pX(C_),C_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return y4(C_),null;case 1:return T4(C_.type)&&EZ(),y4(C_),null;case 3:return gN=C_.stateNode,EX(),rK(Y4),rK(g4),cte(),gN.pendingContext&&(gN.context=gN.pendingContext,gN.pendingContext=null),(z===null||z.child===null)&&(M9(C_)?C_.flags|=4:z===null||z.memoizedState.isDehydrated&&!(C_.flags&256)||(C_.flags|=1024,T8!==null&&(eQ(T8),T8=null))),z9(z,C_),y4(C_),null;case 5:ote(C_);var t3=p7(h7.current);if(hN=C_.type,z!==null&&C_.stateNode!=null)Pte(z,C_,hN,gN,t3),z.ref!==C_.ref&&(C_.flags|=512,C_.flags|=2097152);else{if(!gN){if(C_.stateNode===null)throw Error(i(166));return y4(C_),null}if(z=p7(nY.current),M9(C_)){gN=C_.stateNode,hN=C_.type;var sH=C_.memoizedProps;switch(gN[m8]=C_,gN[D9]=sH,z=(C_.mode&1)!==0,hN){case"dialog":TK("cancel",gN),TK("close",gN);break;case"iframe":case"object":case"embed":TK("load",gN);break;case"video":case"audio":for(t3=0;t3<A9.length;t3++)TK(A9[t3],gN);break;case"source":TK("error",gN);break;case"img":case"image":case"link":TK("error",gN),TK("load",gN);break;case"details":TK("toggle",gN);break;case"input":B5(gN,sH),TK("invalid",gN);break;case"select":gN._wrapperState={wasMultiple:!!sH.multiple},TK("invalid",gN);break;case"textarea":f8(gN,sH),TK("invalid",gN)}mee(hN,sH),t3=null;for(var mH in sH)if(sH.hasOwnProperty(mH)){var DH=sH[mH];mH==="children"?typeof DH=="string"?gN.textContent!==DH&&(sH.suppressHydrationWarning!==!0&&lZ(gN.textContent,DH,z),t3=["children",DH]):typeof DH=="number"&&gN.textContent!==""+DH&&(sH.suppressHydrationWarning!==!0&&lZ(gN.textContent,DH,z),t3=["children",""+DH]):h.hasOwnProperty(mH)&&DH!=null&&mH==="onScroll"&&TK("scroll",gN)}switch(hN){case"input":D4(gN),Q5(gN,sH,!0);break;case"textarea":D4(gN),G7(gN);break;case"select":case"option":break;default:typeof sH.onClick=="function"&&(gN.onclick=P9)}gN=t3,C_.updateQueue=gN,gN!==null&&(C_.flags|=4)}else{mH=t3.nodeType===9?t3:t3.ownerDocument,z==="http://www.w3.org/1999/xhtml"&&(z=_ee(hN)),z==="http://www.w3.org/1999/xhtml"?hN==="script"?(z=mH.createElement("div"),z.innerHTML="<script><\/script>",z=z.removeChild(z.firstChild)):typeof gN.is=="string"?z=mH.createElement(hN,{is:gN.is}):(z=mH.createElement(hN),hN==="select"&&(mH=z,gN.multiple?mH.multiple=!0:gN.size&&(mH.size=gN.size))):z=mH.createElementNS(z,hN),z[m8]=C_,z[D9]=gN,K9(z,C_,!1,!1),C_.stateNode=z;e:{switch(mH=gee(hN,gN),hN){case"dialog":TK("cancel",z),TK("close",z),t3=gN;break;case"iframe":case"object":case"embed":TK("load",z),t3=gN;break;case"video":case"audio":for(t3=0;t3<A9.length;t3++)TK(A9[t3],z);t3=gN;break;case"source":TK("error",z),t3=gN;break;case"img":case"image":case"link":TK("error",z),TK("load",z),t3=gN;break;case"details":TK("toggle",z),t3=gN;break;case"input":B5(z,gN),t3=X5(z,gN),TK("invalid",z);break;case"option":t3=gN;break;case"select":z._wrapperState={wasMultiple:!!gN.multiple},t3=gH({},gN,{value:void 0}),TK("invalid",z);break;case"textarea":f8(z,gN),t3=HK(z,gN),TK("invalid",z);break;default:t3=gN}mee(hN,t3),DH=t3;for(sH in DH)if(DH.hasOwnProperty(sH)){var FH=DH[sH];sH==="style"?cJ(z,FH):sH==="dangerouslySetInnerHTML"?(FH=FH?FH.__html:void 0,FH!=null&&BQ(z,FH)):sH==="children"?typeof FH=="string"?(hN!=="textarea"||FH!=="")&&W7(z,FH):typeof FH=="number"&&W7(z,""+FH):sH!=="suppressContentEditableWarning"&&sH!=="suppressHydrationWarning"&&sH!=="autoFocus"&&(h.hasOwnProperty(sH)?FH!=null&&sH==="onScroll"&&TK("scroll",z):FH!=null&&aH(z,sH,FH,mH))}switch(hN){case"input":D4(z),Q5(z,gN,!1);break;case"textarea":D4(z),G7(z);break;case"option":gN.value!=null&&z.setAttribute("value",""+d6(gN.value));break;case"select":z.multiple=!!gN.multiple,sH=gN.value,sH!=null?W5(z,!!gN.multiple,sH,!1):gN.defaultValue!=null&&W5(z,!!gN.multiple,gN.defaultValue,!0);break;default:typeof t3.onClick=="function"&&(z.onclick=P9)}switch(hN){case"button":case"input":case"select":case"textarea":gN=!!gN.autoFocus;break e;case"img":gN=!0;break e;default:gN=!1}}gN&&(C_.flags|=4)}C_.ref!==null&&(C_.flags|=512,C_.flags|=2097152)}return y4(C_),null;case 6:if(z&&C_.stateNode!=null)Y9(z,C_,z.memoizedProps,gN);else{if(typeof gN!="string"&&C_.stateNode===null)throw Error(i(166));if(hN=p7(h7.current),p7(nY.current),M9(C_)){if(gN=C_.stateNode,hN=C_.memoizedProps,gN[m8]=C_,(sH=gN.nodeValue!==hN)&&(z=J4,z!==null))switch(z.tag){case 3:lZ(gN.nodeValue,hN,(z.mode&1)!==0);break;case 5:z.memoizedProps.suppressHydrationWarning!==!0&&lZ(gN.nodeValue,hN,(z.mode&1)!==0)}sH&&(C_.flags|=4)}else gN=(hN.nodeType===9?hN:hN.ownerDocument).createTextNode(gN),gN[m8]=C_,C_.stateNode=gN}return y4(C_),null;case 13:if(rK(CK),gN=C_.memoizedState,z===null||z.memoizedState!==null&&z.memoizedState.dehydrated!==null){if(RK&&o8!==null&&C_.mode&1&&!(C_.flags&128))yZ(),c7(),C_.flags|=98560,sH=!1;else if(sH=M9(C_),gN!==null&&gN.dehydrated!==null){if(z===null){if(!sH)throw Error(i(318));if(sH=C_.memoizedState,sH=sH!==null?sH.dehydrated:null,!sH)throw Error(i(317));sH[m8]=C_}else c7(),!(C_.flags&128)&&(C_.memoizedState=null),C_.flags|=4;y4(C_),sH=!1}else T8!==null&&(eQ(T8),T8=null),sH=!0;if(!sH)return C_.flags&65536?C_:null}return C_.flags&128?(C_.lanes=hN,C_):(gN=gN!==null,gN!==(z!==null&&z.memoizedState!==null)&&gN&&(C_.child.flags|=8192,C_.mode&1&&(z===null||CK.current&1?$K===0&&($K=3):QZ())),C_.updateQueue!==null&&(C_.flags|=4),y4(C_),null);case 4:return EX(),z9(z,C_),z===null&&O9(C_.stateNode.containerInfo),y4(C_),null;case 10:return nte(C_.type._context),y4(C_),null;case 17:return T4(C_.type)&&EZ(),y4(C_),null;case 19:if(rK(CK),sH=C_.memoizedState,sH===null)return y4(C_),null;if(gN=(C_.flags&128)!==0,mH=sH.rendering,mH===null)if(gN)RX(sH,!1);else{if($K!==0||z!==null&&z.flags&128)for(z=C_.child;z!==null;){if(mH=OZ(z),mH!==null){for(C_.flags|=128,RX(sH,!1),gN=mH.updateQueue,gN!==null&&(C_.updateQueue=gN,C_.flags|=4),C_.subtreeFlags=0,gN=hN,hN=C_.child;hN!==null;)sH=hN,z=gN,sH.flags&=14680066,mH=sH.alternate,mH===null?(sH.childLanes=0,sH.lanes=z,sH.child=null,sH.subtreeFlags=0,sH.memoizedProps=null,sH.memoizedState=null,sH.updateQueue=null,sH.dependencies=null,sH.stateNode=null):(sH.childLanes=mH.childLanes,sH.lanes=mH.lanes,sH.child=mH.child,sH.subtreeFlags=0,sH.deletions=null,sH.memoizedProps=mH.memoizedProps,sH.memoizedState=mH.memoizedState,sH.updateQueue=mH.updateQueue,sH.type=mH.type,z=mH.dependencies,sH.dependencies=z===null?null:{lanes:z.lanes,firstContext:z.firstContext}),hN=hN.sibling;return iK(CK,CK.current&1|2),C_.child}z=z.sibling}sH.tail!==null&&Q6()>vX&&(C_.flags|=128,gN=!0,RX(sH,!1),C_.lanes=4194304)}else{if(!gN)if(z=OZ(mH),z!==null){if(C_.flags|=128,gN=!0,hN=z.updateQueue,hN!==null&&(C_.updateQueue=hN,C_.flags|=4),RX(sH,!0),sH.tail===null&&sH.tailMode==="hidden"&&!mH.alternate&&!RK)return y4(C_),null}else 2*Q6()-sH.renderingStartTime>vX&&hN!==1073741824&&(C_.flags|=128,gN=!0,RX(sH,!1),C_.lanes=4194304);sH.isBackwards?(mH.sibling=C_.child,C_.child=mH):(hN=sH.last,hN!==null?hN.sibling=mH:C_.child=mH,sH.last=mH)}return sH.tail!==null?(C_=sH.tail,sH.rendering=C_,sH.tail=C_.sibling,sH.renderingStartTime=Q6(),C_.sibling=null,hN=CK.current,iK(CK,gN?hN&1|2:hN&1),C_):(y4(C_),null);case 22:case 23:return JZ(),gN=C_.memoizedState!==null,z!==null&&z.memoizedState!==null!==gN&&(C_.flags|=8192),gN&&C_.mode&1?R4&1073741824&&(y4(C_),C_.subtreeFlags&6&&(C_.flags|=8192)):y4(C_),null;case 24:return null;case 25:return null}throw Error(i(156,C_.tag))}function VZ(z,C_){switch(pX(C_),C_.tag){case 1:return T4(C_.type)&&EZ(),z=C_.flags,z&65536?(C_.flags=z&-65537|128,C_):null;case 3:return EX(),rK(Y4),rK(g4),cte(),z=C_.flags,z&65536&&!(z&128)?(C_.flags=z&-65537|128,C_):null;case 5:return ote(C_),null;case 13:if(rK(CK),z=C_.memoizedState,z!==null&&z.dehydrated!==null){if(C_.alternate===null)throw Error(i(340));c7()}return z=C_.flags,z&65536?(C_.flags=z&-65537|128,C_):null;case 19:return rK(CK),null;case 4:return EX(),null;case 10:return nte(C_.type._context),null;case 22:case 23:return JZ(),null;case 24:return null;default:return null}}var FZ=!1,h4=!1,Die=typeof WeakSet=="function"?WeakSet:Set,x5=null;function FY(z,C_){var hN=z.ref;if(hN!==null)if(typeof hN=="function")try{hN(null)}catch(gN){bK(z,C_,gN)}else hN.current=null}function jZ(z,C_,hN){try{hN()}catch(gN){bK(z,C_,gN)}}var kie=!1;function pce(z,C_){if(hZ=ZQ,z=Bre(),iZ(z)){if("selectionStart"in z)var hN={start:z.selectionStart,end:z.selectionEnd};else e:{hN=(hN=z.ownerDocument)&&hN.defaultView||window;var gN=hN.getSelection&&hN.getSelection();if(gN&&gN.rangeCount!==0){hN=gN.anchorNode;var t3=gN.anchorOffset,sH=gN.focusNode;gN=gN.focusOffset;try{hN.nodeType,sH.nodeType}catch{hN=null;break e}var mH=0,DH=-1,FH=-1,s5=0,R5=0,b5=z,S5=null;t:for(;;){for(var L5;b5!==hN||t3!==0&&b5.nodeType!==3||(DH=mH+t3),b5!==sH||gN!==0&&b5.nodeType!==3||(FH=mH+gN),b5.nodeType===3&&(mH+=b5.nodeValue.length),(L5=b5.firstChild)!==null;)S5=b5,b5=L5;for(;;){if(b5===z)break t;if(S5===hN&&++s5===t3&&(DH=mH),S5===sH&&++R5===gN&&(FH=mH),(L5=b5.nextSibling)!==null)break;b5=S5,S5=b5.parentNode}b5=L5}hN=DH===-1||FH===-1?null:{start:DH,end:FH}}else hN=null}hN=hN||{start:0,end:0}}else hN=null;for(Kee={focusedElem:z,selectionRange:hN},ZQ=!1,x5=C_;x5!==null;)if(C_=x5,z=C_.child,(C_.subtreeFlags&1028)!==0&&z!==null)z.return=C_,x5=z;else for(;x5!==null;){C_=x5;try{var V5=C_.alternate;if(C_.flags&1024)switch(C_.tag){case 0:case 11:case 15:break;case 1:if(V5!==null){var j5=V5.memoizedProps,VK=V5.memoizedState,QH=C_.stateNode,WH=QH.getSnapshotBeforeUpdate(C_.elementType===C_.type?j5:U8(C_.type,j5),VK);QH.__reactInternalSnapshotBeforeUpdate=WH}break;case 3:var t5=C_.stateNode.containerInfo;t5.nodeType===1?t5.textContent="":t5.nodeType===9&&t5.documentElement&&t5.removeChild(t5.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(C5){bK(C_,C_.return,C5)}if(z=C_.sibling,z!==null){z.return=C_.return,x5=z;break}x5=C_.return}return V5=kie,kie=!1,V5}function J9(z,C_,hN){var gN=C_.updateQueue;if(gN=gN!==null?gN.lastEffect:null,gN!==null){var t3=gN=gN.next;do{if((t3.tag&z)===z){var sH=t3.destroy;t3.destroy=void 0,sH!==void 0&&jZ(C_,hN,sH)}t3=t3.next}while(t3!==gN)}}function T7(z,C_){if(C_=C_.updateQueue,C_=C_!==null?C_.lastEffect:null,C_!==null){var hN=C_=C_.next;do{if((hN.tag&z)===z){var gN=hN.create;hN.destroy=gN()}hN=hN.next}while(hN!==C_)}}function Dte(z){var C_=z.ref;if(C_!==null){var hN=z.stateNode;switch(z.tag){case 5:z=hN;break;default:z=hN}typeof C_=="function"?C_(z):C_.current=z}}function Lie(z){var C_=z.alternate;C_!==null&&(z.alternate=null,Lie(C_)),z.child=null,z.deletions=null,z.sibling=null,z.tag===5&&(C_=z.stateNode,C_!==null&&(delete C_[m8],delete C_[D9],delete C_[Yee],delete C_[sce],delete C_[oce])),z.stateNode=null,z.return=null,z.dependencies=null,z.memoizedProps=null,z.memoizedState=null,z.pendingProps=null,z.stateNode=null,z.updateQueue=null}function Mie(z){return z.tag===5||z.tag===3||z.tag===4}function kte(z){e:for(;;){for(;z.sibling===null;){if(z.return===null||Mie(z.return))return null;z=z.return}for(z.sibling.return=z.return,z=z.sibling;z.tag!==5&&z.tag!==6&&z.tag!==18;){if(z.flags&2||z.child===null||z.tag===4)continue e;z.child.return=z,z=z.child}if(!(z.flags&2))return z.stateNode}}function Lte(z,C_,hN){var gN=z.tag;if(gN===5||gN===6)z=z.stateNode,C_?hN.nodeType===8?hN.parentNode.insertBefore(z,C_):hN.insertBefore(z,C_):(hN.nodeType===8?(C_=hN.parentNode,C_.insertBefore(z,hN)):(C_=hN,C_.appendChild(z)),hN=hN._reactRootContainer,hN!=null||C_.onclick!==null||(C_.onclick=P9));else if(gN!==4&&(z=z.child,z!==null))for(Lte(z,C_,hN),z=z.sibling;z!==null;)Lte(z,C_,hN),z=z.sibling}function Mte(z,C_,hN){var gN=z.tag;if(gN===5||gN===6)z=z.stateNode,C_?hN.insertBefore(z,C_):hN.appendChild(z);else if(gN!==4&&(z=z.child,z!==null))for(Mte(z,C_,hN),z=z.sibling;z!==null;)Mte(z,C_,hN),z=z.sibling}var QK=null,x8=!1;function aY(z,C_,hN){for(hN=hN.child;hN!==null;)Uie(z,C_,hN),hN=hN.sibling}function Uie(z,C_,hN){if(_8&&typeof _8.onCommitFiberUnmount=="function")try{_8.onCommitFiberUnmount(KQ,hN)}catch{}switch(hN.tag){case 5:h4||FY(hN,C_);case 6:var gN=QK,t3=x8;QK=null,aY(z,C_,hN),QK=gN,x8=t3,QK!==null&&(x8?(z=QK,hN=hN.stateNode,z.nodeType===8?z.parentNode.removeChild(hN):z.removeChild(hN)):QK.removeChild(hN.stateNode));break;case 18:QK!==null&&(x8?(z=QK,hN=hN.stateNode,z.nodeType===8?zee(z.parentNode,hN):z.nodeType===1&&zee(z,hN),l9(z)):zee(QK,hN.stateNode));break;case 4:gN=QK,t3=x8,QK=hN.stateNode.containerInfo,x8=!0,aY(z,C_,hN),QK=gN,x8=t3;break;case 0:case 11:case 14:case 15:if(!h4&&(gN=hN.updateQueue,gN!==null&&(gN=gN.lastEffect,gN!==null))){t3=gN=gN.next;do{var sH=t3,mH=sH.destroy;sH=sH.tag,mH!==void 0&&(sH&2||sH&4)&&jZ(hN,C_,mH),t3=t3.next}while(t3!==gN)}aY(z,C_,hN);break;case 1:if(!h4&&(FY(hN,C_),gN=hN.stateNode,typeof gN.componentWillUnmount=="function"))try{gN.props=hN.memoizedProps,gN.state=hN.memoizedState,gN.componentWillUnmount()}catch(DH){bK(hN,C_,DH)}aY(z,C_,hN);break;case 21:aY(z,C_,hN);break;case 22:hN.mode&1?(h4=(gN=h4)||hN.memoizedState!==null,aY(z,C_,hN),h4=gN):aY(z,C_,hN);break;default:aY(z,C_,hN)}}function Ute(z){var C_=z.updateQueue;if(C_!==null){z.updateQueue=null;var hN=z.stateNode;hN===null&&(hN=z.stateNode=new Die),C_.forEach(function(gN){var t3=Tce.bind(null,z,gN);hN.has(gN)||(hN.add(gN),gN.then(t3,t3))})}}function V8(z,C_){var hN=C_.deletions;if(hN!==null)for(var gN=0;gN<hN.length;gN++){var t3=hN[gN];try{var sH=z,mH=C_,DH=mH;e:for(;DH!==null;){switch(DH.tag){case 5:QK=DH.stateNode,x8=!1;break e;case 3:QK=DH.stateNode.containerInfo,x8=!0;break e;case 4:QK=DH.stateNode.containerInfo,x8=!0;break e}DH=DH.return}if(QK===null)throw Error(i(160));Uie(sH,mH,t3),QK=null,x8=!1;var FH=t3.alternate;FH!==null&&(FH.return=null),t3.return=null}catch(s5){bK(t3,C_,s5)}}if(C_.subtreeFlags&12854)for(C_=C_.child;C_!==null;)xie(C_,z),C_=C_.sibling}function xie(z,C_){var hN=z.alternate,gN=z.flags;switch(z.tag){case 0:case 11:case 14:case 15:if(V8(C_,z),F8(z),gN&4){try{J9(3,z,z.return),T7(3,z)}catch(j5){bK(z,z.return,j5)}try{J9(5,z,z.return)}catch(j5){bK(z,z.return,j5)}}break;case 1:V8(C_,z),F8(z),gN&512&&hN!==null&&FY(hN,hN.return);break;case 5:if(V8(C_,z),F8(z),gN&512&&hN!==null&&FY(hN,hN.return),z.flags&32){var t3=z.stateNode;try{W7(t3,"")}catch(j5){bK(z,z.return,j5)}}if(gN&4&&(t3=z.stateNode,t3!=null)){var sH=z.memoizedProps,mH=hN!==null?hN.memoizedProps:sH,DH=z.type,FH=z.updateQueue;if(z.updateQueue=null,FH!==null)try{DH==="input"&&sH.type==="radio"&&sH.name!=null&&y5(t3,sH),gee(DH,mH);var s5=gee(DH,sH);for(mH=0;mH<FH.length;mH+=2){var R5=FH[mH],b5=FH[mH+1];R5==="style"?cJ(t3,b5):R5==="dangerouslySetInnerHTML"?BQ(t3,b5):R5==="children"?W7(t3,b5):aH(t3,R5,b5,s5)}switch(DH){case"input":k5(t3,sH);break;case"textarea":X6(t3,sH);break;case"select":var S5=t3._wrapperState.wasMultiple;t3._wrapperState.wasMultiple=!!sH.multiple;var L5=sH.value;L5!=null?W5(t3,!!sH.multiple,L5,!1):S5!==!!sH.multiple&&(sH.defaultValue!=null?W5(t3,!!sH.multiple,sH.defaultValue,!0):W5(t3,!!sH.multiple,sH.multiple?[]:"",!1))}t3[D9]=sH}catch(j5){bK(z,z.return,j5)}}break;case 6:if(V8(C_,z),F8(z),gN&4){if(z.stateNode===null)throw Error(i(162));t3=z.stateNode,sH=z.memoizedProps;try{t3.nodeValue=sH}catch(j5){bK(z,z.return,j5)}}break;case 3:if(V8(C_,z),F8(z),gN&4&&hN!==null&&hN.memoizedState.isDehydrated)try{l9(C_.containerInfo)}catch(j5){bK(z,z.return,j5)}break;case 4:V8(C_,z),F8(z);break;case 13:V8(C_,z),F8(z),t3=z.child,t3.flags&8192&&(sH=t3.memoizedState!==null,t3.stateNode.isHidden=sH,!sH||t3.alternate!==null&&t3.alternate.memoizedState!==null||(cY=Q6())),gN&4&&Ute(z);break;case 22:if(R5=hN!==null&&hN.memoizedState!==null,z.mode&1?(h4=(s5=h4)||R5,V8(C_,z),h4=s5):V8(C_,z),F8(z),gN&8192){if(s5=z.memoizedState!==null,(z.stateNode.isHidden=s5)&&!R5&&z.mode&1)for(x5=z,R5=z.child;R5!==null;){for(b5=x5=R5;x5!==null;){switch(S5=x5,L5=S5.child,S5.tag){case 0:case 11:case 14:case 15:J9(4,S5,S5.return);break;case 1:FY(S5,S5.return);var V5=S5.stateNode;if(typeof V5.componentWillUnmount=="function"){gN=S5,hN=S5.return;try{C_=gN,V5.props=C_.memoizedProps,V5.state=C_.memoizedState,V5.componentWillUnmount()}catch(j5){bK(gN,hN,j5)}}break;case 5:FY(S5,S5.return);break;case 22:if(S5.memoizedState!==null){Vte(b5);continue}}L5!==null?(L5.return=S5,x5=L5):Vte(b5)}R5=R5.sibling}e:for(R5=null,b5=z;;){if(b5.tag===5){if(R5===null){R5=b5;try{t3=b5.stateNode,s5?(sH=t3.style,typeof sH.setProperty=="function"?sH.setProperty("display","none","important"):sH.display="none"):(DH=b5.stateNode,FH=b5.memoizedProps.style,mH=FH!=null&&FH.hasOwnProperty("display")?FH.display:null,DH.style.display=Eee("display",mH))}catch(j5){bK(z,z.return,j5)}}}else if(b5.tag===6){if(R5===null)try{b5.stateNode.nodeValue=s5?"":b5.memoizedProps}catch(j5){bK(z,z.return,j5)}}else if((b5.tag!==22&&b5.tag!==23||b5.memoizedState===null||b5===z)&&b5.child!==null){b5.child.return=b5,b5=b5.child;continue}if(b5===z)break e;for(;b5.sibling===null;){if(b5.return===null||b5.return===z)break e;R5===b5&&(R5=null),b5=b5.return}R5===b5&&(R5=null),b5.sibling.return=b5.return,b5=b5.sibling}}break;case 19:V8(C_,z),F8(z),gN&4&&Ute(z);break;case 21:break;default:V8(C_,z),F8(z)}}function F8(z){var C_=z.flags;if(C_&2){try{e:{for(var hN=z.return;hN!==null;){if(Mie(hN)){var gN=hN;break e}hN=hN.return}throw Error(i(160))}switch(gN.tag){case 5:var t3=gN.stateNode;gN.flags&32&&(W7(t3,""),gN.flags&=-33);var sH=kte(z);Mte(z,sH,t3);break;case 3:case 4:var mH=gN.stateNode.containerInfo,DH=kte(z);Lte(z,DH,mH);break;default:throw Error(i(161))}}catch(FH){bK(z,z.return,FH)}z.flags&=-3}C_&4096&&(z.flags&=-4097)}function fce(z,C_,hN){x5=z,Vie(z)}function Vie(z,C_,hN){for(var gN=(z.mode&1)!==0;x5!==null;){var t3=x5,sH=t3.child;if(t3.tag===22&&gN){var mH=t3.memoizedState!==null||FZ;if(!mH){var DH=t3.alternate,FH=DH!==null&&DH.memoizedState!==null||h4;DH=FZ;var s5=h4;if(FZ=mH,(h4=FH)&&!s5)for(x5=t3;x5!==null;)mH=x5,FH=mH.child,mH.tag===22&&mH.memoizedState!==null?BZ(t3):FH!==null?(FH.return=mH,x5=FH):BZ(t3);for(;sH!==null;)x5=sH,Vie(sH),sH=sH.sibling;x5=t3,FZ=DH,h4=s5}xte(z)}else t3.subtreeFlags&8772&&sH!==null?(sH.return=t3,x5=sH):xte(z)}}function xte(z){for(;x5!==null;){var C_=x5;if(C_.flags&8772){var hN=C_.alternate;try{if(C_.flags&8772)switch(C_.tag){case 0:case 11:case 15:h4||T7(5,C_);break;case 1:var gN=C_.stateNode;if(C_.flags&4&&!h4)if(hN===null)gN.componentDidMount();else{var t3=C_.elementType===C_.type?hN.memoizedProps:U8(C_.type,hN.memoizedProps);gN.componentDidUpdate(t3,hN.memoizedState,gN.__reactInternalSnapshotBeforeUpdate)}var sH=C_.updateQueue;sH!==null&&aie(C_,sH,gN);break;case 3:var mH=C_.updateQueue;if(mH!==null){if(hN=null,C_.child!==null)switch(C_.child.tag){case 5:hN=C_.child.stateNode;break;case 1:hN=C_.child.stateNode}aie(C_,mH,hN)}break;case 5:var DH=C_.stateNode;if(hN===null&&C_.flags&4){hN=DH;var FH=C_.memoizedProps;switch(C_.type){case"button":case"input":case"select":case"textarea":FH.autoFocus&&hN.focus();break;case"img":FH.src&&(hN.src=FH.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(C_.memoizedState===null){var s5=C_.alternate;if(s5!==null){var R5=s5.memoizedState;if(R5!==null){var b5=R5.dehydrated;b5!==null&&l9(b5)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}h4||C_.flags&512&&Dte(C_)}catch(S5){bK(C_,C_.return,S5)}}if(C_===z){x5=null;break}if(hN=C_.sibling,hN!==null){hN.return=C_.return,x5=hN;break}x5=C_.return}}function Vte(z){for(;x5!==null;){var C_=x5;if(C_===z){x5=null;break}var hN=C_.sibling;if(hN!==null){hN.return=C_.return,x5=hN;break}x5=C_.return}}function BZ(z){for(;x5!==null;){var C_=x5;try{switch(C_.tag){case 0:case 11:case 15:var hN=C_.return;try{T7(4,C_)}catch(FH){bK(C_,hN,FH)}break;case 1:var gN=C_.stateNode;if(typeof gN.componentDidMount=="function"){var t3=C_.return;try{gN.componentDidMount()}catch(FH){bK(C_,t3,FH)}}var sH=C_.return;try{Dte(C_)}catch(FH){bK(C_,sH,FH)}break;case 5:var mH=C_.return;try{Dte(C_)}catch(FH){bK(C_,mH,FH)}}}catch(FH){bK(C_,C_.return,FH)}if(C_===z){x5=null;break}var DH=C_.sibling;if(DH!==null){DH.return=C_.return,x5=DH;break}x5=C_.return}}var _ce=Math.ceil,GZ=pH.ReactCurrentDispatcher,S7=pH.ReactCurrentOwner,c8=pH.ReactCurrentBatchConfig,P6=0,wK=null,xK=null,ZK=0,R4=0,bX=M8(0),$K=0,X9=null,wJ=0,WZ=0,Fte=0,Q9=null,b4=null,cY=0,vX=1/0,U4=null,Z9=!1,x4=null,AJ=null,HZ=!1,jY=null,qZ=0,CX=0,KZ=null,zZ=-1,$9=0;function V4(){return P6&6?Q6():zZ!==-1?zZ:zZ=Q6()}function OJ(z){return z.mode&1?P6&2&&ZK!==0?ZK&-ZK:bZ.transition!==null?($9===0&&($9=Rre()),$9):(z=tK,z!==0||(z=window.event,z=z===void 0?16:wre(z.type)),z):1}function j8(z,C_,hN,gN){if(50<CX)throw CX=0,KZ=null,Error(i(185));s9(z,hN,gN),(!(P6&2)||z!==wK)&&(z===wK&&(!(P6&2)&&(WZ|=hN),$K===4&&BY(z,ZK)),v4(z,gN),hN===1&&P6===0&&!(C_.mode&1)&&(vX=Q6()+500,gZ&&RJ()))}function v4(z,C_){var hN=z.callbackNode;yre(z,C_);var gN=K6(z,z===wK?ZK:0);if(gN===0)hN!==null&&t7(hN),z.callbackNode=null,z.callbackPriority=0;else if(C_=gN&-gN,z.callbackPriority!==C_){if(hN!=null&&t7(hN),C_===1)z.tag===0?Zre(Fie.bind(null,z)):Qre(Fie.bind(null,z)),rce(function(){!(P6&6)&&RJ()}),hN=null;else{switch(YQ(gN)){case 1:hN=Cee;break;case 4:hN=kK;break;case 16:hN=qQ;break;case 536870912:hN=Sre;break;default:hN=qQ}hN=Wie(hN,YZ.bind(null,z))}z.callbackPriority=C_,z.callbackNode=hN}}function YZ(z,C_){if(zZ=-1,$9=0,P6&6)throw Error(i(327));var hN=z.callbackNode;if(PJ()&&z.callbackNode!==hN)return null;var gN=K6(z,z===wK?ZK:0);if(gN===0)return null;if(gN&30||gN&z.expiredLanes||C_)C_=y7(z,gN);else{C_=gN;var t3=P6;P6|=2;var sH=Bte();(wK!==z||ZK!==C_)&&(U4=null,vX=Q6()+500,GY(z,C_));do try{mce();break}catch(DH){XZ(z,DH)}while(!0);tte(),GZ.current=sH,P6=t3,xK!==null?C_=0:(wK=null,ZK=0,C_=$K)}if(C_!==0){if(C_===2&&(t3=zQ(z),t3!==0&&(gN=t3,C_=jte(z,t3))),C_===1)throw hN=X9,GY(z,0),BY(z,gN),v4(z,Q6()),hN;if(C_===6)BY(z,gN);else{if(t3=z.current.alternate,!(gN&30)&&!Ece(t3)&&(C_=y7(z,gN),C_===2&&(sH=zQ(z),sH!==0&&(gN=sH,C_=jte(z,sH))),C_===1))throw hN=X9,GY(z,0),BY(z,gN),v4(z,Q6()),hN;switch(z.finishedWork=t3,z.finishedLanes=gN,C_){case 0:case 1:throw Error(i(345));case 2:NJ(z,b4,U4);break;case 3:if(BY(z,gN),(gN&130023424)===gN&&(C_=cY+500-Q6(),10<C_)){if(K6(z,0)!==0)break;if(t3=z.suspendedLanes,(t3&gN)!==gN){V4(),z.pingedLanes|=z.suspendedLanes&t3;break}z.timeoutHandle=sX(NJ.bind(null,z,b4,U4),C_);break}NJ(z,b4,U4);break;case 4:if(BY(z,gN),(gN&4194240)===gN)break;for(C_=z.eventTimes,t3=-1;0<gN;){var mH=31-E8(gN);sH=1<<mH,mH=C_[mH],mH>t3&&(t3=mH),gN&=~sH}if(gN=t3,gN=Q6()-gN,gN=(120>gN?120:480>gN?480:1080>gN?1080:1920>gN?1920:3e3>gN?3e3:4320>gN?4320:1960*_ce(gN/1960))-gN,10<gN){z.timeoutHandle=sX(NJ.bind(null,z,b4,U4),gN);break}NJ(z,b4,U4);break;case 5:NJ(z,b4,U4);break;default:throw Error(i(329))}}}return v4(z,Q6()),z.callbackNode===hN?YZ.bind(null,z):null}function jte(z,C_){var hN=Q9;return z.current.memoizedState.isDehydrated&&(GY(z,C_).flags|=256),z=y7(z,C_),z!==2&&(C_=b4,b4=hN,C_!==null&&eQ(C_)),z}function eQ(z){b4===null?b4=z:b4.push.apply(b4,z)}function Ece(z){for(var C_=z;;){if(C_.flags&16384){var hN=C_.updateQueue;if(hN!==null&&(hN=hN.stores,hN!==null))for(var gN=0;gN<hN.length;gN++){var t3=hN[gN],sH=t3.getSnapshot;t3=t3.value;try{if(!L8(sH(),t3))return!1}catch{return!1}}}if(hN=C_.child,C_.subtreeFlags&16384&&hN!==null)hN.return=C_,C_=hN;else{if(C_===z)break;for(;C_.sibling===null;){if(C_.return===null||C_.return===z)return!0;C_=C_.return}C_.sibling.return=C_.return,C_=C_.sibling}}return!0}function BY(z,C_){for(C_&=~Fte,C_&=~WZ,z.suspendedLanes|=C_,z.pingedLanes&=~C_,z=z.expirationTimes;0<C_;){var hN=31-E8(C_),gN=1<<hN;z[hN]=-1,C_&=~gN}}function Fie(z){if(P6&6)throw Error(i(327));PJ();var C_=K6(z,0);if(!(C_&1))return v4(z,Q6()),null;var hN=y7(z,C_);if(z.tag!==0&&hN===2){var gN=zQ(z);gN!==0&&(C_=gN,hN=jte(z,gN))}if(hN===1)throw hN=X9,GY(z,0),BY(z,C_),v4(z,Q6()),hN;if(hN===6)throw Error(i(345));return z.finishedWork=z.current.alternate,z.finishedLanes=C_,NJ(z,b4,U4),v4(z,Q6()),null}function tQ(z,C_){var hN=P6;P6|=1;try{return z(C_)}finally{P6=hN,P6===0&&(vX=Q6()+500,gZ&&RJ())}}function B8(z){jY!==null&&jY.tag===0&&!(P6&6)&&PJ();var C_=P6;P6|=1;var hN=c8.transition,gN=tK;try{if(c8.transition=null,tK=1,z)return z()}finally{tK=gN,c8.transition=hN,P6=C_,!(P6&6)&&RJ()}}function JZ(){R4=bX.current,rK(bX)}function GY(z,C_){z.finishedWork=null,z.finishedLanes=0;var hN=z.timeoutHandle;if(hN!==-1&&(z.timeoutHandle=-1,nce(hN)),xK!==null)for(hN=xK.return;hN!==null;){var gN=hN;switch(pX(gN),gN.tag){case 1:gN=gN.type.childContextTypes,gN!=null&&EZ();break;case 3:EX(),rK(Y4),rK(g4),cte();break;case 5:ote(gN);break;case 4:EX();break;case 13:rK(CK);break;case 19:rK(CK);break;case 10:nte(gN.type._context);break;case 22:case 23:JZ()}hN=hN.return}if(wK=z,xK=z=DJ(z.current,null),ZK=R4=C_,$K=0,X9=null,Fte=WZ=wJ=0,b4=Q9=null,d7!==null){for(C_=0;C_<d7.length;C_++)if(hN=d7[C_],gN=hN.interleaved,gN!==null){hN.interleaved=null;var t3=gN.next,sH=hN.pending;if(sH!==null){var mH=sH.next;sH.next=t3,gN.next=mH}hN.pending=gN}d7=null}return z}function XZ(z,C_){do{var hN=xK;try{if(tte(),NZ.current=sY,_7){for(var gN=IK.memoizedState;gN!==null;){var t3=gN.queue;t3!==null&&(t3.pending=null),gN=gN.next}_7=!1}if(f7=0,c4=qK=IK=null,mX=!1,UY=0,S7.current=null,hN===null||hN.return===null){$K=1,X9=C_,xK=null;break}e:{var sH=z,mH=hN.return,DH=hN,FH=C_;if(C_=ZK,DH.flags|=32768,FH!==null&&typeof FH=="object"&&typeof FH.then=="function"){var s5=FH,R5=DH,b5=R5.tag;if(!(R5.mode&1)&&(b5===0||b5===11||b5===15)){var S5=R5.alternate;S5?(R5.updateQueue=S5.updateQueue,R5.memoizedState=S5.memoizedState,R5.lanes=S5.lanes):(R5.updateQueue=null,R5.memoizedState=null)}var L5=bte(mH);if(L5!==null){L5.flags&=-257,Rie(L5,mH,DH,sH,C_),L5.mode&1&&yie(sH,s5,C_),C_=L5,FH=s5;var V5=C_.updateQueue;if(V5===null){var j5=new Set;j5.add(FH),C_.updateQueue=j5}else V5.add(FH);break e}else{if(!(C_&1)){yie(sH,s5,C_),QZ();break e}FH=Error(i(426))}}else if(RK&&DH.mode&1){var VK=bte(mH);if(VK!==null){!(VK.flags&65536)&&(VK.flags|=256),Rie(VK,mH,DH,sH,C_),RZ(yX(FH,DH));break e}}sH=FH=yX(FH,DH),$K!==4&&($K=2),Q9===null?Q9=[sH]:Q9.push(sH),sH=mH;do{switch(sH.tag){case 3:sH.flags|=65536,C_&=-C_,sH.lanes|=C_;var QH=UZ(sH,FH,C_);oie(sH,QH);break e;case 1:DH=FH;var WH=sH.type,t5=sH.stateNode;if(!(sH.flags&128)&&(typeof WH.getDerivedStateFromError=="function"||t5!==null&&typeof t5.componentDidCatch=="function"&&(AJ===null||!AJ.has(t5)))){sH.flags|=65536,C_&=-C_,sH.lanes|=C_;var C5=Rte(sH,DH,C_);oie(sH,C5);break e}}sH=sH.return}while(sH!==null)}Gte(hN)}catch(G5){C_=G5,xK===hN&&hN!==null&&(xK=hN=hN.return);continue}break}while(!0)}function Bte(){var z=GZ.current;return GZ.current=sY,z===null?sY:z}function QZ(){($K===0||$K===3||$K===2)&&($K=4),wK===null||!(wJ&268435455)&&!(WZ&268435455)||BY(wK,ZK)}function y7(z,C_){var hN=P6;P6|=2;var gN=Bte();(wK!==z||ZK!==C_)&&(U4=null,GY(z,C_));do try{jie();break}catch(t3){XZ(z,t3)}while(!0);if(tte(),P6=hN,GZ.current=gN,xK!==null)throw Error(i(261));return wK=null,ZK=0,$K}function jie(){for(;xK!==null;)Bie(xK)}function mce(){for(;xK!==null&&!hae();)Bie(xK)}function Bie(z){var C_=R7(z.alternate,z,R4);z.memoizedProps=z.pendingProps,C_===null?Gte(z):xK=C_,S7.current=null}function Gte(z){var C_=z;do{var hN=C_.alternate;if(z=C_.return,C_.flags&32768){if(hN=VZ(hN,C_),hN!==null){hN.flags&=32767,xK=hN;return}if(z!==null)z.flags|=32768,z.subtreeFlags=0,z.deletions=null;else{$K=6,xK=null;return}}else if(hN=Pie(hN,C_,R4),hN!==null){xK=hN;return}if(C_=C_.sibling,C_!==null){xK=C_;return}xK=C_=z}while(C_!==null);$K===0&&($K=5)}function NJ(z,C_,hN){var gN=tK,t3=c8.transition;try{c8.transition=null,tK=1,IX(z,C_,hN,gN)}finally{c8.transition=t3,tK=gN}return null}function IX(z,C_,hN,gN){do PJ();while(jY!==null);if(P6&6)throw Error(i(327));hN=z.finishedWork;var t3=z.finishedLanes;if(hN===null)return null;if(z.finishedWork=null,z.finishedLanes=0,hN===z.current)throw Error(i(177));z.callbackNode=null,z.callbackPriority=0;var sH=hN.lanes|hN.childLanes;if(yae(z,sH),z===wK&&(xK=wK=null,ZK=0),!(hN.subtreeFlags&2064)&&!(hN.flags&2064)||HZ||(HZ=!0,Wie(qQ,function(){return PJ(),null})),sH=(hN.flags&15990)!==0,hN.subtreeFlags&15990||sH){sH=c8.transition,c8.transition=null;var mH=tK;tK=1;var DH=P6;P6|=4,S7.current=null,pce(z,hN),xie(hN,z),Xae(Kee),ZQ=!!hZ,Kee=hZ=null,z.current=hN,fce(hN),pae(),P6=DH,tK=mH,c8.transition=sH}else z.current=hN;if(HZ&&(HZ=!1,jY=z,qZ=t3),sH=z.pendingLanes,sH===0&&(AJ=null),Eae(hN.stateNode),v4(z,Q6()),C_!==null)for(gN=z.onRecoverableError,hN=0;hN<C_.length;hN++)t3=C_[hN],gN(t3.value,{componentStack:t3.stack,digest:t3.digest});if(Z9)throw Z9=!1,z=x4,x4=null,z;return qZ&1&&z.tag!==0&&PJ(),sH=z.pendingLanes,sH&1?z===KZ?CX++:(CX=0,KZ=z):CX=0,RJ(),null}function PJ(){if(jY!==null){var z=YQ(qZ),C_=c8.transition,hN=tK;try{if(c8.transition=null,tK=16>z?16:z,jY===null)var gN=!1;else{if(z=jY,jY=null,qZ=0,P6&6)throw Error(i(331));var t3=P6;for(P6|=4,x5=z.current;x5!==null;){var sH=x5,mH=sH.child;if(x5.flags&16){var DH=sH.deletions;if(DH!==null){for(var FH=0;FH<DH.length;FH++){var s5=DH[FH];for(x5=s5;x5!==null;){var R5=x5;switch(R5.tag){case 0:case 11:case 15:J9(8,R5,sH)}var b5=R5.child;if(b5!==null)b5.return=R5,x5=b5;else for(;x5!==null;){R5=x5;var S5=R5.sibling,L5=R5.return;if(Lie(R5),R5===s5){x5=null;break}if(S5!==null){S5.return=L5,x5=S5;break}x5=L5}}}var V5=sH.alternate;if(V5!==null){var j5=V5.child;if(j5!==null){V5.child=null;do{var VK=j5.sibling;j5.sibling=null,j5=VK}while(j5!==null)}}x5=sH}}if(sH.subtreeFlags&2064&&mH!==null)mH.return=sH,x5=mH;else e:for(;x5!==null;){if(sH=x5,sH.flags&2048)switch(sH.tag){case 0:case 11:case 15:J9(9,sH,sH.return)}var QH=sH.sibling;if(QH!==null){QH.return=sH.return,x5=QH;break e}x5=sH.return}}var WH=z.current;for(x5=WH;x5!==null;){mH=x5;var t5=mH.child;if(mH.subtreeFlags&2064&&t5!==null)t5.return=mH,x5=t5;else e:for(mH=WH;x5!==null;){if(DH=x5,DH.flags&2048)try{switch(DH.tag){case 0:case 11:case 15:T7(9,DH)}}catch(G5){bK(DH,DH.return,G5)}if(DH===mH){x5=null;break e}var C5=DH.sibling;if(C5!==null){C5.return=DH.return,x5=C5;break e}x5=DH.return}}if(P6=t3,RJ(),_8&&typeof _8.onPostCommitFiberRoot=="function")try{_8.onPostCommitFiberRoot(KQ,z)}catch{}gN=!0}return gN}finally{tK=hN,c8.transition=C_}}return!1}function ZZ(z,C_,hN){C_=yX(hN,C_),C_=UZ(z,C_,1),z=vJ(z,C_,1),C_=V4(),z!==null&&(s9(z,1,C_),v4(z,C_))}function bK(z,C_,hN){if(z.tag===3)ZZ(z,z,hN);else for(;C_!==null;){if(C_.tag===3){ZZ(C_,z,hN);break}else if(C_.tag===1){var gN=C_.stateNode;if(typeof C_.type.getDerivedStateFromError=="function"||typeof gN.componentDidCatch=="function"&&(AJ===null||!AJ.has(gN))){z=yX(hN,z),z=Rte(C_,z,1),C_=vJ(C_,z,1),z=V4(),C_!==null&&(s9(C_,1,z),v4(C_,z));break}}C_=C_.return}}function Gie(z,C_,hN){var gN=z.pingCache;gN!==null&&gN.delete(C_),C_=V4(),z.pingedLanes|=z.suspendedLanes&hN,wK===z&&(ZK&hN)===hN&&($K===4||$K===3&&(ZK&130023424)===ZK&&500>Q6()-cY?GY(z,0):Fte|=hN),v4(z,C_)}function Wte(z,C_){C_===0&&(z.mode&1?(C_=J7,J7<<=1,!(J7&130023424)&&(J7=4194304)):C_=1);var hN=V4();z=tY(z,C_),z!==null&&(s9(z,C_,hN),v4(z,hN))}function gce(z){var C_=z.memoizedState,hN=0;C_!==null&&(hN=C_.retryLane),Wte(z,hN)}function Tce(z,C_){var hN=0;switch(z.tag){case 13:var gN=z.stateNode,t3=z.memoizedState;t3!==null&&(hN=t3.retryLane);break;case 19:gN=z.stateNode;break;default:throw Error(i(314))}gN!==null&&gN.delete(C_),Wte(z,hN)}var R7;R7=function(z,C_,hN){if(z!==null)if(z.memoizedProps!==C_.pendingProps||Y4.current)X4=!0;else{if(!(z.lanes&hN)&&!(C_.flags&128))return X4=!1,hce(z,C_,hN);X4=!!(z.flags&131072)}else X4=!1,RK&&C_.flags&1048576&&$re(C_,TZ,C_.index);switch(C_.lanes=0,C_.tag){case 2:var gN=C_.type;q9(z,C_),z=C_.pendingProps;var t3=s7(C_,g4.current);u7(C_,hN),t3=dte(null,C_,gN,z,t3,hN);var sH=gX();return C_.flags|=1,typeof t3=="object"&&t3!==null&&typeof t3.render=="function"&&t3.$$typeof===void 0?(C_.tag=1,C_.memoizedState=null,C_.updateQueue=null,T4(gN)?(sH=!0,mZ(C_)):sH=!1,C_.memoizedState=t3.state!==null&&t3.state!==void 0?t3.state:null,IZ(C_),t3.updater=W9,C_.stateNode=t3,t3._reactInternals=C_,Ste(C_,gN,z,hN),C_=Ite(null,C_,gN,!0,sH,hN)):(C_.tag=0,RK&&sH&&Qee(C_),M4(null,C_,t3,hN),C_=C_.child),C_;case 16:gN=C_.elementType;e:{switch(q9(z,C_),z=C_.pendingProps,t3=gN._init,gN=t3(gN._payload),C_.type=gN,t3=C_.tag=Sce(gN),z=U8(gN,z),t3){case 0:C_=Cte(null,C_,gN,z,hN);break e;case 1:C_=Iie(null,C_,gN,z,hN);break e;case 11:C_=bie(null,C_,gN,z,hN);break e;case 14:C_=vie(null,C_,gN,U8(gN.type,z),hN);break e}throw Error(i(306,gN,""))}return C_;case 0:return gN=C_.type,t3=C_.pendingProps,t3=C_.elementType===gN?t3:U8(gN,t3),Cte(z,C_,gN,t3,hN);case 1:return gN=C_.type,t3=C_.pendingProps,t3=C_.elementType===gN?t3:U8(gN,t3),Iie(z,C_,gN,t3,hN);case 3:e:{if(wie(C_),z===null)throw Error(i(387));gN=C_.pendingProps,sH=C_.memoizedState,t3=sH.element,sie(z,C_),wZ(C_,gN,null,hN);var mH=C_.memoizedState;if(gN=mH.element,sH.isDehydrated)if(sH={element:gN,isDehydrated:!1,cache:mH.cache,pendingSuspenseBoundaries:mH.pendingSuspenseBoundaries,transitions:mH.transitions},C_.updateQueue.baseState=sH,C_.memoizedState=sH,C_.flags&256){t3=yX(Error(i(423)),C_),C_=Aie(z,C_,gN,hN,t3);break e}else if(gN!==t3){t3=yX(Error(i(424)),C_),C_=Aie(z,C_,gN,hN,t3);break e}else for(o8=OY(C_.stateNode.containerInfo.firstChild),J4=C_,RK=!0,T8=null,hN=rie(C_,null,gN,hN),C_.child=hN;hN;)hN.flags=hN.flags&-3|4096,hN=hN.sibling;else{if(c7(),gN===t3){C_=VY(z,C_,hN);break e}M4(z,C_,gN,hN)}C_=C_.child}return C_;case 5:return ste(C_),z===null&&L9(C_),gN=C_.type,t3=C_.pendingProps,sH=z!==null?z.memoizedProps:null,mH=t3.children,pZ(gN,t3)?mH=null:sH!==null&&pZ(gN,sH)&&(C_.flags|=32),oY(z,C_),M4(z,C_,mH,hN),C_.child;case 6:return z===null&&L9(C_),null;case 13:return Oie(z,C_,hN);case 4:return AZ(C_,C_.stateNode.containerInfo),gN=C_.pendingProps,z===null?C_.child=fX(C_,null,gN,hN):M4(z,C_,gN,hN),C_.child;case 11:return gN=C_.type,t3=C_.pendingProps,t3=C_.elementType===gN?t3:U8(gN,t3),bie(z,C_,gN,t3,hN);case 7:return M4(z,C_,C_.pendingProps,hN),C_.child;case 8:return M4(z,C_,C_.pendingProps.children,hN),C_.child;case 12:return M4(z,C_,C_.pendingProps.children,hN),C_.child;case 10:e:{if(gN=C_.type._context,t3=C_.pendingProps,sH=C_.memoizedProps,mH=t3.value,iK(U9,gN._currentValue),gN._currentValue=mH,sH!==null)if(L8(sH.value,mH)){if(sH.children===t3.children&&!Y4.current){C_=VY(z,C_,hN);break e}}else for(sH=C_.child,sH!==null&&(sH.return=C_);sH!==null;){var DH=sH.dependencies;if(DH!==null){mH=sH.child;for(var FH=DH.firstContext;FH!==null;){if(FH.context===gN){if(sH.tag===1){FH=MY(-1,hN&-hN),FH.tag=2;var s5=sH.updateQueue;if(s5!==null){s5=s5.shared;var R5=s5.pending;R5===null?FH.next=FH:(FH.next=R5.next,R5.next=FH),s5.pending=FH}}sH.lanes|=hN,FH=sH.alternate,FH!==null&&(FH.lanes|=hN),rte(sH.return,hN,C_),DH.lanes|=hN;break}FH=FH.next}}else if(sH.tag===10)mH=sH.type===C_.type?null:sH.child;else if(sH.tag===18){if(mH=sH.return,mH===null)throw Error(i(341));mH.lanes|=hN,DH=mH.alternate,DH!==null&&(DH.lanes|=hN),rte(mH,hN,C_),mH=sH.sibling}else mH=sH.child;if(mH!==null)mH.return=sH;else for(mH=sH;mH!==null;){if(mH===C_){mH=null;break}if(sH=mH.sibling,sH!==null){sH.return=mH.return,mH=sH;break}mH=mH.return}sH=mH}M4(z,C_,t3.children,hN),C_=C_.child}return C_;case 9:return t3=C_.type,gN=C_.pendingProps.children,u7(C_,hN),t3=a4(t3),gN=gN(t3),C_.flags|=1,M4(z,C_,gN,hN),C_.child;case 14:return gN=C_.type,t3=U8(gN,C_.pendingProps),t3=U8(gN.type,t3),vie(z,C_,gN,t3,hN);case 15:return Cie(z,C_,C_.type,C_.pendingProps,hN);case 17:return gN=C_.type,t3=C_.pendingProps,t3=C_.elementType===gN?t3:U8(gN,t3),q9(z,C_),C_.tag=1,T4(gN)?(z=!0,mZ(C_)):z=!1,u7(C_,hN),xY(C_,gN,t3),Ste(C_,gN,t3,hN),Ite(null,C_,gN,!0,z,hN);case 19:return Nte(z,C_,hN);case 22:return vte(z,C_,hN)}throw Error(i(156,C_.tag))};function Wie(z,C_){return vee(z,C_)}function Hie(z,C_,hN,gN){this.tag=z,this.key=hN,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=C_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=gN,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Q4(z,C_,hN,gN){return new Hie(z,C_,hN,gN)}function Hte(z){return z=z.prototype,!(!z||!z.isReactComponent)}function Sce(z){if(typeof z=="function")return Hte(z)?1:0;if(z!=null){if(z=z.$$typeof,z===VH)return 11;if(z===MH)return 14}return 2}function DJ(z,C_){var hN=z.alternate;return hN===null?(hN=Q4(z.tag,C_,z.key,z.mode),hN.elementType=z.elementType,hN.type=z.type,hN.stateNode=z.stateNode,hN.alternate=z,z.alternate=hN):(hN.pendingProps=C_,hN.type=z.type,hN.flags=0,hN.subtreeFlags=0,hN.deletions=null),hN.flags=z.flags&14680064,hN.childLanes=z.childLanes,hN.lanes=z.lanes,hN.child=z.child,hN.memoizedProps=z.memoizedProps,hN.memoizedState=z.memoizedState,hN.updateQueue=z.updateQueue,C_=z.dependencies,hN.dependencies=C_===null?null:{lanes:C_.lanes,firstContext:C_.firstContext},hN.sibling=z.sibling,hN.index=z.index,hN.ref=z.ref,hN}function $Z(z,C_,hN,gN,t3,sH){var mH=2;if(gN=z,typeof z=="function")Hte(z)&&(mH=1);else if(typeof z=="string")mH=5;else e:switch(z){case AH:return WY(hN.children,t3,sH,C_);case UH:mH=8,t3|=8;break;case zH:return z=Q4(12,hN,C_,t3|2),z.elementType=zH,z.lanes=sH,z;case KH:return z=Q4(13,hN,C_,t3),z.elementType=KH,z.lanes=sH,z;case IH:return z=Q4(19,hN,C_,t3),z.elementType=IH,z.lanes=sH,z;case yH:return nQ(hN,t3,sH,C_);default:if(typeof z=="object"&&z!==null)switch(z.$$typeof){case CH:mH=10;break e;case HH:mH=9;break e;case VH:mH=11;break e;case MH:mH=14;break e;case GH:mH=16,gN=null;break e}throw Error(i(130,z==null?z:typeof z,""))}return C_=Q4(mH,hN,C_,t3),C_.elementType=z,C_.type=gN,C_.lanes=sH,C_}function WY(z,C_,hN,gN){return z=Q4(7,z,gN,C_),z.lanes=hN,z}function nQ(z,C_,hN,gN){return z=Q4(22,z,gN,C_),z.elementType=yH,z.lanes=hN,z.stateNode={isHidden:!1},z}function e$(z,C_,hN){return z=Q4(6,z,null,C_),z.lanes=hN,z}function t$(z,C_,hN){return C_=Q4(4,z.children!==null?z.children:[],z.key,C_),C_.lanes=hN,C_.stateNode={containerInfo:z.containerInfo,pendingChildren:null,implementation:z.implementation},C_}function n$(z,C_,hN,gN,t3){this.tag=C_,this.containerInfo=z,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Iee(0),this.expirationTimes=Iee(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Iee(0),this.identifierPrefix=gN,this.onRecoverableError=t3,this.mutableSourceEagerHydrationData=null}function rQ(z,C_,hN,gN,t3,sH,mH,DH,FH){return z=new n$(z,C_,hN,DH,FH),C_===1?(C_=1,sH===!0&&(C_|=8)):C_=0,sH=Q4(3,null,null,C_),z.current=sH,sH.stateNode=z,sH.memoizedState={element:gN,isDehydrated:hN,cache:null,transitions:null,pendingSuspenseBoundaries:null},IZ(sH),z}function r$(z,C_,hN){var gN=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vH,key:gN==null?null:""+gN,children:z,containerInfo:C_,implementation:hN}}function iQ(z){if(!z)return SJ;z=z._reactInternals;e:{if(e7(z)!==z||z.tag!==1)throw Error(i(170));var C_=z;do{switch(C_.tag){case 3:C_=C_.stateNode.context;break e;case 1:if(T4(C_.type)){C_=C_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}C_=C_.return}while(C_!==null);throw Error(i(171))}if(z.tag===1){var hN=z.type;if(T4(hN))return uX(z,hN,C_)}return C_}function qte(z,C_,hN,gN,t3,sH,mH,DH,FH){return z=rQ(hN,gN,!0,z,t3,sH,mH,DH,FH),z.context=iQ(null),hN=z.current,gN=V4(),t3=OJ(hN),sH=MY(gN,t3),sH.callback=C_??null,vJ(hN,sH,t3),z.current.lanes=t3,s9(z,t3,gN),v4(z,gN),z}function HY(z,C_,hN,gN){var t3=C_.current,sH=V4(),mH=OJ(t3);return hN=iQ(hN),C_.context===null?C_.context=hN:C_.pendingContext=hN,C_=MY(sH,mH),C_.payload={element:z},gN=gN===void 0?null:gN,gN!==null&&(C_.callback=gN),z=vJ(t3,C_,mH),z!==null&&(j8(z,t3,mH,sH),l7(z,t3,mH)),mH}function uY(z){if(z=z.current,!z.child)return null;switch(z.child.tag){case 5:return z.child.stateNode;default:return z.child.stateNode}}function qie(z,C_){if(z=z.memoizedState,z!==null&&z.dehydrated!==null){var hN=z.retryLane;z.retryLane=hN!==0&&hN<C_?hN:C_}}function b7(z,C_){qie(z,C_),(z=z.alternate)&&qie(z,C_)}var Kie=typeof reportError=="function"?reportError:function(z){console.error(z)};function Kte(z){this._internalRoot=z}i$.prototype.render=Kte.prototype.render=function(z){var C_=this._internalRoot;if(C_===null)throw Error(i(409));HY(z,C_,null,null)},i$.prototype.unmount=Kte.prototype.unmount=function(){var z=this._internalRoot;if(z!==null){this._internalRoot=null;var C_=z.containerInfo;B8(function(){HY(null,z,null,null)}),C_[NY]=null}};function i$(z){this._internalRoot=z}i$.prototype.unstable_scheduleHydration=function(z){if(z){var C_=JQ();z={blockedOn:null,target:z,priority:C_};for(var hN=0;hN<pJ.length&&C_!==0&&C_<pJ[hN].priority;hN++);pJ.splice(hN,0,z),hN===0&&Cre(z)}};function zte(z){return!(!z||z.nodeType!==1&&z.nodeType!==9&&z.nodeType!==11)}function sQ(z){return!(!z||z.nodeType!==1&&z.nodeType!==9&&z.nodeType!==11&&(z.nodeType!==8||z.nodeValue!==" react-mount-point-unstable "))}function s$(){}function zie(z,C_,hN,gN,t3){if(t3){if(typeof gN=="function"){var sH=gN;gN=function(){var s5=uY(mH);sH.call(s5)}}var mH=qte(C_,gN,z,0,null,!1,!1,"",s$);return z._reactRootContainer=mH,z[NY]=mH.current,O9(z.nodeType===8?z.parentNode:z),B8(),mH}for(;t3=z.lastChild;)z.removeChild(t3);if(typeof gN=="function"){var DH=gN;gN=function(){var s5=uY(FH);DH.call(s5)}}var FH=rQ(z,0,!1,null,null,!1,!1,"",s$);return z._reactRootContainer=FH,z[NY]=FH.current,O9(z.nodeType===8?z.parentNode:z),B8(function(){HY(C_,FH,hN,gN)}),FH}function o$(z,C_,hN,gN,t3){var sH=hN._reactRootContainer;if(sH){var mH=sH;if(typeof t3=="function"){var DH=t3;t3=function(){var FH=uY(mH);DH.call(FH)}}HY(C_,mH,z,t3)}else mH=zie(hN,C_,z,t3,gN);return uY(mH)}Aee=function(z){switch(z.tag){case 3:var C_=z.stateNode;if(C_.current.memoizedState.isDehydrated){var hN=i9(C_.pendingLanes);hN!==0&&(wee(C_,hN|1),v4(C_,Q6()),!(P6&6)&&(vX=Q6()+500,RJ()))}break;case 13:B8(function(){var gN=tY(z,1);if(gN!==null){var t3=V4();j8(gN,z,1,t3)}}),b7(z,1)}},o9=function(z){if(z.tag===13){var C_=tY(z,134217728);if(C_!==null){var hN=V4();j8(C_,z,134217728,hN)}b7(z,134217728)}},bre=function(z){if(z.tag===13){var C_=OJ(z),hN=tY(z,C_);if(hN!==null){var gN=V4();j8(hN,z,C_,gN)}b7(z,C_)}},JQ=function(){return tK},vre=function(z,C_){var hN=tK;try{return tK=z,C_()}finally{tK=hN}},Tee=function(z,C_,hN){switch(C_){case"input":if(k5(z,hN),C_=hN.name,hN.type==="radio"&&C_!=null){for(hN=z;hN.parentNode;)hN=hN.parentNode;for(hN=hN.querySelectorAll("input[name="+JSON.stringify(""+C_)+'][type="radio"]'),C_=0;C_<hN.length;C_++){var gN=hN[C_];if(gN!==z&&gN.form===z.form){var t3=_Z(gN);if(!t3)throw Error(i(90));i4(gN),k5(gN,t3)}}}break;case"textarea":X6(z,hN);break;case"select":C_=hN.value,C_!=null&&W5(z,!!hN.multiple,C_,!1)}},$J=tQ,pre=B8;var Yie={usingClientEntryPoint:!1,Events:[k9,aX,_Z,z7,hre,tQ]},wX={findFiberByHostInstance:i7,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yce={bundleType:wX.bundleType,version:wX.version,rendererPackageName:wX.rendererPackageName,rendererConfig:wX.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:pH.ReactCurrentDispatcher,findHostInstanceByFiber:function(z){return z=bee(z),z===null?null:z.stateNode},findFiberByHostInstance:wX.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kJ=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kJ.isDisabled&&kJ.supportsFiber)try{KQ=kJ.inject(yce),_8=kJ}catch{}}return reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yie,reactDom_production_min.createPortal=function(z,C_){var hN=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zte(C_))throw Error(i(200));return r$(z,C_,null,hN)},reactDom_production_min.createRoot=function(z,C_){if(!zte(z))throw Error(i(299));var hN=!1,gN="",t3=Kie;return C_!=null&&(C_.unstable_strictMode===!0&&(hN=!0),C_.identifierPrefix!==void 0&&(gN=C_.identifierPrefix),C_.onRecoverableError!==void 0&&(t3=C_.onRecoverableError)),C_=rQ(z,1,!1,null,null,hN,!1,gN,t3),z[NY]=C_.current,O9(z.nodeType===8?z.parentNode:z),new Kte(C_)},reactDom_production_min.findDOMNode=function(z){if(z==null)return null;if(z.nodeType===1)return z;var C_=z._reactInternals;if(C_===void 0)throw typeof z.render=="function"?Error(i(188)):(z=Object.keys(z).join(","),Error(i(268,z)));return z=bee(C_),z=z===null?null:z.stateNode,z},reactDom_production_min.flushSync=function(z){return B8(z)},reactDom_production_min.hydrate=function(z,C_,hN){if(!sQ(C_))throw Error(i(200));return o$(null,z,C_,!0,hN)},reactDom_production_min.hydrateRoot=function(z,C_,hN){if(!zte(z))throw Error(i(405));var gN=hN!=null&&hN.hydratedSources||null,t3=!1,sH="",mH=Kie;if(hN!=null&&(hN.unstable_strictMode===!0&&(t3=!0),hN.identifierPrefix!==void 0&&(sH=hN.identifierPrefix),hN.onRecoverableError!==void 0&&(mH=hN.onRecoverableError)),C_=qte(C_,null,z,1,hN??null,t3,!1,sH,mH),z[NY]=C_.current,O9(z),gN)for(z=0;z<gN.length;z++)hN=gN[z],t3=hN._getVersion,t3=t3(hN._source),C_.mutableSourceEagerHydrationData==null?C_.mutableSourceEagerHydrationData=[hN,t3]:C_.mutableSourceEagerHydrationData.push(hN,t3);return new i$(C_)},reactDom_production_min.render=function(z,C_,hN){if(!sQ(C_))throw Error(i(200));return o$(null,z,C_,!1,hN)},reactDom_production_min.unmountComponentAtNode=function(z){if(!sQ(z))throw Error(i(40));return z._reactRootContainer?(B8(function(){o$(null,null,z,!1,function(){z._reactRootContainer=null,z[NY]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=tQ,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(z,C_,hN,gN){if(!sQ(hN))throw Error(i(200));if(z==null||z._reactInternals===void 0)throw Error(i(38));return o$(z,C_,hN,!1,gN)},reactDom_production_min.version="18.3.1-next-f1338f8080-20240426",reactDom_production_min}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}return e(),reactDom.exports=requireReactDom_production_min(),reactDom.exports}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client$1;hasRequiredClient=1;var e=requireReactDom();return client$1.createRoot=e.createRoot,client$1.hydrateRoot=e.hydrateRoot,client$1}var clientExports=requireClient();/**
 * @license agora-rtc-react
 * @version 2.3.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */function yN(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var h=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,h.get?h:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ae(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Se=function(e){try{return!!e()}catch{return!0}},vu=!Se(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),IA=vu,vA=Function.prototype,G_=vA.call,AN=IA&&vA.bind.bind(G_,G_),me=IA?AN:function(e){return function(){return G_.apply(e,arguments)}},hn=me({}.isPrototypeOf),cd=function(e){return e&&e.Math==Math&&e},We=cd(typeof globalThis=="object"&&globalThis)||cd(typeof window=="object"&&window)||cd(typeof self=="object"&&self)||cd(typeof Vs=="object"&&Vs)||function(){return this}()||Vs||Function("return this")(),bN=vu,yA=Function.prototype,Xf=yA.apply,Qf=yA.call,vm=typeof Reflect=="object"&&Reflect.apply||(bN?Qf.bind(Xf):function(){return Qf.apply(Xf,arguments)}),AA=me,wN=AA({}.toString),ON=AA("".slice),pr=function(e){return ON(wN(e),8,-1)},NN=pr,DN=me,gc=function(e){if(NN(e)==="Function")return DN(e)},uh=typeof document=="object"&&document.all,yu={all:uh,IS_HTMLDDA:uh===void 0&&uh!==void 0},PN=yu.all,He=yu.IS_HTMLDDA?function(e){return typeof e=="function"||e===PN}:function(e){return typeof e=="function"},Yc={},ri=!Se(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),kN=vu,dd=Function.prototype.call,Ke=kN?dd.bind(dd):function(){return dd.apply(dd,arguments)},Au={},bA={}.propertyIsEnumerable,wA=Object.getOwnPropertyDescriptor,LN=wA&&!bA.call({1:2},1);Au.f=LN?function(e){var r=wA(this,e);return!!r&&r.enumerable}:bA;var xr,rl,_o=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},MN=Se,UN=pr,hh=Object,xN=me("".split),bu=MN(function(){return!hh("z").propertyIsEnumerable(0)})?function(e){return UN(e)=="String"?xN(e,""):hh(e)}:hh,da=function(e){return e==null},VN=da,FN=TypeError,la=function(e){if(VN(e))throw FN("Can't call method on "+e);return e},BN=bu,jN=la,Eo=function(e){return BN(jN(e))},Zf=He,GN=yu.all,Hn=yu.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Zf(e)||e===GN}:function(e){return typeof e=="object"?e!==null:Zf(e)},Gi={},ph=Gi,_h=We,WN=He,$f=function(e){return WN(e)?e:void 0},Dn=function(e,r){return arguments.length<2?$f(ph[e])||$f(_h[e]):ph[e]&&ph[e][r]||_h[e]&&_h[e][r]},$o=typeof navigator<"u"&&String(navigator.userAgent)||"",OA=We,Eh=$o,tg=OA.process,eg=OA.Deno,ng=tg&&tg.versions||eg&&eg.version,ig=ng&&ng.v8;ig&&(rl=(xr=ig.split("."))[0]>0&&xr[0]<4?1:+(xr[0]+xr[1])),!rl&&Eh&&(!(xr=Eh.match(/Edge\/(\d+)/))||xr[1]>=74)&&(xr=Eh.match(/Chrome\/(\d+)/))&&(rl=+xr[1]);var zo=rl,rg=zo,HN=Se,KN=We.String,ua=!!Object.getOwnPropertySymbols&&!HN(function(){var e=Symbol();return!KN(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&rg&&rg<41}),NA=ua&&!Symbol.sham&&typeof Symbol.iterator=="symbol",YN=Dn,qN=He,zN=hn,JN=Object,qc=NA?function(e){return typeof e=="symbol"}:function(e){var r=YN("Symbol");return qN(r)&&zN(r.prototype,JN(e))},XN=String,ha=function(e){try{return XN(e)}catch{return"Object"}},QN=He,ZN=ha,$N=TypeError,yi=function(e){if(QN(e))return e;throw $N(ZN(e)+" is not a function")},tD=yi,eD=da,wu=function(e,r){var i=e[r];return eD(i)?void 0:tD(i)},mh=Ke,fh=He,gh=Hn,nD=TypeError,DA={exports:{}},og=We,iD=Object.defineProperty,rD=function(e,r){try{iD(og,e,{value:r,configurable:!0,writable:!0})}catch{og[e]=r}return r},sg="__core-js_shared__",ym=We[sg]||rD(sg,{}),ag=ym;(DA.exports=function(e,r){return ag[e]||(ag[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var pa=DA.exports,oD=la,sD=Object,_r=function(e){return sD(oD(e))},aD=_r,cD=me({}.hasOwnProperty),Je=Object.hasOwn||function(e,r){return cD(aD(e),r)},dD=me,lD=0,uD=Math.random(),hD=dD(1 .toString),Am=function(e){return"Symbol("+(e===void 0?"":e)+")_"+hD(++lD+uD,36)},pD=pa,cg=Je,_D=Am,ED=ua,mD=NA,ws=We.Symbol,Th=pD("wks"),fD=mD?ws.for||ws:ws&&ws.withoutSetter||_D,pe=function(e){return cg(Th,e)||(Th[e]=ED&&cg(ws,e)?ws[e]:fD("Symbol."+e)),Th[e]},gD=Ke,dg=Hn,lg=qc,TD=wu,SD=function(e,r){var i,o;if(fh(i=e.toString)&&!gh(o=mh(i,e))||fh(i=e.valueOf)&&!gh(o=mh(i,e))||r!=="string")return o;throw nD("Can't convert object to primitive value")},RD=TypeError,CD=pe("toPrimitive"),ID=function(e,r){if(!dg(e)||lg(e))return e;var i,o=TD(e,CD);if(o){if(i=gD(o,e,r),!dg(i)||lg(i))return i;throw RD("Can't convert object to primitive value")}return SD(e,r)},vD=qc,Ou=function(e){var r=ID(e,"string");return vD(r)?r:r+""},ug=Hn,W_=We.document,yD=ug(W_)&&ug(W_.createElement),bm=function(e){return yD?W_.createElement(e):{}},AD=bm,PA=!ri&&!Se(function(){return Object.defineProperty(AD("div"),"a",{get:function(){return 7}}).a!=7}),bD=ri,wD=Ke,OD=Au,ND=_o,DD=Eo,PD=Ou,kD=Je,LD=PA,hg=Object.getOwnPropertyDescriptor;Yc.f=bD?hg:function(e,r){if(e=DD(e),r=PD(r),LD)try{return hg(e,r)}catch{}if(kD(e,r))return ND(!wD(OD.f,e,r),e[r])};var MD=Se,UD=He,xD=/#|\.prototype\./,zc=function(e,r){var i=FD[VD(e)];return i==jD||i!=BD&&(UD(r)?MD(r):!!r)},VD=zc.normalize=function(e){return String(e).replace(xD,".").toLowerCase()},FD=zc.data={},BD=zc.NATIVE="N",jD=zc.POLYFILL="P",kA=zc,GD=yi,WD=vu,HD=gc(gc.bind),mo=function(e,r){return GD(e),r===void 0?e:WD?HD(e,r):function(){return e.apply(r,arguments)}},Ai={},LA=ri&&Se(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),KD=Hn,YD=String,qD=TypeError,Cn=function(e){if(KD(e))return e;throw qD(YD(e)+" is not an object")},zD=ri,JD=PA,XD=LA,ld=Cn,pg=Ou,QD=TypeError,Sh=Object.defineProperty,ZD=Object.getOwnPropertyDescriptor,Rh="enumerable",Ch="configurable",Ih="writable";Ai.f=zD?XD?function(e,r,i){if(ld(e),r=pg(r),ld(i),typeof e=="function"&&r==="prototype"&&"value"in i&&Ih in i&&!i[Ih]){var o=ZD(e,r);o&&o[Ih]&&(e[r]=i.value,i={configurable:Ch in i?i[Ch]:o[Ch],enumerable:Rh in i?i[Rh]:o[Rh],writable:!1})}return Sh(e,r,i)}:Sh:function(e,r,i){if(ld(e),r=pg(r),ld(i),JD)try{return Sh(e,r,i)}catch{}if("get"in i||"set"in i)throw QD("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var $D=Ai,tP=_o,fo=ri?function(e,r,i){return $D.f(e,r,tP(1,i))}:function(e,r,i){return e[r]=i,e},ud=We,eP=vm,nP=gc,iP=He,rP=Yc.f,oP=kA,os=Gi,sP=mo,ss=fo,_g=Je,aP=function(e){var r=function(i,o,h){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,h)}return eP(e,this,arguments)};return r.prototype=e.prototype,r},xt=function(e,r){var i,o,h,p,g,C,A,x,_e,cN=e.target,dN=e.global,fN=e.stat,mN=e.proto,EN=dN?ud:fN?ud[cN]:(ud[cN]||{}).prototype,RN=dN?os:os[cN]||ss(os,cN,{})[cN],IN=RN.prototype;for(p in r)o=!(i=oP(dN?p:cN+(fN?".":"#")+p,e.forced))&&EN&&_g(EN,p),C=RN[p],o&&(A=e.dontCallGetSet?(_e=rP(EN,p))&&_e.value:EN[p]),g=o&&A?A:r[p],o&&typeof C==typeof g||(x=e.bind&&o?sP(g,ud):e.wrap&&o?aP(g):mN&&iP(g)?nP(g):g,(e.sham||g&&g.sham||C&&C.sham)&&ss(x,"sham",!0),ss(RN,p,x),mN&&(_g(os,h=cN+"Prototype")||ss(os,h,{}),ss(os[h],p,g),e.real&&IN&&(i||!IN[p])&&ss(IN,p,g)))},cP=Math.ceil,dP=Math.floor,lP=Math.trunc||function(e){var r=+e;return(r>0?dP:cP)(r)},uP=lP,wm=function(e){var r=+e;return r!=r||r===0?0:uP(r)},hP=wm,pP=Math.max,_P=Math.min,Om=function(e,r){var i=hP(e);return i<0?pP(i+r,0):_P(i,r)},EP=wm,mP=Math.min,MA=function(e){return e>0?mP(EP(e),9007199254740991):0},fP=MA,Lr=function(e){return fP(e.length)},gP=Eo,TP=Om,SP=Lr,Eg=function(e){return function(r,i,o){var h,p=gP(r),g=SP(p),C=TP(o,g);if(e&&i!=i){for(;g>C;)if((h=p[C++])!=h)return!0}else for(;g>C;C++)if((e||C in p)&&p[C]===i)return e||C||0;return!e&&-1}},Nm={includes:Eg(!0),indexOf:Eg(!1)},RP=Nm.includes;xt({target:"Array",proto:!0,forced:Se(function(){return!Array(1).includes()})},{includes:function(e){return RP(this,e,arguments.length>1?arguments[1]:void 0)}});var CP=Gi,bi=function(e){return CP[e+"Prototype"]},IP=bi("Array").includes,vP=Hn,yP=pr,AP=pe("match"),UA=function(e){var r;return vP(e)&&((r=e[AP])!==void 0?!!r:yP(e)=="RegExp")},bP=UA,wP=TypeError,xA={};xA[pe("toStringTag")]="z";var Dm=String(xA)==="[object z]",OP=Dm,NP=He,ol=pr,DP=pe("toStringTag"),PP=Object,kP=ol(function(){return arguments}())=="Arguments",Er=OP?ol:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(h,p){try{return h[p]}catch{}}(r=PP(e),DP))=="string"?i:kP?ol(r):(o=ol(r))=="Object"&&NP(r.callee)?"Arguments":o},LP=Er,MP=String,oi=function(e){if(LP(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return MP(e)},UP=pe("match"),xP=xt,VP=function(e){if(bP(e))throw wP("The method doesn't accept regular expressions");return e},FP=la,mg=oi,BP=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[UP]=!1,"/./"[e](r)}catch{}}return!1},jP=me("".indexOf);xP({target:"String",proto:!0,forced:!BP("includes")},{includes:function(e){return!!~jP(mg(FP(this)),mg(VP(e)),arguments.length>1?arguments[1]:void 0)}});var GP=bi("String").includes,fg=hn,WP=IP,HP=GP,vh=Array.prototype,yh=String.prototype,KP=function(e){var r=e.includes;return e===vh||fg(vh,e)&&r===vh.includes?WP:typeof e=="string"||e===yh||fg(yh,e)&&r===yh.includes?HP:r},W=ae(KP),YP=yi,qP=_r,zP=bu,JP=Lr,XP=TypeError,gg=function(e){return function(r,i,o,h){YP(i);var p=qP(r),g=zP(p),C=JP(p),A=e?C-1:0,x=e?-1:1;if(o<2)for(;;){if(A in g){h=g[A],A+=x;break}if(A+=x,e?A<0:C<=A)throw XP("Reduce of empty array with no initial value")}for(;e?A>=0:C>A;A+=x)A in g&&(h=i(h,g[A],A,p));return h}},QP={left:gg(!1),right:gg(!0)},ZP=Se,Nu=function(e,r){var i=[][e];return!!i&&ZP(function(){i.call(null,r||function(){return 1},1)})},Jc=typeof process<"u"&&pr(process)=="process",$P=QP.left;xt({target:"Array",proto:!0,forced:!Jc&&zo>79&&zo<83||!Nu("reduce")},{reduce:function(e){var r=arguments.length;return $P(this,e,r,r>1?arguments[1]:void 0)}});var tk=bi("Array").reduce,ek=hn,nk=tk,Ah=Array.prototype,ik=function(e){var r=e.reduce;return e===Ah||ek(Ah,e)&&r===Ah.reduce?nk:r},VA=ik,ji=ae(VA),FA=!0,BA=!0;function hd(e,r,i){let o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function ts(e,r,i){if(!e.RTCPeerConnection)return;let o=e.RTCPeerConnection.prototype,h=o.addEventListener;o.addEventListener=function(g,C){if(g!==r)return h.apply(this,arguments);let A=x=>{let _e=i(x);_e&&(C.handleEvent?C.handleEvent(_e):C(_e))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(C,A),h.apply(this,[g,A])};let p=o.removeEventListener;o.removeEventListener=function(g,C){if(g!==r||!this._eventMap||!this._eventMap[r])return p.apply(this,arguments);if(!this._eventMap[r].has(C))return p.apply(this,arguments);let A=this._eventMap[r].get(C);return this._eventMap[r].delete(C),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,p.apply(this,[g,A])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(g){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),g&&this.addEventListener(r,this["_on"+r]=g)},enumerable:!0,configurable:!0})}function rk(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(FA=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ok(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(BA=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function jA(){if(typeof window=="object"){if(FA)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Pm(e,r){BA&&console.warn(e+" is deprecated, please use "+r+" instead.")}function Tg(e){return Object.prototype.toString.call(e)==="[object Object]"}function GA(e){var r;return Tg(e)?ji(r=Object.keys(e)).call(r,function(i,o){let h=Tg(e[o]),p=h?GA(e[o]):e[o],g=h&&!Object.keys(p).length;return p===void 0||g?i:Object.assign(i,{[o]:p})},{}):e}function H_(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?H_(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(h=>{H_(e,e.get(h),i)})}))}function Sg(e,r,i){let o=i?"outbound-rtp":"inbound-rtp",h=new Map;if(r===null)return h;let p=[];return e.forEach(g=>{g.type==="track"&&g.trackIdentifier===r.id&&p.push(g)}),p.forEach(g=>{e.forEach(C=>{C.type===o&&C.trackId===g.id&&H_(e,C,h)})}),h}var sk=Am,Rg=pa("keys"),Du=function(e){return Rg[e]||(Rg[e]=sk(e))},ak=!Se(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),ck=Je,dk=He,lk=_r,uk=ak,Cg=Du("IE_PROTO"),K_=Object,hk=K_.prototype,km=uk?K_.getPrototypeOf:function(e){var r=lk(e);if(ck(r,Cg))return r[Cg];var i=r.constructor;return dk(i)&&r instanceof i?i.prototype:r instanceof K_?hk:null},pk=me,_k=yi,Ek=He,mk=String,fk=TypeError,gk=function(e,r,i){try{return pk(_k(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},Tk=Cn,Sk=function(e){if(typeof e=="object"||Ek(e))return e;throw fk("Can't set "+mk(e)+" as a prototype")},Rk=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=gk(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,h){return Tk(o),Sk(h),r?e(o,h):o.__proto__=h,o}}():void 0),Pu={},ku={},bh=Je,Ck=Eo,Ik=Nm.indexOf,vk=ku,Ig=me([].push),WA=function(e,r){var i,o=Ck(e),h=0,p=[];for(i in o)!bh(vk,i)&&bh(o,i)&&Ig(p,i);for(;r.length>h;)bh(o,i=r[h++])&&(~Ik(p,i)||Ig(p,i));return p},Lm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yk=WA,Ak=Lm.concat("length","prototype");Pu.f=Object.getOwnPropertyNames||function(e){return yk(e,Ak)};var Xc={};Xc.f=Object.getOwnPropertySymbols;var bk=Dn,wk=Pu,Ok=Xc,Nk=Cn,Dk=me([].concat),Pk=bk("Reflect","ownKeys")||function(e){var r=wk.f(Nk(e)),i=Ok.f;return i?Dk(r,i(e)):r},vg=Je,kk=Pk,Lk=Yc,Mk=Ai,Mm={},Uk=WA,xk=Lm,Lu=Object.keys||function(e){return Uk(e,xk)},Vk=ri,Fk=LA,Bk=Ai,jk=Cn,Gk=Eo,Wk=Lu;Mm.f=Vk&&!Fk?Object.defineProperties:function(e,r){jk(e);for(var i,o=Gk(r),h=Wk(r),p=h.length,g=0;p>g;)Bk.f(e,i=h[g++],o[i]);return e};var pd,HA=Dn("document","documentElement"),Hk=Cn,Kk=Mm,yg=Lm,Yk=ku,qk=HA,zk=bm,Y_="prototype",q_="script",KA=Du("IE_PROTO"),wh=function(){},YA=function(e){return"<"+q_+">"+e+"</"+q_+">"},Ag=function(e){e.write(YA("")),e.close();var r=e.parentWindow.Object;return e=null,r},sl=function(){try{pd=new ActiveXObject("htmlfile")}catch{}var e,r,i;sl=typeof document<"u"?document.domain&&pd?Ag(pd):(r=zk("iframe"),i="java"+q_+":",r.style.display="none",qk.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(YA("document.F=Object")),e.close(),e.F):Ag(pd);for(var o=yg.length;o--;)delete sl[Y_][yg[o]];return sl()};Yk[KA]=!0;var Qc=Object.create||function(e,r){var i;return e!==null?(wh[Y_]=Hk(e),i=new wh,wh[Y_]=null,i[KA]=e):i=sl(),r===void 0?i:Kk.f(i,r)},Jk=Hn,Xk=fo,qA=Error,Qk=me("".replace),Zk=String(qA("zxcasd").stack),zA=/\n\s*at [^:]*:[^\n]*/,$k=zA.test(Zk),tL=_o,eL=!Se(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",tL(1,7)),e.stack!==7)}),nL=fo,iL=function(e,r){if($k&&typeof e=="string"&&!qA.prepareStackTrace)for(;r--;)e=Qk(e,zA,"");return e},rL=eL,bg=Error.captureStackTrace,es={},oL=es,sL=pe("iterator"),aL=Array.prototype,JA=function(e){return e!==void 0&&(oL.Array===e||aL[sL]===e)},cL=Er,wg=wu,dL=da,lL=es,uL=pe("iterator"),Mu=function(e){if(!dL(e))return wg(e,uL)||wg(e,"@@iterator")||lL[cL(e)]},hL=Ke,pL=yi,_L=Cn,EL=ha,mL=Mu,fL=TypeError,Um=function(e,r){var i=arguments.length<2?mL(e):r;if(pL(i))return _L(hL(i,e));throw fL(EL(e)+" is not iterable")},gL=Ke,Og=Cn,TL=wu,XA=function(e,r,i){var o,h;Og(e);try{if(!(o=TL(e,"return"))){if(r==="throw")throw i;return i}o=gL(o,e)}catch(p){h=!0,o=p}if(r==="throw")throw i;if(h)throw o;return Og(o),i},SL=mo,RL=Ke,CL=Cn,IL=ha,vL=JA,yL=Lr,Ng=hn,AL=Um,bL=Mu,Dg=XA,wL=TypeError,al=function(e,r){this.stopped=e,this.result=r},Pg=al.prototype,Zc=function(e,r,i){var o,h,p,g,C,A,x,_e=i&&i.that,cN=!(!i||!i.AS_ENTRIES),dN=!(!i||!i.IS_RECORD),fN=!(!i||!i.IS_ITERATOR),mN=!(!i||!i.INTERRUPTED),EN=SL(r,_e),RN=function(t0){return o&&Dg(o,"normal",t0),new al(!0,t0)},IN=function(t0){return cN?(CL(t0),mN?EN(t0[0],t0[1],RN):EN(t0[0],t0[1])):mN?EN(t0,RN):EN(t0)};if(dN)o=e.iterator;else if(fN)o=e;else{if(!(h=bL(e)))throw wL(IL(e)+" is not iterable");if(vL(h)){for(p=0,g=yL(e);g>p;p++)if((C=IN(e[p]))&&Ng(Pg,C))return C;return new al(!1)}o=AL(e,h)}for(A=dN?e.next:o.next;!(x=RL(A,o)).done;){try{C=IN(x.value)}catch(t0){Dg(o,"throw",t0)}if(typeof C=="object"&&C&&Ng(Pg,C))return C}return new al(!1)},OL=oi,NL=xt,DL=hn,PL=km,Nl=Rk,kL=function(e,r,i){for(var o=kk(r),h=Mk.f,p=Lk.f,g=0;g<o.length;g++){var C=o[g];vg(e,C)||vg(i,C)||h(e,C,p(r,C))}},QA=Qc,Oh=fo,Nh=_o,LL=function(e,r){Jk(r)&&"cause"in r&&Xk(e,"cause",r.cause)},ML=function(e,r,i,o){rL&&(bg?bg(e,r):nL(e,"stack",iL(i,o)))},UL=Zc,xL=function(e,r){return e===void 0?arguments.length<2?"":r:OL(e)},VL=pe("toStringTag"),Dl=Error,FL=[].push,Js=function(e,r){var i,o=DL(Dh,this);Nl?i=Nl(Dl(),o?PL(this):Dh):(i=o?this:QA(Dh),Oh(i,VL,"Error")),r!==void 0&&Oh(i,"message",xL(r)),ML(i,Js,i.stack,1),arguments.length>2&&LL(i,arguments[2]);var h=[];return UL(e,FL,{that:h}),Oh(i,"errors",h),i};Nl?Nl(Js,Dl):kL(Js,Dl,{name:!0});var Dh=Js.prototype=QA(Dl.prototype,{constructor:Nh(1,Js),message:Nh(1,""),name:Nh(1,"AggregateError")});NL({global:!0,constructor:!0,arity:2},{AggregateError:Js});var Pl,nc,kl,BL=He,kg=We.WeakMap,jL=BL(kg)&&/native code/.test(String(kg)),ZA=We,GL=Hn,WL=fo,Ph=Je,kh=ym,HL=Du,KL=ku,Lg="Object already initialized",z_=ZA.TypeError,YL=ZA.WeakMap;jL||kh.state?(Ni=kh.state||(kh.state=new YL),Ni.get=Ni.get,Ni.has=Ni.has,Ni.set=Ni.set,Pl=function(e,r){if(Ni.has(e))throw z_(Lg);return r.facade=e,Ni.set(e,r),r},nc=function(e){return Ni.get(e)||{}},kl=function(e){return Ni.has(e)}):(Co=HL("state"),KL[Co]=!0,Pl=function(e,r){if(Ph(e,Co))throw z_(Lg);return r.facade=e,WL(e,Co,r),r},nc=function(e){return Ph(e,Co)?e[Co]:{}},kl=function(e){return Ph(e,Co)});var Ni,Co,Ho,Mg,Ug,ns={set:Pl,get:nc,has:kl,enforce:function(e){return kl(e)?nc(e):Pl(e,{})},getterFor:function(e){return function(r){var i;if(!GL(r)||(i=nc(r)).type!==e)throw z_("Incompatible receiver, "+e+" required");return i}}},J_=ri,qL=Je,$A=Function.prototype,zL=J_&&Object.getOwnPropertyDescriptor,Lh=qL($A,"name"),tb={EXISTS:Lh,PROPER:Lh&&(function(){}).name==="something",CONFIGURABLE:Lh&&(!J_||J_&&zL($A,"name").configurable)},JL=fo,go=function(e,r,i,o){return o&&o.enumerable?e[r]=i:JL(e,r,i),e},XL=Se,QL=He,ZL=Hn,$L=Qc,xg=km,t1=go,X_=pe("iterator"),eb=!1;[].keys&&("next"in(Ug=[].keys())?(Mg=xg(xg(Ug)))!==Object.prototype&&(Ho=Mg):eb=!0);var e1=!ZL(Ho)||XL(function(){var e={};return Ho[X_].call(e)!==e});QL((Ho=e1?{}:$L(Ho))[X_])||t1(Ho,X_,function(){return this});var nb={IteratorPrototype:Ho,BUGGY_SAFARI_ITERATORS:eb},n1=Er,i1=Dm?{}.toString:function(){return"[object "+n1(this)+"]"},r1=Dm,o1=Ai.f,s1=fo,a1=Je,c1=i1,Vg=pe("toStringTag"),To=function(e,r,i,o){if(e){var h=i?e:e.prototype;a1(h,Vg)||o1(h,Vg,{configurable:!0,value:r}),o&&!r1&&s1(h,"toString",c1)}},d1=nb.IteratorPrototype,l1=Qc,u1=_o,h1=To,p1=es,_1=function(){return this},xm=function(e,r,i,o){var h=r+" Iterator";return e.prototype=l1(d1,{next:u1(+!o,i)}),h1(e,h,!1,!0),p1[h]=_1,e},E1=xt,m1=Ke,f1=tb,g1=xm,T1=km,S1=To,Fg=go,Bg=es,R1=nb,C1=f1.PROPER,_d=R1.BUGGY_SAFARI_ITERATORS,Mh=pe("iterator"),jg="keys",Ed="values",Gg="entries",I1=function(){return this},ib=function(e,r,i,o,h,p,g){g1(i,r,o);var C,A,x,_e=function(IN){if(IN===h&&EN)return EN;if(!_d&&IN in fN)return fN[IN];switch(IN){case jg:case Ed:case Gg:return function(){return new i(this,IN)}}return function(){return new i(this)}},cN=r+" Iterator",dN=!1,fN=e.prototype,mN=fN[Mh]||fN["@@iterator"]||h&&fN[h],EN=!_d&&mN||_e(h),RN=r=="Array"&&fN.entries||mN;if(RN&&(C=T1(RN.call(new e)))!==Object.prototype&&C.next&&(S1(C,cN,!0,!0),Bg[cN]=I1),C1&&h==Ed&&mN&&mN.name!==Ed&&(dN=!0,EN=function(){return m1(mN,this)}),h)if(A={values:_e(Ed),keys:p?EN:_e(jg),entries:_e(Gg)},g)for(x in A)(_d||dN||!(x in fN))&&Fg(fN,x,A[x]);else E1({target:r,proto:!0,forced:_d||dN},A);return g&&fN[Mh]!==EN&&Fg(fN,Mh,EN,{name:h}),Bg[r]=EN,A},Vm=function(e,r){return{value:e,done:r}},v1=Eo,Wg=es,rb=ns;Ai.f;var y1=ib,Hg=Vm,ob="Array Iterator",A1=rb.set,b1=rb.getterFor(ob);y1(Array,"Array",function(e,r){A1(this,{type:ob,target:v1(e),index:0,kind:r})},function(){var e=b1(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,Hg(void 0,!0)):Hg(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),Wg.Arguments=Wg.Array;var w1=Ai,Uu=function(e,r,i){return w1.f(e,r,i)},O1=Dn,N1=Uu,D1=ri,Kg=pe("species"),P1=hn,k1=TypeError,Fm=function(e,r){if(P1(r,e))return e;throw k1("Incorrect invocation")},L1=He,Q_=ym,M1=me(Function.toString);L1(Q_.inspectSource)||(Q_.inspectSource=function(e){return M1(e)});var sb=Q_.inspectSource,U1=me,x1=Se,ab=He,V1=Er,F1=sb,cb=function(){},B1=[],db=Dn("Reflect","construct"),Bm=/^\s*(?:class|function)\b/,j1=U1(Bm.exec),G1=!Bm.exec(cb),Aa=function(e){if(!ab(e))return!1;try{return db(cb,B1,e),!0}catch{return!1}},lb=function(e){if(!ab(e))return!1;switch(V1(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return G1||!!j1(Bm,F1(e))}catch{return!0}};lb.sham=!0;var Tc,as,Yg,Uh,xu=!db||x1(function(){var e;return Aa(Aa.call)||!Aa(Object)||!Aa(function(){e=!0})||e})?lb:Aa,W1=xu,H1=ha,K1=TypeError,qg=Cn,Y1=function(e){if(W1(e))return e;throw K1(H1(e)+" is not a constructor")},q1=da,z1=pe("species"),jm=function(e,r){var i,o=qg(e).constructor;return o===void 0||q1(i=qg(o)[z1])?r:Y1(i)},Gm=me([].slice),J1=TypeError,Vu=function(e,r){if(e<r)throw J1("Not enough arguments");return e},ub=/(?:ipad|iphone|ipod).*applewebkit/i.test($o),ei=We,X1=vm,Q1=mo,zg=He,Z1=Je,hb=Se,Jg=HA,$1=Gm,Xg=bm,tM=Vu,eM=ub,nM=Jc,Z_=ei.setImmediate,$_=ei.clearImmediate,iM=ei.process,xh=ei.Dispatch,rM=ei.Function,Qg=ei.MessageChannel,oM=ei.String,Vh=0,ic={},Zg="onreadystatechange";hb(function(){Tc=ei.location});var Wm=function(e){if(Z1(ic,e)){var r=ic[e];delete ic[e],r()}},Fh=function(e){return function(){Wm(e)}},$g=function(e){Wm(e.data)},tT=function(e){ei.postMessage(oM(e),Tc.protocol+"//"+Tc.host)};Z_&&$_||(Z_=function(e){tM(arguments.length,1);var r=zg(e)?e:rM(e),i=$1(arguments,1);return ic[++Vh]=function(){X1(r,void 0,i)},as(Vh),Vh},$_=function(e){delete ic[e]},nM?as=function(e){iM.nextTick(Fh(e))}:xh&&xh.now?as=function(e){xh.now(Fh(e))}:Qg&&!eM?(Uh=(Yg=new Qg).port2,Yg.port1.onmessage=$g,as=Q1(Uh.postMessage,Uh)):ei.addEventListener&&zg(ei.postMessage)&&!ei.importScripts&&Tc&&Tc.protocol!=="file:"&&!hb(tT)?(as=tT,ei.addEventListener("message",$g,!1)):as=Zg in Xg("script")?function(e){Jg.appendChild(Xg("script"))[Zg]=function(){Jg.removeChild(this),Wm(e)}}:function(e){setTimeout(Fh(e),0)});var pb={set:Z_,clear:$_},_b=function(){this.head=null,this.tail=null};_b.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var cs,Bh,jh,Gh,eT,Eb=_b,sM=/ipad|iphone|ipod/i.test($o)&&typeof Pebble<"u",aM=/web0s(?!.*chrome)/i.test($o),Jo=We,nT=mo,cM=Yc.f,Wh=pb.set,dM=Eb,lM=ub,uM=sM,hM=aM,Hh=Jc,iT=Jo.MutationObserver||Jo.WebKitMutationObserver,rT=Jo.document,oT=Jo.process,md=Jo.Promise,sT=cM(Jo,"queueMicrotask"),tE=sT&&sT.value;tE||(ba=new dM,wa=function(){var e,r;for(Hh&&(e=oT.domain)&&e.exit();r=ba.get();)try{r()}catch(i){throw ba.head&&cs(),i}e&&e.enter()},lM||Hh||hM||!iT||!rT?!uM&&md&&md.resolve?((Gh=md.resolve(void 0)).constructor=md,eT=nT(Gh.then,Gh),cs=function(){eT(wa)}):Hh?cs=function(){oT.nextTick(wa)}:(Wh=nT(Wh,Jo),cs=function(){Wh(wa)}):(Bh=!0,jh=rT.createTextNode(""),new iT(wa).observe(jh,{characterData:!0}),cs=function(){jh.data=Bh=!Bh}),tE=function(e){ba.head||cs(),ba.add(e)});var ba,wa,pM=tE,_a=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},Xo=We.Promise,mb=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",_M=!mb&&!Jc&&typeof window=="object"&&typeof document=="object",EM=We,rc=Xo,mM=He,fM=kA,gM=sb,TM=pe,SM=_M,RM=mb,Kh=zo,aT=rc&&rc.prototype,CM=TM("species"),fb=!1,gb=mM(EM.PromiseRejectionEvent),IM=fM("Promise",function(){var e=gM(rc),r=e!==String(rc);if(!r&&Kh===66||!aT.catch||!aT.finally)return!0;if(!Kh||Kh<51||!/native code/.test(e)){var i=new rc(function(h){h(1)}),o=function(h){h(function(){},function(){})};if((i.constructor={})[CM]=o,!(fb=i.then(function(){})instanceof o))return!0}return!r&&(SM||RM)&&!gb}),$c={CONSTRUCTOR:IM,REJECTION_EVENT:gb,SUBCLASSING:fb},mr={},cT=yi,vM=TypeError,yM=function(e){var r,i;this.promise=new e(function(o,h){if(r!==void 0||i!==void 0)throw vM("Bad Promise constructor");r=o,i=h}),this.resolve=cT(r),this.reject=cT(i)};mr.f=function(e){return new yM(e)};var Yh,dT,AM=xt,Ll=Jc,uo=We,td=Ke,bM=go,wM=To,OM=function(e){var r=O1(e);D1&&r&&!r[Kg]&&N1(r,Kg,{configurable:!0,get:function(){return this}})},NM=yi,eE=He,DM=Hn,PM=Fm,kM=jm,Tb=pb.set,Hm=pM,LM=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},MM=_a,UM=Eb,Sb=ns,nE=Xo,Rb=$c,Cb=mr,cl="Promise",lT=Rb.CONSTRUCTOR,xM=Rb.REJECTION_EVENT,qh=Sb.getterFor(cl),VM=Sb.set,FM=nE&&nE.prototype,Oa=nE,zh=FM,Ib=uo.TypeError,iE=uo.document,Km=uo.process,rE=Cb.f,BM=rE,jM=!!(iE&&iE.createEvent&&uo.dispatchEvent),vb="unhandledrejection",yb=function(e){var r;return!(!DM(e)||!eE(r=e.then))&&r},Ab=function(e,r){var i,o,h,p=r.value,g=r.state==1,C=g?e.ok:e.fail,A=e.resolve,x=e.reject,_e=e.domain;try{C?(g||(r.rejection===2&&WM(r),r.rejection=1),C===!0?i=p:(_e&&_e.enter(),i=C(p),_e&&(_e.exit(),h=!0)),i===e.promise?x(Ib("Promise-chain cycle")):(o=yb(i))?td(o,i,A,x):A(i)):x(p)}catch(cN){_e&&!h&&_e.exit(),x(cN)}},bb=function(e,r){e.notified||(e.notified=!0,Hm(function(){for(var i,o=e.reactions;i=o.get();)Ab(i,e);e.notified=!1,r&&!e.rejection&&GM(e)}))},wb=function(e,r,i){var o,h;jM?((o=iE.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),uo.dispatchEvent(o)):o={promise:r,reason:i},!xM&&(h=uo["on"+e])?h(o):e===vb&&LM("Unhandled promise rejection",i)},GM=function(e){td(Tb,uo,function(){var r,i=e.facade,o=e.value;if(uT(e)&&(r=MM(function(){Ll?Km.emit("unhandledRejection",o,i):wb(vb,i,o)}),e.rejection=Ll||uT(e)?2:1,r.error))throw r.value})},uT=function(e){return e.rejection!==1&&!e.parent},WM=function(e){td(Tb,uo,function(){var r=e.facade;Ll?Km.emit("rejectionHandled",r):wb("rejectionhandled",r,e.value)})},Os=function(e,r,i){return function(o){e(r,o,i)}},Fs=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,bb(e,!0))},oE=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw Ib("Promise can't be resolved itself");var o=yb(r);o?Hm(function(){var h={done:!1};try{td(o,r,Os(oE,h,e),Os(Fs,h,e))}catch(p){Fs(h,p,e)}}):(e.value=r,e.state=1,bb(e,!1))}catch(h){Fs({done:!1},h,e)}}};lT&&(zh=(Oa=function(e){PM(this,zh),NM(e),td(Yh,this);var r=qh(this);try{e(Os(oE,r),Os(Fs,r))}catch(i){Fs(r,i)}}).prototype,(Yh=function(e){VM(this,{type:cl,done:!1,notified:!1,parent:!1,reactions:new UM,rejection:!1,state:0,value:void 0})}).prototype=bM(zh,"then",function(e,r){var i=qh(this),o=rE(kM(this,Oa));return i.parent=!0,o.ok=!eE(e)||e,o.fail=eE(r)&&r,o.domain=Ll?Km.domain:void 0,i.state==0?i.reactions.add(o):Hm(function(){Ab(o,i)}),o.promise}),dT=function(){var e=new Yh,r=qh(e);this.promise=e,this.resolve=Os(oE,r),this.reject=Os(Fs,r)},Cb.f=rE=function(e){return e===Oa||e===void 0?new dT(e):BM(e)}),AM({global:!0,constructor:!0,wrap:!0,forced:lT},{Promise:Oa}),wM(Oa,cl,!1,!0),OM(cl);var Ob=pe("iterator"),Nb=!1;try{hT=0,Jh={next:function(){return{done:!!hT++}},return:function(){Nb=!0}},Jh[Ob]=function(){return this},Array.from(Jh,function(){throw 2})}catch{}var hT,Jh,HM=Xo,KM=function(e,r){if(!Nb)return!1;var i=!1;try{var o={};o[Ob]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},Fu=$c.CONSTRUCTOR||!KM(function(e){HM.all(e).then(void 0,function(){})}),YM=Ke,qM=yi,zM=mr,JM=_a,XM=Zc;xt({target:"Promise",stat:!0,forced:Fu},{all:function(e){var r=this,i=zM.f(r),o=i.resolve,h=i.reject,p=JM(function(){var g=qM(r.resolve),C=[],A=0,x=1;XM(e,function(_e){var cN=A++,dN=!1;x++,YM(g,r,_e).then(function(fN){dN||(dN=!0,C[cN]=fN,--x||o(C))},h)}),--x||o(C)});return p.error&&h(p.value),i.promise}});var QM=xt,ZM=$c.CONSTRUCTOR;Xo&&Xo.prototype,QM({target:"Promise",proto:!0,forced:ZM,real:!0},{catch:function(e){return this.then(void 0,e)}});var $M=Ke,tU=yi,eU=mr,nU=_a,iU=Zc;xt({target:"Promise",stat:!0,forced:Fu},{race:function(e){var r=this,i=eU.f(r),o=i.reject,h=nU(function(){var p=tU(r.resolve);iU(e,function(g){$M(p,r,g).then(i.resolve,o)})});return h.error&&o(h.value),i.promise}});var rU=Ke,oU=mr;xt({target:"Promise",stat:!0,forced:$c.CONSTRUCTOR},{reject:function(e){var r=oU.f(this);return rU(r.reject,void 0,e),r.promise}});var sU=Cn,aU=Hn,cU=mr,Db=function(e,r){if(sU(e),aU(r)&&r.constructor===e)return r;var i=cU.f(e);return(0,i.resolve)(r),i.promise},dU=xt,lU=Xo,uU=$c.CONSTRUCTOR,hU=Db,pU=Dn("Promise"),_U=!uU;dU({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return hU(_U&&this===pU?lU:this,e)}});var EU=Ke,mU=yi,fU=mr,gU=_a,TU=Zc;xt({target:"Promise",stat:!0,forced:Fu},{allSettled:function(e){var r=this,i=fU.f(r),o=i.resolve,h=i.reject,p=gU(function(){var g=mU(r.resolve),C=[],A=0,x=1;TU(e,function(_e){var cN=A++,dN=!1;x++,EU(g,r,_e).then(function(fN){dN||(dN=!0,C[cN]={status:"fulfilled",value:fN},--x||o(C))},function(fN){dN||(dN=!0,C[cN]={status:"rejected",reason:fN},--x||o(C))})}),--x||o(C)});return p.error&&h(p.value),i.promise}});var SU=Ke,RU=yi,CU=Dn,IU=mr,vU=_a,yU=Zc,pT="No one promise resolved";xt({target:"Promise",stat:!0,forced:Fu},{any:function(e){var r=this,i=CU("AggregateError"),o=IU.f(r),h=o.resolve,p=o.reject,g=vU(function(){var C=RU(r.resolve),A=[],x=0,_e=1,cN=!1;yU(e,function(dN){var fN=x++,mN=!1;_e++,SU(C,r,dN).then(function(EN){mN||cN||(cN=!0,h(EN))},function(EN){mN||cN||(mN=!0,A[fN]=EN,--_e||p(new i(A,pT)))})}),--_e||p(new i(A,pT))});return g.error&&p(g.value),o.promise}});var AU=xt,sE=Xo,bU=Se,wU=Dn,OU=He,NU=jm,_T=Db,DU=sE&&sE.prototype;AU({target:"Promise",proto:!0,real:!0,forced:!!sE&&bU(function(){DU.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=NU(this,wU("Promise")),i=OU(e);return this.then(i?function(o){return _T(r,e()).then(function(){return o})}:e,i?function(o){return _T(r,e()).then(function(){throw o})}:e)}});var Ym=me,PU=wm,kU=oi,LU=la,MU=Ym("".charAt),ET=Ym("".charCodeAt),UU=Ym("".slice),mT=function(e){return function(r,i){var o,h,p=kU(LU(r)),g=PU(i),C=p.length;return g<0||g>=C?e?"":void 0:(o=ET(p,g))<55296||o>56319||g+1===C||(h=ET(p,g+1))<56320||h>57343?e?MU(p,g):o:e?UU(p,g,g+2):h-56320+(o-55296<<10)+65536}},qm={codeAt:mT(!1),charAt:mT(!0)},xU=qm.charAt,VU=oi,Pb=ns,FU=ib,fT=Vm,kb="String Iterator",BU=Pb.set,jU=Pb.getterFor(kb);FU(String,"String",function(e){BU(this,{type:kb,string:VU(e),index:0})},function(){var e,r=jU(this),i=r.string,o=r.index;return o>=i.length?fT(void 0,!0):(e=xU(i,o),r.index+=e.length,fT(e,!1))});var GU=Gi.Promise,WU={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},HU=We,KU=Er,YU=fo,gT=es,TT=pe("toStringTag");for(fd in WU)Xh=HU[fd],gd=Xh&&Xh.prototype,gd&&KU(gd)!==TT&&YU(gd,TT,fd),gT[fd]=gT.Array;var Xh,gd,fd,Lb=GU,j=ae(Lb),ST=jA;function Mb(e,r){let i=e&&e.navigator;if(!i.mediaDevices)return;let o=function(g){if(typeof g!="object"||g.mandatory||g.optional)return g;let C={};return Object.keys(g).forEach(A=>{if(A==="require"||A==="advanced"||A==="mediaSource")return;let x=typeof g[A]=="object"?g[A]:{ideal:g[A]};x.exact!==void 0&&typeof x.exact=="number"&&(x.min=x.max=x.exact);let _e=function(cN,dN){return cN?cN+dN.charAt(0).toUpperCase()+dN.slice(1):dN==="deviceId"?"sourceId":dN};if(x.ideal!==void 0){C.optional=C.optional||[];let cN={};typeof x.ideal=="number"?(cN[_e("min",A)]=x.ideal,C.optional.push(cN),cN={},cN[_e("max",A)]=x.ideal,C.optional.push(cN)):(cN[_e("",A)]=x.ideal,C.optional.push(cN))}x.exact!==void 0&&typeof x.exact!="number"?(C.mandatory=C.mandatory||{},C.mandatory[_e("",A)]=x.exact):["min","max"].forEach(cN=>{x[cN]!==void 0&&(C.mandatory=C.mandatory||{},C.mandatory[_e(cN,A)]=x[cN])})}),g.advanced&&(C.optional=(C.optional||[]).concat(g.advanced)),C},h=function(g,C){if(r.version>=61)return C(g);if((g=JSON.parse(JSON.stringify(g)))&&typeof g.audio=="object"){let A=function(x,_e,cN){_e in x&&!(cN in x)&&(x[cN]=x[_e],delete x[_e])};A((g=JSON.parse(JSON.stringify(g))).audio,"autoGainControl","googAutoGainControl"),A(g.audio,"noiseSuppression","googNoiseSuppression"),g.audio=o(g.audio)}if(g&&typeof g.video=="object"){let A=g.video.facingMode;A=A&&(typeof A=="object"?A:{ideal:A});let x=r.version<66;if(A&&(A.exact==="user"||A.exact==="environment"||A.ideal==="user"||A.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||x)){let _e;if(delete g.video.facingMode,A.exact==="environment"||A.ideal==="environment"?_e=["back","rear"]:A.exact!=="user"&&A.ideal!=="user"||(_e=["front"]),_e)return i.mediaDevices.enumerateDevices().then(cN=>{let dN=(cN=cN.filter(fN=>fN.kind==="videoinput")).find(fN=>_e.some(mN=>{var EN;return W(EN=fN.label.toLowerCase()).call(EN,mN)}));return!dN&&cN.length&&W(_e).call(_e,"back")&&(dN=cN[cN.length-1]),dN&&(g.video.deviceId=A.exact?{exact:dN.deviceId}:{ideal:dN.deviceId}),g.video=o(g.video),ST("chrome: "+JSON.stringify(g)),C(g)})}g.video=o(g.video)}return ST("chrome: "+JSON.stringify(g)),C(g)},p=function(g){return r.version>=64?g:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[g.name]||g.name,message:g.message,constraint:g.constraint||g.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(g,C,A){h(g,x=>{i.webkitGetUserMedia(x,C,_e=>{A&&A(p(_e))})})}).bind(i),i.mediaDevices.getUserMedia){let g=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(C){return h(C,A=>g(A).then(x=>{if(A.audio&&!x.getAudioTracks().length||A.video&&!x.getVideoTracks().length)throw x.getTracks().forEach(_e=>{_e.stop()}),new DOMException("","NotFoundError");return x},x=>j.reject(p(x))))}}}function Ub(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function xb(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let h;h=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(g=>g.track&&g.track.id===o.track.id):{track:o.track};let p=new Event("track");p.track=o.track,p.receiver=h,p.transceiver={receiver:h},p.streams=[i.stream],this.dispatchEvent(p)}),i.stream.getTracks().forEach(o=>{let h;h=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(g=>g.track&&g.track.id===o.id):{track:o};let p=new Event("track");p.track=o,p.receiver=h,p.transceiver={receiver:h},p.streams=[i.stream],this.dispatchEvent(p)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else ts(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function Vb(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let r=function(h,p){return{track:p,get dtmf(){return this._dtmf===void 0&&(p.kind==="audio"?this._dtmf=h.createDTMFSender(p):this._dtmf=null),this._dtmf},_pc:h}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let h=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(g,C){let A=h.apply(this,arguments);return A||(A=r(this,g),this._senders.push(A)),A};let p=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(g){p.apply(this,arguments);let C=this._senders.indexOf(g);C!==-1&&this._senders.splice(C,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){this._senders=this._senders||[],i.apply(this,[h]),h.getTracks().forEach(p=>{this._senders.push(r(this,p))})};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){this._senders=this._senders||[],o.apply(this,[h]),h.getTracks().forEach(p=>{let g=this._senders.find(C=>C.track===p);g&&this._senders.splice(this._senders.indexOf(g),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Fb(e){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,o,h]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);let p=function(C){let A={};return C.result().forEach(x=>{let _e={id:x.id,timestamp:x.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[x.type]||x.type};x.names().forEach(cN=>{_e[cN]=x.stat(cN)}),A[_e.id]=_e}),A},g=function(C){return new Map(Object.keys(C).map(A=>[A,C[A]]))};if(arguments.length>=2){let C=function(A){o(g(p(A)))};return r.apply(this,[C,i])}return new j((C,A)=>{r.apply(this,[function(x){C(g(p(x)))},A])}).then(o,h)}}function Bb(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let h=i.apply(this,[]);return h.forEach(p=>p._pc=this),h});let o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){let h=o.apply(this,arguments);return h._pc=this,h}),e.RTCRtpSender.prototype.getStats=function(){let h=this;return this._pc.getStats().then(p=>Sg(p,h.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let o=i.apply(this,[]);return o.forEach(h=>h._pc=this),o}),ts(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){let o=this;return this._pc.getStats().then(h=>Sg(h,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],o,h,p;return this.getSenders().forEach(g=>{g.track===i&&(o?p=!0:o=g)}),this.getReceivers().forEach(g=>(g.track===i&&(h?p=!0:h=g),g.track===i)),p||o&&h?j.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():h?h.getStats():j.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function jb(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(p=>this._shimmedLocalStreams[p][0])};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(p,g){if(!g)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let C=r.apply(this,arguments);return this._shimmedLocalStreams[g.id]?this._shimmedLocalStreams[g.id].indexOf(C)===-1&&this._shimmedLocalStreams[g.id].push(C):this._shimmedLocalStreams[g.id]=[g,C],C};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){this._shimmedLocalStreams=this._shimmedLocalStreams||{},p.getTracks().forEach(A=>{if(this.getSenders().find(x=>x.track===A))throw new DOMException("Track already exists.","InvalidAccessError")});let g=this.getSenders();i.apply(this,arguments);let C=this.getSenders().filter(A=>g.indexOf(A)===-1);this._shimmedLocalStreams[p.id]=[p].concat(C)};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[p.id],o.apply(this,arguments)};let h=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},p&&Object.keys(this._shimmedLocalStreams).forEach(g=>{let C=this._shimmedLocalStreams[g].indexOf(p);C!==-1&&this._shimmedLocalStreams[g].splice(C,1),this._shimmedLocalStreams[g].length===1&&delete this._shimmedLocalStreams[g]}),h.apply(this,arguments)}}function Gb(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return jb(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let A=i.apply(this);return this._reverseStreams=this._reverseStreams||{},A.map(x=>this._reverseStreams[x.id])};let o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(A){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},A.getTracks().forEach(x=>{if(this.getSenders().find(_e=>_e.track===x))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[A.id]){let x=new e.MediaStream(A.getTracks());this._streams[A.id]=x,this._reverseStreams[x.id]=A,A=x}o.apply(this,[A])};let h=e.RTCPeerConnection.prototype.removeStream;function p(A,x){let _e=x.sdp;return Object.keys(A._reverseStreams||[]).forEach(cN=>{let dN=A._reverseStreams[cN],fN=A._streams[dN.id];_e=_e.replace(new RegExp(fN.id,"g"),dN.id)}),new RTCSessionDescription({type:x.type,sdp:_e})}e.RTCPeerConnection.prototype.removeStream=function(A){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.apply(this,[this._streams[A.id]||A]),delete this._reverseStreams[this._streams[A.id]?this._streams[A.id].id:A.id],delete this._streams[A.id]},e.RTCPeerConnection.prototype.addTrack=function(A,x){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let _e=[].slice.call(arguments,1);if(_e.length!==1||!_e[0].getTracks().find(dN=>dN===A))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(dN=>dN.track===A))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let cN=this._streams[x.id];if(cN)cN.addTrack(A),j.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let dN=new e.MediaStream([A]);this._streams[x.id]=dN,this._reverseStreams[dN.id]=x,this.addStream(dN)}return this.getSenders().find(dN=>dN.track===A)},["createOffer","createAnswer"].forEach(function(A){let x=e.RTCPeerConnection.prototype[A],_e={[A](){let cN=arguments;return arguments.length&&typeof arguments[0]=="function"?x.apply(this,[dN=>{let fN=p(this,dN);cN[0].apply(null,[fN])},dN=>{cN[1]&&cN[1].apply(null,dN)},arguments[2]]):x.apply(this,arguments).then(dN=>p(this,dN))}};e.RTCPeerConnection.prototype[A]=_e[A]});let g=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(A,x){let _e=x.sdp;return Object.keys(A._reverseStreams||[]).forEach(cN=>{let dN=A._reverseStreams[cN],fN=A._streams[dN.id];_e=_e.replace(new RegExp(dN.id,"g"),fN.id)}),new RTCSessionDescription({type:x.type,sdp:_e})}(this,arguments[0]),g.apply(this,arguments)):g.apply(this,arguments)};let C=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let A=C.get.apply(this);return A.type===""?A:p(this,A)}}),e.RTCPeerConnection.prototype.removeTrack=function(A){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!A._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(A._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let x;this._streams=this._streams||{},Object.keys(this._streams).forEach(_e=>{this._streams[_e].getTracks().find(cN=>A.track===cN)&&(x=this._streams[_e])}),x&&(x.getTracks().length===1?this.removeStream(this._reverseStreams[x.id]):x.removeTrack(A.track),this.dispatchEvent(new Event("negotiationneeded")))}}function aE(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let o=e.RTCPeerConnection.prototype[i],h={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=h[i]})}function Wb(e,r){ts(e,"negotiationneeded",i=>{let o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var RT=Object.freeze({__proto__:null,fixNegotiationNeeded:Wb,shimAddTrackRemoveTrack:Gb,shimAddTrackRemoveTrackWithNative:jb,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{let h=i.video&&i.video.width,p=i.video&&i.video.height,g=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:g||3}},h&&(i.video.mandatory.maxWidth=h),p&&(i.video.mandatory.maxHeight=p),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Vb,shimGetStats:Fb,shimGetUserMedia:Mb,shimMediaStream:Ub,shimOnTrack:xb,shimPeerConnection:aE,shimSenderReceiverGetStats:Bb});function Hb(e,r){let i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(h,p,g){Pm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(h).then(p,g)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let h=function(g,C,A){C in g&&!(A in g)&&(g[A]=g[C],delete g[C])},p=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(g){return typeof g=="object"&&typeof g.audio=="object"&&(g=JSON.parse(JSON.stringify(g)),h(g.audio,"autoGainControl","mozAutoGainControl"),h(g.audio,"noiseSuppression","mozNoiseSuppression")),p(g)},o&&o.prototype.getSettings){let g=o.prototype.getSettings;o.prototype.getSettings=function(){let C=g.apply(this,arguments);return h(C,"mozAutoGainControl","autoGainControl"),h(C,"mozNoiseSuppression","noiseSuppression"),C}}if(o&&o.prototype.applyConstraints){let g=o.prototype.applyConstraints;o.prototype.applyConstraints=function(C){return this.kind==="audio"&&typeof C=="object"&&(C=JSON.parse(JSON.stringify(C)),h(C,"autoGainControl","mozAutoGainControl"),h(C,"noiseSuppression","mozNoiseSuppression")),g.apply(this,[C])}}}}function Kb(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cE(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){let p=e.RTCPeerConnection.prototype[h],g={[h](){return arguments[0]=new(h==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),p.apply(this,arguments)}};e.RTCPeerConnection.prototype[h]=g[h]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[h,p,g]=arguments;return o.apply(this,[h||null]).then(C=>{if(r.version<53&&!p)try{C.forEach(A=>{A.type=i[A.type]||A.type})}catch(A){if(A.name!=="TypeError")throw A;C.forEach((x,_e)=>{C.set(_e,Object.assign({},x,{type:i[x.type]||x.type}))})}return C}).then(p,g)}}function Yb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=r.apply(this,[]);return o.forEach(h=>h._pc=this),o});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):j.resolve(new Map)}}function qb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),ts(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function zb(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){Pm("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&W(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function Jb(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Xb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let o=i.length>0;o&&i.forEach(p=>{if("rid"in p&&!/^[a-z0-9]{0,16}$/i.test(p.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in p&&!(parseFloat(p.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in p&&!(parseFloat(p.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let h=r.apply(this,arguments);if(o){let{sender:p}=h,g=p.getParameters();(!("encodings"in g)||g.encodings.length===1&&Object.keys(g.encodings[0]).length===0)&&(g.encodings=i,p.sendEncodings=i,this.setParametersPromises.push(p.setParameters(g).then(()=>{delete p.sendEncodings}).catch(()=>{delete p.sendEncodings})))}return h})}function Qb(e){if(typeof e!="object"||!e.RTCRtpSender)return;let r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){let i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Zb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?j.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function $b(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?j.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var CT=Object.freeze({__proto__:null,shimAddTransceiver:Xb,shimCreateAnswer:$b,shimCreateOffer:Zb,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,j.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:Qb,shimGetUserMedia:Hb,shimOnTrack:Kb,shimPeerConnection:cE,shimRTCDataChannel:Jb,shimReceiverGetStats:qb,shimRemoveStream:zb,shimSenderGetStats:Yb});function tw(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),W(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(h=>r.call(this,h,i)),i.getVideoTracks().forEach(h=>r.call(this,h,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,h=new Array(o>1?o-1:0),p=1;p<o;p++)h[p-1]=arguments[p];return h&&h.forEach(g=>{var C;this._localStreams?W(C=this._localStreams).call(C,g)||this._localStreams.push(g):this._localStreams=[g]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);let o=r.getTracks();this.getSenders().forEach(h=>{W(o).call(o,h.track)&&this.removeTrack(h)})})}}function ew(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(h=>{var p;if(this._remoteStreams||(this._remoteStreams=[]),W(p=this._remoteStreams).call(p,h))return;this._remoteStreams.push(h);let g=new Event("addstream");g.stream=h,this.dispatchEvent(g)})})}});let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(h=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(h)>=0)return;i._remoteStreams.push(h);let p=new Event("addstream");p.stream=h,i.dispatchEvent(p)})}),r.apply(i,arguments)}}}function nw(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,h=r.setLocalDescription,p=r.setRemoteDescription,g=r.addIceCandidate;r.createOffer=function(A,x){let _e=arguments.length>=2?arguments[2]:arguments[0],cN=i.apply(this,[_e]);return x?(cN.then(A,x),j.resolve()):cN},r.createAnswer=function(A,x){let _e=arguments.length>=2?arguments[2]:arguments[0],cN=o.apply(this,[_e]);return x?(cN.then(A,x),j.resolve()):cN};let C=function(A,x,_e){let cN=h.apply(this,[A]);return _e?(cN.then(x,_e),j.resolve()):cN};r.setLocalDescription=C,C=function(A,x,_e){let cN=p.apply(this,[A]);return _e?(cN.then(x,_e),j.resolve()):cN},r.setRemoteDescription=C,C=function(A,x,_e){let cN=g.apply(this,[A]);return _e?(cN.then(x,_e),j.resolve()):cN},r.addIceCandidate=C}function iw(e){let r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){let i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=h=>o(rw(h))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,o,h){r.mediaDevices.getUserMedia(i).then(o,h)}).bind(r))}function rw(e){return e&&e.video!==void 0?Object.assign({},e,{video:GA(e.video)}):e}function ow(e){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){let h=[];for(let p=0;p<i.iceServers.length;p++){let g=i.iceServers[p];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(Pm("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,h.push(g)):h.push(i.iceServers[p])}i.iceServers=h}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function sw(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function aw(e){let r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let o=this.getTransceivers().find(p=>p.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let h=this.getTransceivers().find(p=>p.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):i.offerToReceiveVideo!==!0||h||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function cw(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var IT=Object.freeze({__proto__:null,shimAudioContext:cw,shimCallbacksAPI:nw,shimConstraints:rw,shimCreateOfferLegacy:aw,shimGetUserMedia:iw,shimLocalStreamsAPI:tw,shimRTCIceServerUrls:ow,shimRemoteStreamsAPI:ew,shimTrackEventTransceiver:sw}),dw=`	
\v\f\r                　\u2028\u2029\uFEFF`,qU=la,zU=oi,dE=dw,vT=me("".replace),JU=RegExp("^["+dE+"]+"),XU=RegExp("(^|[^"+dE+"])["+dE+"]+$"),Qh=function(e){return function(r){var i=zU(qU(r));return 1&e&&(i=vT(i,JU,"")),2&e&&(i=vT(i,XU,"$1")),i}},QU={start:Qh(1),end:Qh(2),trim:Qh(3)},ZU=tb.PROPER,$U=Se,yT=dw,t2=QU.trim;xt({target:"String",proto:!0,forced:function(e){return $U(function(){return!!yT[e]()||"​᠎"[e]()!=="​᠎"||ZU&&yT[e].name!==e})}("trim")},{trim:function(){return t2(this)}});var e2=bi("String").trim,n2=hn,i2=e2,Zh=String.prototype,r2=function(e){var r=e.trim;return typeof e=="string"||e===Zh||n2(Zh,e)&&r===Zh.trim?i2:r},rn=ae(r2),lw={exports:{}};(function(e){let r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,h)=>(h>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){let o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){let o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(h=>h.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let h={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let p=8;p<o.length;p+=2)switch(o[p]){case"raddr":h.relatedAddress=o[p+1];break;case"rport":h.relatedPort=parseInt(o[p+1],10);break;case"tcptype":h.tcpType=o[p+1];break;case"ufrag":h.ufrag=o[p+1],h.usernameFragment=o[p+1];break;default:h[o[p]]===void 0&&(h[o[p]]=o[p+1])}return h},r.writeCandidate=function(i){let o=[];o.push(i.foundation);let h=i.component;h==="rtp"?o.push(1):h==="rtcp"?o.push(2):o.push(h),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);let p=i.type;return o.push("typ"),o.push(p),p!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" "),h={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),h.name=o[0],h.clockRate=parseInt(o[1],10),h.channels=o.length===3?parseInt(o[2],10):1,h.numChannels=h.channels,h},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);let h=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(h!==1?"/"+h:"")+`\r
`},r.parseExtmap=function(i){let o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){let o={},h,p=i.substring(i.indexOf(" ")+1).split(";");for(let g=0;g<p.length;g++)h=p[g].trim().split("="),o[h[0].trim()]=h[1];return o},r.writeFmtp=function(i){let o="",h=i.payloadType;if(i.preferredPayloadType!==void 0&&(h=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let p=[];Object.keys(i.parameters).forEach(g=>{i.parameters[g]!==void 0?p.push(g+"="+i.parameters[g]):p.push(g)}),o+="a=fmtp:"+h+" "+p.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){let o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",h=i.payloadType;return i.preferredPayloadType!==void 0&&(h=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(p=>{o+="a=rtcp-fb:"+h+" "+p.type+(p.parameter&&p.parameter.length?" "+p.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){let o=i.indexOf(" "),h={ssrc:parseInt(i.substring(7,o),10)},p=i.indexOf(":",o);return p>-1?(h.attribute=i.substring(o+1,p),h.value=i.substring(p+1)):h.attribute=i.substring(o+1),h},r.parseSsrcGroup=function(i){let o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(h=>parseInt(h,10))}},r.getMid=function(i){let o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){let o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let h="a=setup:"+o+`\r
`;return i.fingerprints.forEach(p=>{h+="a=fingerprint:"+p.algorithm+" "+p.value+`\r
`}),h},r.parseCryptoLine=function(i){let o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){let h=r.matchPrefix(i+o,"a=ice-ufrag:")[0],p=r.matchPrefix(i+o,"a=ice-pwd:")[0];return h&&p?{usernameFragment:h.substring(12),password:p.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){let o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=r.splitLines(i)[0].split(" ");o.profile=h[2];for(let g=3;g<h.length;g++){let C=h[g],A=r.matchPrefix(i,"a=rtpmap:"+C+" ")[0];if(A){let x=r.parseRtpMap(A),_e=r.matchPrefix(i,"a=fmtp:"+C+" ");switch(x.parameters=_e.length?r.parseFmtp(_e[0]):{},x.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+C+" ").map(r.parseRtcpFb),o.codecs.push(x),x.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(x.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(g=>{o.headerExtensions.push(r.parseExtmap(g))});let p=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(g=>{p.forEach(C=>{g.rtcpFeedback.find(A=>A.type===C.type&&A.parameter===C.parameter)||g.rtcpFeedback.push(C)})}),o},r.writeRtpDescription=function(i,o){let h="";h+="m="+i+" ",h+=o.codecs.length>0?"9":"0",h+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",h+=o.codecs.map(g=>g.preferredPayloadType!==void 0?g.preferredPayloadType:g.payloadType).join(" ")+`\r
`,h+=`c=IN IP4 0.0.0.0\r
`,h+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(g=>{h+=r.writeRtpMap(g),h+=r.writeFmtp(g),h+=r.writeRtcpFb(g)});let p=0;return o.codecs.forEach(g=>{g.maxptime>p&&(p=g.maxptime)}),p>0&&(h+="a=maxptime:"+p+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(g=>{h+=r.writeExtmap(g)}),h},r.parseRtpEncodingParameters=function(i){let o=[],h=r.parseRtpParameters(i),p=h.fecMechanisms.indexOf("RED")!==-1,g=h.fecMechanisms.indexOf("ULPFEC")!==-1,C=r.matchPrefix(i,"a=ssrc:").map(dN=>r.parseSsrcMedia(dN)).filter(dN=>dN.attribute==="cname"),A=C.length>0&&C[0].ssrc,x,_e=r.matchPrefix(i,"a=ssrc-group:FID").map(dN=>dN.substring(17).split(" ").map(fN=>parseInt(fN,10)));_e.length>0&&_e[0].length>1&&_e[0][0]===A&&(x=_e[0][1]),h.codecs.forEach(dN=>{if(dN.name.toUpperCase()==="RTX"&&dN.parameters.apt){let fN={ssrc:A,codecPayloadType:parseInt(dN.parameters.apt,10)};A&&x&&(fN.rtx={ssrc:x}),o.push(fN),p&&(fN=JSON.parse(JSON.stringify(fN)),fN.fec={ssrc:A,mechanism:g?"red+ulpfec":"red"},o.push(fN))}}),o.length===0&&A&&o.push({ssrc:A});let cN=r.matchPrefix(i,"b=");return cN.length&&(cN=cN[0].indexOf("b=TIAS:")===0?parseInt(cN[0].substring(7),10):cN[0].indexOf("b=AS:")===0?1e3*parseInt(cN[0].substring(5),10)*.95-16e3:void 0,o.forEach(dN=>{dN.maxBitrate=cN})),o},r.parseRtcpParameters=function(i){let o={},h=r.matchPrefix(i,"a=ssrc:").map(C=>r.parseSsrcMedia(C)).filter(C=>C.attribute==="cname")[0];h&&(o.cname=h.value,o.ssrc=h.ssrc);let p=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=p.length>0,o.compound=p.length===0;let g=r.matchPrefix(i,"a=rtcp-mux");return o.mux=g.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o,h=r.matchPrefix(i,"a=msid:");if(h.length===1)return o=h[0].substring(7).split(" "),{stream:o[0],track:o[1]};let p=r.matchPrefix(i,"a=ssrc:").map(g=>r.parseSsrcMedia(g)).filter(g=>g.attribute==="msid");return p.length>0?(o=p[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){let o=r.parseMLine(i),h=r.matchPrefix(i,"a=max-message-size:"),p;h.length>0&&(p=parseInt(h[0].substring(19),10)),isNaN(p)&&(p=65536);let g=r.matchPrefix(i,"a=sctp-port:");if(g.length>0)return{port:parseInt(g[0].substring(12),10),protocol:o.fmt,maxMessageSize:p};let C=r.matchPrefix(i,"a=sctpmap:");if(C.length>0){let A=C[0].substring(10).split(" ");return{port:parseInt(A[0],10),protocol:A[1],maxMessageSize:p}}},r.writeSctpDescription=function(i,o){let h=[];return h=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&h.push("a=max-message-size:"+o.maxMessageSize+`\r
`),h.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,h){let p,g=o!==void 0?o:2;return p=i||r.generateSessionId(),`v=0\r
o=`+(h||"thisisadapterortc")+" "+p+" "+g+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){let h=r.splitLines(i);for(let p=0;p<h.length;p++)switch(h[p]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return h[p].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){let o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){let o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let o=r.splitLines(i);for(let h=0;h<o.length;h++)if(o[h].length<2||o[h].charAt(1)!=="=")return!1;return!0},e.exports=r})(lw);var uw=lw.exports,Bs=ae(uw),o2=yN({__proto__:null,default:Bs},[uw]);function dl(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let o=new r(i),h=Bs.parseCandidate(i.candidate),p=Object.assign(o,h);return p.toJSON=function(){return{candidate:p.candidate,sdpMid:p.sdpMid,sdpMLineIndex:p.sdpMLineIndex,usernameFragment:p.usernameFragment}},p}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,ts(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function lE(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ts(e,"icecandidate",r=>{if(r.candidate){let i=Bs.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function ll(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(C){if(!C||!C.sdp)return!1;let A=Bs.splitSections(C.sdp);return A.shift(),A.some(x=>{let _e=Bs.parseMLine(x);return _e&&_e.kind==="application"&&_e.protocol.indexOf("SCTP")!==-1})},o=function(C){let A=C.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(A===null||A.length<2)return-1;let x=parseInt(A[1],10);return x!=x?-1:x},h=function(C){let A=65536;return r.browser==="firefox"&&(A=r.version<57?C===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),A},p=function(C,A){let x=65536;r.browser==="firefox"&&r.version===57&&(x=65535);let _e=Bs.matchPrefix(C.sdp,"a=max-message-size:");return _e.length>0?x=parseInt(_e[0].substr(19),10):r.browser==="firefox"&&A!==-1&&(x=2147483637),x},g=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){let{sdpSemantics:C}=this.getConfiguration();C==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let C=o(arguments[0]),A=h(C),x=p(arguments[0],C),_e;_e=A===0&&x===0?Number.POSITIVE_INFINITY:A===0||x===0?Math.max(A,x):Math.min(A,x);let cN={};Object.defineProperty(cN,"maxMessageSize",{get:()=>_e}),this._sctp=cN}return g.apply(this,arguments)}}function ul(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,h){let p=o.send;o.send=function(){let g=arguments[0],C=g.length||g.size||g.byteLength;if(o.readyState==="open"&&h.sctp&&C>h.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+h.sctp.maxMessageSize+" bytes)");return p.apply(o,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let o=i.apply(this,arguments);return r(o,this),o},ts(e,"datachannel",o=>(r(o.channel,o.target),o))}function uE(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=h=>{let p=h.target;if(p._lastConnectionState!==p.connectionState){p._lastConnectionState=p.connectionState;let g=new Event("connectionstatechange",h);p.dispatchEvent(g)}return h},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function hE(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let h=o.sdp.split(`
`).filter(p=>rn(p).call(p)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:h}):o.sdp=h}return i.apply(this,arguments)}}function hl(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?j.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),j.resolve())})}function pl(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(h=>i.apply(this,[h]))})}var s2=Object.freeze({__proto__:null,removeExtmapAllowMixed:hE,shimAddIceCandidateNullOrEmpty:hl,shimConnectionState:uE,shimMaxMessageSize:ll,shimParameterlessSetLocalDescription:pl,shimRTCIceCandidate:dl,shimRTCIceCandidateRelayProtocol:lE,shimSendThrowTypeError:ul});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=jA,o=function(p){let g={browser:null,version:null};if(p===void 0||!p.navigator)return g.browser="Not a browser.",g;let{navigator:C}=p;if(C.mozGetUserMedia)g.browser="firefox",g.version=hd(C.userAgent,/Firefox\/(\d+)\./,1);else if(C.webkitGetUserMedia||p.isSecureContext===!1&&p.webkitRTCPeerConnection)g.browser="chrome",g.version=hd(C.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!p.RTCPeerConnection||!C.userAgent.match(/AppleWebKit\/(\d+)\./))return g.browser="Not a supported browser.",g;g.browser="safari",g.version=hd(C.userAgent,/AppleWebKit\/(\d+)\./,1),g.supportsUnifiedPlan=p.RTCRtpTransceiver&&"currentDirection"in p.RTCRtpTransceiver.prototype}return g}(e),h={browserDetails:o,commonShim:s2,extractVersion:hd,disableLog:rk,disableWarnings:ok,sdp:o2};switch(o.browser){case"chrome":if(!RT||!aE||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),h;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),h;i("adapter.js shimming chrome."),h.browserShim=RT,hl(e,o),pl(e),Mb(e,o),Ub(e),aE(e,o),xb(e),Gb(e,o),Vb(e),Fb(e),Bb(e),Wb(e,o),dl(e),lE(e),uE(e),ll(e,o),ul(e),hE(e,o);break;case"firefox":if(!CT||!cE||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),h;i("adapter.js shimming firefox."),h.browserShim=CT,hl(e,o),pl(e),Hb(e,o),cE(e,o),Kb(e),zb(e),Yb(e),qb(e),Jb(e),Xb(e),Qb(e),Zb(e),$b(e),dl(e),uE(e),ll(e,o),ul(e);break;case"safari":if(!IT||!r.shimSafari)return i("Safari shim is not included in this adapter release."),h;i("adapter.js shimming safari."),h.browserShim=IT,hl(e,o),pl(e),ow(e),aw(e),nw(e),tw(e),ew(e),sw(e),iw(e),cw(e),dl(e),lE(e),ll(e,o),ul(e),hE(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var a2=bi("Array").keys,c2=Er,d2=Je,l2=hn,u2=a2,$h=Array.prototype,h2={DOMTokenList:!0,NodeList:!0},p2=function(e){var r=e.keys;return e===$h||l2($h,e)&&r===$h.keys||d2(h2,c2(e))?u2:r},xn=ae(p2),AT=ha,_2=TypeError,E2=Ou,m2=Ai,f2=_o,Bu=function(e,r,i){var o=E2(r);o in e?m2.f(e,o,f2(0,i)):e[o]=i},bT=Om,g2=Lr,T2=Bu,S2=Array,R2=Math.max,zm=function(e,r,i){for(var o=g2(e),h=bT(r,o),p=bT(i===void 0?o:i,o),g=S2(R2(p-h,0)),C=0;h<p;h++,C++)T2(g,C,e[h]);return g.length=C,g},wT=zm,C2=Math.floor,pE=function(e,r){var i=e.length,o=C2(i/2);return i<8?I2(e,r):v2(e,pE(wT(e,0,o),r),pE(wT(e,o),r),r)},I2=function(e,r){for(var i,o,h=e.length,p=1;p<h;){for(o=p,i=e[p];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==p++&&(e[o]=i)}return e},v2=function(e,r,i,o){for(var h=r.length,p=i.length,g=0,C=0;g<h||C<p;)e[g+C]=g<h&&C<p?o(r[g],i[C])<=0?r[g++]:i[C++]:g<h?r[g++]:i[C++];return e},hw=pE,OT=$o.match(/firefox\/(\d+)/i),y2=!!OT&&+OT[1],A2=/MSIE|Trident/.test($o),NT=$o.match(/AppleWebKit\/(\d+)\./),b2=!!NT&&+NT[1],w2=xt,pw=me,O2=yi,N2=_r,DT=Lr,D2=function(e,r){if(!delete e[r])throw _2("Cannot delete property "+AT(r)+" of "+AT(e))},PT=oi,Jm=Se,P2=hw,k2=Nu,kT=y2,L2=A2,LT=zo,MT=b2,Zr=[],UT=pw(Zr.sort),M2=pw(Zr.push),U2=Jm(function(){Zr.sort(void 0)}),x2=Jm(function(){Zr.sort(null)}),V2=k2("sort"),xT=!Jm(function(){if(LT)return LT<70;if(!(kT&&kT>3)){if(L2)return!0;if(MT)return MT<603;var e,r,i,o,h="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Zr.push({k:r+o,v:i})}for(Zr.sort(function(p,g){return g.v-p.v}),o=0;o<Zr.length;o++)r=Zr[o].k.charAt(0),h.charAt(h.length-1)!==r&&(h+=r);return h!=="DGBEFHACIJK"}});w2({target:"Array",proto:!0,forced:U2||!x2||!V2||!xT},{sort:function(e){e!==void 0&&O2(e);var r=N2(this);if(xT)return e===void 0?UT(r):UT(r,e);var i,o,h=[],p=DT(r);for(o=0;o<p;o++)o in r&&M2(h,r[o]);for(P2(h,function(g){return function(C,A){return A===void 0?-1:C===void 0?1:g!==void 0?+g(C,A)||0:PT(C)>PT(A)?1:-1}}(e)),i=DT(h),o=0;o<i;)r[o]=h[o++];for(;o<p;)D2(r,o++);return r}});var tp,ep,F2=bi("Array").sort,B2=hn,j2=F2,np=Array.prototype,G2=function(e){var r=e.sort;return e===np||B2(np,e)&&r===np.sort?j2:r},ed=ae(G2),_E={exports:{}};tp=_E,ep=_E.exports,function(e,r){var i="function",o="undefined",h="object",p="string",g="major",C="model",A="name",x="type",_e="vendor",cN="version",dN="architecture",fN="console",mN="mobile",EN="tablet",RN="smarttv",IN="wearable",t0="embedded",aH="Amazon",pH="Apple",SH="ASUS",vH="BlackBerry",AH="Browser",UH="Chrome",zH="Firefox",CH="Google",HH="Huawei",VH="LG",KH="Microsoft",IH="Motorola",MH="Opera",GH="Samsung",yH="Sharp",TH="Sony",NH="Xiaomi",gH="Zebra",SN="Facebook",oH="Chromium OS",fH="Mac OS",xH=function(B5){for(var y5={},k5=0;k5<B5.length;k5++)y5[B5[k5].toUpperCase()]=B5[k5];return y5},l5=function(B5,y5){return typeof B5===p&&w5(y5).indexOf(w5(B5))!==-1},w5=function(B5){return B5.toLowerCase()},H5=function(B5,y5){if(typeof B5===p)return B5=B5.replace(/^\s\s*/,""),typeof y5===o?B5:B5.substring(0,350)},d6=function(B5,y5){for(var k5,Q5,M6,g6,W5,HK,f8=0;f8<y5.length&&!W5;){var X6=y5[f8],G7=y5[f8+1];for(k5=Q5=0;k5<X6.length&&!W5&&X6[k5];)if(W5=X6[k5++].exec(B5))for(M6=0;M6<G7.length;M6++)HK=W5[++Q5],typeof(g6=G7[M6])===h&&g6.length>0?g6.length===2?typeof g6[1]==i?this[g6[0]]=g6[1].call(this,HK):this[g6[0]]=g6[1]:g6.length===3?typeof g6[1]!==i||g6[1].exec&&g6[1].test?this[g6[0]]=HK?HK.replace(g6[1],g6[2]):r:this[g6[0]]=HK?g6[1].call(this,HK,g6[2]):r:g6.length===4&&(this[g6[0]]=HK?g6[3].call(this,HK.replace(g6[1],g6[2])):r):this[g6]=HK||r;f8+=2}},C6=function(B5,y5){for(var k5 in y5)if(typeof y5[k5]===h&&y5[k5].length>0){for(var Q5=0;Q5<y5[k5].length;Q5++)if(l5(y5[k5][Q5],B5))return k5==="?"?r:k5}else if(l5(y5[k5],B5))return k5==="?"?r:k5;return B5},fK={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},D4={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[cN,[A,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[cN,[A,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[A,cN],[/opios[\/ ]+([\w\.]+)/i],[cN,[A,MH+" Mini"]],[/\bopr\/([\w\.]+)/i],[cN,[A,MH]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[A,cN],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[cN,[A,"UC"+AH]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[cN,[A,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[cN,[A,"WeChat"]],[/konqueror\/([\w\.]+)/i],[cN,[A,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[cN,[A,"IE"]],[/yabrowser\/([\w\.]+)/i],[cN,[A,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[A,/(.+)/,"$1 Secure "+AH],cN],[/\bfocus\/([\w\.]+)/i],[cN,[A,zH+" Focus"]],[/\bopt\/([\w\.]+)/i],[cN,[A,MH+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[cN,[A,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[cN,[A,"Dolphin"]],[/coast\/([\w\.]+)/i],[cN,[A,MH+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[cN,[A,"MIUI "+AH]],[/fxios\/([-\w\.]+)/i],[cN,[A,zH]],[/\bqihu|(qi?ho?o?|360)browser/i],[[A,"360 "+AH]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[A,/(.+)/,"$1 "+AH],cN],[/(comodo_dragon)\/([\w\.]+)/i],[[A,/_/g," "],cN],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[A,cN],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[A],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[A,SN],cN],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[A,cN],[/\bgsa\/([\w\.]+) .*safari\//i],[cN,[A,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[cN,[A,UH+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[A,UH+" WebView"],cN],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[cN,[A,"Android "+AH]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[A,cN],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[cN,[A,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[cN,A],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[A,[cN,C6,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[A,cN],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[A,"Netscape"],cN],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[cN,[A,zH+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[A,cN],[/(cobalt)\/([\w\.]+)/i],[A,[cN,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[dN,"amd64"]],[/(ia32(?=;))/i],[[dN,w5]],[/((?:i[346]|x)86)[;\)]/i],[[dN,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[dN,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[dN,"armhf"]],[/windows (ce|mobile); ppc;/i],[[dN,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[dN,/ower/,"",w5]],[/(sun4\w)[;\)]/i],[[dN,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[dN,w5]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[C,[_e,GH],[x,EN]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[C,[_e,GH],[x,mN]],[/\((ip(?:hone|od)[\w ]*);/i],[C,[_e,pH],[x,mN]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[C,[_e,pH],[x,EN]],[/(macintosh);/i],[C,[_e,pH]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[C,[_e,yH],[x,mN]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[C,[_e,HH],[x,EN]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[C,[_e,HH],[x,mN]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[C,/_/g," "],[_e,NH],[x,mN]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[C,/_/g," "],[_e,NH],[x,EN]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[C,[_e,"OPPO"],[x,mN]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[C,[_e,"Vivo"],[x,mN]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[C,[_e,"Realme"],[x,mN]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[C,[_e,IH],[x,mN]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[C,[_e,IH],[x,EN]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[C,[_e,VH],[x,EN]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[C,[_e,VH],[x,mN]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[C,[_e,"Lenovo"],[x,EN]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[C,/_/g," "],[_e,"Nokia"],[x,mN]],[/(pixel c)\b/i],[C,[_e,CH],[x,EN]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[C,[_e,CH],[x,mN]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[C,[_e,TH],[x,mN]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[C,"Xperia Tablet"],[_e,TH],[x,EN]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[C,[_e,"OnePlus"],[x,mN]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[C,[_e,aH],[x,EN]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[C,/(.+)/g,"Fire Phone $1"],[_e,aH],[x,mN]],[/(playbook);[-\w\),; ]+(rim)/i],[C,_e,[x,EN]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[C,[_e,vH],[x,mN]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[C,[_e,SH],[x,EN]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[C,[_e,SH],[x,mN]],[/(nexus 9)/i],[C,[_e,"HTC"],[x,EN]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_e,[C,/_/g," "],[x,mN]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[C,[_e,"Acer"],[x,EN]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[C,[_e,"Meizu"],[x,mN]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_e,C,[x,mN]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_e,C,[x,EN]],[/(surface duo)/i],[C,[_e,KH],[x,EN]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[C,[_e,"Fairphone"],[x,mN]],[/(u304aa)/i],[C,[_e,"AT&T"],[x,mN]],[/\bsie-(\w*)/i],[C,[_e,"Siemens"],[x,mN]],[/\b(rct\w+) b/i],[C,[_e,"RCA"],[x,EN]],[/\b(venue[\d ]{2,7}) b/i],[C,[_e,"Dell"],[x,EN]],[/\b(q(?:mv|ta)\w+) b/i],[C,[_e,"Verizon"],[x,EN]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[C,[_e,"Barnes & Noble"],[x,EN]],[/\b(tm\d{3}\w+) b/i],[C,[_e,"NuVision"],[x,EN]],[/\b(k88) b/i],[C,[_e,"ZTE"],[x,EN]],[/\b(nx\d{3}j) b/i],[C,[_e,"ZTE"],[x,mN]],[/\b(gen\d{3}) b.+49h/i],[C,[_e,"Swiss"],[x,mN]],[/\b(zur\d{3}) b/i],[C,[_e,"Swiss"],[x,EN]],[/\b((zeki)?tb.*\b) b/i],[C,[_e,"Zeki"],[x,EN]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_e,"Dragon Touch"],C,[x,EN]],[/\b(ns-?\w{0,9}) b/i],[C,[_e,"Insignia"],[x,EN]],[/\b((nxa|next)-?\w{0,9}) b/i],[C,[_e,"NextBook"],[x,EN]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_e,"Voice"],C,[x,mN]],[/\b(lvtel\-)?(v1[12]) b/i],[[_e,"LvTel"],C,[x,mN]],[/\b(ph-1) /i],[C,[_e,"Essential"],[x,mN]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[C,[_e,"Envizen"],[x,EN]],[/\b(trio[-\w\. ]+) b/i],[C,[_e,"MachSpeed"],[x,EN]],[/\btu_(1491) b/i],[C,[_e,"Rotor"],[x,EN]],[/(shield[\w ]+) b/i],[C,[_e,"Nvidia"],[x,EN]],[/(sprint) (\w+)/i],[_e,C,[x,mN]],[/(kin\.[onetw]{3})/i],[[C,/\./g," "],[_e,KH],[x,mN]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[C,[_e,gH],[x,EN]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[C,[_e,gH],[x,mN]],[/smart-tv.+(samsung)/i],[_e,[x,RN]],[/hbbtv.+maple;(\d+)/i],[[C,/^/,"SmartTV"],[_e,GH],[x,RN]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_e,VH],[x,RN]],[/(apple) ?tv/i],[_e,[C,pH+" TV"],[x,RN]],[/crkey/i],[[C,UH+"cast"],[_e,CH],[x,RN]],[/droid.+aft(\w)( bui|\))/i],[C,[_e,aH],[x,RN]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[C,[_e,yH],[x,RN]],[/(bravia[\w ]+)( bui|\))/i],[C,[_e,TH],[x,RN]],[/(mitv-\w{5}) bui/i],[C,[_e,NH],[x,RN]],[/Hbbtv.*(technisat) (.*);/i],[_e,C,[x,RN]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_e,H5],[C,H5],[x,RN]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[x,RN]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_e,C,[x,fN]],[/droid.+; (shield) bui/i],[C,[_e,"Nvidia"],[x,fN]],[/(playstation [345portablevi]+)/i],[C,[_e,TH],[x,fN]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[C,[_e,KH],[x,fN]],[/((pebble))app/i],[_e,C,[x,IN]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[C,[_e,pH],[x,IN]],[/droid.+; (glass) \d/i],[C,[_e,CH],[x,IN]],[/droid.+; (wt63?0{2,3})\)/i],[C,[_e,gH],[x,IN]],[/(quest( 2| pro)?)/i],[C,[_e,SN],[x,IN]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_e,[x,t0]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[C,[x,mN]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[C,[x,EN]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[x,EN]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[x,mN]],[/(android[-\w\. ]{0,9});.+buil/i],[C,[_e,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[cN,[A,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[cN,[A,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[A,cN],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[cN,A]],os:[[/microsoft (windows) (vista|xp)/i],[A,cN],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[A,[cN,C6,fK]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,"Windows"],[cN,C6,fK]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[cN,/_/g,"."],[A,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[A,fH],[cN,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[cN,A],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[A,cN],[/\(bb(10);/i],[cN,[A,vH]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[cN,[A,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[cN,[A,zH+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[cN,[A,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[cN,[A,"watchOS"]],[/crkey\/([\d\.]+)/i],[cN,[A,UH+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[A,oH],cN],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[A,cN],[/(sunos) ?([\w\.\d]*)/i],[[A,"Solaris"],cN],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[A,cN]]},i4=function(B5,y5){if(typeof B5===h&&(y5=B5,B5=r),!(this instanceof i4))return new i4(B5,y5).getResult();var k5=typeof e!==o&&e.navigator?e.navigator:r,Q5=B5||(k5&&k5.userAgent?k5.userAgent:""),M6=k5&&k5.userAgentData?k5.userAgentData:r,g6=y5?function(W5,HK){var f8={};for(var X6 in W5)HK[X6]&&HK[X6].length%2==0?f8[X6]=HK[X6].concat(W5[X6]):f8[X6]=W5[X6];return f8}(D4,y5):D4;return this.getBrowser=function(){var W5={};return W5[A]=r,W5[cN]=r,d6.call(W5,Q5,g6.browser),W5[g]=function(HK){return typeof HK===p?HK.replace(/[^\d\.]/g,"").split(".")[0]:r}(W5[cN]),k5&&k5.brave&&typeof k5.brave.isBrave==i&&(W5[A]="Brave"),W5},this.getCPU=function(){var W5={};return W5[dN]=r,d6.call(W5,Q5,g6.cpu),W5},this.getDevice=function(){var W5={};return W5[_e]=r,W5[C]=r,W5[x]=r,d6.call(W5,Q5,g6.device),!W5[x]&&M6&&M6.mobile&&(W5[x]=mN),W5[C]=="Macintosh"&&k5&&typeof k5.standalone!==o&&k5.maxTouchPoints&&k5.maxTouchPoints>2&&(W5[C]="iPad",W5[x]=EN),W5},this.getEngine=function(){var W5={};return W5[A]=r,W5[cN]=r,d6.call(W5,Q5,g6.engine),W5},this.getOS=function(){var W5={};return W5[A]=r,W5[cN]=r,d6.call(W5,Q5,g6.os),!W5[A]&&M6&&M6.platform!="Unknown"&&(W5[A]=M6.platform.replace(/chrome os/i,oH).replace(/macos/i,fH)),W5},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Q5},this.setUA=function(W5){return Q5=typeof W5===p&&W5.length>350?H5(W5,350):W5,this},this.setUA(Q5),this};i4.VERSION="0.7.34",i4.BROWSER=xH([A,cN,g]),i4.CPU=xH([dN]),i4.DEVICE=xH([C,_e,x,fN,mN,RN,EN,IN,t0]),i4.ENGINE=i4.OS=xH([A,cN]),tp.exports&&(ep=tp.exports=i4),ep.UAParser=i4;var L6=typeof e!==o&&(e.jQuery||e.Zepto);if(L6&&!L6.ua){var X5=new i4;L6.ua=X5.getResult(),L6.ua.get=function(){return X5.getUA()},L6.ua.set=function(B5){X5.setUA(B5);var y5=X5.getResult();for(var k5 in y5)L6.ua[k5]=y5[k5]}}}(typeof window=="object"?window:Vs);var W2=ae(_E.exports),H2=Er,K2=Je,Y2=da,q2=es,z2=pe("iterator"),J2=Object,X2=function(e){if(Y2(e))return!1;var r=J2(e);return r[z2]!==void 0||"@@iterator"in r||K2(q2,H2(r))},Q2=ae(X2),ip=We;xt({global:!0,forced:ip.globalThis!==ip},{globalThis:ip});var VT=ae(We);function _w(e,r){return function(){return e.apply(r,arguments)}}var{toString:Z2}=Object.prototype,{getPrototypeOf:Xm}=Object,Ml=(rp=Object.create(null),e=>{let r=Z2.call(e);return rp[r]||(rp[r]=r.slice(8,-1).toLowerCase())}),rp,fr=e=>(e=e.toLowerCase(),r=>Ml(r)===e),ju=e=>r=>typeof r===e,{isArray:Is}=Array,Wa=ju("undefined"),FT=fr("ArrayBuffer"),$2=ju("string"),ai=ju("function"),BT=ju("number"),Td=e=>e!==null&&typeof e=="object",Sd=e=>{if(Ml(e)!=="object")return!1;let r=Xm(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Q2(e))},tx=fr("Date"),ex=fr("File"),nx=fr("Blob"),ix=fr("FileList"),rx=fr("URLSearchParams");function Ha(e,r){let i,o,{allOwnKeys:h=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Is(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{let p=h?Object.getOwnPropertyNames(e):Object.keys(e),g=p.length,C;for(i=0;i<g;i++)C=p[i],r.call(null,e[C],C,e)}}function jT(e,r){r=r.toLowerCase();let i=Object.keys(e),o,h=i.length;for(;h-- >0;)if(o=i[h],r===o.toLowerCase())return o;return null}var Ew=VT!==void 0?VT:typeof self<"u"?self:typeof window<"u"?window:global,GT=e=>!Wa(e)&&e!==Ew,ox=(op=typeof Uint8Array<"u"&&Xm(Uint8Array),e=>op&&e instanceof op),op,sx=fr("HTMLFormElement"),WT=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),ax=fr("RegExp"),HT=(e,r)=>{let i=Object.getOwnPropertyDescriptors(e),o={};Ha(i,(h,p)=>{let g;(g=r(h,p,e))!==!1&&(o[p]=g||h)}),Object.defineProperties(e,o)},sp="abcdefghijklmnopqrstuvwxyz",KT="0123456789",YT={DIGIT:KT,ALPHA:sp,ALPHA_DIGIT:sp+sp.toUpperCase()+KT},cx=fr("AsyncFunction"),K={isArray:Is,isArrayBuffer:FT,isBuffer:function(e){return e!==null&&!Wa(e)&&e.constructor!==null&&!Wa(e.constructor)&&ai(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||ai(e.append)&&((r=Ml(e))==="formdata"||r==="object"&&ai(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&FT(e.buffer),r},isString:$2,isNumber:BT,isBoolean:e=>e===!0||e===!1,isObject:Td,isPlainObject:Sd,isUndefined:Wa,isDate:tx,isFile:ex,isBlob:nx,isRegExp:ax,isFunction:ai,isStream:e=>Td(e)&&ai(e.pipe),isURLSearchParams:rx,isTypedArray:ox,isFileList:ix,forEach:Ha,merge:function e(){let{caseless:r}=GT(this)&&this||{},i={},o=(h,p)=>{let g=r&&jT(i,p)||p;Sd(i[g])&&Sd(h)?i[g]=e(i[g],h):Sd(h)?i[g]=e({},h):Is(h)?i[g]=h.slice():i[g]=h};for(let h=0,p=arguments.length;h<p;h++)arguments[h]&&Ha(arguments[h],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ha(r,(h,p)=>{i&&ai(h)?e[p]=_w(h,i):e[p]=h},{allOwnKeys:o}),e},trim:e=>rn(e)?rn(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let h,p,g,C={};if(r=r||{},e==null)return r;do{for(h=Object.getOwnPropertyNames(e),p=h.length;p-- >0;)g=h[p],o&&!o(g,e,r)||C[g]||(r[g]=e[g],C[g]=!0);e=i!==!1&&Xm(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:Ml,kindOfTest:fr,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;let o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(Is(e))return e;let r=e.length;if(!BT(r))return null;let i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{let i=(e&&e[Symbol.iterator]).call(e),o;for(;(o=i.next())&&!o.done;){let h=o.value;r.call(e,h[0],h[1])}},matchAll:(e,r)=>{let i,o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:sx,hasOwnProperty:WT,hasOwnProp:WT,reduceDescriptors:HT,freezeMethods:e=>{HT(e,(r,i)=>{if(ai(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let o=e[i];ai(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{let i={},o=h=>{h.forEach(p=>{i[p]=!0})};return Is(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>(e=+e,Number.isFinite(e)?e:r),findKey:jT,global:Ew,isContextDefined:GT,ALPHABET:YT,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:YT.ALPHA_DIGIT,i="",{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&ai(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let r=new Array(10),i=(o,h)=>{if(Td(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[h]=o;let p=Is(o)?[]:{};return Ha(o,(g,C)=>{let A=i(g,h+1);!Wa(A)&&(p[C]=A)}),r[h]=void 0,p}}return o};return i(e,0)},isAsyncFn:cx,isThenable:e=>e&&(Td(e)||ai(e))&&ai(e.then)&&ai(e.catch)};function qt(e,r,i,o,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),h&&(this.response=h)}K.inherits(qt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:K.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var qT=qt.prototype,zT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{zT[e]={value:e}}),Object.defineProperties(qt,zT),Object.defineProperty(qT,"isAxiosError",{value:!0}),qt.from=(e,r,i,o,h,p)=>{let g=Object.create(qT);return K.toFlatObject(e,g,function(C){return C!==Error.prototype},C=>C!=="isAxiosError"),qt.call(g,e.message,r,i,o,h),g.cause=e,g.name=e.name,p&&Object.assign(g,p),g};function ap(e){return K.isPlainObject(e)||K.isArray(e)}function mw(e){return K.endsWith(e,"[]")?e.slice(0,-2):e}function JT(e,r,i){return e?e.concat(r).map(function(o,h){return o=mw(o),!i&&h?"["+o+"]":o}).join(i?".":""):r}var dx=K.toFlatObject(K,{},null,function(e){return/^is[A-Z]/.test(e)});function Ul(e,r,i){if(!K.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;let o=(i=K.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(dN,fN){return!K.isUndefined(fN[dN])})).metaTokens,h=i.visitor||x,p=i.dots,g=i.indexes,C=(i.Blob||typeof Blob<"u"&&Blob)&&K.isSpecCompliantForm(r);if(!K.isFunction(h))throw new TypeError("visitor must be a function");function A(dN){if(dN===null)return"";if(K.isDate(dN))return dN.toISOString();if(!C&&K.isBlob(dN))throw new qt("Blob is not supported. Use a Buffer instead.");return K.isArrayBuffer(dN)||K.isTypedArray(dN)?C&&typeof Blob=="function"?new Blob([dN]):Buffer.from(dN):dN}function x(dN,fN,mN){let EN=dN;if(dN&&!mN&&typeof dN=="object"){if(K.endsWith(fN,"{}"))fN=o?fN:fN.slice(0,-2),dN=JSON.stringify(dN);else if(K.isArray(dN)&&function(RN){return K.isArray(RN)&&!RN.some(ap)}(dN)||(K.isFileList(dN)||K.endsWith(fN,"[]"))&&(EN=K.toArray(dN)))return fN=mw(fN),EN.forEach(function(RN,IN){!K.isUndefined(RN)&&RN!==null&&r.append(g===!0?JT([fN],IN,p):g===null?fN:fN+"[]",A(RN))}),!1}return!!ap(dN)||(r.append(JT(mN,fN,p),A(dN)),!1)}let _e=[],cN=Object.assign(dx,{defaultVisitor:x,convertValue:A,isVisitable:ap});if(!K.isObject(e))throw new TypeError("data must be an object");return function dN(fN,mN){if(!K.isUndefined(fN)){if(_e.indexOf(fN)!==-1)throw Error("Circular reference detected in "+mN.join("."));_e.push(fN),K.forEach(fN,function(EN,RN){(!(K.isUndefined(EN)||EN===null)&&h.call(r,EN,K.isString(RN)?rn(RN).call(RN):RN,mN,cN))===!0&&dN(EN,mN?mN.concat(RN):[RN])}),_e.pop()}}(e),r}function XT(e){let r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function Qm(e,r){this._pairs=[],e&&Ul(e,this,r)}var QT=Qm.prototype;function lx(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fw(e,r,i){if(!r)return e;let o=i&&i.encode||lx,h=i&&i.serialize,p;if(p=h?h(r,i):K.isURLSearchParams(r)?r.toString():new Qm(r,i).toString(o),p){let g=e.indexOf("#");g!==-1&&(e=e.slice(0,g)),e+=(e.indexOf("?")===-1?"?":"&")+p}return e}QT.append=function(e,r){this._pairs.push([e,r])},QT.toString=function(e){let r=e?function(i){return e.call(this,i,XT)}:XT;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var ZT=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){K.forEach(this.handlers,function(r){r!==null&&e(r)})}},gw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Tw={exports:{}},ux=xt,hx=ri,$T=Ai.f;ux({target:"Object",stat:!0,forced:Object.defineProperty!==$T,sham:!hx},{defineProperty:$T});var Sw=Gi.Object,px=Tw.exports=function(e,r,i){return Sw.defineProperty(e,r,i)};Sw.defineProperty.sham&&(px.sham=!0);var Rw=ae(Tw.exports),_x=pr,nd=Array.isArray||function(e){return _x(e)=="Array"},Ex=TypeError,tS=nd,mx=xu,fx=Hn,gx=pe("species"),eS=Array,Tx=function(e){var r;return tS(e)&&(r=e.constructor,(mx(r)&&(r===eS||tS(r.prototype))||fx(r)&&(r=r[gx])===null)&&(r=void 0)),r===void 0?eS:r},Cw=function(e,r){return new(Tx(e))(r===0?0:r)},Sx=Se,Rx=zo,Cx=pe("species"),Iw=function(e){return Rx>=51||!Sx(function(){var r=[];return(r.constructor={})[Cx]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Ix=xt,vx=Se,yx=nd,Ax=Hn,bx=_r,wx=Lr,nS=function(e){if(e>9007199254740991)throw Ex("Maximum allowed index exceeded");return e},iS=Bu,Ox=Cw,Nx=Iw,Dx=zo,vw=pe("isConcatSpreadable"),Px=Dx>=51||!vx(function(){var e=[];return e[vw]=!1,e.concat()[0]!==e}),kx=function(e){if(!Ax(e))return!1;var r=e[vw];return r!==void 0?!!r:yx(e)};Ix({target:"Array",proto:!0,arity:1,forced:!Px||!Nx("concat")},{concat:function(e){var r,i,o,h,p,g=bx(this),C=Ox(g,0),A=0;for(r=-1,o=arguments.length;r<o;r++)if(kx(p=r===-1?g:arguments[r]))for(h=wx(p),nS(A+h),i=0;i<h;i++,A++)i in p&&iS(C,A,p[i]);else nS(A+1),iS(C,A++,p);return C.length=A,C}});var yw={},Lx=pr,Mx=Eo,rS=Pu.f,Ux=zm,oS=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];yw.f=function(e){return oS&&Lx(e)=="Window"?function(r){try{return rS(r)}catch{return Ux(oS)}}(e):rS(Mx(e))};var Ea={},xx=pe;Ea.f=xx;var sS=Gi,Vx=Je,Fx=Ea,Bx=Ai.f,Fe=function(e){var r=sS.Symbol||(sS.Symbol={});Vx(r,e)||Bx(r,e,{value:Fx.f(e)})},jx=Ke,Gx=Dn,Wx=pe,Hx=go,Aw=function(){var e=Gx("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=Wx("toPrimitive");r&&!r[o]&&Hx(r,o,function(h){return jx(i,this)},{arity:1})},Kx=mo,Yx=bu,qx=_r,zx=Lr,Jx=Cw,aS=me([].push),Vr=function(e){var r=e==1,i=e==2,o=e==3,h=e==4,p=e==6,g=e==7,C=e==5||p;return function(A,x,_e,cN){for(var dN,fN,mN=qx(A),EN=Yx(mN),RN=Kx(x,_e),IN=zx(EN),t0=0,aH=cN||Jx,pH=r?aH(A,IN):i||g?aH(A,0):void 0;IN>t0;t0++)if((C||t0 in EN)&&(fN=RN(dN=EN[t0],t0,mN),e))if(r)pH[t0]=fN;else if(fN)switch(e){case 3:return!0;case 5:return dN;case 6:return t0;case 2:aS(pH,dN)}else switch(e){case 4:return!1;case 7:aS(pH,dN)}return p?-1:o||h?h:pH}},bw={forEach:Vr(0),map:Vr(1),filter:Vr(2),some:Vr(3),every:Vr(4),find:Vr(5),findIndex:Vr(6),filterReject:Vr(7)},Rd=xt,Zm=We,$m=Ke,Xx=me,js=ri,ds=ua,Qx=Se,dn=Je,Zx=hn,EE=Cn,Gu=Eo,tf=Ou,$x=oi,mE=_o,Sc=Qc,ww=Lu,tV=Pu,Ow=yw,eV=Xc,Nw=Yc,Dw=Ai,nV=Mm,Pw=Au,cS=go,iV=Uu,ef=pa,kw=ku,dS=Am,rV=pe,oV=Ea,sV=Fe,aV=Aw,cV=To,Lw=ns,Wu=bw.forEach,Vn=Du("hidden"),xl="Symbol",Rc="prototype",dV=Lw.set,lS=Lw.getterFor(xl),Fi=Object[Rc],Ns=Zm.Symbol,_l=Ns&&Ns[Rc],lV=Zm.TypeError,cp=Zm.QObject,Mw=Nw.f,ko=Dw.f,Uw=Ow.f,uV=Pw.f,xw=Xx([].push),kr=ef("symbols"),id=ef("op-symbols"),hV=ef("wks"),dp=!cp||!cp[Rc]||!cp[Rc].findChild,fE=js&&Qx(function(){return Sc(ko({},"a",{get:function(){return ko(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=Mw(Fi,r);o&&delete Fi[r],ko(e,r,i),o&&e!==Fi&&ko(Fi,r,o)}:ko,lp=function(e,r){var i=kr[e]=Sc(_l);return dV(i,{type:xl,tag:e,description:r}),js||(i.description=r),i},Vl=function(e,r,i){e===Fi&&Vl(id,r,i),EE(e);var o=tf(r);return EE(i),dn(kr,o)?(i.enumerable?(dn(e,Vn)&&e[Vn][o]&&(e[Vn][o]=!1),i=Sc(i,{enumerable:mE(0,!1)})):(dn(e,Vn)||ko(e,Vn,mE(1,{})),e[Vn][o]=!0),fE(e,o,i)):ko(e,o,i)},up=function(e,r){EE(e);var i=Gu(r),o=ww(i).concat(Fw(i));return Wu(o,function(h){js&&!$m(Vw,i,h)||Vl(e,h,i[h])}),e},Vw=function(e){var r=tf(e),i=$m(uV,this,r);return!(this===Fi&&dn(kr,r)&&!dn(id,r))&&(!(i||!dn(this,r)||!dn(kr,r)||dn(this,Vn)&&this[Vn][r])||i)},uS=function(e,r){var i=Gu(e),o=tf(r);if(i!==Fi||!dn(kr,o)||dn(id,o)){var h=Mw(i,o);return!h||!dn(kr,o)||dn(i,Vn)&&i[Vn][o]||(h.enumerable=!0),h}},hS=function(e){var r=Uw(Gu(e)),i=[];return Wu(r,function(o){dn(kr,o)||dn(kw,o)||xw(i,o)}),i},Fw=function(e){var r=e===Fi,i=Uw(r?id:Gu(e)),o=[];return Wu(i,function(h){!dn(kr,h)||r&&!dn(Fi,h)||xw(o,kr[h])}),o};ds||(cS(_l=(Ns=function(){if(Zx(_l,this))throw lV("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?$x(arguments[0]):void 0,r=dS(e),i=function(o){this===Fi&&$m(i,id,o),dn(this,Vn)&&dn(this[Vn],r)&&(this[Vn][r]=!1),fE(this,r,mE(1,o))};return js&&dp&&fE(Fi,r,{configurable:!0,set:i}),lp(r,e)})[Rc],"toString",function(){return lS(this).tag}),cS(Ns,"withoutSetter",function(e){return lp(dS(e),e)}),Pw.f=Vw,Dw.f=Vl,nV.f=up,Nw.f=uS,tV.f=Ow.f=hS,eV.f=Fw,oV.f=function(e){return lp(rV(e),e)},js&&iV(_l,"description",{configurable:!0,get:function(){return lS(this).description}})),Rd({global:!0,constructor:!0,wrap:!0,forced:!ds,sham:!ds},{Symbol:Ns}),Wu(ww(hV),function(e){sV(e)}),Rd({target:xl,stat:!0,forced:!ds},{useSetter:function(){dp=!0},useSimple:function(){dp=!1}}),Rd({target:"Object",stat:!0,forced:!ds,sham:!js},{create:function(e,r){return r===void 0?Sc(e):up(Sc(e),r)},defineProperty:Vl,defineProperties:up,getOwnPropertyDescriptor:uS}),Rd({target:"Object",stat:!0,forced:!ds},{getOwnPropertyNames:hS}),aV(),cV(Ns,xl),kw[Vn]=!0;var Bw=ua&&!!Symbol.for&&!!Symbol.keyFor,pV=xt,_V=Dn,EV=Je,mV=oi,jw=pa,fV=Bw,hp=jw("string-to-symbol-registry"),gV=jw("symbol-to-string-registry");pV({target:"Symbol",stat:!0,forced:!fV},{for:function(e){var r=mV(e);if(EV(hp,r))return hp[r];var i=_V("Symbol")(r);return hp[r]=i,gV[i]=r,i}});var TV=xt,SV=Je,RV=qc,CV=ha,IV=Bw,pS=pa("symbol-to-string-registry");TV({target:"Symbol",stat:!0,forced:!IV},{keyFor:function(e){if(!RV(e))throw TypeError(CV(e)+" is not a symbol");if(SV(pS,e))return pS[e]}});var _S=nd,vV=He,ES=pr,yV=oi,mS=me([].push),AV=xt,Gw=Dn,Ww=vm,bV=Ke,rd=me,Hw=Se,fS=He,gS=qc,Kw=Gm,wV=function(e){if(vV(e))return e;if(_S(e)){for(var r=e.length,i=[],o=0;o<r;o++){var h=e[o];typeof h=="string"?mS(i,h):typeof h!="number"&&ES(h)!="Number"&&ES(h)!="String"||mS(i,yV(h))}var p=i.length,g=!0;return function(C,A){if(g)return g=!1,A;if(_S(this))return A;for(var x=0;x<p;x++)if(i[x]===C)return A}}},OV=ua,NV=String,ro=Gw("JSON","stringify"),Cd=rd(/./.exec),TS=rd("".charAt),DV=rd("".charCodeAt),PV=rd("".replace),kV=rd(1 .toString),LV=/[\uD800-\uDFFF]/g,SS=/^[\uD800-\uDBFF]$/,RS=/^[\uDC00-\uDFFF]$/,CS=!OV||Hw(function(){var e=Gw("Symbol")();return ro([e])!="[null]"||ro({a:e})!="{}"||ro(Object(e))!="{}"}),IS=Hw(function(){return ro("\uDF06\uD834")!=='"\\udf06\\ud834"'||ro("\uDEAD")!=='"\\udead"'}),MV=function(e,r){var i=Kw(arguments),o=wV(r);if(fS(o)||e!==void 0&&!gS(e))return i[1]=function(h,p){if(fS(o)&&(p=bV(o,this,NV(h),p)),!gS(p))return p},Ww(ro,null,i)},UV=function(e,r,i){var o=TS(i,r-1),h=TS(i,r+1);return Cd(SS,e)&&!Cd(RS,h)||Cd(RS,e)&&!Cd(SS,o)?"\\u"+kV(DV(e,0),16):e};ro&&AV({target:"JSON",stat:!0,arity:3,forced:CS||IS},{stringify:function(e,r,i){var o=Kw(arguments),h=Ww(CS?MV:ro,null,o);return IS&&typeof h=="string"?PV(h,LV,UV):h}});var vS=Xc,xV=_r;xt({target:"Object",stat:!0,forced:!ua||Se(function(){vS.f(1)})},{getOwnPropertySymbols:function(e){var r=vS.f;return r?r(xV(e)):[]}}),Fe("asyncIterator"),Fe("hasInstance"),Fe("isConcatSpreadable"),Fe("iterator"),Fe("match"),Fe("matchAll"),Fe("replace"),Fe("search"),Fe("species"),Fe("split");var VV=Aw;Fe("toPrimitive"),VV();var FV=Dn,BV=To;Fe("toStringTag"),BV(FV("Symbol"),"Symbol"),Fe("unscopables"),To(We.JSON,"JSON",!0);var jV=Gi.Symbol,GV=pe,WV=Ai.f,yS=GV("metadata"),AS=Function.prototype;AS[yS]===void 0&&WV(AS,yS,{value:null}),Fe("dispose"),Fe("metadata");var HV=jV;Fe("asyncDispose");var KV=me,nf=Dn("Symbol"),YV=nf.keyFor,qV=KV(nf.prototype.valueOf),Yw=nf.isRegisteredSymbol||function(e){try{return YV(qV(e))!==void 0}catch{return!1}};xt({target:"Symbol",stat:!0},{isRegisteredSymbol:Yw});for(bS=pa,pp=Dn,wS=me,OS=qc,NS=pe,Na=pp("Symbol"),gE=Na.isWellKnownSymbol,TE=pp("Object","getOwnPropertyNames"),qw=wS(Na.prototype.valueOf),SE=bS("wks"),Id=0,_p=TE(Na),DS=_p.length;Id<DS;Id++)try{Ep=_p[Id],OS(Na[Ep])&&NS(Ep)}catch{}var Ep,bS,pp,wS,OS,NS,Na,gE,TE,qw,SE,Id,_p,DS,PS=function(e){if(gE&&gE(e))return!0;try{for(var r=qw(e),i=0,o=TE(SE),h=o.length;i<h;i++)if(SE[o[i]]==r)return!0}catch{}return!1};xt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:PS}),Fe("matcher"),Fe("observable"),xt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Yw}),xt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:PS}),Fe("metadataKey"),Fe("patternMatch"),Fe("replaceAll");var Ds=ae(HV),zw=ae(Ea.f("iterator"));function oc(e){return oc=typeof Ds=="function"&&typeof zw=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Ds=="function"&&r.constructor===Ds&&r!==Ds.prototype?"symbol":typeof r},oc(e)}var zV=ae(Ea.f("toPrimitive"));function JV(e){var r=function(i,o){if(oc(i)!=="object"||i===null)return i;var h=i[zV];if(h!==void 0){var p=h.call(i,o||"default");if(oc(p)!=="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return oc(r)==="symbol"?r:String(r)}function T(e,r,i){return(r=JV(r))in e?Rw(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var XV=Se,QV=pe("iterator"),rf=!XV(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(h,p){r.delete("b"),o+=p+h}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[QV]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),ZV=go,mp=xt,Xs=We,vd=Ke,ur=me,Ps=ri,kS=rf,LS=go,$V=Uu,tF=function(e,r,i){for(var o in r)i.unsafe&&e[o]?e[o]=r[o]:ZV(e,o,r[o],i);return e},eF=To,nF=xm,of=ns,Jw=Fm,fp=He,iF=Je,rF=mo,oF=Er,sF=Cn,Xw=Hn,bn=oi,aF=Qc,MS=_o,RE=Um,cF=Mu,ls=Vu,dF=hw,lF=pe("iterator"),Cc="URLSearchParams",Qw=Cc+"Iterator",Zw=of.set,fi=of.getterFor(Cc),uF=of.getterFor(Qw),hF=Object.getOwnPropertyDescriptor,sf=function(e){if(!Ps)return Xs[e];var r=hF(Xs,e);return r&&r.value},US=sf("fetch"),Fl=sf("Request"),sc=sf("Headers"),gp=Fl&&Fl.prototype,xS=sc&&sc.prototype,pF=Xs.RegExp,_F=Xs.TypeError,$w=Xs.decodeURIComponent,EF=Xs.encodeURIComponent,mF=ur("".charAt),VS=ur([].join),xo=ur([].push),CE=ur("".replace),fF=ur([].shift),FS=ur([].splice),BS=ur("".split),gF=ur("".slice),TF=/\+/g,jS=Array(4),SF=function(e){return jS[e-1]||(jS[e-1]=pF("((?:%[\\da-f]{2}){"+e+"})","gi"))},RF=function(e){try{return $w(e)}catch{return e}},GS=function(e){var r=CE(e,TF," "),i=4;try{return $w(r)}catch{for(;i;)r=CE(r,SF(i--),RF);return r}},CF=/[!'()~]|%20/g,IF={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vF=function(e){return IF[e]},WS=function(e){return CE(EF(e),CF,vF)},Tp=nF(function(e,r){Zw(this,{type:Qw,iterator:RE(fi(e).entries),kind:r})},"Iterator",function(){var e=uF(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),tO=function(e){this.entries=[],this.url=null,e!==void 0&&(Xw(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?mF(e,0)==="?"?gF(e,1):e:bn(e)))};tO.prototype={type:Cc,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,h,p,g,C,A=cF(e);if(A)for(i=(r=RE(e,A)).next;!(o=vd(i,r)).done;){if(p=(h=RE(sF(o.value))).next,(g=vd(p,h)).done||(C=vd(p,h)).done||!vd(p,h).done)throw _F("Expected sequence with length 2");xo(this.entries,{key:bn(g.value),value:bn(C.value)})}else for(var x in e)iF(e,x)&&xo(this.entries,{key:x,value:bn(e[x])})},parseQuery:function(e){if(e)for(var r,i,o=BS(e,"&"),h=0;h<o.length;)(r=o[h++]).length&&(i=BS(r,"="),xo(this.entries,{key:GS(fF(i)),value:GS(VS(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],xo(i,WS(e.key)+"="+WS(e.value));return VS(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Bl=function(){Jw(this,vs);var e=Zw(this,new tO(arguments.length>0?arguments[0]:void 0));Ps||(this.size=e.entries.length)},vs=Bl.prototype;tF(vs,{append:function(e,r){var i=fi(this);ls(arguments.length,2),xo(i.entries,{key:bn(e),value:bn(r)}),Ps||this.length++,i.updateURL()},delete:function(e){for(var r=fi(this),i=ls(arguments.length,1),o=r.entries,h=bn(e),p=i<2?void 0:arguments[1],g=p===void 0?p:bn(p),C=0;C<o.length;){var A=o[C];if(A.key!==h||g!==void 0&&A.value!==g)C++;else if(FS(o,C,1),g!==void 0)break}Ps||(this.size=o.length),r.updateURL()},get:function(e){var r=fi(this).entries;ls(arguments.length,1);for(var i=bn(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=fi(this).entries;ls(arguments.length,1);for(var i=bn(e),o=[],h=0;h<r.length;h++)r[h].key===i&&xo(o,r[h].value);return o},has:function(e){for(var r=fi(this).entries,i=ls(arguments.length,1),o=bn(e),h=i<2?void 0:arguments[1],p=h===void 0?h:bn(h),g=0;g<r.length;){var C=r[g++];if(C.key===o&&(p===void 0||C.value===p))return!0}return!1},set:function(e,r){var i=fi(this);ls(arguments.length,1);for(var o,h=i.entries,p=!1,g=bn(e),C=bn(r),A=0;A<h.length;A++)(o=h[A]).key===g&&(p?FS(h,A--,1):(p=!0,o.value=C));p||xo(h,{key:g,value:C}),Ps||(this.size=h.length),i.updateURL()},sort:function(){var e=fi(this);dF(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=fi(this).entries,o=rF(e,arguments.length>1?arguments[1]:void 0),h=0;h<i.length;)o((r=i[h++]).value,r.key,this)},keys:function(){return new Tp(this,"keys")},values:function(){return new Tp(this,"values")},entries:function(){return new Tp(this,"entries")}},{enumerable:!0}),LS(vs,lF,vs.entries,{name:"entries"}),LS(vs,"toString",function(){return fi(this).serialize()},{enumerable:!0}),Ps&&$V(vs,"size",{get:function(){return fi(this).entries.length},configurable:!0,enumerable:!0}),eF(Bl,Cc),mp({global:!0,constructor:!0,forced:!kS},{URLSearchParams:Bl}),!kS&&fp(sc)&&(HS=ur(xS.has),KS=ur(xS.set),Sp=function(e){if(Xw(e)){var r,i=e.body;if(oF(i)===Cc)return r=e.headers?new sc(e.headers):new sc,HS(r,"content-type")||KS(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),aF(e,{body:MS(0,bn(i)),headers:MS(0,r)})}return e},fp(US)&&mp({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return US(e,arguments.length>1?Sp(arguments[1]):{})}}),fp(Fl)&&(yd=function(e){return Jw(this,gp),new Fl(e,arguments.length>1?Sp(arguments[1]):{})},gp.constructor=yd,yd.prototype=gp,mp({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:yd})));var HS,KS,Sp,yd,yF={URLSearchParams:Bl,getState:fi},YS=ae(Gi.URLSearchParams),AF={isBrowser:!0,classes:{URLSearchParams:YS!==void 0?YS:Qm,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},eO=typeof window<"u"&&typeof document<"u",bF=(qS=typeof navigator<"u"&&navigator.product,eO&&["ReactNative","NativeScript","NS"].indexOf(qS)<0),qS,wF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function zS(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function JS(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?zS(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zS(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var sr=JS(JS({},Object.freeze({__proto__:null,hasBrowserEnv:eO,hasStandardBrowserEnv:bF,hasStandardBrowserWebWorkerEnv:wF})),AF),OF=Cn,NF=Ke,DF=Je,PF=hn,kF=function(){var e=OF(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},XS=RegExp.prototype,nO=function(e){var r=e.flags;return r!==void 0||"flags"in XS||DF(e,"flags")||!PF(XS,e)?r:NF(kF,e)},LF=qm.charAt,QS=Ke,MF=Cn,UF=He,xF=pr,VF=/./.exec,FF=TypeError,BF=xt,ZS=Ke,iO=gc,jF=xm,Ad=Vm,$S=la,rO=MA,Ic=oi,GF=Cn,WF=da,HF=pr,KF=UA,oO=nO,YF=wu,qF=Se,zF=jm,JF=function(e,r,i){return r+(i?LF(e,r).length:1)},XF=function(e,r){var i=e.exec;if(UF(i)){var o=QS(i,e,r);return o!==null&&MF(o),o}if(xF(e)==="RegExp")return QS(VF,e,r);throw FF("RegExp#exec called on incompatible receiver")},sO=ns,QF=pe("matchAll"),aO="RegExp String",cO=aO+" Iterator",ZF=sO.set,$F=sO.getterFor(cO),tB=TypeError,IE=iO("".indexOf),jl=iO("".matchAll),Rp=!!jl&&!qF(function(){jl("a",/./)}),eB=jF(function(e,r,i,o){ZF(this,{type:cO,regexp:e,string:r,global:i,unicode:o,done:!1})},aO,function(){var e=$F(this);if(e.done)return Ad(void 0,!0);var r=e.regexp,i=e.string,o=XF(r,i);return o===null?(e.done=!0,Ad(void 0,!0)):e.global?(Ic(o[0])===""&&(r.lastIndex=JF(i,rO(r.lastIndex),e.unicode)),Ad(o,!1)):(e.done=!0,Ad(o,!1))}),tR=function(e){var r,i,o,h=GF(this),p=Ic(e),g=zF(h,RegExp),C=Ic(oO(h));return r=new g(g===RegExp?h.source:h,C),i=!!~IE(C,"g"),o=!!~IE(C,"u"),r.lastIndex=rO(h.lastIndex),new eB(r,p,i,o)};BF({target:"String",proto:!0,forced:Rp},{matchAll:function(e){var r,i,o,h,p=$S(this);if(WF(e)){if(Rp)return jl(p,e)}else{if(KF(e)&&(r=Ic($S(oO(e))),!~IE(r,"g")))throw tB("`.matchAll` does not allow non-global regexes");if(Rp)return jl(p,e);if((o=YF(e,QF))===void 0&&HF(e)=="RegExp"&&(o=tR),o)return ZS(o,e,p)}return i=Ic(p),h=new RegExp(e,"g"),ZS(tR,h,i)}});var nB=bi("String").matchAll,iB=hn,rB=nB,Cp=String.prototype,oB=function(e){var r=e.matchAll;return typeof e=="string"||e===Cp||iB(Cp,e)&&r===Cp.matchAll?rB:r},sB=ae(oB);function dO(e){function r(i,o,h,p){let g=i[p++];if(g==="__proto__")return!0;let C=Number.isFinite(+g),A=p>=i.length;return g=!g&&K.isArray(h)?h.length:g,A?(K.hasOwnProp(h,g)?h[g]=[h[g],o]:h[g]=o,!C):(h[g]&&K.isObject(h[g])||(h[g]=[]),r(i,o,h[g],p)&&K.isArray(h[g])&&(h[g]=function(x){let _e={},cN=Object.keys(x),dN,fN=cN.length,mN;for(dN=0;dN<fN;dN++)mN=cN[dN],_e[mN]=x[mN];return _e}(h[g])),!C)}if(K.isFormData(e)&&K.isFunction(e.entries)){let i={};return K.forEachEntry(e,(o,h)=>{r(function(p){return sB(K).call(K,/\w+|\[(\w*)]/g,p).map(g=>g[0]==="[]"?"":g[1]||g[0])}(o),h,i,0)}),i}return null}var af={transitional:gw,adapter:["xhr","http"],transformRequest:[function(e,r){let i=r.getContentType()||"",o=i.indexOf("application/json")>-1,h=K.isObject(e);if(h&&K.isHTMLForm(e)&&(e=new FormData(e)),K.isFormData(e))return o?JSON.stringify(dO(e)):e;if(K.isArrayBuffer(e)||K.isBuffer(e)||K.isStream(e)||K.isFile(e)||K.isBlob(e))return e;if(K.isArrayBufferView(e))return e.buffer;if(K.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let p;if(h){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(g,C){return Ul(g,new sr.classes.URLSearchParams,Object.assign({visitor:function(A,x,_e,cN){return sr.isNode&&K.isBuffer(A)?(this.append(x,A.toString("base64")),!1):cN.defaultVisitor.apply(this,arguments)}},C))}(e,this.formSerializer).toString();if((p=K.isFileList(e))||i.indexOf("multipart/form-data")>-1){let g=this.env&&this.env.FormData;return Ul(p?{"files[]":e}:e,g&&new g,this.formSerializer)}}return h||o?(r.setContentType("application/json",!1),function(g,C,A){if(K.isString(g))try{return(C||JSON.parse)(g),rn(K).call(K,g)}catch(x){if(x.name!=="SyntaxError")throw x}return(0,JSON.stringify)(g)}(e)):e}],transformResponse:[function(e){let r=this.transitional||af.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(e&&K.isString(e)&&(i&&!this.responseType||o)){let h=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(p){if(h)throw p.name==="SyntaxError"?qt.from(p,qt.ERR_BAD_RESPONSE,this,null,this.response):p}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:sr.classes.FormData,Blob:sr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};K.forEach(["delete","get","head","post","put","patch"],e=>{af.headers[e]={}});var cf=af,aB=K.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eR=Symbol("internals");function Da(e){var r;return e&&rn(r=String(e)).call(r).toLowerCase()}function El(e){return e===!1||e==null?e:K.isArray(e)?e.map(El):String(e)}function Ip(e,r,i,o,h){return K.isFunction(o)?o.call(this,r,i):(h&&(r=i),K.isString(r)?K.isString(o)?r.indexOf(o)!==-1:K.isRegExp(o)?o.test(r):void 0:void 0)}var Gs=class{constructor(e){e&&this.set(e)}set(e,r,i){let o=this;function h(C,A,x){let _e=Da(A);if(!_e)throw new Error("header name must be a non-empty string");let cN=K.findKey(o,_e);(!cN||o[cN]===void 0||x===!0||x===void 0&&o[cN]!==!1)&&(o[cN||A]=El(C))}let p=(C,A)=>K.forEach(C,(x,_e)=>h(x,_e,A));var g;return K.isPlainObject(e)||e instanceof this.constructor?p(e,r):K.isString(e)&&(e=rn(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(rn(g=e).call(g))?p((C=>{let A={},x,_e,cN;return C&&C.split(`
`).forEach(function(dN){var fN,mN;cN=dN.indexOf(":"),x=rn(fN=dN.substring(0,cN)).call(fN).toLowerCase(),_e=rn(mN=dN.substring(cN+1)).call(mN),!x||A[x]&&aB[x]||(x==="set-cookie"?A[x]?A[x].push(_e):A[x]=[_e]:A[x]=A[x]?A[x]+", "+_e:_e)}),A})(e),r):e!=null&&h(r,e,i),this}get(e,r){if(e=Da(e)){let i=K.findKey(this,e);if(i){let o=this[i];if(!r)return o;if(r===!0)return function(h){let p=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,C;for(;C=g.exec(h);)p[C[1]]=C[2];return p}(o);if(K.isFunction(r))return r.call(this,o,i);if(K.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Da(e)){let i=K.findKey(this,e);return!(!i||this[i]===void 0||r&&!Ip(0,this[i],i,r))}return!1}delete(e,r){let i=this,o=!1;function h(p){if(p=Da(p)){let g=K.findKey(i,p);!g||r&&!Ip(0,i[g],g,r)||(delete i[g],o=!0)}}return K.isArray(e)?e.forEach(h):h(e),o}clear(e){let r=Object.keys(this),i=r.length,o=!1;for(;i--;){let h=r[i];e&&!Ip(0,this[h],h,e,!0)||(delete this[h],o=!0)}return o}normalize(e){let r=this,i={};return K.forEach(this,(o,h)=>{var p;let g=K.findKey(i,h);if(g)return r[g]=El(o),void delete r[h];let C=e?function(A){return rn(A).call(A).toLowerCase().replace(/([a-z\d])(\w*)/g,(x,_e,cN)=>_e.toUpperCase()+cN)}(h):rn(p=String(h)).call(p);C!==h&&delete r[h],r[C]=El(o),i[C]=!0}),this}concat(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return this.constructor.concat(this,...r)}toJSON(e){let r=Object.create(null);return K.forEach(this,(i,o)=>{i!=null&&i!==!1&&(r[o]=e&&K.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[r,i]=e;return r+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let r=new this(e);for(var i=arguments.length,o=new Array(i>1?i-1:0),h=1;h<i;h++)o[h-1]=arguments[h];return o.forEach(p=>r.set(p)),r}static accessor(e){let r=(this[eR]=this[eR]={accessors:{}}).accessors,i=this.prototype;function o(h){let p=Da(h);r[p]||(function(g,C){let A=K.toCamelCase(" "+C);["get","set","has"].forEach(x=>{Object.defineProperty(g,x+A,{value:function(_e,cN,dN){return this[x].call(this,C,_e,cN,dN)},configurable:!0})})}(i,h),r[p]=!0)}return K.isArray(e)?e.forEach(o):o(e),this}};Gs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),K.reduceDescriptors(Gs.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(h){this[o]=h}}}),K.freezeMethods(Gs);var Dr=Gs;function vp(e,r){let i=this||cf,o=r||i,h=Dr.from(o.headers),p=o.data;return K.forEach(e,function(g){p=g.call(i,p,h.normalize(),r?r.status:void 0)}),h.normalize(),p}function lO(e){return!(!e||!e.__CANCEL__)}function od(e,r,i){qt.call(this,e??"canceled",qt.ERR_CANCELED,r,i),this.name="CanceledError"}K.inherits(od,qt,{__CANCEL__:!0});var cB=sr.hasStandardBrowserEnv?{write(e,r,i,o,h,p){let g=[e+"="+encodeURIComponent(r)];K.isNumber(i)&&g.push("expires="+new Date(i).toGMTString()),K.isString(o)&&g.push("path="+o),K.isString(h)&&g.push("domain="+h),p===!0&&g.push("secure"),document.cookie=g.join("; ")},read(e){let r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function uO(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}var dB=sr.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),i;function o(h){let p=h;return e&&(r.setAttribute("href",p),p=r.href),r.setAttribute("href",p),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=o(window.location.href),function(h){let p=K.isString(h)?o(h):h;return p.protocol===i.protocol&&p.host===i.host}}():function(){return!0};function nR(e,r){let i=0,o=function(h,p){h=h||10;let g=new Array(h),C=new Array(h),A,x=0,_e=0;return p=p!==void 0?p:1e3,function(cN){let dN=Date.now(),fN=C[_e];A||(A=dN),g[x]=cN,C[x]=dN;let mN=_e,EN=0;for(;mN!==x;)EN+=g[mN++],mN%=h;if(x=(x+1)%h,x===_e&&(_e=(_e+1)%h),dN-A<p)return;let RN=fN&&dN-fN;return RN?Math.round(1e3*EN/RN):void 0}}(50,250);return h=>{let p=h.loaded,g=h.lengthComputable?h.total:void 0,C=p-i,A=o(C);i=p;let x={loaded:p,total:g,progress:g?p/g:void 0,bytes:C,rate:A||void 0,estimated:A&&g&&p<=g?(g-p)/A:void 0,event:h};x[r?"download":"upload"]=!0,e(x)}}var lB=typeof XMLHttpRequest<"u"&&function(e){return new j(function(r,i){let o=e.data,h=Dr.from(e.headers).normalize(),p,g,{responseType:C,withXSRFToken:A}=e;function x(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}if(K.isFormData(o)){if(sr.hasStandardBrowserEnv||sr.hasStandardBrowserWebWorkerEnv)h.setContentType(!1);else if((g=h.getContentType())!==!1){let[mN,...EN]=g?g.split(";").map(RN=>rn(RN).call(RN)).filter(Boolean):[];h.setContentType([mN||"multipart/form-data",...EN].join("; "))}}let _e=new XMLHttpRequest;if(e.auth){let mN=e.auth.username||"",EN=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.set("Authorization","Basic "+btoa(mN+":"+EN))}let cN=uO(e.baseURL,e.url);function dN(){if(!_e)return;let mN=Dr.from("getAllResponseHeaders"in _e&&_e.getAllResponseHeaders());(function(EN,RN,IN){let t0=IN.config.validateStatus;IN.status&&t0&&!t0(IN.status)?RN(new qt("Request failed with status code "+IN.status,[qt.ERR_BAD_REQUEST,qt.ERR_BAD_RESPONSE][Math.floor(IN.status/100)-4],IN.config,IN.request,IN)):EN(IN)})(function(EN){r(EN),x()},function(EN){i(EN),x()},{data:C&&C!=="text"&&C!=="json"?_e.response:_e.responseText,status:_e.status,statusText:_e.statusText,headers:mN,config:e,request:_e}),_e=null}if(_e.open(e.method.toUpperCase(),fw(cN,e.params,e.paramsSerializer),!0),_e.timeout=e.timeout,"onloadend"in _e?_e.onloadend=dN:_e.onreadystatechange=function(){_e&&_e.readyState===4&&(_e.status!==0||_e.responseURL&&_e.responseURL.indexOf("file:")===0)&&setTimeout(dN)},_e.onabort=function(){_e&&(i(new qt("Request aborted",qt.ECONNABORTED,e,_e)),_e=null)},_e.onerror=function(){i(new qt("Network Error",qt.ERR_NETWORK,e,_e)),_e=null},_e.ontimeout=function(){let mN=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",EN=e.transitional||gw;e.timeoutErrorMessage&&(mN=e.timeoutErrorMessage),i(new qt(mN,EN.clarifyTimeoutError?qt.ETIMEDOUT:qt.ECONNABORTED,e,_e)),_e=null},sr.hasStandardBrowserEnv&&(A&&K.isFunction(A)&&(A=A(e)),A||A!==!1&&dB(cN))){let mN=e.xsrfHeaderName&&e.xsrfCookieName&&cB.read(e.xsrfCookieName);mN&&h.set(e.xsrfHeaderName,mN)}o===void 0&&h.setContentType(null),"setRequestHeader"in _e&&K.forEach(h.toJSON(),function(mN,EN){_e.setRequestHeader(EN,mN)}),K.isUndefined(e.withCredentials)||(_e.withCredentials=!!e.withCredentials),C&&C!=="json"&&(_e.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&_e.addEventListener("progress",nR(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&_e.upload&&_e.upload.addEventListener("progress",nR(e.onUploadProgress)),(e.cancelToken||e.signal)&&(p=mN=>{_e&&(i(!mN||mN.type?new od(null,e,_e):mN),_e.abort(),_e=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p)));let fN=function(mN){let EN=/^([-+\w]{1,25})(:?\/\/|:)/.exec(mN);return EN&&EN[1]||""}(cN);fN&&sr.protocols.indexOf(fN)===-1?i(new qt("Unsupported protocol "+fN+":",qt.ERR_BAD_REQUEST,e)):_e.send(o||null)})},vE={http:null,xhr:lB};K.forEach(vE,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});var iR=e=>"- ".concat(e),uB=e=>K.isFunction(e)||e===null||e===!1,hO={getAdapter:e=>{e=K.isArray(e)?e:[e];let{length:r}=e,i,o,h={};for(let p=0;p<r;p++){let g;if(i=e[p],o=i,!uB(i)&&(o=vE[(g=String(i)).toLowerCase()],o===void 0))throw new qt("Unknown adapter '".concat(g,"'"));if(o)break;h[g||"#"+p]=o}if(!o){let p=Object.entries(h).map(g=>{let[C,A]=g;return"adapter ".concat(C," ")+(A===!1?"is not supported by the environment":"is not available in the build")});throw new qt("There is no suitable adapter to dispatch the request "+(r?p.length>1?`since :
`+p.map(iR).join(`
`):" "+iR(p[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:vE};function yp(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new od(null,e)}function rR(e){return yp(e),e.headers=Dr.from(e.headers),e.data=vp.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),hO.getAdapter(e.adapter||cf.adapter)(e).then(function(r){return yp(e),r.data=vp.call(e,e.transformResponse,r),r.headers=Dr.from(r.headers),r},function(r){return lO(r)||(yp(e),r&&r.response&&(r.response.data=vp.call(e,e.transformResponse,r.response),r.response.headers=Dr.from(r.response.headers))),j.reject(r)})}function oR(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}var sR=e=>e instanceof Dr?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?oR(Object(o),!0).forEach(function(h){T(r,h,o[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):oR(Object(o)).forEach(function(h){Object.defineProperty(r,h,Object.getOwnPropertyDescriptor(o,h))})}return r}({},e):e;function Qs(e,r){r=r||{};let i={};function o(x,_e,cN){return K.isPlainObject(x)&&K.isPlainObject(_e)?K.merge.call({caseless:cN},x,_e):K.isPlainObject(_e)?K.merge({},_e):K.isArray(_e)?_e.slice():_e}function h(x,_e,cN){return K.isUndefined(_e)?K.isUndefined(x)?void 0:o(void 0,x,cN):o(x,_e,cN)}function p(x,_e){if(!K.isUndefined(_e))return o(void 0,_e)}function g(x,_e){return K.isUndefined(_e)?K.isUndefined(x)?void 0:o(void 0,x):o(void 0,_e)}function C(x,_e,cN){return cN in r?o(x,_e):cN in e?o(void 0,x):void 0}let A={url:p,method:p,data:p,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:C,headers:(x,_e)=>h(sR(x),sR(_e),!0)};return K.forEach(Object.keys(Object.assign({},e,r)),function(x){let _e=A[x]||h,cN=_e(e[x],r[x],x);K.isUndefined(cN)&&_e!==C||(i[x]=cN)}),i}var pO="1.6.8",df={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{df[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});var aR={};df.transitional=function(e,r,i){function o(h,p){return"[Axios v"+pO+"] Transitional option '"+h+"'"+p+(i?". "+i:"")}return(h,p,g)=>{if(e===!1)throw new qt(o(p," has been removed"+(r?" in "+r:"")),qt.ERR_DEPRECATED);return r&&!aR[p]&&(aR[p]=!0,console.warn(o(p," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(h,p,g)}};var yE={assertOptions:function(e,r,i){if(typeof e!="object")throw new qt("options must be an object",qt.ERR_BAD_OPTION_VALUE);let o=Object.keys(e),h=o.length;for(;h-- >0;){let p=o[h],g=r[p];if(g){let C=e[p],A=C===void 0||g(C,p,e);if(A!==!0)throw new qt("option "+p+" must be "+A,qt.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new qt("Unknown option "+p,qt.ERR_BAD_OPTION)}},validators:df},Fr=yE.validators,ml=class{constructor(e){this.defaults=e,this.interceptors={request:new ZT,response:new ZT}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o;Error.captureStackTrace?Error.captureStackTrace(o={}):o=new Error;let h=o.stack?o.stack.replace(/^.+\n/,""):"";i.stack?h&&!String(i.stack).endsWith(h.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+h):i.stack=h}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=Qs(this.defaults,r);let{transitional:i,paramsSerializer:o,headers:h}=r;i!==void 0&&yE.assertOptions(i,{silentJSONParsing:Fr.transitional(Fr.boolean),forcedJSONParsing:Fr.transitional(Fr.boolean),clarifyTimeoutError:Fr.transitional(Fr.boolean)},!1),o!=null&&(K.isFunction(o)?r.paramsSerializer={serialize:o}:yE.assertOptions(o,{encode:Fr.function,serialize:Fr.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let p=h&&K.merge(h.common,h[r.method]);h&&K.forEach(["delete","get","head","post","put","patch","common"],fN=>{delete h[fN]}),r.headers=Dr.concat(p,h);let g=[],C=!0;this.interceptors.request.forEach(function(fN){typeof fN.runWhen=="function"&&fN.runWhen(r)===!1||(C=C&&fN.synchronous,g.unshift(fN.fulfilled,fN.rejected))});let A=[],x;this.interceptors.response.forEach(function(fN){A.push(fN.fulfilled,fN.rejected)});let _e,cN=0;if(!C){let fN=[rR.bind(this),void 0];for(fN.unshift.apply(fN,g),fN.push.apply(fN,A),_e=fN.length,x=j.resolve(r);cN<_e;)x=x.then(fN[cN++],fN[cN++]);return x}_e=g.length;let dN=r;for(cN=0;cN<_e;){let fN=g[cN++],mN=g[cN++];try{dN=fN(dN)}catch(EN){mN.call(this,EN);break}}try{x=rR.call(this,dN)}catch(fN){return j.reject(fN)}for(cN=0,_e=A.length;cN<_e;)x=x.then(A[cN++],A[cN++]);return x}getUri(e){return fw(uO((e=Qs(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};K.forEach(["delete","get","head","options"],function(e){ml.prototype[e]=function(r,i){return this.request(Qs(i||{},{method:e,url:r,data:(i||{}).data}))}}),K.forEach(["post","put","patch"],function(e){function r(i){return function(o,h,p){return this.request(Qs(p||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:h}))}}ml.prototype[e]=r(),ml.prototype[e+"Form"]=r(!0)});var fl=ml,AE=class Eve{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new j(function(h){i=h});let o=this;this.promise.then(h=>{if(!o._listeners)return;let p=o._listeners.length;for(;p-- >0;)o._listeners[p](h);o._listeners=null}),this.promise.then=h=>{let p,g=new j(C=>{o.subscribe(C),p=C}).then(h);return g.cancel=function(){o.unsubscribe(p)},g},r(function(h,p,g){o.reason||(o.reason=new od(h,p,g),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;let i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}static source(){let r;return{token:new Eve(function(i){r=i}),cancel:r}}},hB=AE,bE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(bE).forEach(e=>{let[r,i]=e;bE[i]=r});var pB=bE,Xe=function e(r){let i=new fl(r),o=_w(fl.prototype.request,i);return K.extend(o,fl.prototype,i,{allOwnKeys:!0}),K.extend(o,i,null,{allOwnKeys:!0}),o.create=function(h){return e(Qs(r,h))},o}(cf);Xe.Axios=fl,Xe.CanceledError=od,Xe.CancelToken=hB,Xe.isCancel=lO,Xe.VERSION=pO,Xe.toFormData=Ul,Xe.AxiosError=qt,Xe.Cancel=Xe.CanceledError,Xe.all=function(e){return j.all(e)},Xe.spread=function(e){return function(r){return e.apply(null,r)}},Xe.isAxiosError=function(e){return K.isObject(e)&&e.isAxiosError===!0},Xe.mergeConfig=Qs,Xe.AxiosHeaders=Dr,Xe.formToJSON=e=>dO(K.isHTMLForm(e)?new FormData(e):e),Xe.getAdapter=hO.getAdapter,Xe.HttpStatusCode=pB,Xe.default=Xe;var mn=Xe,_B=()=>{};function vc(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:_B};return e.promise=new j((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}var bd=new Map,wd=new Map,Yi=new Map,ye=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),It=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),wE=new W2,Vi=wE.getResult(),Ap=null;function mt(e){if(!Ap){Vi=wE.getResult();let r=function(C){if(C.engine.name==="Blink"&&C.browser.name!=="WeChat")return It.CHROME;switch(C.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return It.CHROME;case"Safari":case"Mobile Safari":return It.SAFARI;case"Edge":return It.EDGE;case"Firefox":return It.FIREFOX;case"QQ":case"QQBrowser":return It.QQ;case"Opera":return It.OPERA;case"WeChat":return It.WECHAT;default:return C.browser.name||""}}(Vi),i=cR(Vi),o=function(C){return C.os.name==="Windows"?C.os.version?C.os.name+" "+C.os.version:C.os.name:C.os.name||""}(Vi),h=Vi.os.version,p=cR(Vi,!1),g=Vi.device.type;if(!(r&&i&&o&&h))return{name:r,version:i,os:o,osVersion:h,browserVersion:p,deviceType:g};Ap={name:r,version:i,os:o,osVersion:h,browserVersion:p,deviceType:g}}return Ap}function cR(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function Hu(){return mt().os}function dR(){let e=mt();return"".concat(e.os," ").concat(e.osVersion)}function Gl(){let e=mt();return!!(Vi.engine.name==="WebKit"&&e.os===ye.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==It.SAFARI||ln()&&e.name!==It.SAFARI)}function oo(){return mt().name===It.CHROME}function je(){return mt().name===It.SAFARI}function _O(){return mt().name===It.EDGE}function $t(){return mt().name===It.FIREFOX}function ln(){return mt().os===ye.IOS}function OE(e){let r=mt();return!(r.name!==It.CHROME||!r.osVersion)&&Number(r.version)>=e}function EO(e){let r=mt();return!(r.name!==It.CHROME||!r.osVersion)&&Number(r.version)<e}function lR(e){let r=mt();return!(r.name!==It.EDGE||!r.osVersion)&&Number(r.version)>=e}function mO(e){let r=mt();return!(r.name!==It.SAFARI||!r.osVersion)&&Number(r.version)>=e}function fO(e,r,i){let o=mt();if(o.os!==ye.IOS||!o.osVersion)return!1;let h=o.osVersion.split(".");return r&&Number(h[0])===e&&Number(h[1])<r||Number(h[0])<e}function gO(e,r,i){let o=mt();if(o.name!==It.SAFARI||!o.osVersion||!o.browserVersion)return!1;let h=o.browserVersion.split(".");return r&&Number(h[0])===e&&Number(h[1])<r||Number(h[0])<e}function uR(e){let r=mt();return!(r.name!==It.OPERA||!r.osVersion)&&Number(r.version)>=e}function hR(){let e=mt();if(e.os!==ye.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Zs(){let e=mt();if(e.os!==ye.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])===15}function NE(){let e=mt();if(e.os!==ye.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])===16}function pR(){let e=mt();if(e.os!==ye.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function vi(){return je()&&navigator.maxTouchPoints>0}function TO(){return mt().name===It.WECHAT}function SO(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function lf(){let e=Hu();return function(){let{deviceType:r}=mt();return r==="mobile"||r==="tablet"}()||e===ye.ANDROID||e===ye.IOS||e===ye.HARMONY_OS}function ho(){let e=mt();return e.name!==It.EDGE&&e.name!==It.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ku(){return Hu()===ye.ANDROID}function yc(){let e=mt();return Ku()&&(e.name===It.CHROME||e.name===It.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function jt(e,r,i){return(r=function(o){var h=function(p,g){if(typeof p!="object"||!p)return p;var C=p[Symbol.toPrimitive];if(C!==void 0){var A=C.call(p,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(p)}(o);return typeof h=="symbol"?h:h+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function _R(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function J(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?_R(Object(i),!0).forEach(function(o){jt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_R(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var R=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),N=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),jt(this,"code",void 0),jt(this,"message",void 0),jt(this,"data",void 0),jt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Nr(e,r){if(typeof e!="boolean")throw new N(R.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Ce(e,r,i){if(!W(i).call(i,e))throw new N(R.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function Nt(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(h){return typeof h=="number"&&h%1==0}(e))throw new N(R.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function bp(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new N(R.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&Nt(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&Nt(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&Nt(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&Nt(e.ideal,"".concat(r,".ideal"),1,1/0)}else Nt(e,r,1,1/0)}function Pe(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,h=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new N(R.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!RO(e,i,o,h))throw new N(R.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(h?" ASCII characters only.":""))}function br(e,r){if(!Array.isArray(e))throw new N(R.INVALID_PARAMS,"".concat(r," should be an array"))}function zt(e){return e==null}function RO(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(h){if(typeof h!="string")return!1;for(let p=0;p<h.length;p+=1){let g=h.charCodeAt(p);if(g<0||g>255)return!1}return!0}(e))}var Ka=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Ka||{}),DE=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(DE||{}),CO=new class{constructor(){jt(this,"_clientSize",null),jt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),jt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),jt(this,"getStyle",e=>window.getComputedStyle(e,null)),jt(this,"checkCssVisibleProperty",e=>{var r;let i=!0,o=this.getStyle(e),{display:h,visibility:p,opacity:g,filter:C}=o;return(h==="none"||W(r=["hidden","collapse"]).call(r,p)||Number(g)<.1)&&(i=!1),!!i&&(C&&C.split(" ").filter(A=>{var x;let _e=A.split("(")[0];return W(x=["brightness","blur","opacity"]).call(x,_e)}).map(A=>{let[x,_e]=A.split(/\(|\)/);return[x,Number(_e.match(/^[0-9\.]+/))]}).forEach(A=>{let[x,_e]=A;switch(x){case"brightness":(_e<.1||_e>3)&&(i=!1);break;case"blur":_e>3&&(i=!1);break;case"opacity":_e<.1&&(i=!1)}}),i)}),jt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0,h=g=>r(g),p=e;for(;p&&o;)h(p)||(i=!1,o=!1),p=p.parentElement,p||(o=!1);return i}),jt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),jt(this,"getSizeAboutClient",e=>{let{width:r,height:i,left:o,right:h,top:p,bottom:g}=e.getBoundingClientRect(),C=this.getClientWidth(),A=this.getClientHeight();return{width:r,height:i,left:o,right:h,top:p,bottom:g,clientWidth:C,clientHeight:A,clientMin:Math.min(C,A)}}),jt(this,"checkActualSize",()=>{let{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),jt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),jt(this,"checkCoverForAPoint",(e,r,i)=>{let o=this.elementFromPoint(e,r);return o!==null&&o!==i}),jt(this,"getPointPositionList",()=>{let{width:e,height:r,left:i,top:o}=this._clientSize,h=e/6,p=r/6,g=[],C=10**6;for(let A=0;A<5;A++)for(let x=0;x<5;x++){let _e=(i*C+(A===0?.1:A===4?(h*A*C-1e5)/C:h*A)*C)/C,cN=(o*C+(x===0?.1:x===4?(p*x*C-1e5)/C:p*x)*C)/C;g.push({x:_e,y:cN})}return[...g]}),jt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),jt(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),jt(this,"checkSizeOfPartInClient",()=>{let{left:e,right:r,top:i,bottom:o,clientHeight:h,clientWidth:p,clientMin:g}=this._clientSize,C,A,x,_e;if(e<0)C=0;else{if(!(e<p))return!1;C=e}if(r<0)return!1;if(A=r<p?r:p,i<0)x=0;else{if(!(i<h))return!1;x=i}if(o<0)return!1;_e=o<h?o:h;let cN=A-C,dN=_e-x;return this.checkSizeIsVisible(cN,dN,g)}),jt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),jt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Ka.COVERED);{let r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(Ka.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ka.SIZE)}}return this.returnHiddenResult(Ka.STYLE)}return this.returnHiddenResult(DE.UNMOUNTED)}return this.returnHiddenResult(DE.INVALID_HTML_ELEMENT)}),jt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function uf(e){return new TextEncoder().encode(e)}var ER=function(e,r){let i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},PE=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(h=>{o+=h.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",uf(e)),16),Xt=class{constructor(){jt(this,"_events",{}),jt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;let i=this._events[e],o=this._indexOfListener(i,r);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let r=this._events[e].map(p=>p);for(var i=arguments.length,o=new Array(i>1?i-1:0),h=1;h<i;h++)o[h-1]=arguments[h];for(let p=0;p<r.length;p+=1){let g=r[p];g.once&&this.off(e,g.listener),g.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(h=>{h.once&&this.off(e,h.listener);try{h.listener.apply(this,i)}catch(p){console.error("safeEmit event:".concat(e," error ").concat(p==null?void 0:p.toString()))}})}_indexOfListener(e,r){let i=e.length;for(;i--;)if(e[i].listener===r)return i;return-1}},Pa=null;function IO(){if(Pa)return Pa;if(window.electron)return Pa=window.electron;if(!window.require)return null;try{return Pa=window.require("electron"),Pa}catch{return null}}var Te=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Zt=function(e){return e.TRACER="tracer",e}({});function mR(e){return Nt(e.timeout,"config.timeout",0,1e5),Nt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Nt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Nt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var EB=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),At=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Yu(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function vO(e){return Pe(e.turnServerURL,"turnServerURL"),Pe(e.username,"username"),Pe(e.password,"password"),e.udpport&&Nt(e.udpport,"udpport",1,99999,!0),e.forceturn&&Nr(e.forceturn,"forceturn"),e.security&&Nr(e.security,"security"),e.tcpport&&Nt(e.tcpport,"tcpport",1,99999,!0),!0}function fR(e){return e.level!==void 0&&Ce(e.level,"level",[1,2,3]),e.delay!==void 0&&Nt(e.delay,"delay",0,3e3,!0),!0}var ut=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Be=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),wn=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),ks=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Ge(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),h=2;h<i;h++)o[h-2]=arguments[h];return e.getListeners(r).length===0?j.reject(new N(R.UNEXPECTED_ERROR,"can not emit promise")):new j((p,g)=>{e.emit(r,...o,p,g)})}function kt(e,r){if(e.getListeners(r).length===0)return j.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),h=2;h<i;h++)o[h-2]=arguments[h];return Ge(e,r,...o)}function ni(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),h=2;h<i;h++)o[h-2]=arguments[h];return Ac(e,r,...o)}function Ac(e,r){let i=null,o=null;for(var h=arguments.length,p=new Array(h>2?h-2:0),g=2;g<h;g++)p[g-2]=arguments[g];if(e.emit(r,...p,C=>{i=C},C=>{o=C}),o!==null)throw o;if(i===null)throw new N(R.UNEXPECTED_ERROR,"handler is not sync");return i}var he=new class extends Xt{set networkState(e){this.emit(ks.NETWORK_STATE_CHANGE,e,this._networkState),e===wn.ONLINE?this.emit(ks.ONLINE):e===wn.OFFLINE&&(this.onlineWaiter=new j(r=>{this.once(ks.ONLINE,()=>{this.onlineWaiter=void 0,r(wn.ONLINE)})}),this.emit(ks.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===wn.ONLINE}constructor(){super(),jt(this,"_moduleName","network-indicator"),jt(this,"_networkState",wn.ONLINE),jt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=wn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=wn.OFFLINE})}};function Wl(e,r){let i=e.indexOf(r);i!==-1&&e.splice(i,1)}function Ls(e){let r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function qu(e){j!==void 0?j.resolve().then(e):setTimeout(e,0)}function le(e){return JSON.parse(JSON.stringify(e))}function Vo(e){try{return le(e)}catch{return e}}var gR={};function po(e,r){gR[r]||(gR[r]=!0,e())}function Fo(e){let r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function so(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function yO(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){let o=new Uint8Array(r);o.set(i),i=o}return i}function TR(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=ji(r).call(r,(g,C)=>g+C.length,0),h=new Uint8Array(new ArrayBuffer(o)),p=0;return r.forEach(g=>{h.set(g,p),p+=g.length}),h}function ar(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function AO(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?ar(i):i.size}),r+138}function mB(e){let r=new N(R.TIMEOUT,"timeout");return new j((i,o)=>{window.setTimeout(()=>o(r),e)})}function Me(e){return new j(r=>{window.setTimeout(r,e)})}function Ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+Ut(e-i.length,"")}function Ms(){return Ut(32,"").toUpperCase()}var zu=()=>{},SR=new class{constructor(){jt(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var h=arguments.length,p=new Array(h>4?h-4:0),g=4;g<h;g++)p[g-4]=arguments[g];if(this.fnMap.has(r)){let C=this.fnMap.get(r);if(C.threshold!==i){C.fn(...C.args),clearTimeout(C.timer);let A=window.setTimeout(()=>{let x=this.fnMap.get(r);x&&x.fn(...x.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:A,args:p,skipFn:o})}else C.skipFn&&C.skipFn(...C.args),this.fnMap.set(r,J(J({},C),{},{fn:e,args:p,skipFn:o}))}else{let C=window.setTimeout(()=>{let A=this.fnMap.get(r);A&&A.fn(...A.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:C,args:p,skipFn:o})}}},RR=SR.throttleByKey.bind(SR);function CR(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function kE(e,r){if(!CR(e)||!CR(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){let i=[...e];for(let o=0;o<r.length;o++)i[o]=kE(e[o],r[o]);return i}{let i=J({},e);for(let o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=kE(e[o],r[o]):i[o]=r[o]);return i}}function IR(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==r););return i}function wp(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function bO(e){let r="0123456789abcdef";function i(aH){let pH,SH="";for(pH=0;pH<=3;pH++)SH+=r.charAt(aH>>8*pH+4&15)+r.charAt(aH>>8*pH&15);return SH}function o(aH,pH){let SH=(65535&aH)+(65535&pH);return(aH>>16)+(pH>>16)+(SH>>16)<<16|65535&SH}function h(aH,pH,SH,vH,AH,UH){return o(function(zH,CH){return zH<<CH|zH>>>32-CH}(o(o(pH,aH),o(vH,UH)),AH),SH)}function p(aH,pH,SH,vH,AH,UH,zH){return h(pH&SH|~pH&vH,aH,pH,AH,UH,zH)}function g(aH,pH,SH,vH,AH,UH,zH){return h(pH&vH|SH&~vH,aH,pH,AH,UH,zH)}function C(aH,pH,SH,vH,AH,UH,zH){return h(pH^SH^vH,aH,pH,AH,UH,zH)}function A(aH,pH,SH,vH,AH,UH,zH){return h(SH^(pH|~vH),aH,pH,AH,UH,zH)}let x=function(aH){let pH,SH=1+(aH.length+8>>6),vH=new Array(16*SH);for(pH=0;pH<16*SH;pH++)vH[pH]=0;for(pH=0;pH<aH.length;pH++)vH[pH>>2]|=aH.charCodeAt(pH)<<pH%4*8;return vH[pH>>2]|=128<<pH%4*8,vH[16*SH-2]=8*aH.length,vH}(e),_e,cN,dN,fN,mN,EN=1732584193,RN=-271733879,IN=-1732584194,t0=271733878;for(_e=0;_e<x.length;_e+=16)cN=EN,dN=RN,fN=IN,mN=t0,EN=p(EN,RN,IN,t0,x[_e+0],7,-680876936),t0=p(t0,EN,RN,IN,x[_e+1],12,-389564586),IN=p(IN,t0,EN,RN,x[_e+2],17,606105819),RN=p(RN,IN,t0,EN,x[_e+3],22,-1044525330),EN=p(EN,RN,IN,t0,x[_e+4],7,-176418897),t0=p(t0,EN,RN,IN,x[_e+5],12,1200080426),IN=p(IN,t0,EN,RN,x[_e+6],17,-1473231341),RN=p(RN,IN,t0,EN,x[_e+7],22,-45705983),EN=p(EN,RN,IN,t0,x[_e+8],7,1770035416),t0=p(t0,EN,RN,IN,x[_e+9],12,-1958414417),IN=p(IN,t0,EN,RN,x[_e+10],17,-42063),RN=p(RN,IN,t0,EN,x[_e+11],22,-1990404162),EN=p(EN,RN,IN,t0,x[_e+12],7,1804603682),t0=p(t0,EN,RN,IN,x[_e+13],12,-40341101),IN=p(IN,t0,EN,RN,x[_e+14],17,-1502002290),RN=p(RN,IN,t0,EN,x[_e+15],22,1236535329),EN=g(EN,RN,IN,t0,x[_e+1],5,-165796510),t0=g(t0,EN,RN,IN,x[_e+6],9,-1069501632),IN=g(IN,t0,EN,RN,x[_e+11],14,643717713),RN=g(RN,IN,t0,EN,x[_e+0],20,-373897302),EN=g(EN,RN,IN,t0,x[_e+5],5,-701558691),t0=g(t0,EN,RN,IN,x[_e+10],9,38016083),IN=g(IN,t0,EN,RN,x[_e+15],14,-660478335),RN=g(RN,IN,t0,EN,x[_e+4],20,-405537848),EN=g(EN,RN,IN,t0,x[_e+9],5,568446438),t0=g(t0,EN,RN,IN,x[_e+14],9,-1019803690),IN=g(IN,t0,EN,RN,x[_e+3],14,-187363961),RN=g(RN,IN,t0,EN,x[_e+8],20,1163531501),EN=g(EN,RN,IN,t0,x[_e+13],5,-1444681467),t0=g(t0,EN,RN,IN,x[_e+2],9,-51403784),IN=g(IN,t0,EN,RN,x[_e+7],14,1735328473),RN=g(RN,IN,t0,EN,x[_e+12],20,-1926607734),EN=C(EN,RN,IN,t0,x[_e+5],4,-378558),t0=C(t0,EN,RN,IN,x[_e+8],11,-2022574463),IN=C(IN,t0,EN,RN,x[_e+11],16,1839030562),RN=C(RN,IN,t0,EN,x[_e+14],23,-35309556),EN=C(EN,RN,IN,t0,x[_e+1],4,-1530992060),t0=C(t0,EN,RN,IN,x[_e+4],11,1272893353),IN=C(IN,t0,EN,RN,x[_e+7],16,-155497632),RN=C(RN,IN,t0,EN,x[_e+10],23,-1094730640),EN=C(EN,RN,IN,t0,x[_e+13],4,681279174),t0=C(t0,EN,RN,IN,x[_e+0],11,-358537222),IN=C(IN,t0,EN,RN,x[_e+3],16,-722521979),RN=C(RN,IN,t0,EN,x[_e+6],23,76029189),EN=C(EN,RN,IN,t0,x[_e+9],4,-640364487),t0=C(t0,EN,RN,IN,x[_e+12],11,-421815835),IN=C(IN,t0,EN,RN,x[_e+15],16,530742520),RN=C(RN,IN,t0,EN,x[_e+2],23,-995338651),EN=A(EN,RN,IN,t0,x[_e+0],6,-198630844),t0=A(t0,EN,RN,IN,x[_e+7],10,1126891415),IN=A(IN,t0,EN,RN,x[_e+14],15,-1416354905),RN=A(RN,IN,t0,EN,x[_e+5],21,-57434055),EN=A(EN,RN,IN,t0,x[_e+12],6,1700485571),t0=A(t0,EN,RN,IN,x[_e+3],10,-1894986606),IN=A(IN,t0,EN,RN,x[_e+10],15,-1051523),RN=A(RN,IN,t0,EN,x[_e+1],21,-2054922799),EN=A(EN,RN,IN,t0,x[_e+8],6,1873313359),t0=A(t0,EN,RN,IN,x[_e+15],10,-30611744),IN=A(IN,t0,EN,RN,x[_e+6],15,-1560198380),RN=A(RN,IN,t0,EN,x[_e+13],21,1309151649),EN=A(EN,RN,IN,t0,x[_e+4],6,-145523070),t0=A(t0,EN,RN,IN,x[_e+11],10,-1120210379),IN=A(IN,t0,EN,RN,x[_e+2],15,718787259),RN=A(RN,IN,t0,EN,x[_e+9],21,-343485551),EN=o(EN,cN),RN=o(RN,dN),IN=o(IN,fN),t0=o(t0,mN);return i(EN)+i(RN)+i(IN)+i(t0)}var fB=1,Od=console,ze=class{static setLogger(e){Od=e}constructor(e){jt(this,"lockingPromise",j.resolve()),jt(this,"locks",0),jt(this,"name",""),jt(this,"lockId",void 0),this.lockId=fB++,e&&(this.name=e),Od.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,Od.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let i=new j(h=>{r=()=>{this.locks-=1,Od.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),h()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function $s(e,r){return function(i,o,h){let p=h.value;if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return h.value=async function(){let g=this[r];if(!g)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));let C=await g.lock("From ".concat(e,".").concat(o));try{for(var A=arguments.length,x=new Array(A),_e=0;_e<A;_e++)x[_e]=arguments[_e];return await p.apply(this,x)}finally{C()}},h}}var Ee={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function hf(e,r){let i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function Wi(e,r,i,o){let h=Object.assign({},Ee,o),p=h.timeout,g=async()=>{await function(x){return new j(_e=>{window.setTimeout(_e,x)})}(p),p*=h.timeoutFactor,p=Math.min(h.maxRetryTimeout,p)},C=!1,A=new j(async(x,_e)=>{r=r||(()=>!1),i=i||(()=>!0);for(let cN=0;cN<h.maxRetryCount;cN+=1){if(C)return _e(new N(R.OPERATION_ABORTED));try{let dN=await e();if(!r(dN,cN)||cN+1===h.maxRetryCount)return x(dN);await g()}catch(dN){if(!i(dN,cN)||cN+1===h.maxRetryCount)return _e(dN);await g()}}});return A.cancel=()=>C=!0,A}var Hl=class{constructor(e){jt(this,"input",[]),jt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ji(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},Nd,Dd=0,Op=0;function LE(e,r,i,o){return new j((h,p)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),Dd+=ar(r.data)):i&&(r.data.size?Dd+=r.data.size:r.data instanceof FormData?Dd+=AO(r.data):Dd+=ar(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,mn.request(r).then(g=>{typeof g.data=="string"?Op+=ar(g.data):g.data instanceof ArrayBuffer||g.data instanceof Uint8Array?Op+=g.data.byteLength:Op+=ar(JSON.stringify(g.data)),h(g.data)}).catch(g=>{mn.isCancel(g)?p(new N(R.OPERATION_ABORTED,"cancel token canceled")):g.code==="ECONNABORTED"?p(new N(R.NETWORK_TIMEOUT,g.message)):g.response?p(new N(R.NETWORK_RESPONSE_ERROR,g.response.status)):p(new N(R.NETWORK_ERROR,g.message))})})}async function gB(e,r){let i=new Blob([r.data],{type:"buffer"});return await LE(e,J(J({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}var vR=()=>window.isSecureContext!==void 0,ii=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(r&&r[1]&&r[2]){let o=r[1],h=r[2];return"".concat(o,".").concat(h)}let i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){let o=i[1],h=i[2];return"".concat(o,".").concat(100*(Number(h)+1))}return"4.0.0.999"}("4.22.0"),pf=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),Oo=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),_f={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Ef="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",oe=J(J({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:_f,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function Ot(e,r,i){var o,h,p;W(o=Object.keys(oe)).call(o,e)&&(!i&&W(h=Object.keys($r)).call(h,e)||(oe[e]=r,e==="ENABLE_VIDEO_SEI"&&r===!0&&(oe.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&r&&(p=!!r,oe.USE_NEW_NETWORK_CONFIG=p,p&&(oe.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],oe.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],oe.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],oe.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],oe.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",oe.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",oe.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(oe.ENABLE_INSTANT_VIDEO=!0,oe.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(oe.ENABLE_AUT_CC=!0)))}function v(e){return oe[e]}var $r={},ct=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ct||{}),ME=class{constructor(e,r,i,o){jt(this,"state",void 0),this.state={codec:e,audioCodec:r,mode:i,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Oo.Default}}dispatch(e){this.state=function(r,i){switch(i.type){case ct.SET_SESSION_ID:return J(J({},r),{},{sessionId:i.sessionId});case ct.SET_P2P_ID:return J(J({},r),{},{p2pId:i.p2pId});case ct.SET_UID:return J(J({},r),{},{uid:i.uid});case ct.SET_INT_UID:return J(J({},r),{},{intUid:i.intUid});case ct.SET_PUB_ID:return J(J({},r),{},{pubId:i.pubId});case ct.KEY_METRIC_CLIENT_CREATED:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{clientCreated:i.metric})});case ct.KEY_METRIC_JOIN_START:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{joinStart:i.metric})});case ct.AVOID_JOIN_START:return J(J({},r),{},{avoidJoinStart:i.avoidJoinStart});case ct.KEY_METRIC_JOIN_END:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{joinEnd:i.metric})});case ct.KEY_METRIC_REQUEST_AP_START:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{requestAPStart:i.metric})});case ct.KEY_METRIC_REQUEST_AP_END:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{requestAPEnd:i.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_START:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{joinGatewayStart:i.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_END:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{joinGatewayEnd:i.metric})});case ct.KEY_METRIC_PEER_CONNECTION_START:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{peerConnectionStart:i.metric})});case ct.KEY_METRIC_PEER_CONNECTION_END:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{peerConnectionEnd:i.metric})});case ct.KEY_METRIC_DESCRIPTION_START:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{descriptionStart:i.metric})});case ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{signalChannelOpen:i.metric})});case ct.KEY_METRIC_ICE_CONNECTION_END:return J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{iceConnectionEnd:i.metric})});case ct.KEY_METRIC_PUBLISH:{let o=r.keyMetrics.publish,h=o.findIndex(p=>p.trackId===i.metric.trackId);return h!==-1?(o[h]=J(J({},o[h]),i.metric),J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{publish:[...o]})})):J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,i.metric]})})}case ct.KEY_METRIC_SUBSCRIBE:{let o=r.keyMetrics.subscribe,h=o.findIndex(p=>p.userId===i.metric.userId&&p.type===i.metric.type);return h!==-1?(o[h]=J(J({},o[h]),i.metric),J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{subscribe:[...o]})})):J(J({},r),{},{keyMetrics:J(J({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,i.metric]})})}case ct.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=i.mode,r;case ct.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,i.record]:(r.joinChannelServiceRecords[i.index]=J(J({},r.joinChannelServiceRecords[i.index]),i.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case ct.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case ct.SET_USE_P2P:return J(J({},r),{},{useP2P:i.val});case ct.SET_TRANSPORT_TYPE:return J(J({},r),{},{p2pTransport:i.val});default:return r}}(this.state,e)}set sessionId(e){this.dispatch({type:ct.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:ct.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:ct.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:ct.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:ct.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:ct.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:ct.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:ct.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:ct.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ct.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ct.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,r,i,o){this.dispatch({type:ct.KEY_METRIC_PUBLISH,metric:J(J({trackId:e,type:r},i&&{publishStart:i}),o&&{publishEnd:o})})}subscribe(e,r,i,o,h,p,g){this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:J(J(J(J(J({userId:e,type:r},i&&{subscribeStart:i}),o&&{subscribeEnd:o}),h&&{firstFrame:h}),p&&{streamAdded:p}),g&&{firstDecoded:g})})}massSubscribe(e,r,i,o){e.forEach(h=>{this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:J(J(J({userId:h.userId,type:h.type},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,r){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof r!="number"?(this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:J(J({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ct.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:ct.AVOID_JOIN_START,avoidJoinStart:e})}},Ju=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});var yR=128,TB=96,AR=1e3,us=10,SB=0;function re(e,r,i){return(r=function(o){var h=function(p,g){if(typeof p!="object"||!p)return p;var C=p[Symbol.toPrimitive];if(C!==void 0){var A=C.call(p,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(p)}(o);return typeof h=="symbol"?h:h+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function bR(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function ot(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?bR(Object(i),!0).forEach(function(o){re(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bR(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var wO=new class extends Xt{constructor(){super(...arguments),re(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}},UE=class{constructor(e){re(this,"logger",void 0),re(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];this.logger.debug(...this.prefixLists,...r)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];this.logger.info(...this.prefixLists,...r)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];this.logger.warning(...this.prefixLists,...r)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];this.logger.error(...this.prefixLists,...r)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}};function Np(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function wR(){let e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var Qn={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Pd=Date.now(),ka=e=>{for(let r in Qn)if(Object.prototype.hasOwnProperty.call(Qn,r)&&Qn[r]===e)return r;return"DEFAULT"},_=new class{constructor(){re(this,"proxyServerURL",void 0),re(this,"logLevel",Qn.DEBUG),re(this,"uploadState","collecting"),re(this,"uploadLogWaitingList",[]),re(this,"uploadLogUploadingList",[]),re(this,"uploadErrorCount",0),re(this,"currentLogID",0),re(this,"url",void 0),re(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[Qn.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[Qn.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[Qn.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[Qn.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[Qn.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Ot("UPLOAD_LOG",!0)}disableLogUpload(){Ot("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new UE(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-Pd<100)return void setTimeout(()=>{this.log(...r)},Date.now()-Pd);let o=Math.max(0,Math.min(4,r[0]));if(r[0]=Np()+" Agora-SDK [".concat(ka(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;let h=Np()+" %cAgora-SDK [".concat(ka(o),"]:"),p=[];if(!v("USE_NEW_LOG"))switch(o){case Qn.DEBUG:p=[h,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,p);break;case Qn.INFO:p=[h,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,p);break;case Qn.WARNING:p=[h,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,p);break;case Qn.ERROR:p=[h,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,p)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-Pd<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-Pd);let o=Math.max(0,Math.min(4,r[0]));r[0]=Np()+" Agora-SDK [".concat(ka(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!v("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=wR()+" Agora-SDK [".concat(ka(e),"]:"):i[0]=wR()+" Agora-SDK [".concat(ka(e),"]:");let h="";i.forEach(p=>{typeof p=="object"&&(p=JSON.stringify(p)),h+="".concat(p," ")}),this.uploadLogWaitingList.push({payload_str:h,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,r={sdk_version:ii,process_id:v("PROCESS_ID"),payload:JSON.stringify(e)};return Wi(async()=>{let i=await mn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(v("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(v("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){let o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{let o={status:-1,message:i.message,errorRange:e.map(h=>h.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),wO.reportLogUploadError(o),!0},{timeout:v("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:v("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,v("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),v("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),v("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),v("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},OR;function RB(e){return Pe(e.reportId,"params.reportId",0,100,!1),Pe(e.category,"params.category",0,100,!1),Pe(e.event,"params.event",0,100,!1),Pe(e.label,"params.label",0,100,!1),Nt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(OR={}).FREE="free",OR.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var CB={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},De=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Jt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});var IB=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({}),bc=class mve{constructor(){re(this,"baseInfoMap",new Map),re(this,"proxyServer",void 0),re(this,"eventUploadTimer",void 0),re(this,"setSessionIdTimer",void 0),re(this,"url",void 0),re(this,"backupUrl",void 0),re(this,"_appId",void 0),re(this,"keyEventUploadPendingItems",[]),re(this,"normalEventUploadPendingItems",[]),re(this,"apiInvokeUploadPendingItems",[]),re(this,"apiInvokeCount",0),re(this,"ltsList",[]),re(this,"lastSendNormalEventTime",Date.now()),re(this,"customReportCounterTimer",void 0),re(this,"customReportCount",0),re(this,"extApiInvoke",async r=>{for(let i of r){let o=ot(ot({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Zt.TRACER});this.sendApiInvoke(o)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),v("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),v("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(r){return this.baseInfoMap.get(r)}adjustSessionStartTime(r){if(!this.baseInfoMap.has(r)&&!this.baseInfoMap.get(r))return void _.error("adjust session ".concat(r," start time, sid is not exist or info is undefined"));let i=this.baseInfoMap.get(r),o=Date.now(),h=i.startTime;i.startTime=o,_.debug("rewrite session ".concat(r," startTime: ").concat(o," , ").concat(o-h,"ms")),this.baseInfoMap.set(r,i)}setAppId(r){this._appId=r}reportApiInvoke(r,i,o){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;let h=Date.now();this.apiInvokeCount+=1;let p=this.apiInvokeCount,g=()=>({tag:i.tag,invokeId:p,sid:r,name:i.name,apiInvokeTime:h,options:i.options,states:i.states||null}),C=!!v("SHOW_REPORT_INVOKER_LOG");C&&_.info("".concat(i.name," start"),i.options);let A=!1;Me(i.timeout).then(()=>{A||(this.sendApiInvoke(ot(ot({},g()),{},{error:R.API_INVOKE_TIMEOUT,success:!1})),_.debug("".concat(i.name," timeout")))});let x=new N(R.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:_e=>{let cN=()=>{if(A)throw x;return A=!0,this.sendApiInvoke(ot(ot({},g()),{},{success:!0},i.reportResult&&{result:_e})),C&&_.info("".concat(i.name," onSuccess")),_e};return o?RR(cN,i.name+"Success",o,()=>A=!0):cN()},onError:_e=>{let cN=()=>{if(A)throw _e;A=!0,this.sendApiInvoke(ot(ot({},g()),{},{success:!1,error:_e})),C&&_.info("".concat(i.name," onFailure"),_e.toString())};return o?RR(cN,i.name+"Error",o,()=>A=!0):cN()}}}sessionInit(r,i){if(this.baseInfoMap.has(r))return;let o=Date.now(),h=this.createBaseInfo(r,o);h.cname=i.cname;let p=Object.assign({},{willUploadConsoleLog:v("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:pf?"global":"oversea",areas:v("AREAS")&&v("AREAS").join(",")},i.extend),{stringUid:g,channelProfile:C,channelMode:A,isABTestSuccess:x,lsid:_e,clientRole:cN}=i,dN=Date.now(),fN=ot(ot({},h),{},{eventType:De.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:Ef,lts:dN,elapse:dN-o,extend:JSON.stringify(p),mode:i.mode,process:v("PROCESS_ID"),appType:v("APP_TYPE"),success:!0,version:ii,stringUid:g,channelProfile:C,channelMode:A,isABTestSuccess:x,lsid:_e,clientType:W(mN=window.navigator.userAgent).call(mN,"AgoraWebView")?42:20,clientRole:cN,serviceId:v("PROCESS_ID"),extensionID:v("PLUGIN_INFO").join(",")||""});var mN;this.send({type:Jt.SESSION,data:fN},!0)}joinChooseServer(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{eventType:De.JOIN_CHOOSE_SERVER,lts:p,eventElapse:i.elapse||p-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:p-o.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:Jt.JOIN_CHOOSE_SERVER,data:g},!0)}reqUserAccount(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{eventType:De.REQ_USER_ACCOUNT,lts:p,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||p-o.startTime,eventElapse:p-i.lts,extend:JSON.stringify(i.extend)});this.send({type:Jt.REQ_USER_ACCOUNT,data:g},!0)}joinGateway(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info;i.vid&&(h.vid=i.vid),h.uid=i.uid,h.cid=i.cid;let p=Date.now(),{firstSuccess:g,avoidJoinStartTime:C}=i,A=p-(g&&C?C:o.startTime),x=ot(ot({},h),{},{eventType:De.JOIN_GATEWAY,lts:p,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,errorMsg:i.errorMsg||"",elapse:A,eventElapse:p-i.lts,firstSuccess:g,signalChannel:i.signalChannel,preload:i.preload?1:0});i.succ&&(o.lastJoinSuccessTime=p),this.send({type:Jt.JOIN_GATEWAY,data:x},!0)}joinChannelTimeout(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=Date.now(),p=ot(ot({},o.info),{},{lts:h,timeout:i,elapse:h-o.startTime});this.send({type:Jt.JOIN_CHANNEL_TIMEOUT,data:p},!0)}publish(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{eventType:De.PUBLISH,lts:p,eventElapse:i.eventElapse,elapse:p-o.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:Jt.PUBLISH,data:g},!0)}subscribe(r,i,o){let h=this.baseInfoMap.get(r);if(!h)return;let p=h.info,g=Date.now(),C=ot(ot({},p),{},{eventType:De.SUBSCRIBE,lts:g,eventElapse:i.eventElapse,elapse:g-h.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid,preSsrc:i.preSsrc?1:0},o&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?C.peerSuid=i.peerid:C.peer=i.peerid,this.send({type:Jt.SUBSCRIBE,data:C},!0)}wsCompressorInit(r){var i;let o=[...xn(i=this.baseInfoMap).call(i)],h=o.length?o[0]:"UnableToGetSid",p=this.baseInfoMap.get(h);if(!p)return;let g=p.info,C=Date.now(),A=ot(ot({},g),{},{eventType:De.WS_COMPRESSOR_INIT,lts:C,eventElapse:r.eventElapse,elapse:C-p.startTime,status:r.status?1:2});this.send({type:Jt.WS_COMPRESSOR_INIT,data:A},!0)}firstRemoteVideoDecode(r,i,o,h){let p=this.baseInfoMap.get(r);if(!p)return;let g=p.info,C=Date.now(),A=ot(ot(ot({},g),h),{},{elapse:C-p.startTime,eventType:i,lts:C,firstDecodeFrame:Math.max((h.firstFrame||C)-p.startTime,0),apEnd:Math.max(h.apEnd-p.startTime,0),apStart:Math.max(h.apStart-p.startTime,0),joinGwEnd:Math.max(h.joinGwEnd-p.startTime,0),joinGwStart:Math.max(h.joinGwStart-p.startTime,0),pcEnd:Math.max(h.pcEnd-p.startTime,0),pcStart:Math.max(h.pcStart-p.startTime,0),subscriberEnd:Math.max(h.subscriberEnd-p.startTime,0),subscriberStart:Math.max(h.subscriberStart-p.startTime,0),videoAddNotify:Math.max(h.videoAddNotify-p.startTime,0)});this.send({type:o,data:A},!0)}firstRemoteFrame(r,i,o,h){let p=this.baseInfoMap.get(r);if(!p)return;let g=p.info,C=Date.now(),A=ot(ot(ot({},g),h),{},{elapse:C-p.startTime,eventType:i,lts:C});this.send({type:o,data:A},!0)}pcStats(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot(ot({},h),i),{},{vid:h.vid===void 0?0:Number(h.vid),elapse:p-o.startTime,eventType:De.PC_STATS,lts:p,preallocation:i.preallocation?1:0});this.send({type:Jt.PC_STATS,data:g},!0)}updateRemoteRTPCapabilities(r,i){if(r){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot(ot({},h),i),{},{vid:h.vid===void 0?0:Number(h.vid),eventType:De.UPDATE_REMOTE_RTPCAPABILITIES,lts:p});this.send({type:Jt.UPDATE_REMOTE_RTPCAPABILITIES,data:g},!0)}}onGatewayStream(r,i,o,h){let p=this.baseInfoMap.get(r);if(!p)return;let g=p.info,C=Date.now(),A=ot(ot(ot({},g),h),{},{eventType:i,lts:C});this.send({type:o,data:A},!0)}streamSwitch(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{eventType:De.STREAM_SWITCH,lts:p,isDual:i.isdual,elapse:p-o.startTime,success:i.succ});this.send({type:Jt.STREAM_SWITCH,data:g},!0)}requestProxyAppCenter(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{eventType:De.REQUEST_PROXY_APPCENTER,lts:p,eventElapse:p-i.lts,elapse:p-o.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Jt.REQUEST_PROXY_APPCENTER,data:g},!0)}requestProxyWorkerManager(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{eventType:De.REQUEST_PROXY_WORKER_MANAGER,lts:p,eventElapse:p-i.lts,elapse:p-o.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Jt.REQUEST_PROXY_WORKER_MANAGER,data:g},!0)}setProxyServer(r){this.proxyServer=r,r?_.debug("reportProxyServerurl: ".concat(r)):_.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot({},h),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:p,elapse:p-o.startTime,joinChannelSuccessElapse:p-(o.lastJoinSuccessTime||p),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:Jt.PEER_PUBLISH_STATUS,data:g},!0)}workerEvent(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now();(function(g,C,A){let x=g[C];if(!x||typeof x!="string")return[g];g[C]="";let _e=ar(JSON.stringify(g)),cN=0,dN=[],fN=0;for(let mN=0;mN<x.length;mN++)fN+=x.charCodeAt(mN)<=127?1:3,fN<=A-_e||(dN[dN.length]=J(J({},g),{},{[C]:x.substring(cN,mN)}),cN=mN,fN=x.charCodeAt(mN)<=127?1:3);return cN!==x.length-1&&(dN[dN.length]=J(J({},g),{},{[C]:x.substring(cN)})),dN})(ot(ot(ot({},h),i),{},{elapse:p-o.startTime,lts:p,productType:"WebRTC"}),"payload",1300).forEach(g=>this.send({type:Jt.WORKER_EVENT,data:g},!0))}apworkerEvent(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot(ot({},h),i),{},{elapse:p-o.startTime,lts:p});this.send({type:Jt.AP_WORKER_EVENT,data:g},!0)}joinWebProxyAP(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot(ot({},h),i),{},{elapse:p-o.startTime,lts:p,extend:i.extend||void 0});this.send({type:Jt.JOIN_WEB_PROXY_AP,data:g},!0)}WebSocketQuit(r,i){let o=this.baseInfoMap.get(r);if(!o)return;let h=o.info,p=Date.now(),g=ot(ot(ot({},h),i),{},{elapse:p-o.startTime,lts:p});this.send({type:Jt.WEBSOCKET_QUIT,data:g},!0)}async sendCustomReportMessage(r,i){if(this.customReportCount+=i.length,this.customReportCount>v("CUSTOM_REPORT_LIMIT"))throw new N(R.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let o=Date.now(),h=i.map(p=>({type:Jt.USER_ANALYTICS,data:ot(ot({sid:r},p),{},{lts:o})}));try{v("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(h):await this.postDataToStatsCollector(h)}catch(p){throw _.error("send custom report message failed",p.toString()),new N(R.CUSTOM_REPORT_SEND_FAILED,p.message)}}sendApiInvoke(r){let i=v("NOT_REPORT_EVENT");if(r.tag&&W(i)&&W(i).call(i,r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;let o=this.baseInfoMap.get(r.sid);if(!o)return this.apiInvokeUploadPendingItems.push(r),!1;let{cname:h,uid:p,cid:g}=o.info,C;if(r.lts=r.lts||Date.now(),r.error)if(r.error instanceof N){let{code:x,message:_e}=r.error;C=x||_e||r.error.toString()}else C=r.error.toString();let A={invokeId:r.invokeId,sid:r.sid,cname:h,cid:g,uid:p,lts:r.lts,success:r.success,elapse:r.lts-o.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?JSON.stringify(r.options):void 0,execStates:r.states?JSON.stringify(r.states):void 0,execResult:r.result?JSON.stringify(r.result):void 0,errorCode:r.error?C:void 0,errorMsg:r.error?JSON.stringify(r.error):void 0};return this.send({type:Jt.API_INVOKE,data:A},!1),!0}appendSessionId(){mve.__CLIENT_LIST__.forEach(r=>{if(r._sessionId){let i=this.apiInvokeUploadPendingItems.length;for(let o=0;o<i;o++){let h=this.apiInvokeUploadPendingItems.shift();h&&(h.sid=r._sessionId,this.sendApiInvoke(Object.assign({},h)))}}})}send(r,i){if(i)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>v("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,i){let o=[],h=[];for(;r.length;){let g=r.shift();o.length<20?o.push(g):h.push(g)}r.push(...h);for(let g of[...o]){var p;this.ltsList.indexOf(g.data.lts)!==-1?(g.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(g.data.lts)):(this.ltsList.push(g.data.lts),ed(p=this.ltsList).call(p,(C,A)=>C-A))}return i||(this.lastSendNormalEventTime=Date.now()),v("ENABLE_EVENT_REPORT")&&o.length&&(v("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(o):this.postDataToStatsCollector(o)).catch((g=>C=>{v("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(g):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(g),this.normalEventUploadPendingItems.length>v("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-v("NORMAL_EVENT_QUEUE_CAPACITY")),_.warning("report: drop normal events"))))})(o)),r}async postDataToStatsCollector2(r){he.networkState===wn.OFFLINE&&await j.race([he.onlineWaiter,Me(2*Ee.maxRetryTimeout)]);let i=p=>{let g=new Uint8Array;return p.forEach(C=>{let A=uf(JSON.stringify(C.data)),x=new ArrayBuffer(5),_e=(dN=>{let fN=0;return Object.entries(Jt).forEach(mN=>{let[EN,RN]=mN;RN===dN.type&&(fN=IB[EN])}),fN})(C),cN=new DataView(x);cN.setUint16(0,A.byteLength,!0),cN.setUint8(2,255&_e),cN.setUint8(3,_e>>>8&255),cN.setUint8(4,_e>>>16&255),g=ER(g,new Uint8Array(x)),g=ER(g,A)}),g},o="event",h=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(o):"https://".concat(v("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(o);for(let p=0;p<2;p+=1){p===1&&(h=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(o):"https://".concat(v("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(o));try{await LE(h,{timeout:1e4,data:i(r),headers:ot(ot({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(g){if(p===1)throw g;continue}return}}async postDataToStatsCollector(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1],o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:r.map(g=>JSON.stringify(g)),vid:(g=>{let C=g&&g.data.sid&&this.baseInfoMap.get(g.data.sid);return C&&C.info.vid&&+C.info.vid||0})(r[0])};he.networkState===wn.OFFLINE&&await j.race([he.onlineWaiter,Me(2*Ee.maxRetryTimeout)]);let h=i?"/events/proto-raws":"/events/messages",p=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("EVENT_REPORT_DOMAIN"),"&p=").concat(v("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(v("EVENT_REPORT_DOMAIN"),":").concat(v("STATS_COLLECTOR_PORT")).concat(h));for(let g=0;g<2;g+=1){g===1&&(p=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(v("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(v("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(v("STATS_COLLECTOR_PORT")).concat(h)));try{i?await gB(p,{timeout:1e4,data:o}):await LE(p,{timeout:1e4,data:o})}catch(C){if(g===1)throw C;continue}return}}createBaseInfo(r,i){let o=Object.assign({},CB);return o.sid=r,this.baseInfoMap.set(r,{info:o,startTime:i}),o}reportResourceTiming(r,i){let o=performance.getEntriesByName(r),h=o[o.length-1];h&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:h,tag:Zt.TRACER}).onSuccess()}};function $(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){let h=o.value;if(typeof h=="function"){let p=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var g=arguments.length,C=new Array(g),A=0;A<g;A++)C[A]=arguments[A];let x=C;if(e.argsMap)try{x=e.argsMap(this,...C)}catch(cN){_.warning(cN),x=[]}try{JSON.stringify(x)}catch{_.warning("arguments for method ".concat(p,".").concat(String(i)," not serializable for apiInvoke.")),x=[]}let _e=(e.report||X).reportApiInvoke(this._sessionId||null,{name:"".concat(p,".").concat(String(i)),options:x,tag:Zt.TRACER,reportResult:e.reportResult},e.throttleTime);try{let cN=h.apply(this,C);return cN instanceof j?cN.then(dN=>(_e.onSuccess(e.reportResult&&dN),dN)).catch(dN=>{throw _e.onError(dN),dN}):(_e.onSuccess(e.reportResult&&cN),cN)}catch(cN){throw _e.onError(cN),cN}}}return o}}re(bc,"__CLIENT_LIST__",[]);var X=new bc;wO.on("REPORT_LOG_UPLOAD",e=>{e.networkState=he.networkState,X.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Zt.TRACER}).onSuccess("logUploadError")});var vB=["CHINA","GLOBAL"],Ve=function(){let e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let o=i.join(""),h=[];for(let C=0;C<6;C++)h.push("1");let p=h.join(""),g={};return g[e]=o,g[r]=p,Object.assign(g,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ve,pf||(oe.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],oe.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],oe.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],oe.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],oe.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],oe.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],oe.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",oe.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",oe.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",oe.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",oe.AREAS=["NORTH_AMERICA","OVERSEA"]);var OO=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Jr=[];function Io(e,r){return!!r&&Jr.some(i=>i.uid===e&&i.channelName===r)}bc.__CLIENT_LIST__=Jr;var yB=bw.forEach,NR=Nu("forEach")?[].forEach:function(e){return yB(this,e,arguments.length>1?arguments[1]:void 0)};xt({target:"Array",proto:!0,forced:[].forEach!=NR},{forEach:NR});var AB=bi("Array").forEach,bB=Er,wB=Je,OB=hn,NB=AB,Dp=Array.prototype,DB={DOMTokenList:!0,NodeList:!0},PB=function(e){var r=e.forEach;return e===Dp||OB(Dp,e)&&r===Dp.forEach||wB(DB,bB(e))?NB:r},kB=ae(PB),LB=_r,DR=Lu;xt({target:"Object",stat:!0,forced:Se(function(){DR(1)})},{keys:function(e){return DR(LB(e))}});var NO=ae(Gi.Object.keys),MB=ae(VA),UB=xt,xB=nd,VB=me([].reverse),PR=[1,2];UB({target:"Array",proto:!0,forced:String(PR)===String(PR.reverse())},{reverse:function(){return xB(this)&&(this.length=this.length),VB(this)}});var FB=bi("Array").reverse,BB=hn,jB=FB,Pp=Array.prototype,GB=function(e){var r=e.reverse;return e===Pp||BB(Pp,e)&&r===Pp.reverse?jB:r},DO=GB,WB=ae(DO),HB=xt,kR=nd,KB=xu,YB=Hn,LR=Om,qB=Lr,zB=Eo,JB=Bu,XB=pe,QB=Gm,ZB=Iw("slice"),$B=XB("species"),kp=Array,tj=Math.max;HB({target:"Array",proto:!0,forced:!ZB},{slice:function(e,r){var i,o,h,p=zB(this),g=qB(p),C=LR(e,g),A=LR(r===void 0?g:r,g);if(kR(p)&&(i=p.constructor,(KB(i)&&(i===kp||kR(i.prototype))||YB(i)&&(i=i[$B])===null)&&(i=void 0),i===kp||i===void 0))return QB(p,C,A);for(o=new(i===void 0?kp:i)(tj(A-C,0)),h=0;C<A;C++,h++)C in p&&JB(o,h,p[C]);return o.length=h,o}});var ej=bi("Array").slice,nj=hn,ij=ej,Lp=Array.prototype,rj=function(e){var r=e.slice;return e===Lp||nj(Lp,e)&&r===Lp.slice?ij:r},oj=ae(rj);function q(e,r,i,o,h){var p,g,C,A={};return kB(p=NO(o)).call(p,function(x){A[x]=o[x]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=MB(g=WB(C=oj(i).call(i)).call(C)).call(g,function(x,_e){return _e(e,r,x)||x},A),h&&A.initializer!==void 0&&(A.value=A.initializer?A.initializer.call(h):void 0,A.initializer=void 0),A.initializer===void 0&&(Rw(e,r,A),A=null),A}var xE=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),kn=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),gl=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Mp=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ci=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),on=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Z=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Lt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),nt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),et=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),wc=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),dt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),cn=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),it=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({}),O=class extends N{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),T(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,_)}throw(){super.throw(_)}};function Xu(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw _.error("Invalid Channel Name ".concat(e)),new O(R.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Qu(e){if(!function(r){return typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295}(e)&&!RO(e,1,255))throw new O(R.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&_.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var er=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),sj={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Up={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function xp(e,r){Pe(e.url,"".concat(r,".url"),1,1e3,!1),zt(e.x)||Nt(e.x,"".concat(r,".x"),0,1e4),zt(e.y)||Nt(e.y,"".concat(r,".y"),0,1e4),zt(e.width)||Nt(e.width,"".concat(r,".width"),0,1e4),zt(e.height)||Nt(e.height,"".concat(r,".height"),0,1e4),zt(e.zOrder)||Nt(e.zOrder,"".concat(r,".zOrder"),0,255),zt(e.alpha)||Nt(e.alpha,"".concat(r,".alpha"),0,1,!1)}var aj={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Xr=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),VE=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),fe=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function MR(e){if(!e.channelName)throw new O(R.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new O(R.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Pe(e.token,"info.token",1,2047),Qu(e.uid),Xu(e.channelName),!0}var sn=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Ir=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Sn=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),ys=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Ct=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),xe=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),Tl=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ve=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),St=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),UR=[St.AFRICA,St.ASIA,St.CHINA,St.EUROPE,St.GLOBAL,St.INDIA,St.JAPAN,St.NORTH_AMERICA,St.OCEANIA,St.OVERSEA,St.SOUTH_AMERICA],Ye=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),Zu={CHINA:{},ASIA:{CODE:Ye.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ye.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ye.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ye.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ye.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ye.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ye.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ye.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ye.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ye.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ye.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ye.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ye.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};pf&&(Zu.CHINA={CODE:Ye.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var FE=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({}),Kl=class extends Xt{constructor(e,r){super(),T(this,"onICEConnectionStateChange",void 0),T(this,"onConnectionStateChange",void 0),T(this,"onDTLSTransportStateChange",void 0),T(this,"onDTLSTransportError",void 0),T(this,"onICETransportStateChange",void 0),T(this,"onFirstAudioReceived",void 0),T(this,"onFirstVideoReceived",void 0),T(this,"onFirstAudioDecoded",void 0),T(this,"onFirstVideoDecoded",void 0),T(this,"onFirstVideoDecodedTimeout",void 0),T(this,"onSelectedLocalCandidateChanged",void 0),T(this,"onSelectedRemoteCandidateChanged",void 0),T(this,"getLocalVideoStats",void 0)}},Yl=class extends Kl{constructor(e,r){super(e,r),T(this,"establishPromise",void 0)}},Q=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),On=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Tr=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),U=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Rt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),tt=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ei=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),di=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),we=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),PO=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),nr=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Xn=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Mi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),hs=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ie=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),ps=function(e){return e.ABORT="abort",e}({}),to=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),cj=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),dj={[gl.ACCESS_POINT]:{[on.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[on.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[on.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[on.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[on.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[on.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[on.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[on.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[on.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[on.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[on.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[on.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[on.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[on.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[on.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[on.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[on.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[on.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[gl.UNILBS]:{[ci.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ci.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ci.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ci.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ci.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ci.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ci.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ci.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ci.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ci.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ci.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ci.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[gl.STRING_UID_ALLOCATOR]:{[Mp.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Mp.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Mp.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function ta(e){let r=dj[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};let i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===gl.ACCESS_POINT){let o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}var lj={[Z.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Z.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Z.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Z.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Z.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Z.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Z.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Z.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Z.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Z.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Z.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Z.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Z.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Z.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Z.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Z.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Z.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Z.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Z.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Z.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Z.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Z.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Z.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Z.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Z.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Z.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Z.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Z.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Z.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Z.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Z.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Z.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Z.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Z.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Z.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Z.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Z.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Z.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Z.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Z.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Z.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Z.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Z.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Z.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Z.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Z.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Z.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Z.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Z.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Z.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Z.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Z.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Z.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Z.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Z.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Z.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Z.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Z.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Z.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Z.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Z.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Z.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Z.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Oc(e){return lj[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function xR(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Vp(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?xR(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xR(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function VR(e){return e.every(r=>r.readyState===WebSocket.CLOSED||r.readyState===WebSocket.CLOSING)}function FR(e,r){if(typeof e=="string")return e;let{proxy:i,host:o,port:h}=e;if(r){let p=v("JOIN_GATEWAY_FALLBACK_PORT")||443;return p===443?"wss://".concat(o,"/ws/?p=").concat(Number(h)+150):"wss://".concat(o,":").concat(p,"/ws/?p=").concat(Number(h)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(h):"wss://".concat(o,":").concat(h)}var uj=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,hj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,pj=/wss:\/\/(.+):([0-9]+)\/?/,_j=/wss:\/\/(.[^\/]+)\/?/,Ej=0,BE=class{constructor(e,r){T(this,"id",0),T(this,"store",void 0),T(this,"recordIndex",void 0),T(this,"websockets",[]),T(this,"try443PortDuration",2e3),T(this,"forceCloseWSDuration",5e3),T(this,"try443PortTimeout",null),T(this,"forceCloseTimeout",null),T(this,"isTry443PortFailed",!1),T(this,"isNormalPortFailed",!1),T(this,"useDoubleDomain",!1),T(this,"useProxy",!1),T(this,"startTime",Date.now()),this.id=++Ej,this.try443PortDuration=v("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;let r=Date.now()-this.startTime;for(var i=arguments.length,o=new Array(i),h=0;h<i;h++)o[h]=arguments[h];_.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...o)}createWebSocket(e,r,i){this.logger("createWebSocket:",e,{isTry443Port:r,hasTimeoutDetection:i});let o=v("GATEWAY_DOMAINS"),h=Date.now(),p=[],g=o.find(x=>{var _e;return W(_e=e.host).call(_e,x)});g||(this.useDoubleDomain=!1);let C=[];if(this.useDoubleDomain)o.forEach(x=>{C.push(FR(Vp(Vp({},e),{},{host:e.host.replace(g,x)}),r))});else{let x=Vp({},e);if(r&&g){let _e=o.find(cN=>cN!==g);_e&&(x.host=x.host.replace(g,_e))}C.push(FR(x,r))}try{C.forEach(x=>{let _e=new WebSocket(x);_e.binaryType="arraybuffer",p.push(_e),this.logger("ws is connecting:",_e.url)})}catch(x){if(this.logger("ws create failed"),p.forEach(_e=>_e.close()),p.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,r,i);if(!r&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new O(R.WS_ERR,"init websocket failed! Error: ".concat(x.toString()))}let A=vc();return this.store&&this.store.recordJoinChannelService({urls:p.map(x=>x.url),service:"gateway"},this.recordIndex),p.forEach(x=>{x.onopen=()=>{this.logger("onopen: ws ".concat(x.url," open cost ").concat(Date.now()-h,"ms")),this.websockets.forEach(_e=>{_e!==x&&(_e.onopen=null,_e.onclose=null,_e.onmessage=null,_e.close(),this.logger("close backup websocket: ".concat(_e.url)))}),this.websockets.length=0,A.resolve(x)},x.onclose=_e=>{this.logger("onclose: ws ".concat(x.url," closed cost ").concat(Date.now()-h,"ms state: ").concat(x.readyState)),r?this.isTry443PortFailed=VR(p):this.isNormalPortFailed=VR(p),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(_e.reason)),A.reject({code:_e.code,reason:Tl.A_ROUND_WS_FAILED}))},x.onmessage=_e=>this.logger("".concat(x.url," onmessage: ").concat(_e.data))}),this.websockets.push(...p),i||(()=>{let x=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",A.isResolved),this.websockets.forEach(_e=>_e.readyState!==WebSocket.OPEN&&_e.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(x,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",A.isResolved),A.isResolved)return x();mt().os===ye.MAC_OS&&$t()&&x(),this.createWebSocket(e,!0,!0).then(_e=>A.resolve(_e)).catch(_e=>{this.isNormalPortFailed&&A.reject(_e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(x,this.forceCloseWSDuration)},this.try443PortDuration)})(),A.promise}chooseBestWebsocket(e,r,i,o){return this.useDoubleDomain=!!r,typeof e=="string"&&(e=function(h){let p,g,C;return[,p,g,C]=h.match(uj)||[],p||([,g,C]=h.match(hj)||[]),g&&C||([,g,C]=h.match(pj)||[]),g&&C||([,g]=h.match(_j)||[]),g||_.warning("un-destructible url: ",h),{proxy:p,host:g,port:C||"443"}}(e)),this.recordIndex=o,this.useProxy=!!e.proxy,i&&this.useProxy&&(_.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}};function BR(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}var ql=class extends Xt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var r;W(r=["tryNext","recover"]).call(r,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(it.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(it.CONNECTED):this._state==="closed"?this.emit(it.CLOSED):this._state==="failed"&&this.emit(it.FAILED))}resetReconnectCount(e){_.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],h=arguments.length>4&&arguments[4]!==void 0&&arguments[4],p=arguments.length>5?arguments[5]:void 0;super(),T(this,"connectionID",0),T(this,"currentURLIndex",0),T(this,"urls",[]),T(this,"_reconnectMode","tryNext"),T(this,"reconnectReason",void 0),T(this,"_initMutex",new ze("websocket")),T(this,"name",void 0),T(this,"_state","closed"),T(this,"reconnectInterrupter",void 0),T(this,"websocket",void 0),T(this,"retryConfig",void 0),T(this,"reconnectCount",0),T(this,"forceCloseTimeout",5e3),T(this,"onlineReconnectListener",void 0),T(this,"useCompress",void 0),T(this,"tryDoubleDomain",!1),T(this,"use443PortOnly",!1),T(this,"wsInflateLength",0),T(this,"wsDeflateLength",0),T(this,"closeEstablishingWs",()=>{}),T(this,"store",void 0),T(this,"joinGatewayRecordIndex",void 0),this.store=p,this.name=e,this.retryConfig=function(_e){for(var cN=1;cN<arguments.length;cN++){var dN=arguments[cN]!=null?arguments[cN]:{};cN%2?BR(Object(dN),!0).forEach(function(fN){T(_e,fN,dN[fN])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(dN)):BR(Object(dN)).forEach(function(fN){Object.defineProperty(_e,fN,Object.getOwnPropertyDescriptor(dN,fN))})}return _e}({},r),this.useCompress=i,this.tryDoubleDomain=o,this.use443PortOnly=h;let{timeout:g,timeoutFactor:C}=r,A=Math.max(300,Math.floor(3*g/5)),x=Math.max(1.2,Math.floor(8*C)/10);wn.ONLINE&&(this.retryConfig.timeout=A,this.retryConfig.timeoutFactor=x),he.on(ks.NETWORK_STATE_CHANGE,(_e,cN)=>{_e!==cN&&(this.resetReconnectCount("network state change: ".concat(cN," -> ").concat(_e)),_e===wn.ONLINE?(this.retryConfig.timeout=A,this.retryConfig.timeoutFactor=x):(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=C))})}getConnection(){return this.websocket||void 0}async init(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=await this._initMutex.lock();this.forceCloseTimeout=r,this.urls=e,this.state="connecting";try{let o=vc(),h=this.urls[this.currentURLIndex];v("ENABLE_PREALLOC_PC")&&this.emit(PO.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(o.resolve).catch(o.reject),this.once(it.CLOSED,()=>{o.reject(new N(R.WS_DISCONNECT))}),this.once(it.CONNECTED,o.resolve),await o.promise}catch{}finally{i()}}close(e,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let i=this.websocket;r?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,r){if(!this.websocket)return void _.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),_.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);let i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:r})}sendMessage(e){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new N(R.WS_ABORT,"websocket is not ready");try{r||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new N(R.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var r;let i=vc();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let o=x=>{var _e;(_e=this.store)===null||_e===void 0||_e.signalChannelOpen(),_.debug("[".concat(this.name,"] websocket opened:"),x),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},h=async x=>{var _e;if(_.debug("[".concat(this.name,"] websocket close ").concat((_e=this.websocket)===null||_e===void 0?void 0:_e.url,", code: ").concat(x.code,", reason: ").concat(x.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new N(R.WS_DISCONNECT,"websocket close: ".concat(x.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=x.reason,this.state="reconnecting");let cN=ni(this,it.WILL_RECONNECT,this.reconnectMode,x.reason)||this.reconnectMode,dN=await this.reconnectWithAction(cN);if(this.state==="closed")return void _.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!dN)return i.reject(new N(R.WS_DISCONNECT,"websocket reconnect failed: ".concat(x.code))),this.close(!0);i.resolve()}},p=x=>{this.emit(it.ON_MESSAGE,x)},g=x=>{_.warn("[".concat(this.connectionID,"] ws open error ").concat(x))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),v("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=v("GATEWAY_WSS_ADDRESS")),_.debug("[".concat(this.name,"] start connect, url:"),e);let C=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var A;let x=await this.chooseBestWebsocketConnection(e);this.websocket=x,o&&o(this.websocket.url),this.websocket.onclose=h,this.websocket.onmessage=p,this.websocket.onerror=g,(A=this.store)===null||A===void 0||A.recordJoinChannelService({endTs:Date.now(),status:"success"},C),this.joinGatewayRecordIndex=C}catch(x){let _e=this.state==="closed",cN=x instanceof N,dN=cN&&x.code===R.WS_ABORT,fN=cN&&x.code===R.WS_ERR,mN=cN?x.message:x&&(x.reason||x.toString());_.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(mN)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:dN?"aborted":"error",errors:[x]},C),_e||fN?(i.reject(_e?new N(R.WS_DISCONNECT,"websocket is closed: ".concat(mN)):new N(R.WS_ERR,"init websocket failed: ".concat(mN))),fN&&_.error("[".concat(this.name,"] init websocket failed: ").concat(mN))):h(x)}return i.promise}async reconnectWithAction(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;_.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||he.isOnline||!he.onlineWaiter||(this.onlineReconnectListener=he.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,r){let p=hf(this.reconnectCount,this.retryConfig);_.debug("[".concat(this.name,"] wait ").concat(p,"ms to reconnect websocket, mode: ").concat(e)),await j.race([Me(p),this.onlineReconnectListener||new j(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;let o=async(p,g)=>{this.emit(it.RECONNECT_CREATE_CONNECTION,g),await this.createWebSocketConnection(p)};try{if(e==="retry")this.emit(it.RECONNECT_WAITTING_FINISH,e),await o(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);_.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(it.RECONNECT_WAITTING_FINISH,e),await o(this.urls[this.currentURLIndex],e)}else e==="recover"&&(_.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(it.RECONNECT_WAITTING_FINISH,e),this.urls=await Ge(this,it.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],e))}catch(p){var h;_.error("[".concat(this.name,"] reconnect failed ").concat(p&&p.toString()));let g=p==null||(h=p.data)===null||h===void 0?void 0:h.desc;return Array.isArray(g)&&W(g).call(g,"dynamic key expired")?(this.emit(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,r)}return!0}},Nc=class extends ql{constructor(e,r){super(e,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,r){let i=vc(),o=function(p,g){return new BE(p,g)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{_.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),i.reject(new N(R.WS_ABORT,"choose best websocket aborted"))};let h=v("GATEWAY_DOMAINS");return _.debug("[choose-best-ws] currentDomain: ",e,", domains: ",h,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,r).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}},Qo=class extends ql{constructor(e,r){super(e,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,r){return new j((i,o)=>{let h=!1,p=[];this.closeEstablishingWs=()=>{_.debug("[choose-best-ws] close establishing websockets"),p.forEach(fN=>{fN.onclose=null,fN.onopen=null,fN.onmessage=null,fN.close()}),o(new N(R.WS_ABORT,"choose best websocket aborted"))};let g=v("GATEWAY_DOMAINS"),C,A=e.indexOf("?h="),x=g.find(fN=>A!==-1?W(e).call(e,fN,A):W(e).call(e,fN));_.debug("[choose-best-ws] currentDomain: ",x,", domains: ",g);let _e=!this.tryDoubleDomain||!x;if(!_e&&x){var cN;let fN=Date.now();try{g.forEach(mN=>{let EN=A===-1?e.replace(x,mN):e.substr(0,A)+e.substr(A).replace(x,mN),RN=new WebSocket(EN);RN.binaryType="arraybuffer",p.push(RN),_.debug("[choose-best-ws] ws is connecting:",RN.url)})}catch{for(_.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(mN=>mN.close());p.length;)p.pop();_e=!0}(cN=this.store)===null||cN===void 0||cN.recordJoinChannelService({urls:p.map(mN=>mN.url),service:"gateway"},r),p.forEach(mN=>{mN.onopen=()=>{if(h)return;let EN=Date.now()-fN;_.debug("[choose-best-ws] ws open cost ".concat(EN,"ms")),p.filter(RN=>RN!==mN).forEach(RN=>{_.debug("[choose-best-ws]close backup websocket: ".concat(RN.url)),RN.close()}),h=!0,i(mN)},mN.onclose=EN=>{C=EN,!h&&(p.find(RN=>!(RN.readyState===WebSocket.CLOSED||RN.readyState===WebSocket.CLOSING))||(_.debug("[choose-best-ws] all websocket is closed"),h=!0,o(C)))},mN.onmessage=EN=>{_.debug("[choose-best-ws]".concat(mN.url," onmessage: ").concat(EN.data))}}),Me(this.forceCloseTimeout).then(()=>{p.forEach(mN=>{mN.readyState!==WebSocket.OPEN&&mN.close()})})}if(_e){var dN;let fN;_.debug("[choose-best-ws] use single url: ",e),(dN=this.store)===null||dN===void 0||dN.recordJoinChannelService({urls:[e],service:"gateway"},r);try{fN=new WebSocket(e),p.push(fN),fN.binaryType="arraybuffer"}catch(mN){let EN=new N(R.WS_ERR,"init websocket failed! Error: ".concat(mN.toString()));return _.error("[".concat(this.name,"]").concat(EN)),void o(EN)}fN.onopen=()=>{i(fN)},fN.onclose=mN=>{o(mN)},fN.onmessage=mN=>{_.debug("[choose-best-ws]".concat(fN.url," onmessage: ").concat(mN.data))},Me(this.forceCloseTimeout).then(()=>{fN&&fN.readyState!==WebSocket.OPEN&&fN.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}},jE=class extends Xt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Lt.CONNECTED?this.emit(nt.WS_CONNECTED):e===Lt.RECONNECTING?this.emit(nt.WS_RECONNECTING,this._websocketReconnectReason):e===Lt.CLOSED&&this.emit(nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,r){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",Lt.CLOSED),T(this,"reconnectToken",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new Hl(5)),T(this,"pingpongTimer",void 0),T(this,"wsInflateDataTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(nt.ON_BINARY_DATA,i.data);let o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let h="res-@".concat(o._id);this.emit(h,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===dt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===dt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(At.UID_BANNED);break;case 15:this.close(At.IP_BANNED);break;case 16:this.close(At.CHANNEL_BANNED)}if(o._type===dt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Z.ERR_LICENSE_MISSING:this.close(At.LICENSE_MISSING);break;case Z.ERR_LICENSE_EXPIRED:this.close(At.LICENSE_EXPIRED);break;case Z.ERR_LICENSE_MINUTES_EXCEEDED:this.close(At.LICENSE_MINUTES_EXCEEDED);break;case Z.ERR_LICENSE_PERIOD_INVALID:this.close(At.LICENSE_PERIOD_INVALID);break;case Z.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(At.LICENSE_MULTIPLE_SDK_SERVICE);break;case Z.ERR_LICENSE_ILLEGAL:this.close(At.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=r,this.websocket=new Nc("gateway-".concat(this.clientId),this.spec.retryConfig,!0,v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),v("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Be.OFFLINE)})}async request(e,r,i,o){let h=Ut(6,""),p={_id:h,_type:e,_message:r},g=this.websocket.connectionID,C=()=>new j((fN,mN)=>{if(this.connectionState===Lt.CONNECTED)return fN();let EN=()=>{this.off(nt.WS_CLOSED,RN),fN()},RN=()=>{this.off(nt.WS_CONNECTED,EN),mN(new O(R.WS_ABORT))};this.once(nt.WS_CONNECTED,EN),this.once(nt.WS_CLOSED,RN),e!==et.PUBLISH&&e!==et.PUBLISH_DATASTREAM&&e!==et.SUBSCRIBE&&e!==et.SUBSCRIBE_DATASTREAM&&e!==et.UNSUBSCRIBE&&e!==et.UNSUBSCRIBE_DATASTREAM&&e!==et.UNPUBLISH&&e!==et.UNPUBLISH_DATASTREAM&&e!==et.CONTROL&&e!==et.RESTART_ICE||this.once(nt.DISCONNECT_P2P,()=>{mN(new O(R.DISCONNECT_P2P))}),e!==et.PUBLISH&&e!==et.RESTART_ICE||this.once(nt.ABORT_P2P_EXECUTION,()=>{mN(new O(R.DISCONNECT_P2P))})});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||e===et.JOIN||e===et.REJOIN||await C(),this.websocket.sendMessage(p,!0),o)return;let A=new j((fN,mN)=>{let EN=!1,RN=(t0,aH)=>{EN=!0,fN({isSuccess:t0==="success",message:aH||{}}),this.off(nt.WS_CLOSED,IN),this.off(nt.WS_RECONNECTING,IN),this.emit(nt.REQUEST_SUCCESS,e,r)};this.once("res-@".concat(h),RN);let IN=()=>{mN(new O(R.WS_ABORT,"type: ".concat(e))),this.off(nt.WS_CLOSED,IN),this.off(nt.WS_RECONNECTING,IN),this.off("res-@".concat(h),RN)};this.once(nt.WS_CLOSED,IN),this.once(nt.WS_RECONNECTING,IN),Me(v("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||EN||(_.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(nt.REQUEST_TIMEOUT,e,r))})}),x=null;try{x=await A}catch(fN){if(this.connectionState===Lt.CLOSED||e===et.LEAVE)throw new O(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?fN.throw():e===et.JOIN||e===et.REJOIN?null:(await C(),await this.request(e,r))}if(x.isSuccess)return x.message;let _e=Number(x.message.error_code||x.message.code),cN=Oc(_e),dN=new O(R.UNEXPECTED_RESPONSE,"".concat(cN.desc,": ").concat(x.message.error_str),{code:_e,data:x.message,desc:cN.desc});return cN.action==="success"?x.message:(_.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_e,", message: ").concat(cN.desc,", action: ").concat(cN.action)),_e===Z.ERR_TOO_MANY_BROADCASTERS?((e===et.JOIN||e===et.REJOIN)&&(this.initError=dN,this.close()),dN.throw()):cN.action==="failed"?dN.throw():cN.action==="quit"?(this.initError=dN,this.close(),dN.throw()):(_e===Z.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=x.message.option,_.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Be.MULTI_IP)):this.reconnect(cN.action,Be.SERVER_ERROR),e===et.JOIN||e===et.REJOIN?null:await this.request(e,r)))}waitMessage(e,r){return new j(i=>{let o=h=>{(!r||r(h))&&(this.off(e,o),i(h))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void _.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(wc.WRTC_STATS,r)}upload(e,r){let i={_type:e,_message:r};try{this.websocket.sendMessage(i)}catch{let o=v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;let h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,r){let i={_type:e,_message:r};this.websocket.sendMessage(i)}init(e,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new j((i,o)=>{this.once(nt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(nt.WS_CLOSED,()=>o(this.initError||new O(R.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(e).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||At.LEAVE,this.connectionState=Lt.CLOSED,_.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(nt.ABORT_P2P_EXECUTION);let e=await Ge(this,nt.REQUEST_JOIN_INFO),r=await this.request(et.JOIN,e);if(!r)return this.emit(nt.REPORT_JOIN_GATEWAY,Tl.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new O(R.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=Ac(this,nt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let r=await this.request(et.REJOIN,e);return!!r&&(this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(i=>{this.emit(dt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(dt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(dt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(dt.MUTE_AUDIO,{uid:i.uid}):this.emit(dt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(dt.MUTE_VIDEO,{uid:i.uid}):this.emit(dt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(dt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(dt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(dt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(dt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(dt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,r)}handleNotification(e){_.debug("[".concat(this.clientId,"] receive notification: "),e);let r=Oc(e.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(At.UID_BANNED),void this.close()):void this.reconnect(r.action,Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=v("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=e&&(_.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Be.TIMEOUT):this.request(et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),v("REPORT_STATS")&&this.send(et.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:r}=this.websocket.getWsInflateData();e!==0&&r!==0&&this.upload(wc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(it.RECONNECT_WAITTING_FINISH,e=>{this.emit(nt.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(it.RECONNECT_CREATE_CONNECTION,e=>{this.emit(nt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(it.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(it.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(it.FAILED,()=>{this._disconnectedReason=At.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(it.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(it.WILL_RECONNECT,(e,r,i)=>{let o=Ac(this,nt.IS_P2P_DISCONNECTED),h=o||e!=="retry";o&&e==="retry"&&(_.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",r=Tl.P2P_DISCONNECTED),h&&(_.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(nt.REPORT_JOIN_GATEWAY,r||Tl.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(nt.DISCONNECT_P2P)),i(e)}),this.websocket.on(it.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{_.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Be.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(nt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof O){if(e.code===R.UNEXPECTED_RESPONSE&&e.data.code===Z.ERR_NO_AUTHORIZED)return this.initError=new O(R.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),_.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Be.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(it.REQUEST_NEW_URLS,(e,r)=>{Ge(this,nt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(r)}),this.websocket.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(PO.PRE_CONNECT_PC,()=>{this.emit(nt.PRE_CONNECT_PC)})}},ue=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function jR(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function kd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?jR(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jR(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Us(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(v("TURN_DOMAIN")):(_.info("Unidentified as ip: ".concat(e,", use as host")),e)}function mf(e,r){e.addresses||(e.addresses=[]);let i=function(C,A){if(v("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return C.map(cN=>{let{ip:dN,port:fN}=cN;return{address:"".concat(dN,":").concat(fN)}});let x=v("GATEWAY_DOMAINS"),_e=x[1]&&W(A).call(A,x[1])?1:0;return C.map(cN=>{let{domain_prefix:dN,port:fN,ip:mN}=cN;if(dN)return{address:"".concat(dN,".").concat(x[_e++%x.length],":").concat(fN)};let EN=/^[\.\:\d]+$/.test(mN),RN=EN?"".concat(mN.replace(/[^\d]/g,"-"),".").concat(x[_e++%x.length],":").concat(fN):"".concat(mN,":").concat(fN);return EN||_.info("Unidentified as ip: ".concat(mN,", use as host")),{ip:mN,port:fN,address:RN}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){let C=o.split(";");for(let A=0;A<C.length;A++){var h;let x=rn(h=C[A]).call(h);i[A]&&x&&(i[A].ip6=x)}}let p=e.detail&&e.detail.candidate,g;if(p){let[C,A]=p.split(":");C&&A&&(g={port:Number(A),ip:C,address:"".concat(C,":").concat(A)})}return{gatewayAddrs:i,apGatewayAddress:g,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Nn(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function GR(e){let r=e._encoderConfig;if(!r)return{};let i={resolution:r.width&&r.height?"".concat(Nn(r.width),"x").concat(Nn(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function WR(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Dc(e,r){let i,o,h;switch(r){case ue.CHOOSE_SERVER:o=4096,h="choose server";break;case ue.CLOUD_PROXY:o=1048576,h="proxy";break;case ue.CLOUD_PROXY_5:o=4194304,h="proxy5";break;case ue.CLOUD_PROXY_FALLBACK:o=4194310,h="proxy fallback";break;default:throw new O(R.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(p=>{p.buffer&&p.buffer.flag===o&&(i={code:p.buffer.code,addresses:(p.buffer.edges_services||[]).map(g=>kd(kd({},g),{},{ticket:p.buffer.cert})),server_ts:e.enter_ts,uid:p.buffer.uid,cid:p.buffer.cid,cname:p.buffer.cname,detail:kd(kd({},p.buffer.detail),e.detail),flag:p.buffer.flag,opid:e.opid,cert:p.buffer.cert})}),!i)throw new O(R.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(h," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function kO(e,r){return await j.all(e.addresses.map(async i=>({address:Us(i.ip),tcpport:i.port,udpport:i.port,username:r&&v("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ve.username,password:r&&v("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await PE(r.toString()):Ve.password})))}function GE(e,r){let i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,h=r.videoWidth||i.width;return o&&h?Math.max(Math.min(o,h)/Math.min(Nn(e.height),Nn(e.width)),1):(_.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function eo(e){let{candidateType:r,relayProtocol:i,type:o,address:h,port:p,protocol:g}=e;return o==="local-candidate"?{candidateType:r,relayProtocol:i,protocol:g}:{candidateType:r,relayProtocol:i,address:h,port:p,protocol:g}}var li,mj=ae(DO),fj=bi("Array").values,gj=Er,Tj=Je,Sj=hn,Rj=fj,Fp=Array.prototype,Cj={DOMTokenList:!0,NodeList:!0},Ij=function(e){var r=e.values;return e===Fp||Sj(Fp,e)&&r===Fp.values||Tj(Cj,gj(e))?Rj:r},Pr=ae(Ij),HR=ri,vj=me,yj=Ke,Aj=Se,Bp=Lu,bj=Xc,wj=Au,Oj=_r,Nj=bu,_s=Object.assign,KR=Object.defineProperty,Dj=vj([].concat),Pj=!_s||Aj(function(){if(HR&&_s({b:1},_s(KR({},"a",{enumerable:!0,get:function(){KR(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(h){r[h]=h}),_s({},e)[i]!=7||Bp(_s({},r)).join("")!=o})?function(e,r){for(var i=Oj(e),o=arguments.length,h=1,p=bj.f,g=wj.f;o>h;)for(var C,A=Nj(arguments[h++]),x=p?Dj(Bp(A),p(A)):Bp(A),_e=x.length,cN=0;_e>cN;)C=x[cN++],HR&&!yj(g,A,C)||(i[C]=A[C]);return i}:_s,kj=Cn,Lj=XA,Mj=mo,Uj=Ke,xj=_r,Vj=function(e,r,i,o){try{return o?r(kj(i)[0],i[1]):r(i)}catch(h){Lj(e,"throw",h)}},Fj=JA,Bj=xu,jj=Lr,YR=Bu,Gj=Um,Wj=Mu,qR=Array,is=me,jp=2147483647,Hj=/[^\0-\u007E]/,LO=/[.\u3002\uFF0E\uFF61]/g,zR="Overflow: input needs wider integers to process",JR=RangeError,Kj=is(LO.exec),xs=Math.floor,Gp=String.fromCharCode,XR=is("".charCodeAt),MO=is([].join),qr=is([].push),Yj=is("".replace),qj=is("".split),zj=is("".toLowerCase),QR=function(e){return e+22+75*(e<26)},Jj=function(e,r,i){var o=0;for(e=i?xs(e/700):e>>1,e+=xs(e/r);e>455;)e=xs(e/35),o+=36;return xs(o+36*e/(e+38))},Xj=function(e){var r=[];e=function(IN){for(var t0=[],aH=0,pH=IN.length;aH<pH;){var SH=XR(IN,aH++);if(SH>=55296&&SH<=56319&&aH<pH){var vH=XR(IN,aH++);(64512&vH)==56320?qr(t0,((1023&SH)<<10)+(1023&vH)+65536):(qr(t0,SH),aH--)}else qr(t0,SH)}return t0}(e);var i,o,h=e.length,p=128,g=0,C=72;for(i=0;i<e.length;i++)(o=e[i])<128&&qr(r,Gp(o));var A=r.length,x=A;for(A&&qr(r,"-");x<h;){var _e=jp;for(i=0;i<e.length;i++)(o=e[i])>=p&&o<_e&&(_e=o);var cN=x+1;if(_e-p>xs((jp-g)/cN))throw JR(zR);for(g+=(_e-p)*cN,p=_e,i=0;i<e.length;i++){if((o=e[i])<p&&++g>jp)throw JR(zR);if(o==p){for(var dN=g,fN=36;;){var mN=fN<=C?1:fN>=C+26?26:fN-C;if(dN<mN)break;var EN=dN-mN,RN=36-mN;qr(r,Gp(QR(mN+EN%RN))),dN=xs(EN/RN),fN+=36}qr(r,Gp(QR(dN))),C=Jj(g,cN,x==A),g=0,x++}}g++,p++}return MO(r,"")},Qj=xt,ff=ri,Zj=rf,gf=We,ZR=mo,wi=me,Ld=go,ui=Uu,$j=Fm,WE=Je,Tf=Pj,Es=function(e){var r=xj(e),i=Bj(this),o=arguments.length,h=o>1?arguments[1]:void 0,p=h!==void 0;p&&(h=Mj(h,o>2?arguments[2]:void 0));var g,C,A,x,_e,cN,dN=Wj(r),fN=0;if(!dN||this===qR&&Fj(dN))for(g=jj(r),C=i?new this(g):qR(g);g>fN;fN++)cN=p?h(r[fN],fN):r[fN],YR(C,fN,cN);else for(_e=(x=Gj(r,dN)).next,C=i?new this:[];!(A=Uj(_e,x)).done;fN++)cN=p?Vj(x,h,[A.value,fN],!0):A.value,YR(C,fN,cN);return C.length=fN,C},Di=zm,tG=qm.codeAt,eG=function(e){var r,i,o=[],h=qj(Yj(zj(e),LO,"."),".");for(r=0;r<h.length;r++)i=h[r],qr(o,Kj(Hj,i)?"xn--"+Xj(i):i);return MO(o,".")},vr=oi,nG=To,iG=Vu,UO=yF,xO=ns,rG=xO.set,zl=xO.getterFor("URL"),oG=UO.URLSearchParams,sG=UO.getState,La=gf.URL,HE=gf.TypeError,Md=gf.parseInt,aG=Math.floor,$R=Math.pow,Ti=wi("".charAt),Li=wi(/./.exec),Ya=wi([].join),cG=wi(1 .toString),dG=wi([].pop),ms=wi([].push),Wp=wi("".replace),lG=wi([].shift),uG=wi("".split),qa=wi("".slice),Sl=wi("".toLowerCase),hG=wi([].unshift),Hp="Invalid scheme",vo="Invalid host",tC="Invalid port",VO=/[a-z]/i,pG=/[\d+-.a-z]/i,Kp=/\d/,_G=/^0x/i,EG=/^[0-7]+$/,mG=/^\d+$/,eC=/^[\da-f]+$/i,fG=/[\0\t\n\r #%/:<>?@[\\\]^|]/,gG=/[\0\t\n\r #/:<>?@[\\\]^|]/,TG=/^[\u0000-\u0020]+/,SG=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,RG=/[\t\n\r]/g,Ma=function(e){var r,i,o,h;if(typeof e=="number"){for(r=[],i=0;i<4;i++)hG(r,e%256),e=aG(e/256);return Ya(r,".")}if(typeof e=="object"){for(r="",o=function(p){for(var g=null,C=1,A=null,x=0,_e=0;_e<8;_e++)p[_e]!==0?(x>C&&(g=A,C=x),A=null,x=0):(A===null&&(A=_e),++x);return x>C&&(g=A,C=x),g}(e),i=0;i<8;i++)h&&e[i]===0||(h&&(h=!1),o===i?(r+=i?":":"::",h=!0):(r+=cG(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},Rl={},FO=Tf({},Rl,{" ":1,'"':1,"<":1,">":1,"`":1}),BO=Tf({},FO,{"#":1,"?":1,"{":1,"}":1}),Yp=Tf({},BO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Br=function(e,r){var i=tG(e,0);return i>32&&i<127&&!WE(r,e)?e:encodeURIComponent(e)},Ud={ftp:21,file:null,http:80,https:443,ws:80,wss:443},za=function(e,r){var i;return e.length==2&&Li(VO,Ti(e,0))&&((i=Ti(e,1))==":"||!r&&i=="|")},nC=function(e){var r;return e.length>1&&za(qa(e,0,2))&&(e.length==2||(r=Ti(e,2))==="/"||r==="\\"||r==="?"||r==="#")},CG=function(e){return e==="."||Sl(e)==="%2e"},qp={},iC={},zp={},rC={},oC={},Jp={},sC={},aC={},xd={},Vd={},Xp={},Qp={},Zp={},$p={},cC={},t_={},fs={},qi={},dC={},yo={},Sr={},Sf=function(e,r,i){var o,h,p,g=vr(e);if(r){if(h=this.parse(g))throw HE(h);this.searchParams=null}else{if(i!==void 0&&(o=new Sf(i,!0)),h=this.parse(g,null,o))throw HE(h);(p=sG(new oG)).bindURL(this),this.searchParams=p}};Sf.prototype={type:"URL",parse:function(e,r,i){var o,h,p,g,C,A=this,x=r||qp,_e=0,cN="",dN=!1,fN=!1,mN=!1;for(e=vr(e),r||(A.scheme="",A.username="",A.password="",A.host=null,A.port=null,A.path=[],A.query=null,A.fragment=null,A.cannotBeABaseURL=!1,e=Wp(e,TG,""),e=Wp(e,SG,"$1")),e=Wp(e,RG,""),o=Es(e);_e<=o.length;){switch(h=o[_e],x){case qp:if(!h||!Li(VO,h)){if(r)return Hp;x=zp;continue}cN+=Sl(h),x=iC;break;case iC:if(h&&(Li(pG,h)||h=="+"||h=="-"||h=="."))cN+=Sl(h);else{if(h!=":"){if(r)return Hp;cN="",x=zp,_e=0;continue}if(r&&(A.isSpecial()!=WE(Ud,cN)||cN=="file"&&(A.includesCredentials()||A.port!==null)||A.scheme=="file"&&!A.host))return;if(A.scheme=cN,r)return void(A.isSpecial()&&Ud[A.scheme]==A.port&&(A.port=null));cN="",A.scheme=="file"?x=$p:A.isSpecial()&&i&&i.scheme==A.scheme?x=rC:A.isSpecial()?x=aC:o[_e+1]=="/"?(x=oC,_e++):(A.cannotBeABaseURL=!0,ms(A.path,""),x=dC)}break;case zp:if(!i||i.cannotBeABaseURL&&h!="#")return Hp;if(i.cannotBeABaseURL&&h=="#"){A.scheme=i.scheme,A.path=Di(i.path),A.query=i.query,A.fragment="",A.cannotBeABaseURL=!0,x=Sr;break}x=i.scheme=="file"?$p:Jp;continue;case rC:if(h!="/"||o[_e+1]!="/"){x=Jp;continue}x=xd,_e++;break;case oC:if(h=="/"){x=Vd;break}x=qi;continue;case Jp:if(A.scheme=i.scheme,h==li)A.username=i.username,A.password=i.password,A.host=i.host,A.port=i.port,A.path=Di(i.path),A.query=i.query;else if(h=="/"||h=="\\"&&A.isSpecial())x=sC;else if(h=="?")A.username=i.username,A.password=i.password,A.host=i.host,A.port=i.port,A.path=Di(i.path),A.query="",x=yo;else{if(h!="#"){A.username=i.username,A.password=i.password,A.host=i.host,A.port=i.port,A.path=Di(i.path),A.path.length--,x=qi;continue}A.username=i.username,A.password=i.password,A.host=i.host,A.port=i.port,A.path=Di(i.path),A.query=i.query,A.fragment="",x=Sr}break;case sC:if(!A.isSpecial()||h!="/"&&h!="\\"){if(h!="/"){A.username=i.username,A.password=i.password,A.host=i.host,A.port=i.port,x=qi;continue}x=Vd}else x=xd;break;case aC:if(x=xd,h!="/"||Ti(cN,_e+1)!="/")continue;_e++;break;case xd:if(h!="/"&&h!="\\"){x=Vd;continue}break;case Vd:if(h=="@"){dN&&(cN="%40"+cN),dN=!0,p=Es(cN);for(var EN=0;EN<p.length;EN++){var RN=p[EN];if(RN!=":"||mN){var IN=Br(RN,Yp);mN?A.password+=IN:A.username+=IN}else mN=!0}cN=""}else if(h==li||h=="/"||h=="?"||h=="#"||h=="\\"&&A.isSpecial()){if(dN&&cN=="")return"Invalid authority";_e-=Es(cN).length+1,cN="",x=Xp}else cN+=h;break;case Xp:case Qp:if(r&&A.scheme=="file"){x=t_;continue}if(h!=":"||fN){if(h==li||h=="/"||h=="?"||h=="#"||h=="\\"&&A.isSpecial()){if(A.isSpecial()&&cN=="")return vo;if(r&&cN==""&&(A.includesCredentials()||A.port!==null))return;if(g=A.parseHost(cN))return g;if(cN="",x=fs,r)return;continue}h=="["?fN=!0:h=="]"&&(fN=!1),cN+=h}else{if(cN=="")return vo;if(g=A.parseHost(cN))return g;if(cN="",x=Zp,r==Qp)return}break;case Zp:if(!Li(Kp,h)){if(h==li||h=="/"||h=="?"||h=="#"||h=="\\"&&A.isSpecial()||r){if(cN!=""){var t0=Md(cN,10);if(t0>65535)return tC;A.port=A.isSpecial()&&t0===Ud[A.scheme]?null:t0,cN=""}if(r)return;x=fs;continue}return tC}cN+=h;break;case $p:if(A.scheme="file",h=="/"||h=="\\")x=cC;else{if(!i||i.scheme!="file"){x=qi;continue}if(h==li)A.host=i.host,A.path=Di(i.path),A.query=i.query;else if(h=="?")A.host=i.host,A.path=Di(i.path),A.query="",x=yo;else{if(h!="#"){nC(Ya(Di(o,_e),""))||(A.host=i.host,A.path=Di(i.path),A.shortenPath()),x=qi;continue}A.host=i.host,A.path=Di(i.path),A.query=i.query,A.fragment="",x=Sr}}break;case cC:if(h=="/"||h=="\\"){x=t_;break}i&&i.scheme=="file"&&!nC(Ya(Di(o,_e),""))&&(za(i.path[0],!0)?ms(A.path,i.path[0]):A.host=i.host),x=qi;continue;case t_:if(h==li||h=="/"||h=="\\"||h=="?"||h=="#"){if(!r&&za(cN))x=qi;else if(cN==""){if(A.host="",r)return;x=fs}else{if(g=A.parseHost(cN))return g;if(A.host=="localhost"&&(A.host=""),r)return;cN="",x=fs}continue}cN+=h;break;case fs:if(A.isSpecial()){if(x=qi,h!="/"&&h!="\\")continue}else if(r||h!="?")if(r||h!="#"){if(h!=li&&(x=qi,h!="/"))continue}else A.fragment="",x=Sr;else A.query="",x=yo;break;case qi:if(h==li||h=="/"||h=="\\"&&A.isSpecial()||!r&&(h=="?"||h=="#")){if((C=Sl(C=cN))===".."||C==="%2e."||C===".%2e"||C==="%2e%2e"?(A.shortenPath(),h=="/"||h=="\\"&&A.isSpecial()||ms(A.path,"")):CG(cN)?h=="/"||h=="\\"&&A.isSpecial()||ms(A.path,""):(A.scheme=="file"&&!A.path.length&&za(cN)&&(A.host&&(A.host=""),cN=Ti(cN,0)+":"),ms(A.path,cN)),cN="",A.scheme=="file"&&(h==li||h=="?"||h=="#"))for(;A.path.length>1&&A.path[0]==="";)lG(A.path);h=="?"?(A.query="",x=yo):h=="#"&&(A.fragment="",x=Sr)}else cN+=Br(h,BO);break;case dC:h=="?"?(A.query="",x=yo):h=="#"?(A.fragment="",x=Sr):h!=li&&(A.path[0]+=Br(h,Rl));break;case yo:r||h!="#"?h!=li&&(h=="'"&&A.isSpecial()?A.query+="%27":A.query+=h=="#"?"%23":Br(h,Rl)):(A.fragment="",x=Sr);break;case Sr:h!=li&&(A.fragment+=Br(h,FO))}_e++}},parseHost:function(e){var r,i,o;if(Ti(e,0)=="["){if(Ti(e,e.length-1)!="]"||(r=function(h){var p,g,C,A,x,_e,cN,dN=[0,0,0,0,0,0,0,0],fN=0,mN=null,EN=0,RN=function(){return Ti(h,EN)};if(RN()==":"){if(Ti(h,1)!=":")return;EN+=2,mN=++fN}for(;RN();){if(fN==8)return;if(RN()!=":"){for(p=g=0;g<4&&Li(eC,RN());)p=16*p+Md(RN(),16),EN++,g++;if(RN()=="."){if(g==0||(EN-=g,fN>6))return;for(C=0;RN();){if(A=null,C>0){if(!(RN()=="."&&C<4))return;EN++}if(!Li(Kp,RN()))return;for(;Li(Kp,RN());){if(x=Md(RN(),10),A===null)A=x;else{if(A==0)return;A=10*A+x}if(A>255)return;EN++}dN[fN]=256*dN[fN]+A,++C!=2&&C!=4||fN++}if(C!=4)return;break}if(RN()==":"){if(EN++,!RN())return}else if(RN())return;dN[fN++]=p}else{if(mN!==null)return;EN++,mN=++fN}}if(mN!==null)for(_e=fN-mN,fN=7;fN!=0&&_e>0;)cN=dN[fN],dN[fN--]=dN[mN+_e-1],dN[mN+--_e]=cN;else if(fN!=8)return;return dN}(qa(e,1,-1)),!r))return vo;this.host=r}else if(this.isSpecial()){if(e=eG(e),Li(fG,e)||(r=function(h){var p,g,C,A,x,_e,cN,dN=uG(h,".");if(dN.length&&dN[dN.length-1]==""&&dN.length--,(p=dN.length)>4)return h;for(g=[],C=0;C<p;C++){if((A=dN[C])=="")return h;if(x=10,A.length>1&&Ti(A,0)=="0"&&(x=Li(_G,A)?16:8,A=qa(A,x==8?1:2)),A==="")_e=0;else{if(!Li(x==10?mG:x==8?EG:eC,A))return h;_e=Md(A,x)}ms(g,_e)}for(C=0;C<p;C++)if(_e=g[C],C==p-1){if(_e>=$R(256,5-p))return null}else if(_e>255)return null;for(cN=dG(g),C=0;C<g.length;C++)cN+=g[C]*$R(256,3-C);return cN}(e),r===null))return vo;this.host=r}else{if(Li(gG,e))return vo;for(r="",i=Es(e),o=0;o<i.length;o++)r+=Br(i[o],Rl);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return WE(Ud,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&za(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,h=e.host,p=e.port,g=e.path,C=e.query,A=e.fragment,x=r+":";return h!==null?(x+="//",e.includesCredentials()&&(x+=i+(o?":"+o:"")+"@"),x+=Ma(h),p!==null&&(x+=":"+p)):r=="file"&&(x+="//"),x+=e.cannotBeABaseURL?g[0]:g.length?"/"+Ya(g,"/"):"",C!==null&&(x+="?"+C),A!==null&&(x+="#"+A),x},setHref:function(e){var r=this.parse(e);if(r)throw HE(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new ea(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+Ma(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(vr(e)+":",qp)},getUsername:function(){return this.username},setUsername:function(e){var r=Es(vr(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Br(r[i],Yp)}},getPassword:function(){return this.password},setPassword:function(e){var r=Es(vr(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Br(r[i],Yp)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?Ma(e):Ma(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Xp)},getHostname:function(){var e=this.host;return e===null?"":Ma(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Qp)},getPort:function(){var e=this.port;return e===null?"":vr(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=vr(e))==""?this.port=null:this.parse(e,Zp))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Ya(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,fs))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=vr(e))==""?this.query=null:(Ti(e,0)=="?"&&(e=qa(e,1)),this.query="",this.parse(e,yo)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=vr(e))!=""?(Ti(e,0)=="#"&&(e=qa(e,1)),this.fragment="",this.parse(e,Sr)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var ea=function(e){var r=$j(this,yn),i=iG(arguments.length,1)>1?arguments[1]:void 0,o=rG(r,new Sf(e,!1,i));ff||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},yn=ea.prototype,hi=function(e,r){return{get:function(){return zl(this)[e]()},set:r&&function(i){return zl(this)[r](i)},configurable:!0,enumerable:!0}};ff&&(ui(yn,"href",hi("serialize","setHref")),ui(yn,"origin",hi("getOrigin")),ui(yn,"protocol",hi("getProtocol","setProtocol")),ui(yn,"username",hi("getUsername","setUsername")),ui(yn,"password",hi("getPassword","setPassword")),ui(yn,"host",hi("getHost","setHost")),ui(yn,"hostname",hi("getHostname","setHostname")),ui(yn,"port",hi("getPort","setPort")),ui(yn,"pathname",hi("getPathname","setPathname")),ui(yn,"search",hi("getSearch","setSearch")),ui(yn,"searchParams",hi("getSearchParams")),ui(yn,"hash",hi("getHash","setHash"))),Ld(yn,"toJSON",function(){return zl(this).serialize()},{enumerable:!0}),Ld(yn,"toString",function(){return zl(this).serialize()},{enumerable:!0}),La&&(e_=La.createObjectURL,n_=La.revokeObjectURL,e_&&Ld(ea,"createObjectURL",ZR(e_,La)),n_&&Ld(ea,"revokeObjectURL",ZR(n_,La)));var e_,n_;nG(ea,"URL"),Qj({global:!0,constructor:!0,forced:!Zj,sham:!ff},{URL:ea});var IG=xt,vG=Se,yG=Vu,lC=oi,AG=rf,uC=Dn("URL");IG({target:"URL",stat:!0,forced:!(AG&&vG(function(){uC.canParse()}))},{canParse:function(e){var r=yG(arguments.length,1),i=lC(e),o=r<2||arguments[1]===void 0?void 0:lC(arguments[1]);try{return!!new uC(i,o)}catch{return!1}}});var hC=ae(Gi.URL),Ne={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ft(){return Ne}function jO(){return"setSinkId"in HTMLAudioElement.prototype&&(!v("RESTRICTION_SET_PLAYBACK_DEVICE")||(oo()||_O())&&!lf())}function pC(){return!Ne.supportUnifiedPlan||v("CHROME_FORCE_PLAN_B")&&ho()}var ke=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function gs(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function _t(e,r,i,o,h){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:h}}function pi(e,r,i,o,h){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:h}}function i_(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}var bG={"90p":_t(160,90),"90p_1":_t(160,90),"120p":_t(160,120,15,30,65),"120p_1":_t(160,120,15,30,65),"120p_3":_t(120,120,15,30,50),"120p_4":_t(212,120),"180p":_t(320,180,15,30,140),"180p_1":_t(320,180,15,30,140),"180p_3":_t(180,180,15,30,100),"180p_4":_t(240,180,15,30,120),"240p":_t(320,240,15,40,200),"240p_1":_t(320,240,15,40,200),"240p_3":_t(240,240,15,40,140),"240p_4":_t(424,240,15,40,220),"360p":_t(640,360,15,80,400),"360p_1":_t(640,360,15,80,400),"360p_3":_t(360,360,15,80,260),"360p_4":_t(640,360,30,80,600),"360p_6":_t(360,360,30,80,400),"360p_7":_t(480,360,15,80,320),"360p_8":_t(480,360,30,80,490),"360p_9":_t(640,360,15,80,800),"360p_10":_t(640,360,24,80,800),"360p_11":_t(640,360,24,80,1e3),"480p":_t(640,480,15,100,500),"480p_1":_t(640,480,15,100,500),"480p_2":_t(640,480,30,100,1e3),"480p_3":_t(480,480,15,100,400),"480p_4":_t(640,480,30,100,750),"480p_6":_t(480,480,30,100,600),"480p_8":_t(848,480,15,100,610),"480p_9":_t(848,480,30,100,930),"480p_10":_t(640,480,10,100,400),"720p":_t(1280,720,15,120,1130),"720p_auto":_t(1280,720,30,900,3e3),"720p_1":_t(1280,720,15,120,1130),"720p_2":_t(1280,720,30,120,2e3),"720p_3":_t(1280,720,30,120,1710),"720p_5":_t(960,720,15,120,910),"720p_6":_t(960,720,30,120,1380),"1080p":_t(1920,1080,15,120,2080),"1080p_1":_t(1920,1080,15,120,2080),"1080p_2":_t(1920,1080,30,120,3e3),"1080p_3":_t(1920,1080,30,120,3150),"1080p_5":_t(1920,1080,60,120,4780),"1440p":_t(2560,1440,30,120,4850),"1440p_1":_t(2560,1440,30,120,4850),"1440p_2":_t(2560,1440,60,120,7350),"4k":_t(3840,2160,30,120,8910),"4k_1":_t(3840,2160,30,120,8910),"4k_3":_t(3840,2160,60,120,13500)},wG={"480p":pi(640,480,5),"480p_1":pi(640,480,5),"480p_2":pi(640,480,30),"480p_3":pi(640,480,15),"720p":pi(1280,720,5),"720p_auto":_t(1280,720,30,900,3e3),"720p_1":pi(1280,720,5),"720p_2":pi(1280,720,30),"720p_3":pi(1280,720,15),"1080p":pi(1920,1080,5),"1080p_1":pi(1920,1080,5),"1080p_2":pi(1920,1080,30),"1080p_3":pi(1920,1080,15)},OG={"1SL1TL":i_(1,1),"3SL3TL":i_(3,3),"2SL3TL":i_(2,3)};function cr(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},bG[e]):e}function r_(e){return typeof e=="string"?Object.assign({},wG[e]):e}function Fd(e){return typeof e=="string"?Object.assign({},OG[e]):e}var NG={speech_low_quality:gs(16e3,!1),speech_standard:gs(32e3,!1,18),music_standard:gs(48e3,!1),standard_stereo:gs(48e3,!0,56),high_quality:gs(48e3,!1,128),high_quality_stereo:gs(48e3,!0,192)};function Jl(e){return typeof e=="string"?Object.assign({},NG[e]):e}var As=[];function _C(e){return Ce(e,"mediaSource",["screen","window","application"]),!0}var H=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Gt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),na=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),DG=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),PG=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Ko=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),ma=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ws=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),fa=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),jn=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});var KE={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YE={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},GO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},kG={uplinkNetworkQuality:0,downlinkNetworkQuality:0},WO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},un=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Wn=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Ua=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Bo=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),nn=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),zi=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),o_={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},Cl=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Et(e,r,i,o,h){var p,g,C={};return Object.keys(o).forEach(function(A){C[A]=o[A]}),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=ji(p=mj(g=i.slice()).call(g)).call(p,function(A,x){return x(e,r,A)||A},C),h&&C.initializer!==void 0&&(C.value=C.initializer?C.initializer.call(h):void 0,C.initializer=void 0),C.initializer===void 0&&(Object.defineProperty(e,r,C),C=null),C}function P(e,r,i){return(r=function(o){var h=function(p,g){if(typeof p!="object"||!p)return p;var C=p[Symbol.toPrimitive];if(C!==void 0){var A=C.call(p,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(p)}(o);return typeof h=="symbol"?h:h+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function EC(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Kt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?EC(Object(i),!0).forEach(function(o){P(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):EC(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Xl=class extends Xt{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Ko.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,r){super(),P(this,"trackMediaType",void 0),P(this,"_ID",void 0),P(this,"_rtpTransceiver",void 0),P(this,"_lowRtpTransceiver",void 0),P(this,"_hints",[]),P(this,"_isClosed",!1),P(this,"_originMediaStreamTrack",void 0),P(this,"mediaStreamTrack",void 0),P(this,"_external",{}),this._ID=r||Ut(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){W(As).call(As,i)||As.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||po(()=>{var r;X.reportApiInvoke(null,{name:Te.GET_MEDIA_STREAM_TRACK,options:[],tag:Zt.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===na.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let r=As.indexOf(e);r!==-1&&As.splice(r,1)}(this),this.emit(ma.CLOSED),this.removeAllListeners(Ko.SEI_RECEIVED)}_updateRtpTransceiver(e,r){if(r===na.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Ko.TRANSCEIVER_UPDATED,e,r)}},no=class extends Xl{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,r){super(e,r),P(this,"_enabled",!0),P(this,"_muted",!1),P(this,"_isExternalTrack",!1),P(this,"_isClosed",!1),P(this,"_enabledMutex",void 0),P(this,"processor",void 0),P(this,"_processorContext",void 0),P(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ze("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,r;return(e=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,_.debug("[".concat(this.getTrackId(),"] close")),this.emit(H.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){_.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ma.TRACK_ENDED)}stateCheck(e,r){if(_.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(r,"]")),Nr(r,e),this._enabled&&this._muted&&e==="enabled"&&r===!1)throw new N(R.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",_);if(!this._enabled&&!this._muted&&e==="muted"&&r===!0)throw new N(R.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",_)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():j.resolve([])}},mC=window.AudioContext||window.webkitAudioContext,Mn=null,wt=new class extends Xt{constructor(){super(...arguments),P(this,"prevState",void 0),P(this,"curState",void 0),P(this,"currentTime",void 0),P(this,"currentTimeStuckAt",void 0),P(this,"interruptDetectorTrack",void 0),P(this,"onLocalAudioTrackMute",()=>{_.info("ios15-interruption-start"),this.emit(ke.IOS_15_16_INTERRUPTION_START)}),P(this,"onLocalAudioTrackUnmute",async()=>{_.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?_.info("ios15-interruption-end-canceled"):(Mn&&await Mn.suspend(),this.emit(ke.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){_.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){_.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function ga(){if(!Mn){if(function(){if(!mC)return void _.error("your browser is not support web audio");_.info("create audio context");let e=Kt({},v("WEBAUDIO_INIT_OPTIONS"));_.debug("audio context init option:",JSON.stringify(e)),Mn=new mC(e),wt.curState=Mn.state,Mn.onstatechange=()=>{wt.prevState=wt.curState,wt.curState=Mn?Mn.state:void 0;let{prevState:r,curState:i}=wt,o=i==="running",h=i==="interrupted",p=r==="running",g=r==="suspended",C=r==="interrupted",A=mt().osVersion;(ln()||vi())&&p&&h&&(_.info("ios".concat(A,"-interruption-start")),wt.emit(ke.IOS_INTERRUPTION_START)),(ln()||vi())&&(g||C)&&o&&(_.info("ios".concat(A,"-interruption-end")),wt.emit(ke.IOS_INTERRUPTION_END)),r!==i&&wt.emit(ke.STATE_CHANGE,i,r)},setInterval(()=>{var r;let i=(r=Mn)===null||r===void 0?void 0:r.currentTime;wt.currentTime!==i?(wt.currentTimeStuckAt&&(_.debug("AudioContext current time resume at ".concat(i)),wt.currentTimeStuckAt=void 0),wt.currentTime=i):(i!==wt.currentTimeStuckAt&&(X.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Zt.TRACER}).onSuccess(),_.warning("AudioContext current time stuck at ".concat(i))),wt.currentTimeStuckAt=i)},5e3),async function(r){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],o,h=!1,p=!1,g=!1;function C(EN){r.state==="running"?A(!1):ln()||vi()?r.state==="suspended"&&(A(!0),EN&&r.resume().then(x,x)):r.state!=="closed"&&(A(!0),EN&&r.resume().then(x,x))}function A(EN){if(h!==EN){h=EN;for(let RN=0,IN=i;RN<IN.length;RN+=1){let t0=IN[RN];EN?window.addEventListener(t0,_e,{capture:!0,passive:!0}):window.removeEventListener(t0,_e,{capture:!0,passive:!0})}}}function x(){C(!1)}function _e(){C(!0)}function cN(EN){if(!g)if(o.paused)if(EN){let RN;dN(!1),g=!0;try{RN=o.play(),RN?RN.then(fN,fN):(o.addEventListener("playing",fN),o.addEventListener("abort",fN),o.addEventListener("error",fN))}catch{fN()}}else dN(!0);else dN(!1)}function dN(EN){if(p!==EN){p=EN;for(let RN=0,IN=i;RN<IN.length;RN++){let t0=IN[RN];EN?window.addEventListener(t0,mN,{capture:!0,passive:!0}):window.removeEventListener(t0,mN,{capture:!0,passive:!0})}}}function fN(){o.removeEventListener("playing",fN),o.removeEventListener("abort",fN),o.removeEventListener("error",fN),g=!1,cN(!1)}function mN(){cN(!0)}if(ln()){let EN=r.createMediaStreamDestination(),RN=document.createElement("div");RN.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=RN.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=EN.stream,cN(!0)}wt.on(ke.STATE_CHANGE,function(){C(!0)}),C(!1)}(Mn)}(),!Mn)throw new N(R.NOT_SUPPORTED,"can not create audio context");return Mn}return Mn}function No(e){if(function(){if(s_!==null)return s_;let o=ga(),h=o.createBufferSource(),p=o.createGain(),g=o.createGain();h.connect(p),h.connect(g),h.disconnect(p);let C=!1;try{h.disconnect(p)}catch{C=!0}return h.disconnect(),s_=C,C}())return;let r=e.connect,i=e.disconnect;e.connect=(o,h,p)=>{var g;return e._inputNodes||(e._inputNodes=[]),W(g=e._inputNodes).call(g,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,h,p)):r.call(e,o,h)),e},e.disconnect=(o,h,p)=>{i.call(e),o?Wl(e._inputNodes,o):e._inputNodes=[];for(let g of e._inputNodes)r.call(e,g)}}var s_=null;function Rf(e,r){let i=!1,o=1/r;if(v("DISABLE_WEBAUDIO")){let h=window.setInterval(()=>{i?window.clearInterval(h):e(performance.now()/1e3)},1e3*o)}else{let h=ga(),p=h.createGain();p.gain.value=0,p.connect(h.destination);let g=()=>{if(i)return void(p=null);let C=h.createOscillator();C.onended=g,C.connect(p),C.start(0),C.stop(h.currentTime+o),e(h.currentTime)};g()}return()=>{i=!0}}var Ql=class{constructor(){P(this,"context",void 0),P(this,"analyserNode",void 0),P(this,"sourceNode",void 0),this.context=ga(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ln()||vi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<e.length;++o)e[o]=i[o]/128-1}let r=ji(e).call(e,(i,o)=>i+o*o,0)/e.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,r;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{_.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},Zl=class extends Xt{get processSourceNode(){return this.sourceNode}set processedNode(e){var r;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),P(this,"outputNode",void 0),P(this,"outputTrack",void 0),P(this,"isPlayed",!1),P(this,"sourceNode",void 0),P(this,"context",void 0),P(this,"audioBufferNode",void 0),P(this,"destNode",void 0),P(this,"audioOutputLevel",0),P(this,"volumeLevelAnalyser",void 0),P(this,"_processedNode",void 0),P(this,"playNode",void 0),P(this,"isDestroyed",!1),P(this,"onNoAudioInput",void 0),P(this,"isNoAudioInput",!1),P(this,"_noAudioInputCount",0),this.context=ga(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),No(this.outputNode),this.volumeLevelAnalyser=new Ql}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(jn.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){let h=i.outputBuffer.getChannelData(o);for(let p=0;p<h.length;p+=1)h[p]=0}return i.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ft().webAudioMediaStreamDest)throw new N(R.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&qu(()=>{wt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ln()||vi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode(),i;r.getFloatTimeDomainData?(i=new Float32Array(r.fftSize),r.getFloatTimeDomainData(i)):(i=new Uint8Array(r.fftSize),r.getByteTimeDomainData(i));let o=!1;for(let h=0;h<i.length;h++)i[h]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Me(200),await this.checkHasAudioInput(e?e+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,r;(e=this.processedNode)===null||e===void 0||e.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},$l=class extends Zl{get isFreeze(){return!1}constructor(e,r,i){var o;if(super(),P(this,"sourceNode",void 0),P(this,"track",void 0),P(this,"clonedTrack",void 0),P(this,"audioElement",void 0),P(this,"isCurrentTrackCloned",!1),P(this,"isRemoteTrack",!1),P(this,"originVolumeLevelAnalyser",void 0),P(this,"rebuildWebAudio",async()=>{if(_.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void _.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>_.info("resume success")),_.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let g=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?g.stop():this.isCurrentTrackCloned=!0;let C=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(C),No(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let A=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(A,this.context.currentTime),No(this.outputNode),this.emit(jn.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=C,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new N(R.UNEXPECTED_ERROR);this.track=e;let h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),No(this.sourceNode),i){let g=i.clone();g.enabled=!0,this.clonedTrack=g,_.debug("create an unmuted track ".concat(g.id," from the original track ").concat(i.id," to get the volume"));let C=this.context.createMediaStreamSource(new MediaStream([g]));No(C),this.originVolumeLevelAnalyser=new Ql,this.originVolumeLevelAnalyser.updateSource(C)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;let p=mt();r&&p.os===ye.IOS&&Number((o=p.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(wt.on(ke.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(g=>{g||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let r=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(r),No(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(jn.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),wt.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let r=e.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),_.debug("create an unmuted track ".concat(r.id," from the original track ").concat(e.id," to get the volume"));let i=this.context.createMediaStreamSource(new MediaStream([r]));No(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function HO(e,r,i){let o=(p,g)=>p?typeof p!="number"?p.max||p.exact||p.ideal||p.min||g:p:g,h={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(h.video.mandatory.maxFrameRate=r.frameRate.max,h.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(h.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(h)}async function LG(e,r){let i=await KO(e.mediaSource),{sourceId:o,audio:h}=await function(p){let g=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new j((C,A)=>{let x=document.createElement("div");x.innerText="share screen",x.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let _e=document.createElement("div");_e.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let cN=document.createElement("div");cN.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",cN.setAttribute("style","height: 12%;");let dN=document.createElement("div");dN.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let fN=document.createElement("div");fN.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let mN=document.createElement("button");mN.innerHTML="cancel",mN.setAttribute("style","width: 85px;"),mN.onclick=()=>{document.body.removeChild(IN);let t0=new Error("NotAllowedError");t0.name="NotAllowedError",A(t0)};let EN=g,RN=document.createElement("div");if(g){let t0=document.createElement("input");t0.setAttribute("type","checkbox");let aH=document.createElement("span");t0.setAttribute("style","margin-right: 6px;"),aH.innerText="Share audio",t0.checked=EN,t0.onchange=()=>{EN=t0.checked},RN.appendChild(t0),RN.appendChild(aH)}fN.appendChild(RN),fN.appendChild(mN),_e.appendChild(cN),_e.appendChild(dN),_e.appendChild(fN);let IN=document.createElement("div");IN.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),IN.appendChild(x),IN.appendChild(_e),document.body.appendChild(IN),p.map(t0=>{if(t0.id){let aH=document.createElement("div");aH.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let pH=t0.thumbnail;try{let{width:SH}=pH.getSize();SH>1920&&(pH=pH.resize({width:1920}))}catch(SH){throw SH&&SH.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),SH}aH.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+pH.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t0.name.replace(/[\u00A0-\u9999<>\&]/g,function(SH){return"&#"+SH.charCodeAt(0)+";"})+"</span>",aH.onclick=()=>{document.body.removeChild(IN),C({sourceId:t0.id,audio:EN})},dN.appendChild(aH)}})})}(i,r);return await HO(o,e,h)}async function KO(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);let i=IO();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new N(R.ELECTRON_IS_NULL);let o=null;try{var h;o=((h=i.desktopCapturer)===null||h===void 0?void 0:h.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new j((p,g)=>{i.desktopCapturer.getSources({types:r},(C,A)=>{C?g(C):p(A)})}));try{return await o}catch(p){throw new N(R.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,p.toString())}}var qE=new ze("safari"),YO=!1,qO=!1;async function Fn(e,r){let i=0,o=null;for(;i<2;)try{o=await MG(e,r,i>0);break}catch(h){if(h instanceof N)throw _.error("[".concat(r,"] ").concat(h.toString())),h;let p=Il(h.name||h.code||h,h.message);if(p.code===R.MEDIA_OPTION_INVALID){_.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await Me(500);continue}throw _.error("[".concat(r,"] ").concat(p.toString())),p}if(!o)throw new N(R.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function MG(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new N(R.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let o=ft(),h=new MediaStream;if(e.audioSource&&h.addTrack(e.audioSource),e.videoSource&&h.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return _.debug("Using Video Source/ Audio Source"),h;if(e.screen)if(IO())e.screen.sourceId?Ts(h,await HO(e.screen.sourceId,e.screen,e.screenAudio)):Ts(h,await LG(e.screen,e.screenAudio));else if(oo()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new N(R.NOT_SUPPORTED,"This browser does not support screen sharing");_.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));let dN=await(g=e.screen.extensionId,C=r,new j((fN,mN)=>{try{chrome.runtime.sendMessage(g,{getStream:!0},EN=>{if(!EN||!EN.streamId)return _.error("[".concat(C,"] No response from Chrome Plugin. Plugin not installed properly"),EN),void mN(new N(R.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));fN(EN.streamId)})}catch(EN){_.error("[".concat(C,"] AgoraRTC screensharing plugin is not accessible(").concat(g,")"),EN.toString()),mN(new N(R.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=dN,Ts(h,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var p;e.screen.mediaSource&&_C(e.screen.mediaSource);let dN={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(p=e.screen.displaySurface)!==null&&p!==void 0?p:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:fN,surfaceSwitching:mN,systemAudio:EN}=e.screen,RN={selfBrowserSurface:fN,surfaceSwitching:mN,systemAudio:EN};!fN&&delete RN.selfBrowserSurface,!mN&&delete RN.surfaceSwitching,!EN&&delete RN.systemAudio,_.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:dN,audio:!!e.screenAudio,controls:RN})),Ts(h,await navigator.mediaDevices.getDisplayMedia(Kt({video:dN,audio:!!e.screenAudio},RN)))}else{if(!$t())throw _.error("[".concat(r,"] This browser does not support screenSharing")),new N(R.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&_C(e.screen.mediaSource);let dN={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};_.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(dN))),Ts(h,await navigator.mediaDevices.getUserMedia(dN))}}var g,C;if(!e.video&&!e.audio)return h;let A={video:e.video,audio:e.audio},x=v("MEDIA_DEVICE_CONSTRAINTS");if(x)try{typeof x=="string"&&(x=JSON.parse(x)),A=kE(A,x)}catch{}_.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(A)),mt();let _e,cN=null;(je()||ln()||Gl())&&(cN=await qE.lock());try{_e=await navigator.mediaDevices.getUserMedia(A)}catch(dN){throw cN&&cN(),dN}return A.audio&&(YO=!0),A.video&&(qO=!0),Ts(h,_e),cN&&cN(),h}function Il(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new N(R.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new N(R.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new N(R.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new N(R.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new N(R.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new N(R.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return _.error("getUserMedia unexpected error",e),new N(R.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function Ts(e,r){let i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],h=r.getVideoTracks()[0],p=r.getAudioTracks()[0];p&&(o&&e.removeTrack(o),e.addTrack(p)),h&&(i&&e.removeTrack(i),e.addTrack(h))}var Gn=new class extends Xt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Bo.STATE_CHANGE,e),this._state=e)}constructor(){super(),P(this,"_state",Ua.IDLE),P(this,"isAccessMicrophonePermission",!1),P(this,"isAccessCameraPermission",!1),P(this,"lastAccessMicrophonePermission",!1),P(this,"lastAccessCameraPermission",!1),P(this,"checkdeviceMatched",!1),P(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(v("ENUMERATE_DEVICES_INTERVAL")||(Ku()||Hu()===ye.HARMONY_OS)&&ho())&&this.updateDevicesInfo()},v("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>_.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new N(R.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let o=await navigator.mediaDevices.enumerateDevices(),h=this.checkMediaDeviceInfoIsOk(o),p=!this.isAccessMicrophonePermission&&e,g=!this.isAccessCameraPermission&&r;h.audio&&(p=!1),h.video&&(g=!1);let C=null,A=null,x=null;if(!i&&(p||g)){if(qE.isLocked&&(_.debug("[device manager] wait GUM lock"),(await qE.lock())(),_.debug("[device manager] GUM unlock")),YO&&(p=!1,this.isAccessMicrophonePermission=!0),qO&&(g=!1,this.isAccessCameraPermission=!0),_.debug("[device manager] check media device permissions",e,r,p,g),p&&g){try{x=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_e){let cN=Il(_e.name||_e.code||_e,_e.message);if(cN.code===R.PERMISSION_DENIED)throw cN;_.warning("getUserMedia failed in getDevices",cN)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(p){try{C=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_e){let cN=Il(_e.name||_e.code||_e,_e.message);if(cN.code===R.PERMISSION_DENIED)throw cN;_.warning("getUserMedia failed in getDevices",cN)}this.isAccessMicrophonePermission=!0}else if(g){try{A=await navigator.mediaDevices.getUserMedia({video:r})}catch(_e){let cN=Il(_e.name||_e.code||_e,_e.message);if(cN.code===R.PERMISSION_DENIED)throw cN;_.warning("getUserMedia failed in getDevices",cN)}this.isAccessCameraPermission=!0}_.debug("[device manager] mic permission",e,"cam permission",r)}try{let _e=await navigator.mediaDevices.enumerateDevices();return C&&C.getTracks().forEach(cN=>cN.stop()),A&&A.getTracks().forEach(cN=>cN.stop()),x&&x.getTracks().forEach(cN=>cN.stop()),C=null,A=null,x=null,_e}catch(_e){return C&&C.getTracks().forEach(cN=>cN.stop()),A&&A.getTracks().forEach(cN=>cN.stop()),x&&x.getTracks().forEach(cN=>cN.stop()),C=null,A=null,x=null,new N(R.ENUMERATE_DEVICES_FAILED,_e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){let r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new N(R.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=Ua.INITING;try{await this.updateDevicesInfo(),this.state=Ua.INITEND}catch(e){throw _.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Ua.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new N(R.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let h=e.find(g=>g.kind==="audioinput"&&g.deviceId==="default"),p=e.find(g=>g.kind==="audiooutput"&&g.deviceId==="default");h&&p?p.groupId===h.groupId?_.debug("[device-check] default input ".concat(h.label," and output ").concat(p.label," is the same group")):_.warning("[device-check] default input ".concat(h.label," and output ").concat(p.label," is not the same group")):_.debug("[device-check] default input or output not found")}let o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(h=>{if(!h.deviceId)return;let p=this.deviceInfoMap.get("".concat(h.kind,"_").concat(h.deviceId));if((p?p.state:"INACTIVE")!=="ACTIVE"){let g={initAt:r,updateAt:r,device:h,state:"ACTIVE"};this.deviceInfoMap.set("".concat(h.kind,"_").concat(h.deviceId),g),i.push(g)}p&&(p.updateAt=r)}),this.deviceInfoMap.forEach((h,p)=>{h.state==="ACTIVE"&&h.updateAt!==r&&(h.state="INACTIVE",i.push(h))}),this.state!==Ua.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bo.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Bo.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bo.PLAYOUT_DEVICE_CHANGED,h)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let r=e.filter(h=>h.kind==="audioinput"),i=e.filter(h=>h.kind==="videoinput"),o={audio:!1,video:!1};for(let h of r)if(h.label&&h.deviceId){o.audio=!0;break}for(let h of i)if(h.label&&h.deviceId){o.video=!0;break}return o}},a_=!1,Un=new class extends Xt{constructor(){super(...arguments),P(this,"onAutoplayFailed",void 0),P(this,"onAudioAutoplayFailed",void 0)}};function zO(){if(mt(),!a_){let e=r=>{r.preventDefault(),a_=!1,yc()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};a_=!0,yc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),_.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Un.onAutoplayFailed?Un.onAutoplayFailed():Un.onAudioAutoplayFailed?_.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):_.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Un.emit("autoplay-failed")}}function JO(e,r,i,o){if(!e)return;let h=X.getBaseInfoBySessionId(e);if(!h)return;let p=h.info,g=Date.now(),C=Kt(Kt({},p),{},{vid:p.vid===void 0?0:Number(p.vid),lts:g,elapse:g-h.startTime,cbRegistered:Un.onAutoplayFailed||Un.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});X.send({type:Jt.AUTOPLAY_FAILED,data:C},!0)}var UG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],En=new class{constructor(){P(this,"onAutoplayFailed",void 0),P(this,"elementMap",new Map),P(this,"elementStateMap",new Map),P(this,"elementsNeedToResume",[]),P(this,"sinkIdMap",new Map),P(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r,h=this.elementStateMap.get(i),p=o.srcObject.getAudioTracks()[0],g=p&&p.readyState;if(_.debug("resume after interrupted, ele: ".concat(h," audio: ").concat(g," ").concat(e)),g==="live"){if(e)return o.pause(),void o.play();if(wt.curState==="running")return Zs()?(o.pause(),void o.play()):void(h&&h==="paused"&&o.play())}})}),P(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e,o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(_.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),wt.on(ke.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(ke.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),wt.on(ke.STATE_CHANGE,()=>{ln()&&wt.prevState==="suspended"&&wt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new N(R.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;let h=document.createElement("audio");h.autoplay=!0,h.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,h),this.elementMap.set(r,h),this.elementStateMap.set(r,nn.INIT),this.setVolume(r,i);let p=this.sinkIdMap.get(r);if(p)try{h.setSinkId(p).catch(C=>{_.warning("[".concat(r,"] set sink id failed"),C.toString())})}catch(C){_.warning("[".concat(r,"] set sink id failed"),C.toString())}let g=h.play();g&&g.then&&g.catch(C=>{o&&JO(o,"audio",C.message,r),_.warning("audio element play warning",C.toString()),this.elementMap.has(r)&&C.name==="NotAllowedError"&&(_.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(h),qu(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),zO()}))})}updateTrack(e,r){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){let i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){let r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;let i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){UG.forEach(i=>{r.addEventListener(i,o=>{let h=this.elementStateMap.get(e),p=o.type==="pause"?"paused":o.type;if(_.debug("[".concat(e,"] audio-element-status change ").concat(h," => ").concat(p)),o.type==="error"){let g=r==null?void 0:r.error;g&&_.error("[".concat(e,"] media error, code: ").concat(g.code,", message: ").concat(g.message))}this.elementStateMap.set(e,p)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{_.debug("Auto resume audio element success")}).catch(i=>{_.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new j(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{yc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function se(){return function(e,r,i){let o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new N(R.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",_);for(var h=arguments.length,p=new Array(h),g=0;g<h;g++)p[g]=arguments[g];let C=o.apply(this,p);return C instanceof j?new j((A,x)=>{C.then(A).catch(x)}):C}),i}}var tu=class extends Xt{constructor(e){super(),P(this,"name","VideoProcessorDestination"),P(this,"ID","0"),P(this,"_source",void 0),P(this,"videoContext",void 0),P(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new N(R.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new N(R.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(un.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(un.ON_TRACK,void 0)}},eu=class extends Xt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,r){super(),P(this,"constraintsMap",new Map),P(this,"statsRegistry",[]),P(this,"usageRegistry",[]),P(this,"trackId",void 0),P(this,"direction",void 0),P(this,"_chained",!1),this.trackId=e,this.direction=r}async getConstraints(){return await Ge(this,Wn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,r){var i;return _.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(r,e),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var r;if(this.constraintsMap.has(e))return _.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(r=this.constraintsMap).call(r)))}registerStats(e,r,i){this.statsRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===r)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:r,cb:i})}unregisterStats(e,r){let i=this.statsRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===r);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let e=[];for(let{processorID:r,processorName:i,type:o,cb:h}of this.statsRegistry)try{let p=h();e.push({processorID:r,processorName:i,type:o,stats:p})}catch(p){_.error(new N(R.UNEXPECTED_ERROR,p.message))}return e}registerUsage(e,r){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:r})}unregisterUsage(e){let r=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let i=r();i instanceof j&&(i=await i),e.push(Kt(Kt({},i),{},{direction:this.direction}))}catch(i){_.error("gather extension usage error",i)}return e}getDirection(){return this.direction}},nu=class extends Xt{constructor(e){super(),P(this,"name","AudioProcessorDestination"),P(this,"ID","0"),P(this,"inputTrack",void 0),P(this,"inputNode",void 0),P(this,"audioProcessorContext",void 0),P(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new N(R.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new N(R.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(un.ON_TRACK,void 0),this.emit(un.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(un.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(un.ON_NODE,this.inputNode))}},iu=class extends Xt{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,r,i){super(),P(this,"constraintsMap",new Map),P(this,"statsRegistry",[]),P(this,"audioContext",void 0),P(this,"trackId",void 0),P(this,"direction",void 0),P(this,"usageRegistry",[]),P(this,"_chained",!1),this.audioContext=e,this.trackId=r,this.direction=i}async getConstraints(){return Ge(this,Wn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,r){var i;return _.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(r,e),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var r;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(r=this.constraintsMap).call(r)))}registerStats(e,r,i){this.statsRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===r)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:r,cb:i})}unregisterStats(e,r){let i=this.statsRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===r);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){let e=[];for(let{processorID:r,processorName:i,type:o,cb:h}of this.statsRegistry)try{let p=h();e.push({processorID:r,processorName:i,type:o,stats:p})}catch(p){_.error(new N(R.UNEXPECTED_ERROR,p.message))}return e}registerUsage(e,r){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:r})}unregisterUsage(e){let r=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let i=r();i instanceof j&&(i=await i),e.push(Kt(Kt({},i),{},{direction:this.direction}))}catch(i){_.error("gather extension usage error",i)}return e}getDirection(){return this.direction}},Pc=class extends Xt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),P(this,"context",void 0),P(this,"processSourceNode",void 0),P(this,"outputTrack",void 0),P(this,"processedNode",void 0),P(this,"clonedTrack",void 0),P(this,"outputNode",void 0),this.outputNode=new zE}setVolume(){}createOutputTrack(){throw new N(R.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},zE=class{disconnect(){}connect(){}};function XO(e){return new j((r,i)=>{let o=!1,h=document.createElement("video");h.setAttribute("autoplay",""),h.setAttribute("muted",""),h.muted=!0,h.autoplay=!0,h.setAttribute("playsinline",""),h.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(h);let p=ln()?"canplay":"playing";h.addEventListener(p,()=>{let g=h.videoWidth,C=h.videoHeight;!g&&$t()||(o=!0,h.srcObject=null,h.remove(),r([g,C]))}),h.srcObject=new MediaStream([e]),h.play().catch(zu),setTimeout(()=>{o||(h.srcObject=null,h.remove(),r([h.videoWidth,h.videoHeight]))},4e3)})}function ru(e){let r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});let i=cr(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!SO()&&i.frameRate&&(r.frameRate=i.frameRate),_O()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),$t()&&(r.frameRate={ideal:30,max:30}),r}function fC(e){let r={};if(SO()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,oo()&&e.ANS&&(r.googHighpassFilter=e.ANS))),e.encoderConfig){let i=Jl(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),Ku()&&(r.sampleRate=void 0),r}var xG=e=>{let r=e._encoderConfig;if(!r)return;let{frameRate:i,width:o,height:h}=e.getMediaStreamTrackSettings(),{frameRate:p=i,width:g=o,height:C=h}=r;if(!p||!g||!C)return;g=wp(g),C=wp(C),p=wp(p);let{max:A,min:x}=function(fN,mN,EN){let RN=200*Math.pow(EN/15,.6)*Math.pow(fN*mN/640/360,.75);return{min:Math.floor(RN),max:Math.floor(4*RN)}}(g,C,p),{bitrateMax:_e,bitrateMin:cN}=r||{};_e||_.debug("calculate bitrate: [w: ".concat(g,", h: ").concat(C,", fps: ").concat(p,"] => [brMax: ").concat(_e,", brMin: ").concat(cN,"]"));let{maxFramerate:dN}=v("ENCODER_CONFIG_LIMIT");return dN&&typeof dN=="number"&&(p=Math.min(p,dN)),{frameRate:p,bitrateMax:_e||A,bitrateMin:cN||x,scaleResolutionDownBy:1,scale:0}},QO=async(e,r,i)=>await(async(o,h,p)=>{let g=function(x){let _e=[];for(let cN=0;cN<x.length;cN+=2)_e.push(parseInt(x.slice(cN,cN+2),16));return Uint8Array.from(_e)}(bO(""+h+p)).slice(0,16),C=g.slice(0,12),A=await window.crypto.subtle.importKey("raw",g,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:C},A,o))})(e.buffer,r,i),Cf=e=>{let r=document.createElement("canvas");return r.width=2,r.height=2,new j((i,o)=>{r.toBlob(async h=>{if(r.remove(),h){let p=await ZO(h);i({buffer:p,width:r.width,height:r.height})}else o(new N(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},ZO=async e=>{let r=await e.arrayBuffer();return new Uint8Array(r)},gC,TC,SC,RC,CC,IC,vC,yC,AC,bC,wC,OC,NC,DC,PC,kC,LC,MC,Yt,UC,xC,VC,FC,BC,jC,Ji,GC,WC,HC,KC,YC,qC,zC,JC,XC,QC,ZC,$C,tI,Ue,Qt=(gC=$({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),TC=$({argsMap:(e,r)=>[e.getTrackId(),r]}),SC=se(),RC=$s("LocalAudioTrack","_enabledMutex"),CC=$({argsMap:(e,r)=>[e.getTrackId(),r]}),IC=se(),vC=$s("LocalAudioTrack","_enabledMutex"),yC=$({argsMap:(e,r)=>[e.getTrackId(),r]}),AC=se(),bC=se(),wC=se(),OC=$({argsMap:e=>[e.getTrackId()]}),NC=se(),DC=$({argsMap:e=>[e.getTrackId()]}),PC=se(),kC=$({argsMap:e=>[e.getTrackId()]}),LC=$({argsMap:(e,r)=>[e.getTrackId(),r.name]}),MC=$({argsMap:e=>[e.getTrackId()]}),Et((Yt=class extends no{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?En.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),P(this,"trackMediaType",fa.AUDIO),P(this,"_encoderConfig",void 0),P(this,"_trackSource",void 0),P(this,"_enabled",!0),P(this,"_volume",100),P(this,"_useAudioElement",!0),P(this,"_bypassWebAudio",!1),P(this,"processor",void 0),P(this,"_processorContext",void 0),P(this,"_processorDestination",void 0),P(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new Pc,v("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),v("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),je()&&!Mn?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Nt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&En.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void _.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,kt(this,H.NEED_REPLACE_TRACK,this).then(()=>{_.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{_.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!jO())throw new N(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await En.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await kt(this,H.NEED_ENABLE_TRACK,this),_.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),_.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),_.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,_.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await kt(this,H.NEED_MUTE_TRACK,this):await kt(this,H.NEED_UNMUTE_TRACK,this))}getStats(){return po(()=>{_.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},KE)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),this._source.on(jn.ON_AUDIO_BUFFER,i=>e(i))}play(){_.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(_.debug("[".concat(this.getTrackId(),"] start audio playback in element")),En.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){_.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?En.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&En.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return j.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new N(R.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(un.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await kt(this,H.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this))}),e.on(un.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(un.ON_TRACK),e.removeAllListeners(un.ON_NODE)}bindProcessorContextEvents(e){e.on(Wn.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Wn.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Pc&&(this._trackSource=new $l(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new iu(this._source.context,this.getTrackId(),"local"),r=new nu(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(jn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(En.stop(this.getTrackId()),this._source.play()),kt(this,H.NEED_REPLACE_MIXING_TRACK,this).then(()=>{_.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{_.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[gC],Object.getOwnPropertyDescriptor(Yt.prototype,"setVolume"),Yt.prototype),Et(Yt.prototype,"setPlaybackDevice",[TC,SC],Object.getOwnPropertyDescriptor(Yt.prototype,"setPlaybackDevice"),Yt.prototype),Et(Yt.prototype,"setEnabled",[RC,CC,IC],Object.getOwnPropertyDescriptor(Yt.prototype,"setEnabled"),Yt.prototype),Et(Yt.prototype,"setMuted",[vC,yC,AC],Object.getOwnPropertyDescriptor(Yt.prototype,"setMuted"),Yt.prototype),Et(Yt.prototype,"getStats",[bC],Object.getOwnPropertyDescriptor(Yt.prototype,"getStats"),Yt.prototype),Et(Yt.prototype,"setAudioFrameCallback",[wC],Object.getOwnPropertyDescriptor(Yt.prototype,"setAudioFrameCallback"),Yt.prototype),Et(Yt.prototype,"play",[OC,NC],Object.getOwnPropertyDescriptor(Yt.prototype,"play"),Yt.prototype),Et(Yt.prototype,"stop",[DC,PC],Object.getOwnPropertyDescriptor(Yt.prototype,"stop"),Yt.prototype),Et(Yt.prototype,"close",[kC],Object.getOwnPropertyDescriptor(Yt.prototype,"close"),Yt.prototype),Et(Yt.prototype,"pipe",[LC],Object.getOwnPropertyDescriptor(Yt.prototype,"pipe"),Yt.prototype),Et(Yt.prototype,"unpipe",[MC],Object.getOwnPropertyDescriptor(Yt.prototype,"unpipe"),Yt.prototype),Yt),ou=(UC=$({argsMap:(e,r)=>[e.getTrackId(),r]}),xC=se(),VC=$s("MicrophoneAudioTrack","_enabledMutex"),FC=$({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),BC=se(),jC=$({argsMap:e=>[e.getTrackId()]}),Et((Ji=class extends Qt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?Jl(r.encoderConfig):{},o,v("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),P(this,"_config",void 0),P(this,"_deviceName","default"),P(this,"_constraints",void 0),P(this,"_originalConstraints",void 0),P(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Zs()||NE())&&wt.bindInterruptDetectorTrack(this)}async setDevice(e){if(_.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let r=await Gn.getDeviceById(e),i={};i.audio=Kt({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Fn(i,this.getTrackId())}catch(h){throw _.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),o=await Fn({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await Gn.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}_.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return _.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),e),v("AUTO_RESET_AUDIO_ROUTE")&&(ln()||vi())){let g=navigator.audioSession;g&&(e||(g.type="playback"),g.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(g){throw _.error("[".concat(this.getTrackId(),"] setEnabled false failed"),g.toString()),g}return}let h=Kt({},this._constraints),p=Gn.searchDeviceIdByName(this._deviceName);p&&!h.deviceId&&(h.deviceId=p);try{i||(this._enabled=!0);let g=await Fn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),await kt(this,H.NEED_ENABLE_TRACK,this)}catch(g){throw i||(this._enabled=!1),_.error("[".concat(this.getTrackId(),"] setEnabled true failed"),g.toString()),g}_.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Zs()||NE())&&wt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ln()||vi())&&this._enabled&&!this._isClosed&&wt.duringInterruption){let e=async()=>{wt.off(ke.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(_.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(ke.IOS_INTERRUPTION_END,e)}else _.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ma.TRACK_ENDED)}async renewMediaStreamTrack(e){let r=e||this._constraints,i=Gn.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();let o=await Fn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Wn.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{let h=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(h),i()}catch(h){o(h)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Wn.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[UC,xC],Object.getOwnPropertyDescriptor(Ji.prototype,"setDevice"),Ji.prototype),Et(Ji.prototype,"setEnabled",[VC,FC,BC],Object.getOwnPropertyDescriptor(Ji.prototype,"setEnabled"),Ji.prototype),Et(Ji.prototype,"close",[jC],Object.getOwnPropertyDescriptor(Ji.prototype,"close"),Ji.prototype),Ji),VG=(GC=$({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),WC=se(),HC=$({argsMap:e=>[e.getTrackId()]}),KC=se(),YC=$({argsMap:e=>[e.getTrackId()]}),qC=se(),zC=$({argsMap:e=>[e.getTrackId()]}),JC=se(),XC=$({argsMap:e=>[e.getTrackId()]}),QC=se(),ZC=$({argsMap:e=>[e.getTrackId()]}),$C=$({argsMap:e=>[e.getTrackId()]}),tI=se(),Et((Ue=class extends Qt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),P(this,"source",void 0),P(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(jn.AUDIO_SOURCE_STATE_CHANGE,h=>{this.safeEmit(ma.SOURCE_STATE_CHANGE,h)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Nt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[GC,WC],Object.getOwnPropertyDescriptor(Ue.prototype,"startProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"pauseProcessAudioBuffer",[HC,KC],Object.getOwnPropertyDescriptor(Ue.prototype,"pauseProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"seekAudioBuffer",[YC,qC],Object.getOwnPropertyDescriptor(Ue.prototype,"seekAudioBuffer"),Ue.prototype),Et(Ue.prototype,"resumeProcessAudioBuffer",[zC,JC],Object.getOwnPropertyDescriptor(Ue.prototype,"resumeProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"stopProcessAudioBuffer",[XC,QC],Object.getOwnPropertyDescriptor(Ue.prototype,"stopProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"close",[ZC],Object.getOwnPropertyDescriptor(Ue.prototype,"close"),Ue.prototype),Et(Ue.prototype,"setAudioBufferPlaybackSpeed",[$C,tI],Object.getOwnPropertyDescriptor(Ue.prototype,"setAudioBufferPlaybackSpeed"),Ue.prototype),Ue),ge=class gve extends Qt{get __className__(){return"MixingAudioTrack"}get isActive(){for(let r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){let r=ga().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Ut(8,"track-mix-")),P(this,"trackList",void 0),P(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(_.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):_.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){_.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}Wl(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){let r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof gve?i.emit(Ko.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}},JE=class extends Zl{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(jn.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),P(this,"audioBuffer",void 0),P(this,"sourceNode",void 0),P(this,"startPlayTime",0),P(this,"startPlayOffset",0),P(this,"pausePlayTime",0),P(this,"options",void 0),P(this,"currentLoopCount",0),P(this,"currentPlaybackSpeed",100),P(this,"_currentState","stopped"),this.audioBuffer=e,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):_.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},eI=new Map,kc=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,r=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,r}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(_.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var r;e!==this._videoState&&(this._videoState=e,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(e){P(this,"trackId",void 0),P(this,"config",void 0),P(this,"onFirstVideoFrameDecoded",void 0),P(this,"onVideoStateChanged",void 0),P(this,"freezeTimeCounterList",[]),P(this,"renderFreezeAccTime",0),P(this,"isKeepLastFrame",!1),P(this,"timeUpdatedCount",0),P(this,"freezeTime",0),P(this,"playbackTime",0),P(this,"lastTimeUpdatedTime",0),P(this,"autoplayFailed",!1),P(this,"videoTrack",void 0),P(this,"videoElement",void 0),P(this,"cacheVideoElement",void 0),P(this,"renderStats",void 0),P(this,"_videoState",zi.VideoStateStopped),P(this,"videoElementCheckInterval",void 0),P(this,"videoElementFreezeTimeout",void 0),P(this,"_videoElementStatus",nn.NONE),P(this,"isGettingVideoDimensions",!1),P(this,"startGetVideoDimensions",()=>{let r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return _.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),P(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&wt.curState==="running"&&(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(dR())),pR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),P(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=nn.PLAYING;break;case"loadeddata":if(this.videoState=zi.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nn.CANPLAY;break;case"stalled":this.videoElementStatus=nn.STALLED;break;case"suspend":this.videoElementStatus=nn.SUSPEND;break;case"pause":this.videoElementStatus=nn.PAUSED,ln()||vi()||je()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nn.WAITING;break;case"abort":this.videoElementStatus=nn.ABORT;break;case"ended":this.videoElementStatus=nn.ENDED;break;case"emptied":this.videoElementStatus=nn.EMPTIED;break;case"error":{let i=this.videoElement.error;i?(this.videoElementStatus=nn.ERROR,_.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")"))):_.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);let o=i-this.lastTimeUpdatedTime,h=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,yr.lastVisibleTime<yr.lastHiddenTime||h<yr.lastHiddenTime||h<yr.lastVisibleTime)return;for(o>v("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;let p=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(p),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),P(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(dR())),pR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),wt.on(ke.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(ke.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let r=this.videoElement.play();r&&r.catch&&r.catch(o=>{e&&JO(e,"video",o.message,this.trackId),o.name==="NotAllowedError"?(_.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):_.warning("[".concat(this.trackId,"] play warning: "),o)});let i=mt();if((i.name==="Safari"&&Number(i.version)===15||Zs())&&r&&r.then){let o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(o).catch(o)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let r=e.getContext("2d");if(!r)return _.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,e.width,e.height);let i=r.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new j((h,p)=>{i.toBlob(async g=>{if(i.remove(),g){let C=await ZO(g);h({buffer:C,width:i.width,height:i.height})}else p(new N(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,r<0?.1:r>1?1:r)})):await Cf(e)}destroy(){this.renderStats=void 0,wt.off(ke.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.off(ke.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=zi.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=nn.INIT,!this.videoElementCheckInterval&&(nI.forEach(h=>{this.videoElement.addEventListener(h,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(h){return h!==document.body&&document.body.contains(h)})(this.videoElement)||(this.videoElementStatus=nn.DESTROYED)},1e3),v("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,r;let h,p=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",p),this.videoElementFreezeTimeout=window.setTimeout(g,v("VIDEO_FREEZE_DURATION")))},g=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===zi.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=zi.VideoStateFrozen:document.addEventListener("visibilitychange",p))},C=(A,x)=>{if(this.videoElementStatus===nn.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=x.mediaTime):this.renderStats={lastTs:x.mediaTime,curTs:x.mediaTime,lastRenderNum:0,renderNum:0},h){let dN=x.presentationTime-h.presentationTime;this.videoState===zi.VideoStateStarting&&(this.videoState=zi.VideoStateDecoding),this.videoState===zi.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(g,v("VIDEO_FREEZE_DURATION"))),dN<v("VIDEO_FREEZE_DURATION")&&this.videoState===zi.VideoStateFrozen&&(this.videoState=zi.VideoStateDecoding),dN>v("VIDEO_FREEZE_DURATION")&&yr.lastVisibleTime>=yr.lastHiddenTime&&h.timestamp>yr.lastVisibleTime&&h.timestamp>yr.lastHiddenTime&&(this.renderFreezeAccTime+=dN)}h=Kt(Kt({},x),{},{timestamp:A})}var _e,cN;v("ENABLE_VIDEO_FRAME_CALLBACK")&&((_e=(cN=this.videoElement).requestVideoFrameCallback)===null||_e===void 0||_e.call(cN,C))};(e=(r=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(r,C)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ku()&&!v("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let i=mt();i.name==="Safari"&&Number(i.version)===15||Zs()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$t()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$t()&&this.videoElement.load());let o=this.videoElement.play();o!==void 0&&o.catch(h=>{_.debug("[".concat(this.trackId,"] playback interrupted"),h.toString())})}resetVideoElement(){nI.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nn.NONE}handleAutoPlayFailed(){let e=r=>{r.preventDefault(),this.videoElement.play().then(()=>{_.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{_.error(i)}),this.autoplayFailed=!1,yc()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};yc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),zO()}},nI=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],su=class extends kc{constructor(e){super(e),P(this,"container",void 0),P(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let r=e.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var r;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await Cf(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",v("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},iI,rI,oI,sI,aI,cI,dI,lI,uI,hI,pI,_I,EI,mI,fI,gI,TI,SI,RI,CI,II,vI,yI,AI,ht,bI,wI,OI,NI,DI,PI,kI,LI,Ln,Ft=(iI=$({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),rI=se(),oI=$({argsMap:e=>[e.getTrackId()]}),sI=$s("LocalVideoTrack","_enabledMutex"),aI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),cI=se(),dI=$s("LocalVideoTrack","_enabledMutex"),lI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),uI=se(),hI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),pI=se(),_I=se(),EI=$({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),mI=se(),fI=se(),gI=se(),TI=se(),SI=se(),RI=se(),CI=se(),II=$({argsMap:(e,r)=>[e.getTrackId(),r.name]}),vI=$({argsMap:e=>[e.getTrackId()]}),yI=$({argsMap:e=>[e.getTrackId()]}),AI=$({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),ht=class Tve extends no{get videoHeight(){if(je()){let{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(je()){let{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,h,p,g){if(super(r,p),P(this,"trackMediaType",fa.VIDEO),P(this,"_player",void 0),P(this,"isUseScaleResolutionDownBy",!1),P(this,"_videoVisibleTimer",null),P(this,"_previousVideoVisibleStatus",void 0),P(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),P(this,"_encoderConfig",void 0),P(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),P(this,"_optimizationMode",void 0),P(this,"_videoHeight",void 0),P(this,"_videoWidth",void 0),P(this,"_forceBitrateLimit",void 0),P(this,"_enabled",!0),P(this,"_processorDestination",void 0),P(this,"_processorContext",void 0),je()){let{width:C,height:A}=r.getSettings();this._videoWidth=C,this._videoHeight=A}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=h,this._hints=g||[],this._hints.indexOf(Gt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(C,A,x){let _e=mt();return!(_e.name!==C||!_e.osVersion)&&Number(_e.version)===A}(It.CHROME,115)&&Hu().indexOf("Windows")!==-1){let C=function(A,x){if("VideoFrame"in window&&"TransformStream"in window&&ft().supportWebRTCInsertableStream){let _e=new MediaStreamTrackProcessor(A),cN=new MediaStreamTrackGenerator({kind:"video"}),dN,fN,mN=Date.now(),EN=()=>{RN&&(clearInterval(RN),RN=void 0),dN&&(dN.close(),dN=void 0),A.stop(),fN=void 0,cN.removeEventListener("ended",EN)},RN=window.setInterval(()=>{if(fN&&dN&&Date.now()-mN>1e3)try{cN.readyState==="live"?fN.enqueue(dN.clone()):EN()}catch{EN()}},1e3),IN=new TransformStream({transform:(t0,aH)=>{cN.readyState==="live"?(fN=aH,mN=Date.now(),dN===void 0?(dN=t0,aH.enqueue(t0.clone())):(aH.enqueue(dN),dN=t0)):t0.close()}});return cN.addEventListener("ended",EN),_e.readable.pipeThrough(IN).pipeTo(cN.writable),cN}}(r);C&&(_.info("local screen video track begin to inject frame"),this._mediaStreamTrack=C)}i&&this._hints.indexOf(Gt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new eu(this.getTrackId(),"local"),this._processorDestination=new tu(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){let h=document.getElementById(r);h?r=h:(_.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}_.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let o=Kt(Kt(Kt({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new kc(o):this._player=new su(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let h=this.getVideoElementVisibleStatus();this.safeEmit(ma.VIDEO_ELEMENT_VISIBLE_STATUS,h)}catch{}},v("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(o){throw _.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void _.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await kt(this,H.NEED_ENABLE_TRACK,this)}catch(o){throw _.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}_.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,_.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await kt(this,H.NEED_MUTE_TRACK,this):await kt(this,H.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new N(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=cr(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){let o=ru({encoderConfig:r});(je()||ln()||vi())&&(o.deviceId=void 0),_.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(h){let p=new N(R.UNEXPECTED_ERROR,h.toString());throw _.error("[".concat(this.getTrackId(),"] applyConstraints error"),p.toString()),p}}this._encoderConfig=r,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(_)}}getStats(){return po(()=>{_.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},YE)}async setBeautyEffect(r){_.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await Cf(r)}async setBitrateLimit(r){if(_.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r){this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate);try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(_)}}}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void _.error(R.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=r,await kt(this,H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,_.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}_.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return _.error(R.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,_.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){XO(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(zu)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new N(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");_.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=cr(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(_)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;let{bitrateMax:h,bitrateMin:p}=this._encoderConfig;if(p==null||h==null){let{max:g,min:C}=function(A,x,_e,cN,dN){let fN=v("BITRATE_ADAPTER_TYPE");if(fN==="DEFAULT_BITRATE")return{min:cN,max:dN};if(dN===void 0){var mN;let RN=Math.floor(200*Math.pow(_e/15,.6)*Math.pow(A*x/640/360,.75));dN=fN==="STANDARD_BITRATE"?4*RN:2*RN,cN=(mN=cN)!==null&&mN!==void 0?mN:RN}else{var EN;cN=(EN=cN)!==null&&EN!==void 0?EN:Math.floor(dN/10)}return{min:cN,max:dN}}(r,i,o,p,h);this._encoderConfig.bitrateMin=C,this._encoderConfig.bitrateMax=g,_.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(g,", brMin: ").concat(C,"]"))}}getVideoElementVisibleStatus(){try{var r,i;let o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),h={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:p,slot:g}=h;if(this.isPlaying&&p instanceof HTMLVideoElement&&g instanceof HTMLElement){let C=CO.checkOneElementVisible(p),A=Object.assign({},C);if(A.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=A.visible;let x=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});A.visible?x.onSuccess("Video is visible"):x.onSuccess("Invisible because of ".concat(A.reason))}return A}return}catch(o){throw new N(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;let r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Kt(Kt({},o),cr(r))),o=Vo(o);let h=Ut(8,"track-video-cloned-"),p=new Tve(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,Vo(this._scalabilityMode),this._optimizationMode,h,Vo(this._hints));return r&&o&&p.setEncoderConfiguration(o),_.debug("clone video track from ".concat(this.getTrackId()," to ").concat(h,", clone ").concat(i)),p}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new N(R.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new N(R.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(po(()=>{X.reportApiInvoke(null,{name:Te.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Zt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!v("ENABLE_VIDEO_SEI")||!v("ENABLE_ENCODED_TRANSFORM"))return void _.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new N(R.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void _.warning("Video track is not published, SEI can not be send");let o=i.sender.getParameters();if(o.codecs.length===0)return;let h=o.codecs[0].mimeType.toLocaleLowerCase();h==="video/h264"?this.safeEmit("sei-to-send",r):_.warning("SEI is not supported by ".concat(h))}bindProcessorDestinationEvents(){this.processorDestination.on(un.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(un.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Wn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Wn.REQUEST_CONSTRAINTS)}},Et(ht.prototype,"play",[iI,rI],Object.getOwnPropertyDescriptor(ht.prototype,"play"),ht.prototype),Et(ht.prototype,"stop",[oI],Object.getOwnPropertyDescriptor(ht.prototype,"stop"),ht.prototype),Et(ht.prototype,"setEnabled",[sI,aI,cI],Object.getOwnPropertyDescriptor(ht.prototype,"setEnabled"),ht.prototype),Et(ht.prototype,"setMuted",[dI,lI,uI],Object.getOwnPropertyDescriptor(ht.prototype,"setMuted"),ht.prototype),Et(ht.prototype,"setEncoderConfiguration",[hI,pI],Object.getOwnPropertyDescriptor(ht.prototype,"setEncoderConfiguration"),ht.prototype),Et(ht.prototype,"getStats",[_I],Object.getOwnPropertyDescriptor(ht.prototype,"getStats"),ht.prototype),Et(ht.prototype,"setBeautyEffect",[EI,mI],Object.getOwnPropertyDescriptor(ht.prototype,"setBeautyEffect"),ht.prototype),Et(ht.prototype,"getCurrentFrameData",[fI],Object.getOwnPropertyDescriptor(ht.prototype,"getCurrentFrameData"),ht.prototype),Et(ht.prototype,"getCurrentFrameImage",[gI],Object.getOwnPropertyDescriptor(ht.prototype,"getCurrentFrameImage"),ht.prototype),Et(ht.prototype,"setBitrateLimit",[TI],Object.getOwnPropertyDescriptor(ht.prototype,"setBitrateLimit"),ht.prototype),Et(ht.prototype,"setOptimizationMode",[SI],Object.getOwnPropertyDescriptor(ht.prototype,"setOptimizationMode"),ht.prototype),Et(ht.prototype,"setScalabiltyMode",[RI],Object.getOwnPropertyDescriptor(ht.prototype,"setScalabiltyMode"),ht.prototype),Et(ht.prototype,"updateMediaStreamTrackResolution",[CI],Object.getOwnPropertyDescriptor(ht.prototype,"updateMediaStreamTrackResolution"),ht.prototype),Et(ht.prototype,"pipe",[II],Object.getOwnPropertyDescriptor(ht.prototype,"pipe"),ht.prototype),Et(ht.prototype,"unpipe",[vI],Object.getOwnPropertyDescriptor(ht.prototype,"unpipe"),ht.prototype),Et(ht.prototype,"close",[yI],Object.getOwnPropertyDescriptor(ht.prototype,"close"),ht.prototype),Et(ht.prototype,"replaceTrack",[AI],Object.getOwnPropertyDescriptor(ht.prototype,"replaceTrack"),ht.prototype),ht),XE=(bI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),wI=se(),OI=$s("CameraVideoTrack","_enabledMutex"),NI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),DI=se(),PI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),kI=se(),LI=$({argsMap:e=>[e.getTrackId()]}),Ln=class Sve extends Ft{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,h,p,g){super(r,cr(i.encoderConfig),h,p,g),P(this,"_config",void 0),P(this,"_originalConstraints",void 0),P(this,"_constraints",void 0),P(this,"_enabled",!0),P(this,"_deviceName","default"),P(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Zs()||NE())&&!function(){let C=mt();if(C.os!==ye.IOS||!C.osVersion)return!1;let A=C.osVersion.split(".");return Number(A[0])===15&&Number(A[1])>=2}()&&TO()&&this._enabled&&!this._isClosed&&(_.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=cr(this._config.encoderConfig),wt.on(ke.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.on(ke.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(_.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{let i=await Gn.getDeviceById(r),o={};o.video=Kt({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await Fn(o,this.getTrackId())}catch(p){throw _.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),h=await Fn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await Gn.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}_.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){_.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));let i={video:Kt(Kt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Fn(i,this.getTrackId())}catch(h){throw _.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),h.toString()),o=await Fn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Kt({},i.video),_.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let o=await Fn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await kt(this,H.NEED_ENABLE_TRACK,this)}catch(o){throw _.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),_.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(o){throw _.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}_.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new N(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=cr(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);let o=le(this._config);o.encoderConfig=r;let h=ru(o);(je()||ln()||vi())&&(h.deviceId=void 0),_.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(h));try{await this._originMediaStreamTrack.applyConstraints(h),this.updateMediaStreamTrackResolution()}catch(p){let g=new N(R.UNEXPECTED_ERROR,p.toString());throw _.error("[".concat(this.getTrackId(),"] applyConstraints error"),g.toString()),g}this._config=o,this._constraints=h,this._originalConstraints=h,this._encoderConfig=r,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(p){return p.throw(_)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ln()||vi())&&this._enabled&&!this._isClosed&&wt.duringInterruption){let r=async()=>{wt.off(ke.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(_.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(ke.IOS_INTERRUPTION_END,r)}else _.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ma.TRACK_ENDED)}async renewMediaStreamTrack(r){let i=r||this._constraints,o=Gn.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){let h=await Fn({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),wt.off(ke.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.off(ke.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Kt(Kt({},o),cr(r))),o=Vo(o);let h=Ut(8,"track-cam-cloned-"),p=new Sve(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Vo(Kt(Kt({},this._config),{},{encoderConfig:o})),Vo(this._constraints),Vo(this._scalabilityMode),this._optimizationMode,h);return r&&o&&p.setEncoderConfiguration(o),_.debug("clone track from ".concat(this.getTrackId()," to ").concat(h,", clone ").concat(i)),p}bindProcessorContextEvents(){this.processorContext.on(Wn.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{let h=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(h),i()}catch(h){o(h)}}),this.processorContext.on(Wn.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Et(Ln.prototype,"setDevice",[bI,wI],Object.getOwnPropertyDescriptor(Ln.prototype,"setDevice"),Ln.prototype),Et(Ln.prototype,"setEnabled",[OI,NI,DI],Object.getOwnPropertyDescriptor(Ln.prototype,"setEnabled"),Ln.prototype),Et(Ln.prototype,"setEncoderConfiguration",[PI,kI],Object.getOwnPropertyDescriptor(Ln.prototype,"setEncoderConfiguration"),Ln.prototype),Et(Ln.prototype,"close",[LI],Object.getOwnPropertyDescriptor(Ln.prototype,"close"),Ln.prototype),Ln);function c_(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Kt(Kt({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?_.debug("[".concat(e,"] set content hint to"),i.optimizationMode):_.debug("[".concat(e,"] set content hint failed")))):_.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MI,UI,xI,VI,zn,FI,BI,jI,GI,WI,HI,$e,au=class extends Xl{getUserId(){return this._userId}constructor(e,r,i,o){super(e,"track-".concat(e.kind,"-").concat(r,"-").concat(o.clientId,"_").concat(Ut(5,""))),P(this,"_userId",void 0),P(this,"_uintId",void 0),P(this,"_isDestroyed",!1),P(this,"store",void 0),P(this,"processor",void 0),P(this,"processorContext",void 0),this._userId=r,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,_.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},Hs=(MI=$({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),UI=$({argsMap:e=>[e.getTrackId()]}),xI=$({argsMap:(e,r)=>[e.getTrackId(),r.name]}),VI=$({argsMap:e=>[e.getTrackId()]}),Et((zn=class extends au{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),P(this,"_videoVisibleTimer",null),P(this,"_previousVideoVisibleStatus",void 0),P(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),P(this,"trackMediaType",fa.VIDEO),P(this,"_videoWidth",void 0),P(this,"_videoHeight",void 0),P(this,"_player",void 0),P(this,"processorDestination",void 0),P(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new eu(this.getTrackId(),"remote"),this.processorDestination=new tu(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return po(()=>{_.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},WO)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let o=document.getElementById(e);o?e=o:(_.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}_.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let i=Kt(Kt({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new kc(i):this._player=new su(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ws.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Ws.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let o=this.getVideoElementVisibleStatus();this.safeEmit(Ws.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},v("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){XO(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(zu)}_updatePlayerSource(){_.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:h,slot:p}=o;if(this.isPlaying&&h instanceof HTMLVideoElement&&p instanceof HTMLElement){let g=CO.checkOneElementVisible(h),C=Object.assign({},g);if(C.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=C.visible;let A=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});C.visible?A.onSuccess("Video is visible"):A.onSuccess("Invisible because of ".concat(C.reason))}return C}return}catch(i){throw new N(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(un.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(un.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ko.SEI_RECEIVED,e)}}).prototype,"play",[MI],Object.getOwnPropertyDescriptor(zn.prototype,"play"),zn.prototype),Et(zn.prototype,"stop",[UI],Object.getOwnPropertyDescriptor(zn.prototype,"stop"),zn.prototype),Et(zn.prototype,"pipe",[xI],Object.getOwnPropertyDescriptor(zn.prototype,"pipe"),zn.prototype),Et(zn.prototype,"unpipe",[VI],Object.getOwnPropertyDescriptor(zn.prototype,"unpipe"),zn.prototype),zn),Ks=(FI=$({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),BI=$({argsMap:(e,r)=>[e.getTrackId(),r]}),jI=$({argsMap:e=>[e.getTrackId()]}),GI=$({argsMap:e=>[e.getTrackId()]}),WI=$({argsMap:(e,r)=>[e.getTrackId(),r.name]}),HI=$({argsMap:e=>[e.getTrackId()]}),Et(($e=class extends au{get isPlaying(){return this._useAudioElement?En.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),P(this,"trackMediaType",fa.AUDIO),P(this,"_source",void 0),P(this,"_useAudioElement",!0),P(this,"_volume",100),P(this,"processorContext",void 0),P(this,"processorDestination",void 0),P(this,"_played",!1),P(this,"_bypassWebAudio",!1),v("DISABLE_WEBAUDIO")?(this._source=new Pc,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $l(e,!0),v("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(jn.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ws.FIRST_FRAME_DECODED)}),this.processorContext=new iu(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new nu(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(jn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),this._source.on(jn.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?En.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!jO())throw new N(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await En.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return po(()=>{_.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},GO)}play(){_.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(_.debug("[".concat(this.getTrackId(),"] use audio element to play")),En.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){_.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?En.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&En.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(un.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(un.ON_NODE,e=>{this._source.processedNode=e;let r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(un.ON_TRACK),this.processorDestination.removeAllListeners(un.ON_NODE)}}).prototype,"setVolume",[FI],Object.getOwnPropertyDescriptor($e.prototype,"setVolume"),$e.prototype),Et($e.prototype,"setPlaybackDevice",[BI],Object.getOwnPropertyDescriptor($e.prototype,"setPlaybackDevice"),$e.prototype),Et($e.prototype,"play",[jI],Object.getOwnPropertyDescriptor($e.prototype,"play"),$e.prototype),Et($e.prototype,"stop",[GI],Object.getOwnPropertyDescriptor($e.prototype,"stop"),$e.prototype),Et($e.prototype,"pipe",[WI],Object.getOwnPropertyDescriptor($e.prototype,"pipe"),$e.prototype),Et($e.prototype,"unpipe",[HI],Object.getOwnPropertyDescriptor($e.prototype,"unpipe"),$e.prototype),$e),yr=new class extends Xt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),P(this,"_lastHiddenTime",0),P(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),_.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}},cu=class extends Xt{constructor(e,r){super(),P(this,"trackMediaType",fa.DATA),P(this,"_version",1),P(this,"_type",3),P(this,"_config",void 0),P(this,"_originDataChannel",void 0),P(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),P(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),P(this,"_datachannelEventMap",new Map),this._config=e,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return v("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,r;return(e=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,r;return(e=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new j((e,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();let i=setTimeout(()=>{var o;r(new N(R.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new N(R.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new N(R.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Cl.OPEN,Cl.CLOSE,Cl.ERROR].forEach(r=>{let i=()=>{this.emit(r)};this._datachannelEventMap.set(r,i),e.addEventListener(r,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[i,o]=r;e.removeEventListener(i,o)}),this._datachannelEventMap.clear()}},QE=class extends cu{constructor(e){super(e),P(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let i=r.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(i).getUint8(3);if(o!==this.id)return void(v("SHOW_DATASTREAM2_LOG")&&_.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let h=r.data.slice(this._dataStreamPacketHeader.byteLength);h=this._dataStreamPacketHandler.deserialize(h),this.emit(Cl.MESSAGE,h)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},ZE=class extends cu{send(e){if(this._originDataChannel){let r=e;r=this._dataStreamPacketHandler.serialize(e);let i=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}};function vl(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>hC.revokeObjectURL(e),0),new Worker(hC.createObjectURL(e))}var Bd=new Map,jd=new Map;function FG(e,r,i){let o=new Uint8Array(e,r,i),h=[],p=0;for(;h.length<i;)p+3<i&&o[p]===0&&o[p+1]===0&&o[p+2]===3&&(o[p+3]===0||o[p+3]===1||o[p+3]===2||o[p+3]===3)?(h.push(o[p],o[p+1],o[p+3]),p+=4):(h.push(o[p]),p++);return new Uint8Array(h)}var Gd=new Map;async function BG(e,r){if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support video encoded transform");if(Gd.has(e)||!e.track)return;let i={track:e.track};if(oo()){if(!e.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let h=null;try{h=e.createEncodedStreams()}catch(C){return void _.error("create video-encoded-streams error",C&&C.message)}let p=[];r.on("sei-to-send",C=>{p.push(C)});let g=new TransformStream({transform(C,A){i.controller||(i.controller=A),e.track&&e.track.id!==i.track.id&&(_.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));let x=p.shift();x&&(C.data=function(_e,cN){let dN=function(t0){let aH=t0.length,pH=[],SH=0;for(;SH<aH;)SH+2<aH&&t0[SH]===0&&t0[SH+1]===0&&(t0[SH+2]===0||t0[SH+2]===1||t0[SH+2]===2||t0[SH+2]===3)?(pH.push(t0[SH],t0[SH+1],3,t0[SH+2]),SH+=3):(pH.push(t0[SH]),SH++);return new Uint8Array(pH)}(cN),fN=dN.length,mN=Math.floor(fN/255),EN=fN%255,RN=new Uint8Array(6+mN+1+fN+_e.byteLength);RN[0]=0,RN[1]=0,RN[2]=0,RN[3]=1,RN[4]=6,RN[5]=101;let IN=0;for(;IN<mN;)RN[6+IN]=255,IN++;return RN[6+IN]=EN,IN++,RN.set(dN,6+IN),RN.set(new Uint8Array(_e),6+IN+fN),RN.buffer}(C.data,x)),A.enqueue(C)}});h.readable.pipeThrough(g).pipeTo(h.writable)}else{if(!je())return;{if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let h=vl(),p=new MessageChannel;await new j(C=>h.onmessage=A=>{A.data==="registered"&&C(void 0)});let g=new RTCRtpScriptTransform(h,{name:"tx",port:p.port2},[p.port2]);e.transform=g,await new j(C=>h.onmessage=A=>{A.data==="started"&&C(void 0)}),r.on("sei-to-send",C=>{p.port1.postMessage({sei:C})}),p.port1.onmessage=C=>{var A;C.data.transformed&&e.track&&((A=e.track)===null||A===void 0?void 0:A.id)!==i.track.id&&(_.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=h}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}let h=Gd.get(e);if(h){Gd.delete(e);try{var p,g;(p=h.controller)===null||p===void 0||p.terminate(),(g=h.worker)===null||g===void 0||g.terminate()}catch(C){_.warning(C&&C.message)}}}Gd.set(e,i),e.track.addEventListener("ended",o)}var xa=new Map;(function(){let e=mt();Ne.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ne.getStreamFromExtension=e.name===It.CHROME&&Number(e.version)>34,Ne.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let r=new RTCPeerConnection,i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),Ne.supportMinBitrate=e.name===It.CHROME||e.name===It.EDGE,Ne.supportSetRtpSenderParameters=function(){let r=mt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ho()||!(!je()&&!Gl())||r.name===It.FIREFOX&&Number(r.version)>=64)}(),e.name===It.SAFARI&&(Number(e.version)>=14?Ne.supportDualStream=!0:Ne.supportDualStream=!1),Ne.webAudioMediaStreamDest=function(){let r=mt();return!(r.name===It.SAFARI&&Number(r.version)<12)}(),Ne.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ne.supportWebGL=typeof WebGLRenderingContext<"u",Ne.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ho()||(Ne.webAudioWithAEC=!0),Ne.supportShareAudio=function(){let r=mt();return(r.os===ye.WIN_10||r.os===ye.WIN_81||r.os===ye.WIN_7||r.os===ye.LINUX||r.os===ye.MAC_OS||r.os===ye.CHROMIUM_OS)&&r.name===It.CHROME&&Number(r.version)>=74}(),Ne.supportDataChannel=!!(OE(76)||function(r){let i=mt();return!(i.name!==It.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||mO(14)),Ne.supportPCSetConfiguration=function(){let r=window.RTCPeerConnection;return!$t()&&!!r&&r.prototype.setConfiguration instanceof Function}(),Ne.supportWebRTCEncodedTransform=function(){let r=mt();return r.name==="Chrome"&&Number(r.version)>=86||r.name==="Safari"&&Number(r.version)>=15}(),Ne.supportWebRTCInsertableStream=function(){let r=mt();return(r.name===It.CHROME||r.name===It.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ne.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ne.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,qu(()=>{Ne.supportDualStreamEncoding=function(){let r=mt();return!!v("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&v("CHROME_DUAL_STREAM_USE_ENCODING"))}(),_.info("browser compatibility",JSON.stringify(Ne),JSON.stringify(e))})})();var ia=class fhe extends Xt{constructor(r,i){super(),T(this,"signal",void 0),T(this,"token",void 0),T(this,"tokenTimeout",void 0),T(this,"tokenInterval",void 0),T(this,"_sequence",0),T(this,"userMap",new Map),T(this,"encoder",new TextEncoder),this.signal=r,this.token=i;let o=()=>{this.signal.connectionState===Lt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*v("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,h,p){var g,C,A;if(this.userMap.size===0)return;let x=Array.from(Pr(g=this.userMap).call(g))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),h=(C=h)!==null&&C!==void 0?C:Ut(6,""),p=(A=p)!==null&&A!==void 0?A:this._sequence++;let _e={_id:h,_type:r,_seq:p,_message:i,token:"".concat(this.token,"_").concat(x)};v("SHOW_P2P_LOG")&&_.debug("send message",_e,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(_e)).forEach(dN=>{this.signal.request(et.DATA_STREAM,{payload:so(this.encoder.encode(dN))})});let cN=new j((dN,fN)=>{let mN=window.setTimeout(()=>{this.off("res-@".concat(h,"_ack"),EN),this.off("res-@".concat(h),IN),this.off(ps.ABORT,RN),_.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(h)),this.userMap.size===0?fN(new N(R.INVALID_REMOTE_USER)):fN(new N(R.TIMEOUT))},v("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),EN=()=>{mN&&window.clearTimeout(mN),this.off(ps.ABORT,RN),o&&dN()},RN=()=>{mN&&window.clearTimeout(mN),this.off("res-@".concat(h,"_ack"),EN),this.off("res-@".concat(h),IN),fN(new N(R.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(h)))};this.once(ps.ABORT,RN),this.once("res-@".concat(h,"_ack"),EN);let IN=(aH,pH)=>{t0=!0,mN&&window.clearTimeout(mN),this.off("res-@".concat(h,"_ack"),EN),this.off(ps.ABORT,RN),aH==="success"?dN(pH):fN(new N(R.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(h)))},t0=!1;o||(this.once("res-@".concat(h),IN),Me(v("SIGNAL_REQUEST_TIMEOUT")).then(()=>{t0||_.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(h,", ").concat(_e))}))});try{return await cN}catch(dN){if(dN.code===R.TIMEOUT)return await this.send(r,i,o,h,p);throw dN}}onMessage(r){var i;let{_uid:o}=r,h,p=this.userMap.get(o);if(p)h=p.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==ie.CHECK)return;let{token:x}=r;h=new Map,p={uid:o,isStart:!0,token:x,splitMessageMap:h,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,p),this.signal.emit(dt.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var g;let{id:x,total:_e}=r,cN=(g=h.get(x))!==null&&g!==void 0?g:[];if(cN.push(r),h.has(x)||h.set(x,cN),cN.length!==_e)return;{let dN=ed(cN).call(cN,(fN,mN)=>fN.index-mN.index).map(fN=>fN.payload).join("");h.delete(x),(r=JSON.parse(dN))._uid=o}}let{_type:C,token:A}=r;if(W(i=[ie.ACK,ie.CHECK]).call(i,C))return C===ie.CHECK&&this.handleCheckToken(p,A),void this.receiveMessage(r);A==="".concat(p.token,"_").concat(this.token)?this.handleReceivedMessage(r):_.debug('Receive unexpected message", '.concat(A,", cur_token: ").concat(p.token,"_").concat(this.token),r)}check(){let r={_id:Ut(6,""),token:this.token,_type:ie.CHECK};v("SHOW_P2P_LOG")&&_.debug("send message",r),this.signal.request(et.DATA_STREAM,{payload:so(this.encoder.encode(JSON.stringify(r)))})}ack(r){let i={_id:r,_type:ie.ACK,token:this.token};v("SHOW_P2P_LOG")&&_.debug("send message",i),this.signal.request(et.DATA_STREAM,{payload:so(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(ie.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){let i=()=>{this.userMap.forEach(x=>{let{receivedMessagesMap:_e,nextExpectedSequenceNumber:cN}=x;for(;_e.has(cN);){let dN=_e.get(cN);_e.delete(cN),this.receiveMessage(dN),x.nextExpectedSequenceNumber++}})};if(!r)return void i();let{_uid:o,_seq:h}=r,p=this.userMap.get(o),{receivedMessagesMap:g,isStart:C,nextExpectedSequenceNumber:A}=p;if(h<A)return this.ack(r._id),void _.debug("[external-signal] receive old message, seq: ".concat(h,", ").concat(r._message));g.set(h,r),C&&h===A&&(this.receiveMessage(r),g.delete(A),p.nextExpectedSequenceNumber++,i())}receiveMessage(r){let{_id:i,_type:o,_message:h,_uid:p}=r;if(v("SHOW_P2P_LOG")&&_.debug("receive message",r),i){let g;switch(r._type!==ie.ACK&&(h&&(g=JSON.parse(h)),this.ack(r._id)),r._type){case ie.CANDIDATE:case ie.CONTROL:this.signal.emit(o,g,p);break;case ie.PUBLISH:case ie.UNPUBLISH:case ie.RESTART_ICE:case ie.CALL:g.uid=p,Ge(this.signal,o,g).then(C=>{this.response(r._id,C)}).catch(()=>{this.response(r._id,void 0,!0)});break;case ie.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case ie.RESPONSE:{let{success:C,message:A}=g;this.emit("res-@".concat(i),C?"success":"failed",A);break}}}}splitMessage(r){if(r.length<fhe.MAX_MESSAGE_SIZE)return[r];let i=[],{remoteToken:o}=JSON.parse(r),h=Ut(6,""),p=0,g=800,C=Math.ceil(r.length/g);for(;r.length>0;){p++;let A={id:h,index:p,total:C,payload:r.slice(0,g),token:"".concat(this.token,"_").concat(o)};JSON.stringify(A).length>fhe.MAX_MESSAGE_SIZE?g-=50:(i.push(A),r=r.slice(g))}return i.map(A=>JSON.stringify(A))}handleCheckToken(r,i){return r.token!==i?(_.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{_.debug("token timeout, ".concat(i)),this.reset(r.uid)},v("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let r=await Ge(this.signal,ie.CALL,void 0),i=await this.send(ie.CALL,r);this.signal.emit(nt.P2P_CONNECTION,i,!0)}async reset(r,i){let o=this.userMap.get(r);o&&(this.emit(ps.ABORT),this.signal.emit(dt.ON_USER_OFFLINE,{uid:o.uid,reason:cj.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(_.debug("change local token from ".concat(i," to ").concat(i)),this.token=Ut(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(ps.ABORT)}};T(ia,"MAX_SIZE",1),T(ia,"MAX_MESSAGE_SIZE",1024);var du=class extends Xt{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Lt.CONNECTED?this.emit(nt.WS_CONNECTED):e===Lt.RECONNECTING?this.emit(nt.WS_RECONNECTING,this._websocketReconnectReason):e===Lt.CLOSED&&this.emit(nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,r){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",Lt.CLOSED),T(this,"reconnectToken",void 0),T(this,"p2pToken",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new Hl(5)),T(this,"pingpongTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"_external_signal",void 0),T(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(nt.ON_BINARY_DATA,i.data);let o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let h="res-@".concat(o._id);this.emit(h,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case dt.ON_DATA_STREAM:return void this.handleDataStream(o._message);case dt.MUTE_AUDIO:case dt.MUTE_VIDEO:case dt.ON_P2P_LOST:case dt.ON_USER_ONLINE:return;case dt.ON_USER_OFFLINE:let{uid:h}=o._message;return _.debug("[".concat(this.clientId,"] user-offline uid: ").concat(h)),void this._external_signal.reset(h)}if(this.emit(o._type,o._message),o._type===dt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===dt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(At.UID_BANNED);break;case 15:this.close(At.IP_BANNED);break;case 16:this.close(At.CHANNEL_BANNED)}if(o._type===dt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Z.ERR_LICENSE_MISSING:this.close(At.LICENSE_MISSING);break;case Z.ERR_LICENSE_EXPIRED:this.close(At.LICENSE_EXPIRED);break;case Z.ERR_LICENSE_MINUTES_EXCEEDED:this.close(At.LICENSE_MINUTES_EXCEEDED);break;case Z.ERR_LICENSE_PERIOD_INVALID:this.close(At.LICENSE_PERIOD_INVALID);break;case Z.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(At.LICENSE_MULTIPLE_SDK_SERVICE);break;case Z.ERR_LICENSE_ILLEGAL:this.close(At.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=r,this.websocket=new Nc("gateway-".concat(this.clientId),this.spec.retryConfig,!0,v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),v("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Be.OFFLINE)}),this.p2pToken=Ut(6,""),this._external_signal=new ia(this,this.p2pToken)}async request(e,r,i,o){let h=Ut(6,""),p={_id:h,_type:e,_message:r},g=this.websocket.connectionID,C=()=>new j((fN,mN)=>{if(this.connectionState===Lt.CONNECTED)return fN();let EN=()=>{this.off(nt.WS_CLOSED,RN),fN()},RN=()=>{this.off(nt.WS_CONNECTED,EN),mN(new N(R.WS_ABORT))};this.once(nt.WS_CONNECTED,EN),this.once(nt.WS_CLOSED,RN)});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||e===et.JOIN||e===et.REJOIN||await C(),this.websocket.sendMessage(p,!0),o)return;let A=new j((fN,mN)=>{let EN=!1,RN=(t0,aH)=>{EN=!0,fN({isSuccess:t0==="success",message:aH||{}}),this.off(nt.WS_CLOSED,IN),this.off(nt.WS_RECONNECTING,IN),this.emit(nt.REQUEST_SUCCESS,e,r)};this.once("res-@".concat(h),RN);let IN=()=>{mN(new N(R.WS_ABORT,"type: ".concat(e))),this.off(nt.WS_CLOSED,IN),this.off(nt.WS_RECONNECTING,IN),this.off("res-@".concat(h),RN)};this.once(nt.WS_CLOSED,IN),this.once(nt.WS_RECONNECTING,IN),Me(v("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==g||EN||(_.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(nt.REQUEST_TIMEOUT,e,r))})}),x=null;try{x=await A}catch(fN){if(this.connectionState===Lt.CLOSED||e===et.LEAVE)throw new N(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?fN.throw():e===et.JOIN||e===et.REJOIN?null:(await C(),await this.request(e,r))}if(x.isSuccess)return x.message;let _e=Number(x.message.error_code||x.message.code),cN=Oc(_e),dN=new N(R.UNEXPECTED_RESPONSE,"".concat(cN.desc,": ").concat(x.message.error_str),{code:_e,data:x.message,desc:cN.desc});return cN.action==="success"?x.message:(_.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_e,", message: ").concat(cN.desc,", action: ").concat(cN.action)),_e===Z.ERR_TOO_MANY_BROADCASTERS?((e===et.JOIN||e===et.REJOIN)&&(this.initError=dN,this.close()),dN.throw()):cN.action==="failed"?dN.throw():cN.action==="quit"?(this.initError=dN,this.close(),dN.throw()):(_e===Z.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=x.message.option,_.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Be.MULTI_IP)):this.reconnect(cN.action,Be.SERVER_ERROR),e===et.JOIN||e===et.REJOIN?null:await this.request(e,r)))}waitMessage(e,r){return new j(i=>{let o=h=>{(!r||r(h))&&(this.off(e,o),i(h))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void _.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(wc.WRTC_STATS,r)}upload(e,r){let i={_type:e,_message:r};try{this.websocket.sendMessage(i)}catch{let o=v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;let h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,r){let i={_type:e,_message:r};this.websocket.sendMessage(i)}async sendExtensionMessage(e,r,i){return await this._external_signal.send(e,r,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new j((r,i)=>{this.once(nt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(nt.WS_CLOSED,()=>i(this.initError||new N(R.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||At.LEAVE,this.connectionState=Lt.CLOSED,_.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ut(6,""),this._external_signal.clear(),this._external_signal=new ia(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(nt.ABORT_P2P_EXECUTION);let e=await Ge(this,nt.REQUEST_JOIN_INFO),r=await this.request(et.JOIN,e);if(!r)return this.emit(nt.REPORT_JOIN_GATEWAY,R.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,r)}handleDataStream(e){try{var r;let i=Fo(e.payload),o=new TextDecoder().decode(i),h=JSON.parse(o);"total"in h&&"id"in h||W(r=Object.values(ie)).call(r,h._type)?(h._uid=e.uid,this._external_signal.onMessage(h)):this.emit(dt.ON_DATA_STREAM,e)}catch{this.emit(dt.ON_DATA_STREAM,e)}}handleNotification(e){_.debug("[".concat(this.clientId,"] receive notification: "),e);let r=Oc(e.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(At.UID_BANNED),void this.close()):void this.reconnect(r.action,Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=v("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=e&&(_.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Be.TIMEOUT):this.request(et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let i=Date.now()-r;this.rttRolling.add(i),v("REPORT_STATS")&&this.send(et.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(it.RECONNECT_WAITTING_FINISH,e=>{this.emit(nt.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(it.RECONNECT_CREATE_CONNECTION,e=>{this.emit(nt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(it.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(it.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(it.FAILED,()=>{this._disconnectedReason=At.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(it.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(it.WILL_RECONNECT,(e,r,i)=>{e!=="retry"?(_.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):_.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(it.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(nt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof N&&e.code===R.UNEXPECTED_RESPONSE&&e.data.code===Z.ERR_NO_AUTHORIZED)return _.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Be.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(it.REQUEST_NEW_URLS,(e,r)=>{Ge(this,nt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(r)}),this.websocket.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}},e0={exports:{}};e0.exports=(()=>{var e={8:(o,h,p)=>{p.r(h),p.d(h,{Parser:()=>zH,Printer:()=>IH,parse:()=>TH,print:()=>NH});let g=`
`,C="".concat("\r").concat(g),A=" ",x;function _e(gH){return gH>="0"&&gH<="9"}function cN(gH){return gH>="!"&&gH<="~"}function dN(gH){return cN(gH)||gH>=""&&gH<="ÿ"}function fN(gH){return gH==="!"||gH>="#"&&gH<="'"||gH>="*"&&gH<="+"||gH>="-"&&gH<="."||gH>="0"&&gH<="9"||gH>="A"&&gH<="Z"||gH>="^"&&gH<="~"}function mN(gH){return gH>="1"&&gH<="9"}function EN(gH){return gH>="A"&&gH<="Z"||gH>="a"&&gH<="z"}function RN(gH){return gH==="d"||gH==="h"||gH==="m"||gH==="s"}function IN(gH){return gH>""&&gH<"	"||gH>"\v"&&gH<"\f"||gH>""&&gH<"ÿ"}function t0(gH){return EN(gH)||_e(gH)||gH==="+"||gH==="/"}function aH(gH){return _e(gH)||EN(gH)||gH==="+"||gH==="/"||gH==="-"||gH==="_"}function pH(gH){return EN(gH)||_e(gH)||gH==="+"||gH==="/"}function SH(gH,SN){var oH=Object.keys(gH);if(Object.getOwnPropertySymbols){var fH=Object.getOwnPropertySymbols(gH);SN&&(fH=fH.filter(function(xH){return Object.getOwnPropertyDescriptor(gH,xH).enumerable})),oH.push.apply(oH,fH)}return oH}function vH(gH){for(var SN=1;SN<arguments.length;SN++){var oH=arguments[SN]!=null?arguments[SN]:{};SN%2?SH(Object(oH),!0).forEach(function(fH){AH(gH,fH,oH[fH])}):Object.getOwnPropertyDescriptors?Object.defineProperties(gH,Object.getOwnPropertyDescriptors(oH)):SH(Object(oH)).forEach(function(fH){Object.defineProperty(gH,fH,Object.getOwnPropertyDescriptor(oH,fH))})}return gH}function AH(gH,SN,oH){return SN in gH?Object.defineProperty(gH,SN,{value:oH,enumerable:!0,configurable:!0,writable:!0}):gH[SN]=oH,gH}(function(gH){gH.VERSION="v",gH.ORIGIN="o",gH.SESSION_NAME="s",gH.INFORMATION="i",gH.URI="u",gH.EMAIL="e",gH.PHONE="p",gH.CONNECTION="c",gH.BANDWIDTH="b",gH.TIME="t",gH.REPEAT="r",gH.ZONE_ADJUSTMENTS="z",gH.KEY="k",gH.ATTRIBUTE="a",gH.MEDIA="m"})(x||(x={}));class UH{consumeText(SN,oH){let fH=oH;for(;fH<SN.length;){let xH=SN[fH];if(xH==="\0"||xH==="\r"||xH===g)break;fH+=1}if(fH-oH==0)throw new Error("Invalid text, at ".concat(SN));return fH}consumeUnicastAddress(SN,oH,fH){return this.consumeTill(SN,oH,A)}consumeOneOrMore(SN,oH,fH){let xH=oH;for(;fH(SN[xH]);)xH++;if(xH-oH==0)throw new Error("Invalid rule at ".concat(oH,"."));return xH}consumeSpace(SN,oH){if(SN[oH]===A)return oH+1;throw new Error("Invalid space at ".concat(oH,"."))}consumeIP4Address(SN,oH){let fH=oH;for(let xH=0;xH<4;xH++)if(fH=this.consumeDecimalUChar(SN,fH),xH!==3){if(SN[fH]!==".")throw new Error("Invalid IP4 address.");fH++}return fH}consumeDecimalUChar(SN,oH){let fH=oH;for(let l5=0;l5<3&&_e(SN[fH]);l5++,fH++);if(fH-oH==0)throw new Error("Invalid decimal uchar.");let xH=parseInt(SN.slice(oH,fH));if(xH>=0&&xH<=255)return fH;throw new Error("Invalid decimal uchar")}consumeIP6Address(SN,oH){let fH=this.consumeHexpart(SN,oH);return SN[fH]===":"&&(fH+=1,fH=this.consumeIP4Address(SN,fH)),fH}consumeHexpart(SN,oH){let fH=oH;if(SN[fH]===":"&&SN[fH+1]===":"){fH+=2;try{fH=this.consumeHexseq(SN,fH)}catch{}return fH}if(fH=this.consumeHexseq(SN,fH),SN[fH]===":"&&SN[fH+1]===":"){fH+=2;try{fH=this.consumeHexseq(SN,fH)}catch{}return fH}return fH}consumeHexseq(SN,oH){let fH=oH;for(;fH=this.consumeHex4(SN,fH),SN[fH]===":"&&SN[fH+1]!==":";)fH+=1;return fH}consumeHex4(SN,oH){let fH=0;for(;fH<4;fH++)if(!((xH=SN[oH+fH])>="0"&&xH<="9"||xH>="a"&&xH<="f"||xH>="A"&&xH<="F")){if(fH===0)throw new Error("Invalid hex 4");break}var xH;return oH+fH}consumeFQDN(SN,oH){let fH=oH;for(;_e(SN[fH])||EN(SN[fH])||SN[fH]==="-"||SN[fH]===".";)fH+=1;if(fH-oH<4)throw new Error("Invalid FQDN");return fH}consumeExtnAddr(SN,oH){return this.consumeOneOrMore(SN,oH,dN)}consumeMulticastAddress(SN,oH,fH){switch(fH){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(SN,oH);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(SN,oH);default:try{return this.consumeFQDN(SN,oH)}catch{return this.consumeExtnAddr(SN,oH)}}}consumeIP6MulticastAddress(SN,oH){let fH=this.consumeHexpart(SN,oH);return SN[fH]==="/"?this.consumeInteger(SN,fH+1):fH}consumeIP4MulticastAddress(SN,oH){let fH=oH+3,xH=SN.slice(oH,fH),l5=parseInt(xH);if(l5<224||l5>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let w5=0;w5<3;w5++){if(SN[fH]!==".")throw new Error("Invalid IP4 multicast address.");fH+=1,fH=this.consumeDecimalUChar(SN,fH)}return SN[fH]==="/"&&(fH+=1),fH=this.consumeTTL(SN,fH),SN[fH]==="/"&&(fH=this.consumeInteger(SN,fH)),fH}consumeInteger(SN,oH){if(!mN(SN[oH]))throw new Error("Invalid integer.");for(oH+=1;_e(SN[oH]);)oH+=1;return oH}consumeTTL(SN,oH){if(SN[oH]==="0")return oH+1;if(!mN(SN[oH]))throw new Error("Invalid TTL.");oH+=1;for(let fH=0;fH<2&&_e(SN[oH]);fH++)oH+=1;return oH}consumeToken(SN,oH){return this.consumeOneOrMore(SN,oH,fN)}consumeTime(SN,oH){let fH=oH;if(SN[fH]==="0")return fH+1;for(mN(SN[fH])&&(fH+=1);_e(SN[fH]);)fH++;if(fH-oH<10)throw new Error("Invalid time");return fH}consumeAddress(SN,oH){return this.consumeTill(SN,oH,A)}consumeTypedTime(SN,oH){let fH=oH;return fH=this.consumeOneOrMore(SN,fH,_e),RN(SN[fH])?fH+1:fH}consumeRepeatInterval(SN,oH){if(!mN(SN[oH]))throw new Error("Invalid repeat interval");for(oH+=1;_e(SN[oH]);)oH+=1;return RN(SN[oH])&&(oH+=1),oH}consumePort(SN,oH){return this.consumeOneOrMore(SN,oH,_e)}consume(SN,oH,fH){for(let xH=0;xH<fH.length;xH++){if(oH+xH>=SN.length)throw new Error("consume exceeding value length");if(SN[oH+xH]!==fH[xH])throw new Error("consume ".concat(fH," failed at ").concat(xH))}return oH+fH.length}consumeTill(SN,oH,fH){let xH=oH;for(;xH<SN.length&&(typeof fH!="string"||SN[xH]!==fH)&&(typeof fH!="function"||!fH(SN[xH]));)xH++;return xH}}class zH extends UH{constructor(){super(),AH(this,"records",[]),AH(this,"currentLine",0)}parse(SN){let oH=this.probeEOL(SN);this.records=SN.split(oH).filter(y5=>!!rn(y5).call(y5)).map(this.parseLine),this.currentLine=0;let fH=this.parseVersion(),xH=this.parseOrigin(),l5=this.parseSessionName(),w5=this.parseInformation(),H5=this.parseUri(),d6=this.parseEmail(),C6=this.parsePhone(),fK=this.parseConnection(),D4=this.parseBandWidth(),i4=this.parseTimeFields(),L6=this.parseKey(),X5=this.parseSessionAttribute(),B5=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:fH,origin:xH,sessionName:l5,information:w5,uri:H5,emails:d6,phones:C6,connection:fK,bandwidths:D4,timeFields:i4,key:L6,attributes:X5,mediaDescriptions:B5}}getCurrentRecord(){let SN=this.records[this.currentLine];if(!SN)throw new Error("Record doesn't exit.");return SN}probeEOL(SN){for(let oH=0;oH<SN.length;oH++)if(SN[oH]===g)return SN[oH-1]==="\r"?C:g;throw new Error("Invalid newline character.")}parseLine(SN,oH){if(SN.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let fH=SN[0];if(SN[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:fH,value:SN.slice(2),line:oH,cur:0}}parseSessionAttribute(){let SN=new HH;for(;this.currentLine<this.records.length;){let oH=this.getCurrentRecord();if(oH.type!==x.ATTRIBUTE)break;let fH={attField:this.extractOneOrMore(oH,xH=>fN(xH)&&xH!==":"),_cur:0};oH.value[oH.cur]===":"&&(oH.cur+=1,fH.attValue=this.extractOneOrMore(oH,IN)),SN.parse(fH),this.currentLine++}return SN.digest()}parseMediaAttributes(SN){let oH=new VH(SN);for(;this.currentLine<this.records.length;){let fH=this.getCurrentRecord();if(fH.type!==x.ATTRIBUTE)break;let xH={attField:this.extractOneOrMore(fH,l5=>fN(l5)&&l5!==":"),_cur:0};fH.value[fH.cur]===":"&&(fH.cur+=1,xH.attValue=this.extractOneOrMore(fH,IN)),oH.parse(xH),this.currentLine++}return oH.digest()}parseKey(){let SN=this.getCurrentRecord();if(SN.type===x.KEY){if(SN.value==="prompt"||SN.value==="clear:"||SN.value==="base64:"||SN.value==="uri:")return SN.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let SN=this.getCurrentRecord();if(SN.type===x.ZONE_ADJUSTMENTS){let oH=[];for(;;)try{let fH=this.extract(SN,this.consumeTime);this.consumeSpaceForRecord(SN);let xH=!1;SN.value[SN.cur]==="-"&&(xH=!0,SN.cur+=1);let l5=this.extract(SN,this.consumeTypedTime);oH.push({time:fH,typedTime:l5,back:xH})}catch{break}if(oH.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,oH}return[]}parseRepeat(){let SN=[];for(;;){let oH=this.getCurrentRecord();if(oH.type!==x.REPEAT)break;{let fH=this.extract(oH,this.consumeRepeatInterval),xH=this.parseTypedTime(oH);SN.push({repeatInterval:fH,typedTimes:xH}),this.currentLine++}}return SN}parseTypedTime(SN){let oH=[];for(;;)try{this.consumeSpaceForRecord(SN),oH.push(this.extract(SN,this.consumeTypedTime))}catch{break}if(oH.length===0)throw new Error("Invalid typed time.");return oH}parseTime(){let SN=this.getCurrentRecord(),oH=this.extract(SN,this.consumeTime);this.consumeSpaceForRecord(SN);let fH=this.extract(SN,this.consumeTime);return this.currentLine++,{startTime:oH,stopTime:fH}}parseBandWidth(){let SN=[];for(;this.currentLine<this.records.length;){let oH=this.getCurrentRecord();if(oH.type!==x.BANDWIDTH)break;{let fH=this.extractOneOrMore(oH,fN);if(oH.value[oH.cur]!==":")throw new Error("Invalid bandwidth field.");oH.cur++;let xH=this.extractOneOrMore(oH,_e);SN.push({bwtype:fH,bandwidth:xH}),this.currentLine++}}return SN}parseVersion(){let SN=this.getCurrentRecord();if(SN.type!==x.VERSION)throw new Error("first sdp record must be version");let oH=SN.value.slice(0,this.consumeOneOrMore(SN.value,0,_e));if(oH.length!==SN.value.length)throw new Error('invalid proto version, "v='.concat(SN.value,'"'));return this.currentLine++,oH}parseOrigin(){let SN=this.getCurrentRecord();if(SN.type!==x.ORIGIN)throw new Error("second line of sdp must be origin");let oH=this.extractOneOrMore(SN,dN);this.consumeSpaceForRecord(SN);let fH=this.extractOneOrMore(SN,_e);this.consumeSpaceForRecord(SN);let xH=this.extractOneOrMore(SN,_e);this.consumeSpaceForRecord(SN);let l5=this.extractOneOrMore(SN,fN);this.consumeSpaceForRecord(SN);let w5=this.extractOneOrMore(SN,fN);this.consumeSpaceForRecord(SN);let H5=this.extract(SN,this.consumeUnicastAddress);return this.currentLine++,{username:oH,sessId:fH,sessVersion:xH,nettype:l5,addrtype:w5,unicastAddress:H5}}parseSessionName(){let SN=this.getCurrentRecord();if(SN.type===x.SESSION_NAME){let oH=this.extract(SN,this.consumeText);return this.currentLine++,oH}}parseInformation(){let SN=this.getCurrentRecord();if(SN.type!==x.INFORMATION)return;let oH=this.extract(SN,this.consumeText);return this.currentLine++,oH}parseUri(){let SN=this.getCurrentRecord();if(SN.type===x.URI)return this.currentLine++,SN.value}parseEmail(){let SN=[];for(;;){let oH=this.getCurrentRecord();if(oH.type!==x.EMAIL)break;SN.push(oH.value),this.currentLine++}return SN}parsePhone(){let SN=[];for(;;){let oH=this.getCurrentRecord();if(oH.type!==x.PHONE)break;SN.push(oH.value),this.currentLine++}return SN}parseConnection(){let SN=this.getCurrentRecord();if(SN.type===x.CONNECTION){let oH=this.extractOneOrMore(SN,fN);this.consumeSpaceForRecord(SN);let fH=this.extractOneOrMore(SN,fN);this.consumeSpaceForRecord(SN);let xH=this.extract(SN,this.consumeAddress);return this.currentLine++,{nettype:oH,addrtype:fH,address:xH}}}parseMedia(){let SN=this.getCurrentRecord(),oH=this.extract(SN,this.consumeToken);this.consumeSpaceForRecord(SN);let fH=this.extract(SN,this.consumePort);SN.value[SN.cur]==="/"&&(SN.cur+=1,fH+=this.extract(SN,this.consumeInteger)),this.consumeSpaceForRecord(SN);let xH=[];for(xH.push(this.extract(SN,this.consumeToken));SN.value[SN.cur]==="/";)SN.cur+=1,xH.push(this.extract(SN,this.consumeToken));if(xH.length===0)throw new Error("Invalid proto");let l5=this.parseFmt(SN);return this.currentLine++,{mediaType:oH,port:fH,protos:xH,fmts:l5}}parseTimeFields(){let SN=[];for(;this.getCurrentRecord().type===x.TIME;){let oH=this.parseTime(),fH=this.parseRepeat(),xH=this.parseZone();SN.push({time:oH,repeats:fH,zones:xH})}return SN}parseMediaDescription(){let SN=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===x.MEDIA;){let oH=this.parseMedia(),fH=this.parseInformation(),xH=this.parseConnections(),l5=this.parseBandWidth(),w5=this.parseKey(),H5=this.parseMediaAttributes(oH);SN.push({media:oH,information:fH,connections:xH,bandwidths:l5,key:w5,attributes:H5})}return SN}parseConnections(){let SN=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===x.CONNECTION;)SN.push(this.parseConnection());return SN}parseFmt(SN){let oH=[];for(;;)try{this.consumeSpaceForRecord(SN),oH.push(this.extract(SN,this.consumeToken))}catch{break}if(oH.length===0)throw new Error("Invalid fmts");return oH}extract(SN,oH){for(var fH=arguments.length,xH=new Array(fH>2?fH-2:0),l5=2;l5<fH;l5++)xH[l5-2]=arguments[l5];let w5=oH.call(this,SN.value,SN.cur,...xH),H5=SN.value.slice(SN.cur,w5);return SN.cur=w5,H5}extractOneOrMore(SN,oH){let fH=this.consumeOneOrMore(SN.value,SN.cur,oH),xH=SN.value.slice(SN.cur,fH);return SN.cur=fH,xH}consumeSpaceForRecord(SN){if(SN.value[SN.cur]!==A)throw new Error("Invalid space at ".concat(SN.cur,"."));SN.cur+=1}}class CH extends UH{constructor(){super(...arguments),AH(this,"attributes",void 0),AH(this,"digested",!1)}extractOneOrMore(SN,oH,fH){let xH=this.consumeOneOrMore(SN.attValue,SN._cur,oH),l5=SN.attValue.slice(SN._cur,xH),[w5,H5]=fH||[];if(typeof w5=="number"&&l5.length<w5)throw new Error("error in length, should be more or equal than ".concat(w5," characters."));if(typeof H5=="number"&&l5.length>H5)throw new Error("error in length, should be less or equal than ".concat(H5," characters."));return SN._cur=xH,l5}consumeAttributeSpace(SN){if(SN.attValue[SN._cur]!==A)throw new Error("Invalid space at ".concat(SN._cur,"."));SN._cur+=1}extract(SN,oH){if(!SN.attValue)throw new Error("Nothing to extract from attValue.");for(var fH=arguments.length,xH=new Array(fH>2?fH-2:0),l5=2;l5<fH;l5++)xH[l5-2]=arguments[l5];let w5=oH.call(this,SN.attValue,SN._cur,...xH),H5=SN.attValue.slice(SN._cur,w5);return SN._cur=w5,H5}atEnd(SN){if(!SN.attValue)throw new Error;return SN._cur>=SN.attValue.length}peekChar(SN){if(!SN.attValue)throw new Error;return SN.attValue[SN._cur]}peek(SN,oH){if(!SN.attValue)throw new Error;for(let fH=0;fH<oH.length;fH++)if(oH[fH]!==SN.attValue[SN._cur+fH])return!1;return!0}parseIceUfrag(SN){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(SN,t0,[4,256])}parseIcePwd(SN){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(SN,t0,[22,256])}parseIceOptions(SN){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let oH=[];for(;!this.atEnd(SN);){oH.push(this.extractOneOrMore(SN,t0));try{this.consumeAttributeSpace(SN)}catch(fH){if(this.atEnd(SN))break;throw fH}}this.attributes.iceOptions=oH}parseFingerprint(SN){let oH=this.extract(SN,this.consumeToken);this.consumeAttributeSpace(SN);let fH=this.extract(SN,this.consumeTill);this.attributes.fingerprints.push({hashFunction:oH,fingerprint:fH})}parseExtmap(SN){let oH=this.extractOneOrMore(SN,_e),fH;this.peekChar(SN)==="/"&&(this.extract(SN,this.consume,"/"),fH=this.extract(SN,this.consumeToken)),this.consumeAttributeSpace(SN);let xH=this.extract(SN,this.consumeTill,A),l5=vH(vH({entry:parseInt(oH,10)},fH&&{direction:fH}),{},{extensionName:xH});this.peekChar(SN)===A&&(this.consumeAttributeSpace(SN),l5.extensionAttributes=this.extract(SN,this.consumeTill)),this.attributes.extmaps.push(l5)}parseSetup(SN){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let oH=this.extract(SN,this.consumeTill);if(oH!=="active"&&oH!=="passive"&&oH!=="actpass"&&oH!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=oH}}class HH extends CH{constructor(){super(...arguments),AH(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(SN){if(this.digested)throw new Error("already digested");try{switch(SN.attField){case"group":this.parseGroup(SN);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(SN);break;case"ice-pwd":this.parseIcePwd(SN);break;case"ice-options":this.parseIceOptions(SN);break;case"fingerprint":this.parseFingerprint(SN);break;case"setup":this.parseSetup(SN);break;case"tls-id":this.parseTlsId(SN);break;case"identity":this.parseIdentity(SN);break;case"extmap":this.parseExtmap(SN);break;case"msid-semantic":this.parseMsidSemantic(SN);break;default:SN.ignored=!0,this.attributes.unrecognized.push(SN)}}catch(oH){throw console.error("parsing session attribute ".concat(SN.attField,' error, "a=').concat(SN.attField,":").concat(SN.attValue,'"')),oH}if(!SN.ignored&&SN.attValue&&!this.atEnd(SN))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(SN){let oH=this.extract(SN,this.consumeToken),fH=[];for(;!this.atEnd(SN)&&this.peekChar(SN)===A;)this.consumeAttributeSpace(SN),fH.push(this.extract(SN,this.consumeToken));this.attributes.groups.push({semantic:oH,identificationTag:fH})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(SN){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(SN,aH)}parseIdentity(SN){let oH=this.extractOneOrMore(SN,pH),fH=[];for(;!this.atEnd(SN)&&this.peekChar(SN)===A;){this.consumeAttributeSpace(SN);let xH=this.extract(SN,this.consumeToken);this.extract(SN,this.consume,"=");let l5=this.extractOneOrMore(SN,w5=>w5!==A&&IN(w5));fH.push({name:xH,value:l5})}this.attributes.identities.push({assertionValue:oH,extensions:fH})}parseMsidSemantic(SN){this.peekChar(SN)===A&&this.consumeAttributeSpace(SN);let oH={semantic:this.extract(SN,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(SN)}catch{break}if(this.peekChar(SN)==="*"){this.extract(SN,this.consume,"*"),oH.applyForAll=!0;break}{let fH=this.extract(SN,this.consumeTill,A);oH.identifierList.push(fH)}}this.attributes.msidSemantic=oH}}class VH extends CH{constructor(SN){super(),AH(this,"attributes",void 0),SN.protos.indexOf("RTP")!==-1||SN.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(SN){if(this.digested)throw new Error("already digested");try{switch(SN.attField){case"extmap":this.parseExtmap(SN);break;case"setup":this.parseSetup(SN);break;case"ice-ufrag":this.parseIceUfrag(SN);break;case"ice-pwd":this.parseIcePwd(SN);break;case"ice-options":this.parseIceOptions(SN);break;case"candidate":this.parseCandidate(SN);break;case"remote-candidate":this.parseRemoteCandidate(SN);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(SN);break;case"rtpmap":this.parseRtpmap(SN);break;case"ptime":this.parsePtime(SN);break;case"maxptime":this.parseMaxPtime(SN);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(SN);break;case"ssrc":this.parseSSRC(SN);break;case"fmtp":this.parseFmtp(SN);break;case"rtcp-fb":this.parseRtcpFb(SN);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(SN);break;case"mid":this.parseMid(SN);break;case"msid":this.parseMsid(SN);break;case"imageattr":this.parseImageAttr(SN);break;case"rid":this.parseRid(SN);break;case"simulcast":this.parseSimulcast(SN);break;case"sctp-port":this.parseSctpPort(SN);break;case"max-message-size":this.parseMaxMessageSize(SN);break;case"ssrc-group":this.parseSSRCGroup(SN);break;default:SN.ignored=!0,this.attributes.unrecognized.push(SN)}}catch(oH){throw console.error("parsing media attribute ".concat(SN.attField,' error, "a=').concat(SN.attField,":").concat(SN.attValue,'"')),oH}if(!SN.ignored&&SN.attValue&&!this.atEnd(SN))throw new Error("attribute parsing error")}parseCandidate(SN){let oH=this.extractOneOrMore(SN,t0,[1,32]);this.consumeAttributeSpace(SN);let fH=this.extractOneOrMore(SN,_e,[1,5]);this.consumeAttributeSpace(SN);let xH=this.extract(SN,this.consumeToken);this.consumeAttributeSpace(SN);let l5=this.extractOneOrMore(SN,_e,[1,10]);this.consumeAttributeSpace(SN);let w5=this.extract(SN,this.consumeAddress);this.consumeAttributeSpace(SN);let H5=this.extract(SN,this.consumePort);this.consumeAttributeSpace(SN),this.extract(SN,this.consume,"typ"),this.consumeAttributeSpace(SN);let d6={foundation:oH,componentId:fH,transport:xH,priority:l5,connectionAddress:w5,port:H5,type:this.extract(SN,this.consumeToken),extension:{}};for(this.peek(SN," raddr")&&(this.extract(SN,this.consume," raddr"),this.consumeAttributeSpace(SN),d6.relAddr=this.extract(SN,this.consumeAddress)),this.peek(SN," rport")&&(this.extract(SN,this.consume," rport"),this.consumeAttributeSpace(SN),d6.relPort=this.extract(SN,this.consumePort));this.peekChar(SN)===A;){this.consumeAttributeSpace(SN);let C6=this.extract(SN,this.consumeToken);this.consumeAttributeSpace(SN),d6.extension[C6]=this.extractOneOrMore(SN,cN)}this.attributes.candidates.push(d6)}parseRemoteCandidate(SN){let oH=[];for(;;){let fH=this.extractOneOrMore(SN,_e,[1,5]);this.consumeAttributeSpace(SN);let xH=this.extract(SN,this.consumeAddress);this.consumeAttributeSpace(SN);let l5=this.extract(SN,this.consumePort);oH.push({componentId:fH,connectionAddress:xH,port:l5});try{this.consumeAttributeSpace(SN)}catch{break}}this.attributes.remoteCandidatesList.push(oH)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(SN){let oH=this.extract(SN,this.consumeToken);this.consumeAttributeSpace(SN);let fH=this.extract(SN,this.consumeTill,"/");this.extract(SN,this.consume,"/");let xH={encodingName:fH,clockRate:this.extractOneOrMore(SN,_e)};this.atEnd(SN)||this.peekChar(SN)!=="/"||(this.extract(SN,this.consume,"/"),xH.encodingParameters=parseInt(this.extract(SN,this.consumeTill),10));let l5=this.attributes.payloads.find(w5=>w5.payloadType===parseInt(oH,10));l5?l5.rtpMap=xH:this.attributes.payloads.push({payloadType:parseInt(oH,10),rtpMap:xH,rtcpFeedbacks:[]})}parsePtime(SN){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(SN,this.consumeTill)}parseMaxPtime(SN){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(SN,this.consumeTill)}parseDirection(SN){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=SN.attField}parseSSRC(SN){let oH=this.extractOneOrMore(SN,_e);this.consumeAttributeSpace(SN);let fH=this.extract(SN,this.consumeTill,":"),xH;this.peekChar(SN)===":"&&(this.extract(SN,this.consume,":"),xH=this.extract(SN,this.consumeTill));let l5=this.attributes.ssrcs.find(w5=>w5.ssrcId===parseInt(oH,10));l5?l5.attributes[fH]=xH:this.attributes.ssrcs.push({ssrcId:parseInt(oH,10),attributes:{[fH]:xH}})}parseFmtp(SN){let oH=this.extract(SN,this.consumeTill,A);this.consumeAttributeSpace(SN);let fH=this.extract(SN,this.consumeTill),xH={};fH.split(";").forEach(w5=>{let[H5,d6]=w5.split("=");H5=rn(H5).call(H5);let C6=typeof d6=="string"?rn(d6).call(d6):null;typeof H5=="string"&&H5.length>0&&(xH[H5]=C6)});let l5=this.attributes.payloads.find(w5=>w5.payloadType===parseInt(oH,10));l5?l5.fmtp={parameters:xH}:this.attributes.payloads.push({payloadType:parseInt(oH,10),rtcpFeedbacks:[],fmtp:{parameters:xH}})}parseFmtParameters(SN){let oH={},fH=this.extract(SN,this.consumeTill,"=");SN._cur++;let xH=this.extract(SN,this.consumeTill,";");for(oH[fH]=xH;SN.attValue[SN._cur]===";";){let l5=this.extract(SN,this.consumeTill,"=");SN._cur++;let w5=this.extract(SN,this.consumeTill,";");oH[l5]=w5}return oH}parseRtcpFb(SN){let oH="";oH=this.peekChar(SN)==="*"?this.extract(SN,this.consume,"*"):this.extract(SN,this.consumeTill,A),this.consumeAttributeSpace(SN);let fH=this.extract(SN,this.consumeTill,A),xH;if(fH==="trr-int")xH={type:fH,interval:this.extract(SN,this.consumeTill)};else{let l5={type:fH};this.peekChar(SN)===A&&(this.consumeAttributeSpace(SN),l5.parameter=this.extract(SN,this.consumeToken),this.peekChar(SN)===A&&(l5.additional=this.extract(SN,this.consumeTill))),xH=l5}if(oH==="*")this.attributes.rtcpFeedbackWildcards.push(xH);else{let l5=this.attributes.payloads.find(w5=>w5.payloadType===parseInt(oH,10));l5?l5.rtcpFeedbacks.push(xH):this.attributes.payloads.push({payloadType:parseInt(oH,10),rtcpFeedbacks:[xH]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(SN){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let oH={port:this.extract(SN,this.consumePort)};this.peekChar(SN)===A&&(this.consumeAttributeSpace(SN),oH.netType=this.extractOneOrMore(SN,fN),this.consumeAttributeSpace(SN),oH.addressType=this.extractOneOrMore(SN,fN),this.consumeAttributeSpace(SN),oH.address=this.extract(SN,this.consumeAddress)),this.attributes.rtcp=oH}parseMsid(SN){let oH={id:this.extractOneOrMore(SN,fN,[1,64])};this.peekChar(SN)===A&&(this.consumeAttributeSpace(SN),oH.appdata=this.extractOneOrMore(SN,fN,[1,64])),this.attributes.msids.push(oH)}parseImageAttr(SN){this.attributes.imageattr.push(SN.attValue)}parseRid(SN){let oH=this.extractOneOrMore(SN,xH=>EN(xH)||_e(xH)||xH==="_"||xH==="-");this.consumeAttributeSpace(SN);let fH={id:oH,direction:this.extract(SN,this.consumeToken),params:[]};if(this.peekChar(SN)===A){if(this.consumeAttributeSpace(SN),this.peek(SN,"pt=")){this.extract(SN,this.consume,"pt=");let xH=[];for(;;){let l5=this.extract(SN,this.consumeToken);xH.push(l5);try{this.extract(SN,this.consume,",")}catch{break}}fH.payloads=xH,this.peekChar(SN)===A&&this.extract(SN,this.consume,A)}for(;;){let xH=this.extract(SN,this.consumeToken);switch(xH){case"depend":{let l5={type:xH,rids:this.extract(SN,this.consume,"=").split(",")};fH.params.push(l5);break}default:{let l5={type:xH};this.peekChar(SN)==="="&&(this.extract(SN,this.consume,"="),l5.val=this.extract(SN,this.consumeTill,";")),fH.params.push(l5)}}try{this.extract(SN,this.consume,";")}catch{break}}}this.attributes.rids.push(fH)}parseSimulcast(SN){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=SN.attValue,this.extract(SN,this.consumeTill)}parseSctpPort(SN){this.attributes.sctpPort=this.extractOneOrMore(SN,_e,[1,5])}parseMaxMessageSize(SN){this.attributes.maxMessageSize=this.extractOneOrMore(SN,_e,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(SN){this.attributes.mid=this.extract(SN,this.consumeToken)}parseSSRCGroup(SN){let oH=this.extract(SN,this.consumeToken),fH=[];for(;;)try{this.consumeAttributeSpace(SN);let xH=this.extract(SN,this.consumeInteger);fH.push(parseInt(xH,10))}catch{break}this.attributes.ssrcGroups.push({semantic:oH,ssrcIds:fH})}}function KH(gH,SN,oH){return SN in gH?Object.defineProperty(gH,SN,{value:oH,enumerable:!0,configurable:!0,writable:!0}):gH[SN]=oH,gH}class IH{constructor(){KH(this,"eol",C)}print(SN,oH){let fH="";return oH&&(this.eol=oH),fH+=this.printVersion(SN.version),fH+=this.printOrigin(SN.origin),fH+=this.printSessionName(SN.sessionName),fH+=this.printInformation(SN.information),fH+=this.printUri(SN.uri),fH+=this.printEmail(SN.emails),fH+=this.printPhone(SN.phones),fH+=this.printConnection(SN.connection),fH+=this.printBandwidth(SN.bandwidths),fH+=this.printTimeFields(SN.timeFields),fH+=this.printKey(SN.key),fH+=this.printSessionAttributes(SN.attributes),fH+=this.printMediaDescription(SN.mediaDescriptions),fH}printVersion(SN){return"v=".concat(SN).concat(this.eol)}printOrigin(SN){return"o=".concat(SN.username," ").concat(SN.sessId," ").concat(SN.sessVersion," ").concat(SN.nettype," ").concat(SN.addrtype," ").concat(SN.unicastAddress).concat(this.eol)}printSessionName(SN){return SN?"s=".concat(SN).concat(this.eol):""}printInformation(SN){return SN?"i=".concat(SN).concat(this.eol):""}printUri(SN){return SN?"u=".concat(SN).concat(this.eol):""}printEmail(SN){let oH="";for(let fH of SN)oH+="e=".concat(fH).concat(this.eol);return oH}printPhone(SN){let oH="";for(let fH of SN)oH+="e=".concat(fH).concat(this.eol);return oH}printConnection(SN){return SN?"c=".concat(SN.nettype," ").concat(SN.addrtype," ").concat(SN.address).concat(this.eol):""}printBandwidth(SN){let oH="";for(let fH of SN)oH+="b=".concat(fH.bwtype,":").concat(fH.bandwidth).concat(this.eol);return oH}printTimeFields(SN){let oH="";for(let fH of SN){oH+="t=".concat(fH.time.startTime," ").concat(fH.time.startTime).concat(this.eol);for(let xH of fH.repeats)oH+="r=".concat(xH.repeatInterval," ").concat(xH.typedTimes.join(" ")).concat(this.eol);fH.zoneAdjustments&&(oH+="z=",oH+="z=".concat(fH.zoneAdjustments.map(xH=>"".concat(xH.time," ").concat(xH.back?"-":""," ").concat(xH.typedTime)).join(" ")).concat(this.eol),oH+=this.eol)}return oH}printKey(SN){return SN?"k=".concat(SN).concat(this.eol):""}printAttributes(SN){let oH="";for(let fH of SN)oH+="a=".concat(fH.attField).concat(fH.attValue?":".concat(fH.attValue):"").concat(this.eol);return oH}printMediaDescription(SN){let oH="";for(let fH of SN)oH+=this.printMedia(fH.media),oH+=this.printInformation(fH.information),oH+=this.printConnections(fH.connections),oH+=this.printBandwidth(fH.bandwidths),oH+=this.printKey(fH.key),oH+=this.printMediaAttributes(fH);return oH}printConnections(SN){let oH="";for(let fH of SN)oH+=this.printConnection(fH);return oH}printMedia(SN){return"m=".concat(SN.mediaType," ").concat(SN.port," ").concat(SN.protos.join("/")," ").concat(SN.fmts.join(" ")).concat(this.eol)}printSessionAttributes(SN){return new GH(this.eol).print(SN)}printMediaAttributes(SN){return new yH(this.eol).print(SN)}}class MH{constructor(SN){KH(this,"eol",void 0),this.eol=SN}printIceUfrag(SN){return SN===void 0?"":"a=ice-ufrag:".concat(SN).concat(this.eol)}printIcePwd(SN){return SN===void 0?"":"a=ice-pwd:".concat(SN).concat(this.eol)}printIceOptions(SN){return SN===void 0?"":"a=ice-options:".concat(SN.join(A)).concat(this.eol)}printFingerprints(SN){return SN.length>0?SN.map(oH=>"a=fingerprint:".concat(oH.hashFunction).concat(A).concat(oH.fingerprint)).join(this.eol)+this.eol:""}printExtmap(SN){return SN.map(oH=>"a=extmap:".concat(oH.entry).concat(oH.direction?"/".concat(oH.direction):"").concat(A).concat(oH.extensionName).concat(oH.extensionAttributes?"".concat(A).concat(oH.extensionAttributes):"").concat(this.eol)).join("")}printSetup(SN){return SN===void 0?"":"a=setup:".concat(SN).concat(this.eol)}printUnrecognized(SN){return SN.map(oH=>"a=".concat(oH.attField).concat(oH.attValue?":".concat(oH.attValue):"").concat(this.eol)).join("")}}class GH extends MH{print(SN){let oH="";return oH+=this.printGroups(SN.groups),oH+=this.printMsidSemantic(SN.msidSemantic),oH+=this.printIceLite(SN.iceLite),oH+=this.printIceUfrag(SN.iceUfrag),oH+=this.printIcePwd(SN.icePwd),oH+=this.printIceOptions(SN.iceOptions),oH+=this.printFingerprints(SN.fingerprints),oH+=this.printSetup(SN.setup),oH+=this.printTlsId(SN.tlsId),oH+=this.printIdentity(SN.identities),oH+=this.printExtmap(SN.extmaps),oH+=this.printUnrecognized(SN.unrecognized),oH}printGroups(SN){let oH="";return SN.length>0&&(oH+=SN.map(fH=>"a=group:".concat(fH.semantic).concat(fH.identificationTag.map(xH=>"".concat(A).concat(xH)).join("")).concat(this.eol)).join("")),oH}printIceLite(SN){return SN===void 0?"":"a=ice-lite"+this.eol}printTlsId(SN){return SN?"a=tls-id:".concat(SN).concat(this.eol):""}printIdentity(SN){return SN.length===0?"":SN.map(oH=>"a=identity:".concat(oH.assertionValue).concat(oH.extensions.map(fH=>"".concat(A).concat(fH.name).concat(fH.value?"=".concat(fH.value):"")))).join(this.eol)+this.eol}printMsidSemantic(SN){if(!SN)return"";let oH="a=msid-semantic:".concat(SN.semantic);return SN.applyForAll?oH+="".concat(A,"*"):SN.identifierList.length>0&&(oH+=SN.identifierList.map(fH=>"".concat(A).concat(fH))),oH+this.eol}}class yH extends MH{print(SN){let oH=SN.attributes,fH="";return fH+=this.printRTCP(oH.rtcp),fH+=this.printIceUfrag(oH.iceUfrag),fH+=this.printIcePwd(oH.icePwd),fH+=this.printIceOptions(oH.iceOptions),fH+=this.printCandidates(oH.candidates),fH+=this.printRemoteCandidatesList(oH.remoteCandidatesList),fH+=this.printEndOfCandidates(oH.endOfCandidates),fH+=this.printFingerprints(oH.fingerprints),fH+=this.printSetup(oH.setup),fH+=this.printMid(oH.mid),fH+=this.printExtmap(oH.extmaps),fH+=this.printRTPRelated(oH),fH+=this.printPtime(oH.ptime),fH+=this.printMaxPtime(oH.maxPtime),fH+=this.printDirection(oH.direction),fH+=this.printSSRCGroups(oH.ssrcGroups),fH+=this.printSSRC(oH.ssrcs),fH+=this.printRTCPMux(oH.rtcpMux),fH+=this.printRTCPMuxOnly(oH.rtcpMuxOnly),fH+=this.printRTCPRsize(oH.rtcpRsize),fH+=this.printMSId(oH.msids),fH+=this.printImageattr(oH.imageattr),fH+=this.printRid(oH.rids),fH+=this.printSimulcast(oH.simulcast),fH+=this.printSCTPPort(oH.sctpPort),fH+=this.printMaxMessageSize(oH.maxMessageSize),fH+=this.printUnrecognized(oH.unrecognized),fH}printCandidates(SN){return SN.map(oH=>"a=candidate:".concat(oH.foundation).concat(A).concat(oH.componentId).concat(A).concat(oH.transport).concat(A).concat(oH.priority).concat(A).concat(oH.connectionAddress).concat(A).concat(oH.port).concat(A,"typ").concat(A).concat(oH.type).concat(oH.relAddr?"".concat(A,"raddr").concat(A).concat(oH.relAddr):"").concat(oH.relPort?"".concat(A,"rport").concat(A).concat(oH.relPort):"").concat(Object.keys(oH.extension).map(fH=>"".concat(A).concat(fH).concat(A).concat(oH.extension[fH])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(SN){return SN.map(oH=>"a=remote-candidates:".concat(oH.join(A)).concat(this.eol)).join("")}printEndOfCandidates(SN){return SN===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(SN){if(!SN.payloads)return"";let oH=SN.payloads,fH="";fH+=SN.rtcpFeedbackWildcards.map(xH=>this.printRTCPFeedback("*",xH)).join("");for(let xH of oH)fH+=this.printRtpMap(xH.payloadType,xH.rtpMap),fH+=this.printFmtp(xH.payloadType,xH.fmtp),fH+=xH.rtcpFeedbacks.map(l5=>this.printRTCPFeedback(xH.payloadType,l5)).join("");return fH}printFmtp(SN,oH){if(!oH)return"";let fH=Object.keys(oH.parameters);return fH.length===1&&oH.parameters[fH[0]]===null?"a=fmtp:".concat(SN).concat(A).concat(fH[0]).concat(this.eol):"a=fmtp:".concat(SN).concat(A).concat(Object.keys(oH.parameters).map(xH=>"".concat(xH,"=").concat(oH.parameters[xH])).join(";")).concat(this.eol)}printRtpMap(SN,oH){return oH?"a=rtpmap:".concat(SN).concat(A).concat(oH.encodingName,"/").concat(oH.clockRate).concat(oH.encodingParameters?"/".concat(oH.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(SN,oH){let fH="a=rtcp-fb:".concat(SN).concat(A),xH=oH;return xH.type==="trr-int"?fH+="ttr-int".concat(A).concat(xH.interval):(fH+="".concat(xH.type),xH.parameter&&(fH+="".concat(A).concat(xH.parameter),xH.additional&&(fH+="".concat(A).concat(xH.additional)))),fH+this.eol}printPtime(SN){return SN===void 0?"":"a=ptime:".concat(SN).concat(this.eol)}printMaxPtime(SN){return SN===void 0?"":"a=maxptime:".concat(SN).concat(this.eol)}printDirection(SN){return SN===void 0?"":"a=".concat(SN).concat(this.eol)}printSSRC(SN){return SN.map(oH=>Object.keys(oH.attributes).map(fH=>"a=ssrc:".concat(oH.ssrcId.toString(10)).concat(A).concat(fH).concat(oH.attributes[fH]?":".concat(oH.attributes[fH]):"").concat(this.eol)).join("")).join("")}printRTCPMux(SN){return SN===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(SN){return SN===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(SN){return SN===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(SN){if(SN===void 0)return"";let oH="a=rtcp:".concat(SN.port);return SN.netType&&(oH+="".concat(A).concat(SN.netType)),SN.addressType&&(oH+="".concat(A).concat(SN.addressType)),SN.address&&(oH+="".concat(A).concat(SN.address)),oH+this.eol}printMSId(SN){return SN.map(oH=>"a=msid:".concat(oH.id).concat(oH.appdata?"".concat(A).concat(oH.appdata):"").concat(this.eol)).join("")}printImageattr(SN){return SN.map(oH=>"a=imageattr:".concat(oH).concat(this.eol)).join("")}printRid(SN){return SN.map(oH=>{let fH="a=rid:".concat(oH.id).concat(A).concat(oH.direction);return oH.payloads&&(fH+="".concat(A,"pt=").concat(oH.payloads.join(","))),oH.params.length>0&&(fH+="".concat(A).concat(oH.params.map(xH=>xH.type==="depend"?"depend=".concat(xH.rids.join(",")):"".concat(xH.type,"=").concat(xH.val)).join(";"))),fH+this.eol}).join("")}printSimulcast(SN){return SN===void 0?"":"a=simulcast:".concat(SN).concat(this.eol)}printSCTPPort(SN){return SN===void 0?"":"a=sctp-port:".concat(SN).concat(this.eol)}printMaxMessageSize(SN){return SN===void 0?"":"a=max-message-size:".concat(SN).concat(this.eol)}printMid(SN){return SN===void 0?"":"a=mid:".concat(SN).concat(this.eol)}printSSRCGroups(SN){return SN.map(oH=>"a=ssrc-group:".concat(oH.semantic).concat(oH.ssrcIds.map(fH=>"".concat(A).concat(fH.toString(10))).join("")).concat(this.eol)).join("")}}function TH(gH){return new zH().parse(gH)}function NH(gH,SN){return new IH().print(gH,SN)}}},r={};function i(o){if(r[o])return r[o].exports;var h=r[o]={exports:{}};return e[o](h,h.exports,i),h.exports}return i.d=(o,h)=>{for(var p in h)i.o(h,p)&&!i.o(o,p)&&Object.defineProperty(o,p,{enumerable:!0,get:h[p]})},i.o=(o,h)=>Object.prototype.hasOwnProperty.call(o,h),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();var Le=e0.exports;function $E(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:v("SVC_MODE");if(v("ENABLE_SVC"))return function(r){return r in xE}(e)?e:xE.L1T3}function KI(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function YI(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?KI(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):KI(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Lc(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,{filterRTX:h,filterVideoFec:p,filterAudioFec:g,filterAudioCodec:C,filterVideoCodec:A}=r,{useXR:x}=i,_e=[],cN=[],dN=[],fN=[],mN=!1,EN=!1;if(Le.parse(e).mediaDescriptions.forEach(IN=>{o&&o!==IN.attributes.direction||(IN.media.mediaType!=="video"||mN||(cN=IN.attributes.payloads,fN=IN.attributes.extmaps,mN=!0),IN.media.mediaType!=="audio"||EN||(_e=IN.attributes.payloads,dN=IN.attributes.extmaps,EN=!0))}),!fN||cN.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!dN||_e.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(cN.forEach(IN=>{var t0;(t0=IN.rtpMap)!==null&&t0!==void 0&&t0.clockRate&&(IN.rtpMap.clockRate=parseInt(IN.rtpMap.clockRate)),x&&IN.rtcpFeedbacks.push({type:"rrtr"})}),_e.forEach(IN=>{var t0;(t0=IN.rtpMap)!==null&&t0!==void 0&&t0.clockRate&&(IN.rtpMap.clockRate=parseInt(IN.rtpMap.clockRate)),x&&IN.rtcpFeedbacks.push({type:"rrtr"})}),h&&(_e=_e.filter(IN=>{var t0;return((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName.toLowerCase())!=="rtx"}),cN=cN.filter(IN=>{var t0;return((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName.toLowerCase())!=="rtx"})),p&&(cN=cN.filter(IN=>{var t0;return!/(red)|(ulpfec)|(flexfec)/i.test(((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName)||"")})),g&&(_e=_e.filter(IN=>{var t0;return!/(red)|(ulpfec)|(flexfec)/i.test(((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName)||"")})),C&&(C==null?void 0:C.length)>0&&(_e=_e.filter(IN=>{var t0;return W(C).call(C,((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName.toLowerCase())||"")})),A&&(A==null?void 0:A.length)>0){let IN=cN.filter(t0=>{var aH;return W(A).call(A,((aH=t0.rtpMap)===null||aH===void 0?void 0:aH.encodingName.toLowerCase())||"")});cN=IN.concat(h?[]:yf(IN,cN))}let RN=v("UNSUPPORTED_VIDEO_CODEC");return RN&&RN.length>0&&(cN=cN.filter(IN=>!(IN.rtpMap&&W(RN).call(RN,IN.rtpMap.encodingName.toLowerCase())))),{audioCodecs:_e,videoCodecs:cN,audioExtensions:dN,videoExtensions:fN}}function io(e){let r=Le.parse(e),i,o;for(let h of r.mediaDescriptions){if(!i){let p=h.attributes.iceUfrag,g=h.attributes.icePwd;if(!p||!g)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:p,icePwd:g}}if(!o){let p=h.attributes.fingerprints;p.length>0&&(o={fingerprints:p})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function n0(e,r){let i=[],o=e.attributes.ssrcGroups.filter(g=>g.semantic==="FID"),h=e.attributes.ssrcGroups.find(g=>g.semantic==="SIM"),p=e.attributes.ssrcs;if(h)h.ssrcIds.forEach(g=>{var C;let A=(C=o.find(x=>x.ssrcIds[0]===g))===null||C===void 0?void 0:C.ssrcIds[1];i.push({ssrcId:g,rtx:r?A:void 0})});else if(o.length>0){let g=o[0].ssrcIds[0],C=o[0].ssrcIds[1];i.push({ssrcId:g,rtx:r?C:void 0})}else{if(p.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:p[0].ssrcId})}return i}function qI(e,r,i){let{cname:o}=e,h;r?h=i0(r):(h=e.iceParameters.candidates.map(_e=>({foundation:_e.foundation,componentId:"1",transport:_e.protocol,priority:_e.priority.toString(),connectionAddress:_e.ip,port:_e.port.toString(),type:_e.type,extension:{}})),_.debug("Using candidates from gateway."));let p={fingerprints:e.dtlsParameters.fingerprints.map(_e=>({hashFunction:_e.algorithm,fingerprint:_e.fingerprint}))},g={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},C;switch(e.dtlsParameters.role){case"server":C="passive";break;case"client":C="active";break;case"auto":C="actpass"}let A=uu(e.rtpCapabilities),x=[];return Array.isArray(i)&&i.length>0&&i.forEach(_e=>{x.push({kind:Q.VIDEO,ssrcId:_e.v,rtx:_e.v_rtx,mslabel:"".concat(_e.v,"_").concat(_e.a)},{kind:Q.AUDIO,ssrcId:_e.a,mslabel:"".concat(_e.v,"_").concat(_e.a)})}),{dtlsParameters:p,iceParameters:g,candidates:h,rtpCapabilities:A,setup:C,cname:o,preSSRCs:x}}function i0(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],_.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),_.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function Lo(e,r,i){let o=[],h=[];return e.forEach(p=>{let{ssrcId:g,rtx:C}=p,A=Ut(8,"track-"),x={ssrcId:g,attributes:YI({label:A,mslabel:i=i||Ut(10,""),msid:"".concat(i," ").concat(A)},r&&{cname:r})};if(o.push(x),C!==void 0){let _e={ssrcId:C,attributes:YI({label:A,mslabel:i,msid:"".concat(i," ").concat(A)},r&&{cname:r})};o.push(_e),h.push({semantic:"FID",ssrcIds:[g,C]})}}),e.length>1&&h.push({semantic:"SIM",ssrcIds:e.map(p=>{let{ssrcId:g}=p;return g})}),{ssrcs:o,ssrcGroups:h}}function ra(e,r){r instanceof Qt&&e.attributes.payloads.forEach(i=>{var o;let h=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!h||["opus","pcmu","pcma","g722"].indexOf(h)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let p=r._encoderConfig;p&&h!=="pcmu"&&h!=="pcma"&&h!=="g722"&&(p.bitrate&&!$t()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*p.bitrate))),p.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(p.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(p.sampleRate)),p.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function If(e){let r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function vf(e,r){var i;if(!(r instanceof Ft&&r._encoderConfig&&r._hints.indexOf(Gt.SCREEN_TRACK)===-1))return;let o=r._encoderConfig;ft().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(h=>{var p,g;W(p=["h264","h265","vp8","vp9","av1"]).call(p,((g=h.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")&&(h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),ft().supportMinBitrate&&!W(i=r._hints).call(i,Gt.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(h=>{var p,g;W(p=["h264","h265","vp8","vp9","av1"]).call(p,((g=h.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")&&(h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["x-google-start-bitrate"]="".concat(v("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function r0(e){if(e.media.mediaType!=="video")return;let r=mt();if(r.name!==It.SAFARI&&r.os!==ye.IOS)return;let i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function lu(e,r,i){if(!r)return;let o,h;if(e.media.mediaType==="video"?(o=i.videoExtensions,h=i.videoCodecs):(o=i.audioExtensions,h=i.audioCodecs),r.twcc===!0){let p=o.find(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");p&&(e.attributes.extmaps.find(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:p.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(g,C){return C.filter(A=>!!g.find(x=>x.payloadType===A.payloadType&&!!x.rtcpFeedbacks.find(_e=>_e.type==="transport-cc")))}(h,e.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(C=>C.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(r.twcc===!1){let p=e.attributes.extmaps.findIndex(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");p!==-1&&e.attributes.extmaps.splice(p,1),e.attributes.payloads.forEach(g=>{let C=g.rtcpFeedbacks.findIndex(A=>A.type==="transport-cc");C!==-1&&g.rtcpFeedbacks.splice(C,1)})}if(r.remb===!0){let p=o.find(g=>g.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");p&&(e.attributes.extmaps.find(g=>g.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:p.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(g,C){return C.filter(A=>!!g.find(x=>x.payloadType===A.payloadType&&!!x.rtcpFeedbacks.find(_e=>_e.type==="goog-remb")))}(h,e.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(C=>C.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(r.remb===!1){let p=e.attributes.extmaps.findIndex(g=>g.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");p!==-1&&e.attributes.extmaps.splice(p,1),e.attributes.payloads.forEach(g=>{let C=g.rtcpFeedbacks.findIndex(A=>A.type==="goog-remb");C!==-1&&g.rtcpFeedbacks.splice(C,1)})}}function o0(e,r,i){if($t()||e.media.mediaType!=="video"||!(r instanceof Ft)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!v("SIMULCAST")||i==="vp9"&&v("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;let o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,h=e.attributes.ssrcs[0],p=e.attributes.ssrcGroups.find(C=>C.semantic==="FID"&&C.ssrcIds[0]===h.ssrcId),g={semantic:"SIM",ssrcIds:[h.ssrcId]};for(let C=1;C<o;C++)e.attributes.ssrcs.push({ssrcId:h.ssrcId+C,attributes:le(h.attributes)}),g.ssrcIds.push(h.ssrcId+C),p&&(e.attributes.ssrcs.push({ssrcId:p.ssrcIds[1]+C,attributes:le(h.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[h.ssrcId+C,p.ssrcIds[1]+C]}));e.attributes.ssrcGroups.unshift(g)}async function s0(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let o=(await i.createOffer()).sdp,{send:h,recv:p,sendrecv:g}=function(){let C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0,_e=Lc(x,C,A,"sendonly"),cN=Lc(x,C,A,"recvonly"),dN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},fN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},mN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ii(_e,cN,"videoExtensions",dN,fN,mN),Ii(_e,cN,"videoCodecs",dN,fN,mN),Ii(_e,cN,"audioExtensions",dN,fN,mN),Ii(_e,cN,"audioCodecs",dN,fN,mN),v("RAISE_H264_BASELINE_PRIORITY")){let EN=mN.videoCodecs.findIndex(RN=>{var IN,t0;return((IN=RN.rtpMap)===null||IN===void 0?void 0:IN.encodingName.toLocaleLowerCase())==="h264"&&((t0=RN.fmtp)===null||t0===void 0?void 0:t0.parameters["profile-level-id"])==="42001f"});if(EN!==-1){let RN=mN.videoCodecs.findIndex(IN=>{var t0;return((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName.toLocaleLowerCase())==="h264"});if(RN<EN){_.debug("raising H264 baseline profile priority");let IN=mN.videoCodecs[EN];mN.videoCodecs.splice(EN,1),mN.videoCodecs.splice(RN,0,IN)}RN!==-1&&(fN.videoCodecs=fN.videoCodecs.filter(IN=>{var t0,aH;return!(((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName.toLocaleLowerCase())==="h264"&&((aH=IN.fmtp)===null||aH===void 0?void 0:aH.parameters["profile-level-id"])!=="42001f")})),RN!==-1&&v("FILTER_SEND_H264_BASELINE")&&(dN.videoCodecs=dN.videoCodecs.filter(IN=>{var t0,aH;return!(((t0=IN.rtpMap)===null||t0===void 0?void 0:t0.encodingName.toLocaleLowerCase())==="h264"&&((aH=IN.fmtp)===null||aH===void 0?void 0:aH.parameters["profile-level-id"])!=="42001f")}))}}return{send:dN,recv:fN,sendrecv:mN}}(e,r,o);try{i.close()}catch{}return{send:h,recv:p,sendrecv:g}}function zI(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=Lc(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ii(e,r,"videoExtensions",i,o,h),Ii(e,r,"videoCodecs",i,o,h),Ii(e,r,"audioExtensions",i,o,h),Ii(e,r,"audioCodecs",i,o,h),v("RAISE_H264_BASELINE_PRIORITY")){let p=h.videoCodecs.findIndex(g=>g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g.fmtp&&g.fmtp.parameters["profile-level-id"]==="42001f");if(p!==-1){let g=h.videoCodecs.findIndex(C=>C.rtpMap&&C.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(g<p){_.debug("raising H264 baseline profile priority");let C=h.videoCodecs[p];h.videoCodecs.splice(p,1),h.videoCodecs.splice(g,0,C)}g!==-1&&(o.videoCodecs=o.videoCodecs.filter(C=>!(C.rtpMap&&C.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&C.fmtp&&C.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:h}}function Ii(e,r,i,o,h,p){if(i==="videoExtensions"||i==="audioExtensions"){let g=[];return e[i].forEach(C=>{r[i].some((A,x)=>{if(C.entry===A.entry&&C.extensionName===A.extensionName)return g.push(x),!0})?p[i].push(C):o[i].push(C)}),void r[i].forEach((C,A)=>{g.indexOf(A)===-1&&h[i].push(C)})}if(i==="videoCodecs"||i==="audioCodecs"){let g=[];return e[i].forEach(C=>{r[i].some((A,x)=>{if(C.payloadType===A.payloadType&&JSON.stringify(C)===JSON.stringify(A))return g.push(x),!0})?p[i].push(C):o[i].push(C)}),void r[i].forEach((C,A)=>{g.indexOf(A)===-1&&h[i].push(C)})}}function uu(e){let{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let h,p;return r?(h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h.audioCodecs=[...r.audioCodecs,...o.audioCodecs],h.videoCodecs=[...r.videoCodecs,...o.videoCodecs],h.audioExtensions=[...r.audioExtensions,...o.audioExtensions],h.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):h=o,i?(p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p.audioCodecs=[...i.audioCodecs,...o.audioCodecs],p.videoCodecs=[...i.videoCodecs,...o.videoCodecs],p.audioExtensions=[...i.audioExtensions,...o.audioExtensions],p.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):p=o,{send:h,recv:p}}function oa(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function ac(e,r,i,o){let h=[];if(e===Q.VIDEO){if(v("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(h=r.videoCodecs.filter(p=>{var g;return W(g=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(g,o)&&p&&p.fmtp&&p.fmtp.parameters["profile-level-id"]===v("H264_PROFILE_LEVEL_ID")})),!Array.isArray(h)||h.length===0){let p=[],g=[],C=[],A=[];if(i.videoCodecs.forEach(x=>{let _e=x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"";W(_e).call(_e,o)?p.push(x):W(_e).call(_e,"vp9")?g.push(x):W(_e).call(_e,"vp8")?C.push(x):W(_e).call(_e,"h264")&&A.push(x)}),p.length===0){let x="";g.length!==0?(p=g,x="vp9"):C.length!==0?(p=C,x="vp8"):A.length!==0&&(p=A,x="h264"),_.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(x))}p.length!==0&&(h=r.videoCodecs.filter(x=>p.some(_e=>_e.payloadType===x.payloadType)))}if(h.length===0&&(_.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),h=r.videoCodecs),v("USE_PUB_RTX")||v("USE_SUB_RTX")){let p=yf(h,r.videoCodecs);h=[...h,...p]}}else h=r.audioCodecs.filter(p=>{var g;return W(g=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(g,o)}),h.length===0&&(_.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),h=r.audioCodecs.filter(p=>{var g;return W(g=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(g,"opus")}));return h}function yf(e,r){let i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&W(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function Wd(e,r,i){let o=r.toString(),h=c0(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});let p=await e.createAnswer();if(!p.sdp)throw new Error("cannot get answer sdp");let g=p.sdp;g=a0(g,i||{}),h==null||h(g||""),await e.setLocalDescription({type:"answer",sdp:g})}function a0(e,r,i){let o=Le.parse(e),{useXR:h}=r;return o.mediaDescriptions.forEach(p=>{var g;p.attributes.mid&&(Array.isArray(i)&&!W(i).call(i,p.attributes.mid)||(p.media.mediaType==="audio"&&oa(p),h&&W(g=["audio","video"]).call(g,p.media.mediaType)&&p.attributes.payloads.forEach(C=>{C.rtcpFeedbacks.findIndex(A=>A.type==="rrtr")===-1&&C.rtcpFeedbacks.push({type:"rrtr"})})))}),Le.print(o)}function c0(e,r,i,o){if(v("SDP_LOGGING"))return _.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?h=>{c0(h,"answer",i==="local"?"remote":"local",o)}:void 0}function Xi(e,r){return typeof v(e)===r?v(e):void 0}function JI(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function jr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?JI(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JI(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var d_=new Map,tm=class extends Xt{get state(){return this._state}set state(e){if(e===this._state)return;let r=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(xe.CONNECTION_STATE_CHANGE,e,r,this._disconnectedReason):this.emit(xe.CONNECTION_STATE_CHANGE,e,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){_.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,r){super(),T(this,"store",void 0),T(this,"joinInfo",void 0),T(this,"key",void 0),T(this,"ntpOffset",0),T(this,"signal",void 0),T(this,"role",void 0),T(this,"inChannelInfo",{joinAt:null,duration:0}),T(this,"spec",void 0),T(this,"_state","DISCONNECTED"),T(this,"_statsCollector",void 0),T(this,"_disconnectedReason",void 0),T(this,"isSignalRecover",!1),T(this,"hasChangeBGPAddress",!1),T(this,"trafficStatsInterval",void 0),T(this,"networkQualityInterval",void 0),T(this,"_joinGatewayStartTime",0),T(this,"_signalTimeout",!1),T(this,"_clientRoleOptions",void 0),T(this,"_isProactiveJoin",!1),this.store=e,this.spec=r,this.signal=this.store.useP2P?new du(jr(jr({},r),{},{retryConfig:r.websocketRetryConfig}),e):new jE(jr(jr({},r),{},{retryConfig:r.websocketRetryConfig}),e),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(e,r,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let o=Date.now(),h=d_.get(e.cname);if(h||(h=new Map,d_.set(e.cname,h)),this._isProactiveJoin=!0,h.has(e.uid)){let A=new O(R.UID_CONFLICT);throw X.joinGateway(e.sid,{lts:o,succ:!1,ec:A.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,A}h.set(e.uid,!0),this.joinInfo=e,this.key=r;let p=0;this.joinGatewayStartTime=o;let g=e.proxyServer;try{_.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(p));let A=e.gatewayAddrs.map(x=>{let{address:_e}=x,[cN,dN]=_e.split(":"),fN={host:cN,port:dN};return e.proxyServer&&(fN.proxy=e.proxyServer),fN});p=(await this.signal.init(A,i)).uid,_.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(p," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(A){var C;throw _.error("[".concat(this.store.clientId,"] User join failed"),A.toString()),X.joinGateway(e.sid,{lts:o,succ:!1,ec:((C=A.data)===null||C===void 0?void 0:C.desc)||A.code,errorMsg:A.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!g,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,h.delete(e.uid),this.signal.close(),A}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),_.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(A=>{_.warning("[".concat(this.store.clientId,"] get traffic stats error"),A.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(xe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(xe.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(xe.NETWORK_QUALITY,{uplinkNetworkQuality:WR(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:WR(this._statsCollector.trafficStats.B_dnq)}):this.emit(xe.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),p}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==At.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Lt.CONNECTED||await function(i,o){return o===1/0?i:j.race([i,mB(o)])}(this.signal.request(et.LEAVE,void 0,!0),3e3)}catch(i){_.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(r),r!==At.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let o={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:v("PUB_EXTEND"),twcc:!!v("PUBLISH_TWCC"),rtx:!!v("USE_PUB_RTX")};try{return(await this.signal.request(et.PUBLISH,o,!0))._message}catch(h){if(i&&h.data&&h.data.code===Z.ERR_PUBLISH_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),h.toString()),await this.tryUnpubBeforeRepub(e,r),this.publish(e,r,!1);throw h}}async publishDataChannel(e,r,i){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(o=r.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(et.PUBLISH_DATASTREAM,h,!0)}catch(p){if(i&&p.data&&p.data.code===Z.ERR_PUBLISH_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),await this.tryUnpubDataChannelBeforeRepub(e,r),this.publishDataChannel(e,r,!1);throw p}}async unpublish(e,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(et.UNPUBLISH,{stream_id:r,ortc:e},!0)}catch(i){_.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await j.all(e.map(r=>this.signal.request(et.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){_.warning("unpublish datachannels warning: ",r)}}async presubscribe(e,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let o={stream_id:e,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!v("SUBSCRIBE_TWCC"),rtx:!!v("USE_SUB_RTX")||void 0,extend:v("SUB_EXTEND"),svc:Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0};try{return await this.signal.request(et.PRE_SUBSCRIBE,o,!0)}catch(h){if(i&&h.data&&h.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),h.toString()),this.presubscribe(e,r,!1);throw h}}async subscribe(e,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let o={stream_id:e,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!v("SUBSCRIBE_TWCC"),rtx:!!v("USE_SUB_RTX"),extend:v("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0};try{return(await this.signal.request(et.SUBSCRIBE,o,!0))._message}catch(h){if(i&&h.data&&h.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),h.toString()),await this.tryUnsubBeforeResub(e,r),await this.subscribe(e,r,!1);throw h}}async subscribeDataChannel(e,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let o={uid:e,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(et.SUBSCRIBE_DATASTREAM,o,!0)}catch(h){if(i&&h.data&&h.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),await this.tryUnsubDataChannelBeforeResub(e,r),await this.subscribeDataChannel(e,r,!1);throw h}}async subscribeAll(e,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!v("USE_SUB_RTX"),twcc:!!v("SUBSCRIBE_TWCC"),svc:Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0};try{return await this.signal.request(et.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(r&&o.data&&o.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw o}}async setVideoProfile(e){let r=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,h=i.width,p=i.height,g=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(g=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,h||(g=!1)),typeof p!="number"&&(p=p.exact||p.ideal||p.max||p.min||0,o||(g=!1)),g?{stream_type:0,width:h,height:p,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(r)return this.signal.request(et.SET_VIDEO_PROFILE,r);_.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,r){try{await this.signal.request(et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:r},!0)}catch(i){_.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await j.all(e.map(i=>this.signal.request(et.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:r},!0)))}catch(i){_.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(et.UNSUBSCRIBE_STREAMS,e,!0)}catch(r){_.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(e){let{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=e;return{gatewayEstablishParams:await this.signal.request(et.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(et.GATEWAY_INFO)}async renewToken(e){await this.signal.request(et.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),this.state!=="CONNECTED")return void(this.role=e);let i,o=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0,await this.signal.request(et.SET_CLIENT_ROLE,{role:e,level:o,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,r){await this.signal.request(et.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:r})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(et.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,r){await this.signal.request(et.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:r})}async pickSVCLayer(e,r){await this.signal.request(et.PICK_SVC_LAYER,{stream_id:e,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(e){await this.signal.request(et.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,r,i){if(this.signal instanceof du)return this.signal.sendExtensionMessage(e,r,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),jr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(et.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=d_.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=function(r){let i;return i=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Ve.username,password:Ve.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(jr(jr({},Ve),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e=await this.signal.request(et.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(r=>{let i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===r.peer_uid);i&&i.B_st!==r.B_st&&qu(()=>{this.emit(xe.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new O(R.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),i=v("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);let o=!($t()||EO(87)||pC())&&typeof v("ENABLE_PRE_SUB")=="boolean"&&v("ENABLE_PRE_SUB"),h=!pC()&&Xi("ENABLE_PREALLOC_PC","boolean"),p=jr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ii,browser:navigator.userAgent,process_id:v("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:v("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:v("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:v("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof v("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?v("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof v("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?v("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof v("ENABLE_USER_LICENSE_CHECK")=="boolean"?v("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:v("USE_PUB_RTX")===!0||v("USE_SUB_RTX")===!0||void 0,disableFEC:v("DISABLE_FEC"),enableNTPReport:!!v("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!v("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!v("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Xi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!v("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!v("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Xi("USE_XR","boolean"),enableLossbasedBwe:Xi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!v("ENABLE_AUT_CC")||void 0,enableCCFallback:Xi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:o?Xi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Xi("PUBLISH_TWCC","boolean"),enableSubTWCC:Xi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Xi("USE_PUB_RTX","boolean"),enableSubRTX:Xi("USE_SUB_RTX","boolean"),enableSubSVC:v("ENABLE_SVC")?v("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(p.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(p.aes_mode=this.joinInfo.aesmode,v("ENCRYPT_AES")?(p.aes_secret=this.joinInfo.aespassword,p.aes_encrypt=!0):p.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(p.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(p.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(p.default_video_stream=this.joinInfo.defaultVideoStream),p}getRejoinMessage(){if(!this.joinInfo)throw new O(R.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(nt.WS_RECONNECT_WAITTING_FINISH,e=>{var r;W(r=["tryNext","recover"]).call(r,e)&&this.joinInfo&&X.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(nt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(nt.WS_RECONNECTING,e=>{this.joinInfo&&X.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Be.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",X.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(nt.WS_CLOSED,e=>{let r;switch(e){case At.LEAVE:r=Be.LEAVE;break;case At.UID_BANNED:case At.IP_BANNED:case At.CHANNEL_BANNED:case At.SERVER_ERROR:r=Be.SERVER_ERROR;break;case At.FALLBACK:r=Be.FALLBACK;break;case At.LICENSE_MISSING:case At.LICENSE_EXPIRED:case At.LICENSE_MINUTES_EXCEEDED:case At.LICENSE_PERIOD_INVALID:case At.LICENSE_MULTIPLE_SDK_SERVICE:case At.LICENSE_ILLEGAL:case At.TOKEN_EXPIRE:r=e;break;default:r=Be.NETWORK_ERROR}_.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+Be.NETWORK_ERROR)),this.joinInfo&&X.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===At.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=e,e!==At.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(nt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(_.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),X.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void _.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Ot("EVENT_REPORT_DOMAIN",e[1]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Ot("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(dt.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(nt.REQUEST_RECOVER,(e,r,i)=>{if(!this.joinInfo)return i(new O(R.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ge(this,xe.REQUEST_NEW_GATEWAY_LIST).then(r).catch(i)}),this.signal.on(nt.REQUEST_JOIN_INFO,async e=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let{iceParameters:i,dtlsParameters:o,rtpCapabilities:h}=await Ge(this,xe.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r=this.joinInfo)===null||r===void 0?void 0:r.turnServer});e(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:h,version:"2"}}))}),this.signal.on(nt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(nt.REPORT_JOIN_GATEWAY,(e,r)=>{if(!this.joinInfo)return;let i,o="";var h;e instanceof O?(i=((h=e.data)===null||h===void 0?void 0:h.desc)||e.code,o=e.message):i=e,X.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:o,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(nt.IS_P2P_DISCONNECTED,e=>{e(Ac(this,xe.IS_P2P_DISCONNECTED))}),this.signal.on(nt.DISCONNECT_P2P,()=>{this.emit(xe.DISCONNECT_P2P)}),this.signal.on(nt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(nt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(nt.JOIN_RESPONSE,e=>{let r=this.getCurrentGatewayAddress();this.emit(xe.JOIN_RESPONSE,e,r)}),this.signal.on(nt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),r=v("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&r){let i=i0(e);this.emit(xe.PRE_CONNECT_PC,{candidates:i,fingerprint:r})}}})}async tryUnsubBeforeResub(e,r){try{await this.signal.request(et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[r]},!0)}catch(i){throw _.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,r){try{await this.signal.request(et.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(i){throw _.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,r){try{await this.signal.request(et.UNPUBLISH,{stream_id:e,ortc:r},!0)}catch(i){throw _.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,r){try{await this.signal.request(et.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(i){throw _.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){let r={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(et.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){throw _.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,r){let i={action:e.find(o=>o.stream_type===Ct.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:r};try{await this.signal.request(et.CONTROL,i,!0,!0)}catch(o){throw _.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(e,r){let i={action:e.find(o=>o.stream_type===Ct.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:r};try{await this.signal.request(et.CONTROL,i,!0,!0)}catch(o){throw _.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(e,r){let i={action:e===Q.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(et.CONTROL,i,!0,!0)}catch(o){throw _.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(e,r){let i={action:e===Q.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(et.CONTROL,i,!0,!0)}catch(o){throw _.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,r){this.signal.upload(e,r)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(et.RESTART_ICE,r,!0)}catch(i){throw _.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Be.P2P_FAILED)}getCurrentGatewayAddress(){var e,r;if(!v("GATEWAY_WSS_ADDRESS"))return v("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(_.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(et.SET_PARAMETER,{enablePublishAudioFilter:e})}},Hd=0,l_=0;function Hi(e,r,i,o){return new j((h,p)=>{r.timeout=r.timeout||v("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),Hd+=ar(r.data)):i&&(r.data.size?Hd+=r.data.size:r.data instanceof FormData?Hd+=AO(r.data):Hd+=ar(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,mn.request(r).then(g=>{typeof g.data=="string"?l_+=ar(g.data):g.data instanceof ArrayBuffer||g.data instanceof Uint8Array?l_+=g.data.byteLength:l_+=ar(JSON.stringify(g.data)),o&&h({data:g.data,headers:g.headers}),h(g.data)}).catch(g=>{mn.isCancel(g)?p(new O(R.OPERATION_ABORTED,"cancel token canceled")):g.code==="ECONNABORTED"?p(new O(R.NETWORK_TIMEOUT,g.message)):g.response?p(new O(R.NETWORK_RESPONSE_ERROR,g.response.status)):p(new O(R.NETWORK_ERROR,g.message))})})}(function(){var e;function r(yH){var TH=0;return function(){return TH<yH.length?{done:!1,value:yH[TH++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(yH,TH,NH){return yH==Array.prototype||yH==Object.prototype||(yH[TH]=NH.value),yH},o,h=function(yH){yH=[typeof globalThis=="object"&&globalThis,yH,typeof window=="object"&&window,typeof self=="object"&&self,typeof Vs=="object"&&Vs];for(var TH=0;TH<yH.length;++TH){var NH=yH[TH];if(NH&&NH.Math==Math)return NH}throw Error("Cannot find global object")}(this);function p(yH,TH){if(TH)e:{var NH=h;yH=yH.split(".");for(var gH=0;gH<yH.length-1;gH++){var SN=yH[gH];if(!(SN in NH))break e;NH=NH[SN]}(TH=TH(gH=NH[yH=yH[yH.length-1]]))!=gH&&TH!=null&&i(NH,yH,{configurable:!0,writable:!0,value:TH})}}function g(yH){return(yH={next:yH})[Symbol.iterator]=function(){return this},yH}function C(yH){var TH=typeof Symbol<"u"&&Symbol.iterator&&yH[Symbol.iterator];return TH?TH.call(yH):{next:r(yH)}}if(p("Symbol",function(yH){function TH(SN,oH){this.A=SN,i(this,"description",{configurable:!0,writable:!0,value:oH})}if(yH)return yH;TH.prototype.toString=function(){return this.A};var NH="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",gH=0;return function SN(oH){if(this instanceof SN)throw new TypeError("Symbol is not a constructor");return new TH(NH+(oH||"")+"_"+gH++,oH)}}),p("Symbol.iterator",function(yH){if(yH)return yH;yH=Symbol("Symbol.iterator");for(var TH="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),NH=0;NH<TH.length;NH++){var gH=h[TH[NH]];typeof gH=="function"&&typeof gH.prototype[yH]!="function"&&i(gH.prototype,yH,{configurable:!0,writable:!0,value:function(){return g(r(this))}})}return yH}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var A;e:{var x={};try{x.__proto__={a:!0},A=x.a;break e}catch{}A=!1}o=A?function(yH,TH){if(yH.__proto__=TH,yH.__proto__!==TH)throw new TypeError(yH+" is not extensible");return yH}:null}var _e=o;function cN(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function dN(yH){if(yH.m)throw new TypeError("Generator is already running");yH.m=!0}function fN(yH,TH){return yH.h=3,{value:TH}}function mN(yH){this.g=new cN,this.G=yH}function EN(yH,TH,NH,gH){try{var SN=TH.call(yH.g.j,NH);if(!(SN instanceof Object))throw new TypeError("Iterator result "+SN+" is not an object");if(!SN.done)return yH.g.m=!1,SN;var oH=SN.value}catch(fH){return yH.g.j=null,yH.g.s(fH),RN(yH)}return yH.g.j=null,gH.call(yH.g,oH),RN(yH)}function RN(yH){for(;yH.g.h;)try{var TH=yH.G(yH.g);if(TH)return yH.g.m=!1,{value:TH.value,done:!1}}catch(NH){yH.g.v=void 0,yH.g.s(NH)}if(yH.g.m=!1,yH.g.l){if(TH=yH.g.l,yH.g.l=null,TH.F)throw TH.D;return{value:TH.return,done:!0}}return{value:void 0,done:!0}}function IN(yH){this.next=function(TH){return yH.o(TH)},this.throw=function(TH){return yH.s(TH)},this.return=function(TH){return function(NH,gH){dN(NH.g);var SN=NH.g.j;return SN?EN(NH,"return"in SN?SN.return:function(oH){return{value:oH,done:!0}},gH,NH.g.return):(NH.g.return(gH),RN(NH))}(yH,TH)},this[Symbol.iterator]=function(){return this}}function t0(yH,TH){return TH=new IN(new mN(TH)),_e&&yH.prototype&&_e(TH,yH.prototype),TH}if(cN.prototype.o=function(yH){this.v=yH},cN.prototype.s=function(yH){this.l={D:yH,F:!0},this.h=this.C||this.u},cN.prototype.return=function(yH){this.l={return:yH},this.h=this.u},mN.prototype.o=function(yH){return dN(this.g),this.g.j?EN(this,this.g.j.next,yH,this.g.o):(this.g.o(yH),RN(this))},mN.prototype.s=function(yH){return dN(this.g),this.g.j?EN(this,this.g.j.throw,yH,this.g.o):(this.g.s(yH),RN(this))},p("Array.prototype.entries",function(yH){return yH||function(){return function(TH,NH){TH instanceof String&&(TH+="");var gH=0,SN=!1,oH={next:function(){if(!SN&&gH<TH.length){var fH=gH++;return{value:NH(fH,TH[fH]),done:!1}}return SN=!0,{done:!0,value:void 0}}};return oH[Symbol.iterator]=function(){return oH},oH}(this,function(TH,NH){return[TH,NH]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var aH=function(yH,TH){for(var NH=0;NH<yH.length;NH++)TH(yH[NH])},pH=function(yH){return yH.replace(/\r?\n|\r/g,`\r
`)},SH=function(yH,TH,NH){return TH instanceof Blob?(NH=NH!==void 0?NH+"":typeof TH.name=="string"?TH.name:"blob",TH.name===NH&&Object.prototype.toString.call(TH)!=="[object Blob]"||(TH=new File([TH],NH)),[String(yH),TH]):[String(yH),String(TH)]},vH=function(yH,TH){if(yH.length<TH)throw new TypeError(TH+" argument required, but only "+yH.length+" present.")},AH=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,UH=AH.FormData,zH=AH.XMLHttpRequest&&AH.XMLHttpRequest.prototype.send,CH=AH.Request&&AH.fetch,HH=AH.navigator&&AH.navigator.sendBeacon,VH=AH.Element&&AH.Element.prototype,KH=AH.Symbol&&Symbol.toStringTag;KH&&(Blob.prototype[KH]||(Blob.prototype[KH]="Blob"),"File"in AH&&!File.prototype[KH]&&(File.prototype[KH]="File"));try{new File([],"")}catch{AH.File=function(yH,TH,NH){return yH=new Blob(yH,NH||{}),Object.defineProperties(yH,{name:{value:TH},lastModified:{value:+(NH&&NH.lastModified!==void 0?new Date(NH.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),KH&&Object.defineProperty(yH,KH,{value:"File"}),yH}}var IH=function(yH){return yH.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},MH=function(yH){this.i=[];var TH=this;yH&&aH(yH.elements,function(NH){if(NH.name&&!NH.disabled&&NH.type!=="submit"&&NH.type!=="button"&&!NH.matches("form fieldset[disabled] *"))if(NH.type==="file"){var gH=NH.files&&NH.files.length?NH.files:[new File([],"",{type:"application/octet-stream"})];aH(gH,function(SN){TH.append(NH.name,SN)})}else NH.type==="select-multiple"||NH.type==="select-one"?aH(NH.options,function(SN){!SN.disabled&&SN.selected&&TH.append(NH.name,SN.value)}):NH.type==="checkbox"||NH.type==="radio"?NH.checked&&TH.append(NH.name,NH.value):(gH=NH.type==="textarea"?pH(NH.value):NH.value,TH.append(NH.name,gH))})};if((e=MH.prototype).append=function(yH,TH,NH){vH(arguments,2),this.i.push(SH(yH,TH,NH))},e.delete=function(yH){vH(arguments,1);var TH=[];yH=String(yH),aH(this.i,function(NH){NH[0]!==yH&&TH.push(NH)}),this.i=TH},e.entries=function yH(){var TH,NH=this;return t0(yH,function(gH){if(gH.h==1&&(TH=0),gH.h!=3)return TH<NH.i.length?gH=fN(gH,NH.i[TH]):(gH.h=0,gH=void 0),gH;TH++,gH.h=2})},e.forEach=function(yH,TH){vH(arguments,1);for(var NH=C(this),gH=NH.next();!gH.done;gH=NH.next()){var SN=C(gH.value);gH=SN.next().value,SN=SN.next().value,yH.call(TH,SN,gH,this)}},e.get=function(yH){vH(arguments,1);var TH=this.i;yH=String(yH);for(var NH=0;NH<TH.length;NH++)if(TH[NH][0]===yH)return TH[NH][1];return null},e.getAll=function(yH){vH(arguments,1);var TH=[];return yH=String(yH),aH(this.i,function(NH){NH[0]===yH&&TH.push(NH[1])}),TH},e.has=function(yH){vH(arguments,1),yH=String(yH);for(var TH=0;TH<this.i.length;TH++)if(this.i[TH][0]===yH)return!0;return!1},e.keys=function yH(){var TH,NH,gH,SN,oH=this;return t0(yH,function(fH){if(fH.h==1&&(TH=C(oH),NH=TH.next()),fH.h!=3)return NH.done?void(fH.h=0):(gH=NH.value,SN=C(gH),fN(fH,SN.next().value));NH=TH.next(),fH.h=2})},e.set=function(yH,TH,NH){vH(arguments,2),yH=String(yH);var gH=[],SN=SH(yH,TH,NH),oH=!0;aH(this.i,function(fH){fH[0]===yH?oH&&(oH=!gH.push(SN)):gH.push(fH)}),oH&&gH.push(SN),this.i=gH},e.values=function yH(){var TH,NH,gH,SN,oH=this;return t0(yH,function(fH){if(fH.h==1&&(TH=C(oH),NH=TH.next()),fH.h!=3)return NH.done?void(fH.h=0):(gH=NH.value,(SN=C(gH)).next(),fN(fH,SN.next().value));NH=TH.next(),fH.h=2})},MH.prototype._asNative=function(){for(var yH=new UH,TH=C(this),NH=TH.next();!NH.done;NH=TH.next()){var gH=C(NH.value);NH=gH.next().value,gH=gH.next().value,yH.append(NH,gH)}return yH},MH.prototype._blob=function(){var yH="----formdata-polyfill-"+Math.random(),TH=[],NH="--"+yH+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(gH,SN){return typeof gH=="string"?TH.push(NH+IH(pH(SN))+`"\r
\r
`+pH(gH)+`\r
`):TH.push(NH+IH(pH(SN))+'"; filename="'+IH(gH.name)+`"\r
Content-Type: `+(gH.type||"application/octet-stream")+`\r
\r
`,gH,`\r
`)}),TH.push("--"+yH+"--"),new Blob(TH,{type:"multipart/form-data; boundary="+yH})},MH.prototype[Symbol.iterator]=function(){return this.entries()},MH.prototype.toString=function(){return"[object FormData]"},VH&&!VH.matches&&(VH.matches=VH.matchesSelector||VH.mozMatchesSelector||VH.msMatchesSelector||VH.oMatchesSelector||VH.webkitMatchesSelector||function(yH){for(var TH=(yH=(this.document||this.ownerDocument).querySelectorAll(yH)).length;0<=--TH&&yH.item(TH)!==this;);return-1<TH}),KH&&(MH.prototype[KH]="FormData"),zH){var GH=AH.XMLHttpRequest.prototype.setRequestHeader;AH.XMLHttpRequest.prototype.setRequestHeader=function(yH,TH){GH.call(this,yH,TH),yH.toLowerCase()==="content-type"&&(this.B=!0)},AH.XMLHttpRequest.prototype.send=function(yH){yH instanceof MH?(yH=yH._blob(),this.B||this.setRequestHeader("Content-Type",yH.type),zH.call(this,yH)):zH.call(this,yH)}}CH&&(AH.fetch=function(yH,TH){return TH&&TH.body&&TH.body instanceof MH&&(TH.body=TH.body._blob()),CH.call(this,yH,TH)}),HH&&(AH.navigator.sendBeacon=function(yH,TH){return TH instanceof MH&&(TH=TH._asNative()),HH.call(this,yH,TH)}),AH.FormData=MH}})();var Mc=()=>{let e=v("AREAS");return e.length===0&&e.push(St.GLOBAL),ji(e).call(e,(r,i,o)=>{let h=d0(i);return h?o===0?h:"".concat(r,",").concat(h):r},"")},d0=e=>e===St.OVERSEA?"".concat(Ye.ASIA,",").concat(Ye.EUROPE,",").concat(Ye.AFRICA,",").concat(Ye.NORTH_AMERICA,",").concat(Ye.SOUTH_AMERICA,",").concat(Ye.OCEANIA):Ye[e],jG=e=>{let r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let o=Zu[i],h=Object.keys(o);h&&h.map(p=>{p!=="CODE"&&(r[p]=r[p].concat(o[p]))})}),r},yl={GLOBAL:{ASIA:[St.CHINA,St.JAPAN,St.INDIA,St.KOREA,St.HKMC],EUROPE:[],NORTH_AMERICA:[St.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Kd=Object.keys(yl[St.GLOBAL]),u_=[St.CHINA,St.NORTH_AMERICA,St.EUROPE,St.ASIA,St.JAPAN,St.INDIA,St.OCEANIA,St.SOUTH_AMERICA,St.AFRICA,St.KOREA,St.HKMC,St.US],GG=function(e,r){let i=[];if(W(e).call(e,St.GLOBAL)){let p=[St.GLOBAL,St.OVERSEA],g=Object.keys(Zu);if(r===St.GLOBAL)throw new O(R.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===St.CHINA)i=[St.OVERSEA];else if(h=r,W(Kd).call(Kd,h)){let C=(o=r,yl[St.GLOBAL][o]||[]),A=[...p,r,...C];i=g.filter(x=>!W(A).call(A,x))}else if(function(C){let A=!1;return Kd.forEach(x=>{var _e;W(_e=yl[St.GLOBAL][x]).call(_e,C)&&(A=!0)}),A}(r)){let C=function(x){let _e;return Kd.forEach(cN=>{var dN;W(dN=yl[St.GLOBAL][cN]).call(dN,x)&&(_e=cN)}),_e}(r),A=[...p,C,r];i=g.filter(x=>!W(A).call(A,x))}else i=e;i=function(C){let A=[];return u_.forEach(x=>{W(C).call(C,x)&&A.push(x)}),A.concat(C.filter(x=>!W(u_).call(u_,x)))}(i)}else i=e;var o,h;return i};function XI(e){var r,i;if(!e&&W(r=v("AREAS")).call(r,St.EXTENSIONS))return _.debug("update area from ap : reset"),void Af(vB,!0);if(!W(i=v("AREAS")).call(i,St.GLOBAL)||!e)return;let o=Zu.EXTENSIONS;o&&(o={CODE:d0(St.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},_.debug("update area from ap success: ".concat(e,",config is "),o),Ot("AREAS",[St.EXTENSIONS],!0),Object.keys(o).map(h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?Ot(h,o[h][0]):Ot(h,o[h])}))}function Af(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=X.reportApiInvoke(null,{name:Te.SET_AREA,options:e,tag:Zt.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(p=>{if(!W(UR).call(UR,p))throw new O(R.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:p,excludedArea:g}=e;if(!p)throw new O(R.INVALID_PARAMS,"area code is needed");let C=p;typeof p=="string"&&(C=[p]),o=g?GG(C,g):C}if(!r){if($r.AREAS){let p=new O(R.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(p),void _.warning("setArea is prohibited because of config-distribute")}if(W(o).call(o,St.GLOBAL)&&v("AREAS")===St.EXTENSIONS){let p=new O(R.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(p),void _.warning("setArea is prohibited because of ap extensions")}}Ot("AREAS",o,r);let h=jG(o);Object.keys(h).map(p=>{p==="LOG_UPLOAD_SERVER"||p==="EVENT_REPORT_DOMAIN"||p==="EVENT_REPORT_BACKUP_DOMAIN"||p==="PROXY_SERVER_TYPE3"?Ot(p,h[p][0]):Ot(p,h[p])}),_.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function QI(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function em(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?QI(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):QI(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var h_=1;function WG(e,r,i,o,h){h_+=1;let p={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:h_,requestId:h_,version:ii,cname:i.cname},g={service_name:r,json_body:JSON.stringify(p)},C,A,x=e[0];return Wi(async()=>{C=Date.now();let _e=await Hi(x,{data:g,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(A=Date.now()-C,_e.code!==0){let fN=new O(R.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_e.code,{retry:!0,responseTime:A});throw _.error(fN.toString()),fN}let cN=JSON.parse(_e.json_body);if(cN.code!==200){let fN=new O(R.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(cN.code,", reason: ").concat(cN.reason),{code:cN.code,responseTime:A});throw _.error(fN.toString()),fN}if(!cN.servers||cN.servers.length===0){let fN=new O(R.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:cN.code,responseTime:A});throw _.error(fN.toString()),fN}let dN=function(fN,mN){return{addressList:fN.servers.map(EN=>"wss://".concat(EN.address.replace(/\./g,"-"),".").concat(v("WORKER_DOMAIN"),":").concat(EN.wss,"?serviceName=").concat(encodeURIComponent(mN))),workerToken:fN.workerToken,vid:fN.vid}}(cN,r);return v("LIVE_STREAMING_ADDRESS")&&(dN.addressList=v("LIVE_STREAMING_ADDRESS")instanceof Array?v("LIVE_STREAMING_ADDRESS"):[v("LIVE_STREAMING_ADDRESS")]),em(em({},dN),{},{responseTime:A})},(_e,cN)=>(X.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(_e.addressList),firstSuccess:cN===0,responseTime:A,serverIp:e[cN%e.length]}),!1),(_e,cN)=>(X.apworkerEvent(i.sid,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:r,responseTime:A,serverIp:e[cN%e.length]}),!!(_e.code!==R.OPERATION_ABORTED&&_e.code!==R.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(x=e[(cN+1)%e.length],!0)),h)}var p_=1;function ZI(e,r,i,o){let{url:h,areaCode:p}=e,{clientId:g,sid:C}=r,A=Date.now(),x,[_e,cN]=wf(r,p,[ue.CHOOSE_SERVER]),dN=he.networkState;return Wi(async()=>{dN&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(o&&o.maxRetryTimeout||Ee.maxRetryTimeout)]),dN=he.networkState;let{data:fN,headers:mN}=await Hi(h,{data:_e,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);x=mN.http3==="1"?1:-1,X.reportResourceTiming(h,C),l0(fN,h,r,A,[ue.CHOOSE_SERVER],x);let EN=Dc(fN,ue.CHOOSE_SERVER);return bf(EN),mf(EN,h)},fN=>(fN&&X.joinChooseServer(C,{lts:A,succ:!0,csAddr:h,opid:cN,serverList:fN.gatewayAddrs.map(mN=>mN.address),ec:null,cid:fN.cid.toString(),uid:fN.uid.toString(),csIp:fN.csIp,unilbsServerIds:[ue.CHOOSE_SERVER].toString(),isHttp3:x}),!1),fN=>fN.code!==R.OPERATION_ABORTED&&(fN.code===R.CAN_NOT_GET_GATEWAY_SERVER?fN.data.retry:(X.joinChooseServer(C,{lts:A,succ:!1,csAddr:h,serverList:null,opid:cN,ec:fN.code,csIp:fN.data&&fN.data.csIp,unilbsServerIds:[ue.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:dN}),isHttp3:x}),_.warning("[".concat(g||"sid-".concat(C.slice(0,6)),"] Choose server network error, retry"),fN),!0)),o)}function $I(e,r,i,o){let h,{url:p,areaCode:g,serviceIds:C}=e,A=Date.now(),[x,_e]=wf(r,g,C),cN;return Wi(async()=>{cN&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(o&&o.maxRetryTimeout||Ee.maxRetryTimeout)]),cN=he.networkState;let{data:dN,headers:fN}=await Hi(p,{data:x,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=fN.http3==="1"?1:-1,X.reportResourceTiming(p,r.sid),l0(dN,p,r,A,C,h);let mN=Dc(dN,ue.CHOOSE_SERVER),EN=Dc(dN,r.cloudProxyServer==="proxy5"?ue.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?ue.CLOUD_PROXY:ue.CLOUD_PROXY_FALLBACK);return bf(mN),{gatewayInfo:mf(mN,p),proxyInfo:EN,url:p}},dN=>(dN.gatewayInfo&&X.joinChooseServer(r.sid,{lts:A,succ:!0,csAddr:p,serverList:dN.gatewayInfo.gatewayAddrs.map(fN=>fN.address),ec:null,opid:_e,cid:dN.gatewayInfo.cid.toString(),uid:dN.gatewayInfo.uid.toString(),csIp:dN.gatewayInfo.csIp,unilbsServerIds:C.toString(),isHttp3:h}),dN.proxyInfo&&X.joinWebProxyAP(r.sid,{lts:A,sucess:1,apServerAddr:p,turnServerAddrList:dN.proxyInfo.addresses.map(fN=>fN.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:C.toString()}),!1),dN=>dN.code!==R.OPERATION_ABORTED&&(dN.code===R.CAN_NOT_GET_GATEWAY_SERVER?dN.data.retry:(X.joinWebProxyAP(r.sid,{lts:A,sucess:0,apServerAddr:p,turnServerAddrList:null,errorCode:dN.code,eventType:r.cloudProxyServer,unilbsServerIds:C.toString(),extend:JSON.stringify({networkState:cN})}),_.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),dN),!0)),o)}var l0=(e,r,i,o,h,p)=>{let{sid:g,clientId:C,cloudProxyServer:A}=i,x=[],_e=cN=>{cN.flag===4096?X.joinChooseServer(g,{lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:cN.error.message,csIp:cN.error.data&&cN.error.data.csIp,unilbsServerIds:h.toString(),isHttp3:p}):cN.flag!==1048576&&cN.flag!==4194304&&cN.flag!==4194310||X.joinWebProxyAP(g,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:cN.error.code,eventType:A,unilbsServerIds:h.toString()})};if(e.response_body.forEach(cN=>{let dN=cN.buffer.code;if(cN.uri===23&&dN===0&&!cN.buffer.edges_services)if(cN.buffer.flag===4194310)_.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),cN.buffer.edges_services=[];else{let fN={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:cN.buffer.flag};x.push(fN),_e(fN)}if(dN!==0){let fN=ta(dN),mN={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,fN.desc,{desc:fN.desc,retry:fN.retry,csIp:e.detail[502]}),flag:cN.buffer.flag};cN.buffer.flag===4194310?_.warning(mN.error.toString()):x.push(mN),_e(mN)}}),x.length)throw _.warning("[".concat(C||"sid-".concat(g.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(x.map(cN=>"flag: ".concat(cN.flag,", message: ").concat(cN.error.message,", retry: ").concat(cN.error.data.retry)).join(" | "))),new O(R.CAN_NOT_GET_GATEWAY_SERVER,x.map(cN=>"flag: ".concat(cN.flag,", message: ").concat(cN.error.message)).join(" | "),{retry:!!x.find(cN=>cN.error.data.retry),csIp:e.detail[502],desc:[...new Set(x.map(cN=>{var dN;return cN==null||(dN=cN.error)===null||dN===void 0||(dN=dN.data)===null||dN===void 0?void 0:dN.desc}).filter(cN=>!!cN))]})},bf=e=>{var r,i,o,h;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new O(R.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(v("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((h=e.detail)===null||h===void 0?void 0:h[23])=="string"?XI(e.detail[23].toLowerCase()):XI()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let g=e.detail[19],C=g==null?void 0:g.split(";");for(let A=0;A<C.length;A++){var p;let x=rn(p=C[A]).call(p);e.addresses[A]&&C&&(e.addresses[A].fingerprint=x)}}if(v("GATEWAY_ADDRESS")&&v("GATEWAY_ADDRESS").length>0){_.debug("assign gateway address to",v("GATEWAY_ADDRESS"));let g=v("GATEWAY_ADDRESS").map(C=>{var A,x;let _e=(A=(x=e.addresses.find(cN=>cN.ip===C.ip&&cN.port===C.port))===null||x===void 0?void 0:x.fingerprint)!==null&&A!==void 0?A:"";return{ip:C.ip,port:C.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:_e}});e.addresses=g}},HG=(e,r)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let o=ta(i.buffer.code);throw new O(R.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw _.debug("update ticket request received ap response without response body:",r),new O(R.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},wf=(e,r,i)=>{let o=Math.floor(Math.random()*1e12),h={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:em({6:e.stringUid,11:r,12:v("USE_NEW_TOKEN")?"1":void 0,22:r},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};h.request_bodies.forEach(g=>{e.multiIP&&e.multiIP.gateway_ip&&(g.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let p=new FormData;return p.append("request",JSON.stringify(h)),[p,o]},KG=(e,r)=>{let i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(p=>({ip:p.ip,port:p.port}))}}]},h=new FormData;return h.append("request",JSON.stringify(o)),[h,i]},Ys=0;function Ta(e){return j.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}var Uc=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:h,promisesCollector:p}=e,g=0,C=r,A,x=0,_e=async()=>{let cN=(()=>{let dN=g*C,fN=dN+C;return i.slice(dN,fN).map(o)})();p&&p.push(...cN);try{A=await Ta(cN)}catch(dN){if(x+=C,g++,!(x>=i.length))return void await _e();h(dN)}cN.forEach(dN=>dN.cancel())};return await _e(),A},u0=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e,h=r.length,p=0,g=async()=>{let C=i(r.shift());try{return await C}catch(A){if(p++,p>=h||o!=null&&o(A))throw A;return g()}};return g()};async function nm(e,r,i,o){return{gatewayInfo:await async function(h,p,g,C){let A=null,x=[],_e=async()=>{let dN=v("WEBCS_DOMAIN").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(EN=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(EN+"/api/v2/transpond/webrtc?v=2"):"https://".concat(EN,"/api/v2/transpond/webrtc?v=2"),areaCode:Mc()})),fN=C.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:dN.map(EN=>EN.url)}),mN=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:dN,asyncMapHandler:EN=>(_.debug("[".concat(h.clientId,"] Connect to choose_server:"),EN.url),ZI(EN,h,p,g)),allFailedhandler:EN=>{throw C.recordJoinChannelService({endTs:Date.now(),status:"error",errors:EN},fN),EN[0]},promisesCollector:x});return C.recordJoinChannelService({endTs:Date.now(),status:"success"},fN),mN},cN=async()=>{if(await Me(1e3),A!==null)return A;let dN=v("WEBCS_DOMAIN_BACKUP_LIST").map(EN=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(EN+"/api/v2/transpond/webrtc?v=2"):"https://".concat(EN,"/api/v2/transpond/webrtc?v=2"),areaCode:Mc()})),fN=C.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:dN.map(EN=>EN.url)}),mN=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:dN,asyncMapHandler:EN=>(_.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),EN.url),ZI(EN,h,p,g)),allFailedhandler:EN=>{throw C.recordJoinChannelService({endTs:Date.now(),status:"error",errors:EN},fN),EN[0]},promisesCollector:x});return C.recordJoinChannelService({endTs:Date.now(),status:"success"},fN),mN};try{return A=await Ta([_e(),cN()]),x.length&&x.forEach(dN=>dN.cancel&&typeof dN.cancel=="function"&&dN.cancel()),A}catch(dN){throw dN[0]}}(e,r,i,o)}}async function tv(e,r,i,o,h){let p=e.cloudProxyServer;if(p==="disabled"){if(e.useLocalAccessPoint)return await nm(e,r,i,h);if(v("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:dN,proxyInfo:fN}=await nv(e,r,i,h);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:dN};let mN=fN.map(EN=>({turnServerURL:EN.address,tcpport:EN.tcpport||Ve.tcpport,udpport:EN.udpport||Ve.udpport,username:EN.username||Ve.username,password:EN.password||Ve.password,forceturn:!1,security:!0}));if(h.useP2P){var g;let EN=(g=e.uid)!==null&&g!==void 0?g:dN.uid,RN="glb:".concat(EN.toString()),IN=await PE(RN),t0=fN.map(aH=>({turnServerURL:aH.address,tcpport:aH.tcpport||Ve.tcpport,udpport:aH.udpport||Ve.udpport,username:RN,password:IN,forceturn:!1,security:!0}));mN.push(...t0)}return e.turnServer={mode:"manual",servers:mN},{gatewayInfo:dN}}return await nm(e,r,i,h)}let{proxyInfo:C,gatewayInfo:A}=await nv(e,r,i,h),x={gatewayInfo:A},_e=C.map(dN=>({turnServerURL:dN.address,tcpport:p==="proxy3"?void 0:dN.tcpport?dN.tcpport:Ve.tcpport,udpport:p==="proxy4"?void 0:dN.udpport?dN.udpport:Ve.udpport,username:dN.username||Ve.username,password:dN.password||Ve.password,forceturn:p!=="proxy4",security:p==="proxy5"}));if(h.useP2P){var cN;let dN=(cN=e.uid)!==null&&cN!==void 0?cN:A.uid,fN="glb:".concat(dN.toString()),mN=await PE(fN),EN=C.map(RN=>({turnServerURL:RN.address,tcpport:p==="proxy3"?void 0:RN.tcpport||Ve.tcpport,udpport:p==="proxy4"?void 0:RN.udpport||Ve.udpport,username:fN,password:mN,forceturn:p!=="proxy4",security:p==="proxy5"}));_e.push(...EN)}return e.turnServer={mode:"manual",servers:_e},_.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(p)),x}async function h0(e,r,i,o,h){let p=v("ACCOUNT_REGISTER").slice(0,v("AJAX_REQUEST_CONCURRENT")),g=[];g=r.proxyServer?p.map(A=>"https://".concat(r.proxyServer,"/ap/?url=").concat(A+"/api/v1")):p.map(A=>"https://".concat(A,"/api/v1"));let C=h==null?void 0:h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:g});try{let A=await async function(x,_e,cN,dN,fN){let mN=Date.now(),EN={sid:cN.sid,opid:10,appid:cN.appId,string_uid:_e},RN=x[0],IN=await Wi(()=>Hi(RN+"".concat(RN.indexOf("?")===-1?"?":"&","action=stringuid"),{data:EN,cancelToken:dN,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(t0,aH)=>{if(t0.code===0){if(t0.uid<=0||t0.uid>=Math.pow(2,32))throw _.error("Invalid Uint Uid ".concat(_e," => ").concat(t0.uid),t0),X.reqUserAccount(EN.sid,{lts:mN,success:!1,serverAddr:RN,stringUid:EN.string_uid,uid:t0.uid,errorCode:R.INVALID_UINT_UID_FROM_STRING_UID,extend:EN}),new O(R.INVALID_UINT_UID_FROM_STRING_UID);return X.reqUserAccount(EN.sid,{lts:mN,success:!0,serverAddr:RN,stringUid:EN.string_uid,uid:t0.uid,errorCode:null,extend:EN}),!1}let pH=ta(t0.code);return pH.retry&&(RN=x[(aH+1)%x.length]),X.reqUserAccount(EN.sid,{lts:mN,success:!1,serverAddr:RN,stringUid:EN.string_uid,uid:t0.uid,errorCode:pH.desc,extend:EN}),pH.retry},(t0,aH)=>t0.code!==R.OPERATION_ABORTED&&(X.reqUserAccount(EN.sid,{lts:mN,success:!1,serverAddr:RN,stringUid:EN.string_uid,uid:null,errorCode:t0.code,extend:EN}),RN=x[(aH+1)%x.length],!0),fN);if(IN.code!==0){let t0=ta(IN.code);throw new O(R.UNEXPECTED_RESPONSE,t0.desc)}return IN}(g,e,r,i,o);return h==null||h.recordJoinChannelService({status:"success",endTs:Date.now()},C),A.uid}catch(A){throw h==null||h.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[A]},C),A}}async function YG(e,r,i){let o=v("ACCOUNT_REGISTER"),h=[];h=r.proxyServer?o.map(p=>"https://".concat(r.proxyServer,"/ap/?url=").concat(p+"/api/v1")):o.map(p=>"https://".concat(p,"/api/v1"));try{return await u0({referenceList:h,asyncMapHandler:p=>async function(g,C,A,x){let _e=Date.now(),cN={sid:A.sid,opid:10,appid:A.appId,string_uid:C};try{let dN=await Hi(g+"".concat(g.indexOf("?")===-1?"?":"&","action=stringuid"),{data:cN,cancelToken:x,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(dN.code!==0){let fN=ta(dN.code);throw new O(R.UNEXPECTED_RESPONSE,"preload sua error:".concat(fN.desc),fN)}if(dN.uid<=0||dN.uid>=Math.pow(2,32))throw new O(R.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_e,url:g,req:cN,uid:dN.uid,elapse:Date.now()-_e}}catch(dN){throw dN}}(p,e,r,i),closeFn:p=>p.code===R.OPERATION_ABORTED||p.code===R.UNEXPECTED_RESPONSE&&!p.data.retry})}catch(p){throw p}}async function qG(e,r,i){let o=v("CDS_AP").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(A=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(A+"/api/v1"):"https://".concat(A,"/api/v1?action=config")),h=o.map(A=>function(x,_e,cN,dN){let fN=mt(),mN={flag:64,cipher_method:0,features:{device:fN.name,system:fN.os,system_general:navigator.userAgent,vendor:_e.appId,version:ii,cname:_e.cname,sid:_e.sid,session_id:_e.sid,detail:"",proxyServer:_e.proxyServer}};return Wi(()=>Hi(x,{data:mN,timeout:1e3,cancelToken:cN,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,EN=>EN.code!==R.OPERATION_ABORTED,dN)}(A,e,r,i)),p=null,g=null,C={};try{p=await Ta(h)}catch(A){if(A.code===R.OPERATION_ABORTED)throw A;g=A}if(h.forEach(A=>A.cancel()),X.reportApiInvoke(e.sid,{name:Te.REQUEST_CONFIG_DISTRIBUTE,options:{error:g,res:p}}).onSuccess(),p&&p.test_tags)try{C=function(A){if(!A.test_tags)return{};let x=A.test_tags,_e=Object.keys(x),cN={};return _e.forEach(dN=>{var fN;let mN=rn(fN=dN.slice(4)).call(fN),EN=JSON.parse(x[dN])[1];cN[mN]=EN}),cN}(p)}catch{}return C}async function ev(e,r){let i=v("WEBCS_DOMAIN").concat(v("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:Mc(),serviceIds:[ue.CHOOSE_SERVER,ue.CLOUD_PROXY_FALLBACK]}));try{return await u0({referenceList:i,asyncMapHandler:o=>async function(h,p,g){let C,{url:A,areaCode:x,serviceIds:_e}=h,cN=Date.now(),[dN,fN]=wf(p,x,_e),mN=he.networkState;try{mN&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(Ee.maxRetryTimeout)]),mN=he.networkState;let{data:EN,headers:RN}=await Hi(A,{data:dN,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);C=RN.http3==="1"?1:-1,(aH=>{let pH=[];if(aH.response_body.forEach(SH=>{let vH=SH.buffer.code;if(SH.uri===23&&vH===0&&!SH.buffer.edges_services)if(SH.buffer.flag===4194310)SH.buffer.edges_services=[];else{let AH={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:aH.detail[502]}),flag:SH.buffer.flag};pH.push(AH)}if(vH!==0){let AH=ta(vH),UH={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,AH.desc,{desc:AH.desc,retry:AH.retry,csIp:aH.detail[502]}),flag:SH.buffer.flag};SH.buffer.flag===4194310?_.warning(UH.error.toString()):pH.push(UH)}}),pH.length)throw new O(R.CAN_NOT_GET_GATEWAY_SERVER,pH.map(SH=>"flag: ".concat(SH.flag,", message: ").concat(SH.error.message)).join(" | "),{retry:!!pH.find(SH=>SH.error.data.retry),csIp:aH.detail[502],desc:[...new Set(pH.map(SH=>{var vH;return SH==null||(vH=SH.error)===null||vH===void 0||(vH=vH.data)===null||vH===void 0?void 0:vH.desc}).filter(SH=>!!SH))]})})(EN);let IN=Dc(EN,ue.CHOOSE_SERVER),t0=Dc(EN,ue.CLOUD_PROXY_FALLBACK);return bf(IN),{gatewayInfo:mf(IN,A),proxyInfo:t0,opid:fN,requestTime:cN,url:A,isHttp3:C,elapse:Date.now()-cN}}catch(EN){throw EN}}(o,e,r),closeFn:o=>o.code===R.OPERATION_ABORTED||o.code===R.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(o){throw o}}async function nv(e,r,i,o){let h=v("PROXY_SERVER_TYPE3"),p=(fN,mN,EN)=>{let RN=EN||h;return Array.isArray(RN)&&(RN=mN%2==0?h[1]:h[0]),"https://".concat(RN,"/ap/?url=").concat(fN)},g=null,C=[],A=async()=>{let fN=v("WEBCS_DOMAIN").slice(0,v("AJAX_REQUEST_CONCURRENT")).map((RN,IN)=>{let t0;return t0=e.cloudProxyServer==="disabled"&&e.proxyServer?p("".concat(RN,"/api/v2/transpond/webrtc?v=2"),IN,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(RN,"/api/v2/transpond/webrtc?v=2"):p("".concat(RN,"/api/v2/transpond/webrtc?v=2"),IN),{url:t0,areaCode:Mc(),serviceIds:[ue.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ue.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ue.CLOUD_PROXY:ue.CLOUD_PROXY_FALLBACK]}}),mN=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:fN.map(RN=>RN.url)}),EN=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:fN,asyncMapHandler:RN=>(_.debug("[".concat(e.clientId,"] Connect to choose_server:"),RN.url),$I(RN,e,r,i)),allFailedhandler:RN=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:RN},mN),RN[0]},promisesCollector:C});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},mN),EN},x=async()=>{if(await Me(1e3),g!==null)return g;let fN=v("WEBCS_DOMAIN_BACKUP_LIST").map((RN,IN)=>{let t0;return t0=e.cloudProxyServer==="disabled"&&e.proxyServer?p("".concat(RN,"/api/v2/transpond/webrtc?v=2"),IN,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(RN,"/api/v2/transpond/webrtc?v=2"):p("".concat(RN,"/api/v2/transpond/webrtc?v=2"),IN),{url:t0,areaCode:Mc(),serviceIds:[ue.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ue.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ue.CLOUD_PROXY:ue.CLOUD_PROXY_FALLBACK]}}),mN=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:fN.map(RN=>RN.url)}),EN=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:fN,asyncMapHandler:RN=>(_.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),RN.url),$I(RN,e,r,i)),allFailedhandler:RN=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:RN},mN),RN[0]},promisesCollector:C});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},mN),EN},_e,cN,dN;try{({gatewayInfo:_e,proxyInfo:cN,url:dN}=await Ta([A(),x()]))}catch(fN){throw fN[0]}if(C.length&&C.forEach(fN=>fN.cancel&&typeof fN.cancel=="function"&&fN.cancel()),!_e||!cN)throw new O(R.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=dN,e.cloudProxyServer!=="disabled"&&Array.isArray(h)&&dN){let fN=/^https?:\/\/(.+?)(\/.*)?$/.exec(dN)[1];W(h).call(h,fN)&&(e.proxyServer=fN,_.setProxyServer(fN),X.setProxyServer(fN))}return g={gatewayInfo:_e,proxyInfo:await kO(cN,_e.uid)},g}async function zG(e,r,i){let o=v("UAP_AP").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")),h=o.map(p=>function(g,C,A,x){let _e={command:"convergeAllocateEdge",sid:C.sid,appId:C.appId,token:C.token,ts:Date.now(),version:ii,cname:C.cname,uid:C.uid.toString(),requestId:p_,seq:p_};p_+=1;let cN={service_name:"tele_channel",json_body:JSON.stringify(_e)};return Wi(async()=>{let dN=await Hi(g,{data:cN,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(dN.code!==0){let mN=new O(R.UNEXPECTED_RESPONSE,"cross channel ap error, code"+dN.code,{retry:!0});throw _.error(mN.toString()),mN}let fN=JSON.parse(dN.json_body);if(fN.code!==200){let mN=new O(R.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(fN.code,", reason: ").concat(fN.reason));throw _.error(mN.toString()),mN}if(!fN.servers||fN.servers.length===0){let mN=new O(R.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw _.error(mN.toString()),mN}return{vid:fN.vid,workerToken:fN.workerToken,addressList:(v("CHANNEL_MEDIA_RELAY_SERVERS")||fN.servers).map(mN=>"wss://".concat(mN.address.replace(/\./g,"-"),".").concat(v("WORKER_DOMAIN"),":").concat(mN.wss))}},void 0,dN=>!!(dN.code!==R.OPERATION_ABORTED&&dN.code!==R.UNEXPECTED_RESPONSE||dN.data&&dN.data.retry),x)}(p,e,r,i));try{let p=await Ta(h);return h.forEach(g=>g.cancel()),p}catch(p){throw p[0]}}async function JG(e,r,i){let o=null,h=[],p=async g=>{let C=v(g?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(A=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"));return g&&(await Me(1e3),o!==null)?o:await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:A=>(_.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(g?"backup":""," choose_server:"),A),function(x,_e,cN,dN){let[fN]=KG(_e,[ue.CHOOSE_SERVER]),mN=he.networkState;return Wi(async()=>{mN&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(dN&&dN.maxRetryTimeout||Ee.maxRetryTimeout)]),mN=he.networkState;let EN=await Hi(x,{data:fN,cancelToken:cN,headers:{"Content-Type":"multipart/form-data;"}},!0);return HG(EN,x)},()=>!1,EN=>EN.code!==R.OPERATION_ABORTED&&(EN.code===R.UPDATE_TICKET_FAILED?EN.data.retry:(_.warning("[".concat(_e.clientId,"] update ticket network error, retry"),EN),!0)),dN)}(A,e,r,i)),allFailedhandler:A=>{throw A[0]},promisesCollector:h})};try{return o=await Ta([p(!1),p(!0)]),h.length&&h.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),o}catch(g){throw g[0]}}function iv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function rv(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?iv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):iv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var im=class extends Xt{get isSuccess(){return!!this.configs}constructor(){super(),T(this,"configs",void 0),T(this,"joinInfo",void 0),T(this,"cancelToken",void 0),T(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),T(this,"interval",void 0),T(this,"mutex",new ze("config-distribute")),T(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,r){this.joinInfo=e,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),v("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},v("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,X.reportApiInvoke(null,{options:void 0,name:Te.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Zt.TRACER}).onSuccess(JSON.stringify($r))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void _.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,r=await this.mutex.lock();try{e=await qG(this.joinInfo,this.cancelToken,this.retryConfig),_.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(i){let o=new O(R.NETWORK_RESPONSE_ERROR,i);_.warning("[config-distribute] ".concat(o.toString()))}finally{r()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var r;(r=e)&&r.uplink&&r.id&&r.uplink.max_bitrate!==void 0&&r.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(FE.UPDATE_BITRATE_LIMIT,e):this.emit(FE.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&rv({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var r;let i=ed(r=Object.keys(e).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(r);for(let h=0;h<i.length;h++)for(let p=i.length-1;p>h;p--){let g=i[p];if(typeof e[g].__priority=="number"){let C=e[g].__priority,A=i[p-1];if(typeof e[A].__priority=="number"){if(!(C>e[A].__priority))continue;{let x=g;i[p]=i[p-1],i[p-1]=x}}else{let x=g;i[p]=i[p-1],i[p-1]=x}}}let o={};i.forEach(h=>{let p=e[h],g=p.__expires;Object.keys(p).forEach(C=>{C==="__priority"||C==="__expires"||Object.prototype.hasOwnProperty.call(o,C)||(o[C]=rv({value:p[C]},g&&{expires:g}))})});try{(function(g){try{let C=Date.now();Object.keys(g).forEach(A=>{switch(A){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(oe,A)){let{value:x,expires:_e}=g[A];if(_e&&_e<=C)return;$r[A]=x,oe[A]=x,_.debug("Update global parameters from config distribute",A,x)}}})}catch(C){_.error("Error update config immediately: ".concat(g),C.message)}})(o);let h=JSON.stringify(o),p=window.btoa(h);window.localStorage.setItem("websdk_ng_global_parameter",p),_.debug("Caching global parameters ".concat(h))}catch(h){_.error("Error caching global parameters:",h.message)}}},rm=class extends Xt{constructor(){super(...arguments),T(this,"resultStorage",new Map)}setLocalAudioStats(e,r,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,r))}setLocalVideoStats(e,r,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,r)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,r)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,r){let i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(r))}setRemoteVideoStats(e,r){let i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(r))}record(e,r,i){if(v("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let o=this.resultStorage.get(e);if(o&&(o.result.push(i),o.result.length>=5)){var h;let p=W(h=o.result).call(h,!0);o.isPrevNormal&&!p&&this.emit("exception",ov[e],e,r),!o.isPrevNormal&&p&&this.emit("exception",ov[e]+2e3,e+"_RECOVER",r),o.isPrevNormal=p,o.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,r){return r instanceof ge&&!r.isActive||!!r.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,r){let i=null;r._encoderConfig&&r._encoderConfig.frameRate&&(i=Nn(r._encoderConfig.frameRate));let o=e.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,r){return!!r.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,r){return r instanceof ge&&!r.isActive||!!r.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}},ov={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},qe=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){let o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){let o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function Of(e,r){this.v=e,this.k=r}function Tt(e){return new Of(e,0)}var XG=Lb,QG=mr;xt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=QG.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var ZG=mr,$G=_a;xt({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=ZG.f(this),i=$G(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var om=ae(XG),p0=Ea.f("asyncIterator"),tW=ae(p0);function Ja(e){var r,i;function o(p,g){try{var C=e[p](g),A=C.value,x=A instanceof Of;om.resolve(x?A.v:A).then(function(_e){if(x){var cN=p==="return"?"return":"next";if(!A.k||_e.done)return o(cN,_e);_e=e[cN](_e).value}h(C.done?"return":"normal",_e)},function(_e){o("throw",_e)})}catch(_e){h("throw",_e)}}function h(p,g){switch(p){case"return":r.resolve({value:g,done:!0});break;case"throw":r.reject(g);break;default:r.resolve({value:g,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(p,g){return new om(function(C,A){var x={key:p,arg:g,resolve:C,reject:A,next:null};i?i=i.next=x:(r=i=x,o(p,g))})},typeof e.return!="function"&&(this.return=void 0)}function Bi(e){return function(){return new Ja(e.apply(this,arguments))}}Ja.prototype[typeof Ds=="function"&&tW||"@@asyncIterator"]=function(){return this},Ja.prototype.next=function(e){return this._invoke("next",e)},Ja.prototype.throw=function(e){return this._invoke("throw",e)},Ja.prototype.return=function(e){return this._invoke("return",e)};var sv=ae(Gi.Object.getOwnPropertySymbols),eW=xt,nW=Nm.indexOf,iW=Nu,sm=gc([].indexOf),av=!!sm&&1/sm([1],1,-0)<0;eW({target:"Array",proto:!0,forced:av||!iW("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return av?sm(this,e,r)||0:nW(this,e,r)}});var rW=bi("Array").indexOf,oW=hn,sW=rW,__=Array.prototype,aW=function(e){var r=e.indexOf;return e===__||oW(__,e)&&r===__.indexOf?sW:r},cv=ae(aW);function cW(e,r){if(e==null)return{};var i,o,h=function(g,C){if(g==null)return{};var A,x,_e={},cN=NO(g);for(x=0;x<cN.length;x++)A=cN[x],cv(C).call(C,A)>=0||(_e[A]=g[A]);return _e}(e,r);if(sv){var p=sv(e);for(o=0;o<p.length;o++)i=p[o],cv(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(h[i]=e[i])}return h}function Si(e){if(Array.isArray(e))return e.map(i=>i);if(!dv(e))return e;let r={};for(let i in e){let o=e[i];dv(o)||Array.isArray(o)?r[i]=Si(o):r[i]=o}return r}function dv(e){return!(typeof e!="object"||Array.isArray(e)||!e)}var cc=class{constructor(e){T(this,"input",[]),T(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},hr={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},xc={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:hr,remoteCandidate:hr}},_0={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},E0={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},m0={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},f0={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function lv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function uv(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?lv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):lv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Vc=class{constructor(e,r){T(this,"onFirstVideoReceived",void 0),T(this,"onFirstVideoDecoded",void 0),T(this,"onFirstAudioReceived",void 0),T(this,"onFirstVideoDecodedTimeout",void 0),T(this,"onFirstAudioDecoded",void 0),T(this,"onSelectedLocalCandidateChanged",void 0),T(this,"onSelectedRemoteCandidateChanged",void 0),T(this,"videoIsReady",!1),T(this,"videoIsReady2",{}),T(this,"pc",void 0),T(this,"options",void 0),T(this,"intervalTimer",void 0),T(this,"stats",Si(xc)),T(this,"isFirstVideoReceived",{}),T(this,"isFirstVideoDecoded",{}),T(this,"isFirstAudioReceived",{}),T(this,"isFirstAudioDecoded",{}),T(this,"isFirstVideoDecodedTimeout",{}),T(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new j(e=>{e({local:uv({},hr),remote:uv({},hr)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"],o=0,h=0,p=0,g=0;for(let C of i)e[C].forEach((A,x)=>{if(!this.lossRateWindowStats[r-1][C][x]||!this.lossRateWindowStats[0][C][x])return;let _e=this.lossRateWindowStats[r-1][C][x].packets-this.lossRateWindowStats[0][C][x].packets,cN=this.lossRateWindowStats[r-1][C][x].packetsLost-this.lossRateWindowStats[0][C][x].packetsLost;C==="videoSend"||C==="audioSend"?(o+=_e,p+=cN):(h+=_e,g+=cN),Number.isNaN(_e)||Number.isNaN(_e)?A.packetLostRate=0:A.packetLostRate=_e<=0||cN<=0?0:cN/(_e+cN)});e.sendPacketLossRate=o<=0||p<=0?0:p/(o+p),e.recvPacketLossRate=h<=0||g<=0?0:g/(h+g)}};function hv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function dW(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?hv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var am=class extends Vc{constructor(){super(...arguments),T(this,"_stats",xc),T(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=Si(xc);let i=r.filter(h=>h.type==="ssrc");this.processSSRCStats(i);let o=r.find(h=>h.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;let o=W(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{let h=Si(E0);h.codec=r.googCodecName,h.adaptionChangeReason="none",r.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(r.googAvgEncodeMs),h.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},h.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},h.firsCount=Number(r.googFirReceived),h.nacksCount=Number(r.googNacksReceived),h.plisCount=Number(r.googPlisReceived),h.frameCount=Number(r.framesEncoded),h.bytes=Number(r.bytesSent),h.packets=Number(r.packetsSent),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(h),this._stats.rtt=h.rttMs;break}case"video_recv":{let h=Si(_0),p=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(h.codec=r.googCodecName,h.targetDelayMs=Number(r.googTargetDelayMs),h.renderDelayMs=Number(r.googRenderDelayMs),h.currentDelayMs=Number(r.googCurrentDelayMs),h.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),h.decodeMs=Number(r.googDecodeMs),h.maxDecodeMs=Number(r.googMaxDecodeMs),h.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},h.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},h.decodeFrameRate=Number(r.googFrameRateDecoded),h.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},h.jitterBufferMs=Number(r.googJitterBufferMs),h.firsCount=Number(r.googFirsSent),h.nacksCount=Number(r.googNacksSent),h.plisCount=Number(r.googPlisSent),h.framesDecodeCount=Number(r.framesDecoded),h.bytes=Number(r.bytesReceived),h.packets=Number(r.packetsReceived),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.packets>0&&!this.isFirstVideoReceived[h.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(h.ssrc),this.isFirstVideoReceived[h.ssrc]=!0),h.framesDecodeCount>0&&!this.isFirstVideoDecoded[h.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(h.ssrc,h.decodedFrame.width,h.decodedFrame.height),this.isFirstVideoDecoded[h.ssrc]=!0),p){let g=p.stats,C=Date.now()-p.lts;h.framesDecodeFreezeTime=g.framesDecodeFreezeTime,h.framesDecodeInterval=g.framesDecodeInterval,h.framesDecodeCount>g.framesDecodeCount&&this.isFirstVideoDecoded[h.ssrc]?(p.lts=Date.now(),h.framesDecodeInterval=C,h.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?h.framesDecodeFreezeTime+=h.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):h.framesDecodeCount<p.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:dW({},h),lts:Date.now()}),this._stats.videoRecv.push(h);break}case"audio_recv":{let h=Si(f0);h.codec=r.googCodecName,h.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,h.decodingCNG=Number(r.googDecodingCNG),h.decodingCTN=Number(r.googDecodingCTN),h.decodingCTSG=Number(r.googDecodingCTSG),h.decodingNormal=Number(r.googDecodingNormal),h.decodingPLC=Number(r.googDecodingPLC),h.decodingPLCCNG=Number(r.googDecodingPLCCNG),h.expandRate=Number(r.googExpandRate),h.accelerateRate=Number(r.googAccelerateRate),h.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),h.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),h.speechExpandRate=Number(r.googSpeechExpandRate),h.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),h.jitterBufferMs=Number(r.googJitterBufferMs),h.jitterMs=Number(r.googJitterReceived),h.bytes=Number(r.bytesReceived),h.packets=Number(r.packetsReceived),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),h.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),h.receivedFrames>0&&!this.isFirstAudioReceived[h.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(h.ssrc),this.isFirstAudioReceived[h.ssrc]=!0),h.decodingNormal>0&&!this.isFirstAudioDecoded[h.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(h.ssrc),this.isFirstAudioDecoded[h.ssrc]=!0),this._stats.audioRecv.push(h);break}case"audio_send":{let h=Si(m0);h.codec=r.googCodecName,h.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,h.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),h.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),h.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),h.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),h.bytes=Number(r.bytesSent),h.packets=Number(r.packetsSent),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.rttMs=Number(r.googRtt||0),this._stats.rtt=h.rttMs,this._stats.audioSend.push(h);break}}})}_getStats(){return new j((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){let r=[];return e.result().forEach(i=>{let o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(h=>{o[h]=i.stat(h)}),r.push(o)}),r}};function pv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Ao(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?pv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var hu=class extends Vc{constructor(){super(...arguments),T(this,"_stats",xc),T(this,"report",void 0),T(this,"lastDecodeVideoReceiverStats",new Map),T(this,"lastVideoFramesRecv",new Map),T(this,"lastVideoFramesSent",new Map),T(this,"lastVideoFramesDecode",new Map),T(this,"lastVideoFramesOutput",new Map),T(this,"lastVideoJBDelay",new Map),T(this,"lastAudioJBDelay",new Map),T(this,"mediaBytesSent",new Map),T(this,"mediaBytesRetransmit",new Map),T(this,"mediaBytesTargetEncode",new Map),T(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Si(xc),this.report.forEach(e=>{switch(e.type){case kn.OUTBOUND:case kn.INBOUND:{let r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===kn.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===kn.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case kn.TRANSPORT:{let r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case kn.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),r={local:Ao({},hr),remote:Ao({},hr)};return e.forEach(i=>{let o;if(i.type===kn.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===kn.CANDIDATE_PAIR&&i.selected&&(o=i),o){let h=(p,g)=>{p.type=g.type,p.id=g.id,g.address&&(p.address=g.address),g.candidateType&&(p.candidateType=g.candidateType),g.port&&(p.port=g.port),g.priority&&(p.priority=g.priority),g.protocol&&(p.protocol=g.protocol),g.relayProtocol&&(p.relayProtocol=g.relayProtocol)};if(o.localCandidateId){let p=e.get(o.localCandidateId);p&&h(r.local,p)}if(o.remoteCandidateId){let p=e.get(o.remoteCandidateId);p&&h(r.remote,p)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){let r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===kn.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===kn.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===kn.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ao({},r),Ao({},this.stats.selectedCandidatePair.localCandidate)),e.type===kn.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ao({},r),Ao({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);r||(r=Si(f0),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let r=this._stats.videoRecv.find(g=>g.ssrc===e.ssrc);r||(r=Si(_0),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration;let i=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),h=this.lastVideoFramesOutput.get(r.ssrc),p=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){let g=r.decodedFrame?r.decodedFrame.width:0,C=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,g,C),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){let g=i.stats,C=p-i.lts;r.framesDecodeFreezeTime=g.framesDecodeFreezeTime,r.framesDecodeInterval=g.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&C>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>g.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=C,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<g.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}o&&p-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((p-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:p,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:p,rate:0}),r.framesDroppedCount&&e.framesReceived&&(h&&p-h.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-h.count)/((p-h.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:p,rate:Math.max(r.outputFrameRate,0)})):h?r.outputFrameRate=h.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:p,rate:0})),e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ao({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=Si(E0),this._stats.videoSend.push(r));let i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{let o=new cc(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){let o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{let h=new cc(10);h.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,h)}}if(e.totalEncodedBytesTarget){let o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{let h=new cc(10);h.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,h)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){let o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let h=e.framesEncoded-o.lastFrameCount,p=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*p/h}}if(e.framesEncoded&&e.qpSum){let o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{let o=this.findRemoteStatsId(e.ssrc,kn.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=Si(m0),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{let i=this.findRemoteStatsId(e.ssrc,kn.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;let o=Array.from(Pr(i=this.report).call(i)).find(h=>h.type===r&&h.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){let i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){let i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var o,h,p,g;let C=r?this.report.get(r):void 0,A=(o=C==null?void 0:C.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof A!="number")return;let x=(h=C==null?void 0:C.frameWidth)!==null&&h!==void 0?h:e.frameWidth,_e=(p=C==null?void 0:C.frameHeight)!==null&&p!==void 0?p:e.frameHeight,cN=(g=C==null?void 0:C.framesPerSecond)!==null&&g!==void 0?g:e.framesPerSecond;if(typeof x=="number"&&typeof _e=="number"||(x=0,_e=0),cN==null){let dN=Date.now(),fN=this.lastVideoFramesSent.get(i.ssrc);fN&&dN-fN.lts>=800?(cN=Math.round((A-fN.count)/((dN-fN.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:A,lts:dN,rate:cN})):fN?cN=fN.rate:this.lastVideoFramesSent.set(i.ssrc,{count:A,lts:dN,rate:0})}i.sentFrame={width:x,height:_e,frameRate:Math.max(0,cN)}}processVideoTrackReceiverStats(e,r,i){var o,h,p,g,C;let A=r?this.report.get(r):void 0,x=(o=A==null?void 0:A.framesReceived)!==null&&o!==void 0?o:e.framesReceived,_e=(h=A==null?void 0:A.frameWidth)!==null&&h!==void 0?h:e.frameWidth,cN=(p=A==null?void 0:A.frameHeight)!==null&&p!==void 0?p:e.frameHeight,dN=(g=A==null?void 0:A.jitterBufferDelay)!==null&&g!==void 0?g:e.jitterBufferDelay,fN=(C=A==null?void 0:A.jitterBufferEmittedCount)!==null&&C!==void 0?C:e.jitterBufferEmittedCount;if(typeof x=="number"){let mN=this.lastVideoFramesRecv.get(i.ssrc),EN=Date.now();i.framesReceivedCount=x;let RN=0;mN&&EN-mN.lts>=800?(RN=Math.round((x-mN.count)/((EN-mN.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:x,lts:EN,rate:RN})):mN?RN=mN.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:x,lts:EN,rate:0}),i.receivedFrame={width:_e||0,height:cN||0,frameRate:RN||0},i.decodedFrame={width:_e||0,height:cN||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_e||0,height:cN||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(dN&&fN){let mN=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},EN=mN.jitterBufferMs,RN=fN-mN.jitterBufferEmittedCount;RN>0&&(EN=1e3*(dN-mN.jitterBufferDelay)/RN),i.jitterBufferMs=EN,i.currentDelayMs=Math.round(EN),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:dN,jitterBufferEmittedCount:fN,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var o,h,p,g;let C=r?this.report.get(r):void 0,A=(o=(h=C==null?void 0:C.echoReturnLoss)!==null&&h!==void 0?h:e.echoReturnLoss)!==null&&o!==void 0?o:0,x=(p=(g=C==null?void 0:C.echoReturnLossEnhancement)!==null&&g!==void 0?g:e.echoReturnLossEnhancement)!==null&&p!==void 0?p:0;i.aecReturnLoss=A,i.aecReturnLossEnhancement=x}processAudioTrackReceiverStats(e,r,i){var o,h,p,g,C,A,x;let _e=r?this.report.get(r):void 0,cN=(o=_e==null?void 0:_e.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,dN=(h=_e==null?void 0:_e.totalSamplesReceived)!==null&&h!==void 0?h:e.totalSamplesReceived,fN=(p=_e==null?void 0:_e.jitterBufferDelay)!==null&&p!==void 0?p:e.jitterBufferDelay,mN=(g=_e==null?void 0:_e.jitterBufferEmittedCount)!==null&&g!==void 0?g:e.jitterBufferEmittedCount,EN=(C=_e==null?void 0:_e.audioLevel)!==null&&C!==void 0?C:e==null?void 0:e.audioLevel,RN=(A=_e==null?void 0:_e.totalSamplesDuration)!==null&&A!==void 0?A:e==null?void 0:e.totalSamplesDuration,IN=(x=_e==null?void 0:_e.concealedSamples)!==null&&x!==void 0?x:e.concealedSamples;if(cN&&dN&&(i.accelerateRate=cN/dN),fN&&mN){let aH=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},pH=aH.jitterBufferMs,SH=mN-aH.jitterBufferEmittedCount;SH>0&&(pH=1e3*(fN-aH.jitterBufferDelay)/SH),i.jitterBufferMs=Math.round(pH),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:fN,jitterBufferEmittedCount:mN,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=EN;let t0=1920;RN&&dN&&(t0=dN/RN/50,i.receivedFrames=Math.round(dN/t0)),IN&&(i.droppedFrames=Math.round(IN/t0))}processRemoteInboundStats(e,r){let i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){let r=this.report.get(e);if(!r)return"";let i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(h=>{e+=h.diffMean()}),this.mediaBytesRetransmit.forEach(h=>{r=r===null?h.diffMean():r+h.diffMean()}),this.mediaBytesTargetEncode.forEach(h=>{i=i===null?h.diffMean():i+h.diffMean()});let o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},cm=class extends Vc{updateStats(){return j.resolve()}};function Nf(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,p=function(){let g=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return g&&g[0]?Number(g[0].split("/")[1]):null}();return p?p<76?new am(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:h}):new hu(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:h}):function(g){if(!window.RTCStatsReport)return!1;let C=g.getStats();return!!(C instanceof j||function(A){return!!A&&(typeof A=="object"||typeof A=="function")&&typeof A.then=="function"}(C))}(e)?new hu(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:h}):new cm(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:h})}var _v=class{get localCapabilities(){return le(this._localCapabilities)}get rtpCapabilities(){return le(this._rtpCapabilities)}get candidates(){return le(this._candidates)}get iceParameters(){return le(this._iceParameters)}get dtlsParameters(){return le(this._dtlsParameters)}constructor(e){T(this,"sessionDesc",void 0),T(this,"_localCapabilities",void 0),T(this,"_rtpCapabilities",void 0),T(this,"_candidates",void 0),T(this,"_iceParameters",void 0),T(this,"_dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname","o/i14u9pJrxRKAsu"),T(this,"firefoxSsrcMidMap",new Map),e=le(e);let{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:h,localCapabilities:p,direction:g,setup:C,videoCodec:A,audioCodec:x}=e,_e;this.setup=C,_e=g===cn.RECEIVE_ONLY?Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=h,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=p;let cN=g===cn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,dN=g===cn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,fN=g===cn.RECEIVE_ONLY?h.send.videoCodecs:ac(Q.VIDEO,cN,dN,A),mN=g===cn.RECEIVE_ONLY?h.send.audioCodecs:ac(Q.AUDIO,cN,dN,x);for(let EN of _e.mediaDescriptions)EN.attributes.iceUfrag=r.iceUfrag,EN.attributes.icePwd=r.icePwd,EN.attributes.fingerprints=i.fingerprints,EN.attributes.candidates=o,EN.attributes.setup=this.setup,EN.media.mediaType==="application"&&(EN.attributes.sctpPort="5000"),EN.media.mediaType==="video"&&(EN.media.fmts=fN.map(RN=>RN.payloadType.toString(10)),EN.attributes.payloads=fN,EN.attributes.extmaps=cN.videoExtensions),EN.media.mediaType==="audio"&&(EN.media.fmts=mN.map(RN=>RN.payloadType.toString(10)),EN.attributes.payloads=mN,EN.attributes.extmaps=cN.audioExtensions,oa(EN));this.sessionDesc=_e,this.currentMidIndex=_e.mediaDescriptions.length-1}toString(){return Le.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,h){i=i.replace(/ /g,"-");let{ssrcs:p,ssrcGroups:g}=Lo(r,this.cname,v("SYNC_GROUP")?i:void 0),C=this.findPreloadMediaDesc(p);if(C){if($t()&&this.firefoxSsrcMidMap.set(p[0].ssrcId,C.attributes.mid),h&&(h.twcc||h.remb)){let A=this.sessionDesc.mediaDescriptions.indexOf(C);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(C,h),{mid:C.attributes.mid,needExchangeSDP:!0}}return{mid:C.attributes.mid,needExchangeSDP:!1}}{let A=this.findAvailableMediaIndex(e,p,o),x;return A===-1?(x=this.createOrRecycleSendMedia(e,p,g,"sendonly",o,h),this.updateBundleMids()):(x=le(this.sessionDesc.mediaDescriptions[A]),x.attributes.direction="sendonly",x.attributes.ssrcs=p,x.attributes.ssrcGroups=g,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(x,h)),$t()&&this.firefoxSsrcMidMap.set(p[0].ssrcId,x.attributes.mid),{needExchangeSDP:!0,mid:x.attributes.mid}}}stopSending(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){let o=[];return e.forEach(h=>{let p=h._mediaStreamTrack.kind,g=this.findAvailableRecvMediaIndex(p),C,A=!1;g===-1?(A=!0,C=this.createOrRecycleRecvMedia(h,[],"recvonly",r,i),this.updateBundleMids()):(C=le(this.sessionDesc.mediaDescriptions[g]),C.attributes.direction="recvonly"),o.push({mid:C.attributes.mid,needCreateTransceiver:A})}),o}stopReceiving(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:r,protocol:i,address:o,port:h,type:p,relatedAddress:g,relatedPort:C,priority:A}=new RTCIceCandidate(e),x={foundation:r??"",componentId:"1",transport:i??"",priority:A?A+"":"",connectionAddress:o??"",port:h?h+"":"",type:p?p+"":"",relAddr:g??"",relPort:C?C+"":"",extension:{}};this.candidates.some(_e=>_e.priority===x.priority&&_e.connectionAddress===x.connectionAddress&&_e.port===x.port)||(this._candidates.push(x),this.sessionDesc.mediaDescriptions.forEach(_e=>{_e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,h){let p=e._mediaStreamTrack.kind,g=this.rtpCapabilities.recv,C=ac(p,g,this.localCapabilities.send,p===Q.AUDIO?h:o),A=p===Q.VIDEO?g.videoExtensions:g.audioExtensions,x="".concat(++this.currentMidIndex),_e={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:C.map(dN=>dN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:C,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(x)}};_e=this.mungRecvMediaDsec(_e,e);let cN=this.findFirstClosedMedia(p);if(cN){let dN=this.sessionDesc.mediaDescriptions.indexOf(cN);this.sessionDesc.mediaDescriptions[dN]=_e}else this.sessionDesc.mediaDescriptions.push(_e);return _e}muteRemote(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>W(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>W(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{let h=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if($t()){if(h){let p=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(p||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!p||p!==o.attributes.mid)}return!1}return h&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){let r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=le(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,h,p){let g=this.rtpCapabilities.send,C=e===Q.VIDEO?g.videoCodecs:g.audioCodecs,A=e===Q.VIDEO?g.videoExtensions:g.audioExtensions;$t()&&(h="".concat(++this.currentMidIndex));let x={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:C.map(cN=>cN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:C,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:h}};x=this.mungSendMediaDesc(x,p);let _e=this.findFirstClosedMedia(e);if(_e){let cN=this.sessionDesc.mediaDescriptions.indexOf(_e);this.sessionDesc.mediaDescriptions[cN]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}mungRecvMediaDsec(e,r,i){let o=le(e);return If(o),ra(o,r),vf(o,r),r0(o),lu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){let i=le(e);return lu(i,r,this.localCapabilities.recv),oa(i),i}updateRecvMedia(e,r){let i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>$t()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}},lW=["sdp"],Vt;function Ev(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Gr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Ev(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ev(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var mv=(Vt=class pee extends Kl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),T(this,"direction",void 0),T(this,"name",void 0),T(this,"store",void 0),T(this,"spec",void 0),T(this,"peerConnection",void 0),T(this,"initialOffer",void 0),T(this,"transport",void 0),T(this,"statsFilter",void 0),T(this,"localCandidateCount",0),T(this,"_isInRestartIce",!1),T(this,"mutex",new ze("P2PConnection-mutex")),T(this,"onLocalCandidate",void 0),T(this,"remoteSDP",void 0),T(this,"pendingCandidates",[]),T(this,"localCapabilities",void 0),T(this,"isReady",!1),T(this,"restartCnt",0),T(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.peerConnection=new RTCPeerConnection(pee.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??cn.SEND_ONLY,this.name=this.direction===cn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Nf(this.peerConnection,v("STATS_UPDATE_INTERVAL"),void 0,$t()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{let i=await s0();if(this.localCapabilities=uu(i),r){let{sdp:o}=r,h=cW(r,lW),p=function(){let _e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},cN=Lc(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),dN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},fN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},mN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ii(cN,_e,"videoExtensions",dN,fN,mN),Ii(cN,_e,"videoCodecs",dN,fN,mN),Ii(cN,_e,"audioExtensions",dN,fN,mN),Ii(cN,_e,"audioCodecs",dN,fN,mN),v("RAISE_H264_BASELINE_PRIORITY")){let EN=mN.videoCodecs.findIndex(RN=>RN.rtpMap&&RN.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&RN.fmtp&&RN.fmtp.parameters["profile-level-id"]==="42001f");if(EN!==-1){let RN=mN.videoCodecs.findIndex(IN=>IN.rtpMap&&IN.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(RN<EN){_.debug("raising H264 baseline profile priority");let IN=mN.videoCodecs[EN];mN.videoCodecs.splice(EN,1),mN.videoCodecs.splice(RN,0,IN)}RN!==-1&&v("FILTER_SEND_H264_BASELINE")&&(dN.videoCodecs=dN.videoCodecs.filter(IN=>!(IN.rtpMap&&IN.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&IN.fmtp&&IN.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:dN,recv:fN,sendrecv:mN}}({},{},o);this.remoteSDP=new _v({remoteIceParameters:h.iceParameters,remoteDtlsParameters:h.dtlsParameters,candidates:[],remoteRTPCapabilities:p,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let g=await this.peerConnection.createAnswer();if(!g.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let C=io(g.sdp);await this.peerConnection.setLocalDescription(g);let A=await zI({},{},g.sdp);this.localCapabilities=uu(A);let x=this.peerConnection.getTransceivers()[0];return x!=null&&x.receiver&&x.receiver.transport&&this.tryBindTransportEvents(x.receiver.transport),Gr(Gr({},C),{},{sdp:g.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let h=io(o.sdp);return this.initialOffer=o,Gr(Gr({},h),{},{sdp:o.sdp})}}catch(i){throw new N(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:o,dtlsParameters:h}=r,p=await zI({},{},i);this.remoteSDP=new _v({remoteIceParameters:o,remoteDtlsParameters:h,candidates:[],remoteRTPCapabilities:p,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let g=this.peerConnection.getTransceivers()[0];g!=null&&g.sender&&g.sender.transport&&this.tryBindTransportEvents(g.sender.transport)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new N(R.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var h=this;return Bi(function*(){let p=yield Tt(h.mutex.lock("From P2PConnection.send"));try{if(!h.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let g=[],C=h.remoteSDP.receive(r,i,o);r.forEach((RN,IN)=>{if(C[IN].needCreateTransceiver){let t0=h.peerConnection.addTransceiver(RN._mediaStreamTrack,{direction:"sendonly"});g.push(t0),RN._updateRtpTransceiver(t0)}else{let t0=h.peerConnection.getTransceivers().find(aH=>aH.mid===C[IN].mid);if(!t0)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(C[IN].mid));g.push(t0),RN._updateRtpTransceiver(t0)}}),$t()&&v("SIMULCAST")===!0&&(yield Tt(h.applySimulcastForFirefox(g,r)));let A=C.map(RN=>RN.mid),x=yield Tt(h.peerConnection.createOffer()),_e=h.mungSendOfferSDP(x.sdp,r,A),cN=Le.parse(_e),dN=A.map(RN=>{let IN=cN.mediaDescriptions.find(t0=>t0.attributes.mid===RN);if(!IN)throw new Error("Cannot extract ssrc from mediaDescription.");return n0(IN,v("USE_PUB_RTX"))}),fN=g.map((RN,IN)=>{let t0=A[IN];return{localSSRC:dN[IN],id:t0}});yield Tt(h.peerConnection.setLocalDescription({type:"offer",sdp:_e}));try{yield fN}catch(RN){let IN=h.remoteSDP.toString();throw yield Tt(h.peerConnection.setLocalDescription({type:"offer",sdp:_e})),yield Tt(h.peerConnection.setRemoteDescription({type:"answer",sdp:IN})),yield Tt(h.stopSending(A,!0)),RN}yield Tt(h.applySimulcastEncodings(g,r)),yield Tt(h.applySendEncodings(g,r));let mN=h.remoteSDP.toString(),EN=h.logSDPExchange(_e,"offer","local","send");return EN==null||EN(mN),yield Tt(h.setRemoteDescription({type:"answer",sdp:mN})),g.map((RN,IN)=>{let t0=A[IN];return{localSSRC:dN[IN],id:t0}})}catch(g){throw g instanceof N?g:new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(g.toString()))}finally{p()}})()}async stopSending(r,i){let o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let h=this.peerConnection.getTransceivers().filter(A=>r.indexOf(A.mid)!==-1);if(h.length!==r.length)throw new Error("Transceivers' length (".concat(h.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));h.map(A=>{var x;A.direction="inactive",(x=A.stop)===null||x===void 0||x.call(A)});let p=await this.peerConnection.createOffer(),g=this.logSDPExchange(p.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(p),this.remoteSDP.stopReceiving(r);let C=this.remoteSDP.toString();g==null||g(C),await this.setRemoteDescription({type:"answer",sdp:C})}catch(h){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(h.toString()))}finally{o&&o()}}async receive(r,i,o,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{mid:p,needExchangeSDP:g}=this.remoteSDP.send(r,i,o,h);if(g){let A=this.remoteSDP.toString(),x=this.logSDPExchange(A,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:A});let _e=await this.peerConnection.createAnswer(),cN=this.mungReceiveAnswerSDP(_e.sdp,p,r);x==null||x(cN||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:cN}),_.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else _.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));let C=this.peerConnection.getTransceivers().find(A=>A.mid===p);if(!C||C.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:C.receiver.track,mid:C.mid,transceiver:C}}catch(p){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(p.toString()))}}async mockReceive(r,i,o,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{mid:p,needExchangeSDP:g}=this.remoteSDP.send(r,i,o,h);if(g){let C=this.remoteSDP.toString(),A=this.logSDPExchange(C,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:C});let x=await this.peerConnection.createAnswer(),_e=this.mungReceiveAnswerSDP(x.sdp,p,r);A==null||A(_e||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_e}),_.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else _.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(p){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(p.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let h=await this.peerConnection.createAnswer();o==null||o(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Oo.Auto&&(this.store.p2pTransport=Oo.SdRtn,ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pee.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pee.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:o}=io(i.sdp);return this.store.descriptionStart(),this.direction===cn.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===cn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:o}=io(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);let p=this.remoteSDP.toString(),g=this.logSDPExchange(h,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),g==null||g(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(o){throw new N(R.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){let o=this.peerConnection.getTransceivers().filter(h=>h.mid===r);o.length===1&&(this.isVP8Simulcast(i)?$t()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){let o=this.peerConnection.getTransceivers().find(h=>h.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){let r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){let i=r[0].transport.iceTransport,{local:o,remote:h}=i.getSelectedCandidatePair();return{local:Gr(Gr({},hr),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Gr(Gr({},hr),{},{candidateType:h.type,protocol:h.protocol,address:h.address,port:h.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;W(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else _.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,h={iceServers:[]};var p;return r.iceServers?h.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Yu(r.turnServer.servers)?h.iceServers=r.turnServer.servers:(h.iceServers&&h.iceServers.push(...pee.turnServerConfigToIceServers(r.turnServer.servers,i,o)),v("USE_TURN_SERVER_OF_GATEWAY")&&h.iceServers&&r.turnServer.serversFromGateway&&h.iceServers.push(...pee.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),W(p=[Oo.Relay,Oo.SdRtn]).call(p,i)&&(h.iceTransportPolicy="relay"),v("FORCE_TURN_TCP")?h.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(g=>{g.forceturn&&(h.iceTransportPolicy="relay")}))),v("ENABLE_ENCODED_TRANSFORM")&&ft().supportWebRTCEncodedTransform&&(h.encodedInsertableStreams=!0),_.debug("P2PConnection p2pTransport is ".concat(i)),h}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,h=[],p=r.filter(C=>C.tcpport);_.debug("P2PConnection turnServers is ".concat(p,", current index is ").concat(o));let g=p.length>o?p[o]:p[0];switch(i){case Oo.SdRtn:let C=r.filter(x=>{var _e;return W(_e=x.username).call(_e,"glb:")&&x.turnServerURL==x.turnServerURL}),A=C.length>o?C[o]:C[0];A&&(h.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(Us(A.turnServerURL),":").concat(A.tcpport,"?transport=udp")}),h.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(Us(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}));break;case Oo.Relay:g&&(h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=udp")}),h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Us(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;default:g&&(h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=udp")}),h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Us(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}),h.push({username:g.username,credential:g.password,credentialType:"password",urls:"stun:".concat(g.turnServerURL,":").concat(g.tcpport)}))}return h}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var h;(h=this.onDTLSTransportError)===null||h===void 0||h.call(this,"error"in o?o.error:o)};let i=r.iceTransport;i&&(i.onstatechange=()=>{let o=r==null?void 0:r.iceTransport.state;var h;o&&((h=this.onICETransportStateChange)===null||h===void 0||h.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:o,remote:h}=i.getSelectedCandidatePair();_.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:h.type,protocol:h.protocol,address:h.address,port:h.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(_e=>_e.track===r._mediaStreamTrack)),!i)return _.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return _.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ft().supportSetRtpSenderParameters)return _.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let h={},p={};switch(r._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;default:h.degradationPreference="balanced"}if(r._encoderConfig){var g;let{bitrateMax:_e,frameRate:cN,scaleResolutionDownBy:dN}=r._encoderConfig;_e&&(p.maxBitrate=1e3*_e),W(g=r._hints).call(g,Gt.LOW_STREAM)&&(cN&&(p.maxFramerate=Nn(cN)),dN&&dN>=1&&(p.scaleResolutionDownBy=dN))}if(v("DSCP_TYPE")&&ho()){var C;let _e=v("DSCP_TYPE");W(C=["very-low","low","medium","high"]).call(C,_e)&&(p.networkPriority=_e)}let A=i.getParameters(),x=(o=A.encodings)===null||o===void 0?void 0:o[0];$t()&&!x&&(h.encodings=[p]),x&&Object.assign(x,p),Object.assign(A,h),_.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await i.setParameters(A)}async applySendEncodings(r,i){try{if(!ft().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){let h=r[o],p=i[o];p instanceof Ft&&!this.isVP8Simulcast(p)&&await this.updateRtpSenderEncodings(p,h.sender)}}catch{_.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){let h=Le.parse(r);return i.forEach((p,g)=>{let C=o[g],A=h.mediaDescriptions.find(x=>x.attributes.mid===C);A&&(ra(A,p),o0(A,p,this.store.codec))}),Le.print(h)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let A=0;A<r.length;A++){var o,h,p,g,C;let x=r[A],_e=i[A];if(_e instanceof Ft&&!W(o=_e._hints).call(o,Gt.LOW_STREAM)&&(h=_e._encoderConfig)!==null&&h!==void 0&&h.bitrateMax&&((p=_e._encoderConfig)===null||p===void 0?void 0:p.bitrateMax)>200&&(g=_e._scalabilityMode)!==null&&g!==void 0&&g.numSpatialLayers&&((C=_e._scalabilityMode)===null||C===void 0?void 0:C.numSpatialLayers)>1&&this.store.codec==="vp8"){let cN={},dN={high:1e3*(_e._encoderConfig.bitrateMax-50),medium:5e4};cN.encodings=[{rid:"m",active:!0,maxBitrate:dN.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:dN.high}];let fN=x.sender.getParameters();await x.sender.setParameters(Object.assign(fN,cN))}}}async applySimulcastEncodings(r,i){if(!$t()&&r.length===i.length)for(let o=0;o<r.length;o++){let h=i[o];if(h instanceof Ft&&this.isVP8Simulcast(h)){let p=r[o],g={},C={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:C.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:C.medium,scaleResolutionDownBy:4}];let A=p.sender.getParameters();await p.sender.setParameters(Object.assign(A,g))}}}isVP8Simulcast(r){var i,o,h,p,g;return!!(r instanceof Ft&&v("SIMULCAST")&&this.store.codec==="vp8"&&!W(i=r._hints).call(i,Gt.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((h=r._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(p=r._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((g=r._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1)}logSDPExchange(r,i,o,h){if(v("SDP_LOGGING"))return _.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(h,`
`),r),i==="offer"?p=>{this.logSDPExchange(p,"answer",o==="local"?"remote":"local",h)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(g=>{g.direction="inactive"});let o=await this.peerConnection.createOffer(),h=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);let p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async g=>{g.direction="sendonly"});let o=await this.peerConnection.createOffer(),h=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);let p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,h;if(i=(o=i)!==null&&o!==void 0?o:(h=this.currentRemoteDescription)===null||h===void 0?void 0:h.sdp){var p;let g=(p=Le.parse(i).mediaDescriptions.find(C=>C.attributes.mid===r))===null||p===void 0?void 0:p.attributes.ssrcs;return g==null?void 0:g[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),W(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){let h=Le.parse(r),p=h.mediaDescriptions.find(g=>g.attributes.mid===i);return p&&o===Q.AUDIO&&p.media.mediaType==="audio"&&oa(p),Le.print(h)}},q(Vt.prototype,"establish",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"establish"),Vt.prototype),q(Vt.prototype,"connect",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"connect"),Vt.prototype),q(Vt.prototype,"receive",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"receive"),Vt.prototype),q(Vt.prototype,"mockReceive",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"mockReceive"),Vt.prototype),q(Vt.prototype,"stopReceiving",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"stopReceiving"),Vt.prototype),q(Vt.prototype,"restartICE",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"restartICE"),Vt.prototype),q(Vt.prototype,"close",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"close"),Vt.prototype),q(Vt.prototype,"updateEncoderConfig",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"updateEncoderConfig"),Vt.prototype),q(Vt.prototype,"updateSendParameters",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"updateSendParameters"),Vt.prototype),q(Vt.prototype,"replaceTrack",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"replaceTrack"),Vt.prototype),q(Vt.prototype,"muteLocal",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"muteLocal"),Vt.prototype),q(Vt.prototype,"unmuteLocal",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteLocal"),Vt.prototype),Vt);function _i(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let h=this.mutex,p=await h.lock("From P2PConnection.".concat(r));try{for(var g=arguments.length,C=new Array(g),A=0;A<g;A++)C[A]=arguments[A];return await o.apply(this,C)}finally{p()}},i}function dm(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Nn(r.width),o.height=Nn(r.height);let h=Nn(r.framerate||15);document.body.append(i),document.body.append(o);let p=e._mediaStreamTrack;i.srcObject=new MediaStream([p]),i.play();let g=o.getContext("2d");if(!g)throw new O(R.UNEXPECTED_ERROR,"can not get canvas context");let C=ft(),A=o.captureStream(C.supportRequestFrame?0:h).getVideoTracks()[0];A.canvas||(A.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let _e=i.videoWidth,cN=i.videoHeight/_e,dN=o.width*cN;Math.abs(dN-o.height)>=2&&(_.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(dN)),o.height=dN)}g.drawImage(i,0,0,o.width,o.height),A.requestFrame&&A.requestFrame(),p!==e._mediaStreamTrack&&(p=e._mediaStreamTrack,i.srcObject=new MediaStream([p]))},o.stopCapture=Rf(()=>o.startCapture&&o.startCapture(),h);let x=A.stop;return A.stop=()=>{x.call(A),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),_.debug("clean low stream renderer")},A}var Al=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Al||{}),Ie=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Ie||{}),Do=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Do||{}),Qe=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(Qe||{}),Po=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Po||{}),g0=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(g0||{}),zr=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(zr||{}),mi=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(mi||{}),T0=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(T0||{}),$n=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}($n||{}),Rr=1e3,bo=3;function st(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function fv(e){let r={[$n.CONN_TYPE]:0,[$n.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[$n.CONN_TYPE]=1),i==="tcp"&&(r[$n.CONN_TYPE]=3),i==="tls"&&(r[$n.CONN_TYPE]=4);break}case"srflx":r[$n.CONN_TYPE]=2}return r}function gv(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}var pu=class extends Xt{constructor(e){super(),T(this,"store",void 0),T(this,"uploadWRTCStatsTimer",void 0),T(this,"uploadOutboundDenoiserStatsTimer",void 0),T(this,"uploadExtStatsTimer",void 0),T(this,"uploadExtUsageStatsTimer",void 0),T(this,"uploadInboundExtStatsTimer",void 0),T(this,"requestStats",void 0),T(this,"requestTransportStats",void 0),T(this,"requestLocalMedia",void 0),T(this,"requestRemoteMedia",void 0),T(this,"requestAllTracks",void 0),T(this,"requestVideoIsReady",void 0),T(this,"requestUploadStats",void 0),T(this,"requestUpload",void 0),T(this,"uploadOutboundStarted",!1),T(this,"uploadInboundStarted",!1),T(this,"uploadTransportStarted",!1),T(this,"uploadExtensionUsageStarted",!1),T(this,"lastRecvStats",void 0),T(this,"lastSendStats",void 0),T(this,"lastFullRecvStats",void 0),T(this,"lastFullSendStats",void 0),T(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let r,i;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),r||i){let o={};if(this.uploadTransportStarted&&r){let h=this.getTransportStats(r,i,e);h&&(o.misc=[h])}if(this.uploadOutboundStarted&&r){let h=this.getOutboundStats(r,e?this.lastSendStats:this.lastFullSendStats,e);h&&(o.outbound=[h])}if(this.uploadInboundStarted&&i){let h=this.getInboundStats(i,e?this.lastRecvStats:this.lastFullRecvStats,e);h&&(o.inbound=h)}this.requestUploadStats(o)}this.lastRecvStats=i,this.lastSendStats=r,e||(this.lastFullRecvStats=i,this.lastFullSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==bo),++e===bo+1&&(e=1)},Rr)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,r,i){if(!this.requestStats)return;if(i)return e.rtt==null?void 0:{addition:{[$n.RTT]:e.rtt,[$n.CONN_TYPE]:void 0}};let o=fv(e);if(this.store.useP2P){if(r){let h=fv(r);o[$n.CONN_TYPE]+=h[$n.CONN_TYPE]<<3}o[$n.CONN_TYPE]+=110}else o[$n.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(e,r,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;let o=this.requestLocalMedia();if(!o||o.length===0)return;let h,p,g;return o.forEach(C=>{let[A,{track:x,ssrcs:_e}]=C;switch(A){case U.LocalVideoLowTrack:case U.LocalVideoTrack:if(A===U.LocalVideoTrack){let cN=function(mN,EN,RN,IN,t0){let aH=EN.videoSend.find(zH=>zH.ssrc===mN);if(!aH)return;let pH={},{sentFrame:SH,inputFrame:vH}=aH;if(vH&&SH){let zH=vH.frameRate,CH=SH.frameRate;pH[Ie.FREEZE]=function(HH,VH){let KH=!0;return KH=!(HH<=5)&&(HH<=10?VH<3:HH<=20?VH<4:VH<5),KH}(zH,CH)?1:0}if(st(pH,Ie.QP_SUM,aH.qpSumPerFrame),t0)return pH;switch(SH&&(st(pH,Ie.HEIGHT,SH.height),st(pH,Ie.WIDTH,SH.width),st(pH,Ie.FRAME_RATE,SH.frameRate)),pH[Ie.DISABLED]=IN._originMediaStreamTrack&&!IN._originMediaStreamTrack.enabled||IN._mediaStreamTrack&&!IN._mediaStreamTrack.enabled?1:0,aH.adaptionChangeReason){case"none":pH[Ie.ADAPTATION]=0;break;case"cpu":pH[Ie.ADAPTATION]=1;break;case"bandwidth":pH[Ie.ADAPTATION]=2;break;case"other":pH[Ie.ADAPTATION]=3}let AH=0;aH.adaptionChangeReason&&(AH+=gv(aH.adaptionChangeReason)),EN.qualityLimitationReason&&(AH+=gv(EN.qualityLimitationReason)<<3),pH[Ie.ADAPTATION]=AH,pH[Ie.PLAYER_STATUS]=o_[IN._player?IN._player.videoElementStatus:"uninit"],st(pH,Ie.NACKS,aH.nacksCount),st(pH,Ie.PLIS,aH.plisCount),st(pH,Ie.FIRS,aH.firsCount),st(pH,Ie.AVG_ENCODE,aH.avgEncodeMs);let UH=RN&&RN.videoSend.find(zH=>zH.ssrc===mN);if(UH){let zH=t0?Rr:Rr*bo;UH.timestamp&&aH.timestamp&&(zH=aH.timestamp-UH.timestamp),UH.packets!=null&&aH.packets!=null&&st(pH,Ie.PACKAGE_RATE,1e3*(aH.packets-UH.packets)/zH),aH.packetsLost!=null&&UH.packetsLost!=null&&st(pH,Ie.PACKAGE_LOST,aH.packetsLost-UH.packetsLost),UH.bytes!=null&&aH.bytes!=null&&st(pH,Ie.BITRATE,8*(aH.bytes-UH.bytes)/zH)}return pH}(_e[0].ssrcId,e,r,x,i),dN=i?null:function(mN,EN,RN){let IN=EN.videoSend.find(AH=>AH.ssrc===mN);if(!IN)return null;let t0={},aH=IN.inputFrame,pH=aH&&aH.height||RN&&RN.videoHeight||0,SH=aH&&aH.width||RN&&RN.videoWidth||0,vH=aH&&aH.frameRate||0;return st(t0,Al.HEIGHT,pH),st(t0,Al.WIDTH,SH),st(t0,Al.FRAME_RATE,vH),t0}(_e[0].ssrcId,e,x),fN=i?null:function(mN){let EN={};return st(EN,Ie.RETRANSMIT,mN.bitrate.retransmit),st(EN,Ie.TARGET_ENCODED,mN.bitrate.targetEncoded),st(EN,Ie.ACTUAL_ENCODED,mN.bitrate.actualEncoded),st(EN,Ie.TRANSMIT,mN.bitrate.transmit),st(EN,Ie.BANDWIDTH,mN.sendBandwidth),EN}(e);p=Object.assign({},cN,dN,fN)}else g=i?void 0:function(cN,dN,fN){let mN=dN.videoSend.find(IN=>IN.ssrc===cN);if(!mN)return;let EN={},RN=mN.sentFrame;if(RN&&(st(EN,Do.HEIGHT,RN.height),st(EN,Do.WIDTH,RN.width),st(EN,Do.FRAME_RATE,RN.frameRate)),fN){let IN=fN.videoSend.find(t0=>t0.ssrc===cN);if(IN){let t0=Rr*bo;IN.timestamp&&mN.timestamp&&(t0=mN.timestamp-IN.timestamp),IN.packets!=null&&mN.packets!=null&&st(EN,Do.PACKAGE_RATE,1e3*(mN.packets-IN.packets)/t0),mN.packetsLost!=null&&IN.packetsLost!=null&&st(EN,Do.PACKAGE_LOST,mN.packetsLost-IN.packetsLost),IN.bytes!=null&&mN.bytes!=null&&st(EN,Do.BITRATE,8*(mN.bytes-IN.bytes)/t0)}}return EN}(_e[0].ssrcId,e,r);break;case U.LocalAudioTrack:h=i?void 0:function(cN,dN,fN,mN){let EN=dN.audioSend.find(pH=>pH.ssrc===cN);if(!EN)return;let RN={};RN[zr.DISABLED]=mN._originMediaStreamTrack&&!mN._originMediaStreamTrack.enabled||mN._mediaStreamTrack&&!mN._mediaStreamTrack.enabled?1:0;let IN=100*mN._source.getAccurateVolumeLevel(),t0=EN.inputLevel;if(t0!=null){let pH=Math.ceil(50*Math.log10(100*t0+1));st(RN,zr.LEVEL,pH)}st(RN,g0.PCM_LEVEL,IN),st(RN,zr.AEC_RETURN_LOSS,EN.aecReturnLoss),st(RN,zr.AEC_RETURN_LOSS_ENH,EN.aecReturnLossEnhancement),RN[zr.FREEZE]=0;let aH=fN&&fN.audioSend.find(pH=>pH.ssrc===cN);if(aH){let pH=Rr*bo;aH.timestamp&&EN.timestamp&&(pH=EN.timestamp-aH.timestamp),aH.bytes!=null&&EN.bytes!=null&&st(RN,zr.BITRATE,8*(EN.bytes-aH.bytes)/pH),aH.packets!=null&&EN.packets!=null&&st(RN,zr.PACKAGE_RATE,1e3*(EN.packets-aH.packets)/pH)}return RN}(_e[0].ssrcId,e,r,x)}}),{high:p,low:g,audio:h}}getInboundStats(e,r,i){if(!this.requestRemoteMedia)return;let o=this.requestRemoteMedia()||[],h=[];return o.forEach(p=>{let[g,C]=p,A={peer:g.uid};if(C.has(Q.VIDEO)&&g.videoTrack){let x=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,_e=g.videoTrack?function(cN,dN,fN,mN,EN,RN,IN){var t0;let aH=dN.videoRecv.find(CH=>CH.ssrc===cN);if(!aH)return;let pH={},{receivedFrame:SH,outputFrame:vH,decodeFrameRate:AH}=aH,UH=fN&&fN.videoRecv.find(CH=>CH.ssrc===cN);if(pH[Qe.FREEZE]=EN&&_u.isRemoteVideoFreeze(mN,aH,UH)?1:0,st(pH,Po.FRAME_RATE_DECODE,AH),st(pH,Qe.QP_SUM,aH.qpSumPerFrame),aH.framesRateFirefox&&st(pH,Qe.FRAME_RATE,aH.framesRateFirefox),SH&&st(pH,Qe.FRAME_RATE,SH.frameRate),UH){let CH=dN.timestamp-fN.timestamp||(IN?Rr:bo*Rr);aH.packetsLost!=null&&UH.packetsLost!=null&&st(pH,Qe.PACKAGE_LOST,aH.packetsLost-UH.packetsLost),UH.bytes!=null&&aH.bytes!=null&&st(pH,Qe.BITRATE,8*(aH.bytes-UH.bytes)/CH),UH.packets!=null&&aH.packets!=null&&st(pH,Qe.PACKAGE_RATE,1e3*(aH.packets-UH.packets)/CH)}if(IN)return pH;SH?(st(pH,Qe.HEIGHT,SH.height),st(pH,Qe.WIDTH,SH.width)):mN&&(st(pH,Qe.HEIGHT,mN._videoHeight||0),st(pH,Qe.WIDTH,mN._videoWidth||0)),vH&&st(pH,Po.FRAME_RATE_OUTPUT,vH.frameRate);let zH=(t0=mN._player)===null||t0===void 0?void 0:t0.rendFrameRate.toFixed(0);if(zH&&st(pH,Po.FRAME_RATE_RENDER,+zH),st(pH,Qe.JITTER_BUFFER,aH.jitterBufferMs),st(pH,Qe.CURRENT_DELAY,aH.currentDelayMs),st(pH,Qe.FIRS,aH.firsCount),st(pH,Qe.NACKS,aH.nacksCount),st(pH,Qe.PLIS,aH.plisCount),mN){pH[Qe.DISABLED]=mN._originMediaStreamTrack.enabled&&mN._mediaStreamTrack.enabled?0:1;let CH=mN._player;if(CH){let{freezeTimeCounterList:HH,renderFreezeAccTime:VH,videoElementStatus:KH}=CH;if(HH&&HH.length>0&&st(pH,Po.FREEZE_TIME,HH.splice(0,1)[0]),RN&&yr.visibility==="visible"&&KH===nn.PLAYING&&ft().supportRequestVideoFrameCallback){let IH=Math.min(6e3,VH);CH.renderFreezeAccTime=Math.max(0,VH-IH),st(pH,Po.FREEZE_TIME_RENDER,IH)}if(typeof aH.totalFreezesDuration=="number"){let IH=UH&&UH.totalFreezesDuration?aH.totalFreezesDuration-UH.totalFreezesDuration:aH.totalFreezesDuration;st(pH,Po.FREEZE_DURATION,1e3*IH)}}}if(pH[Qe.PLAYER_STATUS]=o_[mN._player?mN._player.videoElementStatus:"uninit"],UH&&aH.totalInterFrameDelay!==void 0&&aH.totalSquaredInterFrameDelay!==void 0&&UH.totalInterFrameDelay!==void 0&&UH.totalSquaredInterFrameDelay!==void 0){let CH=aH.totalInterFrameDelay-UH.totalInterFrameDelay,HH=aH.totalSquaredInterFrameDelay-UH.totalSquaredInterFrameDelay,VH=aH.framesDecodeCount-UH.framesDecodeCount,KH=CH/VH*1e3,IH=Math.round(1e3*Math.sqrt((HH-Math.pow(CH,2)/VH)/VH));!isNaN(IH)&&KH+IH>Math.max(3*KH,KH+150)&&(pH[Qe.I_FRAME_DELAY]=IH)}return pH}(g._videoSSRC,e,r,g.videoTrack,x===!0,this.needUploadRenderFreezeTime,i):void 0;_e&&(A.video=_e)}if(C.has(Q.AUDIO)&&g.audioTrack){let x=g.audioTrack?function(_e,cN,dN,fN,mN){let EN=cN.audioRecv.find(UH=>UH.ssrc===_e);if(!EN)return;let RN={},IN=dN&&dN.audioRecv.find(UH=>UH.ssrc===_e),{receivedFrames:t0,droppedFrames:aH}=EN;var pH,SH;if(st(RN,mi.JITTER,EN.jitterMs),t0!=null&&aH!=null&&(RN[mi.FREEZE]=(SH=aH,(pH=t0)===0||100*SH/pH>20?1:0)),IN){let UH=cN.timestamp-dN.timestamp||(mN?Rr:Rr*bo);EN.packets!=null&&IN.packets!=null&&st(RN,mi.PACKAGE_RATE,1e3*(EN.packets-IN.packets)/UH),IN.bytes!=null&&EN.bytes!=null&&st(RN,mi.BITRATE,8*(EN.bytes-IN.bytes)/UH),EN.packetsLost!=null&&IN.packetsLost!=null&&st(RN,mi.PACKAGE_LOST,EN.packetsLost-IN.packetsLost)}if(mN)return RN;let vH=100*fN._source.getAccurateVolumeLevel(),AH=EN.outputLevel;if(AH!=null){let UH=Math.ceil(50*Math.log10(100*AH+1));st(RN,T0.LEVEL,UH)}if(st(RN,mi.PCM_LEVEL,vH),fN&&(RN[mi.DISABLED]=fN._originMediaStreamTrack.enabled&&fN._mediaStreamTrack.enabled?0:1),st(RN,mi.JITTER_BUFFER,EN.jitterBufferMs),st(RN,mi.CURRENT_DELAY,EN.jitterBufferMs),RN[mi.PLAYER_STATUS]=o_[En.getPlayerState(fN.getTrackId())],IN){let UH=EN.concealedSamples-IN.concealedSamples;UH>0&&st(RN,mi.CONCEALED_SAMPLES,UH)}return RN}(g._audioSSRC,e,r,g.audioTrack,i):void 0;x&&(A.audio=x)}(A.video||A.audio)&&h.push(A)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(r=>r instanceof ou);if(e&&e._external.getDenoiserStats){let r=e._external.getDenoiserStats();r&&this.requestUpload(wc.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[r,i]=e;i.has(Q.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),i.has(Q.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let r=Date.now(),i={connectionInterval:v("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r},o=[],h=this.requestAllTracks&&this.requestAllTracks()||[];for(let A of h)!A.muted&&A.enabled&&(o=o.concat(await A.getProcessorUsage()));let p=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[A,x]of p)x.has(Q.VIDEO)&&A.videoTrack&&(o=o.concat(await A.videoTrack.getProcessorUsage())),x.has(Q.AUDIO)&&A.audioTrack&&(o=o.concat(await A.audioTrack.getProcessorUsage()));if(o.length===0)return;i.details=function(A,x){let _e={};for(let{id:mN,value:EN,level:RN,direction:IN}of A){var cN;let t0=(cN=x.get(mN))!==null&&cN!==void 0?cN:0,aH=EN===2?t0+v("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:t0;var dN,fN;x.set(mN,aH),_e[mN]?(EN===2&&(_e[mN].value=EN),RN>_e[mN].level&&(_e[mN].level=RN),IN==="remote"&&(_e[mN].remoteUidCount+=1),_e[mN].totalTs=(dN=x.get(mN))!==null&&dN!==void 0?dN:0):_e[mN]={value:EN,level:RN,remoteUidCount:IN==="local"?0:1,totalTs:(fN=x.get(mN))!==null&&fN!==void 0?fN:0}}return Object.keys(_e).map(mN=>{let{level:EN,value:RN,totalTs:IN}=_e[mN];return{id:mN,level:EN,value:RN,totalTs:IN}})}(o,e);let g=Date.now(),C=g>r?g:r+1;this.requestUpload&&this.requestUpload(wc.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:C})},v("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},ir=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,r){T(this,"uid",void 0),T(this,"_uintid",void 0),T(this,"_trust_in_room_",!0),T(this,"_trust_audio_enabled_state_",!0),T(this,"_trust_video_enabled_state_",!0),T(this,"_trust_audio_mute_state_",!0),T(this,"_trust_video_mute_state_",!0),T(this,"_audio_muted_",!1),T(this,"_video_muted_",!1),T(this,"_audio_enabled_",!0),T(this,"_video_enabled_",!0),T(this,"_audio_added_",!1),T(this,"_video_added_",!1),T(this,"_is_pre_created",!1),T(this,"_video_pre_subscribed",!1),T(this,"_audio_pre_subscribed",!1),T(this,"_trust_video_stream_added_state_",!0),T(this,"_trust_audio_stream_added_state_",!0),T(this,"_audioTrack",void 0),T(this,"_videoTrack",void 0),T(this,"_dataChannels",[]),T(this,"_audioSSRC",void 0),T(this,"_videoSSRC",void 0),T(this,"_audioOrtc",void 0),T(this,"_videoOrtc",void 0),T(this,"_cname",void 0),T(this,"_rtxSsrcId",void 0),T(this,"_videoMid",void 0),T(this,"_audioMid",void 0),this.uid=e,this._uintid=r}},Ui=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function uW(e,r){var i;let o;switch(r){case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoTrack:o=W(i=e._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:o=Ct.Low}return o}function lm(e){let r=ft();if(e.some(i=>i._bypassWebAudio))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function E_(e,r){lm(e);let i=new ge;return e.forEach(o=>i.addAudioTrack(o)),i}var Tv,Sv,Rv,Cv,Iv,vv,yv,Av,bv,wv,Ov,Ht;function Nv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Yd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Nv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Nv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var An=(Tv=Pi(Ui.SEND_ONLY),Sv=Pi(Ui.SEND_ONLY),Rv=Pi(),Cv=Pi(Ui.RECEIVE_ONLY),Iv=Pi(Ui.RECEIVE_ONLY),vv=Pi(Ui.RECEIVE_ONLY),yv=Pi(Ui.RECEIVE_ONLY),Av=Pi(Ui.RECEIVE_ONLY),bv=Pi(Ui.RECEIVE_ONLY),wv=Pi(),Ov=Pi(Ui.RECEIVE_ONLY),Ht=class extends Xt{get state(){return this._state}set state(e){let r=this._state;this._state=e,this.emit(tt.StateChange,r,this._state)}constructor(e,r){super(),T(this,"isPlanB",!1),T(this,"store",void 0),T(this,"statsUploader",void 0),T(this,"sendConnection",void 0),T(this,"recvConnection",void 0),T(this,"localTrackMap",new Map),T(this,"remoteUserMap",new Map),T(this,"localDataChannels",[]),T(this,"pendingLocalTracks",[]),T(this,"pendingRemoteTracks",[]),T(this,"statsCollector",void 0),T(this,"dtlsFailedCount",0),T(this,"sendMutex",new ze("P2PChannel2-send-mutex")),T(this,"recvMutex",new ze("P2PChannel2-recv-mutex")),T(this,"_state",Rt.Disconnected),T(this,"_restartStates",["disconnected","failed"]),T(this,"reconnectInterval",void 0),T(this,"uploadUnplinkStarted",!1),T(this,"uploadDownlinkStarted",!1),T(this,"uplinkStateUploadInterval",void 0),T(this,"downlinkStatsUploadInterval",void 0),T(this,"handleMuteLocalTrack",async(i,o,h)=>{let p=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Rt.Connected)return void h(new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let A=this.filterTobeMutedTracks(i);if(A.length===0)return void o();let x=A.find(fN=>fN[0]==="videoLowTrack");x&&x[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(A.map(fN=>{let[,{id:mN}]=fN;return mN}));let _e=!1;var g,C;i.trackMediaType==="video"?_e=!((g=this.localTrackMap.get(U.LocalAudioTrack))===null||g===void 0||!g.track._muted):_e=((C=this.localTrackMap.get(U.LocalVideoTrack))===null||C===void 0?void 0:C.id)===void 0;let cN=this.createMuteMessage(A);await kt(this,tt.RequestMuteLocal,cN);let dN=i.trackMediaType==="video"?to.MUTE_LOCAL_VIDEO:to.MUTE_LOCAL_AUDIO;await kt(this,tt.RequestP2PMuteLocal,{action:dN,message:cN,isMuteAll:_e}),o()}catch(A){h(A)}finally{p()}}),T(this,"handleUnmuteLocalTrack",async(i,o,h)=>{let p=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Rt.Connected)return void h(new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let g=this.filterTobeUnmutedTracks(i);if(g.length===0)return void o();await this.sendConnection.unmuteLocal(g.map(x=>{let[,{id:_e}]=x;return _e}));let C=this.createUnmuteMessage(g),A=i.trackMediaType==="video"?to.UNMUTE_LOCAL_VIDEO:to.UNMUTE_LOCAL_AUDIO;await kt(this,tt.RequestP2PMuteLocal,{action:A,message:C}),o()}catch(g){h(g)}finally{p()}}),T(this,"handleUpdateVideoEncoder",async(i,o,h)=>{let p=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let g=this.localTrackMap.get(U.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==Rt.Connected)return void o();let{id:C,track:A}=g;C&&(await this.sendConnection.updateSendParameters(C,A),await this.sendConnection.updateEncoderConfig(C,A),this.emit(tt.UpdateVideoEncoder,A)),o()}catch(g){h(g)}finally{p()}}),T(this,"handleUpdateVideoSendParameters",async(i,o,h)=>{let p=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let g=this.localTrackMap.get(U.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==Rt.Connected)return void o();let{id:C,track:A}=g;C&&await this.sendConnection.updateSendParameters(C,A),o()}catch(g){h(g)}finally{p()}}),T(this,"handleReplaceTrack",async(i,o,h,p)=>{let g;_.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof p=="boolean"&&p||(g=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var C;let x=Array.from(this.localTrackMap.entries()).find(_e=>{let[,{track:cN}]=_e;return i===cN});if(!this.sendConnection||!x||x[1].id===void 0||this.state!==Rt.Connected)return void o();if(await((C=this.sendConnection)===null||C===void 0?void 0:C.replaceTrack(i,x[1].id)),x[0]===U.LocalVideoTrack&&ft().supportDualStreamEncoding){let _e=this.localTrackMap.get(U.LocalVideoLowTrack);if(_e){let cN=i._mediaStreamTrack.clone();_e.track._originMediaStreamTrack.stop(),_e.track._mediaStreamTrack=cN,_e.track._originMediaStreamTrack=cN,await new j((dN,fN)=>{this.handleReplaceTrack(_e.track,dN,fN,!0)})}}o()}catch(x){h(x)}finally{var A;(A=g)===null||A===void 0||A()}}),T(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),T(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),T(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),T(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new pu(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},v("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new N(R.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new N(R.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(_.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new mv(e,this.store,cn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Rt.New,this.sendConnection&&(_.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new mv(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Rt.Connected}async addRemoteCandidate(e,r){if(r===cn.RECEIVE_ONLY){if(!this.sendConnection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return Bi(function*(){let h=yield Tt(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Rt.Connected){o.throwIfTrackTypeNotMatch(e);let x=e.filter(_e=>o.pendingLocalTracks.indexOf(_e)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(x))}o.store.pubId=o.store.pubId+1,qe.markPublishStart(o.store.clientId,o.store.pubId);let p=o.filterTobePublishedTracks(e,r,i);if(p.length===0)return void(yield Tt(o.tryToUnmuteAudio(e)));p.forEach(x=>{let{track:_e,type:cN}=x,dN=Date.now();o.store.publish(_e.getTrackId(),cN===U.LocalAudioTrack?"audio":"video",dN)}),o.bindLocalTrackEvents(p);let g=yield Tt(o.sendConnection.send(p.map(x=>{let{track:_e}=x;return _e}),o.store.codec,o.store.audioCodec)),C=(yield Tt(g.next())).value,A=o.createGatewayPublishMessage(p,C);try{yield A}catch(x){throw g.throw(x),(x==null?void 0:x.code)===R.WS_ABORT&&p.forEach(_e=>{let{track:cN}=_e;o.pendingLocalTracks.indexOf(cN)===-1&&o.pendingLocalTracks.push(cN)}),o.unbindLocalTrackEvents(p),x}yield Tt(g.next()),p.forEach(x=>{let{type:_e}=x;o.statsCollector.addLocalStats(_e)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(p,C),p.forEach(x=>{let{track:_e,type:cN}=x,dN=Date.now();o.store.publish(_e.getTrackId(),cN===U.LocalAudioTrack?"audio":"video",void 0,dN)}),o.startUploadUplinkState()}finally{h()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Rt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(h=>!W(e).call(e,h)));let r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;let i=r.find(h=>h[0]==="videoLowTrack");i&&i[1].track.close();let o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(h=>{let[,{id:p}]=h;return p})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(h=>{let[p,{track:g}]=h;return{type:p,track:g}})),r.forEach(h=>{let[p]=h;this.statsCollector.removeLocalStats(p)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Rt.Connected)return i&&i[1].track.close(),o;e.forEach(h=>{let p=this.pendingLocalTracks.indexOf(h);p!==-1&&this.pendingLocalTracks.splice(p,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[h,{track:p,ssrcs:g}]=o,C={stream_type:uW(p,h),ssrcs:g};p._muted||!p._enabled?r.push(C):i.push(C)}),r.length>0&&r.forEach(o=>{kt(this,tt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{kt(this,tt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Bi(function*(){throw new N(R.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(_.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ge(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new N(R.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var h;if(!this.recvConnection)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((h=this.remoteUserMap.get(e))!==null&&h!==void 0&&h.has(r))return;let{track:p,mid:g,transceiver:C}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===Q.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(p):(e._audioTrack=new Ks(p,e.uid,e._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),C&&e._audioTrack._updateRtpTransceiver(C),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(p):(e._videoTrack=new Hs(p,e.uid,e._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),C&&e._videoTrack._updateRtpTransceiver(C),this.bindRemoteTrackEvents(e,e._videoTrack));let A=this.remoteUserMap.get(e);A?A.set(r,g):this.remoteUserMap.set(e,new Map([[r,g]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let x=this.pendingRemoteTracks.findIndex(_e=>{let{user:cN,kind:dN}=_e;return cN.uid===e.uid&&r===dN});x!==-1&&(this.pendingRemoteTracks.splice(x,1),this.emit(tt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){let o=this.pendingRemoteTracks.filter(p=>{let{user:g,kind:C}=p;return r!==void 0?g.uid===e.uid&&r===C:g.uid===e.uid});if(o.forEach(p=>{let g=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(g,1)}),this.recvConnection||i||o.forEach(p=>{let{kind:g}=p;var C;if(g===Q.AUDIO)(C=e._audioTrack)===null||C===void 0||C._destroy(),e._audioTrack=void 0;else if(g===Q.VIDEO){var A;(A=e._videoTrack)===null||A===void 0||A._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let h=this.filterTobeUnSubscribedTracks(e,r);h.length!==0&&(await this.recvConnection.stopReceiving(h.map(p=>{let[,{id:g}]=p;return g})),this.withdrawRemoteTracks(h),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),h.forEach(p=>{let[g,{kind:C}]=p;var A,x;if(C===Q.VIDEO&&g._videoSSRC&&((A=this.recvConnection)===null||A===void 0||A.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),C===Q.VIDEO)this.unbindRemoteTrackEvents(g._videoTrack),i||((x=g._videoTrack)===null||x===void 0||x._destroy(),g._videoTrack=void 0);else if(C===Q.AUDIO){var _e;this.unbindRemoteTrackEvents(g._audioTrack),!i&&((_e=g._audioTrack)===null||_e===void 0||_e._destroy(),g._audioTrack=void 0)}}),h.forEach(p=>{let[,{kind:g}]=p;kt(this,tt.RequestP2PMuteRemote,g)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[Q.VIDEO,Q.AUDIO].forEach(o=>{i.has(o)?kt(this,tt.RequestP2PUnmuteRemote,o):kt(this,tt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void _.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void _.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));let o=r===Q.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void _.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||_.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){let r=this.localTrackMap.get(U.LocalAudioTrack);if((r==null?void 0:r.track)instanceof ge){let i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[h]=o;return h!==U.LocalAudioTrack}).filter(o=>{let[h]=o;return!(e&&h===U.LocalVideoLowTrack)}).map(o=>{let[,{track:h}]=o;return h}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===U.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,h){if(e){let g=this.localTrackMap.get(U.LocalAudioTrack),C=o?this.localTrackMap.get(U.LocalVideoLowTrack):this.localTrackMap.get(U.LocalVideoTrack);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.track.getTrackLabel(),videoName:C==null?void 0:C.track.getTrackLabel(),screenshare:(C==null?void 0:C.track._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!g,video:!!C,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}else{var p;i||(i=[]);let g=i.find(A=>A instanceof Qt),C=o?(p=this.localTrackMap.get(U.LocalVideoTrack))===null||p===void 0?void 0:p.track:i.find(A=>A instanceof Ft);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.getTrackLabel(),videoName:C==null?void 0:C.getTrackLabel(),screenshare:(C==null?void 0:C._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!g,video:!!C,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}}reportSubscribeEvent(e,r,i,o){let h=o===Q.VIDEO?i._videoSSRC:i._audioSSRC;h&&X.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===Q.VIDEO,audio:o===Q.AUDIO,peerid:i.uid,subscribeRequestid:o===Q.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:qe.measureFromSubscribeStart(this.store.clientId,h)})}reset(){_.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ze("P2PChannel2-send-mutex"),this.sendMutex=new ze("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(U.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ge){if(e.track.trackList.length>0){let r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Rt.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(U.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(U.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let r=this.localTrackMap.get(e);return r&&r.track instanceof Ft||r&&r.track instanceof Qt?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),r=this.localTrackMap.get(U.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ed(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(_.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Rt.Reconnecting,v("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case U.LocalVideoTrack:W(r=o._hints).call(r,Gt.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case U.LocalAudioTrack:o instanceof ge?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case U.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(xn(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(tt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),_.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(let i of this.pendingRemoteTracks){let{user:o,kind:h}=i;if((e instanceof ir?e.uid:e)===o.uid&&r===h)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===cn.SEND_ONLY){if(!this.sendConnection)throw new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){let h=await o.restartICE(r);return o.isInRestartIce=!1,h}{let h=await o.restartICE();if(h){let p=await Ge(this,tt.RequestP2PRestartICE,{direction:cn.RECEIVE_ONLY,iceParameter:h});await o.restartICE(p),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),r=this.localTrackMap.get(U.LocalVideoTrack),i=this.localTrackMap.get(U.LocalAudioTrack),o=e.videoSend.find(fN=>{var mN;return fN.ssrc===(r==null||(mN=r.ssrcs)===null||mN===void 0?void 0:mN[0].ssrcId)}),h=e.audioSend.find(fN=>{var mN;return fN.ssrc===(i==null||(mN=i.ssrcs)===null||mN===void 0?void 0:mN[0].ssrcId)});if(!o||!h)return 1;let p=ni(this,tt.NeedSignalRTT),g=o?o.rttMs:void 0,C=h?h.rttMs:void 0,A=g&&C?(g+C)/2:g||C,x=(A&&p?(A+p)/2:A||p)||0,_e=100*e.sendPacketLossRate*.7/50+.3*x/1500,cN=_e<.17?1:_e<.36?2:_e<.59?3:_e<.1?4:5,dN=r==null?void 0:r.track;if(dN&&dN._encoderConfig&&dN._hints.indexOf(Gt.SCREEN_TRACK)===-1){let fN=dN._encoderConfig.bitrateMax,mN=e.bitrate.actualEncoded;if(fN&&mN){let EN=(1e3*fN-mN)/(1e3*fN);return OO[EN<.15?0:EN<.3?1:EN<.45?2:EN<.6?3:4][cN]}}return cN}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i,h=o._audioSSRC,p=o._videoSSRC,g=e.audioRecv.find(mN=>mN.ssrc===h),C=e.videoRecv.find(mN=>mN.ssrc===p);if(!g&&!C)return void(r+=1);let A=ni(this,tt.NeedSignalRTT),x=e.rtt,_e=(x&&A?(x+A)/2:x||A)||0,cN=g?g.jitterMs:void 0,dN=e.recvPacketLossRate,fN=.7*dN*100/50+.3*_e/1500;cN&&(fN=.6*dN*100/50+.2*_e/1500+.2*cN/400),r+=fN<.1?1:fN<.17?2:fN<.36?3:fN<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new j((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){let o=[],h=ft(),p=this.getAllTracks();e=Ls(e=e.filter(A=>p.indexOf(A)===-1));let g=!1,C=!1;for(let A of e){if(A instanceof Ft&&(this.localTrackMap.has(U.LocalVideoTrack)||g?new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:A,type:U.LocalVideoTrack}),g=!0),r)){let x=this.getLowVideoTrack(A,i);o.push({track:x,type:U.LocalVideoLowTrack})}if(A instanceof Qt){let x=this.localTrackMap.get(U.LocalAudioTrack);if(x){if(!(x.track instanceof ge))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");x.track.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0)}else if(C){let _e=o.find(cN=>{let{type:dN}=cN;return dN===U.LocalAudioTrack});if(!(_e.track instanceof ge))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_e.track.addAudioTrack(A)}else{if(!h.webAudioMediaStreamDest||A instanceof ge||A._bypassWebAudio)o.push({track:A,type:U.LocalAudioTrack});else{let _e=new ge;_e.addAudioTrack(A),o.push({track:_e,type:U.LocalAudioTrack})}C=!0}}}return o}filterTobeUnpublishedTracks(e){let r=[],i=this.getAllTracks();e=Ls(e=e.filter(o=>i.indexOf(o)!==-1));for(let o of e){if(o instanceof Qt){let h=this.localTrackMap.get(U.LocalAudioTrack);if(!h)continue;h.track instanceof ge?(h.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),h.track.trackList.length===0&&(r.push([U.LocalAudioTrack,h]),h.track.close())):r.push([U.LocalAudioTrack,h])}if(o instanceof Ft){let h=this.localTrackMap.get(U.LocalVideoTrack);if(!h)continue;r.push([U.LocalVideoTrack,h]);let p=this.localTrackMap.get(U.LocalVideoLowTrack);p&&r.push([U.LocalVideoLowTrack,p])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case U.LocalVideoTrack:i.addListener(H.GET_STATS,this.handleGetLocalVideoStats),i.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case U.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof ge?e.trackList.forEach(i=>{i.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(H.GET_STATS,this.handleGetLocalAudioStats),i.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(H.GET_STATS,this.handleGetLocalAudioStats),e.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case U.LocalVideoTrack:i.off(H.GET_STATS,this.handleGetLocalVideoStats),i.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case U.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ge?e.trackList.forEach(r=>{r.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(H.GET_STATS,this.handleGetLocalAudioStats),r.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(H.GET_STATS,this.handleGetLocalAudioStats),e.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Hs&&r.addListener(H.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Ks&&r.addListener(H.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(H.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(Q.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Q.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var h;let p,{track:g,type:C}=i;switch(C){case U.LocalAudioTrack:p=Ct.Audio;break;case U.LocalVideoTrack:p=W(h=g._hints).call(h,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:p=Ct.Low}return{kind:C===U.LocalAudioTrack?Q.AUDIO:Q.VIDEO,stream_type:p,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:g.muted||!g.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[h,{track:p,ssrcs:g,id:C}]=r;switch(h){case U.LocalVideoTrack:o=W(i=p._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoLowTrack:o=Ct.Low}return{stream_type:o,ssrcs:g,mid:C}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:h,type:p}=i;this.localTrackMap.set(p,{track:h,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(tt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),W(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await Me(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),X.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Zt.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;let o=Array.from(xn(i=this.remoteUserMap).call(i)).find(p=>p._audioSSRC===r);var h;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(h=o.audioTrack)===null||h===void 0||h.emit(Ws.FIRST_FRAME_DECODED),X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_DECODE,Jt.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;let o=Array.from(xn(i=this.remoteUserMap).call(i)).find(h=>h._audioSSRC===r);o&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_RECEIVED,Jt.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;let o=Array.from(xn(i=this.remoteUserMap).call(i)).find(h=>h._videoSSRC===r);o&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_VIDEO_RECEIVED,Jt.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{let o=r.candidateType==="relay",h=i.candidateType==="relay";i.candidateType!=="unknown"&&o===h||this.emit(tt.ConnectionTypeChange,o),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(eo(i))," -> ").concat(JSON.stringify(eo(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(eo(i))," -> ").concat(JSON.stringify(eo(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(tt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let r=e===cn.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,_.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===cn.SEND_ONLY?this.restartICE(e):Ge(this,tt.RequestP2PRestartICE,{direction:cn.SEND_ONLY}))}filterTobeMutedTracks(e){let r=[];if(this.getAllTracks().indexOf(e)===-1)return r;let i=this.localTrackMap.get(U.LocalAudioTrack);if(e instanceof Qt&&(i==null?void 0:i.track)instanceof ge)return i.track.isActive||r.push([U.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return e===p});if(o&&(r.push(o),o[0]===U.LocalVideoTrack)){let h=this.localTrackMap.get(U.LocalVideoLowTrack);h&&r.push([U.LocalVideoLowTrack,h])}return r}filterTobeUnmutedTracks(e){let r=[],i=this.localTrackMap.get(U.LocalAudioTrack);if(e instanceof Qt&&(i==null?void 0:i.track)instanceof ge)return i.track.isActive&&r.push([U.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return e===p});if(o)if(o[0]===U.LocalVideoTrack){r.push(o);let h=this.localTrackMap.get(U.LocalVideoLowTrack);h&&r.push([U.LocalVideoLowTrack,h])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[h,{track:p,ssrcs:g,id:C}]=r;switch(h){case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoTrack:o=W(i=p._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:o=Ct.Low}return{stream_type:o,ssrcs:g,mid:C}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[h,{track:p,ssrcs:g,id:C}]=r;switch(h){case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoTrack:o=W(i=p._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:o=Ct.Low}return{stream_type:o,ssrcs:g,mid:C}})}filterTobeUnSubscribedTracks(e,r){let i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){let h=o.get(r);if(!h)return i;i.push([e,{kind:r,id:h}])}else Array.from(o.entries()).forEach(h=>{let[p,g]=h;i.push([e,{kind:p,id:g}])});return i}createUnsubscribeMessage(e){let r=[];return e.forEach(i=>{let[o,{kind:h,id:p}]=i;switch(h){case Q.VIDEO:return void(o._videoSSRC&&r.push({stream_type:Q.VIDEO,ssrcId:o._videoSSRC}));case Q.AUDIO:return void(o._audioSSRC&&r.push({stream_type:Q.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r,h=this.remoteUserMap.get(i);h&&(h.delete(o),Array.from(h.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let r=this.localTrackMap.get(U.LocalVideoTrack),i=this.localTrackMap.get(U.LocalVideoLowTrack);r&&await r.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Qt){let i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;let o=this.createUnmuteMessage(i);return void await kt(this,tt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(tt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Me(hf(this.dtlsFailedCount,Ee)),this.emit(tt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(U.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ft)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Ft).length>1)throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Qt).length>1&&(e.some(r=>r instanceof Qt&&r._bypassWebAudio)||!ft().webAudioMediaStreamDest))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let r of e){if(r instanceof Ft&&this.pendingLocalTracks.some(i=>i instanceof Ft))throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Qt&&this.pendingLocalTracks.some(i=>i instanceof Qt)&&(!ft().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Qt&&i._bypassWebAudio)))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){let i=!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding,o=Yd(Yd({},{width:160,height:120,framerate:15,bitrate:50}),r),h;h=i?e._mediaStreamTrack.clone():dm(e,o);let p=Ut(8,"track-low-"),g=new Ft(h,Yd(Yd({},i&&{scaleResolutionDownBy:GE(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,p);return g.on(Ko.TRANSCEIVER_UPDATED,C=>{e._updateRtpTransceiver(C,na.LOW_STREAM)}),g._hints.push(Gt.LOW_STREAM),e.addListener(H.NEED_CLOSE,()=>{g.close()}),g}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var h;let p=Array.from(xn(h=this.remoteUserMap).call(h)).find(g=>g._videoSSRC===e);if(p){o||this.store.subscribe(p.uid,"video",void 0,void 0,void 0,void 0,Date.now());let g=this.store.keyMetrics,C=g.subscribe.find(A=>A.userId===p.uid&&A.type==="video");X.firstRemoteVideoDecode(this.store.sessionId,De.FIRST_VIDEO_DECODE,Jt.FIRST_VIDEO_DECODE,{peer:p._uintid,videowidth:r,videoheight:i,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:g.requestAPEnd||0,apStart:g.requestAPStart||0,joinGwEnd:g.joinGatewayEnd||0,joinGwStart:g.joinGatewayStart||0,pcEnd:g.peerConnectionEnd||0,pcStart:g.peerConnectionStart||0,subscriberEnd:(C==null?void 0:C.subscribeEnd)||0,subscriberStart:(C==null?void 0:C.subscribeStart)||0,videoAddNotify:(C==null?void 0:C.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let h=o.get(r);if(!h)return!1;let p=await this.recvConnection.getRemoteSSRC(h);return p!==void 0&&p!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new N(R.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new N(R.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new N(R.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new N(R.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new N(R.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new N(R.NOT_SUPPORTED)}async preConnect(e){throw new N(R.NOT_SUPPORTED)}getEstablishParams(){throw new N(R.NOT_SUPPORTED)}async reSubscribe(e){throw new N(R.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new N(R.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===U.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,na.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},q(Ht.prototype,"p2pConnect",[Tv],Object.getOwnPropertyDescriptor(Ht.prototype,"p2pConnect"),Ht.prototype),q(Ht.prototype,"unpublish",[Sv],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublish"),Ht.prototype),q(Ht.prototype,"unpublishLowStream",[Rv],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublishLowStream"),Ht.prototype),q(Ht.prototype,"subscribe",[Cv],Object.getOwnPropertyDescriptor(Ht.prototype,"subscribe"),Ht.prototype),q(Ht.prototype,"mockSubscribe",[Iv],Object.getOwnPropertyDescriptor(Ht.prototype,"mockSubscribe"),Ht.prototype),q(Ht.prototype,"unsubscribe",[vv],Object.getOwnPropertyDescriptor(Ht.prototype,"unsubscribe"),Ht.prototype),q(Ht.prototype,"muteRemote",[yv],Object.getOwnPropertyDescriptor(Ht.prototype,"muteRemote"),Ht.prototype),q(Ht.prototype,"unmuteRemote",[Av],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteRemote"),Ht.prototype),q(Ht.prototype,"hasRemoteMediaWithLock",[bv],Object.getOwnPropertyDescriptor(Ht.prototype,"hasRemoteMediaWithLock"),Ht.prototype),q(Ht.prototype,"disconnectForReconnect",[wv],Object.getOwnPropertyDescriptor(Ht.prototype,"disconnectForReconnect"),Ht.prototype),q(Ht.prototype,"remoteMediaSsrcChanged",[Ov],Object.getOwnPropertyDescriptor(Ht.prototype,"remoteMediaSsrcChanged"),Ht.prototype),Ht);function Pi(e){return function(r,i,o){let h=r[i];if(typeof h!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var p=arguments.length,g=new Array(p),C=0;C<p;C++)g[C]=arguments[C];switch(e){case Ui.SEND_ONLY:{let A=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await h.apply(this,g)}finally{A()}}case Ui.RECEIVE_ONLY:{let A=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await h.apply(this,g)}finally{A()}}default:{let A=await this.sendMutex.lock("From P2PChannel2.".concat(i)),x=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await h.apply(this,g)}finally{A(),x()}}}},o}}function Dv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function wo(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Dv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var _u=class _he{constructor(r){T(this,"store",void 0),T(this,"onStatsException",void 0),T(this,"onUploadPublishDuration",void 0),T(this,"onStatsChanged",void 0),T(this,"localStats",new Map),T(this,"remoteStats",new Map),T(this,"updateStatsInterval",void 0),T(this,"trafficStats",void 0),T(this,"trafficStatsPeerList",[]),T(this,"uplinkStats",void 0),T(this,"exceptionMonitor",void 0),T(this,"p2pChannel",void 0),T(this,"scalabilityMode",xE.L1T1),T(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new rm,this.exceptionMonitor.on("exception",(i,o,h)=>{this.onStatsException&&this.onStatsException(i,o,h)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(U.LocalAudioTrack)||wo({},KE)}getLocalVideoTrackStats(){return this.localStats.get(U.LocalVideoTrack)||wo({},YE)}getRemoteAudioTrackStats(r){let i=(p,g)=>{if(!this.trafficStats)return g;let C=this.trafficStats.peer_delay.find(A=>A.peer_uid===p);return C&&(g.publishDuration=C.B_ppad+(Date.now()-this.trafficStats.timestamp)),g},o={};if(r){var h;let p=(h=this.remoteStats.get(r))===null||h===void 0?void 0:h.audioStats;p&&(o[r]=i(r,p))}else Array.from(this.remoteStats.entries()).forEach(p=>{let[g,{audioStats:C}]=p;C&&(o[g]=i(g,C))});return o}getRemoteNetworkQualityStats(r){let i={};if(r){var o;let h=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;h&&(i[r]=h)}else Array.from(this.remoteStats.entries()).forEach(h=>{let[p,{networkStats:g}]=h;g&&(i[p]=g)});return i}getRemoteVideoTrackStats(r){let i=(p,g)=>{if(!this.trafficStats)return g;let C=this.trafficStats.peer_delay.find(A=>A.peer_uid===p);return C&&(g.publishDuration=C.B_ppvd+(Date.now()-this.trafficStats.timestamp)),g},o={};if(r){var h;let p=(h=this.remoteStats.get(r))===null||h===void 0?void 0:h.videoStats;p&&(o[r]=i(r,p))}else Array.from(this.remoteStats.entries()).forEach(p=>{let[g,{videoStats:C}]=p;C&&(o[g]=i(g,C))});return o}getRTCStats(){let r=0,i=0,o=0,h=0,p=this.localStats.get(U.LocalAudioTrack);p&&(r+=p.sendBytes,i+=p.sendBitrate);let g=this.localStats.get(U.LocalVideoTrack);g&&(r+=g.sendBytes,i+=g.sendBitrate);let C=this.localStats.get(U.LocalVideoLowTrack);C&&(r+=C.sendBytes,i+=C.sendBitrate),this.remoteStats.forEach(x=>{let{audioStats:_e,videoStats:cN}=x;_e&&(o+=_e.receiveBytes,h+=_e.receiveBitrate),cN&&(o+=cN.receiveBytes,h+=cN.receiveBitrate)});let A=1;return this.trafficStats&&(A+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:A,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:h,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;let h=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),p=h!=null&&h.videoSSRC?qe.measureFromSubscribeStart(this.store.clientId,h.videoSSRC):0,g=h!=null&&h.audioSSRC?qe.measureFromSubscribeStart(this.store.clientId,h.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,p>g?p:g),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&_.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;let h=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,p=!o||i.framesDecodeCount>o.framesDecodeCount;return h||!p}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,h]=i;switch(o){case U.LocalVideoTrack:case U.LocalVideoLowTrack:{let g=h,C=wo({},YE),A=r.getStats(),x=r.getLocalMedia(o);if(A){let _e=A.videoSend.find(cN=>cN.ssrc===(x==null?void 0:x.ssrcs[0].ssrcId));if(_e){let cN=r.getLocalVideoSize(),dN=r.getEncoderConfig(U.LocalVideoTrack);_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(C.codecType=_e.codec),C.sendBytes=_e.bytes,C.sendBitrate=g?8*Math.max(0,C.sendBytes-g.sendBytes):0,_e.inputFrame?(C.captureFrameRate=_e.inputFrame.frameRate,C.captureResolutionHeight=_e.inputFrame.height,C.captureResolutionWidth=_e.inputFrame.width):cN&&(C.captureResolutionWidth=cN.width,C.captureResolutionHeight=cN.height),_e.sentFrame?(C.sendFrameRate=_e.sentFrame.frameRate,C.sendResolutionHeight=_e.sentFrame.height,C.sendResolutionWidth=_e.sentFrame.width):cN&&(C.sendResolutionWidth=cN.width,C.sendResolutionHeight=cN.height),_e.avgEncodeMs&&(C.encodeDelay=_e.avgEncodeMs),dN&&dN.bitrateMax&&(C.targetSendBitrate=1e3*dN.bitrateMax),C.sendPackets=_e.packets,C.sendPacketsLost=_e.packetsLost,C.sendJitterMs=_e.jitterMs,C.sendRttMs=_e.rttMs,C.totalDuration=g?g.totalDuration+1:1,C.totalFreezeTime=g?g.totalFreezeTime:0,this.isLocalVideoFreeze(_e)&&(C.totalFreezeTime+=1),_e.scalabilityMode&&this.scalabilityMode!==_e.scalabilityMode&&(_.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_e.scalabilityMode)),this.scalabilityMode=_e.scalabilityMode)}this.trafficStats&&(C.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var p;this.localStats.set(o,C),((g==null?void 0:g.sendResolutionWidth)!==C.sendResolutionWidth||(g==null?void 0:g.sendResolutionHeight)!==C.sendResolutionHeight)&&((p=this.onStatsChanged)===null||p===void 0||p.call(this,"resolution",{width:C.sendResolutionWidth,height:C.sendResolutionHeight})),C&&x&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,x.track,C);break}case U.LocalAudioTrack:{let g=h,C=wo({},KE),A=r.getStats(),x=r.getLocalMedia(o);if(A){let _e=A.audioSend.find(cN=>cN.ssrc===(x==null?void 0:x.ssrcs[0].ssrcId));if(_e){if(_e.codec!=="opus"&&_e.codec!=="aac"&&_e.codec!=="PCMU"&&_e.codec!=="PCMA"&&_e.codec!=="G722"||(C.codecType=_e.codec),_e.inputLevel)C.sendVolumeLevel=Math.round(32767*_e.inputLevel);else{let cN=r.getLocalAudioVolume();cN&&(C.sendVolumeLevel=Math.round(32767*cN))}C.sendBytes=_e.bytes,C.sendPackets=_e.packets,C.sendPacketsLost=_e.packetsLost,C.sendJitterMs=_e.jitterMs,C.sendRttMs=_e.rttMs,C.sendBitrate=g?8*Math.max(0,C.sendBytes-g.sendBytes):0}}this.trafficStats&&(C.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(U.LocalAudioTrack,C),C&&x&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,x.track,C);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,h;let[p,{videoStats:g,audioStats:C,videoPcStats:A}]=i,x=C,_e=g,cN=A,dN=wo({},GO),fN=wo({},WO),mN=wo({},kG),{audioTrack:EN,videoTrack:RN,audioSSRC:IN,videoSSRC:t0}=r.getRemoteMedia(p),aH;aH=r instanceof An?r.getStats(!0):r.getStats();let pH=(o=aH)===null||o===void 0?void 0:o.audioRecv.find(AH=>AH.ssrc===IN),SH=(h=aH)===null||h===void 0?void 0:h.videoRecv.find(AH=>AH.ssrc===t0),vH=this.trafficStats&&this.trafficStats.peer_delay.find(AH=>AH.peer_uid===p);if(pH&&(pH.codec!=="opus"&&pH.codec!=="aac"&&pH.codec!=="PCMU"&&pH.codec!=="PCMA"&&pH.codec!=="G722"||(dN.codecType=pH.codec),pH.outputLevel?dN.receiveLevel=Math.round(32767*pH.outputLevel):EN&&(dN.receiveLevel=Math.round(32767*EN.getVolumeLevel())),dN.receiveBytes=pH.bytes,dN.receivePackets=pH.packets,dN.receivePacketsLost=pH.packetsLost,dN.receivePacketsDiscarded=pH.packetsDiscarded,dN.packetLossRate=dN.receivePacketsLost/(dN.receivePackets+dN.receivePacketsLost),dN.receiveBitrate=x?8*Math.max(0,dN.receiveBytes-x.receiveBytes):0,dN.totalDuration=x?x.totalDuration+1:1,dN.totalFreezeTime=x?x.totalFreezeTime:0,dN.freezeRate=dN.totalFreezeTime/dN.totalDuration,dN.receiveDelay=pH.jitterBufferMs,dN.totalDuration>10&&_he.isRemoteAudioFreeze(EN)&&(dN.totalFreezeTime+=1)),SH){SH.codec!=="H264"&&SH.codec!=="H265"&&SH.codec!=="VP8"&&SH.codec!=="VP9"&&SH.codec!=="AV1X"&&SH.codec!=="AV1"||(fN.codecType=SH.codec),fN.receiveBytes=SH.bytes,fN.receiveBitrate=_e?8*Math.max(0,fN.receiveBytes-_e.receiveBytes):0,fN.decodeFrameRate=SH.decodeFrameRate<0?0:SH.decodeFrameRate,fN.renderFrameRate=SH.decodeFrameRate<0?0:SH.decodeFrameRate,SH.outputFrame&&(fN.renderFrameRate=SH.outputFrame.frameRate),SH.receivedFrame?(fN.receiveFrameRate=SH.receivedFrame.frameRate,fN.receiveResolutionHeight=SH.receivedFrame.height,fN.receiveResolutionWidth=SH.receivedFrame.width):RN&&(fN.receiveResolutionHeight=RN._videoHeight||0,fN.receiveResolutionWidth=RN._videoWidth||0),SH.framesRateFirefox!==void 0&&(fN.receiveFrameRate=Math.round(SH.framesRateFirefox)),fN.receivePackets=SH.packets,fN.receivePacketsLost=SH.packetsLost,fN.packetLossRate=fN.receivePacketsLost/(fN.receivePackets+fN.receivePacketsLost),fN.totalDuration=_e?_e.totalDuration+1:1,fN.totalFreezeTime=_e?_e.totalFreezeTime:0,fN.receiveDelay=SH.jitterBufferMs||0;let AH=!!t0&&r.getRemoteVideoIsReady(t0);RN&&AH&&_he.isRemoteVideoFreeze(RN,SH,cN)&&(fN.totalFreezeTime+=1),fN.freezeRate=fN.totalFreezeTime/fN.totalDuration}vH&&(dN.end2EndDelay=vH.B_ad,fN.end2EndDelay=vH.B_vd,dN.transportDelay=vH.B_ed,fN.transportDelay=vH.B_ed,dN.currentPacketLossRate=vH.B_ealr4/100,fN.currentPacketLossRate=vH.B_evlr4/100,mN.uplinkNetworkQuality=vH.B_punq?vH.B_punq:0,mN.downlinkNetworkQuality=vH.B_pdnq?vH.B_pdnq:0),this.remoteStats.set(p,{audioStats:dN,videoStats:fN,videoPcStats:SH,networkStats:mN}),EN&&this.exceptionMonitor.setRemoteAudioStats(EN,dN),RN&&this.exceptionMonitor.setRemoteVideoStats(RN,fN)})}},Eu=class{constructor(){T(this,"destChannelMediaInfos",new Map),T(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){MR(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){MR(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Xu(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function Pv(e){if(!(e instanceof Eu))return new O(R.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new O(R.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new O(R.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function kv(e){var r={},i=!1;function o(h,p){return i=!0,{done:!1,value:new Of(p=new om(function(g){g(e[h](p))}),1)}}return r[Ds!==void 0&&zw||"@@iterator"]=function(){return this},r.next=function(h){return i?(i=!1,h):o("next",h)},typeof e.throw=="function"&&(r.throw=function(h){if(i)throw i=!1,h;return o("throw",h)}),typeof e.return=="function"&&(r.return=function(h){return i?(i=!1,h):o("return",h)}),r}var hW=ae(p0);function Lv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Mv(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Lv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Lv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Pt;function Uv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function qd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Uv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Uv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Va=(Pt=class sre extends Yl{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return W(i=Object.keys(Ju)).call(i,r)}))]}constructor(r,i){super(r,i),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"statsFilter",void 0),T(this,"useRTX",!1),T(this,"localCapabilities",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"establishPromise",void 0),T(this,"mutex",new ze("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(sre.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=Nf(this.peerConnection,v("STATS_UPDATE_INTERVAL"),void 0,$t()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=io(r.sdp),o=Lc(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:v("FILTER_VIDEO_FEC"),filterAudioFec:v("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,qd(qd({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new N(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(o){T(this,"sessionDesc",void 0),T(this,"localCapabilities",void 0),T(this,"rtpCapabilities",void 0),T(this,"candidates",void 0),T(this,"iceParameters",void 0),T(this,"dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),o=le(o);let{iceParameters:h,dtlsParameters:p,candidates:g,rtpCapabilities:C,setup:A,localCapabilities:x,sdkCodec:_e,cname:cN}=o,dN=Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=C,this.candidates=g,this.iceParameters=h,this.dtlsParameters=p,this.setup=A,this.localCapabilities=x,this.cname=cN;for(let fN=0;fN<dN.mediaDescriptions.length;fN++){let mN=dN.mediaDescriptions[fN];if(mN.attributes.iceUfrag=h.iceUfrag,mN.attributes.icePwd=h.icePwd,mN.attributes.fingerprints=p.fingerprints,mN.attributes.candidates=g,mN.attributes.setup=A,mN.media.mediaType==="video"){mN.media.fmts=C.videoCodecs.map(RN=>RN.payloadType.toString(10));let EN=C.videoCodecs.filter(RN=>{var IN,t0;return(IN=RN.rtpMap)===null||IN===void 0?void 0:W(t0=IN.encodingName.toLowerCase()).call(t0,_e)});EN.length===0&&(EN=C.videoCodecs),mN.attributes.payloads=EN,mN.attributes.extmaps=C.videoExtensions}mN.media.mediaType==="audio"&&(mN.media.fmts=C.audioCodecs.map(EN=>EN.payloadType.toString(10)),mN.attributes.payloads=C.audioCodecs,mN.attributes.extmaps=C.audioExtensions),dN.mediaDescriptions[fN]=this.mungMediaDesc(mN)}this.sessionDesc=dN,this.currentMidIndex=dN.mediaDescriptions.length-1}toString(){return Le.print(this.sessionDesc)}send(o,h,p){let{ssrcs:g,ssrcGroups:C}=Lo(h,this.cname),A=this.sessionDesc.mediaDescriptions.find(cN=>o===Q.VIDEO?cN.media.mediaType==="video":cN.media.mediaType==="audio"),x=g[0].attributes.label,_e=g[0].attributes.mslabel;return A.attributes.ssrcs=A.attributes.ssrcs.concat(g),A.attributes.ssrcGroups=A.attributes.ssrcGroups.concat(C),{id:x,mslabel:_e}}batchSend(o){return o.map(h=>{let{kind:p,ssrcMsg:g}=h;return this.send(p,g,void 0)})}stopSending(o){this.sessionDesc.mediaDescriptions.forEach(h=>{let p=[],g=[],C=[];h.attributes.ssrcs.forEach(A=>{W(o).call(o,A.attributes.label||"")?C.push(A):p.push(A)}),h.attributes.ssrcGroups.forEach(A=>{var x;W(x=C.map(_e=>_e.ssrcId)).call(x,A.ssrcIds[0])||g.push(A)}),h.attributes.ssrcs=p,h.attributes.ssrcGroups=g})}mute(o){let h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===o);if(!h)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.mute."));h.attributes.direction="inactive"}unmute(o){let h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===o);if(!h)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.unmute."));h.attributes.direction="sendonly"}receive(o,h,p){o.forEach((g,C)=>{let A=g._mediaStreamTrack,x=this.sessionDesc.mediaDescriptions.findIndex(cN=>cN.attributes.mid===A.kind),_e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[x],g);this.sessionDesc.mediaDescriptions[x]=_e})}stopReceiving(o){}updateCandidates(o){o===On.TCP?this.candidates.forEach(h=>{this.candidates.findIndex(p=>p.transport==="tcp"&&p.connectionAddress===h.connectionAddress&&p.port===h.port)===-1&&this.candidates.push(Mv(Mv({},h),{},{foundation:"tcpcandidate",priority:Number(h.priority)-1+"",transport:"tcp",port:Number(h.port)+90+""}))}):this.candidates=this.candidates.filter(h=>h.transport!=="tcp");for(let h of this.sessionDesc.mediaDescriptions)h.attributes.candidates=this.candidates}restartICE(o){o=le(o),this.iceParameters=o,this.sessionDesc.mediaDescriptions.forEach(h=>{h.attributes.iceUfrag=o.iceUfrag,h.attributes.icePwd=o.icePwd})}predictReceivingMids(o){let h=[];for(let p=0;p<o;p++)h.push((this.currentMidIndex+p+1).toString(10));return h}mungRecvMediaDsec(o,h){let p=le(o);return ra(p,h),vf(p,h),p}updateRecvMedia(o,h){let p=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===o);if(p!==-1){let g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],h);this.sessionDesc.mediaDescriptions[p]=g}}bumpMid(o){this.currentMidIndex+=o}updateTrackLabel(o,h,p){let g=this.sessionDesc.mediaDescriptions.find(A=>o===Q.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(g){let A=g.attributes.ssrcs.find(x=>x.attributes.label===h);var C;A&&(A.attributes.label=p,(C=A.attributes.msid)===null||C===void 0||C.replace(h,p))}}mungMediaDesc(o){let h=le(o);return If(h),function(p){let g=p.attributes.extmaps.find(C=>C.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");g&&p.attributes.extmaps.splice(p.attributes.extmaps.indexOf(g),1),p.attributes.payloads.forEach(C=>{let A=C.rtcpFeedbacks.findIndex(x=>x.type==="transport-cc");A!==-1&&C.rtcpFeedbacks.splice(A,1)})}(h),h}getSSRC(o){for(let h of this.sessionDesc.mediaDescriptions)for(let p of h.attributes.ssrcs)if(p.attributes.label===o)return[p]}}(qd(qd({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new N(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return Bi(function*(){let h=yield Tt(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let p=r.map(dN=>o.peerConnection.addTrack(dN._mediaStreamTrack)),g=yield Tt(o.peerConnection.createOffer()),C=Le.parse(g.sdp),A=r.map(dN=>{let fN=dN._mediaStreamTrack,mN=C.mediaDescriptions.find(EN=>EN.attributes.mid===fN.kind);if(!mN)throw new Error("Cannot extract ssrc from mediaDescription.");return function(EN,RN,IN){let t0=EN.attributes.ssrcs.filter(pH=>pH.attributes.label===RN),aH=EN.attributes.ssrcGroups;if(t0.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(aH&&t0.length>1){let pH=aH.find(SH=>SH.ssrcIds.indexOf(t0[0].ssrcId)!==-1);return pH?[{ssrcId:pH.ssrcIds[0],rtx:IN?pH.ssrcIds[1]:void 0}]:[{ssrcId:t0[0].ssrcId}]}return[{ssrcId:t0[0].ssrcId}]}(mN,fN.id,o.useRTX)}),x;try{x=yield A}catch(dN){throw p.forEach(fN=>{je()&&fN.replaceTrack(null),o.peerConnection.removeTrack(fN)}),dN}let _e=o.mungSendOfferSDP(g.sdp,r);o.remoteSDP.receive(r,i,x);let cN=o.remoteSDP.toString();return yield Tt(o.peerConnection.setLocalDescription({type:"offer",sdp:_e})),yield Tt(o.applySendEncodings(p,r)),yield Tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:cN})),r.map((dN,fN)=>{let mN=dN._mediaStreamTrack.id;return{localSSRC:A[fN],id:mN}})}catch(p){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(p.toString()))}finally{h()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(p=>{var g;return r.indexOf(((g=p.track)===null||g===void 0?void 0:g.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(p=>{je()&&p.replaceTrack(null),this.peerConnection.removeTrack(p)});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);let h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{id:p,mslabel:g}=this.remoteSDP.send(r,i,h),C=new j((_e,cN)=>{let dN=setTimeout(()=>{cN(new Error("Cannot receive track, id: ".concat(p)))},1e4),fN=mN=>{let EN=mt();if((EN.name==="Safari"&&Number(EN.version)===11||ln())&&mN.track.id!==p&&mN.streams[0].id===g){var RN;let IN=mN.streams[0].getTracks()[0];return(RN=this.remoteSDP)===null||RN===void 0||RN.updateTrackLabel(r,p,mN.track.id),this.peerConnection.removeEventListener("track",fN),clearTimeout(dN),void _e(IN)}if(mN.track.id===p)return this.peerConnection.removeEventListener("track",fN),clearTimeout(dN),void _e(mN.track)};this.peerConnection.addEventListener("track",fN)}),A=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:A});let x=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(x),{track:await C,id:p}}catch(p){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(p.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(o=>{var h;return r.indexOf(((h=o.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(je()&&o.track)o.track.enabled=!1;else{let h=o.getParameters();h.encodings.forEach(p=>p.active=!1),o.setParameters(h)}})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(p=>{var g;return r.indexOf(((g=p.track)===null||g===void 0?void 0:g.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async p=>{if(je()&&p.track)p.track.enabled=!0;else{let g=p.getParameters();g.encodings.forEach(C=>C.active=!0),await p.setParameters(g)}});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);let h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Bi(function*(){let o=yield Tt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ft().supportPCSetConfiguration){let A=i.peerConnection.getConfiguration(),x=r===On.RELAY?"relay":"all";A.iceTransportPolicy!==x&&(_.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(x,"]")),A.iceTransportPolicy=x,i.peerConnection.setConfiguration(A))}else if(r===On.RELAY)return;r!==On.RELAY&&i.remoteSDP.updateCandidates(r);let h=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let p=io(h.sdp),{remoteIceParameters:g}=yield p.iceParameters;i.remoteSDP.restartICE(g);let C=i.remoteSDP.toString();yield Tt(i.peerConnection.setLocalDescription(h)),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:C}))}catch(h){_.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),h)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let p=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(o){throw new N(R.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){let o=this.peerConnection.getSenders().filter(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){let o=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new N(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new N(R.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){let i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Yu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...sre.turnServerConfigToIceServers(r.turnServer.servers)),v("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...sre.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){let i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(x=>{var _e;return((_e=x.track)===null||_e===void 0?void 0:_e.id)===r._mediaStreamTrack.id})),!i)return _.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!ft().supportSetRtpSenderParameters)return _.warn("Browser not support set rtp-sender parameters");let h={},p={};if(r instanceof Ft)switch(r._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;default:h.degradationPreference="balanced"}if(v("DSCP_TYPE")&&ho()){var g;let x=v("DSCP_TYPE");W(g=["very-low","low","medium","high"]).call(g,x)&&(p.networkPriority=x)}let C=i.getParameters(),A=(o=C.encodings)===null||o===void 0?void 0:o[0];A&&Object.assign(A,p),Object.assign(C,h),_.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C)}async applySendEncodings(r,i){try{if(!ft().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){let h=r[o],p=i[o];h&&p&&await this.updateRtpSenderEncodings(p,h)}}catch{_.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){let o=Le.parse(r);return i.forEach((h,p)=>{let g=h._mediaStreamTrack,C=o.mediaDescriptions.find(A=>A.attributes.mid===g.kind);C&&ra(C,h)}),Le.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(r).map((p,g)=>{let{id:C,mslabel:A}=p,{kind:x}=r[g];return new j((_e,cN)=>{let dN=setTimeout(()=>{cN(new Error("Cannot receive track, id: ".concat(C)))},1e4),fN=mN=>{let EN=mt();if(EN.name==="Safari"&&Number(EN.version)===11&&mN.track.id!==C&&mN.streams[0].id===A){var RN;let IN=mN.streams[0].getTracks()[0];return(RN=this.remoteSDP)===null||RN===void 0||RN.updateTrackLabel(x,C,mN.track.id),this.peerConnection.removeEventListener("track",fN),clearTimeout(dN),void _e({track:IN,id:C})}if(mN.track.id===C)return this.peerConnection.removeEventListener("track",fN),clearTimeout(dN),void _e({track:mN.track,id:C})};this.peerConnection.addEventListener("track",fN)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),await j.all(i)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(ft().supportPCSetConfiguration){let i=sre.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},q(Pt.prototype,"connect",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),q(Pt.prototype,"stopSending",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"stopSending"),Pt.prototype),q(Pt.prototype,"receive",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"receive"),Pt.prototype),q(Pt.prototype,"stopReceiving",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"stopReceiving"),Pt.prototype),q(Pt.prototype,"muteRemote",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"muteRemote"),Pt.prototype),q(Pt.prototype,"unmuteRemote",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteRemote"),Pt.prototype),q(Pt.prototype,"muteLocal",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"muteLocal"),Pt.prototype),q(Pt.prototype,"unmuteLocal",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteLocal"),Pt.prototype),q(Pt.prototype,"close",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"close"),Pt.prototype),q(Pt.prototype,"updateEncoderConfig",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"updateEncoderConfig"),Pt.prototype),q(Pt.prototype,"updateSendParameters",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"updateSendParameters"),Pt.prototype),q(Pt.prototype,"replaceTrack",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"replaceTrack"),Pt.prototype),q(Pt.prototype,"getRemoteSSRC",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"getRemoteSSRC"),Pt.prototype),Pt);function Jn(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let h=this.mutex,p=await h.lock("Locking from P2PConnection.".concat(r));try{for(var g=arguments.length,C=new Array(g),A=0;A<g;A++)C[A]=arguments[A];return await o.apply(this,C)}finally{p()}},i}function xv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Wr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?xv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Fa="9",Vv=4e4,um=class{get localCapabilities(){return le(this._localCapabilities)}get rtpCapabilities(){return le(this._rtpCapabilities)}get candidates(){return le(this._candidates)}get iceParameters(){return le(this._iceParameters)}get dtlsParameters(){return le(this._dtlsParameters)}constructor(e){T(this,"sessionDesc",void 0),T(this,"_localCapabilities",void 0),T(this,"_rtpCapabilities",void 0),T(this,"_candidates",void 0),T(this,"_iceParameters",void 0),T(this,"_dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),T(this,"firefoxSsrcMidMap",new Map),e=le(e);let{iceParameters:r,dtlsParameters:i,candidates:o,rtpCapabilities:h,setup:p,localCapabilities:g,cname:C}=e;this._rtpCapabilities=h,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=g,this.setup=p,this.cname=C,this.sessionDesc=this.updateRemoteRTPCapabilities(h),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let r=this.candidates,i=this.dtlsParameters,o=this.iceParameters,h=this.rtpCapabilities.send,p=this.sessionDesc.mediaDescriptions.length-1;for(let g=1;g<e;g++){let C=2*g+2e4,A=2*g+Vv,{ssrcs:x,ssrcGroups:_e}=Lo([{ssrcId:C}],this.cname),{ssrcs:cN,ssrcGroups:dN}=Lo([{ssrcId:A,rtx:v("USE_SUB_RTX")?A+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.videoCodecs.map(fN=>fN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:r,extmaps:h.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:cN,ssrcGroups:dN,rtcpFeedbackWildcards:[],payloads:h.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++p)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.audioCodecs.map(fN=>fN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:r,extmaps:h.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:x,ssrcGroups:_e,rtcpFeedbackWildcards:[],payloads:h.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++p)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Le.print(this.sessionDesc)}send(e,r,i,o){let{ssrcs:h,ssrcGroups:p}=Lo(r,this.cname,v("SYNC_GROUP")?i:void 0),g=this.findPreloadMediaDesc(h);if(g){if($t()&&this.firefoxSsrcMidMap.set(h[0].ssrcId,g.attributes.mid),o&&(o.twcc||o.remb)){let C=this.sessionDesc.mediaDescriptions.indexOf(g);return this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(g,o),{mid:g.attributes.mid,needExchangeSDP:!0}}return{mid:g.attributes.mid,needExchangeSDP:!1}}{let C=this.findAvailableMediaIndex(e,h),A;return C===-1||C===1&&(je()||function(){let x=mt();return!(x.name!==It.CHROME||!x.osVersion)&&Number(x.version)<=90}())||C===0&&v("USE_SUB_RTX")||hR()?(A=this.createOrRecycleSendMedia(e,h,p,"sendonly",o),this.updateBundleMids()):(A=le(this.sessionDesc.mediaDescriptions[C]),A.attributes.direction="sendonly",A.attributes.ssrcs=h,A.attributes.ssrcGroups=p,this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(A,o)),$t()&&this.firefoxSsrcMidMap.set(h[0].ssrcId,A.attributes.mid),{mid:A.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:r}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:r}}batchSend(e){let r=e.map(h=>{let{kind:p,ssrcMsg:g,mslabel:C}=h;return this.send(p,g,C)}),i=[],o=!1;return r.forEach(h=>{let{mid:p,needExchangeSDP:g}=h;g&&(o=!0),i.push(p)}),{mids:i,needExchangeSDP:o}}stopSending(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.mid==="0"||$t()||hR()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(e){let r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!r)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(e){let r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!r)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>W(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>W(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}receive(e,r,i,o){e.forEach((h,p)=>{this.createOrRecycleRecvMedia(h,[],"recvonly",r,i,o[p])}),this.updateBundleMids()}stopReceiving(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let r=this.sessionDesc||Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;let i=this.rtpCapabilities.send,o=this.localCapabilities.send;for(let h of r.mediaDescriptions){if(h.attributes.iceUfrag=this._iceParameters.iceUfrag,h.attributes.icePwd=this._iceParameters.icePwd,h.attributes.fingerprints=this._dtlsParameters.fingerprints,h.attributes.candidates=this._candidates,h.attributes.setup=this.setup,h.media.mediaType==="application"&&(h.attributes.sctpPort="5000"),h.media.mediaType==="video"){if(i.videoCodecs.length===0){let p=o.videoCodecs.filter(g=>{var C,A;return(C=g.rtpMap)===null||C===void 0?void 0:W(A=C.encodingName.toLowerCase()).call(A,"vp8")})||[o.videoCodecs[0]];h.media.fmts=p.map(g=>g.payloadType.toString(10)),h.attributes.payloads=p,h.attributes.extmaps=[]}else if(h.media.fmts=i.videoCodecs.map(p=>p.payloadType.toString(10)),h.attributes.payloads=i.videoCodecs,h.attributes.extmaps=i.videoExtensions,v("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:p,ssrcGroups:g}=Lo([{ssrcId:Vv,rtx:v("USE_SUB_RTX")?40001:void 0}],this.cname);h.attributes.ssrcs=p,h.attributes.ssrcGroups=g}}if(h.media.mediaType==="audio"){if(i.audioCodecs.length===0){let p=o.audioCodecs.filter(g=>{var C,A;return(C=g.rtpMap)===null||C===void 0?void 0:W(A=C.encodingName.toLowerCase()).call(A,"opus")})||[o.audioCodecs[0]];h.media.fmts=p.map(g=>g.payloadType.toString(10)),h.attributes.payloads=p,h.attributes.extmaps=[]}else if(h.media.fmts=i.audioCodecs.map(p=>p.payloadType.toString(10)),h.attributes.payloads=i.audioCodecs,h.attributes.extmaps=i.audioExtensions,oa(h),v("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:p,ssrcGroups:g}=Lo([{ssrcId:2e4}],this.cname);h.attributes.ssrcs=p,h.attributes.ssrcGroups=g}}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let r=this._candidates.filter(i=>i.transport==="udp");if(e===On.TCP){if(r.length===0)return;if(v("TCP_CANDIDATE_ONLY")){let i=this._candidates.filter(o=>o.transport==="tcp");r.forEach(o=>{i.findIndex(h=>h.connectionAddress===o.connectionAddress)===-1&&i.push(Wr(Wr({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),this._candidates=i}else{let i=[];r.forEach(o=>{i.push(Wr(Wr({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),this._candidates=[...r,...i]}}else if(e===On.RELAY){if(r.length!==0)return;{let i=this._candidates.filter(o=>o.transport==="tcp");i.forEach(o=>{r.push(Wr(Wr({},o),{},{foundation:"udpcandidate",priority:Number(o.priority)+1+"",transport:"udp",port:Number(o.port)-90+""}))}),this._candidates=[...r,...i]}}else r.length===0?(this._candidates.filter(i=>i.transport==="tcp").forEach(i=>{r.push(Wr(Wr({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=r):this._candidates=this._candidates.filter(i=>i.transport!=="tcp");for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(e){e=le(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(e,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let o=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if($t()){if(o){let h=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(h||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!h||h!==i.attributes.mid)}return!1}return o})}createOrRecycleDataChannel(){for(let i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),r={media:{mediaType:"application",port:Fa,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r),{mediaDesc:r,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,r,i,o,h,p){let g=e._mediaStreamTrack.kind,C=this.rtpCapabilities.recv,A=ac(g,C,this.localCapabilities.send,g===Q.VIDEO?o:h),x=g===Q.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;let _e="".concat(this.currentMidIndex),cN={media:{mediaType:g,port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(fN=>fN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:x,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_e)}};cN=this.mungRecvMediaDsec(cN,e,p);let dN=this.findFirstClosedMedia(g);if(dN){let fN=this.sessionDesc.mediaDescriptions.indexOf(dN);this.sessionDesc.mediaDescriptions[fN]=cN}else this.sessionDesc.mediaDescriptions.push(cN);return cN}updateRemoteCodec(e,r,i){let o=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(cN=>cN.rtpMap&&cN.rtpMap.encodingName.toLowerCase()||"").filter(cN=>{var dN;return W(dN=Object.keys(Ju)).call(dN,cN)}))],h=new Set(r);if(o.every(cN=>h.has(cN)))return _.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;let p=this._rtpCapabilities.recv.videoCodecs.filter(cN=>r.some(dN=>{var fN;return W(fN=cN.rtpMap&&cN.rtpMap.encodingName.toLowerCase()||"").call(fN,dN)}));if(p.length===0)return _.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(o," codecs: ").concat(r)),!1;let g=[...new Set(p.map(cN=>cN.rtpMap&&cN.rtpMap.encodingName.toLowerCase()||""))],C;if(_.debug("updateRemoteCodec, from ".concat(o," to ").concat(g)),e.length===0)C=this.sessionDesc.mediaDescriptions.filter(cN=>cN.media.mediaType==="video"&&cN.attributes.direction==="recvonly");else if(C=this.sessionDesc.mediaDescriptions.filter(cN=>cN.attributes.mid&&W(e).call(e,cN.attributes.mid)&&cN.attributes.direction==="recvonly"),C.length!==e.length)return _.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(r)),!1;if(v("USE_PUB_RTX")||v("USE_SUB_RTX")){let cN=yf(p,this.rtpCapabilities.recv.videoCodecs);p.push(...cN)}this._rtpCapabilities.recv.videoCodecs=p;let A=this.localCapabilities.send,x=this.rtpCapabilities.recv,_e=ac(Q.VIDEO,x,A,i);return C.forEach(cN=>{let dN=_e.map(fN=>fN.payloadType.toString(10));_.debug("updateRemoteCodec mid: ".concat(cN.attributes.mid,", from ").concat(cN.attributes.payloads," to ").concat(_e)),cN.attributes.payloads=_e,cN.media.fmts=dN}),!0}createOrRecycleSendMedia(e,r,i,o,h){let p=this.rtpCapabilities.send,g=e===Q.VIDEO?p.videoCodecs:p.audioCodecs,C=e===Q.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;let A="".concat(this.currentMidIndex),x={media:{mediaType:e,port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(cN=>cN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};x=this.mungSendMediaDesc(x,h);let _e=this.findFirstClosedMedia(e);if(_e){let cN=this.sessionDesc.mediaDescriptions.indexOf(_e);this.sessionDesc.mediaDescriptions[cN]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,r,i){let o=le(e);return If(o),ra(o,r),vf(o,r),r0(o),lu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){let i=le(e);return lu(i,r,this.localCapabilities.recv),oa(i),i}updateRecvMedia(e,r){let i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>$t()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}getSSRC(e){var r;return(r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e))===null||r===void 0?void 0:r.attributes.ssrcs}};function Fv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Ar(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Fv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Fv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var dc=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),qs=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(qs||{}),mu=new Map;function Bv(e,r,i,o){let{scale:h}=e;if(h===0&&o===qs.UP||h>=r.length-1&&o===qs.DOWN)return e;let p=Ar(Ar({},e),{},{scale:o===qs.DOWN?++h:--h});switch(i){case"maintain-framerate":p=Ar(Ar({},p),r[h].motion);break;case"maintain-resolution":p=Ar(Ar({},p),r[h].detail);break;case"balanced":p=Ar(Ar({},p),r[h].balanced)}return p}function S0(e,r){if(r){let i={overUse:0,underUse:0,adaptationList:R0(r)};mu.set(e,i)}else mu.delete(e)}function R0(e){let r=Ar({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:h,bitrateMin:p}=r,{MIN_FRAME_RATE:g,MAX_THRESHOLD_FRAMERATE:C,MAX_SCALE:A,BITRATE_MIN_THRESHOLD:x,BITRATE_MAX_THRESHOLD:_e,BWE_SCALE_UP_THRESHOLD:cN,BWE_SCALE_DOWN_THRESHOLD:dN,PERF_SCALE_DOWN_THRESHOLD:fN,PERF_SCALE_UP_THRESHOLD:mN,BALANCE_BITRATE_FACTOR:EN,BALANCE_FRAMERATE_FACTOR:RN,BALANCE_RESOLUTION_FACTOR:IN,MOTION_RESOLUTION_FACTOR:t0,MOTION_BITRATE_FACTOR:aH,DETAIL_FRAMERATE_FACTOR:pH,DETAIL_BITRATE_FACTOR:SH}=_f,vH=Math.min(r.frameRate,C),AH=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(dN,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(fN,1)*vH),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:p},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:p},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:p}}];for(let UH=1;UH<=A;UH++){let zH={bwe_up:Math.round(Math.pow(cN,UH)*i),bwe_down:Math.round(Math.pow(dN,UH+1)*i),fps_up:Math.round(Math.pow(mN,UH)*vH),fps_down:Math.round(Math.pow(fN,UH+1)*vH)},CH={scaleResolutionDownBy:h/Math.pow(IN,UH),frameRate:Math.max(Math.round(Math.pow(RN,UH)*o),g),bitrateMax:Math.max(Math.round(Math.pow(EN,UH)*i),_e),bitrateMin:Math.max(Math.round(Math.pow(EN,UH)*p),x)},HH={scaleResolutionDownBy:h/Math.pow(t0,UH),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(aH,UH)*i),_e),bitrateMin:Math.max(Math.round(Math.pow(aH,UH)*p),x)},VH={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(pH,UH)*o),g),bitrateMax:Math.max(Math.round(Math.pow(SH,UH)*i),_e),bitrateMin:Math.max(Math.round(Math.pow(SH,UH)*p),x)};AH.push({scale:UH,threshold:zH,balanced:CH,motion:HH,detail:VH})}return AH}function pW(e,r,i,o,h,p){let g=mu.get(e)||{overUse:0,underUse:0,adaptationList:R0(h)},{adaptationList:C}=g;mu.set(e,g);let{OVERUSE_TIMES_THRESHOLD:A,UNDERUSE_TIMES_THRESHOLD:x}=_f,{scale:_e}=o,cN,dN;return typeof r=="number"&&r>0&&function(fN,mN,EN,RN){if(mN>=EN.length)return!1;let{threshold:{fps_down:IN}}=EN[mN];return v("FORCE_AG_HIGH_FRAMERATE")&&RN==="maintain-framerate"&&(IN=EN[0].threshold.fps_down),fN<IN}(r,_e,C,p)&&(g.overUse++,dN=dc.CPU,g.overUse>A)||typeof i=="number"&&i>0&&function(fN,mN,EN){if(mN>=EN.length)return!1;let{threshold:{bwe_down:RN}}=EN[mN];return fN<RN}(i,_e,C)&&(g.overUse++,dN=dc.BANDWIDTH,g.overUse>A)?(g.overUse=0,g.underUse=0,cN=Bv(o,C,p,qs.DOWN),[cN,dN]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(fN,mN,EN,RN){if(mN===0)return;let{threshold:{fps_up:IN}}=EN[mN];return v("FORCE_AG_HIGH_FRAMERATE")&&RN==="maintain-framerate"&&(IN=EN[1].threshold.fps_up),fN>IN}(r,_e,C,p)&&function(fN,mN,EN){if(mN===0)return;let{threshold:{bwe_up:RN}}=EN[mN];return fN>RN}(i,_e,C)&&(g.underUse++,g.underUse>x&&(g.overUse=0,g.underUse=0,cN=Bv(o,C,p,qs.UP),cN.scale===0&&(dN=dc.NONE))),[cN,dN])}function jv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function m_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?jv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function _W(e){var r;return!!v("ENABLE_AG_ADAPTATION")&&!!(e instanceof XE||W(r=e._hints).call(r,Gt.CUSTOM_TRACK))&&(!!v("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){let o=mt();if(o.os!==ye.IOS||!o.osVersion)return!1;let h=o.osVersion.split(".");return Number(h[0])>=i}(14)&&fO(17,4)||mO(14)&&gO(17,4)))}var fu=new Map;function zd(e,r){let i=fu.get(e);if(i){let{timer:o}=i;window.clearTimeout(o),fu.delete(e)}r.qualityLimitationReason=dc.NONE,S0(e)}var pt;function Gv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Qi(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Gv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Gv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var ki=(pt=class ore extends Yl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return W(i=Object.keys(Ju)).call(i,r)}))]}constructor(r,i){super(r,i),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"id",Ut(5,"connection-")),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"transportEventReceiver",void 0),T(this,"statsFilter",void 0),T(this,"extension",{useXR:v("USE_XR")}),T(this,"localCapabilities",void 0),T(this,"remoteCodecs",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"isPreallocation",!1),T(this,"preSSRCMap",new Map),T(this,"dataStreamChannelMap",new Map),T(this,"establishPromise",void 0),T(this,"recoveredDataChannelIds",[]),T(this,"currentDataChannelId",1),T(this,"mutex",new ze("P2PConnection-mutex")),T(this,"qualityLimitationReason",dc.NONE),this.store=i,this.peerConnection=new RTCPeerConnection(ore.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=Nf(this.peerConnection,v("STATS_UPDATE_INTERVAL"),void 0,$t()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){let i=this.preSSRCMap.get(r);if(i!==void 0){let o=this.peerConnection.getTransceivers().find(h=>h.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void _.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){let o=await this.peerConnection.createOffer(),h=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);let p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}else _.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=io(r.sdp),o=await s0({filterRTX:!v("USE_PUB_RTX")&&!v("USE_SUB_RTX"),filterVideoFec:v("FILTER_VIDEO_FEC"),filterAudioFec:v("FILTER_AUDIO_FEC"),filterVideoCodec:v("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=uu(o),this.initialOffer=r,Qi(Qi({},i),{},{rtpCapabilities:o,offerSDP:r.sdp})}catch(r){throw new N(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new um(Qi(Qi({},r),{},{localCapabilities:this.localCapabilities})),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),o=a0(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),h==null||h(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),v("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(v("PRELOAD_MEDIA_COUNT"));let C=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:C});let A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A)}let{preSSRCs:g}=r;if(Array.isArray(g)&&g.length>0){let{mids:C}=this.remoteSDP.batchSend(g.map(A=>({kind:A.kind,ssrcMsg:[{ssrcId:A.ssrcId,rtx:A.rtx}],mslabel:A.mslabel})));C.forEach((A,x)=>{this.preSSRCMap.set(g[x].ssrcId,A)}),await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){let{mids:h}=this.remoteSDP.batchSend(o.map(p=>Object.assign({},{kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,g)=>{this.preSSRCMap.set(o[g].ssrcId,p)})}await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var h=this;return Bi(function*(){let p=yield Tt(h.mutex.lock("From P2PConnection.send"));try{if(!h.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let g=[];r.forEach(EN=>{let RN=h.peerConnection.addTransceiver(EN._mediaStreamTrack,{direction:"sendonly"});g.push(RN),EN._updateRtpTransceiver(RN)}),$t()&&v("SIMULCAST")===!0&&(yield Tt(h.applySimulcastForFirefox(g,r)));let C=yield Tt(h.peerConnection.createOffer()),A=h.remoteSDP.predictReceivingMids(r.length),x=h.mungSendOfferSDP(C.sdp,r,A),_e=Le.parse(x),cN=A.map(EN=>{let RN=_e.mediaDescriptions.find(IN=>IN.attributes.mid===EN);if(!RN)throw new Error("Cannot extract ssrc from mediaDescription.");return n0(RN,v("USE_PUB_RTX"))}),dN;try{dN=yield cN}catch(EN){dN=[],h.remoteSDP.receive(r,i,o,dN);let RN=h.remoteSDP.toString();throw yield Tt(h.peerConnection.setLocalDescription({type:"offer",sdp:x})),yield Tt(h.peerConnection.setRemoteDescription({type:"answer",sdp:RN})),yield Tt(h.stopSending(A,!0)),EN}h.remoteSDP.receive(r,i,o,dN);let fN=h.remoteSDP.toString(),mN=h.logSDPExchange(x,"offer","local","send");return yield Tt(h.peerConnection.setLocalDescription({type:"offer",sdp:x})),yield Tt(h.applySimulcastEncodings(g,r)),yield Tt(h.applySendEncodings(g,r)),mN==null||mN(fN),yield Tt(h.peerConnection.setRemoteDescription({type:"answer",sdp:fN})),g.map((EN,RN)=>{let IN=A[RN];return{localSSRC:cN[RN],id:IN,transceiver:EN}})}catch(g){throw g instanceof N?g:new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(g.toString()))}finally{p()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")_.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let p=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof p!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:p,negotiated:!0,ordered:!1,maxRetransmits:v("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(p=>{p._updateOriginDataChannel(o)});let{needExchangeSDP:h}=this.remoteSDP.sendDataChannel();if(h){let p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});let g=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(g),_.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else _.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof N?o:new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{let i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof N?i:new N(R.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){let o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let h=this.peerConnection.getTransceivers().filter(A=>r.indexOf(A.mid)!==-1);if(h.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");h.map(A=>{var x;zd(this.id+A.mid,this),A.direction="inactive",(x=A.stop)===null||x===void 0||x.call(A)});let p=await this.peerConnection.createOffer(),g=this.logSDPExchange(p.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(p),this.remoteSDP.stopReceiving(r);let C=this.remoteSDP.toString();g==null||g(C),await this.peerConnection.setRemoteDescription({type:"answer",sdp:C})}catch(h){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(h.toString()))}finally{o&&o()}}async receive(r,i,o,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{mid:p,needExchangeSDP:g}=this.remoteSDP.send(r,i,o,h);g&&(await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));let C=this.peerConnection.getTransceivers().find(A=>A.mid===p);if(!C)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:C.receiver.track,id:p,transceiver:C}}catch(p){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(p.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(h=>{let p=this.peerConnection.getTransceivers().find(g=>g.mid===h);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:h,transceiver:p}})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(p=>{Array.from(this.preSSRCMap.entries()).some(g=>{let[C,A]=g;if(A===p)return this.preSSRCMap.delete(C),!0})}),this.remoteSDP.stopSending(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let h=await this.peerConnection.createAnswer();o==null||o(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let h=await this.peerConnection.createAnswer();o==null||o(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let h=await this.peerConnection.createAnswer();o==null||o(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(g=>{g.direction="inactive"});let o=await this.peerConnection.createOffer(),h=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);let p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(g,C)=>{g.direction="sendonly"});let o=await this.peerConnection.createOffer(),h=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);let p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(i){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Bi(function*(){let o=yield Tt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ft().supportPCSetConfiguration){let x=i.peerConnection.getConfiguration(),_e=r===On.RELAY?"relay":"all";x.iceTransportPolicy!==_e&&(_.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(x.iceTransportPolicy,"] to [").concat(_e,"]")),x.iceTransportPolicy=_e,i.peerConnection.setConfiguration(x))}else if(r===On.RELAY)return;i.remoteSDP.updateCandidates(r);let h=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let p=io(h.sdp),{remoteIceParameters:g}=yield p.iceParameters;i.remoteSDP.restartICE(g);let C=i.remoteSDP.toString(),A=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Tt(i.peerConnection.setLocalDescription(h)),A==null||A(C),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:C}))}catch(h){_.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),h)}finally{o()}})()}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{zd(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Qi(Qi({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);let p=this.remoteSDP.toString(),g=this.logSDPExchange(h,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),g==null||g(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(o){throw new N(R.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){let o=this.peerConnection.getTransceivers().filter(h=>h.mid===r);o.length===1&&(this.isVP8Simulcast(i)?$t()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){let o=this.peerConnection.getTransceivers().find(h=>h.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){let r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){let i=r[0].transport.iceTransport,{local:o,remote:h}=i.getSelectedCandidatePair();return{local:Qi(Qi({},hr),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Qi(Qi({},hr),{},{candidateType:h.type,protocol:h.protocol,address:h.address,port:h.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){let i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Yu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...ore.turnServerConfigToIceServers(r.turnServer.servers)),v("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...ore.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),v("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),v("ENABLE_ENCODED_TRANSFORM")&&ft().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){let i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Us(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!v("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(r){let i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var h;i!=null&&i.state&&((h=this.onDTLSTransportStateChange)===null||h===void 0||h.call(this,i.state))},i.onerror=h=>{var p;(p=this.onDTLSTransportError)===null||p===void 0||p.call(this,"error"in h?h.error:h)};let o=i.iceTransport;o&&(o.onstatechange=()=>{let h=i==null?void 0:i.iceTransport.state;var p;h&&((p=this.onICETransportStateChange)===null||p===void 0||p.call(this,h))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){let{local:h,remote:p}=o.getSelectedCandidatePair();_.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:h.type,protocol:h.protocol}),", remote ").concat(JSON.stringify({candidateType:p.type,protocol:p.protocol,address:p.address,port:p.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,h;if(i||(i=this.peerConnection.getSenders().find(EN=>EN.track===r._mediaStreamTrack)),!i)return _.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return _.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ft().supportSetRtpSenderParameters)return _.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let p={},g={};switch(r._optimizationMode){case"motion":p.degradationPreference="maintain-framerate";break;case"detail":p.degradationPreference="maintain-resolution";break;case"balanced":p.degradationPreference="balanced"}let C=function(EN,RN){return EN.getTransceivers().find(IN=>IN.sender.track===RN||IN.receiver.track===RN)}(this.peerConnection,r._mediaStreamTrack),A=xG(r);if(_W(r)&&C&&i&&A&&this.getLocalVideoStats&&W(o=["vp8","vp9"]).call(o,this.store.codec)){var x;let EN=p.degradationPreference||(W(x=r._hints).call(x,Gt.CUSTOM_TRACK)?v("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(RN,IN,t0,aH,pH,SH){if(zd(RN,t0),pH(IN),aH!=="balanced"&&aH!=="maintain-framerate"&&aH!=="maintain-resolution")return;let vH=-1;S0(RN,IN);let AH=window.setInterval(()=>{let zH=fu.get(RN);if(!v("ENABLE_AG_ADAPTATION")||!zH)return zd(RN,t0),void pH(IN);let CH=SH();if(CH.sendPackets>0&&CH.OutgoingAvailableBandwidth>0){if(vH===-1)return void(vH=Date.now());if(Date.now()-vH<1e3)return;let HH=CH.sendFrameRate,VH=CH.OutgoingAvailableBandwidth,[KH,IH]=pW(RN,HH,VH,zH.adaptationConfig,IN,aH);IH&&(t0.qualityLimitationReason=IH),KH&&zH.adaptationConfig.scale!==KH.scale&&(_.debug("[".concat(RN,"] applyAdaptation: ").concat(t0.qualityLimitationReason,`
           sendFps `).concat(HH,", bwe ").concat(VH,", switch from ").concat(zH.adaptationConfig.scale," to ").concat(KH.scale," ")),zH.adaptationConfig=m_(m_({},zH.adaptationConfig),KH),pH(KH))}},v("CHECK_LOCAL_STATS_INTERVAL")),UH=m_({},IN);fu.set(RN,{timer:AH,adaptationConfig:UH,originConfig:IN,adaptationFunc:pH}),_.debug("[".concat(RN,"] start adaptation, originConfig: ").concat(JSON.stringify(IN),", degradationPreference: ").concat(aH))})(this.id+C.mid,A,this,EN,RN=>{i&&this.updateAdaptation(i,RN)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _e;let{bitrateMax:EN,frameRate:RN,scaleResolutionDownBy:IN}=r._encoderConfig;EN&&(g.maxBitrate=1e3*EN),(W(_e=r._hints).call(_e,Gt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(RN&&(g.maxFramerate=Nn(RN)),IN&&IN>=1&&(g.scaleResolutionDownBy=IN))}let{maxFramerate:cN}=v("ENCODER_CONFIG_LIMIT");if(cN&&typeof cN=="number"&&(g.maxFramerate=g.maxFramerate?Math.min(g.maxFramerate,cN):cN),v("DSCP_TYPE")&&ho()){var dN;let EN=v("DSCP_TYPE");W(dN=["very-low","low","medium","high"]).call(dN,EN)&&(g.networkPriority=EN)}let fN=i.getParameters(),mN=(h=fN.encodings)===null||h===void 0?void 0:h[0];$t()&&!mN&&(p.encodings=[g]),mN&&Object.assign(mN,g),Object.assign(fN,p),_.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(fN.encodings))),await i.setParameters(fN),await async function(EN,RN,IN){try{var t0;if(!ft().supportSetRtpSenderParameters||!function(AH){return AH==="vp9"}(EN)||!v("ENABLE_SVC"))return;let aH={},pH={},SH=RN.getParameters(),vH=(t0=SH.encodings)===null||t0===void 0?void 0:t0[0];pH.scalabilityMode=$E(IN),vH&&Object.assign(vH,pH),Object.assign(SH,aH),await RN.setParameters(SH),_.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(SH.encodings)))}catch(aH){_.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",aH)}}(this.store.codec,i,v("SVC_MODE"))}async updateAdaptation(r,i){var o,h;if(!r)return _.debug("[updateAdaptation] no rtpSender found");if(!ft().supportSetRtpSenderParameters)return _.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let p={},{bitrateMax:g,frameRate:C,scaleResolutionDownBy:A}=i;g&&(p.maxBitrate=1e3*g),C&&(p.maxFramerate=Nn(C)),A&&A>=1&&W(o=["vp8","vp9"]).call(o,this.store.codec)&&(p.scaleResolutionDownBy=A);let x=r.getParameters(),_e=(h=x.encodings)===null||h===void 0?void 0:h[0];_e&&Object.assign(_e,p),Object.assign(x,{});try{await r.setParameters(x),_.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(x.encodings)))}catch(cN){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?_.debug("[updateAdaptation] peerConnection not connected}"):_.debug("[updateAdaptation] updateRtpSenderEncodings failed",cN):_.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!ft().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){let h=r[o],p=i[o];p instanceof Ft&&!this.isVP8Simulcast(p)&&await this.updateRtpSenderEncodings(p,h.sender)}}catch{_.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){let h=Le.parse(r);return i.forEach((p,g)=>{let C=o[g],A=h.mediaDescriptions.find(x=>x.attributes.mid===C);A&&(ra(A,p),o0(A,p,this.store.codec))}),Le.print(h)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let A=0;A<r.length;A++){var o,h,p,g,C;let x=r[A],_e=i[A];if(_e instanceof Ft&&!W(o=_e._hints).call(o,Gt.LOW_STREAM)&&(h=_e._encoderConfig)!==null&&h!==void 0&&h.bitrateMax&&((p=_e._encoderConfig)===null||p===void 0?void 0:p.bitrateMax)>200&&(g=_e._scalabilityMode)!==null&&g!==void 0&&g.numSpatialLayers&&((C=_e._scalabilityMode)===null||C===void 0?void 0:C.numSpatialLayers)>1&&this.store.codec==="vp8"){let cN={},dN={high:1e3*(_e._encoderConfig.bitrateMax-50),medium:5e4};cN.encodings=[{rid:"m",active:!0,maxBitrate:dN.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:dN.high}];let fN=x.sender.getParameters();await x.sender.setParameters(Object.assign(fN,cN))}}}async applySimulcastEncodings(r,i){if(!$t()&&r.length===i.length)for(let o=0;o<r.length;o++){let h=i[o];if(h instanceof Ft&&this.isVP8Simulcast(h)){let p=r[o],g={},C={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:C.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:C.medium,scaleResolutionDownBy:4}];let A=p.sender.getParameters();await p.sender.setParameters(Object.assign(A,g))}}}isVP8Simulcast(r){var i,o,h,p,g;return!!(r instanceof Ft&&v("SIMULCAST")&&this.store.codec==="vp8"&&!W(i=r._hints).call(i,Gt.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((h=r._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(p=r._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((g=r._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1)}logSDPExchange(r,i,o,h){if(v("SDP_LOGGING"))return _.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(h,`
`),r),i==="offer"?p=>{this.logSDPExchange(p,"answer",o==="local"?"remote":"local",h)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(ft().supportPCSetConfiguration){let i=ore.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},q(pt.prototype,"updateRemoteRTPCapabilities",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),q(pt.prototype,"connect",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),q(pt.prototype,"updateRemoteConnect",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteConnect"),pt.prototype),q(pt.prototype,"createDataChannels",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"createDataChannels"),pt.prototype),q(pt.prototype,"receive",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),q(pt.prototype,"batchReceive",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"batchReceive"),pt.prototype),q(pt.prototype,"stopReceiving",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),q(pt.prototype,"muteRemote",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),q(pt.prototype,"unmuteRemote",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),q(pt.prototype,"muteLocal",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),q(pt.prototype,"unmuteLocal",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),q(pt.prototype,"close",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),q(pt.prototype,"updateEncoderConfig",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),q(pt.prototype,"updateSendParameters",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),q(pt.prototype,"replaceTrack",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),q(pt.prototype,"updateAdaptation",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateAdaptation"),pt.prototype),q(pt.prototype,"getRemoteSSRC",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function pn(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let h=this.mutex,p=await h.lock("From P2PConnection.".concat(r));try{for(var g=arguments.length,C=new Array(g),A=0;A<g;A++)C[A]=arguments[A];return await o.apply(this,C)}finally{p()}},i}var at;function Wv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Zi(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Wv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Wv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Hv(e){var r,i,o,h=2;for(typeof Symbol<"u"&&(i=hW,o=Symbol.iterator);h--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new bl(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function bl(e){function r(i){if(Object(i)!==i)return j.reject(new TypeError(i+" is not an object."));var o=i.done;return j.resolve(i.value).then(function(h){return{value:h,done:o}})}return bl=function(i){this.s=i,this.n=i.next},bl.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?j.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?j.reject(i):r(o.apply(this.s,arguments))}},new bl(e)}var Jd=(at=class extends Xt{get state(){return this._state}set state(e){let r=this._state;this._state=e,this.emit(tt.StateChange,r,this._state)}constructor(e,r){super(),T(this,"isPlanB",void 0),T(this,"store",void 0),T(this,"statsUploader",void 0),T(this,"connection",void 0),T(this,"localTrackMap",new Map),T(this,"remoteUserMap",new Map),T(this,"localDataChannels",[]),T(this,"remoteDataChannelMap",new Map),T(this,"pendingLocalTracks",[]),T(this,"pendingRemoteTracks",[]),T(this,"pendingLocalDataChannels",[]),T(this,"pendingRemoteDataChannels",[]),T(this,"statsCollector",void 0),T(this,"shouldForwardP2PCreation",void 0),T(this,"iceFailedCount",0),T(this,"dtlsFailedCount",0),T(this,"mutex",new ze("P2PChannel-mutex")),T(this,"_state",Rt.Disconnected),T(this,"_pcStatsUploadType",v("NEW_ICE_RESTART")?Tr.FIRST_CONNECTION:Tr.OLD_FIRST_CONNECTION),T(this,"_isInRestartIce",!1),T(this,"_isStartRestartIce",!1),T(this,"_restartStates",["disconnected","failed"]),T(this,"_restartTimer",void 0),T(this,"_isFirstConnected",!0),T(this,"handleMuteLocalTrack",async(i,o,h)=>{let p=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Rt.Connected)return void h(new N(R.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let g=this.filterTobeMutedTracks(i);if(g.length===0)return void o();let C=g.find(x=>x[0]==="videoLowTrack");C&&C[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(g.map(x=>{let[,{id:_e}]=x;return _e}));let A=this.createMuteMessage(g);await kt(this,tt.RequestMuteLocal,A),o()}catch(g){h(g)}finally{p()}}),T(this,"handleUnmuteLocalTrack",async(i,o,h)=>{let p=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Rt.Connected)return void h(new N(R.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let g=this.filterTobeUnmutedTracks(i);if(g.length===0)return void o();let C=g.find(x=>x[0]==="videoLowTrack");if(C){let x=C[1];if(x.track._originMediaStreamTrack.stop(),!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){let _e=i._mediaStreamTrack.clone();x.track._mediaStreamTrack=_e,x.track._originMediaStreamTrack=_e}else{let _e=dm(i,Ac(this,tt.RequestLowStreamParameter));x.track._mediaStreamTrack=_e,x.track._originMediaStreamTrack=_e}await new j((_e,cN)=>{this.handleReplaceTrack(x.track,_e,cN,!0)})}await this.connection.unmuteLocal(g.map(x=>{let[,{id:_e}]=x;return _e}));let A=this.createUnmuteMessage(g);await kt(this,tt.RequestUnmuteLocal,A),o()}catch(g){h(g)}finally{p()}}),T(this,"handleUpdateVideoEncoder",async(i,o,h)=>{let p=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let g=this.localTrackMap.get(U.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==Rt.Connected)return void o();let{id:C,track:A}=g;await this.connection.updateSendParameters(C,A),await this.connection.updateEncoderConfig(C,A),this.emit(tt.UpdateVideoEncoder,A),o()}catch(g){h(g)}finally{p()}}),T(this,"handleUpdateVideoSendParameters",async(i,o,h)=>{let p=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let g=this.localTrackMap.get(U.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==Rt.Connected)return void o();let{id:C,track:A}=g;await this.connection.updateSendParameters(C,A),o()}catch(g){h(g)}finally{p()}}),T(this,"handleReplaceMixingTrack",async(i,o,h,p)=>{if(!this.connection||this.state!==Rt.Connected)return void o();let g=E_([i]),C;_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(g.getTrackId(),"]")),typeof p=="boolean"&&p||(C=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,g),o()}catch(x){h(x)}finally{var A;(A=C)===null||A===void 0||A()}}),T(this,"handleReplaceTrack",async(i,o,h,p)=>{let g;_.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof p=="boolean"&&p||(g=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var C;let x=Array.from(this.localTrackMap.entries()).find(_e=>{let[,{track:cN}]=_e;return i===cN});if(!this.connection||!x||this.state!==Rt.Connected)return void o();if(await((C=this.connection)===null||C===void 0?void 0:C.replaceTrack(i,x[1].id)),this.isPlanB){let _e=x[1];_e.id=i._mediaStreamTrack.id,this.localTrackMap.set(x[0],_e)}if(x[0]===U.LocalVideoTrack&&!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){let _e=this.localTrackMap.get(U.LocalVideoLowTrack);if(_e){let cN=i._mediaStreamTrack.clone();_e.track._originMediaStreamTrack.stop(),_e.track._mediaStreamTrack=cN,_e.track._originMediaStreamTrack=cN,await new j((dN,fN)=>{this.handleReplaceTrack(_e.track,dN,fN,!0)})}}o()}catch(x){h(x)}finally{var A;(A=g)===null||A===void 0||A()}}),T(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),T(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),T(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),T(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),T(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new pu(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ft().supportUnifiedPlan||v("CHROME_FORCE_PLAN_B")&&ho(),this.shouldForwardP2PCreation=v("FORWARD_P2P_CREATION")&&ft().supportPCSetConfiguration&&lf(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Va({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=Rt.New;let i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(_.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new Va(e,this.store):new ki(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=v("NEW_ICE_RESTART")?Tr.FIRST_CONNECTION:Tr.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");v("ENABLE_PREALLOC_PC")&&this.state===Rt.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Rt.Connected)}updateRemoteRTPCapabilities(e){let r=Array.from(this.localTrackMap.entries()).filter(h=>{var p;let[g]=h;return W(p=[U.LocalVideoLowTrack,U.LocalVideoTrack]).call(p,g)}),i=r.map(h=>{let[,{id:p}]=h;return p}),o=r.map(h=>{let[p]=h;return p});if(this.connection instanceof ki){if(X.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!W(e).call(e,this.store.codec)){let h=["vp9","vp8","h264"].find(p=>W(e).call(e,p));h&&(this.store.codec=h,_.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(h,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof ki&&this.connection.peerConnectionState!=="closed"&&W(e=[Rt.New,Rt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Rt.Connected){if(this.state===Rt.Disconnected)throw new N(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;W(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}let r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{let o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);let o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return Bi(function*(){let h=yield Tt(o.mutex.lock("From P2PChannel.publish"));try{if(!o.connection||o.state!==Rt.Connected){if(o.state===Rt.Disconnected)throw new N(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);let g=e.filter(C=>o.pendingLocalTracks.indexOf(C)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(g))}o.store.pubId=o.store.pubId+1,qe.markPublishStart(o.store.clientId,o.store.pubId);let p=o.filterTobePublishedTracks(e,r,i);if(p.length===0)return void(yield Tt(o.tryToUnmuteAudio(e)));yield*kv(Hv(o.doPublish(o.connection,p)))}finally{h()}})()}doPublish(e,r){var i=this;return Bi(function*(){r.forEach(cN=>{let{track:dN,type:fN}=cN,mN=Date.now();i.store.publish(dN.getTrackId(),fN===U.LocalAudioTrack?"audio":"video",mN)}),i.bindLocalTrackEvents(r);let o=r.map(cN=>{let{track:dN}=cN;return dN}),h=yield Tt(e.send(r.map(cN=>{let{track:dN}=cN;return dN}),i.store.codec,i.store.audioCodec)),p=(yield Tt(h.next())).value,g=i.createGatewayPublishMessage(r,p),C;try{C=yield g}catch(cN){throw h.throw(cN),(cN==null?void 0:cN.code)===R.WS_ABORT&&r.forEach(dN=>{let{track:fN}=dN;i.pendingLocalTracks.indexOf(fN)===-1&&i.pendingLocalTracks.push(fN)}),i.unbindLocalTrackEvents(r),cN}let A=i.mapPubResToRemoteConfig(g,C),x=(yield Tt(h.next(A))).value,_e=v("ENABLE_VIDEO_SEI");o.forEach(async cN=>{let dN=cN.getRTCRtpTransceiver();dN&&_e&&(cN.trackMediaType===Q.VIDEO?await BG(dN.sender,cN):cN.trackMediaType===Q.AUDIO&&await async function(fN){if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support audio encoded transform");if(Bd.has(fN)||!fN.track)return;let mN={track:fN.track};if(oo()){if(!fN.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let RN=null;try{RN=fN.createEncodedStreams()}catch(t0){return void _.error("create audio-encoded-streams error",t0&&t0.message)}let IN=new TransformStream({transform(t0,aH){mN.controller||(mN.controller=aH),fN.track&&fN.track.id!==mN.track.id&&(_.debug("audio track changed: ".concat(mN.track.id," => ").concat(fN.track.id)),mN.track.removeEventListener("ended",EN),mN.track=fN.track,mN.track.addEventListener("ended",EN)),aH.enqueue(t0)}});RN.readable.pipeThrough(IN).pipeTo(RN.writable)}else if(je()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let RN=vl(),IN=new MessageChannel;await new j(aH=>RN.onmessage=pH=>{pH.data==="registered"&&aH(void 0)});let t0=new RTCRtpScriptTransform(RN,{name:"tx",port:IN.port2},[IN.port2]);fN.transform=t0,await new j(aH=>RN.onmessage=pH=>{pH.data==="started"&&aH(void 0)}),IN.port1.onmessage=aH=>{var pH;aH.data.transformed&&fN.track&&((pH=fN.track)===null||pH===void 0?void 0:pH.id)!==mN.track.id&&(_.debug("audio track changed: ".concat(mN.track.id," => ").concat(fN.track.id)),mN.track.removeEventListener("ended",EN),mN.track=fN.track,mN.track.addEventListener("ended",EN))},mN.worker=RN}function EN(){if(fN.track){if(this.id!==fN.track.id)return;fN.track.removeEventListener("ended",EN)}let RN=Bd.get(fN);if(RN){Bd.delete(fN);try{var IN,t0;(IN=RN.controller)===null||IN===void 0||IN.terminate(),(t0=RN.worker)===null||t0===void 0||t0.terminate()}catch(aH){_.warning(aH&&aH.message)}}}Bd.set(fN,mN),fN.track.addEventListener("ended",EN)}(dN.sender))}),r.forEach(cN=>{let{type:dN}=cN;i.statsCollector.addLocalStats(dN)}),i.assignLocalTracks(r,x),i.statsUploader.startUploadOutboundStats(),r.forEach(cN=>{let{track:dN,type:fN}=cN,mN=Date.now();i.store.publish(dN.getTrackId(),fN===U.LocalAudioTrack?"audio":"video",void 0,mN)})})()}async updateVideoStreamParameter(e,r){let i=this.localTrackMap.get(r);if(!i)return;if(!(i.track instanceof Ft))return _.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof ki||this.connection instanceof Va))return _.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:o}=i,h=function(p,g){let C={};return p.height&&p.width&&(C.scaleResolutionDownBy=GE(p,g)),C.maxFramerate=p.framerate?Nn(p.framerate):void 0,C.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,C}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==U.LocalVideoLowTrack||!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding)h.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{let p=o._originMediaStreamTrack;if(!p.canvas)return _.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(g,C){let A=g.canvas;C.width&&(A.width=Nn(C.width)),C.height&&(A.height=Nn(C.height)),C.framerate&&(A.stopCapture&&A.stopCapture(),A.stopCapture=Rf(()=>{!A.startCapture&&A.stopCapture&&A.stopCapture(),A.startCapture&&A.startCapture()},Nn(C.framerate)))})(p,e)}h.maxBitrate!=null&&(o._encoderConfig.bitrateMax=h.maxBitrate/1e3),h.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=h.maxFramerate:o._encoderConfig.frameRate={max:h.maxFramerate}),_.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return Bi(function*(){if(!r.connection||r.state!==Rt.Connected)return;let i=yield Tt(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let h=r.localTrackMap.get(U.LocalVideoTrack);if(!h)throw new N(R.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(U.LocalVideoLowTrack))throw new N(R.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));let p=[{track:r.getLowVideoTrack(h.track,e),type:U.LocalVideoLowTrack}];if(yield*kv(Hv(r.doPublish(r.connection,p))),h.track.muted||!h.track.enabled){var o;let g=(o=r.localTrackMap.get(U.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;g!==void 0&&(yield Tt(r.connection.muteLocal([g])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(_.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ge(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(_.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ge(this,tt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){let{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==Q.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==Q.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Ge(this,tt.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===Q.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(tt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Rt.Connected)return void e.forEach(o=>{let h=this.pendingLocalTracks.indexOf(o);h!==-1&&this.pendingLocalTracks.splice(h,1)});let r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;let i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==Rt.Connected)return void e.forEach(i=>{let o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});let r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{let o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Rt.Connected)return;let e=this.localTrackMap.get(U.LocalVideoLowTrack);if(!e)return;e.track.close();let r=[[U.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){let i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:h}]=o;return h})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[h,{track:p}]=o;return{type:h,track:p}})),r.forEach(o=>{let[h]=o;this.statsCollector.removeLocalStats(h)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==Rt.Connected)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=r.filter(o=>{var h;return!((h=this.remoteDataChannelMap.get(e))!==null&&h!==void 0&&h.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var h;this.remoteDataChannelMap.has(e)?(h=this.remoteDataChannelMap.get(e))===null||h===void 0||h.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));let p=this.pendingRemoteDataChannels.findIndex(g=>{let{user:C,id:A}=g;return C.uid===e.uid&&A===o.id});p!==-1&&this.pendingRemoteDataChannels.splice(p,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,h){var p;if(!this.connection||this.state!==Rt.Connected)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((p=this.remoteUserMap.get(e))!==null&&p!==void 0&&p.has(r))return;let g,C,A,x=this.connection.getPreMedia(i);if(x)_.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),A=x.transceiver,g=x.track,C=x.id;else if(h){let dN=h.find(mN=>{let{stream_type:EN}=mN;return EN===r});if(!dN)throw new N(R.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));let fN=await this.connection.receive(r,dN.ssrcs,String(e._uintid),dN.attributes);this.connection instanceof ki&&(A=fN.transceiver),g=fN.track,C=fN.id}else{let dN=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof ki&&(A=dN.transceiver),g=dN.track,C=dN.id}r===Q.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(g):(e._audioTrack=new Ks(g,e.uid,e._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),A&&e._audioTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(g):(e._videoTrack=new Hs(g,e.uid,e._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),A&&e._videoTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(e,e._videoTrack)),v("ENABLE_VIDEO_SEI")&&A&&(r==Q.VIDEO?await async function(dN){let fN=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support video encoded transform");if(!dN.track)return;if(xa.has(dN)){let RN=xa.get(dN);return void(RN&&(RN.onSei=fN.onSei))}let mN={track:dN.track,onSei:fN.onSei};if(oo()){if(!dN.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let RN=null;try{RN=dN.createEncodedStreams()}catch(t0){return void _.error("create video-encoded-streams error",t0&&t0.message)}let IN=new TransformStream({transform(t0,aH){mN.controller||(mN.controller=aH),dN.track&&dN.track.id!==mN.track.id&&(_.debug("video track changed: ".concat(mN.track.id," => ").concat(dN.track.id)),mN.track.removeEventListener("ended",EN),mN.track=dN.track,mN.track.addEventListener("ended",EN));let pH=function(SH){let vH=new DataView(SH.data),AH=0;for(;AH+4<SH.data.byteLength;){if(vH.getUint8(AH+0)===0&&vH.getUint8(AH+1)===0&&vH.getUint8(AH+2)===0&&vH.getUint8(AH+3)===1&&vH.getUint8(AH+4)===6){let UH=AH+6,zH=0,CH=0;for(;(CH=vH.getUint8(UH++))===255;)zH+=255;zH+=CH;let HH=FG(SH.data,UH,zH);return new Uint8Array(HH)}AH++}return null}(t0);pH&&mN.onSei&&mN.onSei(pH),aH.enqueue(t0)}});RN.readable.pipeThrough(IN).pipeTo(RN.writable)}else if(je()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let RN=vl(),IN=new MessageChannel;await new j(aH=>RN.onmessage=pH=>{pH.data==="registered"&&aH(void 0)});let t0=new RTCRtpScriptTransform(RN,{name:"rx",port:IN.port2},[IN.port2]);dN.transform=t0,await new j(aH=>RN.onmessage=pH=>{pH.data==="started"&&aH(void 0)}),IN.port1.onmessage=aH=>{var pH;aH.data.transformed&&dN.track&&((pH=dN.track)===null||pH===void 0?void 0:pH.id)!==mN.track.id?(_.debug("video track changed: ".concat(mN.track.id," => ").concat(dN.track.id)),mN.track.removeEventListener("ended",EN),mN.track=dN.track,mN.track.addEventListener("ended",EN)):aH.data.sei&&mN.onSei&&mN.onSei(aH.data.sei)},mN.worker=RN}function EN(){if(dN.track){if(this.id!==dN.track.id)return;dN.track.removeEventListener("ended",EN)}(function(RN){let IN=xa.get(RN);if(IN){xa.delete(RN);try{var t0,aH;(t0=IN.controller)===null||t0===void 0||t0.terminate(),(aH=IN.worker)===null||aH===void 0||aH.terminate()}catch(pH){_.warning(pH&&pH.message)}}})(dN)}xa.set(dN,mN),dN.track.addEventListener("ended",EN)}(A.receiver,{onSei:dN=>{var fN;(fN=e._videoTrack)===null||fN===void 0||fN._onSei(dN)}}):r==Q.AUDIO&&await async function(dN){if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support audio encoded transform");if(jd.has(dN))return;let fN={track:dN.track};if(oo()){if(!dN.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let EN=null;try{EN=dN.createEncodedStreams()}catch(IN){return void _.error("create audio-encoded-streams error",IN&&IN.message)}let RN=new TransformStream({transform(IN,t0){fN.controller||(fN.controller=t0),dN.track&&dN.track.id!==fN.track.id&&(_.debug("audio track changed: ".concat(fN.track.id," => ").concat(dN.track.id)),fN.track.removeEventListener("ended",mN),fN.track=dN.track,fN.track.addEventListener("ended",mN)),t0.enqueue(IN)}});EN.readable.pipeThrough(RN).pipeTo(EN.writable)}else if(je()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let EN=vl(),RN=new MessageChannel;await new j(t0=>EN.onmessage=aH=>{aH.data==="registered"&&t0(void 0)});let IN=new RTCRtpScriptTransform(EN,{name:"rx",port:RN.port2},[RN.port2]);dN.transform=IN,await new j(t0=>EN.onmessage=aH=>{aH.data==="started"&&t0(void 0)}),RN.port1.onmessage=t0=>{var aH;t0.data.transformed&&dN.track&&((aH=dN.track)===null||aH===void 0?void 0:aH.id)!==fN.track.id&&(_.debug("audio track changed: ".concat(fN.track.id," => ").concat(dN.track.id)),fN.track.removeEventListener("ended",mN),fN.track=dN.track,fN.track.addEventListener("ended",mN))},fN.worker=EN}function mN(){dN.track.removeEventListener("ended",mN),function(EN){let RN=jd.get(EN);if(RN){jd.delete(EN);try{var IN,t0;(IN=RN.controller)===null||IN===void 0||IN.terminate(),(t0=RN.worker)===null||t0===void 0||t0.terminate()}catch(aH){_.warning(aH&&aH.message)}}}(dN)}jd.set(dN,fN),dN.track.addEventListener("ended",mN)}(A.receiver));let _e=this.remoteUserMap.get(e);_e?_e.set(r,C):this.remoteUserMap.set(e,new Map([[r,C]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let cN=this.pendingRemoteTracks.findIndex(dN=>{let{user:fN,kind:mN}=dN;return fN.uid===e.uid&&r===mN});cN!==-1&&(this.pendingRemoteTracks.splice(cN,1),this.emit(tt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Rt.Connected)throw new N(R.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(h=>{var p;let{user:g,mediaType:C}=h;return!((p=this.remoteUserMap.get(g))!==null&&p!==void 0&&p.has(C))});let r=[],i=new Map;e.forEach(h=>{if(!this.connection)return;let p=this.connection.getPreMedia(h.ssrcId);p?i.set(h.ssrcId,p):r.push(h)});let o=await this.connection.batchReceive(r.map(h=>{let{user:p,mediaType:g,ssrcId:C,rtxSsrcId:A}=h;return{kind:g,ssrcMsg:[{ssrcId:C,rtx:A}],mslabel:String(p._uintid)}}));r.forEach((h,p)=>{i.set(h.ssrcId,o[p])}),e.forEach(h=>{let{user:p,mediaType:g,ssrcId:C}=h,A=i.get(C);if(!A)return void _.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(p.uid," subscribe data,").concat(g,", ").concat(C));let{track:x,id:_e,transceiver:cN}=A;g===Q.AUDIO?(p._audioTrack?p._audioTrack._updateOriginMediaStreamTrack(x):(p._audioTrack=new Ks(x,p.uid,p._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(p._audioTrack.getTrackId()))),cN&&p._audioTrack._updateRtpTransceiver(cN),this.bindRemoteTrackEvents(p,p._audioTrack)):(p._videoTrack?p._videoTrack._updateOriginMediaStreamTrack(x):(p._videoTrack=new Hs(x,p.uid,p._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(p._videoTrack.getTrackId()))),cN&&p._videoTrack._updateRtpTransceiver(cN),this.bindRemoteTrackEvents(p,p._videoTrack));let dN=this.remoteUserMap.get(p);dN?dN.set(g,_e):this.remoteUserMap.set(p,new Map([[g,_e]])),this.statsCollector.addRemoteStats(p.uid),this.statsUploader.startUploadInboundStats();let fN=this.pendingRemoteTracks.findIndex(mN=>{let{user:EN,kind:RN}=mN;return EN.uid===p.uid&&g===RN});fN!==-1&&(this.pendingRemoteTracks.splice(fN,1),this.emit(tt.MediaReconnectEnd,p.uid))})}async unsubscribe(e,r,i){let o=this.pendingRemoteTracks.filter(g=>{let{user:C,kind:A}=g;return r!==void 0?C.uid===e.uid&&r===A:C.uid===e.uid});if(o.forEach(g=>{let C=this.pendingRemoteTracks.indexOf(g);this.pendingRemoteTracks.splice(C,1)}),this.connection&&this.state===Rt.Connected||i||o.forEach(g=>{let{kind:C}=g;var A;if(C===Q.AUDIO)(A=e._audioTrack)===null||A===void 0||A._destroy(),e._audioTrack=void 0;else if(C===Q.VIDEO){var x;(x=e._videoTrack)===null||x===void 0||x._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Rt.Connected)return;let h=this.filterTobeUnSubscribedTracks(e,r);if(h.length===0)return;await this.connection.stopReceiving(h.map(g=>{let[,{id:C}]=g;return C}));let p=this.createUnsubscribeMessage(h);return this.withdrawRemoteTracks(h),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),h.forEach(g=>{let[C,{kind:A}]=g;var x,_e;if(A===Q.VIDEO&&C._videoSSRC&&((x=this.connection)===null||x===void 0||x.setStatsRemoteVideoIsReady(C._videoSSRC,!1)),A===Q.VIDEO)this.unbindRemoteTrackEvents(C._videoTrack),i||((_e=C._videoTrack)===null||_e===void 0||_e._destroy(),C._videoTrack=void 0);else if(A===Q.AUDIO){var cN;this.unbindRemoteTrackEvents(C._audioTrack),!i&&((cN=C._audioTrack)===null||cN===void 0||cN._destroy(),C._audioTrack=void 0)}}),p}async unsubscribeDataChannel(e,r){if(r.forEach(h=>{let p=this.pendingRemoteDataChannels.findIndex(g=>g.id===h.id);p!==-1&&this.pendingRemoteDataChannels.splice(p,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(h=>{h._close()});let o=this.remoteDataChannelMap.get(e);return i.forEach(h=>{o&&o.delete(h.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(h=>h.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(let{user:h,mediaType:p}of e){let g=this.pendingRemoteTracks.filter(C=>{let{user:A,kind:x}=C;return p!==void 0?A.uid===h.uid&&p===x:A.uid===h.uid});g.forEach(C=>{let A=this.pendingRemoteTracks.indexOf(C);this.pendingRemoteTracks.splice(A,1)}),r=r.concat(g)}if(!this.connection||this.state!==Rt.Connected)return void r.forEach(h=>{let{user:p,kind:g}=h;var C;if(g===Q.AUDIO)(C=p._audioTrack)===null||C===void 0||C._destroy(),p._audioTrack=void 0;else if(g===Q.VIDEO){var A;(A=p._videoTrack)===null||A===void 0||A._destroy(),p._videoTrack=void 0}});let i=ji(e).call(e,(h,p)=>{let{user:g,mediaType:C}=p,A=this.filterTobeUnSubscribedTracks(g,C);return h.concat(A)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(h=>{let[,{id:p}]=h;return p}));let o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(h=>{let[p,{kind:g}]=h;var C,A;if(g===Q.VIDEO&&p._videoSSRC&&((C=this.connection)===null||C===void 0||C.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),g===Q.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),(A=p._videoTrack)===null||A===void 0||A._destroy(),p._videoTrack=void 0;else if(g===Q.AUDIO){var x;this.unbindRemoteTrackEvents(p._audioTrack),(x=p._audioTrack)===null||x===void 0||x._destroy(),p._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Rt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void _.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void _.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));let o=r===Q.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void _.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||_.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){let r=this.localTrackMap.get(U.LocalAudioTrack);if((r==null?void 0:r.track)instanceof ge){let i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[h]=o;return h!==U.LocalAudioTrack}).filter(o=>{let[h]=o;return!(e&&h===U.LocalVideoLowTrack)}).map(o=>{let[,{track:h}]=o;return h}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===U.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,h){if(e){let g=this.localTrackMap.get(U.LocalAudioTrack),C=o?this.localTrackMap.get(U.LocalVideoLowTrack):this.localTrackMap.get(U.LocalVideoTrack);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.track.getTrackLabel(),videoName:C==null?void 0:C.track.getTrackLabel(),screenshare:(C==null?void 0:C.track._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!g,video:!!C,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}else{var p;i||(i=[]);let g=i.find(A=>A instanceof Qt),C=o?(p=this.localTrackMap.get(U.LocalVideoTrack))===null||p===void 0?void 0:p.track:i.find(A=>A instanceof Ft);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.getTrackLabel(),videoName:C==null?void 0:C.getTrackLabel(),screenshare:(C==null?void 0:C._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!g,video:!!C,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}}reportSubscribeEvent(e,r,i,o){let h=o===Q.VIDEO?i._videoSSRC:i._audioSSRC;h&&X.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===Q.VIDEO,audio:o===Q.AUDIO,peerid:i.uid,subscribeRequestid:h,p2pid:this.store.p2pId,eventElapse:qe.measureFromSubscribeStart(this.store.clientId,h),preSsrc:this.isPreSubScribe(h)})}reset(){_.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ze("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Va({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(U.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ge){if(e.track.trackList.length>0){let r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Rt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(U.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(U.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let r=this.localTrackMap.get(e);return r&&r.track instanceof Ft||r&&r.track instanceof Qt?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;let i=Array.from(xn(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),r=this.localTrackMap.get(U.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ed(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(_.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Rt.Reconnecting,v("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Va({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case U.LocalVideoTrack:W(r=o._hints).call(r,Gt.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case U.LocalAudioTrack:o instanceof ge?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case U.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(xn(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(tt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(xn(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),_.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(let i of this.pendingRemoteDataChannels){let{user:o,id:h}=i;if((e instanceof ir?e.uid:e)===o.uid&&h===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(let i of this.pendingRemoteTracks){let{user:o,kind:h}=i;if((e instanceof ir?e.uid:e)===o.uid&&r===h)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return Bi(function*(){if(!r.connection||r.state!==Rt.Connected)return;let i=yield Tt(r.mutex.lock("From P2PChannel.restartICE")),o;try{o=yield Tt(r.connection.restartICE(e));let p=yield Tt(o.next());if(p.done)return;let g=p.value,C=yield g;switch(r.reportPCDisconnectedOrFailed(e),e){case On.TCP:r._pcStatsUploadType=Tr.TCP_RESTART;break;case On.RELAY:r._pcStatsUploadType=Tr.RELAY_RESTART;break;default:r._pcStatsUploadType=Tr.OLD_RESTART}r._isInRestartIce=!0,o.next(C)}catch(p){var h;(h=o)===null||h===void 0||h.throw(p)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),r=this.localTrackMap.get(U.LocalVideoTrack),i=this.localTrackMap.get(U.LocalAudioTrack),o=e.videoSend.find(fN=>fN.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),h=e.audioSend.find(fN=>fN.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!h)return 1;let p=ni(this,tt.NeedSignalRTT),g=o?o.rttMs:void 0,C=h?h.rttMs:void 0,A=g&&C?(g+C)/2:g||C,x=(A&&p?(A+p)/2:A||p)||0,_e=100*e.sendPacketLossRate*.7/50+.3*x/1500,cN=_e<.17?1:_e<.36?2:_e<.59?3:_e<.1?4:5,dN=r==null?void 0:r.track;if(dN&&dN._encoderConfig&&dN._hints.indexOf(Gt.SCREEN_TRACK)===-1){let fN=dN._encoderConfig.bitrateMax,mN=e.bitrate.actualEncoded;if(fN&&mN){let EN=(1e3*fN-mN)/(1e3*fN);return OO[EN<.15?0:EN<.3?1:EN<.45?2:EN<.6?3:4][cN]}}return cN}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i,h=o._audioSSRC,p=o._videoSSRC,g=e.audioRecv.find(mN=>mN.ssrc===h),C=e.videoRecv.find(mN=>mN.ssrc===p);if(!g&&!C)return void(r+=1);let A=ni(this,tt.NeedSignalRTT),x=e.rtt,_e=(x&&A?(x+A)/2:x||A)||0,cN=g?g.jitterMs:void 0,dN=e.recvPacketLossRate,fN=.7*dN*100/50+.3*_e/1500;cN&&(fN=.6*dN*100/50+.2*_e/1500+.2*cN/400),r+=fN<.1?1:fN<.17?2:fN<.36?3:fN<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new j((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(_.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Rt.Connected)return;let o=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:g}]=p;return e===g});if(!o)return;let h=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:h}]),this.bindLocalTrackEvents([{track:r,type:h}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){let p=o[1];p.id=r._mediaStreamTrack.id,this.localTrackMap.set(h,p)}if(h===U.LocalVideoTrack&&!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){let p=this.localTrackMap.get(U.LocalVideoLowTrack);if(p){let g=e._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=g,p.track._originMediaStreamTrack=g,await new j((C,A)=>{this.handleReplaceTrack(p.track,C,A,!0)})}}}filterTobePublishedTracks(e,r,i){let o=[],h=this.getAllTracks();e=Ls(e=e.filter(A=>h.indexOf(A)===-1));let p,g=!1,C=this.localTrackMap.get(U.LocalAudioTrack);for(let A of e){if(A instanceof Ft&&(this.localTrackMap.has(U.LocalVideoTrack)||g?new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:A,type:U.LocalVideoTrack}),g=!0),r)){let x=this.getLowVideoTrack(A,i);o.push({track:x,type:U.LocalVideoLowTrack})}if(A instanceof Qt)if(C){let x=C.track;if(x instanceof ge)lm([A]),x.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0);else{let _e=E_([x,A]);_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_e.getTrackId(),"]")),this.replaceTrack(x,_e)}}else p instanceof ge?(lm([A]),p.addAudioTrack(A)):p||!A._useAudioElement&&ft().webAudioMediaStreamDest&&!A._bypassWebAudio?p=E_(p?[A,p]:[A]):p=A}return p&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(p.getTrackId(),"]")),o.push({track:p,type:U.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){let r=[],i=this.getAllTracks();e=Ls(e=e.filter(o=>i.indexOf(o)!==-1));for(let o of e){if(o instanceof Qt){let h=this.localTrackMap.get(U.LocalAudioTrack);if(!h)continue;h.track instanceof ge?(h.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),h.track.trackList.length===0&&(r.push([U.LocalAudioTrack,h]),h.track.close())):r.push([U.LocalAudioTrack,h])}if(o instanceof Ft){let h=this.localTrackMap.get(U.LocalVideoTrack);if(!h)continue;r.push([U.LocalVideoTrack,h]);let p=this.localTrackMap.get(U.LocalVideoLowTrack);p&&r.push([U.LocalVideoLowTrack,p])}}return r}filterTobePublishedDataChannels(e){return e=(e=Ls(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ls(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case U.LocalVideoTrack:i.addListener(H.GET_STATS,this.handleGetLocalVideoStats),i.addListener(H.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case U.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof ge?e.trackList.forEach(i=>{i.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(H.GET_STATS,this.handleGetLocalAudioStats),i.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(H.GET_STATS,this.handleGetLocalAudioStats),e.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(H.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case U.LocalVideoTrack:i.off(H.GET_STATS,this.handleGetLocalVideoStats),i.off(H.GET_RTC_STATS,this.handleGetRTCStats),i.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case U.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ge?e.trackList.forEach(r=>{r.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(H.GET_STATS,this.handleGetLocalAudioStats),r.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(H.GET_STATS,this.handleGetLocalAudioStats),e.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(H.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Hs&&r.addListener(H.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Ks&&r.addListener(H.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(H.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(Q.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Q.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var h;let p,g,{track:C,type:A}=i;switch(A){case U.LocalAudioTrack:p=Ct.Audio,g={dtx:C instanceof ou&&C._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case U.LocalVideoTrack:p=W(h=C._hints).call(h,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High,g=Zi(Zi({},GR(C)),{},{codec:this.store.codec,svc_mode:$E()});break;case U.LocalVideoLowTrack:p=Ct.Low,g=Zi(Zi({},GR(C)),{},{codec:this.store.codec,svc_mode:$E()})}return{stream_type:p,attributes:g,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[h,{track:p,ssrcs:g,id:C}]=r;switch(h){case U.LocalVideoTrack:o=W(i=p._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoLowTrack:o=Ct.Low}return{stream_type:o,ssrcs:g,mid:C}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:h,type:p}=i;this.localTrackMap.set(p,{track:h,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(tt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),v("NEW_ICE_RESTART")){var i;if(W(i=this._restartStates).call(i,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let o=g=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(_.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(g)),ni(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE,g))},h=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),_.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},p=v("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(v("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ft().supportPCSetConfiguration)o(On.RELAY),this._restartTimer=window.setTimeout(h,p);else if($t())o(On.UDP),this._restartTimer=window.setTimeout(h,4e3);else{if(o(On.TCP),ft().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{o(On.RELAY),this._restartTimer=window.setTimeout(h,p)},p));this._restartTimer=window.setTimeout(h,p)}},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&v("ICE_RESTART")&&ni(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),X.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Zt.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;let o=Array.from(xn(i=this.remoteUserMap).call(i)).find(p=>p._audioSSRC===r);var h;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(h=o.audioTrack)===null||h===void 0||h.emit(Ws.FIRST_FRAME_DECODED),X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_DECODE,Jt.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;let o=Array.from(xn(i=this.remoteUserMap).call(i)).find(h=>h._audioSSRC===r);o&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_RECEIVED,Jt.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;let o=Array.from(xn(i=this.remoteUserMap).call(i)).find(h=>h._videoSSRC===r);o&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_VIDEO_RECEIVED,Jt.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{let o=r.candidateType==="relay",h=i.candidateType==="relay";i.candidateType!=="unknown"&&o===h||this.emit(tt.ConnectionTypeChange,o),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(eo(i))," -> ").concat(JSON.stringify(eo(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(eo(i))," -> ").concat(JSON.stringify(eo(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Zi(Zi({},r),i)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let r=[];if(this.getAllTracks().indexOf(e)===-1)return r;let i=this.localTrackMap.get(U.LocalAudioTrack);if(e instanceof Qt&&(i==null?void 0:i.track)instanceof ge)return i.track.isActive||r.push([U.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return e===p});if(o&&(r.push(o),o[0]===U.LocalVideoTrack)){let h=this.localTrackMap.get(U.LocalVideoLowTrack);h&&r.push([U.LocalVideoLowTrack,h])}return r}filterTobeUnmutedTracks(e){let r=[],i=this.localTrackMap.get(U.LocalAudioTrack);if(e instanceof Qt&&(i==null?void 0:i.track)instanceof ge)return i.track.isActive&&r.push([U.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return e===p});if(o)if(o[0]===U.LocalVideoTrack){r.push(o);let h=this.localTrackMap.get(U.LocalVideoLowTrack);h&&r.push([U.LocalVideoLowTrack,h])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[h,{track:p,ssrcs:g,id:C}]=r;switch(h){case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoTrack:o=W(i=p._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:o=Ct.Low}return{stream_type:o,ssrcs:g,mid:C}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[h,{track:p,ssrcs:g,id:C}]=r;switch(h){case U.LocalAudioTrack:o=Ct.Audio;break;case U.LocalVideoTrack:o=W(i=p._hints).call(i,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:o=Ct.Low}return{stream_type:o,ssrcs:g,mid:C}})}filterTobeUnSubscribedTracks(e,r){let i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){let h=o.get(r);if(!h)return i;i.push([e,{kind:r,id:h}])}else Array.from(o.entries()).forEach(h=>{let[p,g]=h;i.push([e,{kind:p,id:g}])});return i}filterTobeUnSubscribedDataChannels(e,r){let i=[];return r.forEach(o=>{var h;(h=this.remoteDataChannelMap.get(e))!==null&&h!==void 0&&h.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){let r=[];return e.forEach(i=>{let[o,{kind:h,id:p}]=i;switch(h){case Q.VIDEO:return void(o._videoSSRC&&r.push({stream_type:Q.VIDEO,ssrcId:o._videoSSRC}));case Q.AUDIO:return void(o._audioSSRC&&r.push({stream_type:Q.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){let r=new Map;return e.forEach(i=>{let[o,{kind:h}]=i;if(r.has(o)){let p=r.get(o);h===Q.VIDEO?p|=ve.Video:p|=ve.Audio,r.set(o,p)}else h===Q.VIDEO?r.set(o,ve.Video):r.set(o,ve.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,h]=i;return{stream_id:o.uid,stream_type:h}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r,h=this.remoteUserMap.get(i);h&&(h.delete(o),Array.from(h.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let r=this.localTrackMap.get(U.LocalVideoTrack),i=this.localTrackMap.get(U.LocalVideoLowTrack);r&&await r.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r){return e.map((i,o)=>{var h;let{stream_type:p}=i;return(h=r.find(g=>{let{stream_type:C}=g;return p===C}))===null||h===void 0?void 0:h.attributes})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Qt){var r;let o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(p=>{let[,{id:g}]=p;return g})));let h=this.createUnmuteMessage(o);return void await kt(this,tt.RequestUnmuteLocal,h)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(tt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Me(hf(this.dtlsFailedCount,Ee)),this.emit(tt.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ge(this,tt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(tt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(U.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ft)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Ft).length>1)throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Qt).length>1&&(e.some(r=>r instanceof Qt&&r._bypassWebAudio)||!ft().webAudioMediaStreamDest))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let r of e){if(r instanceof Ft&&this.pendingLocalTracks.some(i=>i instanceof Ft))throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Qt&&this.pendingLocalTracks.some(i=>i instanceof Qt)&&(!ft().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Qt&&i._bypassWebAudio)))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){let i=!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding,o=Zi(Zi({},{width:160,height:120,framerate:15,bitrate:50}),r),h;h=i?e._mediaStreamTrack.clone():dm(e,o);let p=Ut(8,"track-low-"),g=new Ft(h,Zi(Zi({},i&&{scaleResolutionDownBy:GE(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,p);return g.on(Ko.TRANSCEIVER_UPDATED,C=>{e._updateRtpTransceiver(C,na.LOW_STREAM)}),g._hints.push(Gt.LOW_STREAM),e.on("sei-to-send",C=>{g.emit("sei-to-send",C)}),e.addListener(H.NEED_CLOSE,()=>{g.close()}),g}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ki){var h,p,g,C;let A=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:x,dtlsTransportState:_e,peerConnectionState:cN}=this.connection,{local:dN,remote:fN}=await this.connection.getSelectedCandidatePair();X.pcStats(this.store.sessionId,{startTime:A,eventElapse:e-A||0,iceconnectionsate:x,dtlsstate:_e,connectionstate:cN,intSucc:r?1:2,error:o,selectedLocalCandidateProtocol:(h=dN==null?void 0:dN.protocol)!==null&&h!==void 0?h:"",selectedLocalCandidateType:(p=dN.candidateType)!==null&&p!==void 0?p:"",selectedLocalCandidateAddress:"".concat(dN.address,":").concat(dN.port),selectedRemoteCandidateProtocol:(g=fN.protocol)!==null&&g!==void 0?g:"",selectedRemoteCandidateType:(C=fN.candidateType)!==null&&C!==void 0?C:"",selectedRemoteCandidateAddress:"".concat(fN.address,":").concat(fN.port),restartCnt:i,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,r,i,o){var h;let p=Array.from(xn(h=this.remoteUserMap).call(h)).find(g=>g._videoSSRC===e);if(p){o||this.store.subscribe(p.uid,"video",void 0,void 0,void 0,void 0,Date.now());let g=this.store.keyMetrics,C=g.subscribe.find(A=>A.userId===p.uid&&A.type==="video");X.firstRemoteVideoDecode(this.store.sessionId,De.FIRST_VIDEO_DECODE,Jt.FIRST_VIDEO_DECODE,{peer:p._uintid,videowidth:r,videoheight:i,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:g.requestAPEnd||0,apStart:g.requestAPStart||0,joinGwEnd:g.joinGatewayEnd||0,joinGwStart:g.joinGatewayStart||0,pcEnd:g.peerConnectionEnd||0,pcStart:g.peerConnectionStart||0,subscriberEnd:(C==null?void 0:C.subscribeEnd)||0,subscriberStart:(C==null?void 0:C.subscribeStart)||0,videoAddNotify:(C==null?void 0:C.streamAdded)||0,state:o?1:0,firstFrame:(C==null?void 0:C.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let h=o.get(r);if(!h)return!1;let p=await this.connection.getRemoteSSRC(h);return p!==void 0&&p!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===U.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,na.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof ki&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Tr.TCP_RESTART&&e===On.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Tr.DISCONNECTED_OR_FAILED)))}},q(at.prototype,"startP2PConnection",[tn],Object.getOwnPropertyDescriptor(at.prototype,"startP2PConnection"),at.prototype),q(at.prototype,"connect",[tn],Object.getOwnPropertyDescriptor(at.prototype,"connect"),at.prototype),q(at.prototype,"updateRemoteRTPCapabilities",[tn],Object.getOwnPropertyDescriptor(at.prototype,"updateRemoteRTPCapabilities"),at.prototype),q(at.prototype,"publishDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"publishDataChannel"),at.prototype),q(at.prototype,"unpublish",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unpublish"),at.prototype),q(at.prototype,"unpublishDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unpublishDataChannel"),at.prototype),q(at.prototype,"unpublishLowStream",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unpublishLowStream"),at.prototype),q(at.prototype,"subscribeDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"subscribeDataChannel"),at.prototype),q(at.prototype,"subscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"subscribe"),at.prototype),q(at.prototype,"massSubscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"massSubscribe"),at.prototype),q(at.prototype,"unsubscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unsubscribe"),at.prototype),q(at.prototype,"unsubscribeDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unsubscribeDataChannel"),at.prototype),q(at.prototype,"massUnsubscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"massUnsubscribe"),at.prototype),q(at.prototype,"muteRemote",[tn],Object.getOwnPropertyDescriptor(at.prototype,"muteRemote"),at.prototype),q(at.prototype,"unmuteRemote",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unmuteRemote"),at.prototype),q(at.prototype,"hasRemoteMediaWithLock",[tn],Object.getOwnPropertyDescriptor(at.prototype,"hasRemoteMediaWithLock"),at.prototype),q(at.prototype,"disconnectForReconnect",[tn],Object.getOwnPropertyDescriptor(at.prototype,"disconnectForReconnect"),at.prototype),q(at.prototype,"updateBitrateLimit",[tn],Object.getOwnPropertyDescriptor(at.prototype,"updateBitrateLimit"),at.prototype),q(at.prototype,"remoteMediaSsrcChanged",[tn],Object.getOwnPropertyDescriptor(at.prototype,"remoteMediaSsrcChanged"),at.prototype),at);function tn(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let h=this.mutex,p=await h.lock("From P2PChannel.".concat(r));try{for(var g=arguments.length,C=new Array(g),A=0;A<g;A++)C[A]=arguments[A];return await o.apply(this,C)}finally{p()}},i}var C0={};function Ba(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&_.debug("install service ".concat(e.name)),C0[e.name]=e}function Za(e){let r=C0[e];if(!r)throw new N(R.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function Kv(e,r){return Za("DataStream").create(e,r)}function Yv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function qv(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Yv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Yv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var EW=Date.now(),mW=20,hm=new Map,wl=new Map;async function I0(e){let r=hm.get(e),i=Array.isArray(r)&&r[r.length-1],o=wl.get(e);if(!i)return void(o.isSyncing=!1);let h={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);let p=i.sendTs-o.firstSendTs,g=p-(Date.now()-o.firstRecvTs);g>0&&(o.firstRecvTs=Date.now()-p);let C=i.mediaDelay+g;C<=0?(r.pop(),v0(i.context,h),C=0):C=Math.min(C,mW),setTimeout(()=>r.length&&I0(e),C)}function v0(e,r){e.safeEmit(ut.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function fW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return v0(i,{uid:e.uid,payload:e.payload});let o="".concat(i.id,"-").concat(e.uid),h=hm.get(o)||[],p=h.findIndex(x=>e.sendTs>=x.sendTs),g=qv(qv({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});p===-1?h.push(g):h.splice(p,0,g),hm.set(o,h);let C=!1;var A;wl.has(o)?C=!((A=wl.get(o))===null||A===void 0||!A.isSyncing):wl.set(o,{isSyncing:C,firstRecvTs:0,firstSendTs:0}),C||I0(o)}var gW=mt().name;function zv(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Jv(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?zv(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zv(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var zs="websdk_ng_cache_parameter",TW=v("MAX_PRELOAD_ASYNC_LENGTH"),SW=1e4,Mo=new Map,Uo=[],f_=null,g_=0,T_=0,Xd=new Map,RW=function(e,r){let i=[],o=0,h=async()=>{let p=i.shift();p&&await p(),i.length>0&&o<r?h():o--};return async function(){for(var p=arguments.length,g=new Array(p),C=0;C<p;C++)g[C]=arguments[C];return new j(async(A,x)=>{i.push(async()=>{try{let _e=await e(...g);A(_e)}catch(_e){x(_e)}}),o<r&&(o++,h())})}}(y0,TW),S_=mn.CancelToken.source();async function y0(e,r,i,o,h,p){try{if(!v("ENABLE_PRELOAD"))return;if(!ft().supportWebCrypto)return void po(()=>{_.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new N(R.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Pe(i,"token",1,2047),Pe(e,"appid",1,2047),Xu(r),o&&Qu(o);let g=Ms();_.debug("preload channel ".concat(r,", uid is ").concat(o));let C={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:g,proxyServer:h},A,x;typeof o=="string"?(C.stringUid=o,[x,A]=await j.all([YG(o,{sid:g,appId:e},S_.token),ev(Jv(Jv({},C),{},{token:i||e,uid:0}),S_.token)]),C.uid=x.uid,A.gatewayInfo.uid=C.uid,A.gatewayInfo.res.uid=C.uid):(p&&(C.stringUid=p),A=await ev(C,S_.token));let _e={sid:g,appId:e,cname:r,token:i||e,uid:C.stringUid||o,intUid:C.uid||A.gatewayInfo.uid,stringUid:C.stringUid,ts:Date.now(),sua:x,ap:A};await async function(cN){let dN;try{cN.uid&&A0({appId:cN.appId,cname:cN.cname,token:cN.token,uid:cN.uid,stringUid:cN.stringUid});let fN=O0(cN),mN=await async function(RN,IN){try{let t0=await window.crypto.subtle.importKey("raw",yO(IN),"AES-GCM",!1,["encrypt"]),aH=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},t0,Fo(window.btoa(JSON.stringify(RN))));return so(new Uint8Array(aH))}catch{return}}(cN,cN.token||cN.appId);if(!mN)return;dN=w0(zs);let EN=dN?JSON.parse(dN):[];EN.push({[fN]:mN}),EN.length>v("AP_CACHE_NUM")&&EN.shift(),gu(zs,JSON.stringify(EN))}catch(fN){_.warn("Error caching server parameters:",fN.message),gu(zs,"")}}(_e),g_++}catch(g){throw T_++,function(C){f_||(f_=window.setTimeout(()=>{let x="";Xd.forEach((_e,cN)=>{x+="".concat(cN,": ").concat(_e," ;")}),X.reportApiInvoke(null,{name:Te.PRELOAD,options:{success:g_,failed:T_,err:x}}).onError(C),g_=0,T_=0,Xd.clear(),f_=null},SW));let A=Xd.get(C.code)||0;Xd.set(C.code,A+1)}(g),g}}async function Xv(e){try{let r=A0(e);if(!r||e.cloudProxyServer!=="disabled")return;let i=await async function(o,h){try{let p=await window.crypto.subtle.importKey("raw",yO(h),"AES-GCM",!1,["decrypt"]),g=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},p,Fo(o));return JSON.parse(window.atob(so(new Uint8Array(g))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,h){return o.cname===h.cname&&o.appId===h.appId&&o.token===h.token?h.stringUid?o.stringUid===h.stringUid:typeof h.uid=="number"?o.uid===h.uid:o.uid==h.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<v("AP_CACHE_LIFETIME"))return i}catch(r){_.warn("Error get preloadInfo",r.message)}}function A0(e){let r;try{if(r=w0(zs),!r)return;let i=JSON.parse(r),o=O0(e),h=function(g,C){for(let A=g.length-1;A>=0;A--)if(C(g[A]))return A;return-1}(i,g=>o in g);if(h===-1)return;let p=i.splice(h,1)[0];return gu(zs,JSON.stringify(i)),p[o]}catch(i){_.warn("Error delete preload info: ".concat(r),i.message),gu(zs,"")}}function Df(e){if(e){let r=Mo.get(e);r&&(window.clearTimeout(r),r=null,Mo.delete(e)),W(Uo).call(Uo,e)||e.cloudProxyServer!=="disabled"||Uo.push(e)}if(Mo.size<v("AP_CACHE_NUM")&&Uo.length>0){let r=Uo.shift();Mo.set(r,window.setTimeout(async()=>{let{appId:i,cname:o,token:h,stringUid:p,uid:g,proxyServer:C}=r;try{await RW(i,o,h,g,C,p),Mo.has(r)&&Df(r)}catch(A){_.warn("update preload failed",A.message),b0(r)}},v("AP_UPDATE_INTERVAL")))}}function b0(e){let r=Uo.indexOf(e);r!==-1&&Uo.splice(r,1);let i=Mo.get(e);i&&(window.clearTimeout(i),i=null,Mo.delete(e),Df())}function Qv(e,r){let i=e.sua,o=e.ap;r&&i&&X.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),X.reportResourceTiming(e.ap.url,e.sid),X.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(h=>h.ip).join(","),eventType:"disabled",unilbsServerIds:[ue.CHOOSE_SERVER,ue.CLOUD_PROXY_FALLBACK].toString()}),X.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(h=>h.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ue.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function w0(e){return window.atob(window.localStorage.getItem(e)||"")}function gu(e,r){window.localStorage.setItem(e,window.btoa(r))}function O0(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),bO(r)}function CW(e){let r=function(){let i=yW.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let h=i.appId;h!==void 0&&(de(o,10),Hr(o,h));let p=i.cid;p!==void 0&&(de(o,16),de(o,p));let g=i.cname;g!==void 0&&(de(o,26),Hr(o,g));let C=i.deviceId;C!==void 0&&(de(o,34),Hr(o,C));let A=i.elapse;A!==void 0&&(de(o,40),Kr(o,A));let x=i.fileSize;x!==void 0&&(de(o,48),Kr(o,Ss(x)));let _e=i.height;_e!==void 0&&(de(o,56),Kr(o,Ss(_e)));let cN=i.jpg;cN!==void 0&&(de(o,66),de(o,cN.length),Zv(o,cN));let dN=i.networkType;dN!==void 0&&(de(o,72),Kr(o,Ss(dN)));let fN=i.osType;fN!==void 0&&(de(o,80),Kr(o,Ss(fN)));let mN=i.requestId;mN!==void 0&&(de(o,90),Hr(o,mN));let EN=i.sdkVersion;EN!==void 0&&(de(o,98),Hr(o,EN));let RN=i.sequence;RN!==void 0&&(de(o,104),Kr(o,Ss(RN)));let IN=i.sid;IN!==void 0&&(de(o,114),Hr(o,IN));let t0=i.timestamp;t0!==void 0&&(de(o,120),Kr(o,t0));let aH=i.uid;aH!==void 0&&(de(o,128),de(o,aH));let pH=i.vid;pH!==void 0&&(de(o,136),de(o,pH));let SH=i.width;SH!==void 0&&(de(o,144),Kr(o,Ss(SH)));let vH=i.service;vH!==void 0&&(de(o,152),de(o,vH));let AH=i.callbackData;AH!==void 0&&(de(o,162),de(o,AH.length),Zv(o,AH));let UH=i.ticket;UH!==void 0&&(de(o,170),Hr(o,UH));let zH=i.vendorConfigs;zH!==void 0&&(de(o,178),Hr(o,zH))}(e,r),function(i){let o=i.bytes,h=i.limit;return o.length===h?o:o.subarray(0,h)}(r)}function IW(e){return function(i){let o={};e:for(;!AW(i);){let h=$a(i);switch(h>>>3){case 0:break e;case 1:o.code=$a(i);break;case 2:o.msg=$v(i,$a(i));break;case 3:o.requestId=$v(i,$a(i));break;case 4:o.timestamp=bW(i,!1);break;default:vW(i,7&h)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function vW(e,r){switch(r){case 0:for(;128&gi(e););break;case 2:R_(e,$a(e));break;case 5:R_(e,4);break;case 1:R_(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function Ss(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var yW=[];function R_(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function AW(e){return e.offset>=e.limit}function $u(e,r){let i=e.bytes,o=e.offset,h=e.limit,p=o+r;if(p>i.length){let g=new Uint8Array(2*p);g.set(i),e.bytes=g}return e.offset=p,p>h&&(e.limit=p),o}function N0(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function Zv(e,r){let i=$u(e,r.length);e.bytes.set(r,i)}function $v(e,r){let i=N0(e,r),o=String.fromCharCode,h=e.bytes,p="�",g="";for(let C=0;C<r;C++){let A,x,_e,cN,dN=h[C+i];128&dN?(224&dN)==192?C+1>=r?g+=p:(A=h[C+i+1],(192&A)!=128?g+=p:(cN=(31&dN)<<6|63&A,cN<128?g+=p:(g+=o(cN),C++))):(240&dN)==224?C+2>=r?g+=p:(A=h[C+i+1],x=h[C+i+2],(49344&(A|x<<8))!=32896?g+=p:(cN=(15&dN)<<12|(63&A)<<6|63&x,cN<2048||cN>=55296&&cN<=57343?g+=p:(g+=o(cN),C+=2))):(248&dN)==240?C+3>=r?g+=p:(A=h[C+i+1],x=h[C+i+2],_e=h[C+i+3],(12632256&(A|x<<8|_e<<16))!=8421504?g+=p:(cN=(7&dN)<<18|(63&A)<<12|(63&x)<<6|63&_e,cN<65536||cN>1114111?g+=p:(cN-=65536,g+=o(55296+(cN>>10),56320+(1023&cN)),C+=3))):g+=p:g+=o(dN)}return g}function Hr(e,r){let i=r.length,o=0;for(let g=0;g<i;g++){let C=r.charCodeAt(g);C>=55296&&C<=56319&&g+1<i&&(C=(C<<10)+r.charCodeAt(++g)-56613888),o+=C<128?1:C<2048?2:C<65536?3:4}de(e,o);let h=$u(e,o),p=e.bytes;for(let g=0;g<i;g++){let C=r.charCodeAt(g);C>=55296&&C<=56319&&g+1<i&&(C=(C<<10)+r.charCodeAt(++g)-56613888),C<128?p[h++]=C:(C<2048?p[h++]=C>>6&31|192:(C<65536?p[h++]=C>>12&15|224:(p[h++]=C>>18&7|240,p[h++]=C>>12&63|128),p[h++]=C>>6&63|128),p[h++]=63&C|128)}}function gi(e){return e.bytes[N0(e,1)]}function ty(e,r){let i=$u(e,1);e.bytes[i]=r}function $a(e){let r,i=0,o=0;do r=gi(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function de(e,r){for(r>>>=0;r>=128;)ty(e,127&r|128),r>>>=7;ty(e,r)}function bW(e,r){let i,o=0,h=0,p=0;return i=gi(e),o=127&i,128&i&&(i=gi(e),o|=(127&i)<<7,128&i&&(i=gi(e),o|=(127&i)<<14,128&i&&(i=gi(e),o|=(127&i)<<21,128&i&&(i=gi(e),h=127&i,128&i&&(i=gi(e),h|=(127&i)<<7,128&i&&(i=gi(e),h|=(127&i)<<14,128&i&&(i=gi(e),h|=(127&i)<<21,128&i&&(i=gi(e),p=127&i,128&i&&(i=gi(e),p|=(127&i)<<7))))))))),{low:o|h<<28,high:h>>>4|p<<24,unsigned:r}}function Kr(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,h=r.high>>>24,p=h===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:h<128?9:10,g=$u(e,p),C=e.bytes;switch(p){case 10:C[g+9]=h>>>7&1;case 9:C[g+8]=p!==9?128|h:127&h;case 8:C[g+7]=p!==8?o>>>21|128:o>>>21&127;case 7:C[g+6]=p!==7?o>>>14|128:o>>>14&127;case 6:C[g+5]=p!==6?o>>>7|128:o>>>7&127;case 5:C[g+4]=p!==5?128|o:127&o;case 4:C[g+3]=p!==4?i>>>21|128:i>>>21&127;case 3:C[g+2]=p!==3?i>>>14|128:i>>>14&127;case 2:C[g+1]=p!==2?i>>>7|128:i>>>7&127;case 1:C[g]=p!==1?128|i:127&i}}var ey={},ny={},Tu=4294967296,D0=Tu*Tu,iy=D0/2;P0(0,!0);var ry=P0(0),wW=sa(0,-2147483648,!1),OW=sa(-1,2147483647,!1);function P0(e,r){let i,o,h;return r?(h=0<=(e>>>=0)&&e<256)&&(o=ny[e],o)?o:(i=sa(e,0,!0),h&&(ny[e]=i),i):(h=-128<=(e|=0)&&e<128)&&(o=ey[e],o)?o:(i=sa(e,e<0?-1:0,!1),h&&(ey[e]=i),i)}function sa(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function DW(e,r){if(isNaN(e))return ry;{if(e<=-9223372036854776e3)return wW;if(e+1>=iy)return OW}return e<0?ry:sa(e%Tu|0,e/Tu|0,r)}function oy(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}var pm=class yve extends Xt{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;let i=this._connectionState;this._connectionState=r,this.emit(Mi.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),T(this,"name","AgoraRTCImageModeration"),T(this,"_connectionState",Xn.CONNECTING),T(this,"_sequence",0),T(this,"_moderationStartTime",void 0),T(this,"_workerConnection",void 0),T(this,"_workerMessageLengthLimit",void 0),T(this,"_qualityRatio",void 0),T(this,"_connectInfo",void 0),T(this,"_cancelTokenSource",mn.CancelToken.source()),T(this,"_retryConfig",void 0),T(this,"_moderationInterval",void 0),T(this,"_moderationTimer",null),T(this,"_moderationMode",1),T(this,"_quality",1),T(this,"_qualityTimer",null),T(this,"_ticket",void 0),T(this,"_moderationIntervalMinimum",void 0),T(this,"_uploadFailedNum",0),T(this,"_uploadNum",0),T(this,"_uploadTimer",null),T(this,"_extraInfo",void 0),T(this,"_vendor",""),T(this,"_encoder",new TextEncoder),T(this,"_moderationId",void 0),T(this,"inspectImage",()=>{if(this.connectionState!==Xn.CONNECTED)throw new O(R.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Xn.CONNECTED?this.requestToInspectImage():_.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ut(5,"image-moderation-"),this._workerMessageLengthLimit=v("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=v("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=v("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qo("worker-"+this._moderationId,Ee),this.on(Mi.STATE_CHANGE,(o,h)=>{_.debug("[".concat(this._moderationId,"] Moderation operation :").concat(hs[o]," ").concat(h||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(Mi.STATE_CHANGE,hs.CONNECT_AP),this._connectInfo=r;let o=this._cancelTokenSource.token;return this._retryConfig=i,new j((h,p)=>{this.on(Mi.CONNECTION_STATE_CHANGE,(g,C)=>{g===Xn.CONNECTED&&h()}),this.requestAP(r,o,i).then(g=>{this.connectWorker(g)}).catch(g=>{p(g)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),_.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Xn.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){let h=v("WEBCS_DOMAIN").map(A=>"https://".concat(A,"/api/v1")),p=await function(A,x,_e,cN){let{appId:dN,areaCode:fN,cname:mN,sid:EN,token:RN,uid:IN}=x;Ys++;let t0="moderation_plugin",aH={service_name:t0,json_body:JSON.stringify({appId:dN,areaCode:fN,cname:mN,command:"allocateEdge",requestId:Ys,seq:Ys,sid:EN,appToken:RN,ts:Date.now(),uid:IN+""})},pH,SH,vH=A[0];return Wi(async()=>{pH=Date.now();let AH=await Hi(vH,{data:aH,cancelToken:_e,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(SH=Date.now()-pH,AH.code!==0){let CH=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+AH.code,{retry:!0,responseTime:SH});throw _.error(CH.toString()),CH}let UH=JSON.parse(AH.json_body);if(UH.code!==200){let CH=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(UH.code,", reason: ").concat(UH.reason),{code:UH.code,responseTime:SH});throw _.error(CH.toString()),CH}if(!UH.servers||!Array.isArray(UH.servers)||UH.servers.length===0){let CH=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:UH.code,responseTime:SH});throw _.error(CH.toString()),CH}if(!UH.servers.some(CH=>!!CH.wss)){let CH=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:UH.code,responseTime:SH});throw _.error(CH.toString()),CH}let zH=v("IMAGE_MODERATION_WORKER_HOST");return{addressList:UH.servers.map(CH=>{let{address:HH,wss:VH}=CH;if(HH&&VH)return"wss://".concat(HH.replace(/\./g,"-"),".").concat(zH,":").concat(VH,"/moderation")}).filter(CH=>!!CH),workerToken:UH.workerToken,vid:UH.vid,ticket:UH.appTicket,responseTime:SH}},(AH,UH)=>(X.apworkerEvent(EN,{success:!0,sc:200,serviceName:t0,responseDetail:JSON.stringify(AH.addressList),firstSuccess:UH===0,responseTime:SH,serverIp:A[UH%A.length]}),!1),(AH,UH)=>(X.apworkerEvent(EN,{success:!1,sc:AH.data&&AH.data.code||200,serviceName:t0,responseTime:SH,serverIp:A[UH%A.length]}),!!(AH.code!==R.OPERATION_ABORTED&&AH.code!==R.UNEXPECTED_RESPONSE||AH.data&&AH.data.retry)&&(vH=A[(UH+1)%A.length],!0)),cN)}(h,r,i,o);this.emit(Mi.STATE_CHANGE,hs.AP_CONNECTED);let{addressList:g,ticket:C}=p;return this._ticket=C,g}async connectWorker(r){this.emit(Mi.STATE_CHANGE,hs.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(it.CONNECTED,async()=>{this.emit(Mi.STATE_CHANGE,hs.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Xn.CONNECTED}),this._workerConnection.on(it.CLOSED,()=>{this.connectionState=Xn.CLOSED}),this._workerConnection.on(it.FAILED,()=>{this.connectionState=Xn.CLOSED}),this._workerConnection.on(it.RECONNECTING,()=>{this.connectionState=this.connectionState===Xn.CONNECTED?Xn.RECONNECTING:Xn.CONNECTING}),this._workerConnection.on(it.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){let i=IW(new Uint8Array(r.data));v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,_.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{X.reportApiInvoke(this._connectInfo.sid||null,{name:Te.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Zt.TRACER}).onError(new O(R.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},v("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else _.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(it.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(it.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){let r=ni(this,Mi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("Only the track being played can be inspected"));this._sequence++;let o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:h,cid:p,vid:g,sid:C,uid:A}=i,x=Date.now(),_e=await r.getCurrentFrameImage("image/jpeg",this.quality),cN=await QO(_e,o,h),dN=this._sequence+"-"+p+"-"+A+"-"+x+"-"+Ut(12,""),fN={appId:o,cid:p,cname:h,deviceId:"",elapse:yve.intToLong(Number(x-this._moderationStartTime)),fileSize:_e.buffer.byteLength,height:_e.height,width:_e.width,jpg:cN,networkType:6,osType:7,requestId:dN,sdkVersion:"4.22.0",sequence:this._sequence,sid:C,timestamp:DW(x),uid:A,vid:g,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete fN.callbackData;let mN=CW(fN);if(mN.byteLength<this._workerMessageLengthLimit){if(v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let EN=function(RN){for(var IN=1;IN<arguments.length;IN++){var t0=arguments[IN]!=null?arguments[IN]:{};IN%2?oy(Object(t0),!0).forEach(function(aH){T(RN,aH,t0[aH])}):Object.getOwnPropertyDescriptors?Object.defineProperties(RN,Object.getOwnPropertyDescriptors(t0)):oy(Object(t0)).forEach(function(aH){Object.defineProperty(RN,aH,Object.getOwnPropertyDescriptor(t0,aH))})}return RN}({},fN);delete EN.jpg,_.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(EN))}return mN}{let EN=this.quality*this._qualityRatio;return this.quality=EN,await this.generateRequestData(r,{appId:o,cname:h,cid:p,vid:g,sid:C,uid:A})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Xn.CLOSED,this.emit(Mi.STATE_CHANGE,hs.CLOSED)}};function k0(e){if(Nt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new O(R.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new O(R.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var PW={name:"ImageModeration",create:function(e){let{config:r}=e;return k0(r),new pm(r)}},sy,ay,cy,dy,ly,uy,hy,py,_y,Ey,my,fy,gy,Ty,Sy,Ry,Cy,Iy,vy,yy,Ay,by,wy,Oy,Ny,Dy,Py,ky,Ly,My,Uy,xy,Vy,Fy,By,jy,Gy,Wy,Hy,Ky,G;function Yy(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function xi(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Yy(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Yy(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}ze.setLogger(_);var kW=(sy=$(),ay=$({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof no))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),cy=$({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==fa.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),dy=$({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),ly=$({argsMap:(e,r,i)=>[r,i]}),uy=$({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:h}=i;return[o==null?void 0:o.uid,h]})}),hy=$({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),py=$({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:h}=i;return{uid:o==null?void 0:o.uid,mediaType:h}})}),_y=$(),Ey=$(),my=$(),fy=$(),gy=$(),Ty=$(),Sy=$(),Ry=$(),Cy=$(),Iy=$(),vy=$(),yy=$(),Ay=$(),by=$(),wy=$({argsMap:(e,r)=>[r]}),Oy=$(),Ny=$(),Dy=$(),Py=$(),ky=$(),Ly=$(),My=$(),Uy=$(),xy=$({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),Vy=$(),Fy=$(),By=$(),jy=$(),Gy=$(),Wy=$(),Hy=$({reportResult:!0}),Ky=$(),G=class extends Xt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let r;if(super(),T(this,"store",void 0),T(this,"_uid",void 0),T(this,"_channelName",void 0),T(this,"_uintUid",void 0),T(this,"_users",[]),T(this,"_config",void 0),T(this,"_clientId",void 0),T(this,"_appId",void 0),T(this,"_sessionId",null),T(this,"_key",void 0),T(this,"_rtmConfig",{}),T(this,"_joinInfo",void 0),T(this,"_gateway",void 0),T(this,"_statsCollector",void 0),T(this,"_configDistribute",void 0),T(this,"_leaveMutex",new ze("client-leave")),T(this,"_publishMutex",new ze("client-publish")),T(this,"_renewTokenMutex",new ze("client-renewtoken")),T(this,"_subscribeMutex",new ze("client-subscribe")),T(this,"_encryptionMode","none"),T(this,"_encryptionSecret",null),T(this,"_encryptionSalt",null),T(this,"_encryptDataStream",!1),T(this,"_encryptDataStreamKey",null),T(this,"_encryptDataStreamIv",null),T(this,"_proxyServer",void 0),T(this,"_turnServer",{servers:[],mode:"auto"}),T(this,"_cloudProxyServerMode","disabled"),T(this,"_isDualStreamEnabled",!1),T(this,"_defaultStreamFallbackType",void 0),T(this,"_lowStreamParameter",void 0),T(this,"_streamFallbackTypeCacheMap",new Map),T(this,"_remoteStreamTypeCacheMap",new Map),T(this,"_axiosCancelSource",mn.CancelToken.source()),T(this,"_audioVolumeIndicationInterval",void 0),T(this,"_networkQualityInterval",void 0),T(this,"_userOfflineTimeout",void 0),T(this,"_streamRemovedTimeout",void 0),T(this,"_liveTranscodeStreamingClient",void 0),T(this,"_liveRawStreamingClient",void 0),T(this,"_channelMediaRelayClient",void 0),T(this,"_networkQualitySensitivity","normal"),T(this,"_p2pChannel",void 0),T(this,"_useLocalAccessPoint",!1),T(this,"_setLocalAPVersion",void 0),T(this,"_joinAndNotLeaveYet",!1),T(this,"_numberOfJoinCount",0),T(this,"_remoteDefaultVideoStreamType",void 0),T(this,"_inspect",void 0),T(this,"_moderation",void 0),T(this,"_license",void 0),T(this,"_pendingPublishedUsers",[]),T(this,"ntpAlignErrorCount",0),T(this,"remoteInboundOffset",0),T(this,"_handleLocalTrackEnable",(i,o,h)=>{this.publish(i,!1).then(o).catch(h)}),T(this,"_handleLocalTrackDisable",(i,o,h)=>{this.unpublish(i).then(o).catch(h)}),T(this,"_handleUserOnline",i=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(i.uid,this.channelName))return void _.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&_.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let o=this._users.find(h=>h.uid===i.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(ut.USER_JOINED,o));else{let h=new ir(i.uid,i.uint_id||i.uid);this._users.push(h),_.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(ut.USER_JOINED,h)}}),T(this,"_handleUserOffline",i=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(i.uid,this.channelName))return;let o=this._users.find(h=>h.uid===i.uid);o&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:Wl(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),_.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(ut.USER_LEAVED,o,i.reason))}),T(this,"_handleAddAudioOrVideoStream",(i,o,h,p,g,C,A)=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(o,this.channelName))return;let x=this._users.find(cN=>cN.uid===o);if(!x)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(x.uid,i,void 0,void 0,void 0,Date.now());let _e=i==="audio"?x.hasAudio:x.hasVideo;x._uintid||(x._uintid=g||o),i==="audio"?x._trust_audio_stream_added_state_=!0:x._trust_video_stream_added_state_=!0,i==="audio"?(x._audio_added_=!0,h!==void 0&&(x._audioSSRC=h),p!==void 0&&(x._cname=p),C&&(x._audioOrtc=C)):(x._video_added_=!0,h!==void 0&&(x._videoSSRC=h),p!==void 0&&(x._cname=p),A!==void 0&&(x._rtxSsrcId=A),C&&(x._videoOrtc=C)),(i==="audio"?x.hasAudio:x.hasVideo)&&!_e&&(_.info("[".concat(this._clientId,"] remote user ").concat(x.uid," published ").concat(i)),this.safeEmit(ut.USER_PUBLISHED,x,i)),i==="video"?X.onGatewayStream(this._sessionId,De.ON_ADD_VIDEO_STREAM,Jt.ON_ADD_VIDEO_STREAM,{peer:g||o,ssrc:x._videoSSRC}):X.onGatewayStream(this._sessionId,De.ON_ADD_AUDIO_STREAM,Jt.ON_ADD_AUDIO_STREAM,{peer:g||o,ssrc:x._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(x,i,h).then(cN=>{if(cN&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(x.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Jd))return this._p2pChannel.unsubscribe(x,i,!0).then(()=>this._subscribe(x,i,!0).catch(dN=>{_.error("[".concat(this._clientId,"] resubscribe error"),dN.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(x,i)&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(x.uid," after reconnect.")),this._subscribe(x,i,!0).catch(cN=>{_.error("[".concat(this._clientId,"] resubscribe error"),cN.toString())}))}),T(this,"_handleRemoveStream",i=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(i.uid,this.channelName))return;let o=this._users.find(p=>p.uid===i.uid);if(!o)return void _.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));_.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let h=()=>{};o.hasAudio&&o.hasVideo?h=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(ut.USER_UNPUBLISHED,o,"audio"),_.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(ut.USER_UNPUBLISHED,o,"video")}:o.hasVideo?h=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(ut.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(h=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(ut.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof Jd&&this._p2pChannel.unsubscribe(o).then(p=>{if(p)return this._gateway.unsubscribe(p,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),X.onGatewayStream(this._sessionId,De.ON_REMOVE_STREAM,Jt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),h()}),T(this,"_handleSetStreamLocalEnable",(i,o,h)=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(o,this.channelName))return;let p=this._users.find(A=>A.uid===o);if(!p)return void _.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));_.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(h?"enabled":"disabled"," with uid ").concat(o));let g=i==="audio"?p.hasAudio:p.hasVideo;if(i==="audio"){p._trust_audio_enabled_state_=!0;let A=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===A)return;{let x=p._audio_enabled_?"enable-local-audio":"disable-local-audio";_.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(x)),this.safeEmit(ut.USER_INFO_UPDATED,o,x)}}else{p._trust_video_enabled_state_=!0;let A=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===A)return;{let x=p._video_enabled_?"enable-local-video":"disable-local-video";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(x)),this.safeEmit(ut.USER_INFO_UPDATED,o,x)}}let C=i==="audio"?p.hasAudio:p.hasVideo;return g!==C?!g&&C?(_.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(i)),void this.safeEmit(ut.USER_PUBLISHED,p,i)):(i==="video"&&p._videoTrack&&p._videoTrack._destroy(),i==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,i),_.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(i)),void this.safeEmit(ut.USER_UNPUBLISHED,p,i)):void 0}),T(this,"_handleMuteStream",(i,o,h)=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(i,this.channelName))return;_.debug("[".concat(this._clientId,"] receive mute message"),i,o,h);let p=this._users.find(A=>A.uid===i);if(!p)return void _.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let g=o==="audio"?p.hasAudio:p.hasVideo;if(o==="audio"){p._trust_audio_mute_state_=!0;let A=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===A)return;{let x=p._audio_muted_?"mute-audio":"unmute-audio";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(x)),this.safeEmit(ut.USER_INFO_UPDATED,i,x)}}else{p._trust_video_mute_state_=!0;let A=p._video_muted_;if(p._video_muted_=h,p._video_muted_===A)return;{let x=p._video_muted_?"mute-video":"unmute-video";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(x)),this.safeEmit(ut.USER_INFO_UPDATED,i,x)}}let C=o==="audio"?p.hasAudio:p.hasVideo;if(g!==C){if(!g&&C)return(o==="audio"?p._audioSSRC:p._videoSSRC)?(_.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(o)),void this.safeEmit(ut.USER_PUBLISHED,p,o)):void _.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),o==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,o),_.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(o)),this.safeEmit(ut.USER_UNPUBLISHED,p,o)}}),T(this,"_handleP2PLost",async i=>{_.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():_.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),T(this,"_handleTokenWillExpire",()=>{_.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ut.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),T(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),_.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),T(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ut.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ut.NETWORK_QUALITY,i)}),T(this,"_handleP2PAddAudioOrVideoStream",(i,o,h,p)=>{let g=this._users.find(A=>A.uid===o);if(!g)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(g.uid,i,void 0,void 0,void 0,Date.now());let C=i==="audio"?g.hasAudio:g.hasVideo;i==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,i==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),p!==void 0&&(g._audioMid=p)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),p!==void 0&&(g._videoMid=p)),(i==="audio"?g.hasAudio:g.hasVideo)&&!C&&(_.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(i)),this.safeEmit(ut.USER_PUBLISHED,g,i)),this._p2pChannel.hasPendingRemoteMedia(g,i)&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,i,!0).catch(A=>{_.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._config=e,this._clientId=Ut(5,"client-"),this.store=new ME(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),_.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ii," build: ").concat(Ef,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{fR(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(i){_.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new _u(this.store),this._statsCollector.onStatsException=(i,o,h)=>{_.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(o,", uid: ").concat(h)),this.safeEmit(ut.EXCEPTION,{code:i,msg:o,uid:h})},this._statsCollector.onUploadPublishDuration=(i,o,h,p)=>{let g=this._users.find(C=>C.uid===i);g&&X.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:o,videoPublishDuration:h,peer:g._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new tm(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ee,httpRetryConfig:e.httpRetryConfig||Ee,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new im,this.store.useP2P?(this._p2pChannel=new An(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Jd(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,h){let p=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],g=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ot("JOIN_GATEWAY_USE_443PORT_ONLY",p),Ot("JOIN_GATEWAY_USE_DUAL_DOMAIN",g);let C=this._gateway.signal.websocket;return C instanceof Nc&&(C.use443PortOnly=p,C.tryDoubleDomain=g),async function(A,x,_e){bd.get(A)||bd.set(A,[]),wd.get(A)||wd.set(A,x),Yi.get(A)||Yi.set(A,0);let cN=bd.get(A),dN=wd.get(A);if(!cN||!dN)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Yi.get(A)===dN){let IN=vc();cN.push(IN),await IN.promise}Yi.set(A,Yi.get(A)+1);for(var fN=arguments.length,mN=new Array(fN>3?fN-3:0),EN=3;EN<fN;EN++)mN[EN-3]=arguments[EN];let RN=await _e(...mN);return Yi.set(A,Yi.get(A)-1),Yi.get(A)===dN-1&&cN.length>0&&(cN[0].resolve(),cN.shift()),Yi.get(A)===0&&(bd.set(A,[]),wd.set(A,0),Yi.set(A,0)),RN}("client.join",v("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,h)}async join(e,r,i,o,h){let p=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);let g=(Nd||Nd||(Nd=(window.location.protocol.split(":")[0]||"").toUpperCase(),Nd))==="HTTPS",C=vR()?window.isSecureContext:"Browser Not Support";(!vR()&&!g||!window.isSecureContext)&&_.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),_.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),X.setAppId(e);try{if(!i&&i!==null)throw new O(R.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Pe(i,"token",1,2047),Pe(e,"appid",1,2047),Xu(r),o&&Qu(o),h&&Pe(h,"optionalInfo",1,2047)}catch(EN){throw X.reportApiInvoke(Ms(),{name:Te.JOIN,options:[e,r,i,o],states:{isHttps:g,isSecureContext:C},tag:Zt.TRACER}).onError(EN),EN}if(this._leaveMutex.isLocked&&(_.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),_.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let EN=new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw X.reportApiInvoke(Ms(),{name:Te.JOIN,options:[e,r,i,o],states:{isHttps:g,isSecureContext:C},tag:Zt.TRACER}).onError(EN),EN}this._gateway.state="CONNECTING";let A=await Xv({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let x=(A==null?void 0:A.sid)||Ms();_.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(p)),this._sessionId||(this._sessionId=x,this.store.sessionId=this._sessionId);let _e=X.reportApiInvoke(x,{name:Te.JOIN,options:[e,r,i,o],states:{isHttps:g,isSecureContext:C},tag:Zt.TRACER}),cN=xi(xi({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!A},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(cN.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(cN.stringUid=o,this._uintUid?(cN.uid=this._uintUid,this._uintUid=void 0):cN.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(cN.aesmode=this._encryptionMode,cN.aespassword=await(async EN=>{let RN=function(pH){let SH=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),vH=new Uint8Array(new ArrayBuffer(SH.length));for(let AH=0;AH<SH.length;AH+=1)vH[AH]=SH.charCodeAt(AH);return vH}(),IN=await window.crypto.subtle.importKey("spki",RN,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),t0=uf(EN),aH=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},IN,t0);return function(pH){let SH="";for(let vH=0;vH<pH.length;vH+=1)SH+=String.fromCharCode(pH[vH]);return window.btoa(SH)}(new Uint8Array(aH))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(cN.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let EN=new TextEncoder,RN=v("USE_PURE_ENCRYPTION_MASTER_KEY")?EN.encode(cN.appId+this._encryptionSecret+this._encryptionSecret):EN.encode(cN.appId+cN.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(IN,t0,aH){let pH=await window.crypto.subtle.importKey("raw",t0,"PBKDF2",!1,["deriveBits","deriveKey"]),SH=IN==="aes-128-gcm2"?128:256,vH=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:AR,hash:"SHA-256",salt:aH},pH,SH+TB);return new Uint8Array(vH).subarray(SH/8)}(this._encryptionMode,RN,Fo(this._encryptionSalt)),this._encryptDataStreamKey=await async function(IN,t0,aH){let pH=await window.crypto.subtle.importKey("raw",t0,"PBKDF2",!1,["deriveBits","deriveKey"]),SH=IN==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:AR,hash:"SHA-256",salt:aH},pH,{name:"AES-GCM",length:SH},!0,["encrypt","decrypt"])}(this._encryptionMode,RN,Fo(this._encryptionSalt))}else C?_.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):_.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,_.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:cN.stringUid});let dN=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&dN===this._sessionId&&X.joinChannelTimeout(this._sessionId,5)},5e3);try{var fN;let EN,RN=cN.cloudProxyServer;if(W(fN=["proxy3","proxy4","proxy5"]).call(fN,RN)){let SH=v("PROXY_SERVER_TYPE3");Array.isArray(SH)?cN.proxyServer=SH[0]:cN.proxyServer=SH}if(X.setProxyServer(cN.proxyServer),_.setProxyServer(cN.proxyServer),this.store.requestAPStart(),A){if(_.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(cN.stringUid?", ".concat(cN.stringUid," => ").concat(A.intUid):""," ")),cN.stringUid&&!cN.uid&&(cN.uid=A.intUid),EN={gatewayInfo:A.ap.gatewayInfo},v("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&cN.turnServer.mode==="auto")if(A.ap.proxyInfo.addresses.length===0)_.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let SH=(await kO(A.ap.proxyInfo,A.ap.gatewayInfo.uid)).map(vH=>({turnServerURL:vH.address,tcpport:vH.tcpport||Ve.tcpport,udpport:vH.udpport||Ve.udpport,username:vH.username||Ve.username,password:vH.password||Ve.password,forceturn:!1,security:!0}));cN.turnServer={mode:"manual",servers:SH}}Qv(A,cN.stringUid)}else{if(cN.stringUid&&!cN.uid){let SH;[SH,EN]=await j.all([h0(cN.stringUid,cN,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,this.store),tv(cN,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,!0,this.store)]),_.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(cN.stringUid," => ").concat(SH)),cN.uid=SH,EN.gatewayInfo.uid=SH,EN.gatewayInfo.res.uid=SH}else EN=await tv(cN,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,!0,this.store);if(!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(cN,this._axiosCancelSource.token),this._configDistribute.on(FE.UPDATE_BITRATE_LIMIT,SH=>{this._p2pChannel.updateBitrateLimit(SH)})},0),this._key=i||e;let IN=EN.gatewayInfo,t0=cN.uid?cN.uid:IN.uid;this._joinInfo=xi(xi({},cN),{},{cid:IN.cid,uid:t0,vid:IN.vid,apResponse:IN.res,apGatewayAddress:IN.apGatewayAddress,uni_lbs_ip:IN.uni_lbs_ip,gatewayAddrs:IN.gatewayAddrs}),this.store.intUid=t0;let aH=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_e.onSuccess(aH),this._appId=e,this._channelName=cN.cname,this._uid=aH,this.store.uid=aH,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(je()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let pH=cN.stringUid?"string uid: ".concat(cN.stringUid,",uid: ").concat(cN.uid):"uid: ".concat(this._uid);return _.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(pH)),setTimeout(()=>{_.startUpload()},5e3),this.store.joinEnd(),mN=this,W(Jr).call(Jr,mN)||Jr.push(mN),this._cloudProxyServerMode==="disabled"&&ft().supportWebCrypto&&v("ENABLE_PRELOAD")&&Df(this._joinInfo),aH}catch(EN){let RN=Array.isArray(EN)?EN[0]:EN;throw RN&&RN.code===R.OPERATION_ABORTED?_.warning("[".concat(this._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),RN):_.error("[".concat(this._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),RN),RN.code!==R.OPERATION_ABORTED&&this._numberOfJoinCount===p&&(this._gateway.state="DISCONNECTED",this._reset()),_e.onError(RN),RN}var mN}_joinGateway(){if(!this._joinInfo||!this._key)throw new O(R.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!v("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){_.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(je()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){let i=Jr.indexOf(r);i!==-1&&Jr.splice(i,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return _.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),_.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof no))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new O(R.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new O(R.INVALID_OPERATION,"audience can not publish stream");for(let h of i){if(!(h instanceof no))throw new O(R.INVALID_PARAMS,"parameter is not local track");if(!h._enabled&&r)throw new O(R.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(h.getTrackId()))}_.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(h=>"".concat(h.getTrackId()," "))));let o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(h=>{let p=this._configDistribute.getBitrateLimit();h instanceof Ft&&p&&h.setBitrateLimit(p.uplink)});try{await this._publishHighStream(i),_.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(h=>"".concat(h.getTrackId()," "))))}catch(h){throw _.error("[".concat(this._clientId,"] publish error"),h.toString()),h}finally{o()}}async _publishDataChannel(e){Nt(e.id,"id",0,65535,!0),Nr(e.ordered,"ordered"),Pe(e.metadata,"metadata",0,512),_.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(h=>h.id===e.id)!==-1)throw new O(R.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&v("FORCE_TURN")&&!v("TURN_ENABLE_TCP")&&!v("TURN_ENABLE_UDP"))throw new O(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=function(h){return Kv(h,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw _.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new O(R.CREATE_DATACHANNEL_ERROR);try{await j.all(o.map(h=>this._uid&&this._gateway.publishDataChannel(this._uid,h,!0))),await i._waitTillOpen()}catch(h){if(h.code!==R.DISCONNECT_P2P)throw h}}return _.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw _.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof no))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);_.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof An){let o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(ie.UNPUBLISH,{unpubMsg:o},!0)}else{let o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),_.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(h=>"".concat(h.getTrackId()))))}}catch(o){throw _.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),_.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let r=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),_.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw _.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof ir)){let o=this.remoteUsers.find(h=>h.uid===e);if(!o)throw new O(R.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(Ce(r,"mediaType",["audio","video"]),this._p2pChannel instanceof An)throw new O(R.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=r===Q.AUDIO,o=r===Q.VIDEO,h=await this._subscribeMutex.lock();try{let{ssrcId:p,ortc:g,rtxSsrcId:C,cname:A,uint_id:x}=await this._gateway.presubscribe(e,r,!0);if(p==null)throw new O(R.UNEXPECTED_RESPONSE,"no ssrc id");let _e=this._users.find(dN=>dN.uid===e);_e||(_e=new ir(e,x||e),_e._is_pre_created=!0,this._users.push(_e)),A&&(_e._cname=A),_e._uintid||(_e._uintid=x||e),i&&(_e._audioSSRC=p,_e._audio_pre_subscribed=!0,g&&(_e._audioOrtc=g)),o&&(_e._videoSSRC=p,_e._video_pre_subscribed=!0,g&&(_e._videoOrtc=g),C!=null&&(_e._rtxSsrcId=C)),_.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(p)),await this._p2pChannel.subscribe(_e,r,p,C,g);let cN=i?_e._audioTrack:_e._videoTrack;if(!cN)throw new O(R.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_e._trust_audio_stream_added_state_=!0,_e._audio_added_=!0),o&&(_e._trust_video_stream_added_state_=!0,_e._video_added_=!0),cN}catch(p){throw _.error("[".concat(this._clientId,"] presub user ").concat(e," error"),p),p}finally{h()}}async _subscribeDataChannel(e,r){var i;if(Nt(r,"channelId",0,65535,!0),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e))throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new O(R.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new O(R.INVALID_REMOTE_USER,"user is not published");let o=(i=e._dataChannels)===null||i===void 0?void 0:i.find(g=>g.id===r);if(!o)throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new O(R.REMOTE_USER_IS_NOT_PUBLISHED);let h=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let g=await this._p2pChannel.subscribeDataChannel(e,[o]);if(g&&W(g).call(g,o.id))try{var p;if(typeof o._originDataChannelId!="number")throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new O(R.CREATE_DATACHANNEL_ERROR);let C={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(p=o.metadata)!==null&&p!==void 0?p:""};await this._gateway.subscribeDataChannel(e.uid,C,!0),await o._waitTillOpen()}catch(C){if((C==null?void 0:C.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),C;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return _.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{h()}}async _p2pSubscribe(e,r,i){if(Ce(r,"mediaType",["audio","video"]),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e)){let h=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){let h=new O(R.INVALID_REMOTE_USER,"user is not published");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){let h=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),h}let o=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{let p=r==="audio"?e._audioSSRC:e._videoSSRC,g=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this._p2pChannel instanceof An&&await this._p2pChannel.subscribe(e,r,p,g)}catch(p){throw p}_.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(p=>{_.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});let h=r==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new O(R.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw _.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{o()}}async _subscribe(e,r,i){if(this._p2pChannel instanceof An)return this._p2pSubscribe(e,r);if(Ce(r,"mediaType",["audio","video"]),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(A=>A===e)){let A=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),A}if(!e.hasAudio&&!e.hasVideo){let A=new O(R.INVALID_REMOTE_USER,"user is not published");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),A}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let A=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),A}let o=r==="audio"?e._audioSSRC:e._videoSSRC,h=r==="audio"?e._audioOrtc:e._videoOrtc,p=r==="video"?e._rtxSsrcId:void 0,g={stream_type:r==="audio"?Q.AUDIO:Q.VIDEO,ssrcId:o},C=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{let x=r==="audio"?e._audioSSRC:e._videoSSRC;x!==void 0&&x!==o&&(o=x,h=r==="audio"?e._audioOrtc:e._videoOrtc,p=r==="video"?e._rtxSsrcId:void 0,g={stream_type:r==="audio"?Q.AUDIO:Q.VIDEO,ssrcId:o}),qe.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,o,p,h);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,g,!0)}catch(_e){if((_e==null?void 0:_e.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),_e;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(x){throw this._p2pChannel.reportSubscribeEvent(!1,x==null?void 0:x.code,e,r),x}_.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(x=>{_.warning("[".concat(this._clientId,"] auto set fallback failed"),x)});let A=r==="audio"?e._audioTrack:e._videoTrack;if(!A)throw new O(R.UNEXPECTED_ERROR,"can not find remote track in user object");return A}catch(A){throw _.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),A),A}finally{C()}}async massSubscribe(e){if(br(e,"subscribeList"),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(C=>{let{user:A,mediaType:x}=C;return"user: ".concat(A==null?void 0:A.uid,", mediaType: ").concat(x)}).join("; ")));let h=(e=[...e]).map(C=>{let{user:A,mediaType:x}=C;return{user:A,mediaType:x}}),p=await this._p2pChannel.globalLock();try{var g;for(let A=e.length-1;A>=0;A--){let x=e[A],{user:_e,mediaType:cN}=x;if(Ce(cN,"mediaType",["audio","video"]),!_e){let mN=new O(R.INVALID_PARAMS,"user property does not exist in subscribeList item");throw _.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),mN}if(!this._users.find(mN=>mN===_e)){let mN=new O(R.INVALID_REMOTE_USER,"user is not in the channel");_.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_e.uid,", this user is not in the channel")),h[A].error=mN,e.splice(A,1);continue}if(cN==="audio"&&(!_e.hasAudio||_e._audioSSRC===void 0)||cN==="video"&&(!_e.hasVideo||_e._videoSSRC===void 0)){let mN=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);_.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid," with mediaType ").concat(cN,", remote user is not published")),h[A].error=mN,e.splice(A,1);continue}let dN=ve.Video|ve.LwoVideo,fN=i.get(_e);if(fN){if(cN==="video"?fN&dN:fN&ve.Audio){e.splice(A,1),_.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_e.uid,", mediaType:").concat(cN," twice"));continue}i.set(_e,fN|(cN==="video"?dN:ve.Audio))}else i.set(_e,cN==="video"?dN:ve.Audio)}for(let A=e.length-1;A>=0;A--){let x=e[A],{user:_e,mediaType:cN}=x,dN=ve.Video|ve.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_e,cN)){await this._p2pChannel.unmuteRemoteNoLock(_e,cN);let fN=i.get(_e);i.set(_e,cN==="video"?fN^dN:fN^ve.Audio),e.splice(A,1)}}this.store.massSubscribe(e.map(A=>({userId:A.user.uid,type:A.mediaType})),r);let C=ji(g=Array.from(i.entries())).call(g,(A,x)=>{let[_e,cN]=x;if(cN===0)return A;let dN={stream_id:_e.uid,stream_type:cN};return cN&ve.Audio&&(dN.audio_ssrc=_e._audioSSRC),cN&ve.Video&&(dN.video_ssrc=_e._videoSSRC),A.push(dN),A},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(x=>{let{user:_e,mediaType:cN}=x;return{user:_e,mediaType:cN,ssrcId:cN===Q.VIDEO?_e._videoSSRC:_e._audioSSRC,rtxSsrcId:cN===Q.VIDEO?_e._rtxSsrcId:void 0}}));let A=new Map;if(C=C.filter(x=>x.video_ssrc&&!this._p2pChannel.isPreSubScribe(x.video_ssrc)||x.audio_ssrc&&!this._p2pChannel.isPreSubScribe(x.audio_ssrc)||!x.video_ssrc&&!x.audio_ssrc),C.length>0){let x=await this._gateway.subscribeAll(C,!0);((x==null?void 0:x.users)||[]).forEach(_e=>{let{stream_id:cN,video_error_code:dN,audio_error_code:fN,error_code:mN}=_e;(dN||fN||mN)&&A.set(cN,{video_error_code:dN,audio_error_code:fN,error_code:mN})})}if(Array.from(A.entries()).length>0){let x=[];Array.from(A.entries()).forEach(_e=>{let[cN,dN]=_e,fN=this.remoteUsers.find(mN=>mN.uid===cN);if(fN){let mN;dN.error_code||dN.video_error_code&&dN.audio_error_code?mN=void 0:dN.video_error_code?mN=Q.VIDEO:dN.audio_error_code&&(mN=Q.AUDIO),x.push({user:fN,mediaType:mN})}}),x.length>0&&await this._p2pChannel.massUnsubscribeNoLock(x)}for(let x of h){let _e=A.get(x.user.uid);if(_e){let cN=_e.error_code||x.mediaType==="audio"&&_e.audio_error_code||x.mediaType==="video"&&_e.video_error_code;if(cN){let dN=Oc(cN);_.error("user:".concat(x.user.uid," mediaType:").concat(x.mediaType," has massSubscribe error ").concat(dN.desc)),x.error=new O(R.SUBSCRIBE_FAILED,"code ".concat(cN,": ").concat(dN.desc))}}x.error||(x.mediaType==="video"?x.track=x.user.videoTrack:x.track=x.user.audioTrack)}return this.store.massSubscribe(h.filter(x=>!x.error).map(x=>({userId:x.user.uid,type:x.mediaType})),void 0,Date.now()),h.forEach(x=>{var _e;X.subscribe(this.store.sessionId,{succ:!!x.error,ec:((_e=x.error)===null||_e===void 0?void 0:_e.code)||null,video:x.mediaType===Q.VIDEO,audio:x.mediaType===Q.AUDIO,peerid:x.user.uid,subscribeRequestid:x.mediaType===Q.VIDEO?x.user._videoSSRC:x.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(x.user._videoSSRC)},!0)}),_.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(x=>{let{user:_e,mediaType:cN}=x;return"user: ".concat(_e==null?void 0:_e.uid,", mediaType: ").concat(cN)}).join("; "))),h}catch(A){throw await this._p2pChannel.massUnsubscribeNoLock(e),A}}finally{p(),o()}}async unsubscribe(e,r,i){if(!(e instanceof ir)){let h=this.remoteUsers.find(p=>p.uid===e);if(!h)throw new O(R.INVALID_REMOTE_USER,"user is not in the channel");e=h}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&Ce(r,"mediaType",["audio","video"]),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(h=>h===e)){let h=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),h}_.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));let o=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof An)await this._p2pChannel.unsubscribe(e,r);else{let h=await this._p2pChannel.unsubscribe(e,r);h&&await this._gateway.unsubscribe(h,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Wl(this._users,e),_.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===R.DISCONNECT_P2P)return void _.warning("disconnecting p2p, abort unsubscribe request.");throw _.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),h.toString()),h}finally{o()}}async _unsubscribeDataChannel(e,r){if(r&&Nt(r,"id",0,65535,!0),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){let o=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let i;if(typeof r=="number"){let o=e._dataChannels.find(h=>h.id===r);o&&(i=[o])}else i=e._dataChannels;if(i===void 0){let o=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),o}_.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{let o=await this._p2pChannel.unsubscribeDataChannel(e,i);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),_.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===R.DISCONNECT_P2P)return void _.warning("disconnecting p2p, abort unsubscribe request.");throw _.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(br(e,"unsubscribeList"),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");_.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:h}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(h,";")}).join())),e=[...e];let r=new Map;for(let i=e.length-1;i>=0;i--){let{user:o,mediaType:h}=e[i];if(!o){let g=new O(R.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw _.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),g}if(Ce(h,"mediaType",["video","audio",void 0]),!this._users.find(g=>g===o)){_.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}let p=ve.Video|ve.LwoVideo;if(r.has(o)){let g=r.get(o),C;switch(h){case"video":C=g&p;break;case"audio":C=g&ve.Audio;break;default:C=g&(ve.Audio|p)}if(C){_.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(h," twice.")),e.splice(i,1);continue}h?h==="audio"?r.set(o,g|ve.Audio):h==="video"&&r.set(o,g|p):r.set(o,g|ve.Audio|p)}else h?h==="audio"?r.set(o,ve.Audio):h==="video"&&r.set(o,p):r.set(o,ve.Audio|p)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),_.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:h,mediaType:p}=o;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(p,";")}).join()))}catch(i){if(i.code===R.DISCONNECT_P2P)return void _.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw _.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new N(R.INVALID_PARAMS);zt(i.width)||bp(i.width,"streamParameter.width"),zt(i.height)||bp(i.height,"streamParameter.height"),zt(i.framerate)||bp(i.framerate,"streamParameter.framerate"),zt(i.bitrate)||Nt(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&_.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),_.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,U.LocalVideoLowTrack)}async enableDualStream(){if(!ft().supportDualStream)throw X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new O(R.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new O(R.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),_.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(U.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),_.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(i){Ce(i,"role",["audience","host"])}(e),r&&fR(r),this.mode==="rtc"||this.mode==="p2p")throw _.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new O(R.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new O(R.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new O(R.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,r),this._config.role=e,_.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}getRemoteInboundOffset(){var e;let r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;let i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(Pe(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new O(R.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,X.setProxyServer(this._proxyServer),_.setProxyServer(this._proxyServer),_.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new O(R.INVALID_OPERATION,"You have already set the proxy")}if(Yu(e))return this._turnServer={servers:e,mode:"original-manual"},void _.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>vO(i)),this._turnServer={servers:e,mode:"manual"},_.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"you should set license before join channel");if(Pe(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new O(R.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,_.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new O(R.INVALID_OPERATION,"You have already set the proxy");let r=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new O(R.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new O(R.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,_.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Stop proxy server after leave channel");X.setProxyServer(),_.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",_.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new O(R.INVALID_PARAMS,"accessPoints is required.");br(e.accessPoints.serverList,"accessPoints.serverList"),Pe(e.accessPoints.domain,"accessPoints.domain");let r=(dN,fN)=>{Nt(dN,fN,0,65535,!0)},i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new O(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");v("CLOSE_AFB_FOR_LOCAL_AP")&&(Ot("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ot("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,h=e.accessPoints.domain,p=e.accessPoints.serverList.map(dN=>o.test(dN)?"".concat(dN.replace(/\./g,"-"),".").concat(h):dN),g=p.map(dN=>"".concat(dN,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ot("WEBCS_DOMAIN",g),Ot("WEBCS_DOMAIN_BACKUP_LIST",g),Ot("GATEWAY_DOMAINS",[h]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(br(e.report.hostname,"report.hostname"),Ot("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Ot("EVENT_REPORT_DOMAIN",p[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",p[1]||p[0]));let C=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),C=e.report.port),Ot("STATS_COLLECTOR_PORT",C),e.report?Ot("ENABLE_EVENT_REPORT",!0):Ot("ENABLE_EVENT_REPORT",!1);let A="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(br(e.log.hostname,"log.hostname"),A=e.log.hostname[0]):A=p[0];let x=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),x=e.log.port),Ot("LOG_UPLOAD_SERVER","".concat(A,":").concat(x));let _e=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(br(e.cds.hostname,"cds.hostname"),_e=e.cds.hostname):_e=p;let cN=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),cN=e.cds.port),Ot("CDS_AP",_e.map(dN=>"".concat(dN,":").concat(cN))),e.cds?Ot("ENABLE_CONFIG_DISTRIBUTE",!0):Ot("ENABLE_CONFIG_DISTRIBUTE",!1),_.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(br(e,"serverList"),Pe(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new O(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ot("WEBCS_DOMAIN",e),Ot("WEBCS_DOMAIN_BACKUP_LIST",e),Ot("GATEWAY_DOMAINS",[r]),Ot("EVENT_REPORT_DOMAIN",e[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Ot("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),_.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ce(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw _.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else _.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Ce(r,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{let i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw _.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}_.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Ce(r,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw _.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}_.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(p){Ce(p,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Pe(r,"secret");let h=["aes-128-gcm2","aes-256-gcm2"];if(W(h).call(h,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new O(R.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new O(R.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Nr(o,"encryptDataStream"),!W(h).call(h,e))throw new O(R.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||_.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=so(i))}async renewToken(e){if(Pe(e,"token",1,2047),!this._key||!this._joinInfo)throw new O(R.INVALID_OPERATION,"renewToken should not be called before user join");let r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if(v("USE_NEW_TOKEN")){_.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let o=await JG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee);_.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else _.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});_.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,_.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?_.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(ut.VOLUME_INDICATOR,e)},v("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new O(R.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new O(R.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new O(R.LIVE_STREAMING_TASK_CONFLICT);let i=r?er.TRANSCODE:er.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(er.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new O(R.INVALID_PARAMS,"can not find live streaming url to stop");await j.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){Pv(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Pv(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let h=new TextEncoder;e.payload=h.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&W(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(h,p,g){var C;let A=ji(C=Array.from(g)).call(C,(EN,RN)=>EN+RN,0),x={serverTs:0,seq:SB++,length:g.length,checkSum:A},_e=new Uint8Array(IR(A,2)),cN=new ArrayBuffer(us),dN=new DataView(cN);dN.setUint32(0,x.serverTs),dN.setUint16(4,x.seq),dN.setUint16(6,x.length),dN.setUint16(8,x.checkSum);let fN=16-g.length%16;g=TR(g,new Uint8Array(fN));let mN=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h,tagLength:yR,additionalData:_e},p,g);return TR(new Uint8Array(cN),new Uint8Array(mN))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new O(R.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(et.DATA_STREAM,{payload:so(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-EW},!i)}sendMetadata(e){if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new O(R.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(et.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:so(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(RB),!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not send custom report, not joined");await X.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Ce(r.spatialLayer,"spatialLayer",[0,1,2,3]),Ce(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw _.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:r=!1,rtmFlag:i}=e;if(Nr(r,"apRTM"),Nt(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,_.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(_.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=mn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&b0(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ze("client-publish"),this._subscribeMutex=new ze("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;let o=e||Ms();e?_.debug("[".concat(this._clientId,"] new Session ").concat(o)):_.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));let h=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o;let p={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:h,clientRole:this.role==="audience"?2:1};X.sessionInit(this._sessionId,xi({cname:r.channel,appid:r.appId},p)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&v("FORCE_TURN")&&!v("TURN_ENABLE_TCP")&&!v("TURN_ENABLE_UDP"))throw new O(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");_.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof An){let o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(ie.PUBLISH,o,!0)}catch(h){throw i.throw(h),h}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let o=(await i.next()).value;if(o){var r;let h;try{h=await this._gateway.publish(this._uid,o,!0)}catch(p){if(p.code!==R.DISCONNECT_P2P)throw i.throw(p),p}await i.next(((r=h)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let h of e)h instanceof Ft&&h._encoderConfig&&this._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||await this._p2pChannel.muteLocalTrack(h)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===R.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));_.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let h;try{h=await this._gateway.publish(this._uid,o,!0)}catch(p){if(p.code!==R.DISCONNECT_P2P)throw i.throw(p),p}i.next(((r=h)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===R.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){let r=()=>{if(!this._joinInfo||!this._appId)return new O(R.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Za("LiveStreaming").create(o));var o;return i.onLiveStreamError=(h,p)=>{X.reportApiInvoke(this._sessionId,{name:Te.ON_LIVE_STREAM_ERROR,options:[h,p],tag:Zt.TRACER}).onSuccess(),this.safeEmit(ut.LIVE_STREAMING_ERROR,h,p)},i.onLiveStreamWarning=(h,p)=>{X.reportApiInvoke(this._sessionId,{name:Te.ON_LIVE_STREAM_WARNING,options:[h,p],tag:Zt.TRACER}).onSuccess(),this.safeEmit(ut.LIVE_STREAMING_WARNING,h,p)},i.on(VE.REQUEST_WORKER_MANAGER_LIST,(h,p,g)=>{if(!this._joinInfo)return g(new O(R.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(C,A,x,_e){let cN=v("UAP_AP").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(dN=>A.proxyServer?"https://".concat(A.proxyServer,"/ap/?url=").concat(dN+"/api/v1?action=uap"):"https://".concat(dN,"/api/v1?action=uap"));return await WG(cN,C,A,x,_e)})(h,this._joinInfo,this._axiosCancelSource.token,Ee).then(p).catch(g)}),i};return e===er.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new O(R.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Za("ChannelMediaRelay").create(e));o.on("state",h=>{h===Sn.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(ut.CHANNEL_MEDIA_RELAY_STATE,h)}),o.on("event",h=>{this.safeEmit(ut.CHANNEL_MEDIA_RELAY_EVENT,h)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(h,p)=>{var g;h==="resolution"&&((g=this._channelMediaRelayClient)===null||g===void 0||g.setVideoProfile(p))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){let{added:i,deleted:o}=e,h=[];if(r){let p=[];this._users.forEach(g=>{g._dataChannels.forEach(C=>{i.every(A=>A.uid!==g._uintid||A.stream_id!==C.id)&&p.push({uid:g._uintid,stream_id:C.id,ordered:C.ordered,max_retrans_times:C.maxRetransmits,metadata:C.metadata})})}),p.length>0&&this._handleUpdateDataChannel({added:[],deleted:p})}Array.isArray(i)&&i.length>0&&i.forEach(p=>{let{uid:g,stream_id:C,ordered:A,max_retrans_times:x,metadata:_e}=p,cN=this._users.find(dN=>dN._uintid===g);if(!cN)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(_.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(g)),W(h).call(h,cN)||h.push(cN),cN._uintid||(cN._uintid=g),cN._dataChannels.findIndex(dN=>dN.id===p.stream_id)===-1){let dN={id:C,ordered:!!A,maxRetransmits:x,metadata:_e},fN=function(mN){return Kv(mN,!0)}(dN);cN._dataChannels.push(fN),_.info("[".concat(this._clientId,"] remote user ").concat(cN.uid," published datachannel")),r||this.safeEmit(ut.USER_PUBLISHED,cN,"datachannel",dN)}this._p2pChannel.hasPendingRemoteDataChannel(cN,p.stream_id)&&(_.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(cN.uid," after reconnect.")),this._subscribeDataChannel(cN,p.stream_id).catch(dN=>{_.error("[".concat(this._clientId,"] resubscribe datachannel error"),dN.toString())}))}),r&&(this.safeEmit(ut.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(p=>{let{uid:g,stream_id:C}=p,A=this._users.find(_e=>_e._uintid===g);if(!A)return void _.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let x=A._dataChannels.find(_e=>_e.id===p.stream_id);x&&(_.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(g)),this._p2pChannel.unsubscribeDataChannel(A,[x]).then(_e=>{if(A._dataChannels=A._dataChannels.filter(cN=>cN!==x),_e)return this._gateway.unsubscribeDataChannel(_e,A.uid)}),_.info("[".concat(this._clientId,"] remote user ").concat(g," unpublished datachannel ,id:").concat(x.id)),this.safeEmit(ut.USER_UNPUBLISHED,A,"datachannel",x._config))})}_handleRemoveDataChannels(e){let r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){_.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(ut.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else _.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(xe.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(xe.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===At.FALLBACK)return;let h=()=>{this.safeEmit(ut.CONNECTION_STATE_CHANGE,e,r,i)};if(X.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Te.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:Zt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),_.info("[".concat(this._clientId,"] connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void h();if(e==="RECONNECTING")this._users.forEach(g=>{g._trust_in_room_=!1,g._trust_audio_enabled_state_=!1,g._trust_video_enabled_state_=!1,g._trust_audio_mute_state_=!1,g._trust_video_mute_state_=!1,g._trust_audio_stream_added_state_=!1,g._trust_video_stream_added_state_=!1,g._is_pre_created||(g._audio_pre_subscribed||(g._audioSSRC=void 0,g._audioOrtc=void 0),g._video_pre_subscribed||(g._videoSSRC=void 0,g._videoOrtc=void 0,g._rtxSsrcId=void 0),g._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var p;this._streamFallbackTypeCacheMap.forEach((g,C)=>{this._gateway.setStreamFallbackOption(C,g).catch(A=>{_.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),A)})}),this._remoteStreamTypeCacheMap.forEach((g,C)=>{this._gateway.setRemoteVideoStreamType(C,g).catch(A=>{_.warning("[".concat(this._clientId,"] auto set remote stream type failed"),A)})}),this._remoteDefaultVideoStreamType!==void 0&&((p=this._joinInfo)===null||p===void 0?void 0:p.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{_.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(g=>{_.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(g))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(g=>!g._trust_in_room_).forEach(g=>{_.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(g.uid)),this._handleUserOffline({uid:g.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(g=>{g._trust_audio_mute_state_||(_.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(g.uid)),this._handleMuteStream(g.uid,Q.AUDIO,!1)),g._trust_video_mute_state_||(_.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(g.uid)),this._handleMuteStream(g.uid,Q.VIDEO,!1)),g._trust_audio_enabled_state_||(_.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(g.uid)),this._handleSetStreamLocalEnable("audio",g.uid,!0)),g._trust_video_enabled_state_||(_.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(g.uid)),this._handleSetStreamLocalEnable("video",g.uid,!0)),g._trust_video_stream_added_state_||(_.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(g.uid)),this._handleResetAddStream(g,"video")),g._trust_audio_stream_added_state_||(_.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(g.uid)),this._handleResetAddStream(g,"audio")),g._video_added_||g._audio_added_||(_.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(g.uid)),this._handleRemoveStream({uid:g.uid,uint_id:g._uintid}))}))},1e3))}h()}),this._gateway.on(xe.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new O(R.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i,o=await Xv(xi(xi({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,Qv(o),this._joinInfo.preload=!0):(i=await nm(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let h=[];i.gatewayInfo.gatewayAddrs.forEach(p=>{let{address:g}=p,[C,A]=g.split(":");this._joinInfo&&this._joinInfo.proxyServer?h.push({proxy:this._joinInfo.proxyServer,host:C,port:A}):h.push({host:C,port:A})}),e(h)}catch(i){r(i)}}),this._gateway.on(xe.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ut.NETWORK_QUALITY,e)}),this._gateway.on(xe.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(ut.STREAM_TYPE_CHANGED,e,r),X.reportApiInvoke(this._sessionId,{name:Te.STREAM_TYPE_CHANGE,options:[e,r],tag:Zt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(xe.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(xe.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();v("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(xe.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i=qI(e.ortc,r,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(i)}),this._gateway.on(xe.PRE_CONNECT_PC,async e=>{let{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:h,cid:p}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(p,"_").concat(h),icePwd:"".concat(p,"_").concat(h)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=v("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(dt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(dt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(dt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(dt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(dt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(dt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(dt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(dt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(dt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Q.AUDIO,!0)),this._gateway.signal.on(dt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Q.AUDIO,!1)),this._gateway.signal.on(dt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Q.VIDEO,!0)),this._gateway.signal.on(dt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Q.VIDEO,!1)),this._gateway.signal.on(dt.RECEIVE_METADATA,e=>{let r=Fo(e.metadata);this.safeEmit(ut.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(dt.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=Fo(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&W(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<us)throw new O(R.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(us));i=await async function(h,p,g){let C=g.subarray(0,us),A=C.slice(8,us),x=(A[0]<<8)+A[1],_e=(C[6]<<8)+C[7],cN=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:h,tagLength:yR,additionalData:new Uint8Array(IR(x,2))},p,g.subarray(us));return new Uint8Array(cN).subarray(0,_e)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){let h=this._p2pChannel.getStats(),p=this.remoteUsers.find(C=>C.uid===e.uid),g=h==null?void 0:h.audioRecv.find(C=>C.ssrc===(p==null?void 0:p._audioSSRC));o=g==null?void 0:g.jitterBufferMs}o==null&&(o=0),fW(xi(xi({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(dt.ON_CRYPT_ERROR,()=>{po(()=>{_.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ut.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(dt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{_.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,At.TOKEN_EXPIRE),this.safeEmit(ut.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(dt.ON_STREAM_FALLBACK_UPDATE,e=>{_.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(ut.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(dt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),_.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(dt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(dt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(nt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case et.PUBLISH:{if(!r)return;let h=r.ortc;if(h){var i,o;let p=h.some(A=>{let{stream_type:x}=A;return x===Ct.Audio}),g=h.some(A=>{let{stream_type:x}=A;return x!==Ct.Audio}),C=h.some(A=>{let{stream_type:x}=A;return x===Ct.Screen||x===Ct.ScreenLow});r.state==="offer"&&X.publish(this._joinInfo.sid,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:R.TIMEOUT,audio:p,video:g,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:C,audioName:p?(i=h.find(A=>{let{stream_type:x}=A;return x===Ct.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:g?(o=h.find(A=>{let{stream_type:x}=A;return x!==Ct.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case et.SUBSCRIBE:r&&X.subscribe(this._joinInfo.sid,{succ:!1,ec:R.TIMEOUT,audio:r.stream_type===Q.AUDIO,video:r.stream_type===Q.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:qe.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(dt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(dt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;v("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!Io(o.string_id||o.stream_id,this.channelName)));let r=[],i=[];for(let o of e.users){let h=this._users.find(_e=>_e._uintid===o.stream_id);h?h._trust_in_room_=!0:(h=new ir(o.string_id||o.stream_id,o.stream_id),this._users.push(h),this.getListeners(ut.PUBLISHED_USER_LIST).length===0&&(_.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(ut.USER_JOINED,h)));let p=ve.Audio&o.stream_type,g=(ve.Video|ve.LwoVideo)&o.stream_type,C=(65280&o.stream_type)!=0,A=p&&h.hasAudio,x=g&&h.hasVideo;g&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=o.video_ssrc,h._rtxSsrcId=o.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=o.audio_ssrc),p&&!A&&this.getListeners(ut.PUBLISHED_USER_LIST).length===0&&(_.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(ut.USER_PUBLISHED,h,"audio")),g&&!x&&this.getListeners(ut.PUBLISHED_USER_LIST).length===0&&(_.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(ut.USER_PUBLISHED,h,"video")),(p&&!A||g&&!x||C)&&r.push(h),g&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&i.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&i.push({user:h,mediaType:"audio"})}i.length>0&&(_.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{_.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(ut.PUBLISHED_USER_LIST).length>0?v("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(_.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(ut.PUBLISHED_USER_LIST,r)):_.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(dt.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:r}=e;this._p2pChannel instanceof Jd&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return W(o=Object.keys(Ju)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(dt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ie.PUBLISH,(e,r,i)=>{let{uid:o}=e;e.forEach(h=>{let{kind:p,ssrcs:g,mid:C,isMuted:A}=h;this._handleP2PAddAudioOrVideoStream(p,o,g[0].ssrcId,C);let x=this._users.find(_e=>_e.uid===o);return x&&this._p2pChannel instanceof An?this._p2pChannel.mockSubscribe(x,p,g[0].ssrcId,C).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,p,!!A)})}),this._gateway.signal.on(ie.CALL,async(e,r,i)=>{if(this._p2pChannel instanceof An)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(h){i(h)}}),this._gateway.signal.on(nt.P2P_CONNECTION,async e=>{this._p2pChannel instanceof An&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(ie.UNPUBLISH,async(e,r,i)=>{if(this._p2pChannel instanceof An){let{unpubMsg:o,uid:h}=e,p=this._users.find(g=>g.uid===h);if(!p)return _.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(h)),void r();try{o.forEach(async g=>{let{stream_type:C}=g,A=C===Ct.Audio?Q.AUDIO:Q.VIDEO;await this._p2pChannel.unsubscribe(p,A),this._handleMuteStream(h,A,!0)}),r()}catch(g){i(g)}}}),this._gateway.signal.on(ie.CONTROL,async(e,r)=>{let{action:i}=e;switch(i){case to.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Q.VIDEO,!0);break;case to.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Q.AUDIO,!0);break;case to.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Q.VIDEO,!1);break;case to.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Q.AUDIO,!1)}}),this._gateway.signal.on(ie.RESTART_ICE,async(e,r,i)=>{if(this._p2pChannel instanceof An)try{let{direction:o,iceParameter:h}=e;o!==cn.SEND_ONLY||h?r(await this._p2pChannel.restartICE(o,h)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(ie.CANDIDATE,e=>{if(this._p2pChannel instanceof An){let{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(tt.RequestP2PRestartICE,async(e,r,i)=>{try{let{direction:o}=e;r(await this._gateway.sendExtensionMessage(ie.RESTART_ICE,e,o===cn.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(tt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ie.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(tt.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(ie.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(tt.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===R.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(tt.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===R.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(tt.StateChange,(e,r)=>{r===Rt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(tt.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===R.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(tt.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===R.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(tt.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(tt.RequestRePublishDataChannel,(e,r,i)=>{j.all(e.map(async o=>{let h=await this._p2pChannel.publishDataChannel([o]);try{h.forEach(p=>{this._uid&&this._gateway.publishDataChannel(this._uid,p,!0)})}catch(p){if(p.code!==R.DISCONNECT_P2P)throw p}})).then(r).catch(i)}),this._p2pChannel.on(tt.RequestReSubscribe,async(e,r,i)=>{try{for(let{user:o,kind:h}of e)h===Q.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(tt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(tt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(tt.MediaReconnectStart,e=>{this.safeEmit(ut.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(tt.MediaReconnectEnd,e=>{this.safeEmit(ut.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(tt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(tt.RequestRestartICE,async e=>{if(this._p2pChannel instanceof An)return;let r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;let o=i.value,h;try{h=await this._gateway.restartICE({iceParameters:o})}catch(g){return void r.throw(g)}let{iceParameters:p}=function(g){let C=g.iceParameters;return{iceParameters:{iceUfrag:C.iceUfrag,icePwd:C.icePwd}}}(h);await r.next({remoteIceParameters:p})}),this._p2pChannel.on(tt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(tt.RequestReconnectPC,async()=>{var e;let{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),g=qI(h,p);await this._p2pChannel.connect(g),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(tt.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(tt.P2PLost,()=>{this.safeEmit(ut.P2P_LOST,this.store.uid)}),this._p2pChannel.on(tt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(tt.ConnectionTypeChange,e=>{this.safeEmit(ut.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(tt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(tt.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let i=(r={config:e},Za("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);let{appId:o,cname:h,sid:p,token:g,uid:C,cid:A,vid:x}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:h,sid:p,token:g,uid:C,cid:A,vid:x?Number(x):0},Ee)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(we.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(ut.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===Ei.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ut.CONTENT_INSPECT_ERROR,new O(R.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(we.INSPECT_RESULT,(r,i)=>{var o;if((i==null?void 0:i.code)===R.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return _.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(ut.CONTENT_INSPECT_RESULT,r,i)}),e.on(we.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(Nr(e,"enabled"),e){if(!r)throw new O(R.INVALID_PARAMS,"config is required");if(k0(r),!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{let o=(i={config:r},Za("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);let{appId:h,cname:p,sid:g,token:C,uid:A,cid:x,vid:_e}=this._joinInfo;await o.init({appId:h,areaCode:"",cname:p,sid:g,token:C,uid:A,cid:x,vid:_e?Number(_e):0},Ee)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Mi.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(ut.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===Xn.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new O(R.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Mi.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Ce(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new O(R.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,_.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return _.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Nr(e,"enabled"),Ot("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},q(G.prototype,"leave",[sy],Object.getOwnPropertyDescriptor(G.prototype,"leave"),G.prototype),q(G.prototype,"publish",[ay],Object.getOwnPropertyDescriptor(G.prototype,"publish"),G.prototype),q(G.prototype,"unpublish",[cy],Object.getOwnPropertyDescriptor(G.prototype,"unpublish"),G.prototype),q(G.prototype,"subscribe",[dy],Object.getOwnPropertyDescriptor(G.prototype,"subscribe"),G.prototype),q(G.prototype,"presubscribe",[ly],Object.getOwnPropertyDescriptor(G.prototype,"presubscribe"),G.prototype),q(G.prototype,"massSubscribe",[uy],Object.getOwnPropertyDescriptor(G.prototype,"massSubscribe"),G.prototype),q(G.prototype,"unsubscribe",[hy],Object.getOwnPropertyDescriptor(G.prototype,"unsubscribe"),G.prototype),q(G.prototype,"massUnsubscribe",[py],Object.getOwnPropertyDescriptor(G.prototype,"massUnsubscribe"),G.prototype),q(G.prototype,"setLowStreamParameter",[_y],Object.getOwnPropertyDescriptor(G.prototype,"setLowStreamParameter"),G.prototype),q(G.prototype,"enableDualStream",[Ey],Object.getOwnPropertyDescriptor(G.prototype,"enableDualStream"),G.prototype),q(G.prototype,"disableDualStream",[my],Object.getOwnPropertyDescriptor(G.prototype,"disableDualStream"),G.prototype),q(G.prototype,"setClientRole",[fy],Object.getOwnPropertyDescriptor(G.prototype,"setClientRole"),G.prototype),q(G.prototype,"setProxyServer",[gy],Object.getOwnPropertyDescriptor(G.prototype,"setProxyServer"),G.prototype),q(G.prototype,"setTurnServer",[Ty],Object.getOwnPropertyDescriptor(G.prototype,"setTurnServer"),G.prototype),q(G.prototype,"setLicense",[Sy],Object.getOwnPropertyDescriptor(G.prototype,"setLicense"),G.prototype),q(G.prototype,"startProxyServer",[Ry],Object.getOwnPropertyDescriptor(G.prototype,"startProxyServer"),G.prototype),q(G.prototype,"stopProxyServer",[Cy],Object.getOwnPropertyDescriptor(G.prototype,"stopProxyServer"),G.prototype),q(G.prototype,"setLocalAccessPointsV2",[Iy],Object.getOwnPropertyDescriptor(G.prototype,"setLocalAccessPointsV2"),G.prototype),q(G.prototype,"setLocalAccessPoints",[vy],Object.getOwnPropertyDescriptor(G.prototype,"setLocalAccessPoints"),G.prototype),q(G.prototype,"setRemoteDefaultVideoStreamType",[yy],Object.getOwnPropertyDescriptor(G.prototype,"setRemoteDefaultVideoStreamType"),G.prototype),q(G.prototype,"setRemoteVideoStreamType",[Ay],Object.getOwnPropertyDescriptor(G.prototype,"setRemoteVideoStreamType"),G.prototype),q(G.prototype,"setStreamFallbackOption",[by],Object.getOwnPropertyDescriptor(G.prototype,"setStreamFallbackOption"),G.prototype),q(G.prototype,"setEncryptionConfig",[wy],Object.getOwnPropertyDescriptor(G.prototype,"setEncryptionConfig"),G.prototype),q(G.prototype,"renewToken",[Oy],Object.getOwnPropertyDescriptor(G.prototype,"renewToken"),G.prototype),q(G.prototype,"enableAudioVolumeIndicator",[Ny],Object.getOwnPropertyDescriptor(G.prototype,"enableAudioVolumeIndicator"),G.prototype),q(G.prototype,"startLiveStreaming",[Dy],Object.getOwnPropertyDescriptor(G.prototype,"startLiveStreaming"),G.prototype),q(G.prototype,"setLiveTranscoding",[Py],Object.getOwnPropertyDescriptor(G.prototype,"setLiveTranscoding"),G.prototype),q(G.prototype,"stopLiveStreaming",[ky],Object.getOwnPropertyDescriptor(G.prototype,"stopLiveStreaming"),G.prototype),q(G.prototype,"startChannelMediaRelay",[Ly],Object.getOwnPropertyDescriptor(G.prototype,"startChannelMediaRelay"),G.prototype),q(G.prototype,"updateChannelMediaRelay",[My],Object.getOwnPropertyDescriptor(G.prototype,"updateChannelMediaRelay"),G.prototype),q(G.prototype,"stopChannelMediaRelay",[Uy],Object.getOwnPropertyDescriptor(G.prototype,"stopChannelMediaRelay"),G.prototype),q(G.prototype,"sendCustomReportMessage",[xy],Object.getOwnPropertyDescriptor(G.prototype,"sendCustomReportMessage"),G.prototype),q(G.prototype,"pickSVCLayer",[Vy],Object.getOwnPropertyDescriptor(G.prototype,"pickSVCLayer"),G.prototype),q(G.prototype,"setRTMConfig",[Fy],Object.getOwnPropertyDescriptor(G.prototype,"setRTMConfig"),G.prototype),q(G.prototype,"enableContentInspect",[By],Object.getOwnPropertyDescriptor(G.prototype,"enableContentInspect"),G.prototype),q(G.prototype,"disableContentInspect",[jy],Object.getOwnPropertyDescriptor(G.prototype,"disableContentInspect"),G.prototype),q(G.prototype,"setImageModeration",[Gy],Object.getOwnPropertyDescriptor(G.prototype,"setImageModeration"),G.prototype),q(G.prototype,"setP2PTransport",[Wy],Object.getOwnPropertyDescriptor(G.prototype,"setP2PTransport"),G.prototype),q(G.prototype,"getJoinChannelServiceRecords",[Hy],Object.getOwnPropertyDescriptor(G.prototype,"getJoinChannelServiceRecords"),G.prototype),q(G.prototype,"setPublishAudioFilterEnabled",[Ky],Object.getOwnPropertyDescriptor(G.prototype,"setPublishAudioFilterEnabled"),G.prototype),G),Su=class Ehe{constructor(r,i){T(this,"id",0),T(this,"element",void 0),T(this,"peerPair",void 0),T(this,"context",void 0),T(this,"audioPlayerElement",void 0),T(this,"audioTrack",void 0),Ehe.count+=1,this.id=Ehe.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{let i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let r=async(o,h)=>{let p=h==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(p),o.iceGatheringState==="complete"?o.localDescription:new j(g=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&g(o.localDescription)}})},i=async(o,h)=>await o.setRemoteDescription(h);try{let o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);let h=await r(this.peerPair[1],"answer");await i(this.peerPair[0],h)}catch(o){throw new O(R.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(h){throw new O(R.LOCAL_AEC_ERROR,h.toString()).print()}if(!i)throw new O(R.LOCAL_AEC_ERROR,"no dest node when local aec").print();let o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){_.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}},qy,Qd;T(Su,"count",0);var LW=window.AudioContext||window.webkitAudioContext,MW=new(qy=$({report:X}),q((Qd=class{constructor(){T(this,"units",[]),T(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return _.debug("the system does not need to process local aec"),-1;this.context||(this.context=new LW);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new Su(e,this.context),this.units.push(r)),r.startEchoCancellation(),_.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return mt().name!==It.SAFARI}}).prototype,"processExternalMediaAEC",[qy],Object.getOwnPropertyDescriptor(Qd.prototype,"processExternalMediaAEC"),Qd.prototype),Qd);function zy(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Jy(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?zy(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zy(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var I_=window||document;function L0(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!I_)return;let i=Mt._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);let o=h=>{if(!(h&&h.blockedURI&&(Mt.onSecurityPolicyViolation||Mt.getListeners(nr.SECURITY_POLICY_VIOLATION).length>0)))return;let p=h.blockedURI;v("CSP_DETECTED_HOSTNAME_LIST").some(g=>W(p).call(p,g))&&(Mt.onSecurityPolicyViolation&&typeof Mt.onSecurityPolicyViolation=="function"&&Mt.onSecurityPolicyViolation(h),Mt.getListeners(nr.SECURITY_POLICY_VIOLATION).length>0&&Mt.safeEmit(nr.SECURITY_POLICY_VIOLATION,h))};i&&I_.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||Mt.getListeners(nr.SECURITY_POLICY_VIOLATION).length>0)&&I_.addEventListener("securitypolicyviolation",o),Mt._cspEventHandlerPointer=o}var UW=hn,xW=nO,Xy=RegExp.prototype,VW=function(e){return e===Xy||UW(Xy,e)?xW(e):e.flags},en=ae(VW);function Sa(e){let r=e.length;for(;--r>=0;)e[r]=0}var Pf=256,M0=286,lc=30,uc=15,_m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ol=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),FW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Qy=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wr=new Array(576);Sa(wr);var hc=new Array(60);Sa(hc);var Fc=new Array(512);Sa(Fc);var Bc=new Array(256);Sa(Bc);var kf=new Array(29);Sa(kf);var Ru=new Array(lc);function v_(e,r,i,o,h){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=h,this.has_stree=e&&e.length}var Zy,$y,tA;function y_(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}Sa(Ru);var U0=e=>e<256?Fc[e]:Fc[256+(e>>>7)],jc=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},Bn=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,jc(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},rr=(e,r,i)=>{Bn(e,i[2*r],i[2*r+1])},x0=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},V0=(e,r,i)=>{let o=new Array(16),h,p,g=0;for(h=1;h<=uc;h++)g=g+i[h-1]<<1,o[h]=g;for(p=0;p<=r;p++){let C=e[2*p+1];C!==0&&(e[2*p]=x0(o[C]++,C))}},F0=e=>{let r;for(r=0;r<M0;r++)e.dyn_ltree[2*r]=0;for(r=0;r<lc;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},B0=e=>{e.bi_valid>8?jc(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},eA=(e,r,i,o)=>{let h=2*r,p=2*i;return e[h]<e[p]||e[h]===e[p]&&o[r]<=o[i]},A_=(e,r,i)=>{let o=e.heap[i],h=i<<1;for(;h<=e.heap_len&&(h<e.heap_len&&eA(r,e.heap[h+1],e.heap[h],e.depth)&&h++,!eA(r,o,e.heap[h],e.depth));)e.heap[i]=e.heap[h],i=h,h<<=1;e.heap[i]=o},nA=(e,r,i)=>{let o,h,p,g,C=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+C++],o+=(255&e.pending_buf[e.sym_buf+C++])<<8,h=e.pending_buf[e.sym_buf+C++],o===0?rr(e,h,r):(p=Bc[h],rr(e,p+Pf+1,r),g=_m[p],g!==0&&(h-=kf[p],Bn(e,h,g)),o--,p=U0(o),rr(e,p,i),g=Ol[p],g!==0&&(o-=Ru[p],Bn(e,o,g)));while(C<e.sym_next);rr(e,256,r)},b_=(e,r)=>{let i=r.dyn_tree,o=r.stat_desc.static_tree,h=r.stat_desc.has_stree,p=r.stat_desc.elems,g,C,A,x=-1;for(e.heap_len=0,e.heap_max=573,g=0;g<p;g++)i[2*g]!==0?(e.heap[++e.heap_len]=x=g,e.depth[g]=0):i[2*g+1]=0;for(;e.heap_len<2;)A=e.heap[++e.heap_len]=x<2?++x:0,i[2*A]=1,e.depth[A]=0,e.opt_len--,h&&(e.static_len-=o[2*A+1]);for(r.max_code=x,g=e.heap_len>>1;g>=1;g--)A_(e,i,g);A=p;do g=e.heap[1],e.heap[1]=e.heap[e.heap_len--],A_(e,i,1),C=e.heap[1],e.heap[--e.heap_max]=g,e.heap[--e.heap_max]=C,i[2*A]=i[2*g]+i[2*C],e.depth[A]=(e.depth[g]>=e.depth[C]?e.depth[g]:e.depth[C])+1,i[2*g+1]=i[2*C+1]=A,e.heap[1]=A++,A_(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((_e,cN)=>{let dN=cN.dyn_tree,fN=cN.max_code,mN=cN.stat_desc.static_tree,EN=cN.stat_desc.has_stree,RN=cN.stat_desc.extra_bits,IN=cN.stat_desc.extra_base,t0=cN.stat_desc.max_length,aH,pH,SH,vH,AH,UH,zH=0;for(vH=0;vH<=uc;vH++)_e.bl_count[vH]=0;for(dN[2*_e.heap[_e.heap_max]+1]=0,aH=_e.heap_max+1;aH<573;aH++)pH=_e.heap[aH],vH=dN[2*dN[2*pH+1]+1]+1,vH>t0&&(vH=t0,zH++),dN[2*pH+1]=vH,pH>fN||(_e.bl_count[vH]++,AH=0,pH>=IN&&(AH=RN[pH-IN]),UH=dN[2*pH],_e.opt_len+=UH*(vH+AH),EN&&(_e.static_len+=UH*(mN[2*pH+1]+AH)));if(zH!==0){do{for(vH=t0-1;_e.bl_count[vH]===0;)vH--;_e.bl_count[vH]--,_e.bl_count[vH+1]+=2,_e.bl_count[t0]--,zH-=2}while(zH>0);for(vH=t0;vH!==0;vH--)for(pH=_e.bl_count[vH];pH!==0;)SH=_e.heap[--aH],SH>fN||(dN[2*SH+1]!==vH&&(_e.opt_len+=(vH-dN[2*SH+1])*dN[2*SH],dN[2*SH+1]=vH),pH--)}})(e,r),V0(i,x,e.bl_count)},iA=(e,r,i)=>{let o,h,p=-1,g=r[1],C=0,A=7,x=4;for(g===0&&(A=138,x=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)h=g,g=r[2*(o+1)+1],++C<A&&h===g||(C<x?e.bl_tree[2*h]+=C:h!==0?(h!==p&&e.bl_tree[2*h]++,e.bl_tree[32]++):C<=10?e.bl_tree[34]++:e.bl_tree[36]++,C=0,p=h,g===0?(A=138,x=3):h===g?(A=6,x=3):(A=7,x=4))},rA=(e,r,i)=>{let o,h,p=-1,g=r[1],C=0,A=7,x=4;for(g===0&&(A=138,x=3),o=0;o<=i;o++)if(h=g,g=r[2*(o+1)+1],!(++C<A&&h===g)){if(C<x)do rr(e,h,e.bl_tree);while(--C!=0);else h!==0?(h!==p&&(rr(e,h,e.bl_tree),C--),rr(e,16,e.bl_tree),Bn(e,C-3,2)):C<=10?(rr(e,17,e.bl_tree),Bn(e,C-3,3)):(rr(e,18,e.bl_tree),Bn(e,C-11,7));C=0,p=h,g===0?(A=138,x=3):h===g?(A=6,x=3):(A=7,x=4)}},oA=!1,j0=(e,r,i,o)=>{Bn(e,0+(o?1:0),3),B0(e),jc(e,i),jc(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i},BW=e=>{oA||((()=>{let r,i,o,h,p,g=new Array(16);for(o=0,h=0;h<28;h++)for(kf[h]=o,r=0;r<1<<_m[h];r++)Bc[o++]=h;for(Bc[o-1]=h,p=0,h=0;h<16;h++)for(Ru[h]=p,r=0;r<1<<Ol[h];r++)Fc[p++]=h;for(p>>=7;h<lc;h++)for(Ru[h]=p<<7,r=0;r<1<<Ol[h]-7;r++)Fc[256+p++]=h;for(i=0;i<=uc;i++)g[i]=0;for(r=0;r<=143;)wr[2*r+1]=8,r++,g[8]++;for(;r<=255;)wr[2*r+1]=9,r++,g[9]++;for(;r<=279;)wr[2*r+1]=7,r++,g[7]++;for(;r<=287;)wr[2*r+1]=8,r++,g[8]++;for(V0(wr,287,g),r=0;r<lc;r++)hc[2*r+1]=5,hc[2*r]=x0(r,5);Zy=new v_(wr,_m,257,M0,uc),$y=new v_(hc,Ol,0,lc,uc),tA=new v_(new Array(0),FW,0,19,7)})(),oA=!0),e.l_desc=new y_(e.dyn_ltree,Zy),e.d_desc=new y_(e.dyn_dtree,$y),e.bl_desc=new y_(e.bl_tree,tA),e.bi_buf=0,e.bi_valid=0,F0(e)},jW=(e,r,i,o)=>{let h,p,g=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(C=>{let A,x=4093624447;for(A=0;A<=31;A++,x>>>=1)if(1&x&&C.dyn_ltree[2*A]!==0)return 0;if(C.dyn_ltree[18]!==0||C.dyn_ltree[20]!==0||C.dyn_ltree[26]!==0)return 1;for(A=32;A<Pf;A++)if(C.dyn_ltree[2*A]!==0)return 1;return 0})(e)),b_(e,e.l_desc),b_(e,e.d_desc),g=(C=>{let A;for(iA(C,C.dyn_ltree,C.l_desc.max_code),iA(C,C.dyn_dtree,C.d_desc.max_code),b_(C,C.bl_desc),A=18;A>=3&&C.bl_tree[2*Qy[A]+1]===0;A--);return C.opt_len+=3*(A+1)+5+5+4,A})(e),h=e.opt_len+3+7>>>3,p=e.static_len+3+7>>>3,p<=h&&(h=p)):h=p=i+5,i+4<=h&&r!==-1?j0(e,r,i,o):e.strategy===4||p===h?(Bn(e,2+(o?1:0),3),nA(e,wr,hc)):(Bn(e,4+(o?1:0),3),((C,A,x,_e)=>{let cN;for(Bn(C,A-257,5),Bn(C,x-1,5),Bn(C,_e-4,4),cN=0;cN<_e;cN++)Bn(C,C.bl_tree[2*Qy[cN]+1],3);rA(C,C.dyn_ltree,A-1),rA(C,C.dyn_dtree,x-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,g+1),nA(e,e.dyn_ltree,e.dyn_dtree)),F0(e),o&&B0(e)},GW=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(Bc[i]+Pf+1)]++,e.dyn_dtree[2*U0(r)]++),e.sym_next===e.sym_end),WW=e=>{Bn(e,2,3),rr(e,256,wr),(r=>{r.bi_valid===16?(jc(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},HW={_tr_init:BW,_tr_stored_block:j0,_tr_flush_block:jW,_tr_tally:GW,_tr_align:WW},Gc=(e,r,i,o)=>{let h=65535&e|0,p=e>>>16&65535|0,g=0;for(;i!==0;){g=i>2e3?2e3:i,i-=g;do h=h+r[o++]|0,p=p+h|0;while(--g);h%=65521,p%=65521}return h|p<<16|0},KW=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})()),an=(e,r,i,o)=>{let h=KW,p=o+i;e^=-1;for(let g=o;g<p;g++)e=e>>>8^h[255&(e^r[g])];return-1^e},Zo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ra={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:YW,_tr_stored_block:Em,_tr_flush_block:qW,_tr_tally:ao,_tr_align:zW}=HW,{Z_NO_FLUSH:co,Z_PARTIAL_FLUSH:JW,Z_FULL_FLUSH:XW,Z_FINISH:Ri,Z_BLOCK:sA,Z_OK:_n,Z_STREAM_END:aA,Z_STREAM_ERROR:dr,Z_DATA_ERROR:QW,Z_BUF_ERROR:w_,Z_DEFAULT_COMPRESSION:ZW,Z_FILTERED:$W,Z_HUFFMAN_ONLY:Zd,Z_RLE:t32,Z_FIXED:e3,Z_DEFAULT_STRATEGY:n3,Z_UNKNOWN:i3,Z_DEFLATED:th}=Ra,mm=286,r3=30,o3=19,s3=2*mm+1,a3=15,jo=258,lr=262,aa=42,Go=113,tc=666,Wo=(e,r)=>(e.msg=Zo[r],r),cA=e=>2*e-(e>4?9:0),Qr=e=>{let r=e.length;for(;--r>=0;)e[r]=0},c3=e=>{let r,i,o,h=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=h?i-h:0;while(--r);r=h,o=r;do i=e.prev[--o],e.prev[o]=i>=h?i-h:0;while(--r)},lo=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask,Zn=e=>{let r=e.state,i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},ti=(e,r)=>{qW(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,Zn(e.strm)},te=(e,r)=>{e.pending_buf[e.pending++]=r},ja=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},fm=(e,r,i,o)=>{let h=e.avail_in;return h>o&&(h=o),h===0?0:(e.avail_in-=h,r.set(e.input.subarray(e.next_in,e.next_in+h),i),e.state.wrap===1?e.adler=Gc(e.adler,r,h,i):e.state.wrap===2&&(e.adler=an(e.adler,r,h,i)),e.next_in+=h,e.total_in+=h,h)},G0=(e,r)=>{let i,o,h=e.max_chain_length,p=e.strstart,g=e.prev_length,C=e.nice_match,A=e.strstart>e.w_size-lr?e.strstart-(e.w_size-lr):0,x=e.window,_e=e.w_mask,cN=e.prev,dN=e.strstart+jo,fN=x[p+g-1],mN=x[p+g];e.prev_length>=e.good_match&&(h>>=2),C>e.lookahead&&(C=e.lookahead);do if(i=r,x[i+g]===mN&&x[i+g-1]===fN&&x[i]===x[p]&&x[++i]===x[p+1]){p+=2,i++;do;while(x[++p]===x[++i]&&x[++p]===x[++i]&&x[++p]===x[++i]&&x[++p]===x[++i]&&x[++p]===x[++i]&&x[++p]===x[++i]&&x[++p]===x[++i]&&x[++p]===x[++i]&&p<dN);if(o=jo-(dN-p),p=dN-jo,o>g){if(e.match_start=r,g=o,o>=C)break;fN=x[p+g-1],mN=x[p+g]}}while((r=cN[r&_e])>A&&--h!=0);return g<=e.lookahead?g:e.lookahead},ca=e=>{let r=e.w_size,i,o,h;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-lr)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),c3(e),o+=r),e.strm.avail_in===0)break;if(i=fm(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(h=e.strstart-e.insert,e.ins_h=e.window[h],e.ins_h=lo(e,e.ins_h,e.window[h+1]);e.insert&&(e.ins_h=lo(e,e.ins_h,e.window[h+3-1]),e.prev[h&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=h,h++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<lr&&e.strm.avail_in!==0)},W0=(e,r)=>{let i,o,h,p=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,g=0,C=e.strm.avail_in;do{if(i=65535,h=e.bi_valid+42>>3,e.strm.avail_out<h||(h=e.strm.avail_out-h,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>h&&(i=h),i<p&&(i===0&&r!==Ri||r===co||i!==o+e.strm.avail_in)))break;g=r===Ri&&i===o+e.strm.avail_in?1:0,Em(e,0,0,g),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,Zn(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(fm(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(g===0);return C-=e.strm.avail_in,C&&(C>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=C&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-C,e.strm.next_in),e.strstart),e.strstart+=C,e.insert+=C>e.w_size-e.insert?e.w_size-e.insert:C),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),g?4:r!==co&&r!==Ri&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(h=e.window_size-e.strstart,e.strm.avail_in>h&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,h+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),h>e.strm.avail_in&&(h=e.strm.avail_in),h&&(fm(e.strm,e.window,e.strstart,h),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.high_water<e.strstart&&(e.high_water=e.strstart),h=e.bi_valid+42>>3,h=e.pending_buf_size-h>65535?65535:e.pending_buf_size-h,p=h>e.w_size?e.w_size:h,o=e.strstart-e.block_start,(o>=p||(o||r===Ri)&&r!==co&&e.strm.avail_in===0&&o<=h)&&(i=o>h?h:o,g=r===Ri&&e.strm.avail_in===0&&i===o?1:0,Em(e,e.block_start,i,g),e.block_start+=i,Zn(e.strm)),g?3:1)},O_=(e,r)=>{let i,o;for(;;){if(e.lookahead<lr){if(ca(e),e.lookahead<lr&&r===co)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=lo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-lr&&(e.match_length=G0(e,i)),e.match_length>=3)if(o=ao(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=lo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=lo(e,e.ins_h,e.window[e.strstart+1]);else o=ao(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(ti(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===Ri?(ti(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(ti(e,!1),e.strm.avail_out===0)?1:2},Rs=(e,r)=>{let i,o,h;for(;;){if(e.lookahead<lr){if(ca(e),e.lookahead<lr&&r===co)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=lo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-lr&&(e.match_length=G0(e,i),e.match_length<=5&&(e.strategy===$W||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){h=e.strstart+e.lookahead-3,o=ao(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=h&&(e.ins_h=lo(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(ti(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=ao(e,0,e.window[e.strstart-1]),o&&ti(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=ao(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===Ri?(ti(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(ti(e,!1),e.strm.avail_out===0)?1:2};function $i(e,r,i,o,h){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=h}var ec=[new $i(0,0,0,0,W0),new $i(4,4,8,4,O_),new $i(4,5,16,8,O_),new $i(4,6,32,32,O_),new $i(4,4,16,16,Rs),new $i(8,16,32,32,Rs),new $i(8,16,128,128,Rs),new $i(8,32,128,256,Rs),new $i(32,128,258,1024,Rs),new $i(32,258,258,4096,Rs)];function d3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=th,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*s3),this.dyn_dtree=new Uint16Array(2*(2*r3+1)),this.bl_tree=new Uint16Array(2*(2*o3+1)),Qr(this.dyn_ltree),Qr(this.dyn_dtree),Qr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(a3+1),this.heap=new Uint16Array(2*mm+1),Qr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*mm+1),Qr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Wc=e=>{if(!e)return 1;let r=e.state;return!r||r.strm!==e||r.status!==aa&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Go&&r.status!==tc?1:0},H0=e=>{if(Wc(e))return Wo(e,dr);e.total_in=e.total_out=0,e.data_type=i3;let r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?aa:Go,e.adler=r.wrap===2?0:1,r.last_flush=-2,YW(r),_n},K0=e=>{let r=H0(e);return r===_n&&(i=>{i.window_size=2*i.w_size,Qr(i.head),i.max_lazy_match=ec[i.level].max_lazy,i.good_match=ec[i.level].good_length,i.nice_match=ec[i.level].nice_length,i.max_chain_length=ec[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},dA=(e,r,i,o,h,p)=>{if(!e)return dr;let g=1;if(r===ZW&&(r=6),o<0?(g=0,o=-o):o>15&&(g=2,o-=16),h<1||h>9||i!==th||o<8||o>15||r<0||r>9||p<0||p>e3||o===8&&g!==1)return Wo(e,dr);o===8&&(o=9);let C=new d3;return e.state=C,C.strm=e,C.status=aa,C.wrap=g,C.gzhead=null,C.w_bits=o,C.w_size=1<<C.w_bits,C.w_mask=C.w_size-1,C.hash_bits=h+7,C.hash_size=1<<C.hash_bits,C.hash_mask=C.hash_size-1,C.hash_shift=~~((C.hash_bits+3-1)/3),C.window=new Uint8Array(2*C.w_size),C.head=new Uint16Array(C.hash_size),C.prev=new Uint16Array(C.w_size),C.lit_bufsize=1<<h+6,C.pending_buf_size=4*C.lit_bufsize,C.pending_buf=new Uint8Array(C.pending_buf_size),C.sym_buf=C.lit_bufsize,C.sym_end=3*(C.lit_bufsize-1),C.level=r,C.strategy=p,C.method=i,K0(e)},l3=(e,r)=>{if(Wc(e)||r>sA||r<0)return e?Wo(e,dr):dr;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===tc&&r!==Ri)return Wo(e,e.avail_out===0?w_:dr);let o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(Zn(e),e.avail_out===0)return i.last_flush=-1,_n}else if(e.avail_in===0&&cA(r)<=cA(o)&&r!==Ri)return Wo(e,w_);if(i.status===tc&&e.avail_in!==0)return Wo(e,w_);if(i.status===aa&&i.wrap===0&&(i.status=Go),i.status===aa){let h=th+(i.w_bits-8<<4)<<8,p=-1;if(p=i.strategy>=Zd||i.level<2?0:i.level<6?1:i.level===6?2:3,h|=p<<6,i.strstart!==0&&(h|=32),h+=31-h%31,ja(i,h),i.strstart!==0&&(ja(i,e.adler>>>16),ja(i,65535&e.adler)),e.adler=1,i.status=Go,Zn(e),i.pending!==0)return i.last_flush=-1,_n}if(i.status===57){if(e.adler=0,te(i,31),te(i,139),te(i,8),i.gzhead)te(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),te(i,255&i.gzhead.time),te(i,i.gzhead.time>>8&255),te(i,i.gzhead.time>>16&255),te(i,i.gzhead.time>>24&255),te(i,i.level===9?2:i.strategy>=Zd||i.level<2?4:0),te(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(te(i,255&i.gzhead.extra.length),te(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=an(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(te(i,0),te(i,0),te(i,0),te(i,0),te(i,0),te(i,i.level===9?2:i.strategy>=Zd||i.level<2?4:0),te(i,3),i.status=Go,Zn(e),i.pending!==0)return i.last_flush=-1,_n}if(i.status===69){if(i.gzhead.extra){let h=i.pending,p=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+p>i.pending_buf_size;){let C=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+C),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>h&&(e.adler=an(e.adler,i.pending_buf,i.pending-h,h)),i.gzindex+=C,Zn(e),i.pending!==0)return i.last_flush=-1,_n;h=0,p-=C}let g=new Uint8Array(i.gzhead.extra);i.pending_buf.set(g.subarray(i.gzindex,i.gzindex+p),i.pending),i.pending+=p,i.gzhead.hcrc&&i.pending>h&&(e.adler=an(e.adler,i.pending_buf,i.pending-h,h)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let h,p=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>p&&(e.adler=an(e.adler,i.pending_buf,i.pending-p,p)),Zn(e),i.pending!==0)return i.last_flush=-1,_n;p=0}h=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,te(i,h)}while(h!==0);i.gzhead.hcrc&&i.pending>p&&(e.adler=an(e.adler,i.pending_buf,i.pending-p,p)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let h,p=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>p&&(e.adler=an(e.adler,i.pending_buf,i.pending-p,p)),Zn(e),i.pending!==0)return i.last_flush=-1,_n;p=0}h=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,te(i,h)}while(h!==0);i.gzhead.hcrc&&i.pending>p&&(e.adler=an(e.adler,i.pending_buf,i.pending-p,p))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Zn(e),i.pending!==0))return i.last_flush=-1,_n;te(i,255&e.adler),te(i,e.adler>>8&255),e.adler=0}if(i.status=Go,Zn(e),i.pending!==0)return i.last_flush=-1,_n}if(e.avail_in!==0||i.lookahead!==0||r!==co&&i.status!==tc){let h=i.level===0?W0(i,r):i.strategy===Zd?((p,g)=>{let C;for(;;){if(p.lookahead===0&&(ca(p),p.lookahead===0)){if(g===co)return 1;break}if(p.match_length=0,C=ao(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++,C&&(ti(p,!1),p.strm.avail_out===0))return 1}return p.insert=0,g===Ri?(ti(p,!0),p.strm.avail_out===0?3:4):p.sym_next&&(ti(p,!1),p.strm.avail_out===0)?1:2})(i,r):i.strategy===t32?((p,g)=>{let C,A,x,_e,cN=p.window;for(;;){if(p.lookahead<=jo){if(ca(p),p.lookahead<=jo&&g===co)return 1;if(p.lookahead===0)break}if(p.match_length=0,p.lookahead>=3&&p.strstart>0&&(x=p.strstart-1,A=cN[x],A===cN[++x]&&A===cN[++x]&&A===cN[++x])){_e=p.strstart+jo;do;while(A===cN[++x]&&A===cN[++x]&&A===cN[++x]&&A===cN[++x]&&A===cN[++x]&&A===cN[++x]&&A===cN[++x]&&A===cN[++x]&&x<_e);p.match_length=jo-(_e-x),p.match_length>p.lookahead&&(p.match_length=p.lookahead)}if(p.match_length>=3?(C=ao(p,1,p.match_length-3),p.lookahead-=p.match_length,p.strstart+=p.match_length,p.match_length=0):(C=ao(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++),C&&(ti(p,!1),p.strm.avail_out===0))return 1}return p.insert=0,g===Ri?(ti(p,!0),p.strm.avail_out===0?3:4):p.sym_next&&(ti(p,!1),p.strm.avail_out===0)?1:2})(i,r):ec[i.level].func(i,r);if(h!==3&&h!==4||(i.status=tc),h===1||h===3)return e.avail_out===0&&(i.last_flush=-1),_n;if(h===2&&(r===JW?zW(i):r!==sA&&(Em(i,0,0,!1),r===XW&&(Qr(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Zn(e),e.avail_out===0))return i.last_flush=-1,_n}return r!==Ri?_n:i.wrap<=0?aA:(i.wrap===2?(te(i,255&e.adler),te(i,e.adler>>8&255),te(i,e.adler>>16&255),te(i,e.adler>>24&255),te(i,255&e.total_in),te(i,e.total_in>>8&255),te(i,e.total_in>>16&255),te(i,e.total_in>>24&255)):(ja(i,e.adler>>>16),ja(i,65535&e.adler)),Zn(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?_n:aA)},u3=(e,r)=>{let i=r.length;if(Wc(e))return dr;let o=e.state,h=o.wrap;if(h===2||h===1&&o.status!==aa||o.lookahead)return dr;if(h===1&&(e.adler=Gc(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){h===0&&(Qr(o.head),o.strstart=0,o.block_start=0,o.insert=0);let A=new Uint8Array(o.w_size);A.set(r.subarray(i-o.w_size,i),0),r=A,i=o.w_size}let p=e.avail_in,g=e.next_in,C=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,ca(o);o.lookahead>=3;){let A=o.strstart,x=o.lookahead-2;do o.ins_h=lo(o,o.ins_h,o.window[A+3-1]),o.prev[A&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=A,A++;while(--x);o.strstart=A,o.lookahead=2,ca(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=g,e.input=C,e.avail_in=p,o.wrap=h,_n},pc={deflateInit:(e,r)=>dA(e,r,th,15,8,n3),deflateInit2:dA,deflateReset:K0,deflateResetKeep:H0,deflateSetHeader:(e,r)=>Wc(e)||e.state.wrap!==2?dr:(e.state.gzhead=r,_n),deflate:l3,deflateEnd:e=>{if(Wc(e))return dr;let r=e.state.status;return e.state=null,r===Go?Wo(e,QW):_n},deflateSetDictionary:u3,deflateInfo:"pako deflate (from Nodeca project)"},h3=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),eh={assign:function(e){let r=Array.prototype.slice.call(arguments,1);for(;r.length;){let i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let o in i)h3(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,h=e.length;o<h;o++)r+=e[o].length;let i=new Uint8Array(r);for(let o=0,h=0,p=e.length;o<p;o++){let g=e[o];i.set(g,h),h+=g.length}return i}},Y0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Y0=!1}var Hc=new Uint8Array(256);for(let e=0;e<256;e++)Hc[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Hc[254]=Hc[254]=1;var Kc={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,h,p,g=e.length,C=0;for(h=0;h<g;h++)i=e.charCodeAt(h),(64512&i)==55296&&h+1<g&&(o=e.charCodeAt(h+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),h++)),C+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(C),p=0,h=0;p<C;h++)i=e.charCodeAt(h),(64512&i)==55296&&h+1<g&&(o=e.charCodeAt(h+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),h++)),i<128?r[p++]=i:i<2048?(r[p++]=192|i>>>6,r[p++]=128|63&i):i<65536?(r[p++]=224|i>>>12,r[p++]=128|i>>>6&63,r[p++]=128|63&i):(r[p++]=240|i>>>18,r[p++]=128|i>>>12&63,r[p++]=128|i>>>6&63,r[p++]=128|63&i);return r},buf2string:(e,r)=>{let i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,h,p=new Array(2*i);for(h=0,o=0;o<i;){let g=e[o++];if(g<128){p[h++]=g;continue}let C=Hc[g];if(C>4)p[h++]=65533,o+=C-1;else{for(g&=C===2?31:C===3?15:7;C>1&&o<i;)g=g<<6|63&e[o++],C--;C>1?p[h++]=65533:g<65536?p[h++]=g:(g-=65536,p[h++]=55296|g>>10&1023,p[h++]=56320|1023&g)}}return((g,C)=>{if(C<65534&&g.subarray&&Y0)return String.fromCharCode.apply(null,g.length===C?g:g.subarray(0,C));let A="";for(let x=0;x<C;x++)A+=String.fromCharCode(g[x]);return A})(p,h)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+Hc[e[i]]>r?i:r}},q0=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},z0=Object.prototype.toString,{Z_NO_FLUSH:p3,Z_SYNC_FLUSH:_3,Z_FULL_FLUSH:E3,Z_FINISH:m3,Z_OK:Cu,Z_STREAM_END:f3,Z_DEFAULT_COMPRESSION:g3,Z_DEFAULT_STRATEGY:T3,Z_DEFLATED:S3}=Ra;function _c(e){this.options=eh.assign({level:g3,method:S3,chunkSize:16384,windowBits:15,memLevel:8,strategy:T3},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new q0,this.strm.avail_out=0;let i=pc.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==Cu)throw new Error(Zo[i]);if(r.header&&pc.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?Kc.string2buf(r.dictionary):z0.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=pc.deflateSetDictionary(this.strm,o),i!==Cu)throw new Error(Zo[i]);this._dict_set=!0}}function N_(e,r){let i=new _c(r);if(i.push(e,!0),i.err)throw i.msg||Zo[i.err];return i.result}_c.prototype.push=function(e,r){let i=this.strm,o=this.options.chunkSize,h,p;if(this.ended)return!1;for(p=r===~~r?r:r===!0?m3:p3,typeof e=="string"?i.input=Kc.string2buf(e):z0.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(p===_3||p===E3)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(h=pc.deflate(i,p),h===f3)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),h=pc.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===Cu;if(i.avail_out!==0){if(p>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},_c.prototype.onData=function(e){this.chunks.push(e)},_c.prototype.onEnd=function(e){e===Cu&&(this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var R3={Deflate:_c,deflate:N_,deflateRaw:function(e,r){return(r=r||{}).raw=!0,N_(e,r)},gzip:function(e,r){return(r=r||{}).gzip=!0,N_(e,r)},constants:Ra},$d=16209,C3=function(e,r){let i,o,h,p,g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH,vH,AH,UH,zH,CH=e.state;i=e.next_in,UH=e.input,o=i+(e.avail_in-5),h=e.next_out,zH=e.output,p=h-(r-e.avail_out),g=h+(e.avail_out-257),C=CH.dmax,A=CH.wsize,x=CH.whave,_e=CH.wnext,cN=CH.window,dN=CH.hold,fN=CH.bits,mN=CH.lencode,EN=CH.distcode,RN=(1<<CH.lenbits)-1,IN=(1<<CH.distbits)-1;e:do{fN<15&&(dN+=UH[i++]<<fN,fN+=8,dN+=UH[i++]<<fN,fN+=8),t0=mN[dN&RN];t:for(;;){if(aH=t0>>>24,dN>>>=aH,fN-=aH,aH=t0>>>16&255,aH===0)zH[h++]=65535&t0;else{if(!(16&aH)){if(!(64&aH)){t0=mN[(65535&t0)+(dN&(1<<aH)-1)];continue t}if(32&aH){CH.mode=16191;break e}e.msg="invalid literal/length code",CH.mode=$d;break e}pH=65535&t0,aH&=15,aH&&(fN<aH&&(dN+=UH[i++]<<fN,fN+=8),pH+=dN&(1<<aH)-1,dN>>>=aH,fN-=aH),fN<15&&(dN+=UH[i++]<<fN,fN+=8,dN+=UH[i++]<<fN,fN+=8),t0=EN[dN&IN];n:for(;;){if(aH=t0>>>24,dN>>>=aH,fN-=aH,aH=t0>>>16&255,!(16&aH)){if(!(64&aH)){t0=EN[(65535&t0)+(dN&(1<<aH)-1)];continue n}e.msg="invalid distance code",CH.mode=$d;break e}if(SH=65535&t0,aH&=15,fN<aH&&(dN+=UH[i++]<<fN,fN+=8,fN<aH&&(dN+=UH[i++]<<fN,fN+=8)),SH+=dN&(1<<aH)-1,SH>C){e.msg="invalid distance too far back",CH.mode=$d;break e}if(dN>>>=aH,fN-=aH,aH=h-p,SH>aH){if(aH=SH-aH,aH>x&&CH.sane){e.msg="invalid distance too far back",CH.mode=$d;break e}if(vH=0,AH=cN,_e===0){if(vH+=A-aH,aH<pH){pH-=aH;do zH[h++]=cN[vH++];while(--aH);vH=h-SH,AH=zH}}else if(_e<aH){if(vH+=A+_e-aH,aH-=_e,aH<pH){pH-=aH;do zH[h++]=cN[vH++];while(--aH);if(vH=0,_e<pH){aH=_e,pH-=aH;do zH[h++]=cN[vH++];while(--aH);vH=h-SH,AH=zH}}}else if(vH+=_e-aH,aH<pH){pH-=aH;do zH[h++]=cN[vH++];while(--aH);vH=h-SH,AH=zH}for(;pH>2;)zH[h++]=AH[vH++],zH[h++]=AH[vH++],zH[h++]=AH[vH++],pH-=3;pH&&(zH[h++]=AH[vH++],pH>1&&(zH[h++]=AH[vH++]))}else{vH=h-SH;do zH[h++]=zH[vH++],zH[h++]=zH[vH++],zH[h++]=zH[vH++],pH-=3;while(pH>2);pH&&(zH[h++]=zH[vH++],pH>1&&(zH[h++]=zH[vH++]))}break}}break}}while(i<o&&h<g);pH=fN>>3,i-=pH,fN-=pH<<3,dN&=(1<<fN)-1,e.next_in=i,e.next_out=h,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=h<g?g-h+257:257-(h-g),CH.hold=dN,CH.bits=fN},tl=15,I3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),v3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),y3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),A3=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ec=(e,r,i,o,h,p,g,C)=>{let A=C.bits,x,_e,cN,dN,fN,mN,EN=0,RN=0,IN=0,t0=0,aH=0,pH=0,SH=0,vH=0,AH=0,UH=0,zH=null,CH=new Uint16Array(16),HH=new Uint16Array(16),VH,KH,IH,MH=null;for(EN=0;EN<=tl;EN++)CH[EN]=0;for(RN=0;RN<o;RN++)CH[r[i+RN]]++;for(aH=A,t0=tl;t0>=1&&CH[t0]===0;t0--);if(aH>t0&&(aH=t0),t0===0)return h[p++]=20971520,h[p++]=20971520,C.bits=1,0;for(IN=1;IN<t0&&CH[IN]===0;IN++);for(aH<IN&&(aH=IN),vH=1,EN=1;EN<=tl;EN++)if(vH<<=1,vH-=CH[EN],vH<0)return-1;if(vH>0&&(e===0||t0!==1))return-1;for(HH[1]=0,EN=1;EN<tl;EN++)HH[EN+1]=HH[EN]+CH[EN];for(RN=0;RN<o;RN++)r[i+RN]!==0&&(g[HH[r[i+RN]]++]=RN);if(e===0?(zH=MH=g,mN=20):e===1?(zH=I3,MH=v3,mN=257):(zH=y3,MH=A3,mN=0),UH=0,RN=0,EN=IN,fN=p,pH=aH,SH=0,cN=-1,AH=1<<aH,dN=AH-1,e===1&&AH>852||e===2&&AH>592)return 1;for(;;){VH=EN-SH,g[RN]+1<mN?(KH=0,IH=g[RN]):g[RN]>=mN?(KH=MH[g[RN]-mN],IH=zH[g[RN]-mN]):(KH=96,IH=0),x=1<<EN-SH,_e=1<<pH,IN=_e;do _e-=x,h[fN+(UH>>SH)+_e]=VH<<24|KH<<16|IH|0;while(_e!==0);for(x=1<<EN-1;UH&x;)x>>=1;if(x!==0?(UH&=x-1,UH+=x):UH=0,RN++,--CH[EN]==0){if(EN===t0)break;EN=r[i+g[RN]]}if(EN>aH&&(UH&dN)!==cN){for(SH===0&&(SH=aH),fN+=IN,pH=EN-SH,vH=1<<pH;pH+SH<t0&&(vH-=CH[pH+SH],!(vH<=0));)pH++,vH<<=1;if(AH+=1<<pH,e===1&&AH>852||e===2&&AH>592)return 1;cN=UH&dN,h[cN]=aH<<24|pH<<16|fN-p|0}}return UH!==0&&(h[fN+UH]=EN-SH<<24|64<<16|0),C.bits=aH,0},{Z_FINISH:lA,Z_BLOCK:b3,Z_TREES:el,Z_OK:Yo,Z_STREAM_END:w3,Z_NEED_DICT:O3,Z_STREAM_ERROR:Ci,Z_DATA_ERROR:J0,Z_MEM_ERROR:X0,Z_BUF_ERROR:N3,Z_DEFLATED:uA}=Ra,nh=16180,Iu=16190,Cr=16191,D_=16192,P_=16194,nl=16199,il=16200,k_=16206,be=16209,hA=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function D3(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var qo=e=>{if(!e)return 1;let r=e.state;return!r||r.strm!==e||r.mode<nh||r.mode>16211?1:0},Q0=e=>{if(qo(e))return Ci;let r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=nh,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Yo},Z0=e=>{if(qo(e))return Ci;let r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,Q0(e)},$0=(e,r)=>{let i;if(qo(e))return Ci;let o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Ci:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,Z0(e))},pA=(e,r)=>{if(!e)return Ci;let i=new D3;e.state=i,i.strm=e,i.window=null,i.mode=nh;let o=$0(e,r);return o!==Yo&&(e.state=null),o},L_,M_,_A=!0,P3=e=>{if(_A){L_=new Int32Array(512),M_=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(Ec(1,e.lens,0,288,L_,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;Ec(2,e.lens,0,32,M_,0,e.work,{bits:5}),_A=!1}e.lencode=L_,e.lenbits=9,e.distcode=M_,e.distbits=5},tN=(e,r,i,o)=>{let h,p=e.state;return p.window===null&&(p.wsize=1<<p.wbits,p.wnext=0,p.whave=0,p.window=new Uint8Array(p.wsize)),o>=p.wsize?(p.window.set(r.subarray(i-p.wsize,i),0),p.wnext=0,p.whave=p.wsize):(h=p.wsize-p.wnext,h>o&&(h=o),p.window.set(r.subarray(i-o,i-o+h),p.wnext),(o-=h)?(p.window.set(r.subarray(i-o,i),0),p.wnext=o,p.whave=p.wsize):(p.wnext+=h,p.wnext===p.wsize&&(p.wnext=0),p.whave<p.wsize&&(p.whave+=h))),0},k3=(e,r)=>{let i,o,h,p,g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH,vH,AH,UH=0,zH=new Uint8Array(4),CH,HH,VH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(qo(e)||!e.output||!e.input&&e.avail_in!==0)return Ci;i=e.state,i.mode===Cr&&(i.mode=D_),g=e.next_out,h=e.output,A=e.avail_out,p=e.next_in,o=e.input,C=e.avail_in,x=i.hold,_e=i.bits,cN=C,dN=A,AH=Yo;e:for(;;)switch(i.mode){case nh:if(i.wrap===0){i.mode=D_;break}for(;_e<16;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(2&i.wrap&&x===35615){i.wbits===0&&(i.wbits=15),i.check=0,zH[0]=255&x,zH[1]=x>>>8&255,i.check=an(i.check,zH,2,0),x=0,_e=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&x)<<8)+(x>>8))%31){e.msg="incorrect header check",i.mode=be;break}if((15&x)!==uA){e.msg="unknown compression method",i.mode=be;break}if(x>>>=4,_e-=4,vH=8+(15&x),i.wbits===0&&(i.wbits=vH),vH>15||vH>i.wbits){e.msg="invalid window size",i.mode=be;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&x?16189:Cr,x=0,_e=0;break;case 16181:for(;_e<16;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(i.flags=x,(255&en(i))!==uA){e.msg="unknown compression method",i.mode=be;break}if(57344&en(i)){e.msg="unknown header flags set",i.mode=be;break}i.head&&(i.head.text=x>>8&1),512&en(i)&&4&i.wrap&&(zH[0]=255&x,zH[1]=x>>>8&255,i.check=an(i.check,zH,2,0)),x=0,_e=0,i.mode=16182;case 16182:for(;_e<32;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}i.head&&(i.head.time=x),512&en(i)&&4&i.wrap&&(zH[0]=255&x,zH[1]=x>>>8&255,zH[2]=x>>>16&255,zH[3]=x>>>24&255,i.check=an(i.check,zH,4,0)),x=0,_e=0,i.mode=16183;case 16183:for(;_e<16;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}i.head&&(i.head.xflags=255&x,i.head.os=x>>8),512&en(i)&&4&i.wrap&&(zH[0]=255&x,zH[1]=x>>>8&255,i.check=an(i.check,zH,2,0)),x=0,_e=0,i.mode=16184;case 16184:if(1024&en(i)){for(;_e<16;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}i.length=x,i.head&&(i.head.extra_len=x),512&en(i)&&4&i.wrap&&(zH[0]=255&x,zH[1]=x>>>8&255,i.check=an(i.check,zH,2,0)),x=0,_e=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&en(i)&&(fN=i.length,fN>C&&(fN=C),fN&&(i.head&&(vH=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(p,p+fN),vH)),512&en(i)&&4&i.wrap&&(i.check=an(i.check,o,fN,p)),C-=fN,p+=fN,i.length-=fN),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&en(i)){if(C===0)break e;fN=0;do vH=o[p+fN++],i.head&&vH&&i.length<65536&&(i.head.name+=String.fromCharCode(vH));while(vH&&fN<C);if(512&en(i)&&4&i.wrap&&(i.check=an(i.check,o,fN,p)),C-=fN,p+=fN,vH)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&en(i)){if(C===0)break e;fN=0;do vH=o[p+fN++],i.head&&vH&&i.length<65536&&(i.head.comment+=String.fromCharCode(vH));while(vH&&fN<C);if(512&en(i)&&4&i.wrap&&(i.check=an(i.check,o,fN,p)),C-=fN,p+=fN,vH)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&en(i)){for(;_e<16;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(4&i.wrap&&x!==(65535&i.check)){e.msg="header crc mismatch",i.mode=be;break}x=0,_e=0}i.head&&(i.head.hcrc=en(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Cr;break;case 16189:for(;_e<32;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}e.adler=i.check=hA(x),x=0,_e=0,i.mode=Iu;case Iu:if(i.havedict===0)return e.next_out=g,e.avail_out=A,e.next_in=p,e.avail_in=C,i.hold=x,i.bits=_e,O3;e.adler=i.check=1,i.mode=Cr;case Cr:if(r===b3||r===el)break e;case D_:if(i.last){x>>>=7&_e,_e-=7&_e,i.mode=k_;break}for(;_e<3;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}switch(i.last=1&x,x>>>=1,_e-=1,3&x){case 0:i.mode=16193;break;case 1:if(P3(i),i.mode=nl,r===el){x>>>=2,_e-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=be}x>>>=2,_e-=2;break;case 16193:for(x>>>=7&_e,_e-=7&_e;_e<32;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if((65535&x)!=(x>>>16^65535)){e.msg="invalid stored block lengths",i.mode=be;break}if(i.length=65535&x,x=0,_e=0,i.mode=P_,r===el)break e;case P_:i.mode=16195;case 16195:if(fN=i.length,fN){if(fN>C&&(fN=C),fN>A&&(fN=A),fN===0)break e;h.set(o.subarray(p,p+fN),g),C-=fN,p+=fN,A-=fN,g+=fN,i.length-=fN;break}i.mode=Cr;break;case 16196:for(;_e<14;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(i.nlen=257+(31&x),x>>>=5,_e-=5,i.ndist=1+(31&x),x>>>=5,_e-=5,i.ncode=4+(15&x),x>>>=4,_e-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=be;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;_e<3;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}i.lens[VH[i.have++]]=7&x,x>>>=3,_e-=3}for(;i.have<19;)i.lens[VH[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,CH={bits:i.lenbits},AH=Ec(0,i.lens,0,19,i.lencode,0,i.work,CH),i.lenbits=CH.bits,AH){e.msg="invalid code lengths set",i.mode=be;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;UH=i.lencode[x&(1<<i.lenbits)-1],RN=UH>>>24,IN=UH>>>16&255,t0=65535&UH,!(RN<=_e);){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(t0<16)x>>>=RN,_e-=RN,i.lens[i.have++]=t0;else{if(t0===16){for(HH=RN+2;_e<HH;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(x>>>=RN,_e-=RN,i.have===0){e.msg="invalid bit length repeat",i.mode=be;break}vH=i.lens[i.have-1],fN=3+(3&x),x>>>=2,_e-=2}else if(t0===17){for(HH=RN+3;_e<HH;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}x>>>=RN,_e-=RN,vH=0,fN=3+(7&x),x>>>=3,_e-=3}else{for(HH=RN+7;_e<HH;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}x>>>=RN,_e-=RN,vH=0,fN=11+(127&x),x>>>=7,_e-=7}if(i.have+fN>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=be;break}for(;fN--;)i.lens[i.have++]=vH}}if(i.mode===be)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=be;break}if(i.lenbits=9,CH={bits:i.lenbits},AH=Ec(1,i.lens,0,i.nlen,i.lencode,0,i.work,CH),i.lenbits=CH.bits,AH){e.msg="invalid literal/lengths set",i.mode=be;break}if(i.distbits=6,i.distcode=i.distdyn,CH={bits:i.distbits},AH=Ec(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,CH),i.distbits=CH.bits,AH){e.msg="invalid distances set",i.mode=be;break}if(i.mode=nl,r===el)break e;case nl:i.mode=il;case il:if(C>=6&&A>=258){e.next_out=g,e.avail_out=A,e.next_in=p,e.avail_in=C,i.hold=x,i.bits=_e,C3(e,dN),g=e.next_out,h=e.output,A=e.avail_out,p=e.next_in,o=e.input,C=e.avail_in,x=i.hold,_e=i.bits,i.mode===Cr&&(i.back=-1);break}for(i.back=0;UH=i.lencode[x&(1<<i.lenbits)-1],RN=UH>>>24,IN=UH>>>16&255,t0=65535&UH,!(RN<=_e);){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(IN&&!(240&IN)){for(aH=RN,pH=IN,SH=t0;UH=i.lencode[SH+((x&(1<<aH+pH)-1)>>aH)],RN=UH>>>24,IN=UH>>>16&255,t0=65535&UH,!(aH+RN<=_e);){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}x>>>=aH,_e-=aH,i.back+=aH}if(x>>>=RN,_e-=RN,i.back+=RN,i.length=t0,IN===0){i.mode=16205;break}if(32&IN){i.back=-1,i.mode=Cr;break}if(64&IN){e.msg="invalid literal/length code",i.mode=be;break}i.extra=15&IN,i.mode=16201;case 16201:if(i.extra){for(HH=i.extra;_e<HH;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}i.length+=x&(1<<i.extra)-1,x>>>=i.extra,_e-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;UH=i.distcode[x&(1<<i.distbits)-1],RN=UH>>>24,IN=UH>>>16&255,t0=65535&UH,!(RN<=_e);){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(!(240&IN)){for(aH=RN,pH=IN,SH=t0;UH=i.distcode[SH+((x&(1<<aH+pH)-1)>>aH)],RN=UH>>>24,IN=UH>>>16&255,t0=65535&UH,!(aH+RN<=_e);){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}x>>>=aH,_e-=aH,i.back+=aH}if(x>>>=RN,_e-=RN,i.back+=RN,64&IN){e.msg="invalid distance code",i.mode=be;break}i.offset=t0,i.extra=15&IN,i.mode=16203;case 16203:if(i.extra){for(HH=i.extra;_e<HH;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}i.offset+=x&(1<<i.extra)-1,x>>>=i.extra,_e-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=be;break}i.mode=16204;case 16204:if(A===0)break e;if(fN=dN-A,i.offset>fN){if(fN=i.offset-fN,fN>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=be;break}fN>i.wnext?(fN-=i.wnext,mN=i.wsize-fN):mN=i.wnext-fN,fN>i.length&&(fN=i.length),EN=i.window}else EN=h,mN=g-i.offset,fN=i.length;fN>A&&(fN=A),A-=fN,i.length-=fN;do h[g++]=EN[mN++];while(--fN);i.length===0&&(i.mode=il);break;case 16205:if(A===0)break e;h[g++]=i.length,A--,i.mode=il;break;case k_:if(i.wrap){for(;_e<32;){if(C===0)break e;C--,x|=o[p++]<<_e,_e+=8}if(dN-=A,e.total_out+=dN,i.total+=dN,4&i.wrap&&dN&&(e.adler=i.check=en(i)?an(i.check,h,dN,g-dN):Gc(i.check,h,dN,g-dN)),dN=A,4&i.wrap&&(en(i)?x:hA(x))!==i.check){e.msg="incorrect data check",i.mode=be;break}x=0,_e=0}i.mode=16207;case 16207:if(i.wrap&&en(i)){for(;_e<32;){if(C===0)break e;C--,x+=o[p++]<<_e,_e+=8}if(4&i.wrap&&x!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=be;break}x=0,_e=0}i.mode=16208;case 16208:AH=w3;break e;case be:AH=J0;break e;case 16210:return X0;default:return Ci}return e.next_out=g,e.avail_out=A,e.next_in=p,e.avail_in=C,i.hold=x,i.bits=_e,(i.wsize||dN!==e.avail_out&&i.mode<be&&(i.mode<k_||r!==lA))&&tN(e,e.output,e.next_out,dN-e.avail_out),cN-=e.avail_in,dN-=e.avail_out,e.total_in+=cN,e.total_out+=dN,i.total+=dN,4&i.wrap&&dN&&(e.adler=i.check=en(i)?an(i.check,h,dN,e.next_out-dN):Gc(i.check,h,dN,e.next_out-dN)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Cr?128:0)+(i.mode===nl||i.mode===P_?256:0),(cN===0&&dN===0||r===lA)&&AH===Yo&&(AH=N3),AH},Or={inflateReset:Z0,inflateReset2:$0,inflateResetKeep:Q0,inflateInit:e=>pA(e,15),inflateInit2:pA,inflate:k3,inflateEnd:e=>{if(qo(e))return Ci;let r=e.state;return r.window&&(r.window=null),e.state=null,Yo},inflateGetHeader:(e,r)=>{if(qo(e))return Ci;let i=e.state;return 2&i.wrap?(i.head=r,r.done=!1,Yo):Ci},inflateSetDictionary:(e,r)=>{let i=r.length,o,h,p;return qo(e)?Ci:(o=e.state,o.wrap!==0&&o.mode!==Iu?Ci:o.mode===Iu&&(h=1,h=Gc(h,r,i,0),h!==o.check)?J0:(p=tN(e,r,i,i),p?(o.mode=16210,X0):(o.havedict=1,Yo)))},inflateInfo:"pako inflate (from Nodeca project)"},L3=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},eN=Object.prototype.toString,{Z_NO_FLUSH:M3,Z_FINISH:U3,Z_OK:mc,Z_STREAM_END:U_,Z_NEED_DICT:x_,Z_STREAM_ERROR:x3,Z_DATA_ERROR:EA,Z_MEM_ERROR:V3}=Ra;function fc(e){this.options=eh.assign({chunkSize:65536,windowBits:15,to:""},e||{});let r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new q0,this.strm.avail_out=0;let i=Or.inflateInit2(this.strm,r.windowBits);if(i!==mc)throw new Error(Zo[i]);if(this.header=new L3,Or.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Kc.string2buf(r.dictionary):eN.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=Or.inflateSetDictionary(this.strm,r.dictionary),i!==mc)))throw new Error(Zo[i])}function V_(e,r){let i=new fc(r);if(i.push(e),i.err)throw i.msg||Zo[i.err];return i.result}fc.prototype.push=function(e,r){let i=this.strm,o=this.options.chunkSize,h=this.options.dictionary,p,g,C;if(this.ended)return!1;for(g=r===~~r?r:r===!0?U3:M3,eN.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),p=Or.inflate(i,g),p===x_&&h&&(p=Or.inflateSetDictionary(i,h),p===mc?p=Or.inflate(i,g):p===EA&&(p=x_));i.avail_in>0&&p===U_&&i.state.wrap>0&&e[i.next_in]!==0;)Or.inflateReset(i),p=Or.inflate(i,g);switch(p){case x3:case EA:case x_:case V3:return this.onEnd(p),this.ended=!0,!1}if(C=i.avail_out,i.next_out&&(i.avail_out===0||p===U_))if(this.options.to==="string"){let A=Kc.utf8border(i.output,i.next_out),x=i.next_out-A,_e=Kc.buf2string(i.output,A);i.next_out=x,i.avail_out=o-x,x&&i.output.set(i.output.subarray(A,A+x),0),this.onData(_e)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(p!==mc||C!==0){if(p===U_)return p=Or.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},fc.prototype.onData=function(e){this.chunks.push(e)},fc.prototype.onEnd=function(e){e===mc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var F3={Inflate:fc,inflate:V_,inflateRaw:function(e,r){return(r=r||{}).raw=!0,V_(e,r)},ungzip:V_,constants:Ra},{Deflate:$H,deflate:B3,deflateRaw:t52,gzip:e5}=R3,{Inflate:n5,inflate:j3,inflateRaw:i5,ungzip:r5}=F3,G3=B3,W3=j3,nN=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(nN||{}),gm=class{constructor(){T(this,"_sequence",0),T(this,"_startTime",Date.now()),T(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let g=new Uint8Array(4);g.set([1,0,0,0]);let C={id:0,length:4,data:g.buffer},A={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[C]};r.commonPacketHeader.extension=1,r.extension=A,r.payload=this.compress(e),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;v("SHOW_DATASTREAM2_LOG")&&_.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));let i=new ArrayBuffer(r.commonPacketHeader.length),o=new Uint8Array(i),h=new DataView(i),p=0;if(h.setUint16(p,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),p+=2,h.setUint32(p,r.commonPacketHeader.sequence,!0),p+=4,h.setUint16(p,r.commonStreamHeader,!0),p+=2,r.extension){let g=this.serializeExtension(r.extension);o.set(new Uint8Array(g),p),p+=g.byteLength}if(o.set(new Uint8Array(r.payload),p),p+=r.payload.byteLength,p!==r.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let r=new DataView(e),i=0,o=r.getUint16(i,!0);i+=2;let h={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:r.getUint16(i+2,!0)<<16|r.getUint16(i,!0)},p,g;if(i+=4,v("SHOW_DATASTREAM2_LOG")&&_.debug("receive data header: ".concat(JSON.stringify(h))),r.getUint16(i,!0),i+=2,h.extension){g=this.deserializeExtension(e.slice(i)),i+=2+g.length,p=e.slice(i);let C=!1;if(g.datas.length>0){let A=g.datas.find(x=>x.id===0);A&&(C=(1&new DataView(A.data).getUint32(0,!0))==1)}p=C?this.decompress(p):p}else p=e.slice(8);return p}serializeExtension(e){let{profile:r,length:i,datas:o}=e,h=new ArrayBuffer(i+2),p=new Uint8Array(h),g=new DataView(h),C=0;if(g.setUint8(C++,r),g.setUint8(C++,i),o.forEach(A=>{r?(g.setUint8(C++,A.id),g.setUint8(C++,A.length),p.set(new Uint8Array(A.data),C),C+=A.data.byteLength):(g.setUint8(C++,A.id|A.length<<4),p.set(new Uint8Array(A.data),C),C+=A.data.byteLength)}),C!==i+2)throw Error("serialize extension error, is ".concat(C,"!==").concat(i+2));return h}deserializeExtension(e){let r=new DataView(e),i=0,o=r.getUint8(i);i++;let h=r.getUint8(i);i++;let p=o===nN.TWO_BYTE,g=[],C=new DataView(e,2),A=0;for(;A<h;){let x=0,_e=0,cN=new ArrayBuffer(0);p?(x=C.getUint8(A),A++,_e=C.getUint8(A),A++):(x=15&C.getUint8(A),_e=C.getUint8(A)>>4,A++),_e>0&&(cN=C.buffer.slice(A+2,A+2+_e),A+=cN.byteLength),g.push({id:x,length:_e,data:cN})}if(A!==h)throw Error("parse error");return{profile:o,length:h,datas:g}}decompress(e){return W3(new Uint8Array(e))}compress(e){return G3(new Uint8Array(e))}},H3={name:"DataStream",create:(e,r)=>{let i=r?new QE(e):new ZE(e);return i.useDataStream(new gm),i}},Tm=class extends Xt{constructor(e,r,i){super(),T(this,"ws",void 0),T(this,"requestId",1),T(this,"heartBeatTimer",void 0),T(this,"joinInfo",void 0),T(this,"clientId",void 0),T(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),T(this,"onClose",o=>{this.emit("close"),this.dispose()}),T(this,"onMessage",o=>{let h=JSON.parse(o.data);if(!h||h.command!=="serverResponse"||!h.requestId)return h&&h.command==="serverStatus"&&h.serverStatus&&h.serverStatus.command?(this.emit("status",h.serverStatus),void this.emit(h.serverStatus.command,h.serverStatus)):void 0;this.emit("req_".concat(h.requestId),h)}),this.joinInfo=e,this.clientId=r,this.ws=new Qo("cross-channel-".concat(this.clientId),i),this.ws.on(it.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(it.CONNECTED,this.onOpen),this.ws.on(it.ON_MESSAGE,this.onMessage),this.ws.on(it.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){let r=this.requestId++;return e.requestId=r,e.seq=r,this.ws.sendMessage(e),r}waitStatus(e){return new j((r,i)=>{let o=window.setTimeout(()=>{i(new O(R.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,h=>{window.clearTimeout(o),h.state&&h.state!==0?i(new O(R.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new O(R.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new O(R.WS_DISCONNECT);let r=()=>new j((p,g)=>{this.ws.once(it.CLOSED,()=>g(new O(R.WS_ABORT))),this.ws.once(it.CONNECTED,p)});this.ws.state!=="connected"&&await r();let i=this.sendMessage(e),o=new j((p,g)=>{let C=()=>{g(new O(R.WS_ABORT))};this.ws.once(it.RECONNECTING,C),this.ws.once(it.CLOSED,C),this.once("req_".concat(i),p),Me(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(it.RECONNECTING,C),this.ws.off(it.CLOSED,C),g(new O(R.TIMEOUT,"cross channel ws request timeout"))})}),h=await o;if(!h||h.code!==200)throw new O(R.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h}async connect(e){this.ws.removeAllListeners(it.REQUEST_NEW_URLS),this.ws.on(it.REQUEST_NEW_URLS,r=>{r(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let r=this.requestId++;return e.requestId=r,this.ws.sendMessage(e),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},Sm=class extends Xt{set state(e){e!==this._state&&(e!==Sn.RELAY_STATE_FAILURE&&(this.errorCode=ys.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,r,i,o,h){super(),T(this,"joinInfo",void 0),T(this,"sid",void 0),T(this,"clientId",void 0),T(this,"cancelToken",mn.CancelToken.source()),T(this,"workerToken",void 0),T(this,"requestId",0),T(this,"signal",void 0),T(this,"prevChannelMediaConfig",void 0),T(this,"httpRetryConfig",void 0),T(this,"_resolution",void 0),T(this,"_state",Sn.RELAY_STATE_IDLE),T(this,"errorCode",ys.RELAY_OK),T(this,"onStatus",p=>{_.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&(p.command==="onAudioPacketReceived"&&this.emit("event",Ir.PACKET_RECEIVED_AUDIO_FROM_SRC),p.command==="onVideoPacketReceived"&&this.emit("event",Ir.PACKET_RECEIVED_VIDEO_FROM_SRC),p.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=ys.SRC_TOKEN_EXPIRED,this.state=Sn.RELAY_STATE_FAILURE),p.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=ys.DEST_TOKEN_EXPIRED,this.state=Sn.RELAY_STATE_FAILURE))}),T(this,"onReconnect",async()=>{_.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ir.NETWORK_DISCONNECTED),this.state=Sn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(p=>{this.state!==Sn.RELAY_STATE_IDLE&&(_.error("auto restart channel media relay failed",p.toString()),this.errorCode=ys.SERVER_CONNECTION_LOST,this.state=Sn.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=r,this.sid=Ms(),this.signal=new Tm(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=h}async startChannelMediaRelay(e){if(this.state!==Sn.RELAY_STATE_IDLE)throw new O(R.INVALID_OPERATION);this.state=Sn.RELAY_STATE_CONNECTING,await this.connect(),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new O(R.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new O(R.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new O(R.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Sn.RELAY_STATE_RUNNING)throw new O(R.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Sn.RELAY_STATE_RUNNING)throw new O(R.INVALID_OPERATION);let r=this.genMessage(sn.SetVideoProfile);await this.signal.request(r),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),_.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Sn.RELAY_STATE_IDLE,this.dispose()}dispose(){_.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mn.CancelToken.source(),this.state=Sn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await zG(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Ir.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let r=this.genMessage(sn.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let i=this.genMessage(sn.SetSdkProfile,e);await this.signal.request(i),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let o=this.genMessage(sn.SetSourceChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ir.PACKET_JOINED_SRC_CHANNEL),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let h=this.genMessage(sn.SetSourceUserId,e);await this.signal.request(h),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let p=this.genMessage(sn.SetDestChannel,e);await this.signal.request(p),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ir.PACKET_JOINED_DEST_CHANNEL),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let g=this.genMessage(sn.StartPacketTransfer,e);await this.signal.request(g),this.emit("event",Ir.PACKET_SENT_TO_DEST_CHANNEL),this.state=Sn.RELAY_STATE_RUNNING,_.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let r=this.genMessage(sn.UpdateDestChannel,e);await this.signal.request(r),this.emit("event",Ir.PACKET_UPDATE_DEST_CHANNEL),_.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(sn.StopPacketTransfer);await this.signal.request(e),_.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,r){let i=[],o=[],h=[];this.requestId+=1;let p={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ii,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};p.sdkVersion==="4.22.0"&&(p.sdkVersion="0.0.1");let g=null,C=null;switch(e){case sn.SetSdkProfile:return p.clientRequest={command:"SetSdkProfile",type:"multi_channel"},p;case sn.SetSourceChannel:if(C=r&&r.getSrcChannelMediaInfo(),!C)throw new O(R.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceChannel",uid:"0",channelName:C.channelName,token:C.token||this.joinInfo.appId},p;case sn.SetSourceUserId:if(C=r&&r.getSrcChannelMediaInfo(),!C)throw new O(R.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceUserId",uid:C.uid+""},p;case sn.SetDestChannel:if(g=r&&r.getDestChannelMediaInfo(),!g)throw new O(R.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(A=>{i.push(A.channelName),o.push(A.uid+""),h.push(A.token||this.joinInfo.appId)}),p.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:h},p;case sn.StartPacketTransfer:return p.clientRequest={command:"StartPacketTransfer"},p;case sn.Reconnect:return p.clientRequest={command:"Reconnect"},p;case sn.StopPacketTransfer:return p.clientRequest={command:"StopPacketTransfer"},p;case sn.UpdateDestChannel:if(g=r&&r.getDestChannelMediaInfo(),!g)throw new O(R.UNEXPECTED_ERROR,"can not find dest config");return g.forEach(A=>{i.push(A.channelName),o.push(A.uid+""),h.push(A.token||this.joinInfo.appId)}),p.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:h},p;case sn.SetVideoProfile:p.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return p}},K3={name:"ChannelMediaRelay",create:function(e){return new Sm(e.joinInfo,e.clientId,e.websocketRetryConfig||Ee,e.httpRetryConfig||Ee,e.resolution)}};function mA(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Ga(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?mA(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mA(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Rm=class extends Xt{constructor(e,r,i,o){super(),T(this,"spec",void 0),T(this,"token",void 0),T(this,"websocket",void 0),T(this,"pingpongTimer",void 0),T(this,"reconnectMode","retry"),T(this,"serviceMode",void 0),T(this,"reqId",0),T(this,"commandReqId",0),T(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),T(this,"handleWebSocketMessage",h=>{if(!h.data)return;let p=JSON.parse(h.data);p.requestId?this.emit("@".concat(p.requestId,"-").concat(p.sid),p):(X.workerEvent(this.spec.sid,{actionType:"status",serverCode:p.code,workerType:this.serviceMode===er.TRANSCODE?1:2}),this.emit(Xr.PUBLISH_STREAM_STATUS,p))}),this.spec=r,this.token=e,this.serviceMode=o,this.websocket=new Qo("live-streaming",i),this.websocket.on(it.CONNECTED,this.handleWebSocketOpen),this.websocket.on(it.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(it.REQUEST_NEW_URLS,(h,p)=>{Ge(this,Xr.REQUEST_NEW_ADDRESS).then(h).catch(p)}),this.websocket.on(it.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,r,i,o){this.reqId+=1,e==="request"&&(this.commandReqId+=1);let h=this.commandReqId,p=this.reqId;if(!p||!this.websocket)throw new O(R.UNEXPECTED_ERROR);let g=Ga({command:e,sdkVersion:ii==="4.22.0"?"0.0.1":ii,seq:p,requestId:p,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new O(R.WS_DISCONNECT);let C=()=>new j((cN,dN)=>{this.websocket.once(it.CLOSED,()=>dN(new O(R.WS_ABORT))),this.websocket.once(it.CONNECTED,cN)});this.websocket.state!=="connected"&&await C(),g.clientRequest&&(g.clientRequest.workerToken=this.token);let A=new j((cN,dN)=>{let fN=()=>{dN(new O(R.WS_ABORT))};this.websocket.once(it.RECONNECTING,fN),this.websocket.once(it.CLOSED,fN),this.once("@".concat(p,"-").concat(this.spec.sid),mN=>{cN(mN)})});o&&X.workerEvent(this.spec.sid,Ga(Ga({},o),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));let x=Date.now();this.websocket.sendMessage(g);let _e=null;try{_e=await A}catch(cN){if(this.websocket.state==="closed")throw cN;return await C(),await this.request(e,r,i)}return o&&X.workerEvent(this.spec.sid,Ga(Ga({},o),{},{requestId:h,actionType:"response",payload:JSON.stringify(_e.serverResponse),serverCode:_e.code,success:_e.code===200,responseTime:Date.now()-x})),_e.code!==200&&this.handleResponseError(_e),_e}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e=ii==="4.22.0"?"0.0.1":ii;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case fe.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void _.warning("live stream response already exists stream");case fe.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case fe.LIVE_STREAM_RESPONSE_BAD_STREAM:case fe.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new O(R.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case fe.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case fe.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new O(R.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case fe.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let r=new O(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Xr.WARNING,r,e.serverResponse.url)}case fe.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let r=new O(R.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Xr.WARNING,r,e.serverResponse.url)}case fe.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case fe.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new O(R.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case fe.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let r=new O(R.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Xr.WARNING,r,e.serverResponse.url)}case fe.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case fe.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case fe.LIVE_STREAM_RESPONSE_WORKER_LOST:case fe.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case fe.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case fe.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new O(R.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(zu)},6e3)}};function fA(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function Tn(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?fA(Object(i),!0).forEach(function(o){T(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fA(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Cm=class extends Xt{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ee,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ee;super(),T(this,"onLiveStreamWarning",void 0),T(this,"onLiveStreamError",void 0),T(this,"spec",void 0),T(this,"retryTimeout",1e4),T(this,"connection",void 0),T(this,"httpRetryConfig",void 0),T(this,"wsRetryConfig",void 0),T(this,"streamingTasks",new Map),T(this,"isStartingStreamingTask",!1),T(this,"taskMutex",new ze("live-streaming")),T(this,"cancelToken",mn.CancelToken.source()),T(this,"transcodingConfig",void 0),T(this,"uapResponse",void 0),T(this,"lastTaskId",1),T(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=r}async setTranscodingConfig(e){let r=Tn(Tn({},aj),e);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(_.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(p=>Tn(Tn(Tn({},sj),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),function(p){zt(p.width)||Nt(p.width,"config.width",0,1e4),zt(p.height)||Nt(p.height,"config.height",0,1e4),zt(p.videoBitrate)||Nt(p.videoBitrate,"config.videoBitrate",1,1e6),zt(p.videoFrameRate)||Nt(p.videoFrameRate,"config.videoFrameRate"),zt(p.lowLatency)||Nr(p.lowLatency,"config.lowLatency"),zt(p.audioSampleRate)||Ce(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),zt(p.audioBitrate)||Nt(p.audioBitrate,"config.audioBitrate",1,128),zt(p.audioChannels)||Ce(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),zt(p.videoGop)||Nt(p.videoGop,"config.videoGop"),zt(p.videoCodecProfile)||Ce(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),zt(p.userCount)||Nt(p.userCount,"config.userCount",0,17),zt(p.backgroundColor)||Nt(p.backgroundColor,"config.backgroundColor",0,16777215),zt(p.userConfigExtraInfo)||Pe(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!zt(p.transcodingUsers)&&(br(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((g,C)=>{Qu(g.uid),zt(g.x)||Nt(g.x,"transcodingUser[".concat(C,"].x"),0,1e4),zt(g.y)||Nt(g.y,"transcodingUser[".concat(C,"].y"),0,1e4),zt(g.width)||Nt(g.width,"transcodingUser[".concat(C,"].width"),0,1e4),zt(g.height)||Nt(g.height,"transcodingUser[".concat(C,"].height"),0,1e4),zt(g.zOrder)||Nt(g.zOrder-1,"transcodingUser[".concat(C,"].zOrder"),0,100),zt(g.alpha)||Nt(g.alpha,"transcodingUser[".concat(C,"].alpha"),0,1,!1)})),zt(p.watermark)||xp(p.watermark,"watermark"),zt(p.backgroundImage)||xp(p.backgroundImage,"backgroundImage"),p.images&&!zt(p.images)&&(br(p.images,"config.images"),p.images.forEach((g,C)=>{xp(g,"images[".concat(C,"]"))}))}(r);let i=[];r.images&&i.push(...r.images.map(p=>Tn(Tn(Tn({},Up),p),{},{zOrder:255}))),r.backgroundImage&&(i.push(Tn(Tn(Tn({},Up),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(i.push(Tn(Tn(Tn({},Up),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=i,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(p=>Tn({},p)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);let o=(r.userConfigs||[]).map(p=>typeof p.uid=="number"?j.resolve(p.uid):h0(p.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await j.all(o)).forEach((p,g)=>{r.userConfigs&&r.userConfigs[g]&&(r.userConfigs[g].uid=p)}),this.transcodingConfig=r,this.connection)try{var h;let p=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pr(h=this.streamingTasks).call(h)).map(g=>g.taskId).join("#")});_.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(g=>{_.warning("[".concat(this.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,p).then(()=>{_.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(g.url," success"))}).catch(C=>{_.error("[".concat(this.spec.clientId,"] live streaming republish failed"),g.url,C.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,C)})})}}async startLiveStreamingTask(e,r,i){if(!this.transcodingConfig&&r===er.TRANSCODE)throw new O(R.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let o={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};_.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(r));let h=await this.taskMutex.lock();if(!this.connection&&i)return void h();if(this.streamingTasks.get(e)&&!i)return h(),new O(R.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(g){throw h(),g}switch(r){case er.TRANSCODE:o.transcodingConfig=Tn({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let p=this.lastTaskId++;try{let g=new j((A,x)=>{Me(this.retryTimeout).then(()=>{if(i)return x(i);let _e=this.statusError.get(e);return _e?(this.statusError.delete(e),x(_e)):void 0})}),C=await j.race([this.connection.request("request",{clientRequest:o},!0,{url:e,command:"PublishStream",workerType:r===er.TRANSCODE?1:2,requestByUser:!i,tid:p.toString()}),g]);this.isStartingStreamingTask=!1,_.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(C.code)),this.streamingTasks.set(e,{clientRequest:o,mode:r,url:e,taskId:p}),h()}catch(g){if(h(),this.isStartingStreamingTask=!1,!g.data||!g.data.retry||i)throw g;return g.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,r,g)):await this.startLiveStreamingTask(e,r,g)}}stopLiveStreamingTask(e){return new j((r,i)=>{let o=this.streamingTasks.get(e);if(!o||!this.connection)return new O(R.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let h=o.mode;o.abortTask=()=>{_.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:e,command:"UnPublishStream",workerType:h===er.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(p=>{_.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(p.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(i)})}resetAllTask(){var e;let r=Array.from(Pr(e=this.streamingTasks).call(e));this.terminate();for(let i of r)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new O(R.UNEXPECTED_ERROR,"live streaming connection has already connected");let r=await Ge(this,VE.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=r,this.connection=new Rm(r.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Xr.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(Xr.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Xr.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new O(R.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ge(this,VE.REQUEST_WORKER_MANAGER_LIST,e).then(h=>{this.uapResponse=h,i(h.addressList)}).catch(o)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(e){let r=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(r),o=e.reason;switch(e.code){case fe.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let p=new O(R.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return _.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,p);if(!this.isStartingStreamingTask)return;this.statusError.set(r,p)}case fe.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let p=new O(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,p)}case fe.LIVE_STREAM_RESPONSE_WORKER_LOST:case fe.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var h;if(!this.connection)return;this.connection.tryNextAddress();let p=Array.from(Pr(h=this.streamingTasks).call(h));for(let g of p)g.abortTask?g.abortTask():(_.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",g.url),this.startLiveStreamingTask(g.url,g.mode,new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{_.debug("[".concat(this.spec.clientId,"] republish live stream success"),g.url)}).catch(C=>{_.error(C.toString()),this.onLiveStreamError&&this.onLiveStreamError(g.url,C)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}},Y3={name:"LiveStreaming",create:function(e){return new Cm(e.joinInfo,e.websocketRetryConfig||Ee,e.httpRetryConfig||Ee)}};function q3(e){let r=gA();return function(i,o){let h=i.appId;h!==void 0&&(yt(o,10),tr(o,h));let p=i.cid;p!==void 0&&(yt(o,16),yt(o,p));let g=i.cname;g!==void 0&&(yt(o,26),tr(o,g));let C=i.deviceId;C!==void 0&&(yt(o,34),tr(o,C));let A=i.elapse;A!==void 0&&(yt(o,40),Yr(o,A));let x=i.fileSize;x!==void 0&&(yt(o,48),Yr(o,Cs(x)));let _e=i.height;_e!==void 0&&(yt(o,56),Yr(o,Cs(_e)));let cN=i.jpg;cN!==void 0&&(yt(o,66),yt(o,cN.length),function(GH,yH){let TH=Ca(GH,yH.length);GH.bytes.set(yH,TH)}(o,cN));let dN=i.networkType;dN!==void 0&&(yt(o,72),Yr(o,Cs(dN)));let fN=i.osType;fN!==void 0&&(yt(o,80),Yr(o,Cs(fN)));let mN=i.requestId;mN!==void 0&&(yt(o,90),tr(o,mN));let EN=i.sdkVersion;EN!==void 0&&(yt(o,98),tr(o,EN));let RN=i.sequence;RN!==void 0&&(yt(o,104),Yr(o,Cs(RN)));let IN=i.sid;IN!==void 0&&(yt(o,114),tr(o,IN));let t0=i.timestamp;t0!==void 0&&(yt(o,120),Yr(o,t0));let aH=i.uid;aH!==void 0&&(yt(o,128),yt(o,aH));let pH=i.vid;pH!==void 0&&(yt(o,136),yt(o,pH));let SH=i.width;SH!==void 0&&(yt(o,144),Yr(o,Cs(SH)));let vH=i.service;vH!==void 0&&(yt(o,152),yt(o,vH));let AH=i.callbackData;AH!==void 0&&(yt(o,162),tr(o,AH));let UH=i.jpgEncryption;UH!==void 0&&(yt(o,168),yt(o,UH));let zH=i.requestType;zH!==void 0&&(yt(o,176),yt(o,zH));let CH=i.scorePorn;CH!==void 0&&(yt(o,185),j_(o,CH));let HH=i.scoreSexy;HH!==void 0&&(yt(o,193),j_(o,HH));let VH=i.scoreNeutral;VH!==void 0&&(yt(o,201),j_(o,VH));let KH=i.scene;KH!==void 0&&(yt(o,208),yt(o,KH));let IH=i.ossFilePrefix;IH!==void 0&&(yt(o,218),tr(o,IH));let MH=i.serviceVendor;if(MH!==void 0)for(let GH of MH){yt(o,226);let yH=gA();X3(GH,yH),yt(o,yH.limit),tH(o,yH),$3(yH)}}(e,r),function(i){let o=i.bytes,h=i.limit;return o.length===h?o:o.subarray(0,h)}(r)}function z3(e){return function(i){let o={};e:for(;!oN(i);){let h=or(i);switch(h>>>3){case 0:break e;case 1:o.code=or(i);break;case 2:o.msg=sN(i,or(i));break;case 3:{let p=Q3(i);o.data=J3(i),i.limit=p;break}default:iN(i,7&h)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function J3(e){let r={};e:for(;!oN(e);){let i=or(e);switch(i>>>3){case 0:break e;case 1:r.requestId=sN(e,or(e));break;case 2:r.requestType=or(e)>>>0;break;case 3:r.scorePorn=B_(e);break;case 4:r.scoreSexy=B_(e);break;case 5:r.scoreNeutral=B_(e);break;case 6:r.requestScene=or(e)>>>0;break;case 7:r.scene=or(e)>>>0;break;default:iN(e,7&i)}}return r}function X3(e,r){let i=e.service;i!==void 0&&(yt(r,8),yt(r,i));let o=e.vendor;o!==void 0&&(yt(r,16),yt(r,o));let h=e.token;h!==void 0&&(yt(r,26),tr(r,h));let p=e.callbackUrl;p!==void 0&&(yt(r,34),tr(r,p))}function Q3(e){let r=or(e),i=e.limit;return e.limit=e.offset+r,i}function iN(e,r){switch(r){case 0:for(;128&aN(e););break;case 2:F_(e,or(e));break;case 5:F_(e,4);break;case 1:F_(e,8);break;default:throw new Error("Unimplemented type: "+r)}}var Z3=new Float32Array(1);new Uint8Array(Z3.buffer);var Lf=new Float64Array(1),Rn=new Uint8Array(Lf.buffer);function Cs(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var rN=[];function gA(){let e=rN.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function $3(e){rN.push(e)}function F_(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function oN(e){return e.offset>=e.limit}function Ca(e,r){let i=e.bytes,o=e.offset,h=e.limit,p=o+r;if(p>i.length){let g=new Uint8Array(2*p);g.set(i),e.bytes=g}return e.offset=p,p>h&&(e.limit=p),o}function Mf(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function sN(e,r){let i=Mf(e,r),o=String.fromCharCode,h=e.bytes,p="�",g="";for(let C=0;C<r;C++){let A,x,_e,cN,dN=h[C+i];128&dN?(224&dN)==192?C+1>=r?g+=p:(A=h[C+i+1],(192&A)!=128?g+=p:(cN=(31&dN)<<6|63&A,cN<128?g+=p:(g+=o(cN),C++))):(240&dN)==224?C+2>=r?g+=p:(A=h[C+i+1],x=h[C+i+2],(49344&(A|x<<8))!=32896?g+=p:(cN=(15&dN)<<12|(63&A)<<6|63&x,cN<2048||cN>=55296&&cN<=57343?g+=p:(g+=o(cN),C+=2))):(248&dN)==240?C+3>=r?g+=p:(A=h[C+i+1],x=h[C+i+2],_e=h[C+i+3],(12632256&(A|x<<8|_e<<16))!=8421504?g+=p:(cN=(7&dN)<<18|(63&A)<<12|(63&x)<<6|63&_e,cN<65536||cN>1114111?g+=p:(cN-=65536,g+=o(55296+(cN>>10),56320+(1023&cN)),C+=3))):g+=p:g+=o(dN)}return g}function tr(e,r){let i=r.length,o=0;for(let g=0;g<i;g++){let C=r.charCodeAt(g);C>=55296&&C<=56319&&g+1<i&&(C=(C<<10)+r.charCodeAt(++g)-56613888),o+=C<128?1:C<2048?2:C<65536?3:4}yt(e,o);let h=Ca(e,o),p=e.bytes;for(let g=0;g<i;g++){let C=r.charCodeAt(g);C>=55296&&C<=56319&&g+1<i&&(C=(C<<10)+r.charCodeAt(++g)-56613888),C<128?p[h++]=C:(C<2048?p[h++]=C>>6&31|192:(C<65536?p[h++]=C>>12&15|224:(p[h++]=C>>18&7|240,p[h++]=C>>12&63|128),p[h++]=C>>6&63|128),p[h++]=63&C|128)}}function tH(e,r){let i=Ca(e,r.limit),o=e.bytes,h=r.bytes;for(let p=0,g=r.limit;p<g;p++)o[p+i]=h[p]}function aN(e){return e.bytes[Mf(e,1)]}function TA(e,r){let i=Ca(e,1);e.bytes[i]=r}function B_(e){let r=Mf(e,8),i=e.bytes;return Rn[0]=i[r++],Rn[1]=i[r++],Rn[2]=i[r++],Rn[3]=i[r++],Rn[4]=i[r++],Rn[5]=i[r++],Rn[6]=i[r++],Rn[7]=i[r++],Lf[0]}function j_(e,r){let i=Ca(e,8),o=e.bytes;Lf[0]=r,o[i++]=Rn[0],o[i++]=Rn[1],o[i++]=Rn[2],o[i++]=Rn[3],o[i++]=Rn[4],o[i++]=Rn[5],o[i++]=Rn[6],o[i++]=Rn[7]}function or(e){let r,i=0,o=0;do r=aN(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function yt(e,r){for(r>>>=0;r>=128;)TA(e,127&r|128),r>>>=7;TA(e,r)}function Yr(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,h=r.high>>>24,p=h===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:h<128?9:10,g=Ca(e,p),C=e.bytes;switch(p){case 10:C[g+9]=h>>>7&1;case 9:C[g+8]=p!==9?128|h:127&h;case 8:C[g+7]=p!==8?o>>>21|128:o>>>21&127;case 7:C[g+6]=p!==7?o>>>14|128:o>>>14&127;case 6:C[g+5]=p!==6?o>>>7|128:o>>>7&127;case 5:C[g+4]=p!==5?128|o:127&o;case 4:C[g+3]=p!==4?i>>>21|128:i>>>21&127;case 3:C[g+2]=p!==3?i>>>14|128:i>>>14&127;case 2:C[g+1]=p!==2?i>>>7|128:i>>>7&127;case 1:C[g]=p!==1?128|i:127&i}}function SA(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}var eH=new Map([["moderation",1],["supervise",2]]);function RA(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var Im=class extends Xt{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let r=this._connectionState;this._connectionState=e,this.emit(we.CONNECTION_STATE_CHANGE,r,e)}get inspectType(){return this._inspectType}set inspectType(e){var r;this._inspectMode=ji(r=e.map(i=>eH.get(i)||0)).call(r,(i,o)=>i+o),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),T(this,"name","AgoraRTCVideoContentInspect"),T(this,"_connectionState",Ei.CONNECTING),T(this,"_innerConnectionState",void 0),T(this,"sequence",0),T(this,"inspectStartTime",void 0),T(this,"workerManagerConnection",void 0),T(this,"workerConnection",void 0),T(this,"workerMessageLengthLimit",void 0),T(this,"inspectIntervalMinimum",void 0),T(this,"qualityRatio",void 0),T(this,"_connectInfo",void 0),T(this,"_cancelTokenSource",mn.CancelToken.source()),T(this,"_retryConfig",void 0),T(this,"wmSequence",0),T(this,"inspectInterval",void 0),T(this,"inspectTimer",null),T(this,"ossFilePrefix",void 0),T(this,"extraInfo",void 0),T(this,"_inspectType",void 0),T(this,"_inspectMode",void 0),T(this,"_quality",1),T(this,"qualityTimer",null),T(this,"_inspectId",void 0),T(this,"_needWorkUrlOnly",!1),T(this,"inspectImage",()=>{if(this.connectionState!==Ei.CONNECTED)throw new O(R.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ei.CONNECTED?this.requestToInspectImage():_.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ut(5,"inspect-"),this.workerMessageLengthLimit=v("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=v("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=v("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qo("worker-manager-"+this._inspectId,Ee),this.on(we.STATE_CHANGE,(r,i)=>{this._innerConnectionState=r,_.debug("[".concat(this._inspectId,"] Inspect operation :").concat(di[r]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Qo("worker-"+this._inspectId,Ee),this.handleWorkerEvents()}async init(e,r){this.emit(we.STATE_CHANGE,di.CONNECT_AP),this._connectInfo=e;let i=this._cancelTokenSource.token;return this._retryConfig=r,new j((o,h)=>{this.on(we.CONNECTION_STATE_CHANGE,(p,g)=>{g===Ei.CONNECTED&&o()}),this.requestAP(e,i,r).then(p=>{this.connectWorkerManager(p)}).catch(p=>{h(p)})})}async requestAP(e,r,i){let o=v("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=await function(g,C,A,x){let{appId:_e,areaCode:cN,cname:dN,sid:fN,token:mN,uid:EN}=C;Ys++;let RN="image_moderation_api",IN={service_name:RN,json_body:JSON.stringify({appId:_e,areaCode:cN,cname:dN,command:"allocateEdge",requestId:Ys,seq:Ys,sid:fN,token:mN,ts:Date.now(),uid:EN+""})},t0,aH,pH=g[0];return Wi(async()=>{t0=Date.now();let SH=await Hi(pH,{data:IN,cancelToken:A,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(aH=Date.now()-t0,SH.code!==0){let zH=new O(R.UNEXPECTED_RESPONSE,"image inspect ap error, code"+SH.code,{retry:!0,responseTime:aH});throw _.error(zH.toString()),zH}let vH=JSON.parse(SH.json_body);if(vH.code!==200){let zH=new O(R.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(vH.code,", reason: ").concat(vH.reason),{code:vH.code,responseTime:aH});throw _.error(zH.toString()),zH}if(!vH.servers||!Array.isArray(vH.servers)||vH.servers.length===0){let zH=new O(R.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:vH.code,responseTime:aH});throw _.error(zH.toString()),zH}let AH=v("VIDEO_INSPECT_WORKER_MANAGER_HOST"),UH=v("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:vH.servers.map(zH=>{let{address:CH,wss:HH}=zH;if(CH&&HH)return"wss://".concat(CH.replace(/\./g,"-"),".").concat(AH,":").concat(UH||HH)}).filter(zH=>!!zH),workerToken:vH.workerToken,vid:vH.vid,responseTime:aH}},(SH,vH)=>(X.apworkerEvent(fN,{success:!0,sc:200,serviceName:RN,responseDetail:JSON.stringify(SH.addressList),firstSuccess:vH===0,responseTime:aH,serverIp:g[vH%g.length]}),!1),(SH,vH)=>(X.apworkerEvent(fN,{success:!1,sc:SH.data&&SH.data.code||200,serviceName:RN,responseTime:aH,serverIp:g[vH%g.length]}),!!(SH.code!==R.OPERATION_ABORTED&&SH.code!==R.UNEXPECTED_RESPONSE||SH.data&&SH.data.retry)&&(pH=g[(vH+1)%g.length],!0)),x)}(o,e,r,i);this.emit(we.STATE_CHANGE,di.AP_CONNECTED);let{addressList:p}=h;return this.wmSequence++,p}async connectWorkerManager(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(we.STATE_CHANGE,di.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(it.CONNECTED,async()=>{this.emit(we.STATE_CHANGE,di.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(it.CLOSED,()=>{this._innerConnectionState<di.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(it.FAILED,()=>{this._innerConnectionState<di.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(it.RECONNECTING,()=>{this._innerConnectionState<di.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(it.ON_MESSAGE,async e=>{this.emit(we.STATE_CHANGE,di.GET_WORKER_MANAGER_RESPONSE);let r=this.workerManagerConnection.url;this.workerManagerConnection.close();let i=JSON.parse(e.data);if(i.code!==200)throw _.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new O(R.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&r))throw _.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new O(R.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{let o=v("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,h=r.replace(/:\d+\/?$/,":".concat(o));this.emit(we.STATE_CHANGE,di.CONNECT_WORKER,h),this._needWorkUrlOnly?this.emit(we.REQUEST_NEW_WORKER_URL,h):await this.connectWorker(h)}}),this.workerManagerConnection.on(it.WILL_RECONNECT,(e,r,i)=>{i(e)}),this.workerManagerConnection.on(it.REQUEST_NEW_URLS,(e,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(r)})}handleWorkerEvents(){this.workerConnection.on(it.CONNECTED,async()=>{this.emit(we.STATE_CHANGE,di.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ei.CONNECTED}),this.workerConnection.on(it.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let i=z3(new Uint8Array(e.data));if(v("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&_.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(we.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var r;let o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},h=ji(r=Object.keys(o)).call(r,(g,C)=>o[g]>o[C]?g:C,"porn"),p=Object.keys(o).find(g=>g===h);this.emit(we.INSPECT_RESULT,p)}else this.emit(we.INSPECT_RESULT,void 0,new O(R.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(we.INSPECT_RESULT,void 0,new O(R.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else _.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(we.INSPECT_RESULT,void 0,new O(R.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(it.CLOSED,()=>{this.connectionState=Ei.CLOSED}),this.workerConnection.on(it.FAILED,()=>{this.connectionState=Ei.CLOSED}),this.workerConnection.on(it.RECONNECTING,()=>{this.connectionState=this.connectionState===Ei.CONNECTED?Ei.RECONNECTING:Ei.CONNECTING}),this.workerConnection.on(it.WILL_RECONNECT,(e,r,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(it.REQUEST_NEW_URLS,(e,r)=>{this.workerManagerConnection.close(),this.once(we.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{r(i)})})}async requestToInspectImage(){this.sequence++;let e=ni(this,we.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(we.INSPECT_RESULT,void 0,new O(R.INVALID_OPERATION,"Only the track being played can be inspected"));let i=await this.generateRequestData(e,r);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(we.INSPECT_RESULT,void 0,new O(R.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,r){let{appId:i,cname:o,cid:h,vid:p,sid:g,uid:C}=r,A=Date.now(),x=await e.getCurrentFrameImage("image/jpeg",this.quality),_e=await QO(x,i,o),cN=this.sequence+"-"+h+"-"+C+"-"+A+"-"+Ut(12,""),dN={appId:i,cid:h,cname:o,deviceId:"",elapse:RA(Number(A-this.inspectStartTime)),fileSize:_e.byteLength,jpgEncryption:2,height:x.height,width:x.width,jpg:_e,networkType:6,osType:7,requestId:cN,sdkVersion:"4.22.0",sequence:this.sequence,sid:g,timestamp:RA(A),uid:C,vid:p,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete dN.callbackData,this.ossFilePrefix===void 0&&delete dN.ossFilePrefix;let fN=q3(dN);if(fN.byteLength<this.workerMessageLengthLimit){if(v("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let mN=function(EN){for(var RN=1;RN<arguments.length;RN++){var IN=arguments[RN]!=null?arguments[RN]:{};RN%2?SA(Object(IN),!0).forEach(function(t0){T(EN,t0,IN[t0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(EN,Object.getOwnPropertyDescriptors(IN)):SA(Object(IN)).forEach(function(t0){Object.defineProperty(EN,t0,Object.getOwnPropertyDescriptor(IN,t0))})}return EN}({},dN);delete mN.jpg,_.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(mN))}return fN}{let mN=this.quality*this.qualityRatio;return this.quality=mN,await this.generateRequestData(e,{appId:i,cname:o,cid:h,vid:p,sid:g,uid:C})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ei.CLOSED,this.emit(we.STATE_CHANGE,di.CLOSED)}},nH={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new O(R.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new O(R.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let o=[...new Set(i.inspectType)];o.forEach(h=>{var p;if(!W(p=["supervise","moderation"]).call(p,h))throw new O(R.INVALID_PARAMS,"".concat(h," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new O(R.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Im(r)}};Ot("PROCESS_ID","process-".concat(Ut(8,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void _.error("Error loading sdk config",r.message)}if(e)try{let r=JSON.parse(window.atob(e)),i=Date.now();_.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(oe,o)){let{value:h,expires:p}=r[o];if(p&&p<=i)return;$r[o]=h,oe[o]=h}})}catch(r){_.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray($r.AREAS)&&$r.AREAS.length>0&&Af($r.AREAS,!0);var CA=(e,r,i)=>{_.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),Ot(e,r,i)};Ba(K3,!1),Ba(Y3,!1),Ba(PW,!1),Ba(nH,!1),Ba(H3,!1);var Mt=function(e){let r=new Xt,i=e,o={getListeners:r.getListeners.bind(r),on:(h,p)=>(function(g,C){g===nr.SECURITY_POLICY_VIOLATION&&L0(C,!0)}(h,p),r.on.bind(r)(h,p)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return Jy(Jy({},i),o)}({__TRACK_LIST__:As,VERSION:ii,BUILD:Ef,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:CA,getParameter:v,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection,i=await async function(o){let h;return ft().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),h=(await o.createOffer()).sdp):h=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,h}(r);if(!i)return e;r.close(),r=null,e=function(o){let h={video:[],audio:[]};return o.match(/ VP8/i)&&h.video.push("VP8"),o.match(/ VP9/i)&&h.video.push("VP9"),o.match(/ AV1/i)&&h.video.push("AV1"),o.match(/ H264/i)&&h.video.push("H264"),o.match(/ H265/i)&&h.video.push("H265"),o.match(/ opus/i)&&h.audio.push("OPUS"),o.match(/ PCMU/i)&&h.audio.push("PCMU"),o.match(/ PCMA/i)&&h.audio.push("PCMA"),o.match(/ G722/i)&&h.audio.push("G722"),h}(i)}catch(r){throw new O(R.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){let e=X.reportApiInvoke(null,{name:Te.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Zt.TRACER}),r=!1;try{let p=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,C=window.WebSocket;r=!!(p&&g&&C),r&&lf()&&EO(75)&&new p().close()}catch(p){return _.error("check system requirement failed: ",p),!1}let i=!1,o=mt();o.name===It.CHROME&&Number(o.version)>=58&&(Vi.engine.name!=="WebKit"||function(){let p=mt();if(Gl()){if(p.os===ye.MAC_OS)return!0;if(p.os===ye.IOS){let g=Vi.os.version&&Vi.os.version.split(".");if(g&&Number(g[0])===14&&g[1]&&Number(g[1])>=3||g&&Number(g[0])>14)return!0}}return!1}())&&(i=!0),(o.name===It.FIREFOX&&Number(o.version)>=56||o.name===It.OPERA&&Number(o.version)>=45||o.name===It.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(ln()||vi())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||TO()||mt().name===It.QQ)&&(i=!0),_.debug("checkSystemRequirements, api:",r,"browser",i);let h=r&&i;return e.onSuccess(h),h},getDevices:function(e){return Gn.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Gn.getRecordingDevices(e)},getCameras:function(e){return Gn.getCamerasDevices(e)},getElectronScreenSources:KO,getPlaybackDevices:function(e){return Gn.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=X.reportApiInvoke(null,{name:Te.CREATE_CLIENT,options:[r],tag:Zt.TRACER});try{(function(o){Ce(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ce(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&Ce(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Pe(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&vO(o.turnServer),o.httpRetryConfig!==void 0&&mR(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&mR(o.websocketRetryConfig)})(r)}catch(o){throw i.onError(o),o}return(fO(16,0)||gO(16,0))&&(r.codec==="vp9"&&(r.codec="vp8",_.debug("browser not support vp9, force use vp8")),Ot("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),i.onSuccess(),new kW(xi(xi({forceWaitGatewayResponse:!0},r),{},{role:W(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=v("CAMERA_CAPTURE_CONFIG"),i=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_CAM_VIDEO_TRACK,options:[Kt({},e),r]});r&&(e.encoderConfig=r);let o=ru(e),h=Ut(8,"track-cam-"),p=null;_.info("start create camera video track with config",JSON.stringify(e),"trackId",h);try{p=(await Fn({video:o},h)).getVideoTracks()[0]||null}catch(C){throw i.onError(C),C}if(!p){let C=new N(R.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(C),C.throw(_)}e.optimizationMode&&c_(h,p,e,cr(e.encoderConfig));let g=new XE(p,e,o,e.scalabiltyMode?Fd(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,h);return i.onSuccess(g.getTrackId()),_.info("create camera video success, trackId:",h),g},createCustomVideoTrack:function(e){let r=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new Ft(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Fd(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,Ut(8,"track-cus-"),[Gt.CUSTOM_TRACK]);return r.onSuccess(i.getTrackId()),_.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_SCREEN_VIDEO_TRACK,options:[Kt({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let o=function(_e){let cN={};_e.screenSourceType&&(cN.mediaSource=_e.screenSourceType),_e.extensionId&&oo()&&(cN.extensionId=_e.extensionId);let{displaySurface:dN,selfBrowserSurface:fN,surfaceSwitching:mN,systemAudio:EN}=_e;(OE(107)||lR(107)||uR(93))&&(dN&&(Ce(dN,"displaySurface",["browser","window","monitor"]),cN.displaySurface=dN),fN?(Ce(fN,"selfBrowserSurface",["exclude","include"]),cN.selfBrowserSurface=fN):cN.selfBrowserSurface="include",mN&&(Ce(mN,"surfaceSwitching",["exclude","include"]),cN.surfaceSwitching=mN)),(OE(105)||lR(105)||uR(91))&&EN&&(Ce(EN,"systemAudio",["exclude","include"]),cN.systemAudio=EN),_e.electronScreenSourceId&&(cN.sourceId=_e.electronScreenSourceId);let RN=_e.encoderConfig?r_(_e.encoderConfig):null;return cN.mandatory={chromeMediaSource:"desktop",maxWidth:RN?RN.width:void 0,maxHeight:RN?RN.height:void 0},RN&&(RN.frameRate&&(typeof RN.frameRate=="number"?(cN.mandatory.maxFrameRate=RN.frameRate,cN.mandatory.minFrameRate=RN.frameRate):(cN.mandatory.maxFrameRate=RN.frameRate.max||RN.frameRate.ideal||RN.frameRate.exact||void 0,cN.mandatory.minFrameRate=RN.frameRate.min||RN.frameRate.ideal||RN.frameRate.exact||void 0),cN.frameRate=RN.frameRate),RN.width&&(cN.width=RN.width),RN.height&&(cN.height=RN.height)),cN}(e),h=Ut(8,"track-scr-v-"),p=null,g=null,C=ft();if(!C.supportShareAudio&&r==="enable"){let _e=new N(R.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(_e),_e.throw(_)}_.info("start create screen video track with config",e,"withAudio",r,"trackId",h);try{let _e=await Fn({screen:o,screenAudio:r==="auto"?C.supportShareAudio:r==="enable"},h);p=_e.getVideoTracks()[0]||null,g=_e.getAudioTracks()[0]||null}catch(_e){throw i.onError(_e),_e}if(!p){let _e=new N(R.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(_e),_e.throw(_)}if(!g&&r==="enable"){p&&p.stop();let _e=new N(R.SHARE_AUDIO_NOT_ALLOWED);return i.onError(_e),_e.throw(_)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(c_(h,p,e,e.encoderConfig&&r_(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let A=new Ft(p,e.encoderConfig?r_(e.encoderConfig):{},e.scalabiltyMode?Fd(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,h,[Gt.SCREEN_TRACK]);if(!g)return i.onSuccess(A.getTrackId()),_.info("create screen video track success","video:",A.getTrackId()),A;let x=new Qt(g,void 0,Ut(8,"track-scr-a-"),!1);return i.onSuccess([A.getTrackId(),x.getTrackId()]),_.info("create screen video track success","video:",A.getTrackId(),"audio:",x.getTrackId()),[A,x]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=v("CAMERA_CAPTURE_CONFIG"),o=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);let h=ru(r),p=fC(e),g=Ut(8,"track-mic-"),C=Ut(8,"track-cam-"),A=null,x=null;_.info("start create camera video track(".concat(C,") and microphone audio track(").concat(g,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{let dN=await Fn({audio:p,video:h},"".concat(g,"-").concat(C));A=dN.getAudioTracks()[0],x=dN.getVideoTracks()[0]}catch(dN){throw o.onError(dN),dN}if(!A||!x){let dN=new N(R.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(dN),dN.throw(_)}r.optimizationMode&&c_(C,x,r,cr(r.encoderConfig));let _e=new ou(A,e,p,g),cN=new XE(x,r,h,r.scalabiltyMode?Fd(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,C);return o.onSuccess([_e.getTrackId(),cN.getTrackId()]),_.info("create camera video track(".concat(C,") and microphone audio track(").concat(g,") success")),[_e,cN]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=fC(e),o=Ut(8,"track-mic-"),h=null;_.info("start create microphone audio track with config",JSON.stringify(e),"trackId",o);try{h=(await Fn({audio:i},o)).getAudioTracks()[0]||null}catch(g){throw r.onError(g),g}if(!h){let g=new N(R.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(g),g.throw(_)}let p=new ou(h,e,i,o);return r.onSuccess(p.getTrackId()),_.info("create microphone audio track success, trackId:",o),p},createCustomAudioTrack:function(e){let r=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Qt(e.mediaStreamTrack,e.encoderConfig?Jl(e.encoderConfig):{},Ut(8,"track-cus-"),!1);return _.info("create custom audio track success with config",e,"trackId",i.getTrackId()),r.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var r;let{cacheOnlineFile:i,encoderConfig:o}=e,{source:h}=e,p={source:h instanceof AudioBuffer?"AudioBuffer":h instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":h,cacheOnlineFile:i,encoderConfig:o},g=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_BUFFER_AUDIO_TRACK,options:[p]});if(v("DISABLE_WEBAUDIO"))throw new N(R.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let C=Ut(8,"track-buf-");_.info("start create buffer source audio track with config",JSON.stringify(p),"trackId",C);let A=h;if(!(h instanceof AudioBuffer))try{h=await async function(cN,dN){let fN=null;if(typeof cN=="string"){let EN=eI.get(cN);if(EN)return _.debug("use cached audio resource: ",cN),EN;try{fN=(await Wi(()=>mn.get(cN,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(RN){throw new N(R.FETCH_AUDIO_FILE_FAILED,RN.toString())}}else fN=await new j((EN,RN)=>{let IN=new FileReader;IN.onload=t0=>{t0.target?EN(t0.target.result):RN(new N(R.READ_LOCAL_AUDIO_FILE_ERROR))},IN.onerror=()=>{RN(new N(R.READ_LOCAL_AUDIO_FILE_ERROR))},IN.readAsArrayBuffer(cN)});let mN=await function(EN){let RN=ga();return new j((IN,t0)=>{RN.decodeAudioData(EN,aH=>{IN(aH)},aH=>{t0(new N(R.DECODE_AUDIO_FILE_FAILED,aH.toString()))})})}(fN);return typeof cN=="string"&&dN&&eI.set(cN,mN),mN}(h,i)}catch(cN){return g.onError(cN),cN.throw(_)}let x=new JE(h),_e=new VG(A,x,o?Jl(o):{},C);return _.info("create buffer source audio track success, trackId:",C),g.onSuccess(_e.getTrackId()),_e},setAppType:function(e){if(_.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw _.debug("Invalid appType"),new O(R.INVALID_PARAMS,"invalid app type",e);Ot("APP_TYPE",Math.floor(e))},setLogLevel:function(e){_.setLogLevel(e)},enableLogUpload:function(){v("USE_NEW_LOG")?Ot("UPLOAD_LOG",!0):_.enableLogUpload()},disableLogUpload:function(){v("USE_NEW_LOG")?Ot("UPLOAD_LOG",!1):_.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Eu},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Qt||e instanceof Ks)){let A=new O(R.INVALID_TRACK,"the parameter is not a audio track");return i.onError(A),A.throw()}r&&r<1e3&&(r=1e3);let o=e instanceof Qt?e.getTrackLabel():"remote_track",h=e.getVolumeLevel(),p=h,g=h,C=Date.now();return new j(A=>{let x=setInterval(()=>{let _e=e.getVolumeLevel();p=_e>p?_e:p,g=_e<g?_e:g;let cN=p-g>1e-4,dN=Date.now()-C;if(cN||dN>r){clearInterval(x);let fN=cN,mN={duration:dN,deviceLabel:o,maxVolumeLevel:p,result:fN};_.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(mN))),i.onSuccess(mN),A(fN)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Ft||e instanceof Hs)){let cN=new O(R.INVALID_TRACK,"the parameter is not a video track");return i.onError(cN),cN.throw()}r&&r<1e3&&(r=1e3);let o=e instanceof Ft?e.getTrackLabel():"remote_track",h=e.getMediaStreamTrack(!0),p=document.createElement("video");p.style.width="1px",p.style.height="1px",p.setAttribute("muted",""),p.muted=!0,p.setAttribute("playsinline",""),p.controls=!1,(je()||Gl())&&(p.style.opacity="0.01",p.style.position="fixed",p.style.left="0",p.style.top="0",document.body.appendChild(p)),p.srcObject=new MediaStream([h]),p.play();let g=document.createElement("canvas");g.width=160,g.height=120;let C=0,A=0;try{let cN=Date.now();C=await function(dN,fN,mN,EN){let RN,IN=0,t0=null;return new j((aH,pH)=>{function SH(){IN>EN&&RN&&(RN(),aH(IN));let vH=mN.getContext("2d");if(!vH){let zH=new O(R.UNEXPECTED_ERROR,"can not get canvas 2d context.");return _.error(zH.toString()),void pH(zH)}vH.drawImage(dN,0,0,160,120);let AH=vH.getImageData(0,0,mN.width,mN.height),UH=Math.floor(AH.data.length/3);if(t0){for(let zH=0;zH<UH;zH+=3)if(AH.data[zH]!==t0[zH])return IN+=1,void(t0=AH.data);t0=AH.data}else t0=AH.data}setTimeout(()=>{RN&&(RN(),aH(IN))},fN),RN=Rf(()=>{SH()},30)})}(p,r,g,4),A=Date.now()-cN}catch(cN){throw i.onError(cN),cN}gW===It.SAFARI&&(p.pause(),p.remove()),p.srcObject=null;let x=C>4,_e={duration:A,changedPicNum:C,deviceLabel:o,result:x};return _.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_e))),i.onSuccess(_e),x},setArea:Af,audioElementPlayCenter:En,resumeAudioContext:function(){En.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){MW.processExternalMediaAEC(e)},registerExtensions:function(e){let r=v("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!W(r).call(r,i.name)&&r.push(i.name);let o=i;o.__registered__=!0,o.logger.hookLog=_.extLog,o.reporter.hookApiInvoke=X.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(h=>{o.parameters[h]=v(h)})}),CA("PLUGIN_INFO",r)},ChannelMediaRelayError:ys,ChannelMediaRelayEvent:Ir,ChannelMediaRelayState:Sn,RemoteStreamFallbackType:PG,RemoteStreamType:DG,ConnectionDisconnectedReason:At,AudienceLatencyLevelType:EB,AREAS:St,preload:async function(e,r,i,o){return y0(e,r,i,o)}});Object.defineProperties(Mt,{onAudioAutoplayFailed:{get:()=>Un.onAudioAutoplayFailed,set:e=>{Un.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Un.onAutoplayFailed,set:e=>{Un.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Mt._onSecurityPolicyViolation,set(e){Mt._onSecurityPolicyViolation=e,L0(e)}},__CLIENT_LIST__:{get:()=>v("SHOW_GLOBAL_CLIENT_LIST")?Jr:[]}}),Gn.on(Bo.CAMERA_DEVICE_CHANGED,e=>{_.info("camera device changed",JSON.stringify(e)),Mt.onCameraChanged&&Mt.onCameraChanged(e),Mt.safeEmit(nr.CAMERA_CHANGED,e)}),Gn.on(Bo.RECORDING_DEVICE_CHANGED,e=>{_.info("microphone device changed",JSON.stringify(e)),Mt.onMicrophoneChanged&&Mt.onMicrophoneChanged(e),Mt.safeEmit(nr.MICROPHONE_CHANGED,e)}),Gn.on(Bo.PLAYOUT_DEVICE_CHANGED,e=>{_.debug("playout device changed",JSON.stringify(e)),Mt.onPlaybackDeviceChanged&&Mt.onPlaybackDeviceChanged(e),Mt.safeEmit(nr.PLAYBACK_DEVICE_CHANGED,e)}),En.onAutoplayFailed=()=>{_.info("detect audio element autoplay failed"),Un.onAudioAutoplayFailed&&Un.onAudioAutoplayFailed()},wt.on("autoplay-failed",()=>{_.info("detect webaudio autoplay failed"),Un.onAudioAutoplayFailed&&Un.onAudioAutoplayFailed(),Mt.safeEmit(nr.AUTOPLAY_FAILED)}),wt.on(ke.STATE_CHANGE,(e,r)=>{_.info("audio context state changed: ".concat(r," => ").concat(e)),Mt.onAudioContextStateChanged&&Mt.onAudioContextStateChanged(e,r),Mt.safeEmit(nr.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),he.on(ks.NETWORK_STATE_CHANGE,(e,r)=>{_.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=Mt);var pN=reactExports.createContext(null);function K5({client:e,children:r}){return jsxRuntimeExports.jsx(pN.Provider,{value:e,children:r})}reactExports.createContext(null);reactExports.createContext(void 0);var zf=class{constructor(){_ve(this,"appType",1001);Mt.setAppType(this.appType)}};new zf;var U6=Mt,AgoraRTC_NProduction$1={exports:{}},AgoraRTC_NProduction=AgoraRTC_NProduction$1.exports,hasRequiredAgoraRTC_NProduction;function requireAgoraRTC_NProduction(){return hasRequiredAgoraRTC_NProduction||(hasRequiredAgoraRTC_NProduction=1,function(e,r){(function(i,o){e.exports=o()})(AgoraRTC_NProduction,function(){function i(s,d){return d.forEach(function(l){l&&typeof l!="string"&&!Array.isArray(l)&&Object.keys(l).forEach(function(f){if(f!=="default"&&!(f in s)){var b=Object.getOwnPropertyDescriptor(l,f);Object.defineProperty(s,f,b.get?b:{enumerable:!0,get:function(){return l[f]}})}})}),Object.freeze(s)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{};function h(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var p=function(s){try{return!!s()}catch{return!0}},g=!p(function(){var s=(function(){}).bind();return typeof s!="function"||s.hasOwnProperty("prototype")}),C=g,A=Function.prototype,x=A.call,_e=C&&A.bind.bind(x,x),cN=C?_e:function(s){return function(){return x.apply(s,arguments)}},dN=cN({}.isPrototypeOf),fN=function(s){return s&&s.Math===Math&&s},mN=fN(typeof globalThis=="object"&&globalThis)||fN(typeof window=="object"&&window)||fN(typeof self=="object"&&self)||fN(typeof o=="object"&&o)||fN(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),EN=g,RN=Function.prototype,IN=RN.apply,t0=RN.call,aH=typeof Reflect=="object"&&Reflect.apply||(EN?t0.bind(IN):function(){return t0.apply(IN,arguments)}),pH=cN,SH=pH({}.toString),vH=pH("".slice),AH=function(s){return vH(SH(s),8,-1)},UH=AH,zH=cN,CH=function(s){if(UH(s)==="Function")return zH(s)},HH=typeof document=="object"&&document.all,VH=HH===void 0&&HH!==void 0?function(s){return typeof s=="function"||s===HH}:function(s){return typeof s=="function"},KH={},IH=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),MH=g,GH=Function.prototype.call,yH=MH?GH.bind(GH):function(){return GH.apply(GH,arguments)},TH={},NH={}.propertyIsEnumerable,gH=Object.getOwnPropertyDescriptor,SN=gH&&!NH.call({1:2},1);TH.f=SN?function(s){var d=gH(this,s);return!!d&&d.enumerable}:NH;var oH,fH,xH=function(s,d){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:d}},l5=p,w5=AH,H5=Object,d6=cN("".split),C6=l5(function(){return!H5("z").propertyIsEnumerable(0)})?function(s){return w5(s)==="String"?d6(s,""):H5(s)}:H5,fK=function(s){return s==null},D4=fK,i4=TypeError,L6=function(s){if(D4(s))throw new i4("Can't call method on "+s);return s},X5=C6,B5=L6,y5=function(s){return X5(B5(s))},k5=VH,Q5=function(s){return typeof s=="object"?s!==null:k5(s)},M6={},g6=M6,W5=mN,HK=VH,f8=function(s){return HK(s)?s:void 0},X6=function(s,d){return arguments.length<2?f8(g6[s])||f8(W5[s]):g6[s]&&g6[s][d]||W5[s]&&W5[s][d]},G7=mN.navigator,_ee=G7&&G7.userAgent,k8=_ee?String(_ee):"",e9=mN,BQ=k8,W7=e9.process,H7=e9.Deno,ure=W7&&W7.versions||H7&&H7.version,Eee=ure&&ure.v8;Eee&&(fH=(oH=Eee.split("."))[0]>0&&oH[0]<4?1:+(oH[0]+oH[1])),!fH&&BQ&&(!(oH=BQ.match(/Edge\/(\d+)/))||oH[1]>=74)&&(oH=BQ.match(/Chrome\/(\d+)/))&&(fH=+oH[1]);var cJ=fH,dre=cJ,mee=p,gee=mN.String,uJ=!!Object.getOwnPropertySymbols&&!mee(function(){var s=Symbol("symbol detection");return!gee(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&dre&&dre<41}),GQ=uJ&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Tee=X6,q7=VH,K7=dN,lre=Object,z7=GQ?function(s){return typeof s=="symbol"}:function(s){var d=Tee("Symbol");return q7(d)&&K7(d.prototype,lre(s))},hre=String,$J=function(s){try{return hre(s)}catch{return"Object"}},pre=VH,See=$J,fre=TypeError,s4=function(s){if(pre(s))return s;throw new fre(See(s)+" is not a function")},yee=s4,t9=fK,WQ=function(s,d){var l=s[d];return t9(l)?void 0:yee(l)},Y7=yH,n9=VH,r9=Q5,Ree=TypeError,_re={exports:{}},lae=!0,Ere=mN,e7=Object.defineProperty,mre=mN,gre=function(s,d){try{e7(Ere,s,{value:d,configurable:!0,writable:!0})}catch{Ere[s]=d}return d},Tre="__core-js_shared__",bee=_re.exports=mre[Tre]||gre(Tre,{});(bee.versions||(bee.versions=[])).push({version:"3.39.0",mode:"pure",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var HQ=_re.exports,vee=HQ,t7=function(s,d){return vee[s]||(vee[s]=d||{})},hae=L6,pae=Object,Q6=function(s){return pae(hae(s))},fae=Q6,Cee=cN({}.hasOwnProperty),kK=Object.hasOwn||function(s,d){return Cee(fae(s),d)},qQ=cN,_ae=0,Sre=Math.random(),KQ=qQ(1 .toString),_8=function(s){return"Symbol("+(s===void 0?"":s)+")_"+KQ(++_ae+Sre,36)},Eae=t7,E8=kK,mae=_8,gae=uJ,Tae=GQ,AY=mN.Symbol,J7=Eae("wks"),i9=Tae?AY.for||AY:AY&&AY.withoutSetter||mae,K6=function(s){return E8(J7,s)||(J7[s]=gae&&E8(AY,s)?AY[s]:i9("Symbol."+s)),J7[s]},Sae=yH,yre=Q5,zQ=z7,Rre=WQ,Iee=function(s,d){var l,f;if(n9(l=s.toString)&&!r9(f=Y7(l,s))||n9(l=s.valueOf)&&!r9(f=Y7(l,s)))return f;throw new Ree("Can't convert object to primitive value")},s9=TypeError,yae=K6("toPrimitive"),wee=function(s,d){if(!yre(s)||zQ(s))return s;var l,f=Rre(s,yae);if(f){if(l=Sae(f,s,d),!yre(l)||zQ(l))return l;throw new s9("Can't convert object to primitive value")}return Iee(s)},tK=z7,YQ=function(s){var d=wee(s,"string");return tK(d)?d:d+""},Aee=Q5,o9=mN.document,bre=Aee(o9)&&Aee(o9.createElement),JQ=function(s){return bre?o9.createElement(s):{}},vre=JQ,XQ=!IH&&!p(function(){return Object.defineProperty(vre("div"),"a",{get:function(){return 7}}).a!==7}),QQ=IH,dJ=yH,lJ=TH,hJ=xH,a9=y5,c9=YQ,pJ=kK,Rae=XQ,Oee=Object.getOwnPropertyDescriptor;KH.f=QQ?Oee:function(s,d){if(s=a9(s),d=c9(d),Rae)try{return Oee(s,d)}catch{}if(pJ(s,d))return hJ(!dJ(lJ.f,s,d),s[d])};var u9=p,bae=VH,Cre=/#|\.prototype\./,fJ=function(s,d){var l=vae[Ire(s)];return l===l9||l!==d9&&(bae(d)?u9(d):!!d)},Ire=fJ.normalize=function(s){return String(s).replace(Cre,".").toLowerCase()},vae=fJ.data={},d9=fJ.NATIVE="N",l9=fJ.POLYFILL="P",n7=fJ,ZQ=s4,Cae=g,Iae=CH(CH.bind),_z=function(s,d){return ZQ(s),d===void 0?s:Cae?Iae(s,d):function(){return s.apply(d,arguments)}},k4={},$Q=IH&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wre=Q5,_J=String,Nee=TypeError,o4=function(s){if(wre(s))return s;throw new Nee(_J(s)+" is not an object")},Are=IH,eZ=XQ,tZ=$Q,h9=o4,q4=YQ,X7=TypeError,p9=Object.defineProperty,f9=Object.getOwnPropertyDescriptor,Pee="enumerable",_9="configurable",E9="writable";k4.f=Are?tZ?function(s,d,l){if(h9(s),d=q4(d),h9(l),typeof s=="function"&&d==="prototype"&&"value"in l&&E9 in l&&!l[E9]){var f=f9(s,d);f&&f[E9]&&(s[d]=l.value,l={configurable:_9 in l?l[_9]:f[_9],enumerable:Pee in l?l[Pee]:f[Pee],writable:!1})}return p9(s,d,l)}:p9:function(s,d,l){if(h9(s),d=q4(d),h9(l),eZ)try{return p9(s,d,l)}catch{}if("get"in l||"set"in l)throw new X7("Accessors not supported");return"value"in l&&(s[d]=l.value),s};var m9=k4,nZ=xH,EJ=IH?function(s,d,l){return m9.f(s,d,nZ(1,l))}:function(s,d,l){return s[d]=l,s},g9=mN,wae=aH,Aae=CH,Dee=VH,Oae=KH.f,Nae=n7,Q7=M6,Pae=_z,Z7=EJ,kee=kK,Dae=function(s){var d=function(l,f,b){if(this instanceof d){switch(arguments.length){case 0:return new s;case 1:return new s(l);case 2:return new s(l,f)}return new s(l,f,b)}return wae(s,this,arguments)};return d.prototype=s.prototype,d},f6=function(s,d){var l,f,b,k,B,Wt,$O,uN,lN,_N=s.target,TN=s.global,vN=s.stat,uH=s.proto,rH=TN?g9:vN?g9[_N]:g9[_N]&&g9[_N].prototype,iH=TN?Q7:Q7[_N]||Z7(Q7,_N,{})[_N],lH=iH.prototype;for(k in d)f=!(l=Nae(TN?k:_N+(vN?".":"#")+k,s.forced))&&rH&&kee(rH,k),Wt=iH[k],f&&($O=s.dontCallGetSet?(lN=Oae(rH,k))&&lN.value:rH[k]),B=f&&$O?$O:d[k],(l||uH||typeof Wt!=typeof B)&&(uN=s.bind&&f?Pae(B,g9):s.wrap&&f?Dae(B):uH&&Dee(B)?Aae(B):B,(s.sham||B&&B.sham||Wt&&Wt.sham)&&Z7(uN,"sham",!0),Z7(iH,k,uN),uH&&(kee(Q7,b=_N+"Prototype")||Z7(Q7,b,{}),Z7(Q7[b],k,B),s.real&&lH&&(l||!lH[k])&&Z7(lH,k,B)))},kae=Math.ceil,Lae=Math.floor,Lee=Math.trunc||function(s){var d=+s;return(d>0?Lae:kae)(d)},Mae=Lee,Mee=function(s){var d=+s;return d!=d||d===0?0:Mae(d)},Uae=Mee,Ore=Math.max,xae=Math.min,Uee=function(s,d){var l=Uae(s);return l<0?Ore(l+d,0):xae(l,d)},Vae=Mee,Fae=Math.min,Nre=function(s){var d=Vae(s);return d>0?Fae(d,9007199254740991):0},jae=Nre,mJ=function(s){return jae(s.length)},xee=y5,T9=Uee,Bae=mJ,Vee=function(s){return function(d,l,f){var b=xee(d),k=Bae(b);if(k===0)return!s&&-1;var B,Wt=T9(f,k);if(s&&l!=l){for(;k>Wt;)if((B=b[Wt++])!=B)return!0}else for(;k>Wt;Wt++)if((s||Wt in b)&&b[Wt]===l)return s||Wt||0;return!s&&-1}},rZ={includes:Vee(!0),indexOf:Vee(!1)},Pre=rZ.includes;f6({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(s){return Pre(this,s,arguments.length>1?arguments[1]:void 0)}});var Dre=mN,kre=M6,l4=function(s,d){var l=kre[s+"Prototype"],f=l&&l[d];if(f)return f;var b=Dre[s],k=b&&b.prototype;return k&&k[d]},Gae=l4("Array","includes"),Wae=Q5,Hae=AH,Lre=K6("match"),Fee=function(s){var d;return Wae(s)&&((d=s[Lre])!==void 0?!!d:Hae(s)==="RegExp")},S9=Fee,y9=TypeError,Mre={};Mre[K6("toStringTag")]="z";var $7=String(Mre)==="[object z]",qae=$7,Ure=VH,eX=AH,jee=K6("toStringTag"),xre=Object,Vre=eX(function(){return arguments}())==="Arguments",eY=qae?eX:function(s){var d,l,f;return s===void 0?"Undefined":s===null?"Null":typeof(l=function(b,k){try{return b[k]}catch{}}(d=xre(s),jee))=="string"?l:Vre?eX(d):(f=eX(d))==="Object"&&Ure(d.callee)?"Arguments":f},Kae=eY,zae=String,K4=function(s){if(Kae(s)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return zae(s)},Yae=K6("match"),Jae=f6,L8=function(s){if(S9(s))throw new y9("The method doesn't accept regular expressions");return s},R9=L6,Bee=K4,Fre=function(s){var d=/./;try{"/./"[s](d)}catch{try{return d[Yae]=!1,"/./"[s](d)}catch{}}return!1},jre=cN("".indexOf);Jae({target:"String",proto:!0,forced:!Fre("includes")},{includes:function(s){return!!~jre(Bee(R9(this)),Bee(L8(s)),arguments.length>1?arguments[1]:void 0)}});var Bre=l4("String","includes"),iZ=dN,Xae=Gae,Qae=Bre,gJ=Array.prototype,b9=String.prototype,v9=function(s){var d=s.includes;return s===gJ||iZ(gJ,s)&&d===gJ.includes?Xae:typeof s=="string"||s===b9||iZ(b9,s)&&d===b9.includes?Qae:d},a5=h(v9),Gre=s4,sZ=Q6,tX=C6,Gee=mJ,Wee=TypeError,C9="Reduce of empty array with no initial value",Hee=function(s){return function(d,l,f,b){var k=sZ(d),B=tX(k),Wt=Gee(k);if(Gre(l),Wt===0&&f<2)throw new Wee(C9);var $O=s?Wt-1:0,uN=s?-1:1;if(f<2)for(;;){if($O in B){b=B[$O],$O+=uN;break}if($O+=uN,s?$O<0:Wt<=$O)throw new Wee(C9)}for(;s?$O>=0:Wt>$O;$O+=uN)$O in B&&(b=l(b,B[$O],$O,k));return b}},Wre={left:Hee(!1),right:Hee(!0)},Hre=p,I9=function(s,d){var l=[][s];return!!l&&Hre(function(){l.call(null,d||function(){return 1},1)})},nX=mN,qre=k8,TJ=AH,rX=function(s){return qre.slice(0,s.length)===s},w9=rX("Bun/")?"BUN":rX("Cloudflare-Workers")?"CLOUDFLARE":rX("Deno/")?"DENO":rX("Node.js/")?"NODE":nX.Bun&&typeof Bun.version=="string"?"BUN":nX.Deno&&typeof Deno.version=="object"?"DENO":TJ(nX.process)==="process"?"NODE":nX.window&&nX.document?"BROWSER":"REST",oZ=w9==="NODE",Zae=Wre.left;f6({target:"Array",proto:!0,forced:!oZ&&cJ>79&&cJ<83||!I9("reduce")},{reduce:function(s){var d=arguments.length;return Zae(this,s,d,d>1?arguments[1]:void 0)}});var A9=l4("Array","reduce"),$ae=dN,Kre=A9,aZ=Array.prototype,TK=function(s){var d=s.reduce;return s===aZ||$ae(aZ,s)&&d===aZ.reduce?Kre:d},cZ=TK,z4=h(cZ),O9=AH,iX=Array.isArray||function(s){return O9(s)==="Array"},qee=f6,N9=iX,uZ=cN([].reverse),r7=[1,2];qee({target:"Array",proto:!0,forced:String(r7)===String(r7.reverse())},{reverse:function(){return N9(this)&&(this.length=this.length),uZ(this)}});var zre=l4("Array","reverse"),ece=dN,tce=zre,dZ=Array.prototype,lZ=function(s){var d=s.reverse;return s===dZ||ece(dZ,s)&&d===dZ.reverse?tce:d},P9=lZ,hZ=h(P9),Kee=_8,pZ=t7("keys"),sX=function(s){return pZ[s]||(pZ[s]=Kee(s))},nce=!p(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),Yre=kK,rce=VH,ice=Q6,zee=nce,OY=sX("IE_PROTO"),fZ=Object,oX=fZ.prototype,m8=zee?fZ.getPrototypeOf:function(s){var d=ice(s);if(Yre(d,OY))return d[OY];var l=d.constructor;return rce(l)&&d instanceof l?l.prototype:d instanceof fZ?oX:null},D9=cN,NY=s4,Yee=Q5,sce=function(s){return Yee(s)||s===null},oce=String,i7=TypeError,k9=function(s,d,l){try{return D9(NY(Object.getOwnPropertyDescriptor(s,d)[l]))}catch{}},aX=Q5,_Z=L6,Jee=function(s){if(sce(s))return s;throw new i7("Can't set "+oce(s)+" as a prototype")},cX=Object.setPrototypeOf||("__proto__"in{}?function(){var s,d=!1,l={};try{(s=k9(Object.prototype,"__proto__","set"))(l,[]),d=l instanceof Array}catch{}return function(f,b){return _Z(f),Jee(b),aX(f)&&(d?s(f,b):f.__proto__=b),f}}():void 0),M8={},rK={},iK=kK,SJ=y5,g4=rZ.indexOf,Y4=rK,yJ=cN([].push),s7=function(s,d){var l,f=SJ(s),b=0,k=[];for(l in f)!iK(Y4,l)&&iK(f,l)&&yJ(k,l);for(;d.length>b;)iK(f,l=d[b++])&&(~g4(k,l)||yJ(k,l));return k},T4=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],EZ=s7,Jre=T4.concat("length","prototype");M8.f=Object.getOwnPropertyNames||function(s){return EZ(s,Jre)};var uX={};uX.f=Object.getOwnPropertySymbols;var mZ=X6,Xre=M8,PY=uX,gZ=o4,Xee=cN([].concat),Qre=mZ("Reflect","ownKeys")||function(s){var d=Xre.f(gZ(s)),l=PY.f;return l?Xee(d,l(s)):d},Zre=kK,RJ=Qre,dX=KH,lX=k4,hX={},TZ=s7,g8=T4,L4=Object.keys||function(s){return TZ(s,g8)},o7=IH,DY=$Q,kY=k4,a7=o4,$re=y5,Qee=L4;hX.f=o7&&!DY?Object.defineProperties:function(s,d){a7(s);for(var l,f=$re(d),b=Qee(d),k=b.length,B=0;k>B;)kY.f(s,l=b[B++],f[l]);return s};var pX,J4=X6("document","documentElement"),o8=o4,RK=hX,T8=T4,eie=rK,tie=J4,Zee=JQ,L9="prototype",SZ="script",M9=sX("IE_PROTO"),yZ=function(){},c7=function(s){return"<"+SZ+">"+s+"</"+SZ+">"},RZ=function(s){s.write(c7("")),s.close();var d=s.parentWindow.Object;return s=null,d},bZ=function(){try{pX=new ActiveXObject("htmlfile")}catch{}var s,d,l;bZ=typeof document<"u"?document.domain&&pX?RZ(pX):(d=Zee("iframe"),l="java"+SZ+":",d.style.display="none",tie.appendChild(d),d.src=String(l),(s=d.contentWindow.document).open(),s.write(c7("document.F=Object")),s.close(),s.F):RZ(pX);for(var f=T8.length;f--;)delete bZ[L9][T8[f]];return bZ()};eie[M9]=!0;var LY=Object.create||function(s,d){var l;return s!==null?(yZ[L9]=o8(s),l=new yZ,yZ[L9]=null,l[M9]=s):l=bZ(),d===void 0?l:RK.f(l,d)},vZ=Q5,nie=EJ,$ee=Error,fX=cN("".replace),rie=String(new $ee("zxcasd").stack),U9=/\n\s*at [^:]*:[^\n]*/,CZ=U9.test(rie),_X=xH,ete=!p(function(){var s=new Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",_X(1,7)),s.stack!==7)}),tte=EJ,nte=function(s,d){if(CZ&&typeof s=="string"&&!$ee.prepareStackTrace)for(;d--;)s=fX(s,U9,"");return s},rte=ete,u7=Error.captureStackTrace,a4={},d7=a4,ite=K6("iterator"),iie=Array.prototype,tY=function(s){return s!==void 0&&(d7.Array===s||iie[ite]===s)},bJ=eY,IZ=WQ,sie=fK,MY=a4,vJ=K6("iterator"),l7=function(s){if(!sie(s))return IZ(s,vJ)||IZ(s,"@@iterator")||MY[bJ(s)]},oie=yH,wZ=s4,aie=o4,x9=$J,nY=l7,V9=TypeError,h7=function(s,d){var l=arguments.length<2?nY(s):d;if(wZ(l))return aie(oie(l,s));throw new V9(x9(s)+" is not iterable")},p7=yH,AZ=o4,EX=WQ,ste=function(s,d,l){var f,b;AZ(s);try{if(!(f=EX(s,"return"))){if(d==="throw")throw l;return l}f=p7(f,s)}catch(k){b=!0,f=k}if(d==="throw")throw l;if(b)throw f;return AZ(f),l},ote=_z,CK=yH,OZ=o4,ate=$J,cte=tY,NZ=mJ,PZ=dN,f7=h7,IK=l7,qK=ste,c4=TypeError,_7=function(s,d){this.stopped=s,this.result=d},mX=_7.prototype,UY=function(s,d,l){var f,b,k,B,Wt,$O,uN,lN=l&&l.that,_N=!(!l||!l.AS_ENTRIES),TN=!(!l||!l.IS_RECORD),vN=!(!l||!l.IS_ITERATOR),uH=!(!l||!l.INTERRUPTED),rH=ote(d,lN),iH=function(hH){return f&&qK(f,"normal",hH),new _7(!0,hH)},lH=function(hH){return _N?(OZ(hH),uH?rH(hH[0],hH[1],iH):rH(hH[0],hH[1])):uH?rH(hH,iH):rH(hH)};if(TN)f=s.iterator;else if(vN)f=s;else{if(!(b=IK(s)))throw new c4(ate(s)+" is not iterable");if(cte(b)){for(k=0,B=NZ(s);B>k;k++)if((Wt=lH(s[k]))&&PZ(mX,Wt))return Wt;return new _7(!1)}f=f7(s,b)}for($O=TN?s.next:f.next;!(uN=CK($O,f)).done;){try{Wt=lH(uN.value)}catch(hH){qK(f,"throw",hH)}if(typeof Wt=="object"&&Wt&&PZ(mX,Wt))return Wt}return new _7(!1)},ace=K4,S4=f6,ute=dN,dte=m8,gX=cX,rY=function(s,d,l){for(var f=RJ(d),b=lX.f,k=dX.f,B=0;B<f.length;B++){var Wt=f[B];Zre(s,Wt)||Zre(l,Wt)||b(s,Wt,k(d,Wt))}},a8=LY,E7=EJ,F9=xH,lte=function(s,d){vZ(d)&&"cause"in d&&nie(s,"cause",d.cause)},cie=function(s,d,l,f){rte&&(u7?u7(s,d):tte(s,"stack",nte(l,f)))},uie=UY,die=function(s,d){return s===void 0?arguments.length<2?"":d:ace(s)},lie=K6("toStringTag"),j9=Error,hie=[].push,m7=function(s,d){var l,f=ute(DZ,this);gX?l=gX(new j9,f?dte(this):DZ):(l=f?this:a8(DZ),E7(l,lie,"Error")),d!==void 0&&E7(l,"message",die(d)),cie(l,m7,l.stack,1),arguments.length>2&&lte(l,arguments[2]);var b=[];return uie(s,hie,{that:b}),E7(l,"errors",b),l};gX?gX(m7,j9):rY(m7,j9,{name:!0});var DZ=m7.prototype=a8(j9.prototype,{constructor:F9(1,m7),message:F9(1,""),name:F9(1,"AggregateError")});S4({global:!0,constructor:!0,arity:2},{AggregateError:m7});var CJ,TX,g7,kZ=VH,hte=mN.WeakMap,pte=kZ(hte)&&/native code/.test(String(hte)),fte=mN,pie=Q5,fie=EJ,LZ=kK,B9=HQ,_ie=sX,Eie=rK,_te="Object already initialized",Ete=fte.TypeError,mie=fte.WeakMap;if(pte||B9.state){var iY=B9.state||(B9.state=new mie);iY.get=iY.get,iY.has=iY.has,iY.set=iY.set,CJ=function(s,d){if(iY.has(s))throw new Ete(_te);return d.facade=s,iY.set(s,d),d},TX=function(s){return iY.get(s)||{}},g7=function(s){return iY.has(s)}}else{var SX=_ie("state");Eie[SX]=!0,CJ=function(s,d){if(LZ(s,SX))throw new Ete(_te);return d.facade=s,fie(s,SX,d),d},TX=function(s){return LZ(s,SX)?s[SX]:{}},g7=function(s){return LZ(s,SX)}}var IJ,mte,gte,sY={set:CJ,get:TX,has:g7,enforce:function(s){return g7(s)?TX(s):CJ(s,{})},getterFor:function(s){return function(d){var l;if(!pie(d)||(l=TX(d)).type!==s)throw new Ete("Incompatible receiver, "+s+" required");return l}}},Tte=IH,cce=kK,gie=Function.prototype,U8=Tte&&Object.getOwnPropertyDescriptor,G9=cce(gie,"name"),W9={EXISTS:G9,PROPER:G9&&(function(){}).name==="something",CONFIGURABLE:G9&&(!Tte||Tte&&U8(gie,"name").configurable)},Tie=EJ,xY=function(s,d,l,f){return f&&f.enumerable?s[d]=l:Tie(s,d,l),s},Sie=p,Ste=VH,yX=Q5,yte=LY,MZ=m8,uce=xY,UZ=K6("iterator"),Rte=!1;[].keys&&("next"in(gte=[].keys())?(mte=MZ(MZ(gte)))!==Object.prototype&&(IJ=mte):Rte=!0);var yie=!yX(IJ)||Sie(function(){var s={};return IJ[UZ].call(s)!==s});Ste((IJ=yie?{}:yte(IJ))[UZ])||uce(IJ,UZ,function(){return this});var bte={IteratorPrototype:IJ,BUGGY_SAFARI_ITERATORS:Rte},Rie=eY,dce=$7?{}.toString:function(){return"[object "+Rie(this)+"]"},X4=$7,M4=k4.f,bie=EJ,vie=kK,Cie=dce,vte=K6("toStringTag"),oY=function(s,d,l,f){var b=l?s:s&&s.prototype;b&&(vie(b,vte)||M4(b,vte,{configurable:!0,value:d}),f&&!X4&&bie(b,"toString",Cie))},Cte=bte.IteratorPrototype,Iie=LY,Ite=xH,wie=oY,Aie=a4,wte=function(){return this},H9=function(s,d,l,f){var b=d+" Iterator";return s.prototype=Iie(Cte,{next:Ite(+!f,l)}),wie(s,b,!1,!0),Aie[b]=wte,s},Oie=f6,Ate=yH,xZ=W9,lce=H9,Nie=m8,Ote=oY,Nte=xY,q9=a4,VY=bte,hce=xZ.PROPER,K9=VY.BUGGY_SAFARI_ITERATORS,z9=K6("iterator"),Pte="keys",Y9="values",RX="entries",y4=function(){return this},Pie=function(s,d,l,f,b,k,B){lce(l,d,f);var Wt,$O,uN,lN=function(lH){if(lH===b&&rH)return rH;if(!K9&&lH&&lH in vN)return vN[lH];switch(lH){case Pte:case Y9:case RX:return function(){return new l(this,lH)}}return function(){return new l(this)}},_N=d+" Iterator",TN=!1,vN=s.prototype,uH=vN[z9]||vN["@@iterator"]||b&&vN[b],rH=!K9&&uH||lN(b),iH=d==="Array"&&vN.entries||uH;if(iH&&(Wt=Nie(iH.call(new s)))!==Object.prototype&&Wt.next&&(Ote(Wt,_N,!0,!0),q9[_N]=y4),hce&&b===Y9&&uH&&uH.name!==Y9&&(TN=!0,rH=function(){return Ate(uH,this)}),b)if($O={values:lN(Y9),keys:k?rH:lN(Pte),entries:lN(RX)},B)for(uN in $O)(K9||TN||!(uN in vN))&&Nte(vN,uN,$O[uN]);else Oie({target:d,proto:!0,forced:K9||TN},$O);return B&&vN[z9]!==rH&&Nte(vN,z9,rH,{name:b}),q9[d]=rH,$O},VZ=function(s,d){return{value:s,done:d}},FZ=y5,h4=a4,Die=sY;k4.f;var x5=Pie,FY=VZ,jZ="Array Iterator",kie=Die.set,pce=Die.getterFor(jZ);x5(Array,"Array",function(s,d){kie(this,{type:jZ,target:FZ(s),index:0,kind:d})},function(){var s=pce(this),d=s.target,l=s.index++;if(!d||l>=d.length)return s.target=null,FY(void 0,!0);switch(s.kind){case"keys":return FY(l,!1);case"values":return FY(d[l],!1)}return FY([l,d[l]],!1)},"values"),h4.Arguments=h4.Array;var J9=k4,T7=function(s,d,l){return J9.f(s,d,l)},Dte=X6,Lie=T7,Mie=IH,kte=K6("species"),Lte=dN,Mte=TypeError,QK=function(s,d){if(Lte(d,s))return s;throw new Mte("Incorrect invocation")},x8=VH,aY=HQ,Uie=cN(Function.toString);x8(aY.inspectSource)||(aY.inspectSource=function(s){return Uie(s)});var Ute=aY.inspectSource,V8=cN,xie=p,F8=VH,fce=eY,Vie=Ute,xte=function(){},Vte=X6("Reflect","construct"),BZ=/^\s*(?:class|function)\b/,_ce=V8(BZ.exec),GZ=!BZ.test(xte),S7=function(s){if(!F8(s))return!1;try{return Vte(xte,[],s),!0}catch{return!1}},c8=function(s){if(!F8(s))return!1;switch(fce(s)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return GZ||!!_ce(BZ,Vie(s))}catch{return!0}};c8.sham=!0;var P6,wK,xK,ZK,R4=!Vte||xie(function(){var s;return S7(S7.call)||!S7(Object)||!S7(function(){s=!0})||s})?c8:S7,bX=R4,$K=$J,X9=TypeError,wJ=o4,WZ=function(s){if(bX(s))return s;throw new X9($K(s)+" is not a constructor")},Fte=fK,Q9=K6("species"),b4=function(s,d){var l,f=wJ(s).constructor;return f===void 0||Fte(l=wJ(f)[Q9])?d:WZ(l)},cY=cN([].slice),vX=TypeError,U4=function(s,d){if(s<d)throw new vX("Not enough arguments");return s},Z9=/(?:ipad|iphone|ipod).*applewebkit/i.test(k8),x4=mN,AJ=aH,HZ=_z,jY=VH,qZ=kK,CX=p,KZ=J4,zZ=cY,$9=JQ,V4=U4,OJ=Z9,j8=oZ,v4=x4.setImmediate,YZ=x4.clearImmediate,jte=x4.process,eQ=x4.Dispatch,Ece=x4.Function,BY=x4.MessageChannel,Fie=x4.String,tQ=0,B8={},JZ="onreadystatechange";CX(function(){P6=x4.location});var GY=function(s){if(qZ(B8,s)){var d=B8[s];delete B8[s],d()}},XZ=function(s){return function(){GY(s)}},Bte=function(s){GY(s.data)},QZ=function(s){x4.postMessage(Fie(s),P6.protocol+"//"+P6.host)};v4&&YZ||(v4=function(s){V4(arguments.length,1);var d=jY(s)?s:Ece(s),l=zZ(arguments,1);return B8[++tQ]=function(){AJ(d,void 0,l)},wK(tQ),tQ},YZ=function(s){delete B8[s]},j8?wK=function(s){jte.nextTick(XZ(s))}:eQ&&eQ.now?wK=function(s){eQ.now(XZ(s))}:BY&&!OJ?(ZK=(xK=new BY).port2,xK.port1.onmessage=Bte,wK=HZ(ZK.postMessage,ZK)):x4.addEventListener&&jY(x4.postMessage)&&!x4.importScripts&&P6&&P6.protocol!=="file:"&&!CX(QZ)?(wK=QZ,x4.addEventListener("message",Bte,!1)):wK=JZ in $9("script")?function(s){KZ.appendChild($9("script"))[JZ]=function(){KZ.removeChild(this),GY(s)}}:function(s){setTimeout(XZ(s),0)});var y7={set:v4,clear:YZ},jie=mN,mce=IH,Bie=Object.getOwnPropertyDescriptor,Gte=function(s){if(!mce)return jie[s];var d=Bie(jie,s);return d&&d.value},NJ=function(){this.head=null,this.tail=null};NJ.prototype={add:function(s){var d={item:s,next:null},l=this.tail;l?l.next=d:this.head=d,this.tail=d},get:function(){var s=this.head;if(s)return(this.head=s.next)===null&&(this.tail=null),s.item}};var IX,PJ,ZZ,bK,Gie,Wte=NJ,gce=/ipad|iphone|ipod/i.test(k8)&&typeof Pebble<"u",Tce=/web0s(?!.*chrome)/i.test(k8),R7=mN,Wie=Gte,Hie=_z,Q4=y7.set,Hte=Wte,Sce=Z9,DJ=gce,$Z=Tce,WY=oZ,nQ=R7.MutationObserver||R7.WebKitMutationObserver,e$=R7.document,t$=R7.process,n$=R7.Promise,rQ=Wie("queueMicrotask");if(!rQ){var r$=new Hte,iQ=function(){var s,d;for(WY&&(s=t$.domain)&&s.exit();d=r$.get();)try{d()}catch(l){throw r$.head&&IX(),l}s&&s.enter()};Sce||WY||$Z||!nQ||!e$?!DJ&&n$&&n$.resolve?((bK=n$.resolve(void 0)).constructor=n$,Gie=Hie(bK.then,bK),IX=function(){Gie(iQ)}):WY?IX=function(){t$.nextTick(iQ)}:(Q4=Hie(Q4,R7),IX=function(){Q4(iQ)}):(PJ=!0,ZZ=e$.createTextNode(""),new nQ(iQ).observe(ZZ,{characterData:!0}),IX=function(){ZZ.data=PJ=!PJ}),rQ=function(s){r$.head||IX(),r$.add(s)}}var qte=rQ,HY=function(s){try{return{error:!1,value:s()}}catch(d){return{error:!0,value:d}}},uY=mN.Promise,qie=mN,b7=uY,Kie=VH,Kte=n7,i$=Ute,zte=K6,sQ=w9,s$=cJ,zie=b7&&b7.prototype,o$=zte("species"),Yie=!1,wX=Kie(qie.PromiseRejectionEvent),yce=Kte("Promise",function(){var s=i$(b7),d=s!==String(b7);if(!d&&s$===66||!zie.catch||!zie.finally)return!0;if(!s$||s$<51||!/native code/.test(s)){var l=new b7(function(b){b(1)}),f=function(b){b(function(){},function(){})};if((l.constructor={})[o$]=f,!(Yie=l.then(function(){})instanceof f))return!0}return!(d||sQ!=="BROWSER"&&sQ!=="DENO"||wX)}),kJ={CONSTRUCTOR:yce,REJECTION_EVENT:wX,SUBCLASSING:Yie},z={},C_=s4,hN=TypeError,gN=function(s){var d,l;this.promise=new s(function(f,b){if(d!==void 0||l!==void 0)throw new hN("Bad Promise constructor");d=f,l=b}),this.resolve=C_(d),this.reject=C_(l)};z.f=function(s){return new gN(s)};var t3,sH,mH=f6,DH=oZ,FH=mN,s5=yH,R5=xY,b5=oY,S5=function(s){var d=Dte(s);Mie&&d&&!d[kte]&&Lie(d,kte,{configurable:!0,get:function(){return this}})},L5=s4,V5=VH,j5=Q5,VK=QK,QH=b4,WH=y7.set,t5=qte,C5=function(s,d){try{arguments.length===1?console.error(s):console.error(s,d)}catch{}},G5=HY,t6=Wte,Z5=sY,a6=uY,e4=kJ,F6=z,G8="Promise",Jie=e4.CONSTRUCTOR,vve=e4.REJECTION_EVENT,Rce=Z5.getterFor(G8),Cve=Z5.set,Ive=a6&&a6.prototype,Yte=a6,bce=Ive,mhe=FH.TypeError,vce=FH.document,Cce=FH.process,Ice=F6.f,wve=Ice,Ave=!!(vce&&vce.createEvent&&FH.dispatchEvent),ghe="unhandledrejection",The=function(s){var d;return!(!j5(s)||!V5(d=s.then))&&d},She=function(s,d){var l,f,b,k=d.value,B=d.state===1,Wt=B?s.ok:s.fail,$O=s.resolve,uN=s.reject,lN=s.domain;try{Wt?(B||(d.rejection===2&&Nve(d),d.rejection=1),Wt===!0?l=k:(lN&&lN.enter(),l=Wt(k),lN&&(lN.exit(),b=!0)),l===s.promise?uN(new mhe("Promise-chain cycle")):(f=The(l))?s5(f,l,$O,uN):$O(l)):uN(k)}catch(_N){lN&&!b&&lN.exit(),uN(_N)}},yhe=function(s,d){s.notified||(s.notified=!0,t5(function(){for(var l,f=s.reactions;l=f.get();)She(l,s);s.notified=!1,d&&!s.rejection&&Ove(s)}))},Rhe=function(s,d,l){var f,b;Ave?((f=vce.createEvent("Event")).promise=d,f.reason=l,f.initEvent(s,!1,!0),FH.dispatchEvent(f)):f={promise:d,reason:l},!vve&&(b=FH["on"+s])?b(f):s===ghe&&C5("Unhandled promise rejection",l)},Ove=function(s){s5(WH,FH,function(){var d,l=s.facade,f=s.value;if(bhe(s)&&(d=G5(function(){DH?Cce.emit("unhandledRejection",f,l):Rhe(ghe,l,f)}),s.rejection=DH||bhe(s)?2:1,d.error))throw d.value})},bhe=function(s){return s.rejection!==1&&!s.parent},Nve=function(s){s5(WH,FH,function(){var d=s.facade;DH?Cce.emit("rejectionHandled",d):Rhe("rejectionhandled",d,s.value)})},a$=function(s,d,l){return function(f){s(d,f,l)}},c$=function(s,d,l){s.done||(s.done=!0,l&&(s=l),s.value=d,s.state=2,yhe(s,!0))},wce=function(s,d,l){if(!s.done){s.done=!0,l&&(s=l);try{if(s.facade===d)throw new mhe("Promise can't be resolved itself");var f=The(d);f?t5(function(){var b={done:!1};try{s5(f,d,a$(wce,b,s),a$(c$,b,s))}catch(k){c$(b,k,s)}}):(s.value=d,s.state=1,yhe(s,!1))}catch(b){c$({done:!1},b,s)}}};Jie&&(bce=(Yte=function(s){VK(this,bce),L5(s),s5(t3,this);var d=Rce(this);try{s(a$(wce,d),a$(c$,d))}catch(l){c$(d,l)}}).prototype,(t3=function(s){Cve(this,{type:G8,done:!1,notified:!1,parent:!1,reactions:new t6,rejection:!1,state:0,value:null})}).prototype=R5(bce,"then",function(s,d){var l=Rce(this),f=Ice(QH(this,Yte));return l.parent=!0,f.ok=!V5(s)||s,f.fail=V5(d)&&d,f.domain=DH?Cce.domain:void 0,l.state===0?l.reactions.add(f):t5(function(){She(f,l)}),f.promise}),sH=function(){var s=new t3,d=Rce(s);this.promise=s,this.resolve=a$(wce,d),this.reject=a$(c$,d)},F6.f=Ice=function(s){return s===Yte||s===void 0?new sH(s):wve(s)}),mH({global:!0,constructor:!0,wrap:!0,forced:Jie},{Promise:Yte}),b5(Yte,G8,!1,!0),S5(G8);var vhe=K6("iterator"),Che=!1;try{var Pve=0,Ihe={next:function(){return{done:!!Pve++}},return:function(){Che=!0}};Ihe[vhe]=function(){return this},Array.from(Ihe,function(){throw 2})}catch{}var Dve=uY,kve=function(s,d){try{if(!d&&!Che)return!1}catch{return!1}var l=!1;try{var f={};f[vhe]=function(){return{next:function(){return{done:l=!0}}}},s(f)}catch{}return l},Xie=kJ.CONSTRUCTOR||!kve(function(s){Dve.all(s).then(void 0,function(){})}),Lve=yH,Mve=s4,Uve=z,xve=HY,Vve=UY;f6({target:"Promise",stat:!0,forced:Xie},{all:function(s){var d=this,l=Uve.f(d),f=l.resolve,b=l.reject,k=xve(function(){var B=Mve(d.resolve),Wt=[],$O=0,uN=1;Vve(s,function(lN){var _N=$O++,TN=!1;uN++,Lve(B,d,lN).then(function(vN){TN||(TN=!0,Wt[_N]=vN,--uN||f(Wt))},b)}),--uN||f(Wt)});return k.error&&b(k.value),l.promise}});var Fve=f6,jve=kJ.CONSTRUCTOR;uY&&uY.prototype,Fve({target:"Promise",proto:!0,forced:jve,real:!0},{catch:function(s){return this.then(void 0,s)}});var Bve=yH,Gve=s4,Wve=z,Hve=HY,qve=UY;f6({target:"Promise",stat:!0,forced:Xie},{race:function(s){var d=this,l=Wve.f(d),f=l.reject,b=Hve(function(){var k=Gve(d.resolve);qve(s,function(B){Bve(k,d,B).then(l.resolve,f)})});return b.error&&f(b.value),l.promise}});var Kve=z;f6({target:"Promise",stat:!0,forced:kJ.CONSTRUCTOR},{reject:function(s){var d=Kve.f(this);return(0,d.reject)(s),d.promise}});var zve=o4,Yve=Q5,Jve=z,whe=function(s,d){if(zve(s),Yve(d)&&d.constructor===s)return d;var l=Jve.f(s);return(0,l.resolve)(d),l.promise},Xve=f6,Qve=uY,Zve=kJ.CONSTRUCTOR,$ve=whe,eCe=X6("Promise"),tCe=!Zve;Xve({target:"Promise",stat:!0,forced:!0},{resolve:function(s){return $ve(tCe&&this===eCe?Qve:this,s)}});var nCe=yH,rCe=s4,iCe=z,sCe=HY,oCe=UY;f6({target:"Promise",stat:!0,forced:Xie},{allSettled:function(s){var d=this,l=iCe.f(d),f=l.resolve,b=l.reject,k=sCe(function(){var B=rCe(d.resolve),Wt=[],$O=0,uN=1;oCe(s,function(lN){var _N=$O++,TN=!1;uN++,nCe(B,d,lN).then(function(vN){TN||(TN=!0,Wt[_N]={status:"fulfilled",value:vN},--uN||f(Wt))},function(vN){TN||(TN=!0,Wt[_N]={status:"rejected",reason:vN},--uN||f(Wt))})}),--uN||f(Wt)});return k.error&&b(k.value),l.promise}});var aCe=yH,cCe=s4,uCe=X6,dCe=z,lCe=HY,hCe=UY,Ahe="No one promise resolved";f6({target:"Promise",stat:!0,forced:Xie},{any:function(s){var d=this,l=uCe("AggregateError"),f=dCe.f(d),b=f.resolve,k=f.reject,B=lCe(function(){var Wt=cCe(d.resolve),$O=[],uN=0,lN=1,_N=!1;hCe(s,function(TN){var vN=uN++,uH=!1;lN++,aCe(Wt,d,TN).then(function(rH){uH||_N||(_N=!0,b(rH))},function(rH){uH||_N||(uH=!0,$O[vN]=rH,--lN||k(new l($O,Ahe)))})}),--lN||k(new l($O,Ahe))});return B.error&&k(B.value),f.promise}});var pCe=f6,fCe=aH,_Ce=cY,ECe=z,mCe=s4,Ohe=HY,Ace=mN.Promise,Nhe=!1;pCe({target:"Promise",stat:!0,forced:!Ace||!Ace.try||Ohe(function(){Ace.try(function(s){Nhe=s===8},8)}).error||!Nhe},{try:function(s){var d=arguments.length>1?_Ce(arguments,1):[],l=ECe.f(this),f=Ohe(function(){return fCe(mCe(s),void 0,d)});return(f.error?l.reject:l.resolve)(f.value),l.promise}});var gCe=z;f6({target:"Promise",stat:!0},{withResolvers:function(){var s=gCe.f(this);return{promise:s.promise,resolve:s.resolve,reject:s.reject}}});var TCe=f6,Oce=uY,SCe=p,yCe=X6,RCe=VH,bCe=b4,Phe=whe,vCe=Oce&&Oce.prototype;TCe({target:"Promise",proto:!0,real:!0,forced:!!Oce&&SCe(function(){vCe.finally.call({then:function(){}},function(){})})},{finally:function(s){var d=bCe(this,yCe("Promise")),l=RCe(s);return this.then(l?function(f){return Phe(d,s()).then(function(){return f})}:s,l?function(f){return Phe(d,s()).then(function(){throw f})}:s)}});var Nce=cN,CCe=Mee,ICe=K4,wCe=L6,ACe=Nce("".charAt),Dhe=Nce("".charCodeAt),OCe=Nce("".slice),khe=function(s){return function(d,l){var f,b,k=ICe(wCe(d)),B=CCe(l),Wt=k.length;return B<0||B>=Wt?s?"":void 0:(f=Dhe(k,B))<55296||f>56319||B+1===Wt||(b=Dhe(k,B+1))<56320||b>57343?s?ACe(k,B):f:s?OCe(k,B,B+2):b-56320+(f-55296<<10)+65536}},Pce={codeAt:khe(!1),charAt:khe(!0)},NCe=Pce.charAt,PCe=K4,Lhe=sY,DCe=Pie,Mhe=VZ,Uhe="String Iterator",kCe=Lhe.set,LCe=Lhe.getterFor(Uhe);DCe(String,"String",function(s){kCe(this,{type:Uhe,string:PCe(s),index:0})},function(){var s,d=LCe(this),l=d.string,f=d.index;return f>=l.length?Mhe(void 0,!0):(s=NCe(l,f),d.index+=s.length,Mhe(s,!1))});var MCe=M6.Promise,UCe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xCe=mN,VCe=oY,xhe=a4;for(var Dce in UCe)VCe(xCe[Dce],Dce),xhe[Dce]=xhe.Array;var Vhe=MCe,u5=h(Vhe),FCe=l4("Array","values"),jCe=eY,BCe=kK,GCe=dN,WCe=FCe,kce=Array.prototype,HCe={DOMTokenList:!0,NodeList:!0},qCe=function(s){var d=s.values;return s===kce||GCe(kce,s)&&d===kce.values||BCe(HCe,jCe(s))?WCe:d},S8=h(qCe),KCe=f6,zCe=cN,YCe=Uee,JCe=RangeError,Fhe=String.fromCharCode,jhe=String.fromCodePoint,XCe=zCe([].join);KCe({target:"String",stat:!0,arity:1,forced:!!jhe&&jhe.length!==1},{fromCodePoint:function(s){for(var d,l=[],f=arguments.length,b=0;f>b;){if(d=+arguments[b++],YCe(d,1114111)!==d)throw new JCe(d+" is not a valid code point");l[b]=d<65536?Fhe(d):Fhe(55296+((d-=65536)>>10),d%1024+56320)}return XCe(l,"")}});var QCe=p,ZCe=lae,$Ce=K6("iterator"),Qie=!QCe(function(){var s=new URL("b?a=1&b=2&c=3","https://a"),d=s.searchParams,l=new URLSearchParams("a=1&a=2&b=3"),f="";return s.pathname="c%20d",d.forEach(function(b,k){d.delete("b"),f+=k+b}),l.delete("a",2),l.delete("b",void 0),!s.toJSON||!l.has("a",1)||l.has("a",2)||!l.has("a",void 0)||l.has("b")||!d.size&&ZCe||!d.sort||s.href!=="https://a/c%20d?a=1&c=3"||d.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!d[$Ce]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||f!=="a1c3"||new URL("https://x",void 0).host!=="x"}),eIe=xY,Bhe=cY,tIe=Math.floor,Lce=function(s,d){var l=s.length;if(l<8)for(var f,b,k=1;k<l;){for(b=k,f=s[k];b&&d(s[b-1],f)>0;)s[b]=s[--b];b!==k++&&(s[b]=f)}else for(var B=tIe(l/2),Wt=Lce(Bhe(s,0,B),d),$O=Lce(Bhe(s,B),d),uN=Wt.length,lN=$O.length,_N=0,TN=0;_N<uN||TN<lN;)s[_N+TN]=_N<uN&&TN<lN?d(Wt[_N],$O[TN])<=0?Wt[_N++]:$O[TN++]:_N<uN?Wt[_N++]:$O[TN++];return s},Ghe=Lce,Mce=f6,Whe=mN,Uce=Gte,nIe=X6,Zie=yH,qY=cN,Jte=IH,Hhe=Qie,qhe=xY,rIe=T7,iIe=function(s,d,l){for(var f in d)l.unsafe&&s[f]?s[f]=d[f]:eIe(s,f,d[f],l);return s},sIe=oY,oIe=H9,xce=sY,Khe=QK,Vce=VH,aIe=kK,cIe=_z,uIe=eY,dIe=o4,zhe=Q5,u8=K4,lIe=LY,Yhe=xH,Jhe=h7,hIe=l7,$ie=VZ,u$=U4,pIe=Ghe,fIe=K6("iterator"),d$="URLSearchParams",Xhe=d$+"Iterator",Qhe=xce.set,dY=xce.getterFor(d$),_Ie=xce.getterFor(Xhe),Zhe=Uce("fetch"),ese=Uce("Request"),Xte=Uce("Headers"),Fce=ese&&ese.prototype,$he=Xte&&Xte.prototype,EIe=Whe.TypeError,mIe=Whe.encodeURIComponent,gIe=String.fromCharCode,TIe=nIe("String","fromCodePoint"),SIe=parseInt,tse=qY("".charAt),epe=qY([].join),AX=qY([].push),tpe=qY("".replace),yIe=qY([].shift),npe=qY([].splice),rpe=qY("".split),ipe=qY("".slice),RIe=qY(/./.exec),bIe=/\+/g,vIe=/^[0-9a-f]+$/i,spe=function(s,d){var l=ipe(s,d,d+2);return RIe(vIe,l)?SIe(l,16):NaN},CIe=function(s){for(var d=0,l=128;l>0&&s&l;l>>=1)d++;return d},IIe=function(s){var d=null;switch(s.length){case 1:d=s[0];break;case 2:d=(31&s[0])<<6|63&s[1];break;case 3:d=(15&s[0])<<12|(63&s[1])<<6|63&s[2];break;case 4:d=(7&s[0])<<18|(63&s[1])<<12|(63&s[2])<<6|63&s[3]}return d>1114111?null:d},ope=function(s){for(var d=(s=tpe(s,bIe," ")).length,l="",f=0;f<d;){var b=tse(s,f);if(b==="%"){if(tse(s,f+1)==="%"||f+3>d){l+="%",f++;continue}var k=spe(s,f+1);if(k!=k){l+=b,f++;continue}f+=2;var B=CIe(k);if(B===0)b=gIe(k);else{if(B===1||B>4){l+="�",f++;continue}for(var Wt=[k],$O=1;$O<B&&!(++f+3>d||tse(s,f)!=="%");){var uN=spe(s,f+1);if(uN!=uN){f+=3;break}if(uN>191||uN<128)break;AX(Wt,uN),f+=2,$O++}if(Wt.length!==B){l+="�";continue}var lN=IIe(Wt);lN===null?l+="�":b=TIe(lN)}}l+=b,f++}return l},wIe=/[!'()~]|%20/g,AIe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},OIe=function(s){return AIe[s]},ape=function(s){return tpe(mIe(s),wIe,OIe)},jce=oIe(function(s,d){Qhe(this,{type:Xhe,target:dY(s).entries,index:0,kind:d})},d$,function(){var s=_Ie(this),d=s.target,l=s.index++;if(!d||l>=d.length)return s.target=null,$ie(void 0,!0);var f=d[l];switch(s.kind){case"keys":return $ie(f.key,!1);case"values":return $ie(f.value,!1)}return $ie([f.key,f.value],!1)},!0),cpe=function(s){this.entries=[],this.url=null,s!==void 0&&(zhe(s)?this.parseObject(s):this.parseQuery(typeof s=="string"?tse(s,0)==="?"?ipe(s,1):s:u8(s)))};cpe.prototype={type:d$,bindURL:function(s){this.url=s,this.update()},parseObject:function(s){var d,l,f,b,k,B,Wt,$O=this.entries,uN=hIe(s);if(uN)for(l=(d=Jhe(s,uN)).next;!(f=Zie(l,d)).done;){if(k=(b=Jhe(dIe(f.value))).next,(B=Zie(k,b)).done||(Wt=Zie(k,b)).done||!Zie(k,b).done)throw new EIe("Expected sequence with length 2");AX($O,{key:u8(B.value),value:u8(Wt.value)})}else for(var lN in s)aIe(s,lN)&&AX($O,{key:lN,value:u8(s[lN])})},parseQuery:function(s){if(s)for(var d,l,f=this.entries,b=rpe(s,"&"),k=0;k<b.length;)(d=b[k++]).length&&(l=rpe(d,"="),AX(f,{key:ope(yIe(l)),value:ope(epe(l,"="))}))},serialize:function(){for(var s,d=this.entries,l=[],f=0;f<d.length;)s=d[f++],AX(l,ape(s.key)+"="+ape(s.value));return epe(l,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var nse=function(){Khe(this,l$);var s=Qhe(this,new cpe(arguments.length>0?arguments[0]:void 0));Jte||(this.size=s.entries.length)},l$=nse.prototype;if(iIe(l$,{append:function(s,d){var l=dY(this);u$(arguments.length,2),AX(l.entries,{key:u8(s),value:u8(d)}),Jte||this.length++,l.updateURL()},delete:function(s){for(var d=dY(this),l=u$(arguments.length,1),f=d.entries,b=u8(s),k=l<2?void 0:arguments[1],B=k===void 0?k:u8(k),Wt=0;Wt<f.length;){var $O=f[Wt];if($O.key!==b||B!==void 0&&$O.value!==B)Wt++;else if(npe(f,Wt,1),B!==void 0)break}Jte||(this.size=f.length),d.updateURL()},get:function(s){var d=dY(this).entries;u$(arguments.length,1);for(var l=u8(s),f=0;f<d.length;f++)if(d[f].key===l)return d[f].value;return null},getAll:function(s){var d=dY(this).entries;u$(arguments.length,1);for(var l=u8(s),f=[],b=0;b<d.length;b++)d[b].key===l&&AX(f,d[b].value);return f},has:function(s){for(var d=dY(this).entries,l=u$(arguments.length,1),f=u8(s),b=l<2?void 0:arguments[1],k=b===void 0?b:u8(b),B=0;B<d.length;){var Wt=d[B++];if(Wt.key===f&&(k===void 0||Wt.value===k))return!0}return!1},set:function(s,d){var l=dY(this);u$(arguments.length,1);for(var f,b=l.entries,k=!1,B=u8(s),Wt=u8(d),$O=0;$O<b.length;$O++)(f=b[$O]).key===B&&(k?npe(b,$O--,1):(k=!0,f.value=Wt));k||AX(b,{key:B,value:Wt}),Jte||(this.size=b.length),l.updateURL()},sort:function(){var s=dY(this);pIe(s.entries,function(d,l){return d.key>l.key?1:-1}),s.updateURL()},forEach:function(s){for(var d,l=dY(this).entries,f=cIe(s,arguments.length>1?arguments[1]:void 0),b=0;b<l.length;)f((d=l[b++]).value,d.key,this)},keys:function(){return new jce(this,"keys")},values:function(){return new jce(this,"values")},entries:function(){return new jce(this,"entries")}},{enumerable:!0}),qhe(l$,fIe,l$.entries,{name:"entries"}),qhe(l$,"toString",function(){return dY(this).serialize()},{enumerable:!0}),Jte&&rIe(l$,"size",{get:function(){return dY(this).entries.length},configurable:!0,enumerable:!0}),sIe(nse,d$),Mce({global:!0,constructor:!0,forced:!Hhe},{URLSearchParams:nse}),!Hhe&&Vce(Xte)){var NIe=qY($he.has),PIe=qY($he.set),upe=function(s){if(zhe(s)){var d,l=s.body;if(uIe(l)===d$)return d=s.headers?new Xte(s.headers):new Xte,NIe(d,"content-type")||PIe(d,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lIe(s,{body:Yhe(0,u8(l)),headers:Yhe(0,d)})}return s};if(Vce(Zhe)&&Mce({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(s){return Zhe(s,arguments.length>1?upe(arguments[1]):{})}}),Vce(ese)){var Bce=function(s){return Khe(this,Fce),new ese(s,arguments.length>1?upe(arguments[1]):{})};Fce.constructor=Bce,Bce.prototype=Fce,Mce({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Bce})}}var lY,DIe={URLSearchParams:nse,getState:dY},kIe=M6.URLSearchParams,dpe=IH,LIe=cN,MIe=yH,UIe=p,Gce=L4,xIe=uX,VIe=TH,FIe=Q6,jIe=C6,h$=Object.assign,lpe=Object.defineProperty,BIe=LIe([].concat),GIe=!h$||UIe(function(){if(dpe&&h$({b:1},h$(lpe({},"a",{enumerable:!0,get:function(){lpe(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var s={},d={},l=Symbol("assign detection"),f="abcdefghijklmnopqrst";return s[l]=7,f.split("").forEach(function(b){d[b]=b}),h$({},s)[l]!==7||Gce(h$({},d)).join("")!==f})?function(s,d){for(var l=FIe(s),f=arguments.length,b=1,k=xIe.f,B=VIe.f;f>b;)for(var Wt,$O=jIe(arguments[b++]),uN=k?BIe(Gce($O),k($O)):Gce($O),lN=uN.length,_N=0;lN>_N;)Wt=uN[_N++],dpe&&!MIe(B,$O,Wt)||(l[Wt]=$O[Wt]);return l}:h$,WIe=o4,HIe=ste,qIe=IH,KIe=k4,zIe=xH,Wce=function(s,d,l){qIe?KIe.f(s,d,zIe(0,l)):s[d]=l},YIe=_z,JIe=yH,XIe=Q6,QIe=function(s,d,l,f){try{return f?d(WIe(l)[0],l[1]):d(l)}catch(b){HIe(s,"throw",b)}},ZIe=tY,$Ie=R4,ewe=mJ,hpe=Wce,twe=h7,nwe=l7,ppe=Array,oQ=cN,Hce=2147483647,rwe=/[^\0-\u007E]/,fpe=/[.\u3002\uFF0E\uFF61]/g,_pe="Overflow: input needs wider integers to process",Epe=RangeError,iwe=oQ(fpe.exec),p$=Math.floor,qce=String.fromCharCode,mpe=oQ("".charCodeAt),gpe=oQ([].join),OX=oQ([].push),swe=oQ("".replace),owe=oQ("".split),awe=oQ("".toLowerCase),Tpe=function(s){return s+22+75*(s<26)},cwe=function(s,d,l){var f=0;for(s=l?p$(s/700):s>>1,s+=p$(s/d);s>455;)s=p$(s/35),f+=36;return p$(f+36*s/(s+38))},uwe=function(s){var d=[];s=function(lH){for(var hH=[],bH=0,PH=lH.length;bH<PH;){var OH=mpe(lH,bH++);if(OH>=55296&&OH<=56319&&bH<PH){var wH=mpe(lH,bH++);(64512&wH)==56320?OX(hH,((1023&OH)<<10)+(1023&wH)+65536):(OX(hH,OH),bH--)}else OX(hH,OH)}return hH}(s);var l,f,b=s.length,k=128,B=0,Wt=72;for(l=0;l<s.length;l++)(f=s[l])<128&&OX(d,qce(f));var $O=d.length,uN=$O;for($O&&OX(d,"-");uN<b;){var lN=Hce;for(l=0;l<s.length;l++)(f=s[l])>=k&&f<lN&&(lN=f);var _N=uN+1;if(lN-k>p$((Hce-B)/_N))throw new Epe(_pe);for(B+=(lN-k)*_N,k=lN,l=0;l<s.length;l++){if((f=s[l])<k&&++B>Hce)throw new Epe(_pe);if(f===k){for(var TN=B,vN=36;;){var uH=vN<=Wt?1:vN>=Wt+26?26:vN-Wt;if(TN<uH)break;var rH=TN-uH,iH=36-uH;OX(d,qce(Tpe(uH+rH%iH))),TN=p$(rH/iH),vN+=36}OX(d,qce(Tpe(TN))),Wt=cwe(B,_N,uN===$O),B=0,uN++}}B++,k++}return gpe(d,"")},dwe=f6,Kce=IH,lwe=Qie,zce=mN,Spe=_z,hY=cN,rse=xY,pY=T7,hwe=QK,Yce=kK,Jce=GIe,f$=function(s){var d=XIe(s),l=$Ie(this),f=arguments.length,b=f>1?arguments[1]:void 0,k=b!==void 0;k&&(b=YIe(b,f>2?arguments[2]:void 0));var B,Wt,$O,uN,lN,_N,TN=nwe(d),vN=0;if(!TN||this===ppe&&ZIe(TN))for(B=ewe(d),Wt=l?new this(B):ppe(B);B>vN;vN++)_N=k?b(d[vN],vN):d[vN],hpe(Wt,vN,_N);else for(Wt=l?new this:[],lN=(uN=twe(d,TN)).next;!($O=JIe(lN,uN)).done;vN++)_N=k?QIe(uN,b,[$O.value,vN],!0):$O.value,hpe(Wt,vN,_N);return Wt.length=vN,Wt},KY=cY,pwe=Pce.codeAt,fwe=function(s){var d,l,f=[],b=owe(swe(awe(s),fpe,"."),".");for(d=0;d<b.length;d++)l=b[d],OX(f,iwe(rwe,l)?"xn--"+uwe(l):l);return gpe(f,".")},v7=K4,_we=oY,Ewe=U4,ype=DIe,Rpe=sY,mwe=Rpe.set,ise=Rpe.getterFor("URL"),gwe=ype.URLSearchParams,Twe=ype.getState,Qte=zce.URL,Xce=zce.TypeError,sse=zce.parseInt,Swe=Math.floor,bpe=Math.pow,fY=hY("".charAt),zY=hY(/./.exec),Zte=hY([].join),ywe=hY(1 .toString),Rwe=hY([].pop),_$=hY([].push),Qce=hY("".replace),bwe=hY([].shift),vwe=hY("".split),$te=hY("".slice),ose=hY("".toLowerCase),Cwe=hY([].unshift),Zce="Invalid scheme",aQ="Invalid host",vpe="Invalid port",Cpe=/[a-z]/i,Iwe=/[\d+-.a-z]/i,$ce=/\d/,wwe=/^0x/i,Awe=/^[0-7]+$/,Owe=/^\d+$/,Ipe=/^[\da-f]+$/i,Nwe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Pwe=/[\0\t\n\r #/:<>?@[\\\]^|]/,Dwe=/^[\u0000-\u0020]+/,kwe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Lwe=/[\t\n\r]/g,ene=function(s){var d,l,f,b;if(typeof s=="number"){for(d=[],l=0;l<4;l++)Cwe(d,s%256),s=Swe(s/256);return Zte(d,".")}if(typeof s=="object"){for(d="",f=function(k){for(var B=null,Wt=1,$O=null,uN=0,lN=0;lN<8;lN++)k[lN]!==0?(uN>Wt&&(B=$O,Wt=uN),$O=null,uN=0):($O===null&&($O=lN),++uN);return uN>Wt?$O:B}(s),l=0;l<8;l++)b&&s[l]===0||(b&&(b=!1),f===l?(d+=l?":":"::",b=!0):(d+=ywe(s[l],16),l<7&&(d+=":")));return"["+d+"]"}return s},ase={},wpe=Jce({},ase,{" ":1,'"':1,"<":1,">":1,"`":1}),Ape=Jce({},wpe,{"#":1,"?":1,"{":1,"}":1}),eue=Jce({},Ape,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),NX=function(s,d){var l=pwe(s,0);return l>32&&l<127&&!Yce(d,s)?s:encodeURIComponent(s)},cse={ftp:21,file:null,http:80,https:443,ws:80,wss:443},tne=function(s,d){var l;return s.length===2&&zY(Cpe,fY(s,0))&&((l=fY(s,1))===":"||!d&&l==="|")},Ope=function(s){var d;return s.length>1&&tne($te(s,0,2))&&(s.length===2||(d=fY(s,2))==="/"||d==="\\"||d==="?"||d==="#")},Mwe=function(s){return s==="."||ose(s)==="%2e"},tue={},Npe={},nue={},Ppe={},Dpe={},rue={},kpe={},Lpe={},use={},dse={},iue={},sue={},oue={},aue={},Mpe={},cue={},E$={},LJ={},Upe={},cQ={},C7={},uue=function(s,d,l){var f,b,k,B=v7(s);if(d){if(b=this.parse(B))throw new Xce(b);this.searchParams=null}else{if(l!==void 0&&(f=new uue(l,!0)),b=this.parse(B,null,f))throw new Xce(b);(k=Twe(new gwe)).bindURL(this),this.searchParams=k}};uue.prototype={type:"URL",parse:function(s,d,l){var f,b,k,B,Wt,$O=this,uN=d||tue,lN=0,_N="",TN=!1,vN=!1,uH=!1;for(s=v7(s),d||($O.scheme="",$O.username="",$O.password="",$O.host=null,$O.port=null,$O.path=[],$O.query=null,$O.fragment=null,$O.cannotBeABaseURL=!1,s=Qce(s,Dwe,""),s=Qce(s,kwe,"$1")),s=Qce(s,Lwe,""),f=f$(s);lN<=f.length;){switch(b=f[lN],uN){case tue:if(!b||!zY(Cpe,b)){if(d)return Zce;uN=nue;continue}_N+=ose(b),uN=Npe;break;case Npe:if(b&&(zY(Iwe,b)||b==="+"||b==="-"||b==="."))_N+=ose(b);else{if(b!==":"){if(d)return Zce;_N="",uN=nue,lN=0;continue}if(d&&($O.isSpecial()!==Yce(cse,_N)||_N==="file"&&($O.includesCredentials()||$O.port!==null)||$O.scheme==="file"&&!$O.host))return;if($O.scheme=_N,d)return void($O.isSpecial()&&cse[$O.scheme]===$O.port&&($O.port=null));_N="",$O.scheme==="file"?uN=aue:$O.isSpecial()&&l&&l.scheme===$O.scheme?uN=Ppe:$O.isSpecial()?uN=Lpe:f[lN+1]==="/"?(uN=Dpe,lN++):($O.cannotBeABaseURL=!0,_$($O.path,""),uN=Upe)}break;case nue:if(!l||l.cannotBeABaseURL&&b!=="#")return Zce;if(l.cannotBeABaseURL&&b==="#"){$O.scheme=l.scheme,$O.path=KY(l.path),$O.query=l.query,$O.fragment="",$O.cannotBeABaseURL=!0,uN=C7;break}uN=l.scheme==="file"?aue:rue;continue;case Ppe:if(b!=="/"||f[lN+1]!=="/"){uN=rue;continue}uN=use,lN++;break;case Dpe:if(b==="/"){uN=dse;break}uN=LJ;continue;case rue:if($O.scheme=l.scheme,b===lY)$O.username=l.username,$O.password=l.password,$O.host=l.host,$O.port=l.port,$O.path=KY(l.path),$O.query=l.query;else if(b==="/"||b==="\\"&&$O.isSpecial())uN=kpe;else if(b==="?")$O.username=l.username,$O.password=l.password,$O.host=l.host,$O.port=l.port,$O.path=KY(l.path),$O.query="",uN=cQ;else{if(b!=="#"){$O.username=l.username,$O.password=l.password,$O.host=l.host,$O.port=l.port,$O.path=KY(l.path),$O.path.length--,uN=LJ;continue}$O.username=l.username,$O.password=l.password,$O.host=l.host,$O.port=l.port,$O.path=KY(l.path),$O.query=l.query,$O.fragment="",uN=C7}break;case kpe:if(!$O.isSpecial()||b!=="/"&&b!=="\\"){if(b!=="/"){$O.username=l.username,$O.password=l.password,$O.host=l.host,$O.port=l.port,uN=LJ;continue}uN=dse}else uN=use;break;case Lpe:if(uN=use,b!=="/"||fY(_N,lN+1)!=="/")continue;lN++;break;case use:if(b!=="/"&&b!=="\\"){uN=dse;continue}break;case dse:if(b==="@"){TN&&(_N="%40"+_N),TN=!0,k=f$(_N);for(var rH=0;rH<k.length;rH++){var iH=k[rH];if(iH!==":"||uH){var lH=NX(iH,eue);uH?$O.password+=lH:$O.username+=lH}else uH=!0}_N=""}else if(b===lY||b==="/"||b==="?"||b==="#"||b==="\\"&&$O.isSpecial()){if(TN&&_N==="")return"Invalid authority";lN-=f$(_N).length+1,_N="",uN=iue}else _N+=b;break;case iue:case sue:if(d&&$O.scheme==="file"){uN=cue;continue}if(b!==":"||vN){if(b===lY||b==="/"||b==="?"||b==="#"||b==="\\"&&$O.isSpecial()){if($O.isSpecial()&&_N==="")return aQ;if(d&&_N===""&&($O.includesCredentials()||$O.port!==null))return;if(B=$O.parseHost(_N))return B;if(_N="",uN=E$,d)return;continue}b==="["?vN=!0:b==="]"&&(vN=!1),_N+=b}else{if(_N==="")return aQ;if(B=$O.parseHost(_N))return B;if(_N="",uN=oue,d===sue)return}break;case oue:if(!zY($ce,b)){if(b===lY||b==="/"||b==="?"||b==="#"||b==="\\"&&$O.isSpecial()||d){if(_N!==""){var hH=sse(_N,10);if(hH>65535)return vpe;$O.port=$O.isSpecial()&&hH===cse[$O.scheme]?null:hH,_N=""}if(d)return;uN=E$;continue}return vpe}_N+=b;break;case aue:if($O.scheme="file",b==="/"||b==="\\")uN=Mpe;else{if(!l||l.scheme!=="file"){uN=LJ;continue}switch(b){case lY:$O.host=l.host,$O.path=KY(l.path),$O.query=l.query;break;case"?":$O.host=l.host,$O.path=KY(l.path),$O.query="",uN=cQ;break;case"#":$O.host=l.host,$O.path=KY(l.path),$O.query=l.query,$O.fragment="",uN=C7;break;default:Ope(Zte(KY(f,lN),""))||($O.host=l.host,$O.path=KY(l.path),$O.shortenPath()),uN=LJ;continue}}break;case Mpe:if(b==="/"||b==="\\"){uN=cue;break}l&&l.scheme==="file"&&!Ope(Zte(KY(f,lN),""))&&(tne(l.path[0],!0)?_$($O.path,l.path[0]):$O.host=l.host),uN=LJ;continue;case cue:if(b===lY||b==="/"||b==="\\"||b==="?"||b==="#"){if(!d&&tne(_N))uN=LJ;else if(_N===""){if($O.host="",d)return;uN=E$}else{if(B=$O.parseHost(_N))return B;if($O.host==="localhost"&&($O.host=""),d)return;_N="",uN=E$}continue}_N+=b;break;case E$:if($O.isSpecial()){if(uN=LJ,b!=="/"&&b!=="\\")continue}else if(d||b!=="?")if(d||b!=="#"){if(b!==lY&&(uN=LJ,b!=="/"))continue}else $O.fragment="",uN=C7;else $O.query="",uN=cQ;break;case LJ:if(b===lY||b==="/"||b==="\\"&&$O.isSpecial()||!d&&(b==="?"||b==="#")){if((Wt=ose(Wt=_N))===".."||Wt==="%2e."||Wt===".%2e"||Wt==="%2e%2e"?($O.shortenPath(),b==="/"||b==="\\"&&$O.isSpecial()||_$($O.path,"")):Mwe(_N)?b==="/"||b==="\\"&&$O.isSpecial()||_$($O.path,""):($O.scheme==="file"&&!$O.path.length&&tne(_N)&&($O.host&&($O.host=""),_N=fY(_N,0)+":"),_$($O.path,_N)),_N="",$O.scheme==="file"&&(b===lY||b==="?"||b==="#"))for(;$O.path.length>1&&$O.path[0]==="";)bwe($O.path);b==="?"?($O.query="",uN=cQ):b==="#"&&($O.fragment="",uN=C7)}else _N+=NX(b,Ape);break;case Upe:b==="?"?($O.query="",uN=cQ):b==="#"?($O.fragment="",uN=C7):b!==lY&&($O.path[0]+=NX(b,ase));break;case cQ:d||b!=="#"?b!==lY&&(b==="'"&&$O.isSpecial()?$O.query+="%27":$O.query+=b==="#"?"%23":NX(b,ase)):($O.fragment="",uN=C7);break;case C7:b!==lY&&($O.fragment+=NX(b,wpe))}lN++}},parseHost:function(s){var d,l,f;if(fY(s,0)==="["){if(fY(s,s.length-1)!=="]"||(d=function(b){var k,B,Wt,$O,uN,lN,_N,TN=[0,0,0,0,0,0,0,0],vN=0,uH=null,rH=0,iH=function(){return fY(b,rH)};if(iH()===":"){if(fY(b,1)!==":")return;rH+=2,uH=++vN}for(;iH();){if(vN===8)return;if(iH()!==":"){for(k=B=0;B<4&&zY(Ipe,iH());)k=16*k+sse(iH(),16),rH++,B++;if(iH()==="."){if(B===0||(rH-=B,vN>6))return;for(Wt=0;iH();){if($O=null,Wt>0){if(!(iH()==="."&&Wt<4))return;rH++}if(!zY($ce,iH()))return;for(;zY($ce,iH());){if(uN=sse(iH(),10),$O===null)$O=uN;else{if($O===0)return;$O=10*$O+uN}if($O>255)return;rH++}TN[vN]=256*TN[vN]+$O,++Wt!=2&&Wt!==4||vN++}if(Wt!==4)return;break}if(iH()===":"){if(rH++,!iH())return}else if(iH())return;TN[vN++]=k}else{if(uH!==null)return;rH++,uH=++vN}}if(uH!==null)for(lN=vN-uH,vN=7;vN!==0&&lN>0;)_N=TN[vN],TN[vN--]=TN[uH+lN-1],TN[uH+--lN]=_N;else if(vN!==8)return;return TN}($te(s,1,-1)),!d))return aQ;this.host=d}else if(this.isSpecial()){if(s=fwe(s),zY(Nwe,s)||(d=function(b){var k,B,Wt,$O,uN,lN,_N,TN=vwe(b,".");if(TN.length&&TN[TN.length-1]===""&&TN.length--,(k=TN.length)>4)return b;for(B=[],Wt=0;Wt<k;Wt++){if(($O=TN[Wt])==="")return b;if(uN=10,$O.length>1&&fY($O,0)==="0"&&(uN=zY(wwe,$O)?16:8,$O=$te($O,uN===8?1:2)),$O==="")lN=0;else{if(!zY(uN===10?Owe:uN===8?Awe:Ipe,$O))return b;lN=sse($O,uN)}_$(B,lN)}for(Wt=0;Wt<k;Wt++)if(lN=B[Wt],Wt===k-1){if(lN>=bpe(256,5-k))return null}else if(lN>255)return null;for(_N=Rwe(B),Wt=0;Wt<B.length;Wt++)_N+=B[Wt]*bpe(256,3-Wt);return _N}(s),d===null))return aQ;this.host=d}else{if(zY(Pwe,s))return aQ;for(d="",l=f$(s),f=0;f<l.length;f++)d+=NX(l[f],ase);this.host=d}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Yce(cse,this.scheme)},shortenPath:function(){var s=this.path,d=s.length;!d||this.scheme==="file"&&d===1&&tne(s[0],!0)||s.length--},serialize:function(){var s=this,d=s.scheme,l=s.username,f=s.password,b=s.host,k=s.port,B=s.path,Wt=s.query,$O=s.fragment,uN=d+":";return b!==null?(uN+="//",s.includesCredentials()&&(uN+=l+(f?":"+f:"")+"@"),uN+=ene(b),k!==null&&(uN+=":"+k)):d==="file"&&(uN+="//"),uN+=s.cannotBeABaseURL?B[0]:B.length?"/"+Zte(B,"/"):"",Wt!==null&&(uN+="?"+Wt),$O!==null&&(uN+="#"+$O),uN},setHref:function(s){var d=this.parse(s);if(d)throw new Xce(d);this.searchParams.update()},getOrigin:function(){var s=this.scheme,d=this.port;if(s==="blob")try{return new m$(s.path[0]).origin}catch{return"null"}return s!=="file"&&this.isSpecial()?s+"://"+ene(this.host)+(d!==null?":"+d:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(s){this.parse(v7(s)+":",tue)},getUsername:function(){return this.username},setUsername:function(s){var d=f$(v7(s));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var l=0;l<d.length;l++)this.username+=NX(d[l],eue)}},getPassword:function(){return this.password},setPassword:function(s){var d=f$(v7(s));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var l=0;l<d.length;l++)this.password+=NX(d[l],eue)}},getHost:function(){var s=this.host,d=this.port;return s===null?"":d===null?ene(s):ene(s)+":"+d},setHost:function(s){this.cannotBeABaseURL||this.parse(s,iue)},getHostname:function(){var s=this.host;return s===null?"":ene(s)},setHostname:function(s){this.cannotBeABaseURL||this.parse(s,sue)},getPort:function(){var s=this.port;return s===null?"":v7(s)},setPort:function(s){this.cannotHaveUsernamePasswordPort()||((s=v7(s))===""?this.port=null:this.parse(s,oue))},getPathname:function(){var s=this.path;return this.cannotBeABaseURL?s[0]:s.length?"/"+Zte(s,"/"):""},setPathname:function(s){this.cannotBeABaseURL||(this.path=[],this.parse(s,E$))},getSearch:function(){var s=this.query;return s?"?"+s:""},setSearch:function(s){(s=v7(s))===""?this.query=null:(fY(s,0)==="?"&&(s=$te(s,1)),this.query="",this.parse(s,cQ)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var s=this.fragment;return s?"#"+s:""},setHash:function(s){(s=v7(s))!==""?(fY(s,0)==="#"&&(s=$te(s,1)),this.fragment="",this.parse(s,C7)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var m$=function(s){var d=hwe(this,d8),l=Ewe(arguments.length,1)>1?arguments[1]:void 0,f=mwe(d,new uue(s,!1,l));Kce||(d.href=f.serialize(),d.origin=f.getOrigin(),d.protocol=f.getProtocol(),d.username=f.getUsername(),d.password=f.getPassword(),d.host=f.getHost(),d.hostname=f.getHostname(),d.port=f.getPort(),d.pathname=f.getPathname(),d.search=f.getSearch(),d.searchParams=f.getSearchParams(),d.hash=f.getHash())},d8=m$.prototype,_Y=function(s,d){return{get:function(){return ise(this)[s]()},set:d&&function(l){return ise(this)[d](l)},configurable:!0,enumerable:!0}};if(Kce&&(pY(d8,"href",_Y("serialize","setHref")),pY(d8,"origin",_Y("getOrigin")),pY(d8,"protocol",_Y("getProtocol","setProtocol")),pY(d8,"username",_Y("getUsername","setUsername")),pY(d8,"password",_Y("getPassword","setPassword")),pY(d8,"host",_Y("getHost","setHost")),pY(d8,"hostname",_Y("getHostname","setHostname")),pY(d8,"port",_Y("getPort","setPort")),pY(d8,"pathname",_Y("getPathname","setPathname")),pY(d8,"search",_Y("getSearch","setSearch")),pY(d8,"searchParams",_Y("getSearchParams")),pY(d8,"hash",_Y("getHash","setHash"))),rse(d8,"toJSON",function(){return ise(this).serialize()},{enumerable:!0}),rse(d8,"toString",function(){return ise(this).serialize()},{enumerable:!0}),Qte){var xpe=Qte.createObjectURL,Vpe=Qte.revokeObjectURL;xpe&&rse(m$,"createObjectURL",Spe(xpe,Qte)),Vpe&&rse(m$,"revokeObjectURL",Spe(Vpe,Qte))}_we(m$,"URL"),dwe({global:!0,constructor:!0,forced:!lwe,sham:!Kce},{URL:m$});var Uwe=f6,Fpe=p,xwe=U4,jpe=K4,Vwe=Qie,due=X6("URL"),Fwe=Vwe&&Fpe(function(){due.canParse()}),jwe=Fpe(function(){return due.canParse.length!==1});Uwe({target:"URL",stat:!0,forced:!Fwe||jwe},{canParse:function(s){var d=xwe(arguments.length,1),l=jpe(s),f=d<2||arguments[1]===void 0?void 0:jpe(arguments[1]);try{return!!new due(l,f)}catch{return!1}}});var Bwe=f6,Gwe=U4,Bpe=K4,Wwe=Qie,Hwe=X6("URL");Bwe({target:"URL",stat:!0,forced:!Wwe},{parse:function(s){var d=Gwe(arguments.length,1),l=Bpe(s),f=d<2||arguments[1]===void 0?void 0:Bpe(arguments[1]);try{return new Hwe(l,f)}catch{return null}}});var lse=h(M6.URL);let Gpe=!0,Wpe=!0;function hse(s,d,l){const f=s.match(d);return f&&f.length>=l&&parseInt(f[l],10)}function uQ(s,d,l){if(!s.RTCPeerConnection)return;const f=s.RTCPeerConnection.prototype,b=f.addEventListener;f.addEventListener=function(B,Wt){if(B!==d)return b.apply(this,arguments);const $O=uN=>{const lN=l(uN);lN&&(Wt.handleEvent?Wt.handleEvent(lN):Wt(lN))};return this._eventMap=this._eventMap||{},this._eventMap[d]||(this._eventMap[d]=new Map),this._eventMap[d].set(Wt,$O),b.apply(this,[B,$O])};const k=f.removeEventListener;f.removeEventListener=function(B,Wt){if(B!==d||!this._eventMap||!this._eventMap[d])return k.apply(this,arguments);if(!this._eventMap[d].has(Wt))return k.apply(this,arguments);const $O=this._eventMap[d].get(Wt);return this._eventMap[d].delete(Wt),this._eventMap[d].size===0&&delete this._eventMap[d],Object.keys(this._eventMap).length===0&&delete this._eventMap,k.apply(this,[B,$O])},Object.defineProperty(f,"on"+d,{get(){return this["_on"+d]},set(B){this["_on"+d]&&(this.removeEventListener(d,this["_on"+d]),delete this["_on"+d]),B&&this.addEventListener(d,this["_on"+d]=B)},enumerable:!0,configurable:!0})}function qwe(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Gpe=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function Kwe(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Wpe=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Hpe(){if(typeof window=="object"){if(Gpe)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function lue(s,d){Wpe&&console.warn(s+" is deprecated, please use "+d+" instead.")}function qpe(s){return Object.prototype.toString.call(s)==="[object Object]"}function Kpe(s){var d;return qpe(s)?z4(d=Object.keys(s)).call(d,function(l,f){const b=qpe(s[f]),k=b?Kpe(s[f]):s[f],B=b&&!Object.keys(k).length;return k===void 0||B?l:Object.assign(l,{[f]:k})},{}):s}function hue(s,d,l){d&&!l.has(d.id)&&(l.set(d.id,d),Object.keys(d).forEach(f=>{f.endsWith("Id")?hue(s,s.get(d[f]),l):f.endsWith("Ids")&&d[f].forEach(b=>{hue(s,s.get(b),l)})}))}function zpe(s,d,l){const f=l?"outbound-rtp":"inbound-rtp",b=new Map;if(d===null)return b;const k=[];return s.forEach(B=>{B.type==="track"&&B.trackIdentifier===d.id&&k.push(B)}),k.forEach(B=>{s.forEach(Wt=>{Wt.type===f&&Wt.trackId===B.id&&hue(s,Wt,b)})}),b}const Ype=Hpe;function Jpe(s,d){const l=s&&s.navigator;if(!l.mediaDevices)return;const f=function(B){if(typeof B!="object"||B.mandatory||B.optional)return B;const Wt={};return Object.keys(B).forEach($O=>{if($O==="require"||$O==="advanced"||$O==="mediaSource")return;const uN=typeof B[$O]=="object"?B[$O]:{ideal:B[$O]};uN.exact!==void 0&&typeof uN.exact=="number"&&(uN.min=uN.max=uN.exact);const lN=function(_N,TN){return _N?_N+TN.charAt(0).toUpperCase()+TN.slice(1):TN==="deviceId"?"sourceId":TN};if(uN.ideal!==void 0){Wt.optional=Wt.optional||[];let _N={};typeof uN.ideal=="number"?(_N[lN("min",$O)]=uN.ideal,Wt.optional.push(_N),_N={},_N[lN("max",$O)]=uN.ideal,Wt.optional.push(_N)):(_N[lN("",$O)]=uN.ideal,Wt.optional.push(_N))}uN.exact!==void 0&&typeof uN.exact!="number"?(Wt.mandatory=Wt.mandatory||{},Wt.mandatory[lN("",$O)]=uN.exact):["min","max"].forEach(_N=>{uN[_N]!==void 0&&(Wt.mandatory=Wt.mandatory||{},Wt.mandatory[lN(_N,$O)]=uN[_N])})}),B.advanced&&(Wt.optional=(Wt.optional||[]).concat(B.advanced)),Wt},b=function(B,Wt){if(d.version>=61)return Wt(B);if((B=JSON.parse(JSON.stringify(B)))&&typeof B.audio=="object"){const $O=function(uN,lN,_N){lN in uN&&!(_N in uN)&&(uN[_N]=uN[lN],delete uN[lN])};$O((B=JSON.parse(JSON.stringify(B))).audio,"autoGainControl","googAutoGainControl"),$O(B.audio,"noiseSuppression","googNoiseSuppression"),B.audio=f(B.audio)}if(B&&typeof B.video=="object"){let $O=B.video.facingMode;$O=$O&&(typeof $O=="object"?$O:{ideal:$O});const uN=d.version<66;if($O&&($O.exact==="user"||$O.exact==="environment"||$O.ideal==="user"||$O.ideal==="environment")&&(!l.mediaDevices.getSupportedConstraints||!l.mediaDevices.getSupportedConstraints().facingMode||uN)){let lN;if(delete B.video.facingMode,$O.exact==="environment"||$O.ideal==="environment"?lN=["back","rear"]:$O.exact!=="user"&&$O.ideal!=="user"||(lN=["front"]),lN)return l.mediaDevices.enumerateDevices().then(_N=>{let TN=(_N=_N.filter(vN=>vN.kind==="videoinput")).find(vN=>lN.some(uH=>{var rH;return a5(rH=vN.label.toLowerCase()).call(rH,uH)}));return!TN&&_N.length&&a5(lN).call(lN,"back")&&(TN=_N[_N.length-1]),TN&&(B.video.deviceId=$O.exact?{exact:TN.deviceId}:{ideal:TN.deviceId}),B.video=f(B.video),Ype("chrome: "+JSON.stringify(B)),Wt(B)})}B.video=f(B.video)}return Ype("chrome: "+JSON.stringify(B)),Wt(B)},k=function(B){return d.version>=64?B:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[B.name]||B.name,message:B.message,constraint:B.constraint||B.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(l.getUserMedia=(function(B,Wt,$O){b(B,uN=>{l.webkitGetUserMedia(uN,Wt,lN=>{$O&&$O(k(lN))})})}).bind(l),l.mediaDevices.getUserMedia){const B=l.mediaDevices.getUserMedia.bind(l.mediaDevices);l.mediaDevices.getUserMedia=function(Wt){return b(Wt,$O=>B($O).then(uN=>{if($O.audio&&!uN.getAudioTracks().length||$O.video&&!uN.getVideoTracks().length)throw uN.getTracks().forEach(lN=>{lN.stop()}),new DOMException("","NotFoundError");return uN},uN=>u5.reject(k(uN))))}}}function Xpe(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function Qpe(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(l){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=l)},enumerable:!0,configurable:!0});const d=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=l=>{l.stream.addEventListener("addtrack",f=>{let b;b=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(B=>B.track&&B.track.id===f.track.id):{track:f.track};const k=new Event("track");k.track=f.track,k.receiver=b,k.transceiver={receiver:b},k.streams=[l.stream],this.dispatchEvent(k)}),l.stream.getTracks().forEach(f=>{let b;b=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(B=>B.track&&B.track.id===f.id):{track:f};const k=new Event("track");k.track=f,k.receiver=b,k.transceiver={receiver:b},k.streams=[l.stream],this.dispatchEvent(k)})},this.addEventListener("addstream",this._ontrackpoly)),d.apply(this,arguments)}}else uQ(s,"track",d=>(d.transceiver||Object.defineProperty(d,"transceiver",{value:{receiver:d.receiver}}),d))}function Zpe(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const d=function(b,k){return{track:k,get dtmf(){return this._dtmf===void 0&&(k.kind==="audio"?this._dtmf=b.createDTMFSender(k):this._dtmf=null),this._dtmf},_pc:b}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const b=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(B,Wt){let $O=b.apply(this,arguments);return $O||($O=d(this,B),this._senders.push($O)),$O};const k=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(B){k.apply(this,arguments);const Wt=this._senders.indexOf(B);Wt!==-1&&this._senders.splice(Wt,1)}}const l=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(b){this._senders=this._senders||[],l.apply(this,[b]),b.getTracks().forEach(k=>{this._senders.push(d(this,k))})};const f=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(b){this._senders=this._senders||[],f.apply(this,[b]),b.getTracks().forEach(k=>{const B=this._senders.find(Wt=>Wt.track===k);B&&this._senders.splice(this._senders.indexOf(B),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const d=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const l=d.apply(this,[]);return l.forEach(f=>f._pc=this),l},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $pe(s){if(!s.RTCPeerConnection)return;const d=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[l,f,b]=arguments;if(arguments.length>0&&typeof l=="function")return d.apply(this,arguments);if(d.length===0&&(arguments.length===0||typeof l!="function"))return d.apply(this,[]);const k=function(Wt){const $O={};return Wt.result().forEach(uN=>{const lN={id:uN.id,timestamp:uN.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[uN.type]||uN.type};uN.names().forEach(_N=>{lN[_N]=uN.stat(_N)}),$O[lN.id]=lN}),$O},B=function(Wt){return new Map(Object.keys(Wt).map($O=>[$O,Wt[$O]]))};if(arguments.length>=2){const Wt=function($O){f(B(k($O)))};return d.apply(this,[Wt,l])}return new u5((Wt,$O)=>{d.apply(this,[function(uN){Wt(B(k(uN)))},$O])}).then(f,b)}}function efe(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const l=s.RTCPeerConnection.prototype.getSenders;l&&(s.RTCPeerConnection.prototype.getSenders=function(){const b=l.apply(this,[]);return b.forEach(k=>k._pc=this),b});const f=s.RTCPeerConnection.prototype.addTrack;f&&(s.RTCPeerConnection.prototype.addTrack=function(){const b=f.apply(this,arguments);return b._pc=this,b}),s.RTCRtpSender.prototype.getStats=function(){const b=this;return this._pc.getStats().then(k=>zpe(k,b.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const l=s.RTCPeerConnection.prototype.getReceivers;l&&(s.RTCPeerConnection.prototype.getReceivers=function(){const f=l.apply(this,[]);return f.forEach(b=>b._pc=this),f}),uQ(s,"track",f=>(f.receiver._pc=f.srcElement,f)),s.RTCRtpReceiver.prototype.getStats=function(){const f=this;return this._pc.getStats().then(b=>zpe(b,f.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const d=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const l=arguments[0];let f,b,k;return this.getSenders().forEach(B=>{B.track===l&&(f?k=!0:f=B)}),this.getReceivers().forEach(B=>(B.track===l&&(b?k=!0:b=B),B.track===l)),k||f&&b?u5.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):f?f.getStats():b?b.getStats():u5.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return d.apply(this,arguments)}}function tfe(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(k=>this._shimmedLocalStreams[k][0])};const d=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(k,B){if(!B)return d.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const Wt=d.apply(this,arguments);return this._shimmedLocalStreams[B.id]?this._shimmedLocalStreams[B.id].indexOf(Wt)===-1&&this._shimmedLocalStreams[B.id].push(Wt):this._shimmedLocalStreams[B.id]=[B,Wt],Wt};const l=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(k){this._shimmedLocalStreams=this._shimmedLocalStreams||{},k.getTracks().forEach($O=>{if(this.getSenders().find(lN=>lN.track===$O))throw new DOMException("Track already exists.","InvalidAccessError")});const B=this.getSenders();l.apply(this,arguments);const Wt=this.getSenders().filter($O=>B.indexOf($O)===-1);this._shimmedLocalStreams[k.id]=[k].concat(Wt)};const f=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(k){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[k.id],f.apply(this,arguments)};const b=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(k){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},k&&Object.keys(this._shimmedLocalStreams).forEach(B=>{const Wt=this._shimmedLocalStreams[B].indexOf(k);Wt!==-1&&this._shimmedLocalStreams[B].splice(Wt,1),this._shimmedLocalStreams[B].length===1&&delete this._shimmedLocalStreams[B]}),b.apply(this,arguments)}}function nfe(s,d){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&d.version>=65)return tfe(s);const l=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const $O=l.apply(this);return this._reverseStreams=this._reverseStreams||{},$O.map(uN=>this._reverseStreams[uN.id])};const f=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function($O){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},$O.getTracks().forEach(uN=>{if(this.getSenders().find(_N=>_N.track===uN))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[$O.id]){const uN=new s.MediaStream($O.getTracks());this._streams[$O.id]=uN,this._reverseStreams[uN.id]=$O,$O=uN}f.apply(this,[$O])};const b=s.RTCPeerConnection.prototype.removeStream;function k($O,uN){let lN=uN.sdp;return Object.keys($O._reverseStreams||[]).forEach(_N=>{const TN=$O._reverseStreams[_N],vN=$O._streams[TN.id];lN=lN.replace(new RegExp(vN.id,"g"),TN.id)}),new RTCSessionDescription({type:uN.type,sdp:lN})}s.RTCPeerConnection.prototype.removeStream=function($O){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.apply(this,[this._streams[$O.id]||$O]),delete this._reverseStreams[this._streams[$O.id]?this._streams[$O.id].id:$O.id],delete this._streams[$O.id]},s.RTCPeerConnection.prototype.addTrack=function($O,uN){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const lN=[].slice.call(arguments,1);if(lN.length!==1||!lN[0].getTracks().find(vN=>vN===$O))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(vN=>vN.track===$O))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const TN=this._streams[uN.id];if(TN)TN.addTrack($O),u5.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const vN=new s.MediaStream([$O]);this._streams[uN.id]=vN,this._reverseStreams[vN.id]=uN,this.addStream(vN)}return this.getSenders().find(vN=>vN.track===$O)},["createOffer","createAnswer"].forEach(function($O){const uN=s.RTCPeerConnection.prototype[$O],lN={[$O](){const _N=arguments;return arguments.length&&typeof arguments[0]=="function"?uN.apply(this,[TN=>{const vN=k(this,TN);_N[0].apply(null,[vN])},TN=>{_N[1]&&_N[1].apply(null,TN)},arguments[2]]):uN.apply(this,arguments).then(TN=>k(this,TN))}};s.RTCPeerConnection.prototype[$O]=lN[$O]});const B=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function($O,uN){let lN=uN.sdp;return Object.keys($O._reverseStreams||[]).forEach(_N=>{const TN=$O._reverseStreams[_N],vN=$O._streams[TN.id];lN=lN.replace(new RegExp(TN.id,"g"),vN.id)}),new RTCSessionDescription({type:uN.type,sdp:lN})}(this,arguments[0]),B.apply(this,arguments)):B.apply(this,arguments)};const Wt=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const $O=Wt.get.apply(this);return $O.type===""?$O:k(this,$O)}}),s.RTCPeerConnection.prototype.removeTrack=function($O){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!$O._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if($O._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let uN;this._streams=this._streams||{},Object.keys(this._streams).forEach(lN=>{this._streams[lN].getTracks().find(_N=>$O.track===_N)&&(uN=this._streams[lN])}),uN&&(uN.getTracks().length===1?this.removeStream(this._reverseStreams[uN.id]):uN.removeTrack($O.track),this.dispatchEvent(new Event("negotiationneeded")))}}function pue(s,d){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&d.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const f=s.RTCPeerConnection.prototype[l],b={[l](){return arguments[0]=new(l==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),f.apply(this,arguments)}};s.RTCPeerConnection.prototype[l]=b[l]})}function rfe(s,d){uQ(s,"negotiationneeded",l=>{const f=l.target;if(!(d.version<72||f.getConfiguration&&f.getConfiguration().sdpSemantics==="plan-b")||f.signalingState==="stable")return l})}var ife=Object.freeze({__proto__:null,fixNegotiationNeeded:rfe,shimAddTrackRemoveTrack:nfe,shimAddTrackRemoveTrackWithNative:tfe,shimGetDisplayMedia:function(s,d){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(typeof d=="function"?s.navigator.mediaDevices.getDisplayMedia=function(l){return d(l).then(f=>{const b=l.video&&l.video.width,k=l.video&&l.video.height,B=l.video&&l.video.frameRate;return l.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:f,maxFrameRate:B||3}},b&&(l.video.mandatory.maxWidth=b),k&&(l.video.mandatory.maxHeight=k),s.navigator.mediaDevices.getUserMedia(l)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Zpe,shimGetStats:$pe,shimGetUserMedia:Jpe,shimMediaStream:Xpe,shimOnTrack:Qpe,shimPeerConnection:pue,shimSenderReceiverGetStats:efe});function sfe(s,d){const l=s&&s.navigator,f=s&&s.MediaStreamTrack;if(l.getUserMedia=function(b,k,B){lue("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),l.mediaDevices.getUserMedia(b).then(k,B)},!(d.version>55&&"autoGainControl"in l.mediaDevices.getSupportedConstraints())){const b=function(B,Wt,$O){Wt in B&&!($O in B)&&(B[$O]=B[Wt],delete B[Wt])},k=l.mediaDevices.getUserMedia.bind(l.mediaDevices);if(l.mediaDevices.getUserMedia=function(B){return typeof B=="object"&&typeof B.audio=="object"&&(B=JSON.parse(JSON.stringify(B)),b(B.audio,"autoGainControl","mozAutoGainControl"),b(B.audio,"noiseSuppression","mozNoiseSuppression")),k(B)},f&&f.prototype.getSettings){const B=f.prototype.getSettings;f.prototype.getSettings=function(){const Wt=B.apply(this,arguments);return b(Wt,"mozAutoGainControl","autoGainControl"),b(Wt,"mozNoiseSuppression","noiseSuppression"),Wt}}if(f&&f.prototype.applyConstraints){const B=f.prototype.applyConstraints;f.prototype.applyConstraints=function(Wt){return this.kind==="audio"&&typeof Wt=="object"&&(Wt=JSON.parse(JSON.stringify(Wt)),b(Wt,"autoGainControl","mozAutoGainControl"),b(Wt,"noiseSuppression","mozNoiseSuppression")),B.apply(this,[Wt])}}}}function ofe(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fue(s,d){if(typeof s!="object"||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),d.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){const k=s.RTCPeerConnection.prototype[b],B={[b](){return arguments[0]=new(b==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),k.apply(this,arguments)}};s.RTCPeerConnection.prototype[b]=B[b]});const l={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},f=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[b,k,B]=arguments;return f.apply(this,[b||null]).then(Wt=>{if(d.version<53&&!k)try{Wt.forEach($O=>{$O.type=l[$O.type]||$O.type})}catch($O){if($O.name!=="TypeError")throw $O;Wt.forEach((uN,lN)=>{Wt.set(lN,Object.assign({},uN,{type:l[uN.type]||uN.type}))})}return Wt}).then(k,B)}}function afe(s){if(typeof s!="object"||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const d=s.RTCPeerConnection.prototype.getSenders;d&&(s.RTCPeerConnection.prototype.getSenders=function(){const f=d.apply(this,[]);return f.forEach(b=>b._pc=this),f});const l=s.RTCPeerConnection.prototype.addTrack;l&&(s.RTCPeerConnection.prototype.addTrack=function(){const f=l.apply(this,arguments);return f._pc=this,f}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):u5.resolve(new Map)}}function cfe(s){if(typeof s!="object"||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const d=s.RTCPeerConnection.prototype.getReceivers;d&&(s.RTCPeerConnection.prototype.getReceivers=function(){const l=d.apply(this,[]);return l.forEach(f=>f._pc=this),l}),uQ(s,"track",l=>(l.receiver._pc=l.srcElement,l)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ufe(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(d){lue("removeStream","removeTrack"),this.getSenders().forEach(l=>{var f;l.track&&a5(f=d.getTracks()).call(f,l.track)&&this.removeTrack(l)})})}function dfe(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function lfe(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const d=s.RTCPeerConnection.prototype.addTransceiver;d&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let l=arguments[1]&&arguments[1].sendEncodings;l===void 0&&(l=[]),l=[...l];const f=l.length>0;f&&l.forEach(k=>{if("rid"in k&&!/^[a-z0-9]{0,16}$/i.test(k.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in k&&!(parseFloat(k.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in k&&!(parseFloat(k.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const b=d.apply(this,arguments);if(f){const{sender:k}=b,B=k.getParameters();(!("encodings"in B)||B.encodings.length===1&&Object.keys(B.encodings[0]).length===0)&&(B.encodings=l,k.sendEncodings=l,this.setParametersPromises.push(k.setParameters(B).then(()=>{delete k.sendEncodings}).catch(()=>{delete k.sendEncodings})))}return b})}function hfe(s){if(typeof s!="object"||!s.RTCRtpSender)return;const d=s.RTCRtpSender.prototype.getParameters;d&&(s.RTCRtpSender.prototype.getParameters=function(){const l=d.apply(this,arguments);return"encodings"in l||(l.encodings=[].concat(this.sendEncodings||[{}])),l})}function pfe(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const d=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?u5.all(this.setParametersPromises).then(()=>d.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):d.apply(this,arguments)}}function ffe(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const d=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?u5.all(this.setParametersPromises).then(()=>d.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):d.apply(this,arguments)}}var _fe=Object.freeze({__proto__:null,shimAddTransceiver:lfe,shimCreateAnswer:ffe,shimCreateOffer:pfe,shimGetDisplayMedia:function(s,d){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(l){if(!l||!l.video){const f=new DOMException("getDisplayMedia without video constraints is undefined");return f.name="NotFoundError",f.code=8,u5.reject(f)}return l.video===!0?l.video={mediaSource:d}:l.video.mediaSource=d,s.navigator.mediaDevices.getUserMedia(l)})},shimGetParameters:hfe,shimGetUserMedia:sfe,shimOnTrack:ofe,shimPeerConnection:fue,shimRTCDataChannel:dfe,shimReceiverGetStats:cfe,shimRemoveStream:ufe,shimSenderGetStats:afe});function Efe(s){if(typeof s=="object"&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const d=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(l){var f;this._localStreams||(this._localStreams=[]),a5(f=this._localStreams).call(f,l)||this._localStreams.push(l),l.getAudioTracks().forEach(b=>d.call(this,b,l)),l.getVideoTracks().forEach(b=>d.call(this,b,l))},s.RTCPeerConnection.prototype.addTrack=function(l){for(var f=arguments.length,b=new Array(f>1?f-1:0),k=1;k<f;k++)b[k-1]=arguments[k];return b&&b.forEach(B=>{var Wt;this._localStreams?a5(Wt=this._localStreams).call(Wt,B)||this._localStreams.push(B):this._localStreams=[B]}),d.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(d){this._localStreams||(this._localStreams=[]);const l=this._localStreams.indexOf(d);if(l===-1)return;this._localStreams.splice(l,1);const f=d.getTracks();this.getSenders().forEach(b=>{a5(f).call(f,b.track)&&this.removeTrack(b)})})}}function mfe(s){if(typeof s=="object"&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(l){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=l),this.addEventListener("track",this._onaddstreampoly=f=>{f.streams.forEach(b=>{var k;if(this._remoteStreams||(this._remoteStreams=[]),a5(k=this._remoteStreams).call(k,b))return;this._remoteStreams.push(b);const B=new Event("addstream");B.stream=b,this.dispatchEvent(B)})})}});const d=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const l=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(f){f.streams.forEach(b=>{if(l._remoteStreams||(l._remoteStreams=[]),l._remoteStreams.indexOf(b)>=0)return;l._remoteStreams.push(b);const k=new Event("addstream");k.stream=b,l.dispatchEvent(k)})}),d.apply(l,arguments)}}}function gfe(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const d=s.RTCPeerConnection.prototype,l=d.createOffer,f=d.createAnswer,b=d.setLocalDescription,k=d.setRemoteDescription,B=d.addIceCandidate;d.createOffer=function($O,uN){const lN=arguments.length>=2?arguments[2]:arguments[0],_N=l.apply(this,[lN]);return uN?(_N.then($O,uN),u5.resolve()):_N},d.createAnswer=function($O,uN){const lN=arguments.length>=2?arguments[2]:arguments[0],_N=f.apply(this,[lN]);return uN?(_N.then($O,uN),u5.resolve()):_N};let Wt=function($O,uN,lN){const _N=b.apply(this,[$O]);return lN?(_N.then(uN,lN),u5.resolve()):_N};d.setLocalDescription=Wt,Wt=function($O,uN,lN){const _N=k.apply(this,[$O]);return lN?(_N.then(uN,lN),u5.resolve()):_N},d.setRemoteDescription=Wt,Wt=function($O,uN,lN){const _N=B.apply(this,[$O]);return lN?(_N.then(uN,lN),u5.resolve()):_N},d.addIceCandidate=Wt}function Tfe(s){const d=s&&s.navigator;if(d.mediaDevices&&d.mediaDevices.getUserMedia){const l=d.mediaDevices,f=l.getUserMedia.bind(l);d.mediaDevices.getUserMedia=b=>f(Sfe(b))}!d.getUserMedia&&d.mediaDevices&&d.mediaDevices.getUserMedia&&(d.getUserMedia=(function(l,f,b){d.mediaDevices.getUserMedia(l).then(f,b)}).bind(d))}function Sfe(s){return s&&s.video!==void 0?Object.assign({},s,{video:Kpe(s.video)}):s}function yfe(s){if(!s.RTCPeerConnection)return;const d=s.RTCPeerConnection;s.RTCPeerConnection=function(l,f){if(l&&l.iceServers){const b=[];for(let k=0;k<l.iceServers.length;k++){let B=l.iceServers[k];!B.hasOwnProperty("urls")&&B.hasOwnProperty("url")?(lue("RTCIceServer.url","RTCIceServer.urls"),B=JSON.parse(JSON.stringify(B)),B.urls=B.url,delete B.url,b.push(B)):b.push(l.iceServers[k])}l.iceServers=b}return new d(l,f)},s.RTCPeerConnection.prototype=d.prototype,"generateCertificate"in d&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>d.generateCertificate})}function Rfe(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bfe(s){const d=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(l){if(l){l.offerToReceiveAudio!==void 0&&(l.offerToReceiveAudio=!!l.offerToReceiveAudio);const f=this.getTransceivers().find(k=>k.receiver.track.kind==="audio");l.offerToReceiveAudio===!1&&f?f.direction==="sendrecv"?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":f.direction==="recvonly"&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):l.offerToReceiveAudio!==!0||f||this.addTransceiver("audio",{direction:"recvonly"}),l.offerToReceiveVideo!==void 0&&(l.offerToReceiveVideo=!!l.offerToReceiveVideo);const b=this.getTransceivers().find(k=>k.receiver.track.kind==="video");l.offerToReceiveVideo===!1&&b?b.direction==="sendrecv"?b.setDirection?b.setDirection("sendonly"):b.direction="sendonly":b.direction==="recvonly"&&(b.setDirection?b.setDirection("inactive"):b.direction="inactive"):l.offerToReceiveVideo!==!0||b||this.addTransceiver("video",{direction:"recvonly"})}return d.apply(this,arguments)}}function vfe(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var Cfe=Object.freeze({__proto__:null,shimAudioContext:vfe,shimCallbacksAPI:gfe,shimConstraints:Sfe,shimCreateOfferLegacy:bfe,shimGetUserMedia:Tfe,shimLocalStreamsAPI:Efe,shimRTCIceServerUrls:yfe,shimRemoteStreamsAPI:mfe,shimTrackEventTransceiver:Rfe}),Ife=`	
\v\f\r                　\u2028\u2029\uFEFF`,zwe=L6,Ywe=K4,_ue=Ife,wfe=cN("".replace),Jwe=RegExp("^["+_ue+"]+"),Xwe=RegExp("(^|[^"+_ue+"])["+_ue+"]+$"),Eue=function(s){return function(d){var l=Ywe(zwe(d));return 1&s&&(l=wfe(l,Jwe,"")),2&s&&(l=wfe(l,Xwe,"$1")),l}},Qwe={start:Eue(1),end:Eue(2),trim:Eue(3)},Zwe=W9.PROPER,$we=p,Afe=Ife,eAe=Qwe.trim;f6({target:"String",proto:!0,forced:function(s){return $we(function(){return!!Afe[s]()||"​᠎"[s]()!=="​᠎"||Zwe&&Afe[s].name!==s})}("trim")},{trim:function(){return eAe(this)}});var tAe=l4("String","trim"),nAe=dN,rAe=tAe,mue=String.prototype,iAe=function(s){var d=s.trim;return typeof s=="string"||s===mue||nAe(mue,s)&&d===mue.trim?rAe:d},p4=h(iAe),Ofe={exports:{}};(function(s){const d={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};d.localCName=d.generateIdentifier(),d.splitLines=function(l){return l.trim().split(`
`).map(f=>f.trim())},d.splitSections=function(l){return l.split(`
m=`).map((f,b)=>(b>0?"m="+f:f).trim()+`\r
`)},d.getDescription=function(l){const f=d.splitSections(l);return f&&f[0]},d.getMediaSections=function(l){const f=d.splitSections(l);return f.shift(),f},d.matchPrefix=function(l,f){return d.splitLines(l).filter(b=>b.indexOf(f)===0)},d.parseCandidate=function(l){let f;f=l.indexOf("a=candidate:")===0?l.substring(12).split(" "):l.substring(10).split(" ");const b={foundation:f[0],component:{1:"rtp",2:"rtcp"}[f[1]]||f[1],protocol:f[2].toLowerCase(),priority:parseInt(f[3],10),ip:f[4],address:f[4],port:parseInt(f[5],10),type:f[7]};for(let k=8;k<f.length;k+=2)switch(f[k]){case"raddr":b.relatedAddress=f[k+1];break;case"rport":b.relatedPort=parseInt(f[k+1],10);break;case"tcptype":b.tcpType=f[k+1];break;case"ufrag":b.ufrag=f[k+1],b.usernameFragment=f[k+1];break;default:b[f[k]]===void 0&&(b[f[k]]=f[k+1])}return b},d.writeCandidate=function(l){const f=[];f.push(l.foundation);const b=l.component;b==="rtp"?f.push(1):b==="rtcp"?f.push(2):f.push(b),f.push(l.protocol.toUpperCase()),f.push(l.priority),f.push(l.address||l.ip),f.push(l.port);const k=l.type;return f.push("typ"),f.push(k),k!=="host"&&l.relatedAddress&&l.relatedPort&&(f.push("raddr"),f.push(l.relatedAddress),f.push("rport"),f.push(l.relatedPort)),l.tcpType&&l.protocol.toLowerCase()==="tcp"&&(f.push("tcptype"),f.push(l.tcpType)),(l.usernameFragment||l.ufrag)&&(f.push("ufrag"),f.push(l.usernameFragment||l.ufrag)),"candidate:"+f.join(" ")},d.parseIceOptions=function(l){return l.substring(14).split(" ")},d.parseRtpMap=function(l){let f=l.substring(9).split(" ");const b={payloadType:parseInt(f.shift(),10)};return f=f[0].split("/"),b.name=f[0],b.clockRate=parseInt(f[1],10),b.channels=f.length===3?parseInt(f[2],10):1,b.numChannels=b.channels,b},d.writeRtpMap=function(l){let f=l.payloadType;l.preferredPayloadType!==void 0&&(f=l.preferredPayloadType);const b=l.channels||l.numChannels||1;return"a=rtpmap:"+f+" "+l.name+"/"+l.clockRate+(b!==1?"/"+b:"")+`\r
`},d.parseExtmap=function(l){const f=l.substring(9).split(" ");return{id:parseInt(f[0],10),direction:f[0].indexOf("/")>0?f[0].split("/")[1]:"sendrecv",uri:f[1],attributes:f.slice(2).join(" ")}},d.writeExtmap=function(l){return"a=extmap:"+(l.id||l.preferredId)+(l.direction&&l.direction!=="sendrecv"?"/"+l.direction:"")+" "+l.uri+(l.attributes?" "+l.attributes:"")+`\r
`},d.parseFmtp=function(l){const f={};let b;const k=l.substring(l.indexOf(" ")+1).split(";");for(let B=0;B<k.length;B++)b=k[B].trim().split("="),f[b[0].trim()]=b[1];return f},d.writeFmtp=function(l){let f="",b=l.payloadType;if(l.preferredPayloadType!==void 0&&(b=l.preferredPayloadType),l.parameters&&Object.keys(l.parameters).length){const k=[];Object.keys(l.parameters).forEach(B=>{l.parameters[B]!==void 0?k.push(B+"="+l.parameters[B]):k.push(B)}),f+="a=fmtp:"+b+" "+k.join(";")+`\r
`}return f},d.parseRtcpFb=function(l){const f=l.substring(l.indexOf(" ")+1).split(" ");return{type:f.shift(),parameter:f.join(" ")}},d.writeRtcpFb=function(l){let f="",b=l.payloadType;return l.preferredPayloadType!==void 0&&(b=l.preferredPayloadType),l.rtcpFeedback&&l.rtcpFeedback.length&&l.rtcpFeedback.forEach(k=>{f+="a=rtcp-fb:"+b+" "+k.type+(k.parameter&&k.parameter.length?" "+k.parameter:"")+`\r
`}),f},d.parseSsrcMedia=function(l){const f=l.indexOf(" "),b={ssrc:parseInt(l.substring(7,f),10)},k=l.indexOf(":",f);return k>-1?(b.attribute=l.substring(f+1,k),b.value=l.substring(k+1)):b.attribute=l.substring(f+1),b},d.parseSsrcGroup=function(l){const f=l.substring(13).split(" ");return{semantics:f.shift(),ssrcs:f.map(b=>parseInt(b,10))}},d.getMid=function(l){const f=d.matchPrefix(l,"a=mid:")[0];if(f)return f.substring(6)},d.parseFingerprint=function(l){const f=l.substring(14).split(" ");return{algorithm:f[0].toLowerCase(),value:f[1].toUpperCase()}},d.getDtlsParameters=function(l,f){return{role:"auto",fingerprints:d.matchPrefix(l+f,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(l,f){let b="a=setup:"+f+`\r
`;return l.fingerprints.forEach(k=>{b+="a=fingerprint:"+k.algorithm+" "+k.value+`\r
`}),b},d.parseCryptoLine=function(l){const f=l.substring(9).split(" ");return{tag:parseInt(f[0],10),cryptoSuite:f[1],keyParams:f[2],sessionParams:f.slice(3)}},d.writeCryptoLine=function(l){return"a=crypto:"+l.tag+" "+l.cryptoSuite+" "+(typeof l.keyParams=="object"?d.writeCryptoKeyParams(l.keyParams):l.keyParams)+(l.sessionParams?" "+l.sessionParams.join(" "):"")+`\r
`},d.parseCryptoKeyParams=function(l){if(l.indexOf("inline:")!==0)return null;const f=l.substring(7).split("|");return{keyMethod:"inline",keySalt:f[0],lifeTime:f[1],mkiValue:f[2]?f[2].split(":")[0]:void 0,mkiLength:f[2]?f[2].split(":")[1]:void 0}},d.writeCryptoKeyParams=function(l){return l.keyMethod+":"+l.keySalt+(l.lifeTime?"|"+l.lifeTime:"")+(l.mkiValue&&l.mkiLength?"|"+l.mkiValue+":"+l.mkiLength:"")},d.getCryptoParameters=function(l,f){return d.matchPrefix(l+f,"a=crypto:").map(d.parseCryptoLine)},d.getIceParameters=function(l,f){const b=d.matchPrefix(l+f,"a=ice-ufrag:")[0],k=d.matchPrefix(l+f,"a=ice-pwd:")[0];return b&&k?{usernameFragment:b.substring(12),password:k.substring(10)}:null},d.writeIceParameters=function(l){let f="a=ice-ufrag:"+l.usernameFragment+`\r
a=ice-pwd:`+l.password+`\r
`;return l.iceLite&&(f+=`a=ice-lite\r
`),f},d.parseRtpParameters=function(l){const f={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},b=d.splitLines(l)[0].split(" ");f.profile=b[2];for(let B=3;B<b.length;B++){const Wt=b[B],$O=d.matchPrefix(l,"a=rtpmap:"+Wt+" ")[0];if($O){const uN=d.parseRtpMap($O),lN=d.matchPrefix(l,"a=fmtp:"+Wt+" ");switch(uN.parameters=lN.length?d.parseFmtp(lN[0]):{},uN.rtcpFeedback=d.matchPrefix(l,"a=rtcp-fb:"+Wt+" ").map(d.parseRtcpFb),f.codecs.push(uN),uN.name.toUpperCase()){case"RED":case"ULPFEC":f.fecMechanisms.push(uN.name.toUpperCase())}}}d.matchPrefix(l,"a=extmap:").forEach(B=>{f.headerExtensions.push(d.parseExtmap(B))});const k=d.matchPrefix(l,"a=rtcp-fb:* ").map(d.parseRtcpFb);return f.codecs.forEach(B=>{k.forEach(Wt=>{B.rtcpFeedback.find($O=>$O.type===Wt.type&&$O.parameter===Wt.parameter)||B.rtcpFeedback.push(Wt)})}),f},d.writeRtpDescription=function(l,f){let b="";b+="m="+l+" ",b+=f.codecs.length>0?"9":"0",b+=" "+(f.profile||"UDP/TLS/RTP/SAVPF")+" ",b+=f.codecs.map(B=>B.preferredPayloadType!==void 0?B.preferredPayloadType:B.payloadType).join(" ")+`\r
`,b+=`c=IN IP4 0.0.0.0\r
`,b+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,f.codecs.forEach(B=>{b+=d.writeRtpMap(B),b+=d.writeFmtp(B),b+=d.writeRtcpFb(B)});let k=0;return f.codecs.forEach(B=>{B.maxptime>k&&(k=B.maxptime)}),k>0&&(b+="a=maxptime:"+k+`\r
`),f.headerExtensions&&f.headerExtensions.forEach(B=>{b+=d.writeExtmap(B)}),b},d.parseRtpEncodingParameters=function(l){const f=[],b=d.parseRtpParameters(l),k=b.fecMechanisms.indexOf("RED")!==-1,B=b.fecMechanisms.indexOf("ULPFEC")!==-1,Wt=d.matchPrefix(l,"a=ssrc:").map(TN=>d.parseSsrcMedia(TN)).filter(TN=>TN.attribute==="cname"),$O=Wt.length>0&&Wt[0].ssrc;let uN;const lN=d.matchPrefix(l,"a=ssrc-group:FID").map(TN=>TN.substring(17).split(" ").map(vN=>parseInt(vN,10)));lN.length>0&&lN[0].length>1&&lN[0][0]===$O&&(uN=lN[0][1]),b.codecs.forEach(TN=>{if(TN.name.toUpperCase()==="RTX"&&TN.parameters.apt){let vN={ssrc:$O,codecPayloadType:parseInt(TN.parameters.apt,10)};$O&&uN&&(vN.rtx={ssrc:uN}),f.push(vN),k&&(vN=JSON.parse(JSON.stringify(vN)),vN.fec={ssrc:$O,mechanism:B?"red+ulpfec":"red"},f.push(vN))}}),f.length===0&&$O&&f.push({ssrc:$O});let _N=d.matchPrefix(l,"b=");return _N.length&&(_N=_N[0].indexOf("b=TIAS:")===0?parseInt(_N[0].substring(7),10):_N[0].indexOf("b=AS:")===0?1e3*parseInt(_N[0].substring(5),10)*.95-16e3:void 0,f.forEach(TN=>{TN.maxBitrate=_N})),f},d.parseRtcpParameters=function(l){const f={},b=d.matchPrefix(l,"a=ssrc:").map(Wt=>d.parseSsrcMedia(Wt)).filter(Wt=>Wt.attribute==="cname")[0];b&&(f.cname=b.value,f.ssrc=b.ssrc);const k=d.matchPrefix(l,"a=rtcp-rsize");f.reducedSize=k.length>0,f.compound=k.length===0;const B=d.matchPrefix(l,"a=rtcp-mux");return f.mux=B.length>0,f},d.writeRtcpParameters=function(l){let f="";return l.reducedSize&&(f+=`a=rtcp-rsize\r
`),l.mux&&(f+=`a=rtcp-mux\r
`),l.ssrc!==void 0&&l.cname&&(f+="a=ssrc:"+l.ssrc+" cname:"+l.cname+`\r
`),f},d.parseMsid=function(l){let f;const b=d.matchPrefix(l,"a=msid:");if(b.length===1)return f=b[0].substring(7).split(" "),{stream:f[0],track:f[1]};const k=d.matchPrefix(l,"a=ssrc:").map(B=>d.parseSsrcMedia(B)).filter(B=>B.attribute==="msid");return k.length>0?(f=k[0].value.split(" "),{stream:f[0],track:f[1]}):void 0},d.parseSctpDescription=function(l){const f=d.parseMLine(l),b=d.matchPrefix(l,"a=max-message-size:");let k;b.length>0&&(k=parseInt(b[0].substring(19),10)),isNaN(k)&&(k=65536);const B=d.matchPrefix(l,"a=sctp-port:");if(B.length>0)return{port:parseInt(B[0].substring(12),10),protocol:f.fmt,maxMessageSize:k};const Wt=d.matchPrefix(l,"a=sctpmap:");if(Wt.length>0){const $O=Wt[0].substring(10).split(" ");return{port:parseInt($O[0],10),protocol:$O[1],maxMessageSize:k}}},d.writeSctpDescription=function(l,f){let b=[];return b=l.protocol!=="DTLS/SCTP"?["m="+l.kind+" 9 "+l.protocol+" "+f.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+f.port+`\r
`]:["m="+l.kind+" 9 "+l.protocol+" "+f.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+f.port+" "+f.protocol+` 65535\r
`],f.maxMessageSize!==void 0&&b.push("a=max-message-size:"+f.maxMessageSize+`\r
`),b.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,22)},d.writeSessionBoilerplate=function(l,f,b){let k;const B=f!==void 0?f:2;return k=l||d.generateSessionId(),`v=0\r
o=`+(b||"thisisadapterortc")+" "+k+" "+B+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},d.getDirection=function(l,f){const b=d.splitLines(l);for(let k=0;k<b.length;k++)switch(b[k]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return b[k].substring(2)}return f?d.getDirection(f):"sendrecv"},d.getKind=function(l){return d.splitLines(l)[0].split(" ")[0].substring(2)},d.isRejected=function(l){return l.split(" ",2)[1]==="0"},d.parseMLine=function(l){const f=d.splitLines(l)[0].substring(2).split(" ");return{kind:f[0],port:parseInt(f[1],10),protocol:f[2],fmt:f.slice(3).join(" ")}},d.parseOLine=function(l){const f=d.matchPrefix(l,"o=")[0].substring(2).split(" ");return{username:f[0],sessionId:f[1],sessionVersion:parseInt(f[2],10),netType:f[3],addressType:f[4],address:f[5]}},d.isValidSDP=function(l){if(typeof l!="string"||l.length===0)return!1;const f=d.splitLines(l);for(let b=0;b<f.length;b++)if(f[b].length<2||f[b].charAt(1)!=="=")return!1;return!0},s.exports=d})(Ofe);var Nfe=Ofe.exports,g$=h(Nfe),sAe=i({__proto__:null,default:g$},[Nfe]);function pse(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const d=s.RTCIceCandidate;s.RTCIceCandidate=function(l){if(typeof l=="object"&&l.candidate&&l.candidate.indexOf("a=")===0&&((l=JSON.parse(JSON.stringify(l))).candidate=l.candidate.substr(2)),l.candidate&&l.candidate.length){const f=new d(l),b=g$.parseCandidate(l.candidate),k=Object.assign(f,b);return k.toJSON=function(){return{candidate:k.candidate,sdpMid:k.sdpMid,sdpMLineIndex:k.sdpMLineIndex,usernameFragment:k.usernameFragment}},k}return new d(l)},s.RTCIceCandidate.prototype=d.prototype,uQ(s,"icecandidate",l=>(l.candidate&&Object.defineProperty(l,"candidate",{value:new s.RTCIceCandidate(l.candidate),writable:"false"}),l))}function gue(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||uQ(s,"icecandidate",d=>{if(d.candidate){const l=g$.parseCandidate(d.candidate.candidate);l.type==="relay"&&(d.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[l.priority>>24])}return d})}function fse(s,d){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const l=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,d.browser==="chrome"&&d.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(f){if(!f||!f.sdp)return!1;const b=g$.splitSections(f.sdp);return b.shift(),b.some(k=>{const B=g$.parseMLine(k);return B&&B.kind==="application"&&B.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const f=function($O){const uN=$O.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(uN===null||uN.length<2)return-1;const lN=parseInt(uN[1],10);return lN!=lN?-1:lN}(arguments[0]),b=function($O){let uN=65536;return d.browser==="firefox"&&(uN=d.version<57?$O===-1?16384:2147483637:d.version<60?d.version===57?65535:65536:2147483637),uN}(f),k=function($O,uN){let lN=65536;d.browser==="firefox"&&d.version===57&&(lN=65535);const _N=g$.matchPrefix($O.sdp,"a=max-message-size:");return _N.length>0?lN=parseInt(_N[0].substr(19),10):d.browser==="firefox"&&uN!==-1&&(lN=2147483637),lN}(arguments[0],f);let B;B=b===0&&k===0?Number.POSITIVE_INFINITY:b===0||k===0?Math.max(b,k):Math.min(b,k);const Wt={};Object.defineProperty(Wt,"maxMessageSize",{get:()=>B}),this._sctp=Wt}return l.apply(this,arguments)}}function _se(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function d(f,b){const k=f.send;f.send=function(){const B=arguments[0],Wt=B.length||B.size||B.byteLength;if(f.readyState==="open"&&b.sctp&&Wt>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return k.apply(f,arguments)}}const l=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const f=l.apply(this,arguments);return d(f,this),f},uQ(s,"datachannel",f=>(d(f.channel,f.target),f))}function Tue(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const d=s.RTCPeerConnection.prototype;Object.defineProperty(d,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(d,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(l){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),l&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=l)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(l=>{const f=d[l];d[l]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=b=>{const k=b.target;if(k._lastConnectionState!==k.connectionState){k._lastConnectionState=k.connectionState;const B=new Event("connectionstatechange",b);k.dispatchEvent(B)}return b},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),f.apply(this,arguments)}})}function Sue(s,d){if(!s.RTCPeerConnection||d.browser==="chrome"&&d.version>=71||d.browser==="safari"&&d.version>=605)return;const l=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(f){if(f&&f.sdp&&f.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const b=f.sdp.split(`
`).filter(k=>p4(k).call(k)!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&f instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:f.type,sdp:b}):f.sdp=b}return l.apply(this,arguments)}}function Ese(s,d){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const l=s.RTCPeerConnection.prototype.addIceCandidate;l&&l.length!==0&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(d.browser==="chrome"&&d.version<78||d.browser==="firefox"&&d.version<68||d.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?u5.resolve():l.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),u5.resolve())})}function mse(s,d){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const l=s.RTCPeerConnection.prototype.setLocalDescription;l&&l.length!==0&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let f=arguments[0]||{};if(typeof f!="object"||f.type&&f.sdp)return l.apply(this,arguments);if(f={type:f.type,sdp:f.sdp},!f.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":f.type="offer";break;default:f.type="answer"}return f.sdp||f.type!=="offer"&&f.type!=="answer"?l.apply(this,[f]):(f.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(b=>l.apply(this,[b]))})}var oAe=Object.freeze({__proto__:null,removeExtmapAllowMixed:Sue,shimAddIceCandidateNullOrEmpty:Ese,shimConnectionState:Tue,shimMaxMessageSize:fse,shimParameterlessSetLocalDescription:mse,shimRTCIceCandidate:pse,shimRTCIceCandidateRelayProtocol:gue,shimSendThrowTypeError:_se});(function(){let{window:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const l=Hpe,f=function(k){const B={browser:null,version:null};if(k===void 0||!k.navigator)return B.browser="Not a browser.",B;const{navigator:Wt}=k;if(Wt.mozGetUserMedia)B.browser="firefox",B.version=hse(Wt.userAgent,/Firefox\/(\d+)\./,1);else if(Wt.webkitGetUserMedia||k.isSecureContext===!1&&k.webkitRTCPeerConnection)B.browser="chrome",B.version=hse(Wt.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!k.RTCPeerConnection||!Wt.userAgent.match(/AppleWebKit\/(\d+)\./))return B.browser="Not a supported browser.",B;B.browser="safari",B.version=hse(Wt.userAgent,/AppleWebKit\/(\d+)\./,1),B.supportsUnifiedPlan=k.RTCRtpTransceiver&&"currentDirection"in k.RTCRtpTransceiver.prototype}return B}(s),b={browserDetails:f,commonShim:oAe,extractVersion:hse,disableLog:qwe,disableWarnings:Kwe,sdp:sAe};switch(f.browser){case"chrome":if(!ife||!pue||!d.shimChrome)return l("Chrome shim is not included in this adapter release."),b;if(f.version===null)return l("Chrome shim can not determine version, not shimming."),b;l("adapter.js shimming chrome."),b.browserShim=ife,Ese(s,f),mse(s),Jpe(s,f),Xpe(s),pue(s,f),Qpe(s),nfe(s,f),Zpe(s),$pe(s),efe(s),rfe(s,f),pse(s),gue(s),Tue(s),fse(s,f),_se(s),Sue(s,f);break;case"firefox":if(!_fe||!fue||!d.shimFirefox)return l("Firefox shim is not included in this adapter release."),b;l("adapter.js shimming firefox."),b.browserShim=_fe,Ese(s,f),mse(s),sfe(s,f),fue(s,f),ofe(s),ufe(s),afe(s),cfe(s),dfe(s),lfe(s),hfe(s),pfe(s),ffe(s),pse(s),Tue(s),fse(s,f),_se(s);break;case"safari":if(!Cfe||!d.shimSafari)return l("Safari shim is not included in this adapter release."),b;l("adapter.js shimming safari."),b.browserShim=Cfe,Ese(s,f),mse(s),yfe(s),bfe(s),gfe(s),Efe(s),mfe(s),Rfe(s),Tfe(s),vfe(s),pse(s),gue(s),fse(s,f),_se(s),Sue(s,f);break;default:l("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Pfe=$J,aAe=TypeError,Dfe=k8.match(/firefox\/(\d+)/i),cAe=!!Dfe&&+Dfe[1],uAe=/MSIE|Trident/.test(k8),kfe=k8.match(/AppleWebKit\/(\d+)\./),dAe=!!kfe&&+kfe[1],lAe=f6,Lfe=cN,hAe=s4,pAe=Q6,Mfe=mJ,fAe=function(s,d){if(!delete s[d])throw new aAe("Cannot delete property "+Pfe(d)+" of "+Pfe(s))},Ufe=K4,yue=p,_Ae=Ghe,EAe=I9,xfe=cAe,mAe=uAe,Vfe=cJ,Ffe=dAe,PX=[],jfe=Lfe(PX.sort),gAe=Lfe(PX.push),TAe=yue(function(){PX.sort(void 0)}),SAe=yue(function(){PX.sort(null)}),yAe=EAe("sort"),Bfe=!yue(function(){if(Vfe)return Vfe<70;if(!(xfe&&xfe>3)){if(mAe)return!0;if(Ffe)return Ffe<603;var s,d,l,f,b="";for(s=65;s<76;s++){switch(d=String.fromCharCode(s),s){case 66:case 69:case 70:case 72:l=3;break;case 68:case 71:l=4;break;default:l=2}for(f=0;f<47;f++)PX.push({k:d+f,v:l})}for(PX.sort(function(k,B){return B.v-k.v}),f=0;f<PX.length;f++)d=PX[f].k.charAt(0),b.charAt(b.length-1)!==d&&(b+=d);return b!=="DGBEFHACIJK"}});lAe({target:"Array",proto:!0,forced:TAe||!SAe||!yAe||!Bfe},{sort:function(s){s!==void 0&&hAe(s);var d=pAe(this);if(Bfe)return s===void 0?jfe(d):jfe(d,s);var l,f,b=[],k=Mfe(d);for(f=0;f<k;f++)f in d&&gAe(b,d[f]);for(_Ae(b,function(B){return function(Wt,$O){return $O===void 0?-1:Wt===void 0?1:B!==void 0?+B(Wt,$O)||0:Ufe(Wt)>Ufe($O)?1:-1}}(s)),l=Mfe(b),f=0;f<l;)d[f]=b[f++];for(;f<k;)fAe(d,f++);return d}});var RAe=l4("Array","sort"),bAe=dN,vAe=RAe,Rue=Array.prototype,CAe=function(s){var d=s.sort;return s===Rue||bAe(Rue,s)&&d===Rue.sort?vAe:d},nne=h(CAe),bue=mN;f6({global:!0,forced:bue.globalThis!==bue},{globalThis:bue});var Gfe=h(mN),vue={exports:{}};(function(s,d){(function(l,f){var b="function",k="undefined",B="object",Wt="string",$O="major",uN="model",lN="name",_N="type",TN="vendor",vN="version",uH="architecture",rH="console",iH="mobile",lH="tablet",hH="smarttv",bH="wearable",PH="embedded",OH="Amazon",wH="Apple",BH="ASUS",XH="BlackBerry",d5="Browser",p5="Chrome",$5="Firefox",e6="Google",N6="Huawei",aK="LG",eK="Microsoft",H4="Motorola",qH="Opera",o5="Samsung",g5="Sharp",YH="Sony",NW="Xiaomi",EH="Zebra",RH="Facebook",ZH="Chromium OS",M5="Mac OS",v6=function(gK){for(var DK={},V6=0;V6<gK.length;V6++)DK[gK[V6].toUpperCase()]=gK[V6];return DK},PK=function(gK,DK){return typeof gK===Wt&&i8(DK).indexOf(i8(gK))!==-1},i8=function(gK){return gK.toLowerCase()},B7=function(gK,DK){if(typeof gK===Wt)return gK=gK.replace(/^\s\s*/,""),typeof DK===k?gK:gK.substring(0,350)},FQ=function(gK,DK){for(var V6,p8,ZJ,cK,h6,s8,$X=0;$X<DK.length&&!h6;){var aJ=DK[$X],fve=DK[$X+1];for(V6=p8=0;V6<aJ.length&&!h6&&aJ[V6];)if(h6=aJ[V6++].exec(gK))for(ZJ=0;ZJ<fve.length;ZJ++)s8=h6[++p8],typeof(cK=fve[ZJ])===B&&cK.length>0?cK.length===2?typeof cK[1]==b?this[cK[0]]=cK[1].call(this,s8):this[cK[0]]=cK[1]:cK.length===3?typeof cK[1]!==b||cK[1].exec&&cK[1].test?this[cK[0]]=s8?s8.replace(cK[1],cK[2]):f:this[cK[0]]=s8?cK[1].call(this,s8,cK[2]):f:cK.length===4&&(this[cK[0]]=s8?cK[3].call(this,s8.replace(cK[1],cK[2])):f):this[cK]=s8||f;$X+=2}},ire=function(gK,DK){for(var V6 in DK)if(typeof DK[V6]===B&&DK[V6].length>0){for(var p8=0;p8<DK[V6].length;p8++)if(PK(DK[V6][p8],gK))return V6==="?"?f:V6}else if(PK(DK[V6],gK))return V6==="?"?f:V6;return gK},uae={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},dae={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[vN,[lN,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[vN,[lN,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[lN,vN],[/opios[\/ ]+([\w\.]+)/i],[vN,[lN,qH+" Mini"]],[/\bopr\/([\w\.]+)/i],[vN,[lN,qH]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[lN,vN],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[vN,[lN,"UC"+d5]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[vN,[lN,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[vN,[lN,"WeChat"]],[/konqueror\/([\w\.]+)/i],[vN,[lN,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[vN,[lN,"IE"]],[/yabrowser\/([\w\.]+)/i],[vN,[lN,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[lN,/(.+)/,"$1 Secure "+d5],vN],[/\bfocus\/([\w\.]+)/i],[vN,[lN,$5+" Focus"]],[/\bopt\/([\w\.]+)/i],[vN,[lN,qH+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[vN,[lN,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[vN,[lN,"Dolphin"]],[/coast\/([\w\.]+)/i],[vN,[lN,qH+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[vN,[lN,"MIUI "+d5]],[/fxios\/([-\w\.]+)/i],[vN,[lN,$5]],[/\bqihu|(qi?ho?o?|360)browser/i],[[lN,"360 "+d5]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[lN,/(.+)/,"$1 "+d5],vN],[/(comodo_dragon)\/([\w\.]+)/i],[[lN,/_/g," "],vN],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[lN,vN],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[lN],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[lN,RH],vN],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[lN,vN],[/\bgsa\/([\w\.]+) .*safari\//i],[vN,[lN,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[vN,[lN,p5+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[lN,p5+" WebView"],vN],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[vN,[lN,"Android "+d5]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[lN,vN],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[vN,[lN,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[vN,lN],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[lN,[vN,ire,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[lN,vN],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[lN,"Netscape"],vN],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[vN,[lN,$5+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[lN,vN],[/(cobalt)\/([\w\.]+)/i],[lN,[vN,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[uH,"amd64"]],[/(ia32(?=;))/i],[[uH,i8]],[/((?:i[346]|x)86)[;\)]/i],[[uH,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[uH,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[uH,"armhf"]],[/windows (ce|mobile); ppc;/i],[[uH,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[uH,/ower/,"",i8]],[/(sun4\w)[;\)]/i],[[uH,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[uH,i8]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[uN,[TN,o5],[_N,lH]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[uN,[TN,o5],[_N,iH]],[/\((ip(?:hone|od)[\w ]*);/i],[uN,[TN,wH],[_N,iH]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[uN,[TN,wH],[_N,lH]],[/(macintosh);/i],[uN,[TN,wH]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[uN,[TN,g5],[_N,iH]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[uN,[TN,N6],[_N,lH]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[uN,[TN,N6],[_N,iH]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[uN,/_/g," "],[TN,NW],[_N,iH]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[uN,/_/g," "],[TN,NW],[_N,lH]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[uN,[TN,"OPPO"],[_N,iH]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[uN,[TN,"Vivo"],[_N,iH]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[uN,[TN,"Realme"],[_N,iH]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[uN,[TN,H4],[_N,iH]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[uN,[TN,H4],[_N,lH]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[uN,[TN,aK],[_N,lH]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[uN,[TN,aK],[_N,iH]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[uN,[TN,"Lenovo"],[_N,lH]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[uN,/_/g," "],[TN,"Nokia"],[_N,iH]],[/(pixel c)\b/i],[uN,[TN,e6],[_N,lH]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[uN,[TN,e6],[_N,iH]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[uN,[TN,YH],[_N,iH]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[uN,"Xperia Tablet"],[TN,YH],[_N,lH]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[uN,[TN,"OnePlus"],[_N,iH]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[uN,[TN,OH],[_N,lH]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[uN,/(.+)/g,"Fire Phone $1"],[TN,OH],[_N,iH]],[/(playbook);[-\w\),; ]+(rim)/i],[uN,TN,[_N,lH]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[uN,[TN,XH],[_N,iH]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[uN,[TN,BH],[_N,lH]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[uN,[TN,BH],[_N,iH]],[/(nexus 9)/i],[uN,[TN,"HTC"],[_N,lH]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[TN,[uN,/_/g," "],[_N,iH]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[uN,[TN,"Acer"],[_N,lH]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[uN,[TN,"Meizu"],[_N,iH]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[TN,uN,[_N,iH]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[TN,uN,[_N,lH]],[/(surface duo)/i],[uN,[TN,eK],[_N,lH]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[uN,[TN,"Fairphone"],[_N,iH]],[/(u304aa)/i],[uN,[TN,"AT&T"],[_N,iH]],[/\bsie-(\w*)/i],[uN,[TN,"Siemens"],[_N,iH]],[/\b(rct\w+) b/i],[uN,[TN,"RCA"],[_N,lH]],[/\b(venue[\d ]{2,7}) b/i],[uN,[TN,"Dell"],[_N,lH]],[/\b(q(?:mv|ta)\w+) b/i],[uN,[TN,"Verizon"],[_N,lH]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[uN,[TN,"Barnes & Noble"],[_N,lH]],[/\b(tm\d{3}\w+) b/i],[uN,[TN,"NuVision"],[_N,lH]],[/\b(k88) b/i],[uN,[TN,"ZTE"],[_N,lH]],[/\b(nx\d{3}j) b/i],[uN,[TN,"ZTE"],[_N,iH]],[/\b(gen\d{3}) b.+49h/i],[uN,[TN,"Swiss"],[_N,iH]],[/\b(zur\d{3}) b/i],[uN,[TN,"Swiss"],[_N,lH]],[/\b((zeki)?tb.*\b) b/i],[uN,[TN,"Zeki"],[_N,lH]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[TN,"Dragon Touch"],uN,[_N,lH]],[/\b(ns-?\w{0,9}) b/i],[uN,[TN,"Insignia"],[_N,lH]],[/\b((nxa|next)-?\w{0,9}) b/i],[uN,[TN,"NextBook"],[_N,lH]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[TN,"Voice"],uN,[_N,iH]],[/\b(lvtel\-)?(v1[12]) b/i],[[TN,"LvTel"],uN,[_N,iH]],[/\b(ph-1) /i],[uN,[TN,"Essential"],[_N,iH]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[uN,[TN,"Envizen"],[_N,lH]],[/\b(trio[-\w\. ]+) b/i],[uN,[TN,"MachSpeed"],[_N,lH]],[/\btu_(1491) b/i],[uN,[TN,"Rotor"],[_N,lH]],[/(shield[\w ]+) b/i],[uN,[TN,"Nvidia"],[_N,lH]],[/(sprint) (\w+)/i],[TN,uN,[_N,iH]],[/(kin\.[onetw]{3})/i],[[uN,/\./g," "],[TN,eK],[_N,iH]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[uN,[TN,EH],[_N,lH]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[uN,[TN,EH],[_N,iH]],[/smart-tv.+(samsung)/i],[TN,[_N,hH]],[/hbbtv.+maple;(\d+)/i],[[uN,/^/,"SmartTV"],[TN,o5],[_N,hH]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[TN,aK],[_N,hH]],[/(apple) ?tv/i],[TN,[uN,wH+" TV"],[_N,hH]],[/crkey/i],[[uN,p5+"cast"],[TN,e6],[_N,hH]],[/droid.+aft(\w)( bui|\))/i],[uN,[TN,OH],[_N,hH]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[uN,[TN,g5],[_N,hH]],[/(bravia[\w ]+)( bui|\))/i],[uN,[TN,YH],[_N,hH]],[/(mitv-\w{5}) bui/i],[uN,[TN,NW],[_N,hH]],[/Hbbtv.*(technisat) (.*);/i],[TN,uN,[_N,hH]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[TN,B7],[uN,B7],[_N,hH]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_N,hH]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[TN,uN,[_N,rH]],[/droid.+; (shield) bui/i],[uN,[TN,"Nvidia"],[_N,rH]],[/(playstation [345portablevi]+)/i],[uN,[TN,YH],[_N,rH]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[uN,[TN,eK],[_N,rH]],[/((pebble))app/i],[TN,uN,[_N,bH]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[uN,[TN,wH],[_N,bH]],[/droid.+; (glass) \d/i],[uN,[TN,e6],[_N,bH]],[/droid.+; (wt63?0{2,3})\)/i],[uN,[TN,EH],[_N,bH]],[/(quest( 2| pro)?)/i],[uN,[TN,RH],[_N,bH]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[TN,[_N,PH]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[uN,[_N,iH]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[uN,[_N,lH]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_N,lH]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_N,iH]],[/(android[-\w\. ]{0,9});.+buil/i],[uN,[TN,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[vN,[lN,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[vN,[lN,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[lN,vN],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[vN,lN]],os:[[/microsoft (windows) (vista|xp)/i],[lN,vN],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[lN,[vN,ire,uae]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[lN,"Windows"],[vN,ire,uae]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[vN,/_/g,"."],[lN,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[lN,M5],[vN,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[vN,lN],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[lN,vN],[/\(bb(10);/i],[vN,[lN,XH]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[vN,[lN,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[vN,[lN,$5+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[vN,[lN,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[vN,[lN,"watchOS"]],[/crkey\/([\d\.]+)/i],[vN,[lN,p5+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[lN,ZH],vN],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[lN,vN],[/(sunos) ?([\w\.\d]*)/i],[[lN,"Solaris"],vN],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[lN,vN]]},$8=function(gK,DK){if(typeof gK===B&&(DK=gK,gK=f),!(this instanceof $8))return new $8(gK,DK).getResult();var V6=typeof l!==k&&l.navigator?l.navigator:f,p8=gK||(V6&&V6.userAgent?V6.userAgent:""),ZJ=V6&&V6.userAgentData?V6.userAgentData:f,cK=DK?function(h6,s8){var $X={};for(var aJ in h6)s8[aJ]&&s8[aJ].length%2==0?$X[aJ]=s8[aJ].concat(h6[aJ]):$X[aJ]=h6[aJ];return $X}(dae,DK):dae;return this.getBrowser=function(){var h6={};return h6[lN]=f,h6[vN]=f,FQ.call(h6,p8,cK.browser),h6[$O]=function(s8){return typeof s8===Wt?s8.replace(/[^\d\.]/g,"").split(".")[0]:f}(h6[vN]),V6&&V6.brave&&typeof V6.brave.isBrave==b&&(h6[lN]="Brave"),h6},this.getCPU=function(){var h6={};return h6[uH]=f,FQ.call(h6,p8,cK.cpu),h6},this.getDevice=function(){var h6={};return h6[TN]=f,h6[uN]=f,h6[_N]=f,FQ.call(h6,p8,cK.device),!h6[_N]&&ZJ&&ZJ.mobile&&(h6[_N]=iH),h6[uN]=="Macintosh"&&V6&&typeof V6.standalone!==k&&V6.maxTouchPoints&&V6.maxTouchPoints>2&&(h6[uN]="iPad",h6[_N]=lH),h6},this.getEngine=function(){var h6={};return h6[lN]=f,h6[vN]=f,FQ.call(h6,p8,cK.engine),h6},this.getOS=function(){var h6={};return h6[lN]=f,h6[vN]=f,FQ.call(h6,p8,cK.os),!h6[lN]&&ZJ&&ZJ.platform!="Unknown"&&(h6[lN]=ZJ.platform.replace(/chrome os/i,ZH).replace(/macos/i,M5)),h6},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return p8},this.setUA=function(h6){return p8=typeof h6===Wt&&h6.length>350?B7(h6,350):h6,this},this.setUA(p8),this};$8.VERSION="0.7.34",$8.BROWSER=v6([lN,vN,$O]),$8.CPU=v6([uH]),$8.DEVICE=v6([uN,TN,_N,rH,iH,hH,lH,bH,PH]),$8.ENGINE=$8.OS=v6([lN,vN]),s.exports&&(d=s.exports=$8),d.UAParser=$8;var ZX=typeof l!==k&&(l.jQuery||l.Zepto);if(ZX&&!ZX.ua){var jQ=new $8;ZX.ua=jQ.getResult(),ZX.ua.get=function(){return jQ.getUA()},ZX.ua.set=function(gK){jQ.setUA(gK);var DK=jQ.getResult();for(var V6 in DK)ZX.ua[V6]=DK[V6]}}})(typeof window=="object"?window:o)})(vue,vue.exports);var IAe=h(vue.exports),wAe=eY,AAe=kK,OAe=fK,NAe=a4,PAe=K6("iterator"),DAe=Object,kAe=function(s){if(OAe(s))return!1;var d=DAe(s);return d[PAe]!==void 0||"@@iterator"in d||AAe(NAe,wAe(d))},LAe=h(kAe),Wfe=y7.clear;f6({global:!0,bind:!0,enumerable:!0,forced:mN.clearImmediate!==Wfe},{clearImmediate:Wfe});var Hfe=mN,MAe=aH,UAe=VH,xAe=w9,VAe=k8,FAe=cY,jAe=U4,BAe=Hfe.Function,GAe=/MSIE .\./.test(VAe)||xAe==="BUN"&&function(){var s=Hfe.Bun.version.split(".");return s.length<3||s[0]==="0"&&(s[1]<3||s[1]==="3"&&s[2]==="0")}(),WAe=f6,qfe=mN,Kfe=y7.set,HAe=function(s,d){var l=1;return GAe?function(f,b){var k=jAe(arguments.length,1)>l,B=UAe(f)?f:BAe(f),Wt=k?FAe(arguments,l):[],$O=k?function(){MAe(B,this,Wt)}:B;return s($O)}:s},zfe=qfe.setImmediate?HAe(Kfe):Kfe;WAe({global:!0,bind:!0,enumerable:!0,forced:qfe.setImmediate!==zfe},{setImmediate:zfe});var Yfe=h(M6.setImmediate),qAe=mN,KAe=qte,zAe=s4,YAe=U4,JAe=IH;f6({global:!0,enumerable:!0,dontCallGetSet:!0,forced:p(function(){return JAe&&Object.getOwnPropertyDescriptor(qAe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(s){YAe(arguments.length,1),KAe(zAe(s))}});var Jfe=h(M6.queueMicrotask);function Xfe(s,d){return function(){return s.apply(d,arguments)}}const{toString:XAe}=Object.prototype,{getPrototypeOf:Cue}=Object,gse=(Iue=Object.create(null),s=>{const d=XAe.call(s);return Iue[d]||(Iue[d]=d.slice(8,-1).toLowerCase())});var Iue;const YY=s=>(s=s.toLowerCase(),d=>gse(d)===s),Tse=s=>d=>typeof d===s,{isArray:T$}=Array,rne=Tse("undefined"),Qfe=YY("ArrayBuffer"),QAe=Tse("string"),W8=Tse("function"),Zfe=Tse("number"),Sse=s=>s!==null&&typeof s=="object",yse=s=>{if(gse(s)!=="object")return!1;const d=Cue(s);return!(d!==null&&d!==Object.prototype&&Object.getPrototypeOf(d)!==null||Symbol.toStringTag in s||LAe(s))},ZAe=YY("Date"),$Ae=YY("File"),eOe=YY("Blob"),tOe=YY("FileList"),nOe=YY("URLSearchParams"),[rOe,iOe,sOe,oOe]=["ReadableStream","Request","Response","Headers"].map(YY);function ine(s,d){let l,f,{allOwnKeys:b=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(s!=null)if(typeof s!="object"&&(s=[s]),T$(s))for(l=0,f=s.length;l<f;l++)d.call(null,s[l],l,s);else{const k=b?Object.getOwnPropertyNames(s):Object.keys(s),B=k.length;let Wt;for(l=0;l<B;l++)Wt=k[l],d.call(null,s[Wt],Wt,s)}}function $fe(s,d){d=d.toLowerCase();const l=Object.keys(s);let f,b=l.length;for(;b-- >0;)if(f=l[b],d===f.toLowerCase())return f;return null}const dQ=Gfe!==void 0?Gfe:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,e_e=s=>!rne(s)&&s!==dQ,aOe=(wue=typeof Uint8Array<"u"&&Cue(Uint8Array),s=>wue&&s instanceof wue);var wue;const cOe=YY("HTMLFormElement"),t_e=(s=>{let{hasOwnProperty:d}=s;return(l,f)=>d.call(l,f)})(Object.prototype),uOe=YY("RegExp"),n_e=(s,d)=>{const l=Object.getOwnPropertyDescriptors(s),f={};ine(l,(b,k)=>{let B;(B=d(b,k,s))!==!1&&(f[k]=B||b)}),Object.defineProperties(s,f)},Aue="abcdefghijklmnopqrstuvwxyz",r_e="0123456789",i_e={DIGIT:r_e,ALPHA:Aue,ALPHA_DIGIT:Aue+Aue.toUpperCase()+r_e},dOe=YY("AsyncFunction"),s_e=(o_e=typeof Yfe=="function",a_e=W8(dQ.postMessage),o_e?Yfe:a_e?(Oue="axios@".concat(Math.random()),Rse=[],dQ.addEventListener("message",s=>{let{source:d,data:l}=s;d===dQ&&l===Oue&&Rse.length&&Rse.shift()()},!1),s=>{Rse.push(s),dQ.postMessage(Oue,"*")}):s=>setTimeout(s));var o_e,a_e,Oue,Rse;const lOe=Jfe!==void 0?Jfe.bind(dQ):typeof process<"u"&&process.nextTick||s_e;var c5={isArray:T$,isArrayBuffer:Qfe,isBuffer:function(s){return s!==null&&!rne(s)&&s.constructor!==null&&!rne(s.constructor)&&W8(s.constructor.isBuffer)&&s.constructor.isBuffer(s)},isFormData:s=>{let d;return s&&(typeof FormData=="function"&&s instanceof FormData||W8(s.append)&&((d=gse(s))==="formdata"||d==="object"&&W8(s.toString)&&s.toString()==="[object FormData]"))},isArrayBufferView:function(s){let d;return d=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer&&Qfe(s.buffer),d},isString:QAe,isNumber:Zfe,isBoolean:s=>s===!0||s===!1,isObject:Sse,isPlainObject:yse,isReadableStream:rOe,isRequest:iOe,isResponse:sOe,isHeaders:oOe,isUndefined:rne,isDate:ZAe,isFile:$Ae,isBlob:eOe,isRegExp:uOe,isFunction:W8,isStream:s=>Sse(s)&&W8(s.pipe),isURLSearchParams:nOe,isTypedArray:aOe,isFileList:tOe,forEach:ine,merge:function s(){const{caseless:d}=e_e(this)&&this||{},l={},f=(b,k)=>{const B=d&&$fe(l,k)||k;yse(l[B])&&yse(b)?l[B]=s(l[B],b):yse(b)?l[B]=s({},b):T$(b)?l[B]=b.slice():l[B]=b};for(let b=0,k=arguments.length;b<k;b++)arguments[b]&&ine(arguments[b],f);return l},extend:function(s,d,l){let{allOwnKeys:f}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return ine(d,(b,k)=>{l&&W8(b)?s[k]=Xfe(b,l):s[k]=b},{allOwnKeys:f}),s},trim:s=>p4(s)?p4(s).call(s):s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),inherits:(s,d,l,f)=>{s.prototype=Object.create(d.prototype,f),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:d.prototype}),l&&Object.assign(s.prototype,l)},toFlatObject:(s,d,l,f)=>{let b,k,B;const Wt={};if(d=d||{},s==null)return d;do{for(b=Object.getOwnPropertyNames(s),k=b.length;k-- >0;)B=b[k],f&&!f(B,s,d)||Wt[B]||(d[B]=s[B],Wt[B]=!0);s=l!==!1&&Cue(s)}while(s&&(!l||l(s,d))&&s!==Object.prototype);return d},kindOf:gse,kindOfTest:YY,endsWith:(s,d,l)=>{s=String(s),(l===void 0||l>s.length)&&(l=s.length),l-=d.length;const f=s.indexOf(d,l);return f!==-1&&f===l},toArray:s=>{if(!s)return null;if(T$(s))return s;let d=s.length;if(!Zfe(d))return null;const l=new Array(d);for(;d-- >0;)l[d]=s[d];return l},forEachEntry:(s,d)=>{const l=(s&&s[Symbol.iterator]).call(s);let f;for(;(f=l.next())&&!f.done;){const b=f.value;d.call(s,b[0],b[1])}},matchAll:(s,d)=>{let l;const f=[];for(;(l=s.exec(d))!==null;)f.push(l);return f},isHTMLForm:cOe,hasOwnProperty:t_e,hasOwnProp:t_e,reduceDescriptors:n_e,freezeMethods:s=>{n_e(s,(d,l)=>{if(W8(s)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const f=s[l];W8(f)&&(d.enumerable=!1,"writable"in d?d.writable=!1:d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")}))})},toObjectSet:(s,d)=>{const l={},f=b=>{b.forEach(k=>{l[k]=!0})};return T$(s)?f(s):f(String(s).split(d)),l},toCamelCase:s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,l,f){return l.toUpperCase()+f}),noop:()=>{},toFiniteNumber:(s,d)=>s!=null&&Number.isFinite(s=+s)?s:d,findKey:$fe,global:dQ,isContextDefined:e_e,ALPHABET:i_e,generateString:function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i_e.ALPHA_DIGIT,l="";const{length:f}=d;for(;s--;)l+=d[Math.random()*f|0];return l},isSpecCompliantForm:function(s){return!!(s&&W8(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])},toJSONObject:s=>{const d=new Array(10),l=(f,b)=>{if(Sse(f)){if(d.indexOf(f)>=0)return;if(!("toJSON"in f)){d[b]=f;const k=T$(f)?[]:{};return ine(f,(B,Wt)=>{const $O=l(B,b+1);!rne($O)&&(k[Wt]=$O)}),d[b]=void 0,k}}return f};return l(s,0)},isAsyncFn:dOe,isThenable:s=>s&&(Sse(s)||W8(s))&&W8(s.then)&&W8(s.catch),setImmediate:s_e,asap:lOe};function R6(s,d,l,f,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",d&&(this.code=d),l&&(this.config=l),f&&(this.request=f),b&&(this.response=b,this.status=b.status?b.status:null)}c5.inherits(R6,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:c5.toJSONObject(this.config),code:this.code,status:this.status}}});const c_e=R6.prototype,u_e={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{u_e[s]={value:s}}),Object.defineProperties(R6,u_e),Object.defineProperty(c_e,"isAxiosError",{value:!0}),R6.from=(s,d,l,f,b,k)=>{const B=Object.create(c_e);return c5.toFlatObject(s,B,function(Wt){return Wt!==Error.prototype},Wt=>Wt!=="isAxiosError"),R6.call(B,s.message,d,l,f,b),B.cause=s,B.name=s.name,k&&Object.assign(B,k),B};function Nue(s){return c5.isPlainObject(s)||c5.isArray(s)}function d_e(s){return c5.endsWith(s,"[]")?s.slice(0,-2):s}function l_e(s,d,l){return s?s.concat(d).map(function(f,b){return f=d_e(f),!l&&b?"["+f+"]":f}).join(l?".":""):d}const hOe=c5.toFlatObject(c5,{},null,function(s){return/^is[A-Z]/.test(s)});function bse(s,d,l){if(!c5.isObject(s))throw new TypeError("target must be an object");d=d||new FormData;const f=(l=c5.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(TN,vN){return!c5.isUndefined(vN[TN])})).metaTokens,b=l.visitor||uN,k=l.dots,B=l.indexes,Wt=(l.Blob||typeof Blob<"u"&&Blob)&&c5.isSpecCompliantForm(d);if(!c5.isFunction(b))throw new TypeError("visitor must be a function");function $O(TN){if(TN===null)return"";if(c5.isDate(TN))return TN.toISOString();if(!Wt&&c5.isBlob(TN))throw new R6("Blob is not supported. Use a Buffer instead.");return c5.isArrayBuffer(TN)||c5.isTypedArray(TN)?Wt&&typeof Blob=="function"?new Blob([TN]):Buffer.from(TN):TN}function uN(TN,vN,uH){let rH=TN;if(TN&&!uH&&typeof TN=="object"){if(c5.endsWith(vN,"{}"))vN=f?vN:vN.slice(0,-2),TN=JSON.stringify(TN);else if(c5.isArray(TN)&&function(iH){return c5.isArray(iH)&&!iH.some(Nue)}(TN)||(c5.isFileList(TN)||c5.endsWith(vN,"[]"))&&(rH=c5.toArray(TN)))return vN=d_e(vN),rH.forEach(function(iH,lH){!c5.isUndefined(iH)&&iH!==null&&d.append(B===!0?l_e([vN],lH,k):B===null?vN:vN+"[]",$O(iH))}),!1}return!!Nue(TN)||(d.append(l_e(uH,vN,k),$O(TN)),!1)}const lN=[],_N=Object.assign(hOe,{defaultVisitor:uN,convertValue:$O,isVisitable:Nue});if(!c5.isObject(s))throw new TypeError("data must be an object");return function TN(vN,uH){if(!c5.isUndefined(vN)){if(lN.indexOf(vN)!==-1)throw Error("Circular reference detected in "+uH.join("."));lN.push(vN),c5.forEach(vN,function(rH,iH){(!(c5.isUndefined(rH)||rH===null)&&b.call(d,rH,c5.isString(iH)?p4(iH).call(iH):iH,uH,_N))===!0&&TN(rH,uH?uH.concat(iH):[iH])}),lN.pop()}}(s),d}function h_e(s){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(l){return d[l]})}function Pue(s,d){this._pairs=[],s&&bse(s,this,d)}const p_e=Pue.prototype;function pOe(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function f_e(s,d,l){if(!d)return s;const f=l&&l.encode||pOe;c5.isFunction(l)&&(l={serialize:l});const b=l&&l.serialize;let k;if(k=b?b(d,l):c5.isURLSearchParams(d)?d.toString():new Pue(d,l).toString(f),k){const B=s.indexOf("#");B!==-1&&(s=s.slice(0,B)),s+=(s.indexOf("?")===-1?"?":"&")+k}return s}p_e.append=function(s,d){this._pairs.push([s,d])},p_e.toString=function(s){const d=s?function(l){return s.call(this,l,h_e)}:h_e;return this._pairs.map(function(l){return d(l[0])+"="+d(l[1])},"").join("&")};var __e=class{constructor(){this.handlers=[]}use(s,d,l){return this.handlers.push({fulfilled:s,rejected:d,synchronous:!!l&&l.synchronous,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){c5.forEach(this.handlers,function(d){d!==null&&s(d)})}},E_e={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},m_e={exports:{}},fOe=f6,_Oe=IH,g_e=k4.f;fOe({target:"Object",stat:!0,forced:Object.defineProperty!==g_e,sham:!_Oe},{defineProperty:g_e});var T_e=M6.Object,EOe=m_e.exports=function(s,d,l){return T_e.defineProperty(s,d,l)};T_e.defineProperty.sham&&(EOe.sham=!0);var S_e=h(m_e.exports),mOe=TypeError,y_e=iX,gOe=R4,TOe=Q5,SOe=K6("species"),R_e=Array,yOe=function(s){var d;return y_e(s)&&(d=s.constructor,(gOe(d)&&(d===R_e||y_e(d.prototype))||TOe(d)&&(d=d[SOe])===null)&&(d=void 0)),d===void 0?R_e:d},b_e=function(s,d){return new(yOe(s))(d===0?0:d)},ROe=p,bOe=cJ,vOe=K6("species"),v_e=function(s){return bOe>=51||!ROe(function(){var d=[];return(d.constructor={})[vOe]=function(){return{foo:1}},d[s](Boolean).foo!==1})},COe=f6,IOe=p,wOe=iX,AOe=Q5,OOe=Q6,NOe=mJ,C_e=function(s){if(s>9007199254740991)throw mOe("Maximum allowed index exceeded");return s},I_e=Wce,POe=b_e,DOe=v_e,kOe=cJ,w_e=K6("isConcatSpreadable"),LOe=kOe>=51||!IOe(function(){var s=[];return s[w_e]=!1,s.concat()[0]!==s}),MOe=function(s){if(!AOe(s))return!1;var d=s[w_e];return d!==void 0?!!d:wOe(s)};COe({target:"Array",proto:!0,arity:1,forced:!LOe||!DOe("concat")},{concat:function(s){var d,l,f,b,k,B=OOe(this),Wt=POe(B,0),$O=0;for(d=-1,f=arguments.length;d<f;d++)if(MOe(k=d===-1?B:arguments[d]))for(b=NOe(k),C_e($O+b),l=0;l<b;l++,$O++)l in k&&I_e(Wt,$O,k[l]);else C_e($O+1),I_e(Wt,$O++,k);return Wt.length=$O,Wt}});var A_e={},UOe=AH,xOe=y5,O_e=M8.f,VOe=cY,N_e=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];A_e.f=function(s){return N_e&&UOe(s)==="Window"?function(d){try{return O_e(d)}catch{return VOe(N_e)}}(s):O_e(xOe(s))};var S$={},FOe=K6;S$.f=FOe;var P_e=M6,jOe=kK,BOe=S$,GOe=k4.f,FK=function(s){var d=P_e.Symbol||(P_e.Symbol={});jOe(d,s)||GOe(d,s,{value:BOe.f(s)})},WOe=yH,HOe=X6,qOe=K6,KOe=xY,D_e=function(){var s=HOe("Symbol"),d=s&&s.prototype,l=d&&d.valueOf,f=qOe("toPrimitive");d&&!d[f]&&KOe(d,f,function(b){return WOe(l,this)},{arity:1})},zOe=_z,YOe=C6,JOe=Q6,XOe=mJ,QOe=b_e,k_e=cN([].push),DX=function(s){var d=s===1,l=s===2,f=s===3,b=s===4,k=s===6,B=s===7,Wt=s===5||k;return function($O,uN,lN,_N){for(var TN,vN,uH=JOe($O),rH=YOe(uH),iH=XOe(rH),lH=zOe(uN,lN),hH=0,bH=_N||QOe,PH=d?bH($O,iH):l||B?bH($O,0):void 0;iH>hH;hH++)if((Wt||hH in rH)&&(vN=lH(TN=rH[hH],hH,uH),s))if(d)PH[hH]=vN;else if(vN)switch(s){case 3:return!0;case 5:return TN;case 6:return hH;case 2:k_e(PH,TN)}else switch(s){case 4:return!1;case 7:k_e(PH,TN)}return k?-1:f||b?b:PH}},L_e={forEach:DX(0),map:DX(1),filter:DX(2),some:DX(3),every:DX(4),find:DX(5),findIndex:DX(6),filterReject:DX(7)},vse=f6,sne=mN,Due=yH,ZOe=cN,y$=IH,R$=uJ,$Oe=p,C4=kK,eNe=dN,kue=o4,Cse=y5,Lue=YQ,tNe=K4,Mue=xH,b$=LY,M_e=L4,nNe=M8,U_e=A_e,rNe=uX,x_e=KH,V_e=k4,iNe=hX,F_e=TH,j_e=xY,sNe=T7,Uue=t7,B_e=rK,G_e=_8,oNe=K6,aNe=S$,cNe=FK,uNe=D_e,dNe=oY,W_e=sY,Ise=L_e.forEach,y8=sX("hidden"),wse="Symbol",one="prototype",lNe=W_e.set,H_e=W_e.getterFor(wse),JY=Object[one],lQ=sne.Symbol,Ase=lQ&&lQ[one],hNe=sne.RangeError,pNe=sne.TypeError,xue=sne.QObject,q_e=x_e.f,hQ=V_e.f,K_e=U_e.f,fNe=F_e.f,z_e=ZOe([].push),I7=Uue("symbols"),ane=Uue("op-symbols"),_Ne=Uue("wks"),Vue=!xue||!xue[one]||!xue[one].findChild,Y_e=function(s,d,l){var f=q_e(JY,d);f&&delete JY[d],hQ(s,d,l),f&&s!==JY&&hQ(JY,d,f)},Fue=y$&&$Oe(function(){return b$(hQ({},"a",{get:function(){return hQ(this,"a",{value:7}).a}})).a!==7})?Y_e:hQ,jue=function(s,d){var l=I7[s]=b$(Ase);return lNe(l,{type:wse,tag:s,description:d}),y$||(l.description=d),l},Ose=function(s,d,l){s===JY&&Ose(ane,d,l),kue(s);var f=Lue(d);return kue(l),C4(I7,f)?(l.enumerable?(C4(s,y8)&&s[y8][f]&&(s[y8][f]=!1),l=b$(l,{enumerable:Mue(0,!1)})):(C4(s,y8)||hQ(s,y8,Mue(1,b$(null))),s[y8][f]=!0),Fue(s,f,l)):hQ(s,f,l)},Bue=function(s,d){kue(s);var l=Cse(d),f=M_e(l).concat(Z_e(l));return Ise(f,function(b){y$&&!Due(J_e,l,b)||Ose(s,b,l[b])}),s},J_e=function(s){var d=Lue(s),l=Due(fNe,this,d);return!(this===JY&&C4(I7,d)&&!C4(ane,d))&&(!(l||!C4(this,d)||!C4(I7,d)||C4(this,y8)&&this[y8][d])||l)},X_e=function(s,d){var l=Cse(s),f=Lue(d);if(l!==JY||!C4(I7,f)||C4(ane,f)){var b=q_e(l,f);return!b||!C4(I7,f)||C4(l,y8)&&l[y8][f]||(b.enumerable=!0),b}},Q_e=function(s){var d=K_e(Cse(s)),l=[];return Ise(d,function(f){C4(I7,f)||C4(B_e,f)||z_e(l,f)}),l},Z_e=function(s){var d=s===JY,l=K_e(d?ane:Cse(s)),f=[];return Ise(l,function(b){!C4(I7,b)||d&&!C4(JY,b)||z_e(f,I7[b])}),f};R$||(lQ=function(){if(eNe(Ase,this))throw new pNe("Symbol is not a constructor");var s=arguments.length&&arguments[0]!==void 0?tNe(arguments[0]):void 0,d=G_e(s),l=function(f){var b=this===void 0?sne:this;b===JY&&Due(l,ane,f),C4(b,y8)&&C4(b[y8],d)&&(b[y8][d]=!1);var k=Mue(1,f);try{Fue(b,d,k)}catch(B){if(!(B instanceof hNe))throw B;Y_e(b,d,k)}};return y$&&Vue&&Fue(JY,d,{configurable:!0,set:l}),jue(d,s)},j_e(Ase=lQ[one],"toString",function(){return H_e(this).tag}),j_e(lQ,"withoutSetter",function(s){return jue(G_e(s),s)}),F_e.f=J_e,V_e.f=Ose,iNe.f=Bue,x_e.f=X_e,nNe.f=U_e.f=Q_e,rNe.f=Z_e,aNe.f=function(s){return jue(oNe(s),s)},y$&&sNe(Ase,"description",{configurable:!0,get:function(){return H_e(this).description}})),vse({global:!0,constructor:!0,wrap:!0,forced:!R$,sham:!R$},{Symbol:lQ}),Ise(M_e(_Ne),function(s){cNe(s)}),vse({target:wse,stat:!0,forced:!R$},{useSetter:function(){Vue=!0},useSimple:function(){Vue=!1}}),vse({target:"Object",stat:!0,forced:!R$,sham:!y$},{create:function(s,d){return d===void 0?b$(s):Bue(b$(s),d)},defineProperty:Ose,defineProperties:Bue,getOwnPropertyDescriptor:X_e}),vse({target:"Object",stat:!0,forced:!R$},{getOwnPropertyNames:Q_e}),uNe(),dNe(lQ,wse),B_e[y8]=!0;var $_e=uJ&&!!Symbol.for&&!!Symbol.keyFor,ENe=f6,mNe=X6,gNe=kK,TNe=K4,eEe=t7,SNe=$_e,Gue=eEe("string-to-symbol-registry"),yNe=eEe("symbol-to-string-registry");ENe({target:"Symbol",stat:!0,forced:!SNe},{for:function(s){var d=TNe(s);if(gNe(Gue,d))return Gue[d];var l=mNe("Symbol")(d);return Gue[d]=l,yNe[l]=d,l}});var RNe=f6,bNe=kK,vNe=z7,CNe=$J,INe=$_e,tEe=t7("symbol-to-string-registry");RNe({target:"Symbol",stat:!0,forced:!INe},{keyFor:function(s){if(!vNe(s))throw new TypeError(CNe(s)+" is not a symbol");if(bNe(tEe,s))return tEe[s]}});var nEe=iX,wNe=VH,rEe=AH,ANe=K4,iEe=cN([].push),ONe=f6,sEe=X6,oEe=aH,NNe=yH,cne=cN,aEe=p,cEe=VH,uEe=z7,dEe=cY,PNe=function(s){if(wNe(s))return s;if(nEe(s)){for(var d=s.length,l=[],f=0;f<d;f++){var b=s[f];typeof b=="string"?iEe(l,b):typeof b!="number"&&rEe(b)!=="Number"&&rEe(b)!=="String"||iEe(l,ANe(b))}var k=l.length,B=!0;return function(Wt,$O){if(B)return B=!1,$O;if(nEe(this))return $O;for(var uN=0;uN<k;uN++)if(l[uN]===Wt)return $O}}},DNe=uJ,kNe=String,kX=sEe("JSON","stringify"),Nse=cne(/./.exec),lEe=cne("".charAt),LNe=cne("".charCodeAt),MNe=cne("".replace),UNe=cne(1 .toString),xNe=/[\uD800-\uDFFF]/g,hEe=/^[\uD800-\uDBFF]$/,pEe=/^[\uDC00-\uDFFF]$/,fEe=!DNe||aEe(function(){var s=sEe("Symbol")("stringify detection");return kX([s])!=="[null]"||kX({a:s})!=="{}"||kX(Object(s))!=="{}"}),_Ee=aEe(function(){return kX("\uDF06\uD834")!=='"\\udf06\\ud834"'||kX("\uDEAD")!=='"\\udead"'}),VNe=function(s,d){var l=dEe(arguments),f=PNe(d);if(cEe(f)||s!==void 0&&!uEe(s))return l[1]=function(b,k){if(cEe(f)&&(k=NNe(f,this,kNe(b),k)),!uEe(k))return k},oEe(kX,null,l)},FNe=function(s,d,l){var f=lEe(l,d-1),b=lEe(l,d+1);return Nse(hEe,s)&&!Nse(pEe,b)||Nse(pEe,s)&&!Nse(hEe,f)?"\\u"+UNe(LNe(s,0),16):s};kX&&ONe({target:"JSON",stat:!0,arity:3,forced:fEe||_Ee},{stringify:function(s,d,l){var f=dEe(arguments),b=oEe(fEe?VNe:kX,null,f);return _Ee&&typeof b=="string"?MNe(b,xNe,FNe):b}});var EEe=uX,jNe=Q6;f6({target:"Object",stat:!0,forced:!uJ||p(function(){EEe.f(1)})},{getOwnPropertySymbols:function(s){var d=EEe.f;return d?d(jNe(s)):[]}}),FK("asyncIterator"),FK("hasInstance"),FK("isConcatSpreadable"),FK("iterator"),FK("match"),FK("matchAll"),FK("replace"),FK("search"),FK("species"),FK("split");var BNe=D_e;FK("toPrimitive"),BNe();var GNe=X6,WNe=oY;FK("toStringTag"),WNe(GNe("Symbol"),"Symbol"),FK("unscopables"),oY(mN.JSON,"JSON",!0);var HNe=M6.Symbol,qNe=K6,KNe=k4.f,mEe=qNe("metadata"),gEe=Function.prototype;gEe[mEe]===void 0&&KNe(gEe,mEe,{value:null}),FK("asyncDispose"),FK("dispose"),FK("metadata");var zNe=HNe,YNe=cN,Wue=X6("Symbol"),JNe=Wue.keyFor,XNe=YNe(Wue.prototype.valueOf),TEe=Wue.isRegisteredSymbol||function(s){try{return JNe(XNe(s))!==void 0}catch{return!1}};f6({target:"Symbol",stat:!0},{isRegisteredSymbol:TEe});for(var QNe=t7,SEe=X6,ZNe=cN,$Ne=z7,ePe=K6,Pse=SEe("Symbol"),yEe=Pse.isWellKnownSymbol,REe=SEe("Object","getOwnPropertyNames"),tPe=ZNe(Pse.prototype.valueOf),bEe=QNe("wks"),Hue=0,vEe=REe(Pse),nPe=vEe.length;Hue<nPe;Hue++)try{var CEe=vEe[Hue];$Ne(Pse[CEe])&&ePe(CEe)}catch{}var IEe=function(s){if(yEe&&yEe(s))return!0;try{for(var d=tPe(s),l=0,f=REe(bEe),b=f.length;l<b;l++)if(bEe[f[l]]==d)return!0}catch{}return!1};f6({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:IEe}),FK("customMatcher"),FK("observable"),f6({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:TEe}),f6({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:IEe}),FK("matcher"),FK("metadataKey"),FK("patternMatch"),FK("replaceAll");var v$=h(zNe),wEe=h(S$.f("iterator"));function une(s){return une=typeof v$=="function"&&typeof wEe=="symbol"?function(d){return typeof d}:function(d){return d&&typeof v$=="function"&&d.constructor===v$&&d!==v$.prototype?"symbol":typeof d},une(s)}var rPe=h(S$.f("toPrimitive"));function iPe(s){var d=function(l,f){if(une(l)!=="object"||l===null)return l;var b=l[rPe];if(b!==void 0){var k=b.call(l,f||"default");if(une(k)!=="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(l)}(s,"string");return une(d)==="symbol"?d:String(d)}function cH(s,d,l){return(d=iPe(d))in s?S_e(s,d,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[d]=l,s}var AEe=h(kIe),sPe={isBrowser:!0,classes:{URLSearchParams:AEe!==void 0?AEe:Pue,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const que=typeof window<"u"&&typeof document<"u",Kue=typeof navigator=="object"&&navigator||void 0,oPe=que&&(!Kue||["ReactNative","NativeScript","NS"].indexOf(Kue.product)<0),aPe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",cPe=que&&window.location.href||"http://localhost";function OEe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function NEe(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?OEe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):OEe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}var Z4=NEe(NEe({},Object.freeze({__proto__:null,hasBrowserEnv:que,hasStandardBrowserEnv:oPe,hasStandardBrowserWebWorkerEnv:aPe,navigator:Kue,origin:cPe})),sPe),uPe=o4,dPe=yH,lPe=kK,hPe=dN,pPe=function(){var s=uPe(this),d="";return s.hasIndices&&(d+="d"),s.global&&(d+="g"),s.ignoreCase&&(d+="i"),s.multiline&&(d+="m"),s.dotAll&&(d+="s"),s.unicode&&(d+="u"),s.unicodeSets&&(d+="v"),s.sticky&&(d+="y"),d},PEe=RegExp.prototype,DEe=function(s){var d=s.flags;return d!==void 0||"flags"in PEe||lPe(s,"flags")||!hPe(PEe,s)?d:dPe(pPe,s)},fPe=Pce.charAt,kEe=yH,_Pe=o4,EPe=VH,mPe=AH,gPe=/./.exec,TPe=TypeError,SPe=f6,LEe=yH,MEe=CH,yPe=H9,Dse=VZ,UEe=L6,xEe=Nre,dne=K4,RPe=o4,bPe=fK,vPe=AH,CPe=Fee,VEe=DEe,IPe=WQ,wPe=p,APe=b4,OPe=function(s,d,l){return d+(l?fPe(s,d).length:1)},NPe=function(s,d){var l=s.exec;if(EPe(l)){var f=kEe(l,s,d);return f!==null&&_Pe(f),f}if(mPe(s)==="RegExp")return kEe(gPe,s,d);throw new TPe("RegExp#exec called on incompatible receiver")},FEe=sY,PPe=K6("matchAll"),jEe="RegExp String",BEe=jEe+" Iterator",DPe=FEe.set,kPe=FEe.getterFor(BEe),LPe=TypeError,zue=MEe("".indexOf),kse=MEe("".matchAll),Yue=!!kse&&!wPe(function(){kse("a",/./)}),MPe=yPe(function(s,d,l,f){DPe(this,{type:BEe,regexp:s,string:d,global:l,unicode:f,done:!1})},jEe,function(){var s=kPe(this);if(s.done)return Dse(void 0,!0);var d=s.regexp,l=s.string,f=NPe(d,l);return f===null?(s.done=!0,Dse(void 0,!0)):s.global?(dne(f[0])===""&&(d.lastIndex=OPe(l,xEe(d.lastIndex),s.unicode)),Dse(f,!1)):(s.done=!0,Dse(f,!1))}),GEe=function(s){var d,l,f,b=RPe(this),k=dne(s),B=APe(b,RegExp),Wt=dne(VEe(b));return d=new B(B===RegExp?b.source:b,Wt),l=!!~zue(Wt,"g"),f=!!~zue(Wt,"u"),d.lastIndex=xEe(b.lastIndex),new MPe(d,k,l,f)};SPe({target:"String",proto:!0,forced:Yue},{matchAll:function(s){var d,l,f,b,k=UEe(this);if(bPe(s)){if(Yue)return kse(k,s)}else{if(CPe(s)&&(d=dne(UEe(VEe(s))),!~zue(d,"g")))throw new LPe("`.matchAll` does not allow non-global regexes");if(Yue)return kse(k,s);if((f=IPe(s,PPe))===void 0&&vPe(s)==="RegExp"&&(f=GEe),f)return LEe(f,s,k)}return l=dne(k),b=new RegExp(s,"g"),LEe(GEe,b,l)}});var UPe=l4("String","matchAll"),xPe=dN,VPe=UPe,Jue=String.prototype,FPe=function(s){var d=s.matchAll;return typeof s=="string"||s===Jue||xPe(Jue,s)&&d===Jue.matchAll?VPe:d},jPe=h(FPe);function WEe(s){function d(l,f,b,k){let B=l[k++];if(B==="__proto__")return!0;const Wt=Number.isFinite(+B),$O=k>=l.length;return B=!B&&c5.isArray(b)?b.length:B,$O?(c5.hasOwnProp(b,B)?b[B]=[b[B],f]:b[B]=f,!Wt):(b[B]&&c5.isObject(b[B])||(b[B]=[]),d(l,f,b[B],k)&&c5.isArray(b[B])&&(b[B]=function(uN){const lN={},_N=Object.keys(uN);let TN;const vN=_N.length;let uH;for(TN=0;TN<vN;TN++)uH=_N[TN],lN[uH]=uN[uH];return lN}(b[B])),!Wt)}if(c5.isFormData(s)&&c5.isFunction(s.entries)){const l={};return c5.forEachEntry(s,(f,b)=>{d(function(k){return jPe(c5).call(c5,/\w+|\[(\w*)]/g,k).map(B=>B[0]==="[]"?"":B[1]||B[0])}(f),b,l,0)}),l}return null}const Xue={transitional:E_e,adapter:["xhr","http","fetch"],transformRequest:[function(s,d){const l=d.getContentType()||"",f=l.indexOf("application/json")>-1,b=c5.isObject(s);if(b&&c5.isHTMLForm(s)&&(s=new FormData(s)),c5.isFormData(s))return f?JSON.stringify(WEe(s)):s;if(c5.isArrayBuffer(s)||c5.isBuffer(s)||c5.isStream(s)||c5.isFile(s)||c5.isBlob(s)||c5.isReadableStream(s))return s;if(c5.isArrayBufferView(s))return s.buffer;if(c5.isURLSearchParams(s))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let k;if(b){if(l.indexOf("application/x-www-form-urlencoded")>-1)return function(B,Wt){return bse(B,new Z4.classes.URLSearchParams,Object.assign({visitor:function($O,uN,lN,_N){return Z4.isNode&&c5.isBuffer($O)?(this.append(uN,$O.toString("base64")),!1):_N.defaultVisitor.apply(this,arguments)}},Wt))}(s,this.formSerializer).toString();if((k=c5.isFileList(s))||l.indexOf("multipart/form-data")>-1){const B=this.env&&this.env.FormData;return bse(k?{"files[]":s}:s,B&&new B,this.formSerializer)}}return b||f?(d.setContentType("application/json",!1),function(B,Wt,$O){if(c5.isString(B))try{return(Wt||JSON.parse)(B),p4(c5).call(c5,B)}catch(uN){if(uN.name!=="SyntaxError")throw uN}return(0,JSON.stringify)(B)}(s)):s}],transformResponse:[function(s){const d=this.transitional||Xue.transitional,l=d&&d.forcedJSONParsing,f=this.responseType==="json";if(c5.isResponse(s)||c5.isReadableStream(s))return s;if(s&&c5.isString(s)&&(l&&!this.responseType||f)){const b=!(d&&d.silentJSONParsing)&&f;try{return JSON.parse(s)}catch(k){if(b)throw k.name==="SyntaxError"?R6.from(k,R6.ERR_BAD_RESPONSE,this,null,this.response):k}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Z4.classes.FormData,Blob:Z4.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};c5.forEach(["delete","get","head","post","put","patch"],s=>{Xue.headers[s]={}});var Que=Xue;const BPe=c5.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),HEe=Symbol("internals");function lne(s){var d;return s&&p4(d=String(s)).call(d).toLowerCase()}function Lse(s){return s===!1||s==null?s:c5.isArray(s)?s.map(Lse):String(s)}function Zue(s,d,l,f,b){return c5.isFunction(f)?f.call(this,d,l):(b&&(d=l),c5.isString(d)?c5.isString(f)?d.indexOf(f)!==-1:c5.isRegExp(f)?f.test(d):void 0:void 0)}class Mse{constructor(d){d&&this.set(d)}set(d,l,f){const b=this;function k($O,uN,lN){const _N=lne(uN);if(!_N)throw new Error("header name must be a non-empty string");const TN=c5.findKey(b,_N);(!TN||b[TN]===void 0||lN===!0||lN===void 0&&b[TN]!==!1)&&(b[TN||uN]=Lse($O))}const B=($O,uN)=>c5.forEach($O,(lN,_N)=>k(lN,_N,uN));if(c5.isPlainObject(d)||d instanceof this.constructor)B(d,l);else if(c5.isString(d)&&(d=p4(d).call(d))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(p4(Wt=d).call(Wt)))B(($O=>{const uN={};let lN,_N,TN;return $O&&$O.split(`
`).forEach(function(vN){var uH,rH;TN=vN.indexOf(":"),lN=p4(uH=vN.substring(0,TN)).call(uH).toLowerCase(),_N=p4(rH=vN.substring(TN+1)).call(rH),!lN||uN[lN]&&BPe[lN]||(lN==="set-cookie"?uN[lN]?uN[lN].push(_N):uN[lN]=[_N]:uN[lN]=uN[lN]?uN[lN]+", "+_N:_N)}),uN})(d),l);else if(c5.isHeaders(d))for(const[$O,uN]of d.entries())k(uN,$O,f);else d!=null&&k(l,d,f);var Wt;return this}get(d,l){if(d=lne(d)){const f=c5.findKey(this,d);if(f){const b=this[f];if(!l)return b;if(l===!0)return function(k){const B=Object.create(null),Wt=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let $O;for(;$O=Wt.exec(k);)B[$O[1]]=$O[2];return B}(b);if(c5.isFunction(l))return l.call(this,b,f);if(c5.isRegExp(l))return l.exec(b);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,l){if(d=lne(d)){const f=c5.findKey(this,d);return!(!f||this[f]===void 0||l&&!Zue(0,this[f],f,l))}return!1}delete(d,l){const f=this;let b=!1;function k(B){if(B=lne(B)){const Wt=c5.findKey(f,B);!Wt||l&&!Zue(0,f[Wt],Wt,l)||(delete f[Wt],b=!0)}}return c5.isArray(d)?d.forEach(k):k(d),b}clear(d){const l=Object.keys(this);let f=l.length,b=!1;for(;f--;){const k=l[f];d&&!Zue(0,this[k],k,d,!0)||(delete this[k],b=!0)}return b}normalize(d){const l=this,f={};return c5.forEach(this,(b,k)=>{var B;const Wt=c5.findKey(f,k);if(Wt)return l[Wt]=Lse(b),void delete l[k];const $O=d?function(uN){return p4(uN).call(uN).toLowerCase().replace(/([a-z\d])(\w*)/g,(lN,_N,TN)=>_N.toUpperCase()+TN)}(k):p4(B=String(k)).call(B);$O!==k&&delete l[k],l[$O]=Lse(b),f[$O]=!0}),this}concat(){for(var d=arguments.length,l=new Array(d),f=0;f<d;f++)l[f]=arguments[f];return this.constructor.concat(this,...l)}toJSON(d){const l=Object.create(null);return c5.forEach(this,(f,b)=>{f!=null&&f!==!1&&(l[b]=d&&c5.isArray(f)?f.join(", "):f)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(d=>{let[l,f]=d;return l+": "+f}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d){const l=new this(d);for(var f=arguments.length,b=new Array(f>1?f-1:0),k=1;k<f;k++)b[k-1]=arguments[k];return b.forEach(B=>l.set(B)),l}static accessor(d){const l=(this[HEe]=this[HEe]={accessors:{}}).accessors,f=this.prototype;function b(k){const B=lne(k);l[B]||(function(Wt,$O){const uN=c5.toCamelCase(" "+$O);["get","set","has"].forEach(lN=>{Object.defineProperty(Wt,lN+uN,{value:function(_N,TN,vN){return this[lN].call(this,$O,_N,TN,vN)},configurable:!0})})}(f,k),l[B]=!0)}return c5.isArray(d)?d.forEach(b):b(d),this}}Mse.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),c5.reduceDescriptors(Mse.prototype,(s,d)=>{let{value:l}=s,f=d[0].toUpperCase()+d.slice(1);return{get:()=>l,set(b){this[f]=b}}}),c5.freezeMethods(Mse);var XY=Mse;function $ue(s,d){const l=this||Que,f=d||l,b=XY.from(f.headers);let k=f.data;return c5.forEach(s,function(B){k=B.call(l,k,b.normalize(),d?d.status:void 0)}),b.normalize(),k}function qEe(s){return!(!s||!s.__CANCEL__)}function C$(s,d,l){R6.call(this,s??"canceled",R6.ERR_CANCELED,d,l),this.name="CanceledError"}function KEe(s,d,l){const f=l.config.validateStatus;l.status&&f&&!f(l.status)?d(new R6("Request failed with status code "+l.status,[R6.ERR_BAD_REQUEST,R6.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l)):s(l)}c5.inherits(C$,R6,{__CANCEL__:!0});const Use=function(s,d){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,f=0;const b=function(k,B){k=k||10;const Wt=new Array(k),$O=new Array(k);let uN,lN=0,_N=0;return B=B!==void 0?B:1e3,function(TN){const vN=Date.now(),uH=$O[_N];uN||(uN=vN),Wt[lN]=TN,$O[lN]=vN;let rH=_N,iH=0;for(;rH!==lN;)iH+=Wt[rH++],rH%=k;if(lN=(lN+1)%k,lN===_N&&(_N=(_N+1)%k),vN-uN<B)return;const lH=uH&&vN-uH;return lH?Math.round(1e3*iH/lH):void 0}}(50,250);return function(k,B){let Wt,$O,uN=0,lN=1e3/B;const _N=function(TN){uN=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),Wt=null,$O&&(clearTimeout($O),$O=null),k.apply(null,TN)};return[function(){const TN=Date.now(),vN=TN-uN;for(var uH=arguments.length,rH=new Array(uH),iH=0;iH<uH;iH++)rH[iH]=arguments[iH];vN>=lN?_N(rH,TN):(Wt=rH,$O||($O=setTimeout(()=>{$O=null,_N(Wt)},lN-vN)))},()=>Wt&&_N(Wt)]}(k=>{const B=k.loaded,Wt=k.lengthComputable?k.total:void 0,$O=B-f,uN=b($O);f=B,s({loaded:B,total:Wt,progress:Wt?B/Wt:void 0,bytes:$O,rate:uN||void 0,estimated:uN&&Wt&&B<=Wt?(Wt-B)/uN:void 0,event:k,lengthComputable:Wt!=null,[d?"download":"upload"]:!0})},l)},zEe=(s,d)=>{const l=s!=null;return[f=>d[0]({lengthComputable:l,total:s,loaded:f}),d[1]]},YEe=s=>function(){for(var d=arguments.length,l=new Array(d),f=0;f<d;f++)l[f]=arguments[f];return c5.asap(()=>s(...l))};var GPe=Z4.hasStandardBrowserEnv?((s,d)=>l=>(l=new lse(l,Z4.origin),s.protocol===l.protocol&&s.host===l.host&&(d||s.port===l.port)))(new lse(Z4.origin),Z4.navigator&&/(msie|trident)/i.test(Z4.navigator.userAgent)):()=>!0,WPe=Z4.hasStandardBrowserEnv?{write(s,d,l,f,b,k){const B=[s+"="+encodeURIComponent(d)];c5.isNumber(l)&&B.push("expires="+new Date(l).toGMTString()),c5.isString(f)&&B.push("path="+f),c5.isString(b)&&B.push("domain="+b),k===!0&&B.push("secure"),document.cookie=B.join("; ")},read(s){const d=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function JEe(s,d){return s&&!function(l){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(l)}(d)?function(l,f){return f?l.replace(/\/?\/$/,"")+"/"+f.replace(/^\/+/,""):l}(s,d):d}function XEe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}const QEe=s=>s instanceof XY?function(d){for(var l=1;l<arguments.length;l++){var f=arguments[l]!=null?arguments[l]:{};l%2?XEe(Object(f),!0).forEach(function(b){cH(d,b,f[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):XEe(Object(f)).forEach(function(b){Object.defineProperty(d,b,Object.getOwnPropertyDescriptor(f,b))})}return d}({},s):s;function pQ(s,d){d=d||{};const l={};function f(uN,lN,_N,TN){return c5.isPlainObject(uN)&&c5.isPlainObject(lN)?c5.merge.call({caseless:TN},uN,lN):c5.isPlainObject(lN)?c5.merge({},lN):c5.isArray(lN)?lN.slice():lN}function b(uN,lN,_N,TN){return c5.isUndefined(lN)?c5.isUndefined(uN)?void 0:f(void 0,uN,0,TN):f(uN,lN,0,TN)}function k(uN,lN){if(!c5.isUndefined(lN))return f(void 0,lN)}function B(uN,lN){return c5.isUndefined(lN)?c5.isUndefined(uN)?void 0:f(void 0,uN):f(void 0,lN)}function Wt(uN,lN,_N){return _N in d?f(uN,lN):_N in s?f(void 0,uN):void 0}const $O={url:k,method:k,data:k,baseURL:B,transformRequest:B,transformResponse:B,paramsSerializer:B,timeout:B,timeoutMessage:B,withCredentials:B,withXSRFToken:B,adapter:B,responseType:B,xsrfCookieName:B,xsrfHeaderName:B,onUploadProgress:B,onDownloadProgress:B,decompress:B,maxContentLength:B,maxBodyLength:B,beforeRedirect:B,transport:B,httpAgent:B,httpsAgent:B,cancelToken:B,socketPath:B,responseEncoding:B,validateStatus:Wt,headers:(uN,lN,_N)=>b(QEe(uN),QEe(lN),0,!0)};return c5.forEach(Object.keys(Object.assign({},s,d)),function(uN){const lN=$O[uN]||b,_N=lN(s[uN],d[uN],uN);c5.isUndefined(_N)&&lN!==Wt||(l[uN]=_N)}),l}var ZEe=s=>{const d=pQ({},s);let l,{data:f,withXSRFToken:b,xsrfHeaderName:k,xsrfCookieName:B,headers:Wt,auth:$O}=d;if(d.headers=Wt=XY.from(Wt),d.url=f_e(JEe(d.baseURL,d.url),s.params,s.paramsSerializer),$O&&Wt.set("Authorization","Basic "+btoa(($O.username||"")+":"+($O.password?unescape(encodeURIComponent($O.password)):""))),c5.isFormData(f)){if(Z4.hasStandardBrowserEnv||Z4.hasStandardBrowserWebWorkerEnv)Wt.setContentType(void 0);else if((l=Wt.getContentType())!==!1){const[uN,...lN]=l?l.split(";").map(_N=>p4(_N).call(_N)).filter(Boolean):[];Wt.setContentType([uN||"multipart/form-data",...lN].join("; "))}}if(Z4.hasStandardBrowserEnv&&(b&&c5.isFunction(b)&&(b=b(d)),b||b!==!1&&GPe(d.url))){const uN=k&&B&&WPe.read(B);uN&&Wt.set(k,uN)}return d},HPe=typeof XMLHttpRequest<"u"&&function(s){return new u5(function(d,l){const f=ZEe(s);let b=f.data;const k=XY.from(f.headers).normalize();let B,Wt,$O,uN,lN,{responseType:_N,onUploadProgress:TN,onDownloadProgress:vN}=f;function uH(){uN&&uN(),lN&&lN(),f.cancelToken&&f.cancelToken.unsubscribe(B),f.signal&&f.signal.removeEventListener("abort",B)}let rH=new XMLHttpRequest;function iH(){if(!rH)return;const hH=XY.from("getAllResponseHeaders"in rH&&rH.getAllResponseHeaders());KEe(function(bH){d(bH),uH()},function(bH){l(bH),uH()},{data:_N&&_N!=="text"&&_N!=="json"?rH.response:rH.responseText,status:rH.status,statusText:rH.statusText,headers:hH,config:s,request:rH}),rH=null}rH.open(f.method.toUpperCase(),f.url,!0),rH.timeout=f.timeout,"onloadend"in rH?rH.onloadend=iH:rH.onreadystatechange=function(){rH&&rH.readyState===4&&(rH.status!==0||rH.responseURL&&rH.responseURL.indexOf("file:")===0)&&setTimeout(iH)},rH.onabort=function(){rH&&(l(new R6("Request aborted",R6.ECONNABORTED,s,rH)),rH=null)},rH.onerror=function(){l(new R6("Network Error",R6.ERR_NETWORK,s,rH)),rH=null},rH.ontimeout=function(){let hH=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded";const bH=f.transitional||E_e;f.timeoutErrorMessage&&(hH=f.timeoutErrorMessage),l(new R6(hH,bH.clarifyTimeoutError?R6.ETIMEDOUT:R6.ECONNABORTED,s,rH)),rH=null},b===void 0&&k.setContentType(null),"setRequestHeader"in rH&&c5.forEach(k.toJSON(),function(hH,bH){rH.setRequestHeader(bH,hH)}),c5.isUndefined(f.withCredentials)||(rH.withCredentials=!!f.withCredentials),_N&&_N!=="json"&&(rH.responseType=f.responseType),vN&&([$O,lN]=Use(vN,!0),rH.addEventListener("progress",$O)),TN&&rH.upload&&([Wt,uN]=Use(TN),rH.upload.addEventListener("progress",Wt),rH.upload.addEventListener("loadend",uN)),(f.cancelToken||f.signal)&&(B=hH=>{rH&&(l(!hH||hH.type?new C$(null,s,rH):hH),rH.abort(),rH=null)},f.cancelToken&&f.cancelToken.subscribe(B),f.signal&&(f.signal.aborted?B():f.signal.addEventListener("abort",B)));const lH=function(hH){const bH=/^([-+\w]{1,25})(:?\/\/|:)/.exec(hH);return bH&&bH[1]||""}(f.url);lH&&Z4.protocols.indexOf(lH)===-1?l(new R6("Unsupported protocol "+lH+":",R6.ERR_BAD_REQUEST,s)):rH.send(b||null)})},qPe=(s,d)=>{const{length:l}=s=s?s.filter(Boolean):[];if(d||l){let f,b=new AbortController;const k=function(uN){if(!f){f=!0,Wt();const lN=uN instanceof Error?uN:this.reason;b.abort(lN instanceof R6?lN:new C$(lN instanceof Error?lN.message:lN))}};let B=d&&setTimeout(()=>{B=null,k(new R6("timeout ".concat(d," of ms exceeded"),R6.ETIMEDOUT))},d);const Wt=()=>{s&&(B&&clearTimeout(B),B=null,s.forEach(uN=>{uN.unsubscribe?uN.unsubscribe(k):uN.removeEventListener("abort",k)}),s=null)};s.forEach(uN=>uN.addEventListener("abort",k));const{signal:$O}=b;return $O.unsubscribe=()=>c5.asap(Wt),$O}},ede=h(Vhe),$Ee=S$.f("asyncIterator"),KPe=h($Ee);function tde(s,d){this.v=s,this.k=d}function hne(s){var d,l;function f(k,B){try{var Wt=s[k](B),$O=Wt.value,uN=$O instanceof tde;ede.resolve(uN?$O.v:$O).then(function(lN){if(uN){var _N=k==="return"?"return":"next";if(!$O.k||lN.done)return f(_N,lN);lN=s[_N](lN).value}b(Wt.done?"return":"normal",lN)},function(lN){f("throw",lN)})}catch(lN){b("throw",lN)}}function b(k,B){switch(k){case"return":d.resolve({value:B,done:!0});break;case"throw":d.reject(B);break;default:d.resolve({value:B,done:!1})}(d=d.next)?f(d.key,d.arg):l=null}this._invoke=function(k,B){return new ede(function(Wt,$O){var uN={key:k,arg:B,resolve:Wt,reject:$O,next:null};l?l=l.next=uN:(d=l=uN,f(k,B))})},typeof s.return!="function"&&(this.return=void 0)}function H8(s){return function(){return new hne(s.apply(this,arguments))}}function i6(s){return new tde(s,0)}function xse(s){var d={},l=!1;function f(b,k){return l=!0,{done:!1,value:new tde(k=new ede(function(B){B(s[b](k))}),1)}}return d[v$!==void 0&&wEe||"@@iterator"]=function(){return this},d.next=function(b){return l?(l=!1,b):f("next",b)},typeof s.throw=="function"&&(d.throw=function(b){if(l)throw l=!1,b;return f("throw",b)}),typeof s.return=="function"&&(d.return=function(b){return l?(l=!1,b):f("return",b)}),d}hne.prototype[typeof v$=="function"&&KPe||"@@asyncIterator"]=function(){return this},hne.prototype.next=function(s){return this._invoke("next",s)},hne.prototype.throw=function(s){return this._invoke("throw",s)},hne.prototype.return=function(s){return this._invoke("return",s)};var nde=h($Ee);function rde(s){var d,l,f,b=2;for(typeof Symbol<"u"&&(l=nde,f=Symbol.iterator);b--;){if(l&&(d=s[l])!=null)return d.call(s);if(f&&(d=s[f])!=null)return new Vse(d.call(s));l="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}function Vse(s){function d(l){if(Object(l)!==l)return u5.reject(new TypeError(l+" is not an object."));var f=l.done;return u5.resolve(l.value).then(function(b){return{value:b,done:f}})}return Vse=function(l){this.s=l,this.n=l.next},Vse.prototype={s:null,n:null,next:function(){return d(this.n.apply(this.s,arguments))},return:function(l){var f=this.s.return;return f===void 0?u5.resolve({value:l,done:!0}):d(f.apply(this.s,arguments))},throw:function(l){var f=this.s.return;return f===void 0?u5.reject(l):d(f.apply(this.s,arguments))}},new Vse(s)}const zPe=function*(s,d){let l=s.byteLength;if(!d||l<d)return void(yield s);let f,b=0;for(;b<l;)f=b+d,yield s.slice(b,f),b=f},YPe=function(){var s=H8(function*(d,l){var f,b=!1,k=!1;try{for(var B,Wt=rde(JPe(d));b=!(B=yield i6(Wt.next())).done;b=!1){const $O=B.value;yield*xse(rde(zPe($O,l)))}}catch($O){k=!0,f=$O}finally{try{b&&Wt.return!=null&&(yield i6(Wt.return()))}finally{if(k)throw f}}});return function(d,l){return s.apply(this,arguments)}}(),JPe=function(){var s=H8(function*(d){if(d[nde])return void(yield*xse(rde(d)));const l=d.getReader();try{for(;;){const{done:f,value:b}=yield i6(l.read());if(f)break;yield b}}finally{yield i6(l.cancel())}});return function(d){return s.apply(this,arguments)}}(),eme=(s,d,l,f)=>{const b=YPe(s,d);let k,B=0,Wt=$O=>{k||(k=!0,f&&f($O))};return new ReadableStream({async pull($O){try{const{done:uN,value:lN}=await b.next();if(uN)return Wt(),void $O.close();let _N=lN.byteLength;if(l){let TN=B+=_N;l(TN)}$O.enqueue(new Uint8Array(lN))}catch(uN){throw Wt(uN),uN}},cancel:$O=>(Wt($O),b.return())},{highWaterMark:2})};function tme(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function nme(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?tme(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):tme(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const Fse=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",rme=Fse&&typeof ReadableStream=="function",XPe=Fse&&(typeof TextEncoder=="function"?(ime=new TextEncoder,s=>ime.encode(s)):async s=>new Uint8Array(await new Response(s).arrayBuffer()));var ime;const sme=function(s){try{for(var d=arguments.length,l=new Array(d>1?d-1:0),f=1;f<d;f++)l[f-1]=arguments[f];return!!s(...l)}catch{return!1}},QPe=rme&&sme(()=>{let s=!1;const d=new Request(Z4.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!d}),ide=rme&&sme(()=>c5.isReadableStream(new Response("").body)),jse={stream:ide&&(s=>s.body)};var ome;Fse&&(ome=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!jse[s]&&(jse[s]=c5.isFunction(ome[s])?d=>d[s]():(d,l)=>{throw new R6("Response type '".concat(s,"' is not supported"),R6.ERR_NOT_SUPPORT,l)})}));const ZPe=async(s,d)=>{const l=c5.toFiniteNumber(s.getContentLength());return l??(async f=>f==null?0:c5.isBlob(f)?f.size:c5.isSpecCompliantForm(f)?(await new Request(Z4.origin,{method:"POST",body:f}).arrayBuffer()).byteLength:c5.isArrayBufferView(f)||c5.isArrayBuffer(f)?f.byteLength:(c5.isURLSearchParams(f)&&(f+=""),c5.isString(f)?(await XPe(f)).byteLength:void 0))(d)};var $Pe=Fse&&(async s=>{let{url:d,method:l,data:f,signal:b,cancelToken:k,timeout:B,onDownloadProgress:Wt,onUploadProgress:$O,responseType:uN,headers:lN,withCredentials:_N="same-origin",fetchOptions:TN}=ZEe(s);uN=uN?(uN+"").toLowerCase():"text";let vN,uH=qPe([b,k&&k.toAbortSignal()],B);const rH=uH&&uH.unsubscribe&&(()=>{uH.unsubscribe()});let iH;try{if($O&&QPe&&l!=="get"&&l!=="head"&&(iH=await ZPe(lN,f))!==0){let OH,wH=new Request(d,{method:"POST",body:f,duplex:"half"});if(c5.isFormData(f)&&(OH=wH.headers.get("content-type"))&&lN.setContentType(OH),wH.body){const[BH,XH]=zEe(iH,Use(YEe($O)));f=eme(wH.body,65536,BH,XH)}}c5.isString(_N)||(_N=_N?"include":"omit");const lH="credentials"in Request.prototype;vN=new Request(d,nme(nme({},TN),{},{signal:uH,method:l.toUpperCase(),headers:lN.normalize().toJSON(),body:f,duplex:"half",credentials:lH?_N:void 0}));let hH=await fetch(vN);const bH=ide&&(uN==="stream"||uN==="response");if(ide&&(Wt||bH&&rH)){const OH={};["status","statusText","headers"].forEach(d5=>{OH[d5]=hH[d5]});const wH=c5.toFiniteNumber(hH.headers.get("content-length")),[BH,XH]=Wt&&zEe(wH,Use(YEe(Wt),!0))||[];hH=new Response(eme(hH.body,65536,BH,()=>{XH&&XH(),rH&&rH()}),OH)}uN=uN||"text";let PH=await jse[c5.findKey(jse,uN)||"text"](hH,s);return!bH&&rH&&rH(),await new u5((OH,wH)=>{KEe(OH,wH,{data:PH,headers:XY.from(hH.headers),status:hH.status,statusText:hH.statusText,config:s,request:vN})})}catch(lH){throw rH&&rH(),lH&&lH.name==="TypeError"&&/fetch/i.test(lH.message)?Object.assign(new R6("Network Error",R6.ERR_NETWORK,s,vN),{cause:lH.cause||lH}):R6.from(lH,lH&&lH.code,s,vN)}});const ame={http:null,xhr:HPe,fetch:$Pe};c5.forEach(ame,(s,d)=>{if(s){try{Object.defineProperty(s,"name",{value:d})}catch{}Object.defineProperty(s,"adapterName",{value:d})}});const cme=s=>"- ".concat(s),eDe=s=>c5.isFunction(s)||s===null||s===!1;var ume=s=>{s=c5.isArray(s)?s:[s];const{length:d}=s;let l,f;const b={};for(let k=0;k<d;k++){let B;if(l=s[k],f=l,!eDe(l)&&(f=ame[(B=String(l)).toLowerCase()],f===void 0))throw new R6("Unknown adapter '".concat(B,"'"));if(f)break;b[B||"#"+k]=f}if(!f){const k=Object.entries(b).map(B=>{let[Wt,$O]=B;return"adapter ".concat(Wt," ")+($O===!1?"is not supported by the environment":"is not available in the build")});throw new R6("There is no suitable adapter to dispatch the request "+(d?k.length>1?`since :
`+k.map(cme).join(`
`):" "+cme(k[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return f};function sde(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new C$(null,s)}function dme(s){return sde(s),s.headers=XY.from(s.headers),s.data=$ue.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),ume(s.adapter||Que.adapter)(s).then(function(d){return sde(s),d.data=$ue.call(s,s.transformResponse,d),d.headers=XY.from(d.headers),d},function(d){return qEe(d)||(sde(s),d&&d.response&&(d.response.data=$ue.call(s,s.transformResponse,d.response),d.response.headers=XY.from(d.response.headers))),u5.reject(d)})}const tDe="1.7.9",Bse={};["object","boolean","number","function","string","symbol"].forEach((s,d)=>{Bse[s]=function(l){return typeof l===s||"a"+(d<1?"n ":" ")+s}});const lme={};Bse.transitional=function(s,d,l){function f(b,k){return"[Axios v1.7.9] Transitional option '"+b+"'"+k+(l?". "+l:"")}return(b,k,B)=>{if(s===!1)throw new R6(f(k," has been removed"+(d?" in "+d:"")),R6.ERR_DEPRECATED);return d&&!lme[k]&&(lme[k]=!0,console.warn(f(k," has been deprecated since v"+d+" and will be removed in the near future"))),!s||s(b,k,B)}},Bse.spelling=function(s){return(d,l)=>(console.warn("".concat(l," is likely a misspelling of ").concat(s)),!0)};var Gse={assertOptions:function(s,d,l){if(typeof s!="object")throw new R6("options must be an object",R6.ERR_BAD_OPTION_VALUE);const f=Object.keys(s);let b=f.length;for(;b-- >0;){const k=f[b],B=d[k];if(B){const Wt=s[k],$O=Wt===void 0||B(Wt,k,s);if($O!==!0)throw new R6("option "+k+" must be "+$O,R6.ERR_BAD_OPTION_VALUE)}else if(l!==!0)throw new R6("Unknown option "+k,R6.ERR_BAD_OPTION)}},validators:Bse};const MJ=Gse.validators;let Wse=class{constructor(s){this.defaults=s,this.interceptors={request:new __e,response:new __e}}async request(s,d){try{return await this._request(s,d)}catch(l){if(l instanceof Error){let f={};Error.captureStackTrace?Error.captureStackTrace(f):f=new Error;const b=f.stack?f.stack.replace(/^.+\n/,""):"";try{l.stack?b&&!String(l.stack).endsWith(b.replace(/^.+\n.+\n/,""))&&(l.stack+=`
`+b):l.stack=b}catch{}}throw l}}_request(s,d){typeof s=="string"?(d=d||{}).url=s:d=s||{},d=pQ(this.defaults,d);const{transitional:l,paramsSerializer:f,headers:b}=d;l!==void 0&&Gse.assertOptions(l,{silentJSONParsing:MJ.transitional(MJ.boolean),forcedJSONParsing:MJ.transitional(MJ.boolean),clarifyTimeoutError:MJ.transitional(MJ.boolean)},!1),f!=null&&(c5.isFunction(f)?d.paramsSerializer={serialize:f}:Gse.assertOptions(f,{encode:MJ.function,serialize:MJ.function},!0)),Gse.assertOptions(d,{baseUrl:MJ.spelling("baseURL"),withXsrfToken:MJ.spelling("withXSRFToken")},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();let k=b&&c5.merge(b.common,b[d.method]);b&&c5.forEach(["delete","get","head","post","put","patch","common"],vN=>{delete b[vN]}),d.headers=XY.concat(k,b);const B=[];let Wt=!0;this.interceptors.request.forEach(function(vN){typeof vN.runWhen=="function"&&vN.runWhen(d)===!1||(Wt=Wt&&vN.synchronous,B.unshift(vN.fulfilled,vN.rejected))});const $O=[];let uN;this.interceptors.response.forEach(function(vN){$O.push(vN.fulfilled,vN.rejected)});let lN,_N=0;if(!Wt){const vN=[dme.bind(this),void 0];for(vN.unshift.apply(vN,B),vN.push.apply(vN,$O),lN=vN.length,uN=u5.resolve(d);_N<lN;)uN=uN.then(vN[_N++],vN[_N++]);return uN}lN=B.length;let TN=d;for(_N=0;_N<lN;){const vN=B[_N++],uH=B[_N++];try{TN=vN(TN)}catch(rH){uH.call(this,rH);break}}try{uN=dme.call(this,TN)}catch(vN){return u5.reject(vN)}for(_N=0,lN=$O.length;_N<lN;)uN=uN.then($O[_N++],$O[_N++]);return uN}getUri(s){return f_e(JEe((s=pQ(this.defaults,s)).baseURL,s.url),s.params,s.paramsSerializer)}};c5.forEach(["delete","get","head","options"],function(s){Wse.prototype[s]=function(d,l){return this.request(pQ(l||{},{method:s,url:d,data:(l||{}).data}))}}),c5.forEach(["post","put","patch"],function(s){function d(l){return function(f,b,k){return this.request(pQ(k||{},{method:s,headers:l?{"Content-Type":"multipart/form-data"}:{},url:f,data:b}))}}Wse.prototype[s]=d(),Wse.prototype[s+"Form"]=d(!0)});var Hse=Wse;class ode{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let l;this.promise=new u5(function(b){l=b});const f=this;this.promise.then(b=>{if(!f._listeners)return;let k=f._listeners.length;for(;k-- >0;)f._listeners[k](b);f._listeners=null}),this.promise.then=b=>{let k;const B=new u5(Wt=>{f.subscribe(Wt),k=Wt}).then(b);return B.cancel=function(){f.unsubscribe(k)},B},d(function(b,k,B){f.reason||(f.reason=new C$(b,k,B),l(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){this.reason?d(this.reason):this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const l=this._listeners.indexOf(d);l!==-1&&this._listeners.splice(l,1)}toAbortSignal(){const d=new AbortController,l=f=>{d.abort(f)};return this.subscribe(l),d.signal.unsubscribe=()=>this.unsubscribe(l),d.signal}static source(){let d;return{token:new ode(function(f){d=f}),cancel:d}}}var nDe=ode;const ade={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ade).forEach(s=>{let[d,l]=s;ade[l]=d});var rDe=ade;const u4=function s(d){const l=new Hse(d),f=Xfe(Hse.prototype.request,l);return c5.extend(f,Hse.prototype,l,{allOwnKeys:!0}),c5.extend(f,l,null,{allOwnKeys:!0}),f.create=function(b){return s(pQ(d,b))},f}(Que);u4.Axios=Hse,u4.CanceledError=C$,u4.CancelToken=nDe,u4.isCancel=qEe,u4.VERSION=tDe,u4.toFormData=bse,u4.AxiosError=R6,u4.Cancel=u4.CanceledError,u4.all=function(s){return u5.all(s)},u4.spread=function(s){return function(d){return s.apply(null,d)}},u4.isAxiosError=function(s){return c5.isObject(s)&&s.isAxiosError===!0},u4.mergeConfig=pQ,u4.AxiosHeaders=XY,u4.formToJSON=s=>WEe(c5.isHTMLForm(s)?new FormData(s):s),u4.getAdapter=ume,u4.HttpStatusCode=rDe,u4.default=u4;var F4=u4;const iDe=()=>{};function pne(){const s={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:iDe};return s.promise=new u5((d,l)=>{s.resolve=f=>{s.isFinished||(s.isResolved=!0,s.isFinished=!0,d(f),s.value=f)},s.reject=f=>{s.isFinished||(s.isRejected=!0,s.isFinished=!0,l(f))}}),s}const qse=new Map,Kse=new Map,UJ=new Map;let AK=function(s){return s.WIN_10="Windows 10",s.WIN_81="Windows 8.1",s.WIN_8="Windows 8",s.WIN_7="Windows 7",s.WIN_VISTA="Windows Vista",s.WIN_SERVER_2003="Windows Server 2003",s.WIN_XP="Windows XP",s.WIN_2000="Windows 2000",s.ANDROID="Android",s.HARMONY_OS="HarmonyOS",s.OPEN_BSD="Open BSD",s.SUN_OS="Sun OS",s.LINUX="Linux",s.IOS="iOS",s.MAC_OS="Mac OS",s.CHROMIUM_OS="Chromium OS",s.QNX="QNX",s.UNIX="UNIX",s.BEOS="BeOS",s.OS_2="OS/2",s.SEARCH_BOT="Search Bot",s}({}),p6=function(s){return s.CHROME="Chrome",s.SAFARI="Safari",s.EDGE="Edge",s.FIREFOX="Firefox",s.OPERA="OPR",s.QQ="QQBrowser",s.WECHAT="MicroMessenger",s}({});const hme=new IAe;let QY=hme.getResult(),cde=null;function c6(s){if(!cde){QY=hme.getResult();const d=function(Wt){if(Wt.engine.name==="Blink"&&Wt.browser.name!=="WeChat")return p6.CHROME;switch(Wt.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return p6.CHROME;case"Safari":case"Mobile Safari":return p6.SAFARI;case"Edge":return p6.EDGE;case"Firefox":return p6.FIREFOX;case"QQ":case"QQBrowser":return p6.QQ;case"Opera":return p6.OPERA;case"WeChat":return p6.WECHAT;default:return Wt.browser.name||""}}(QY),l=pme(QY),f=function(Wt){return Wt.os.name==="Windows"?Wt.os.version?Wt.os.name+" "+Wt.os.version:Wt.os.name:Wt.os.name||""}(QY),b=QY.os.version,k=pme(QY,!1),B=QY.device.type;if(!(d&&l&&f&&b))return{name:d,version:l,os:f,osVersion:b,browserVersion:k,deviceType:B};cde={name:d,version:l,os:f,osVersion:b,browserVersion:k,deviceType:B}}return cde}function pme(s){let d,l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return d=s.engine.name==="Blink"?s.engine.version||"":s.browser.version||"",l?d.split(".")[0]:d}function zse(){return c6().os}function fme(){const s=c6();return"".concat(s.os," ").concat(s.osVersion)}function Yse(){const s=c6();return!!(QY.engine.name==="WebKit"&&s.os===AK.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&s.name!==p6.SAFARI||I4()&&s.name!==p6.SAFARI)}function w7(){return c6().name===p6.CHROME}function KK(){return c6().name===p6.SAFARI}function _me(){return c6().name===p6.EDGE}function Z6(){return c6().name===p6.FIREFOX}function I4(){return c6().os===AK.IOS}function I$(s){const d=c6();return!(d.name!==p6.CHROME||!d.osVersion)&&Number(d.version)>=s}function Eme(s){const d=c6();return!(d.name!==p6.CHROME||!d.osVersion)&&Number(d.version)<s}function ude(s,d,l){const f=c6();return!(f.name!==s||!f.osVersion)&&(l?Number(f.version)>=d&&Number(f.version)<=l:Number(f.version)===d)}function dde(s){const d=c6();return!(d.name!==p6.EDGE||!d.osVersion)&&Number(d.version)>=s}function mme(s){const d=c6();return!(d.name!==p6.SAFARI||!d.osVersion)&&Number(d.version)>=s}function gme(s,d,l){const f=c6();if(f.os!==AK.IOS||!f.osVersion)return!1;const b=f.osVersion.split(".");return l?d&&Number(b[0])===s&&Number(b[1])<d||Number(b[0])<s:d?Number(b[0])===s&&Number(b[1])<=d||Number(b[0])<s:Number(b[0])<=s}function Tme(s,d,l){const f=c6();if(f.name!==p6.SAFARI||!f.osVersion||!f.browserVersion)return!1;const b=f.browserVersion.split(".");return l?d&&Number(b[0])===s&&Number(b[1])<d||Number(b[0])<s:d?Number(b[0])===s&&Number(b[1])<=d||Number(b[0])<s:Number(b[0])<=s}function lde(s){const d=c6();return!(d.name!==p6.OPERA||!d.osVersion)&&Number(d.version)>=s}function Sme(){const s=c6();if(s.os!==AK.IOS||!s.osVersion)return!1;const d=s.osVersion.split(".");return Number(d[0])<14||Number(d[0])===14&&Number(d[1])<=6}function w$(){const s=c6();if(s.os!==AK.IOS||!s.osVersion)return!1;const d=s.osVersion.split(".");return Number(d[0])===15}function hde(){const s=c6();if(s.os!==AK.IOS||!s.osVersion)return!1;const d=s.osVersion.split(".");return Number(d[0])===16}function yme(){const s=c6();if(s.os!==AK.IOS||!s.osVersion)return!1;const d=s.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=1}function EY(){return KK()&&navigator.maxTouchPoints>0}function Rme(){return c6().name===p6.WECHAT}function bme(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function pde(){const s=zse();return function(){const{deviceType:d}=c6();return d==="mobile"||d==="tablet"}()||s===AK.ANDROID||s===AK.IOS||s===AK.HARMONY_OS}function A7(){const s=c6();return s.name!==p6.EDGE&&s.name!==p6.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Jse(){return zse()===AK.ANDROID}function fne(){const s=c6();return Jse()&&(s.name===p6.CHROME||s.name===p6.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function D5(s,d,l){return(d=function(f){var b=function(k){if(typeof k!="object"||!k)return k;var B=k[Symbol.toPrimitive];if(B!==void 0){var Wt=B.call(k,"string");if(typeof Wt!="object")return Wt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(k)}(f);return typeof b=="symbol"?b:b+""}(d))in s?Object.defineProperty(s,d,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[d]=l,s}function vme(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function f5(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?vme(Object(l),!0).forEach(function(f){D5(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):vme(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}let dH=function(s){return s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_READABLE="NOT_READABLE",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",s.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",s.DATACHANNEL_FAILED="DATACHANNEL_FAILED",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",s.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",s.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",s.TOKEN_EXPIRE="TOKEN_EXPIRE",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",s.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",s.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",s.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",s.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",s.INVALID_PLUGIN="INVALID_PLUGIN",s.DISCONNECT_P2P="DISCONNECT_P2P",s.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",s.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",s.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",s.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",s.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",s.PROHIBITED_OPERATION="PROHIBITED_OPERATION",s.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",s.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",s}({});class jH extends Error{constructor(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",f=arguments.length>2?arguments[2]:void 0;super(l),D5(this,"code",void 0),D5(this,"message",void 0),D5(this,"data",void 0),D5(this,"name","AgoraRTCException"),this.code=d,this.message="AgoraRTCError ".concat(this.code,": ").concat(l),this.data=f}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",l=arguments.length>1?arguments[1]:void 0;return d==="error"&&(l||console).error(this.toString()),d==="warning"&&(l||console).warn(this.toString()),this}throw(d){throw this.print("error",d),this}}function O7(s,d){if(typeof s!="boolean")throw new jH(dH.INVALID_PARAMS,"Invalid ".concat(d,": The value is of the boolean type."))}function vK(s,d,l){if(!a5(l).call(l,s))throw new jH(dH.INVALID_PARAMS,"".concat(d," can only be set as ").concat(JSON.stringify(l)))}function b6(s,d){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(s<l||s>f||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(b){return typeof b=="number"&&b%1==0}(s))throw new jH(dH.INVALID_PARAMS,"invalid ".concat(d,": the value range is [").concat(l,", ").concat(f,"]. integer only"))}function fde(s,d){if(typeof s!="number"){if(!(s.min||s.max||s.ideal||s.exact))throw new jH(dH.INVALID_PARAMS,"".concat(d," is not a valid ConstrainLong"));s.min!==void 0&&b6(s.min,"".concat(d,".min"),0,1/0),s.max!==void 0&&b6(s.max,"".concat(d,".max"),1,1/0),s.exact!==void 0&&b6(s.exact,"".concat(d,".exact"),1,1/0),s.ideal!==void 0&&b6(s.ideal,"".concat(d,".ideal"),1,1/0)}else b6(s,d,1,1/0)}function jK(s,d){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,b=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(s==null)throw new jH(dH.INVALID_PARAMS,"".concat(d||"param"," cannot be empty"));if(!Cme(s,l,f,b))throw new jH(dH.INVALID_PARAMS,"Invalid ".concat(d||"string param",": Length of the string: [").concat(l,",").concat(f,"].").concat(b?" ASCII characters only.":""))}function N7(s,d){if(!Array.isArray(s))throw new jH(dH.INVALID_PARAMS,"".concat(d," should be an array"))}function z6(s){return s==null}function Cme(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,f=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof s=="string"&&s.length<=l&&s.length>=d&&(!f||function(b){if(typeof b!="string")return!1;for(let k=0;k<b.length;k+=1){const B=b.charCodeAt(k);if(B<0||B>255)return!1}return!0}(s))}var _ne=function(s){return s.COVERED="COVERED",s.POSITION="POSITION",s.SIZE="SIZE",s.STYLE="STYLE",s}(_ne||{}),_de=function(s){return s.UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",s}(_de||{});const Ime=new class{constructor(){D5(this,"_clientSize",null),D5(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),D5(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),D5(this,"getStyle",s=>window.getComputedStyle(s,null)),D5(this,"checkCssVisibleProperty",s=>{var d;let l=!0;const f=this.getStyle(s),{display:b,visibility:k,opacity:B,filter:Wt}=f;return(b==="none"||a5(d=["hidden","collapse"]).call(d,k)||Number(B)<.1)&&(l=!1),!!l&&(Wt&&Wt.split(" ").filter($O=>{var uN;const lN=$O.split("(")[0];return a5(uN=["brightness","blur","opacity"]).call(uN,lN)}).map($O=>{const[uN,lN]=$O.split(/\(|\)/);return[uN,Number(lN.match(/^[0-9\.]+/))]}).forEach($O=>{const[uN,lN]=$O;switch(uN){case"brightness":(lN<.1||lN>3)&&(l=!1);break;case"blur":lN>3&&(l=!1);break;case"opacity":lN<.1&&(l=!1)}}),l)}),D5(this,"checkPropertyUpToAllParentNodes",(s,d)=>{let l=!0,f=!0;const b=B=>d(B);let k=s;for(;k&&f;)b(k)||(l=!1,f=!1),k=k.parentElement,k||(f=!1);return l}),D5(this,"checkActualCssVisibleIncludeInherit",s=>this.checkPropertyUpToAllParentNodes(s,this.checkCssVisibleProperty)),D5(this,"getSizeAboutClient",s=>{const{width:d,height:l,left:f,right:b,top:k,bottom:B}=s.getBoundingClientRect(),Wt=this.getClientWidth(),$O=this.getClientHeight();return{width:d,height:l,left:f,right:b,top:k,bottom:B,clientWidth:Wt,clientHeight:$O,clientMin:Math.min(Wt,$O)}}),D5(this,"checkActualSize",()=>{const{width:s,height:d,clientMin:l}=this._clientSize;return this.checkSizeIsVisible(s,d,l)}),D5(this,"elementFromPoint",(s,d)=>document.elementFromPoint?document.elementFromPoint(s,d):null),D5(this,"checkCoverForAPoint",(s,d,l)=>{const f=this.elementFromPoint(s,d);return f!==null&&f!==l}),D5(this,"getPointPositionList",()=>{const{width:s,height:d,left:l,top:f}=this._clientSize,b=s/6,k=d/6,B=[],Wt=10**6;for(let $O=0;$O<5;$O++)for(let uN=0;uN<5;uN++){const lN=(l*Wt+($O===0?.1:$O===4?(b*$O*Wt-1e5)/Wt:b*$O)*Wt)/Wt,_N=(f*Wt+(uN===0?.1:uN===4?(k*uN*Wt-1e5)/Wt:k*uN)*Wt)/Wt;B.push({x:lN,y:_N})}return[...B]}),D5(this,"checkElementCover",s=>this.getPointPositionList().map(d=>this.checkCoverForAPoint(d.x,d.y,s)).filter(d=>!!d).length>6),D5(this,"checkSizeIsVisible",(s,d,l)=>(s>50||l/s<=10)&&(d>50||l/d<=10)),D5(this,"checkSizeOfPartInClient",()=>{const{left:s,right:d,top:l,bottom:f,clientHeight:b,clientWidth:k,clientMin:B}=this._clientSize;let Wt,$O,uN,lN;if(s<0)Wt=0;else{if(!(s<k))return!1;Wt=s}if(d<0)return!1;if($O=d<k?d:k,l<0)uN=0;else{if(!(l<b))return!1;uN=l}if(f<0)return!1;lN=f<b?f:b;const _N=$O-Wt,TN=lN-uN;return this.checkSizeIsVisible(_N,TN,B)}),D5(this,"returnHiddenResult",s=>(this._clientSize=null,{visible:!1,reason:s})),D5(this,"checkOneElementVisible",s=>{if(s instanceof HTMLElement){if(this.checkElementIsMountedOnDom(s)){if(this.checkActualCssVisibleIncludeInherit(s)){if(this._clientSize=this.getSizeAboutClient(s),this.checkElementCover(s))return this.returnHiddenResult(_ne.COVERED);{const d=this.checkActualSize(),l=this.checkSizeOfPartInClient();return d&&!l?this.returnHiddenResult(_ne.POSITION):d?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(_ne.SIZE)}}return this.returnHiddenResult(_ne.STYLE)}return this.returnHiddenResult(_de.UNMOUNTED)}return this.returnHiddenResult(_de.INVALID_HTML_ELEMENT)}),D5(this,"checkElementIsMountedOnDom",s=>this.checkPropertyUpToAllParentNodes(s,d=>d.nodeName.toUpperCase()!=="HTML"?d.parentElement!==null:!!document.documentElement))}};function Ede(s){return new TextEncoder().encode(s)}const wme=function(s,d){const l=new Uint8Array(s.byteLength+d.byteLength);return l.set(new Uint8Array(s),0),l.set(new Uint8Array(d),s.byteLength),l},mde=async s=>function(d,l){let f="";return new Uint8Array(d).forEach(b=>{f+=b.toString(l).padStart(2,"0")}),f}(await crypto.subtle.digest("SHA-256",Ede(s)),16);let W6=class{constructor(){D5(this,"_events",{}),D5(this,"addListener",this.on)}getListeners(s){return this._events[s]?this._events[s].map(d=>d.listener):[]}on(s,d){this._events[s]||(this._events[s]=[]);const l=this._events[s];this._indexOfListener(l,d)===-1&&l.push({listener:d,once:!1})}once(s,d){this._events[s]||(this._events[s]=[]);const l=this._events[s];this._indexOfListener(l,d)===-1&&l.push({listener:d,once:!0})}off(s,d){if(!this._events[s])return;const l=this._events[s],f=this._indexOfListener(l,d);f!==-1&&l.splice(f,1),this._events[s].length===0&&delete this._events[s]}removeAllListeners(s){s?delete this._events[s]:this._events={}}emit(s){this._events[s]||(this._events[s]=[]);const d=this._events[s].map(k=>k);for(var l=arguments.length,f=new Array(l>1?l-1:0),b=1;b<l;b++)f[b-1]=arguments[b];for(let k=0;k<d.length;k+=1){const B=d[k];B.once&&this.off(s,B.listener),B.listener.apply(this,f||[])}}safeEmit(s){for(var d=arguments.length,l=new Array(d>1?d-1:0),f=1;f<d;f++)l[f-1]=arguments[f];[...this._events[s]||[]].forEach(b=>{b.once&&this.off(s,b.listener);try{b.listener.apply(this,l)}catch(k){console.error("safeEmit event:".concat(s," error ").concat(k==null?void 0:k.toString()))}})}_indexOfListener(s,d){let l=s.length;for(;l--;)if(s[l].listener===d)return l;return-1}},Ene=null;function Ame(){if(Ene)return Ene;if(window.electron)return Ene=window.electron;if(!window.require)return null;try{return Ene=window.require("electron"),Ene}catch{return null}}let _K=function(s){return s.CREATE_CLIENT="createClient",s.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",s.SET_AREA="setArea",s.PRELOAD="PRELOAD",s.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",s.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",s.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",s.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",s.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",s.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",s.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",s.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",s.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",s.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",s.START_PROXY_SERVER="Client.startProxyServer",s.STOP_PROXY_SERVER="Client.stopProxyServer",s.SET_PROXY_SERVER="Client.setProxyServer",s.SET_TURN_SERVER="Client.setTurnServer",s.SET_CLIENT_ROLE="Client.setClientRole",s.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",s.ENABLE_DUAL_STREAM="Client.enableDualStream",s.DISABLE_DUAL_STREAM="Client.disableDualStream",s.JOIN="Client.join",s.LEAVE="Client.leave",s.PUBLISH="Client.publish",s.UNPUBLISH="Client.unpublish",s.SUBSCRIBE="Client.subscribe",s.MASS_SUBSCRIBE="Client.massSubscribe",s.MASS_UNSUBSCRIBE="Client.massUnsubscribe",s.UNSUBSCRIBE="Client.unsubscribe",s.RENEW_TOKEN="Client.renewToken",s.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",s.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",s.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",s.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",s.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",s.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",s.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",s.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",s.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",s.START_LIVE_STREAMING="Client.startLiveStreaming",s.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",s.STOP_LIVE_STREAMING="Client.stopLiveStreaming",s.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",s.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",s.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",s.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",s.SET_CONFIG_DISTRIBUTE="_configDistribute",s.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",s.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",s.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",s.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",s.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",s.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",s.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",s.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",s.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",s.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",s.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",s.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",s.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",s.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",s.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",s.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",s.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",s.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",s.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",s.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",s.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",s.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",s.STREAM_TYPE_CHANGE="streamTypeChange",s.CONNECTION_STATE_CHANGE="connectionStateChange",s.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",s.IMAGE_MODERATION_UPLOAD="imageModerationUpload",s.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",s}({}),Y6=function(s){return s.TRACER="tracer",s}({});function Ome(s){return b6(s.timeout,"config.timeout",0,1e5),b6(s.timeoutFactor,"config.timeoutFactor",0,100,!1),b6(s.maxRetryCount,"config.maxRetryConfig",0,1/0),b6(s.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let sDe=function(s){return s[s.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",s[s.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",s[s.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",s}({}),_6=function(s){return s.LEAVE="LEAVE",s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.UID_BANNED="UID_BANNED",s.FALLBACK="FALLBACK",s.IP_BANNED="IP_BANNED",s.CHANNEL_BANNED="CHANNEL_BANNED",s.LICENSE_MISSING="LICENSE_MISSING",s.LICENSE_EXPIRED="LICENSE_EXPIRED",s.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",s.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",s.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",s.LICENSE_ILLEGAL="LICENSE_ILLEGAL",s.TOKEN_EXPIRE="TOKEN_EXPIRE",s}({});function mne(s){if(!Array.isArray(s)||s.length<1)return!1;try{s.forEach(d=>{if(!d.urls)throw Error()})}catch{return!1}return!0}function Nme(s){return jK(s.turnServerURL,"turnServerURL"),jK(s.username,"username"),jK(s.password,"password"),s.udpport&&b6(s.udpport,"udpport",1,99999,!0),s.forceturn&&O7(s.forceturn,"forceturn"),s.security&&O7(s.security,"security"),s.tcpport&&b6(s.tcpport,"tcpport",1,99999,!0),!0}function gde(s){return s.level!==void 0&&vK(s.level,"level",[1,2,3]),s.delay!==void 0&&b6(s.delay,"delay",0,3e3,!0),!0}let z5=function(s){return s.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",s.AUDIO_METADATA="audio-metadata",s.CONNECTION_STATE_CHANGE="connection-state-change",s.MEDIA_RECONNECT_START="media-reconnect-start",s.MEDIA_RECONNECT_END="media-reconnect-end",s.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",s.USER_JOINED="user-joined",s.USER_LEAVED="user-left",s.USER_PUBLISHED="user-published",s.USER_UNPUBLISHED="user-unpublished",s.USER_INFO_UPDATED="user-info-updated",s.CLIENT_BANNED="client-banned",s.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",s.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",s.VOLUME_INDICATOR="volume-indicator",s.CRYPT_ERROR="crypt-error",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGED="stream-type-changed",s.STREAM_FALLBACK="stream-fallback",s.RECEIVE_METADATA="receive-metadata",s.STREAM_MESSAGE="stream-message",s.LIVE_STREAMING_ERROR="live-streaming-error",s.LIVE_STREAMING_WARNING="live-streaming-warning",s.EXCEPTION="exception",s.ERROR="error",s.P2P_LOST="p2p_lost",s.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",s.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",s.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",s.PUBLISHED_USER_LIST="published-user-list",s.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",s.CONTENT_INSPECT_ERROR="content-inspect-error",s.CONTENT_INSPECT_RESULT="content-inspect-result",s.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",s}({}),zK=function(s){return s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK",s.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",s}({}),l8=function(s){return s.ONLINE="ONLINE",s.OFFLINE="OFFLINE",s}({}),A$=function(s){return s.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",s.ONLINE="ONLINE",s.OFFLINE="OFFLINE",s}({});function YK(s,d){for(var l=arguments.length,f=new Array(l>2?l-2:0),b=2;b<l;b++)f[b-2]=arguments[b];return s.getListeners(d).length===0?u5.reject(new jH(dH.UNEXPECTED_ERROR,"can not emit promise")):new u5((k,B)=>{s.emit(d,...f,k,B)})}function w6(s,d){if(s.getListeners(d).length===0)return u5.resolve();for(var l=arguments.length,f=new Array(l>2?l-2:0),b=2;b<l;b++)f[b-2]=arguments[b];return YK(s,d,...f)}function R8(s,d){if(s.getListeners(d).length===0)return null;for(var l=arguments.length,f=new Array(l>2?l-2:0),b=2;b<l;b++)f[b-2]=arguments[b];return gne(s,d,...f)}function gne(s,d){let l=null,f=null;for(var b=arguments.length,k=new Array(b>2?b-2:0),B=2;B<b;B++)k[B-2]=arguments[B];if(s.emit(d,...k,Wt=>{l=Wt},Wt=>{f=Wt}),f!==null)throw f;if(l===null)throw new jH(dH.UNEXPECTED_ERROR,"handler is not sync");return l}const uK=new class extends W6{set networkState(s){this.emit(A$.NETWORK_STATE_CHANGE,s,this._networkState),s===l8.ONLINE?this.emit(A$.ONLINE):s===l8.OFFLINE&&(this.onlineWaiter=new u5(d=>{this.once(A$.ONLINE,()=>{this.onlineWaiter=void 0,d(l8.ONLINE)})}),this.emit(A$.OFFLINE)),this._networkState=s}get networkState(){return this._networkState}get isOnline(){return this._networkState===l8.ONLINE}constructor(){super(),D5(this,"_moduleName","network-indicator"),D5(this,"_networkState",l8.ONLINE),D5(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=l8.ONLINE}),window.addEventListener("offline",()=>{this.networkState=l8.OFFLINE})}};function Xse(s,d){const l=s.indexOf(d);l!==-1&&s.splice(l,1)}function O$(s){const d=[];return s.forEach(l=>{d.indexOf(l)===-1&&d.push(l)}),d}function Qse(s){u5!==void 0?u5.resolve().then(s):setTimeout(s,0)}function $6(s){return JSON.parse(JSON.stringify(s))}function fQ(s){try{return $6(s)}catch{return s}}const Pme={};function LX(s,d){Pme[d]||(Pme[d]=!0,s())}function _Q(s){const d=window.atob(s),l=new Uint8Array(new ArrayBuffer(d.length));for(let f=0;f<d.length;f+=1)l[f]=d.charCodeAt(f);return l}function MX(s){let d="";for(let l=0;l<s.length;l+=1)d+=String.fromCharCode(s[l]);return window.btoa(d)}function Dme(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,l=new TextEncoder().encode(s);if(l.length>d)l=l.slice(0,d);else if(l.length<d){const f=new Uint8Array(d);f.set(l),l=f}return l}function kme(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];const f=z4(d).call(d,(B,Wt)=>B+Wt.length,0),b=new Uint8Array(new ArrayBuffer(f));let k=0;return d.forEach(B=>{b.set(B,k),k+=B.length}),b}function xJ(s){return window.TextEncoder?new TextEncoder().encode(s).length:s.length}function Lme(s){let d=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&s.realFormData&&(s=s.realFormData),s.forEach(l=>{d+=typeof l=="string"?xJ(l):l.size}),d+138}function oDe(s){const d=new jH(dH.TIMEOUT,"timeout");return new u5((l,f)=>{window.setTimeout(()=>f(d),s)})}function BK(s){return new u5(d=>{window.setTimeout(d,s)})}function A6(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,d=arguments.length>1?arguments[1]:void 0;const l=Math.random().toString(16).substr(2,s).toLowerCase();return l.length===s?"".concat(d).concat(l):"".concat(d).concat(l)+A6(s-l.length,"")}function EQ(){return A6(32,"").toUpperCase()}const Zse=()=>{},Mme=new class{constructor(){D5(this,"fnMap",new Map)}throttleByKey(s,d,l,f){for(var b=arguments.length,k=new Array(b>4?b-4:0),B=4;B<b;B++)k[B-4]=arguments[B];if(this.fnMap.has(d)){const Wt=this.fnMap.get(d);if(Wt.threshold!==l){Wt.fn(...Wt.args),clearTimeout(Wt.timer);const $O=window.setTimeout(()=>{const uN=this.fnMap.get(d);uN&&uN.fn(...uN.args),this.fnMap.delete(d)},l);this.fnMap.set(d,{fn:s,threshold:l,timer:$O,args:k,skipFn:f})}else Wt.skipFn&&Wt.skipFn(...Wt.args),this.fnMap.set(d,f5(f5({},Wt),{},{fn:s,args:k,skipFn:f}))}else{const Wt=window.setTimeout(()=>{const $O=this.fnMap.get(d);$O&&$O.fn(...$O.args),this.fnMap.delete(d)},l);this.fnMap.set(d,{fn:s,threshold:l,timer:Wt,args:k,skipFn:f})}}},Ume=Mme.throttleByKey.bind(Mme);function xme(s){return typeof s=="object"&&s!==null&&!(s instanceof RegExp)}function Tde(s,d){if(!xme(s)||!xme(d)||Array.isArray(s)&&!Array.isArray(d)||!Array.isArray(s)&&Array.isArray(d))return d;if(Array.isArray(d)&&Array.isArray(s)){const l=[...s];for(let f=0;f<d.length;f++)l[f]=Tde(s[f],d[f]);return l}{const l=f5({},s);for(const f in d)Object.prototype.hasOwnProperty.call(d,f)&&(Object.prototype.hasOwnProperty.call(s,f)?l[f]=Tde(s[f],d[f]):l[f]=d[f]);return l}}function Vme(s,d){let l=[0];if(l=new Array(d).fill(0),s===0)return l;let f=0;for(;s>0&&(l[f]=255&s,s>>=8,f++,f!==d););return l}function Sde(s){return typeof s=="number"?s:s.exact||s.ideal||s.max||s.min||0}function Fme(s){const d="0123456789abcdef";function l(bH){let PH,OH="";for(PH=0;PH<=3;PH++)OH+=d.charAt(bH>>8*PH+4&15)+d.charAt(bH>>8*PH&15);return OH}function f(bH,PH){const OH=(65535&bH)+(65535&PH);return(bH>>16)+(PH>>16)+(OH>>16)<<16|65535&OH}function b(bH,PH,OH,wH,BH,XH){return f(function(d5,p5){return d5<<p5|d5>>>32-p5}(f(f(PH,bH),f(wH,XH)),BH),OH)}function k(bH,PH,OH,wH,BH,XH,d5){return b(PH&OH|~PH&wH,bH,PH,BH,XH,d5)}function B(bH,PH,OH,wH,BH,XH,d5){return b(PH&wH|OH&~wH,bH,PH,BH,XH,d5)}function Wt(bH,PH,OH,wH,BH,XH,d5){return b(PH^OH^wH,bH,PH,BH,XH,d5)}function $O(bH,PH,OH,wH,BH,XH,d5){return b(OH^(PH|~wH),bH,PH,BH,XH,d5)}const uN=function(bH){let PH;const OH=1+(bH.length+8>>6),wH=new Array(16*OH);for(PH=0;PH<16*OH;PH++)wH[PH]=0;for(PH=0;PH<bH.length;PH++)wH[PH>>2]|=bH.charCodeAt(PH)<<PH%4*8;return wH[PH>>2]|=128<<PH%4*8,wH[16*OH-2]=8*bH.length,wH}(s);let lN,_N,TN,vN,uH,rH=1732584193,iH=-271733879,lH=-1732584194,hH=271733878;for(lN=0;lN<uN.length;lN+=16)_N=rH,TN=iH,vN=lH,uH=hH,rH=k(rH,iH,lH,hH,uN[lN+0],7,-680876936),hH=k(hH,rH,iH,lH,uN[lN+1],12,-389564586),lH=k(lH,hH,rH,iH,uN[lN+2],17,606105819),iH=k(iH,lH,hH,rH,uN[lN+3],22,-1044525330),rH=k(rH,iH,lH,hH,uN[lN+4],7,-176418897),hH=k(hH,rH,iH,lH,uN[lN+5],12,1200080426),lH=k(lH,hH,rH,iH,uN[lN+6],17,-1473231341),iH=k(iH,lH,hH,rH,uN[lN+7],22,-45705983),rH=k(rH,iH,lH,hH,uN[lN+8],7,1770035416),hH=k(hH,rH,iH,lH,uN[lN+9],12,-1958414417),lH=k(lH,hH,rH,iH,uN[lN+10],17,-42063),iH=k(iH,lH,hH,rH,uN[lN+11],22,-1990404162),rH=k(rH,iH,lH,hH,uN[lN+12],7,1804603682),hH=k(hH,rH,iH,lH,uN[lN+13],12,-40341101),lH=k(lH,hH,rH,iH,uN[lN+14],17,-1502002290),iH=k(iH,lH,hH,rH,uN[lN+15],22,1236535329),rH=B(rH,iH,lH,hH,uN[lN+1],5,-165796510),hH=B(hH,rH,iH,lH,uN[lN+6],9,-1069501632),lH=B(lH,hH,rH,iH,uN[lN+11],14,643717713),iH=B(iH,lH,hH,rH,uN[lN+0],20,-373897302),rH=B(rH,iH,lH,hH,uN[lN+5],5,-701558691),hH=B(hH,rH,iH,lH,uN[lN+10],9,38016083),lH=B(lH,hH,rH,iH,uN[lN+15],14,-660478335),iH=B(iH,lH,hH,rH,uN[lN+4],20,-405537848),rH=B(rH,iH,lH,hH,uN[lN+9],5,568446438),hH=B(hH,rH,iH,lH,uN[lN+14],9,-1019803690),lH=B(lH,hH,rH,iH,uN[lN+3],14,-187363961),iH=B(iH,lH,hH,rH,uN[lN+8],20,1163531501),rH=B(rH,iH,lH,hH,uN[lN+13],5,-1444681467),hH=B(hH,rH,iH,lH,uN[lN+2],9,-51403784),lH=B(lH,hH,rH,iH,uN[lN+7],14,1735328473),iH=B(iH,lH,hH,rH,uN[lN+12],20,-1926607734),rH=Wt(rH,iH,lH,hH,uN[lN+5],4,-378558),hH=Wt(hH,rH,iH,lH,uN[lN+8],11,-2022574463),lH=Wt(lH,hH,rH,iH,uN[lN+11],16,1839030562),iH=Wt(iH,lH,hH,rH,uN[lN+14],23,-35309556),rH=Wt(rH,iH,lH,hH,uN[lN+1],4,-1530992060),hH=Wt(hH,rH,iH,lH,uN[lN+4],11,1272893353),lH=Wt(lH,hH,rH,iH,uN[lN+7],16,-155497632),iH=Wt(iH,lH,hH,rH,uN[lN+10],23,-1094730640),rH=Wt(rH,iH,lH,hH,uN[lN+13],4,681279174),hH=Wt(hH,rH,iH,lH,uN[lN+0],11,-358537222),lH=Wt(lH,hH,rH,iH,uN[lN+3],16,-722521979),iH=Wt(iH,lH,hH,rH,uN[lN+6],23,76029189),rH=Wt(rH,iH,lH,hH,uN[lN+9],4,-640364487),hH=Wt(hH,rH,iH,lH,uN[lN+12],11,-421815835),lH=Wt(lH,hH,rH,iH,uN[lN+15],16,530742520),iH=Wt(iH,lH,hH,rH,uN[lN+2],23,-995338651),rH=$O(rH,iH,lH,hH,uN[lN+0],6,-198630844),hH=$O(hH,rH,iH,lH,uN[lN+7],10,1126891415),lH=$O(lH,hH,rH,iH,uN[lN+14],15,-1416354905),iH=$O(iH,lH,hH,rH,uN[lN+5],21,-57434055),rH=$O(rH,iH,lH,hH,uN[lN+12],6,1700485571),hH=$O(hH,rH,iH,lH,uN[lN+3],10,-1894986606),lH=$O(lH,hH,rH,iH,uN[lN+10],15,-1051523),iH=$O(iH,lH,hH,rH,uN[lN+1],21,-2054922799),rH=$O(rH,iH,lH,hH,uN[lN+8],6,1873313359),hH=$O(hH,rH,iH,lH,uN[lN+15],10,-30611744),lH=$O(lH,hH,rH,iH,uN[lN+6],15,-1560198380),iH=$O(iH,lH,hH,rH,uN[lN+13],21,1309151649),rH=$O(rH,iH,lH,hH,uN[lN+4],6,-145523070),hH=$O(hH,rH,iH,lH,uN[lN+11],10,-1120210379),lH=$O(lH,hH,rH,iH,uN[lN+2],15,718787259),iH=$O(iH,lH,hH,rH,uN[lN+9],21,-343485551),rH=f(rH,_N),iH=f(iH,TN),lH=f(lH,vN),hH=f(hH,uH);return l(rH)+l(iH)+l(lH)+l(hH)}let aDe=1,jme=console,t4=class{static setLogger(s){jme=s}constructor(s,d){D5(this,"id",void 0),D5(this,"lockingPromise",u5.resolve()),D5(this,"locks",0),D5(this,"name",""),D5(this,"lockId",void 0),this.lockId=aDe++,s&&(this.name=s),d&&(this.id=d),this.logger("created")}logger(s,d){const l=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),f=s==="created"?"is ".concat(s,"."):"is ".concat(s,", current queue ").concat(this.locks,". ").concat(d??"");jme.debug("".concat(l," ").concat(f))}setId(s){this.id=s}get isLocked(){return this.locks>0}lock(s){let d;this.locks+=1,this.logger("locked",s);const l=new u5(b=>{d=()=>{this.locks-=1,this.logger("unlocked",s),b()}}),f=this.lockingPromise.then(()=>d);return this.lockingPromise=this.lockingPromise.then(()=>l),f}};function N$(s,d){return function(l,f,b){const k=b.value;if(typeof k!="function")throw new Error("Cannot use mutex on object property.");return b.value=async function(){const B=this[d];if(!B)throw new Error("mutex property key ".concat(d," doesn't exist on ").concat(s));const Wt=await B.lock("From ".concat(s,".").concat(f));try{for(var $O=arguments.length,uN=new Array($O),lN=0;lN<$O;lN++)uN[lN]=arguments[lN];return await k.apply(this,uN)}finally{Wt()}},b}}const EK={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function yde(s,d){const l=Math.floor(d.timeout*Math.pow(d.timeoutFactor,s));return Math.min(d.maxRetryTimeout,l)}function ZY(s,d,l,f){const b=Object.assign({},EK,f);let k=b.timeout;const B=async()=>{await function(uN){return new u5(lN=>{window.setTimeout(lN,uN)})}(k),k*=b.timeoutFactor,k=Math.min(b.maxRetryTimeout,k)};let Wt=!1;const $O=new u5(async(uN,lN)=>{d=d||(()=>!1),l=l||(()=>!0);for(let _N=0;_N<b.maxRetryCount;_N+=1){if(Wt)return lN(new jH(dH.OPERATION_ABORTED));try{const TN=await s();if(!d(TN,_N)||_N+1===b.maxRetryCount)return uN(TN);await B()}catch(TN){if(!l(TN,_N)||_N+1===b.maxRetryCount)return lN(TN);await B()}}});return $O.cancel=()=>Wt=!0,$O}let $se,Bme=class{constructor(s){D5(this,"input",[]),D5(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return this.input.length===0?0:z4(s=this.input).call(s,(d,l)=>d+l)/this.input.length}},eoe=0,Rde=0;function bde(s,d,l,f){return new u5((b,k)=>{d.responseType=d.responseType||"json",d.data&&!l?(d.data=JSON.stringify(d.data),eoe+=xJ(d.data)):l&&(d.data.size?eoe+=d.data.size:d.data instanceof FormData?eoe+=Lme(d.data):eoe+=xJ(JSON.stringify(d.data))),d.headers=d.headers||{},d.headers["Content-Type"]=d.headers["Content-Type"]||"application/json",d.method="POST",d.url=s,F4.request(d).then(B=>{typeof B.data=="string"?Rde+=xJ(B.data):B.data instanceof ArrayBuffer||B.data instanceof Uint8Array?Rde+=B.data.byteLength:Rde+=xJ(JSON.stringify(B.data)),b(B.data)}).catch(B=>{F4.isCancel(B)?k(new jH(dH.OPERATION_ABORTED,"cancel token canceled")):B.code==="ECONNABORTED"?k(new jH(dH.NETWORK_TIMEOUT,B.message)):B.response?k(new jH(dH.NETWORK_RESPONSE_ERROR,B.response.status)):k(new jH(dH.NETWORK_ERROR,B.message))})})}async function cDe(s,d){const l=new Blob([d.data],{type:"buffer"});return await bde(s,f5(f5({},d),{},{data:l,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Gme=()=>window.isSecureContext!==void 0;function mY(s){if(Array.isArray(s))return s.map(l=>l);if(!Wme(s))return s;const d={};for(const l in s){const f=s[l];Wme(f)||Array.isArray(f)?d[l]=mY(f):d[l]=f}return d}function Wme(s){return!(typeof s!="object"||Array.isArray(s)||!s)}let vde=class{constructor(s){D5(this,"input",[]),D5(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const VJ={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Tne={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:VJ,remoteCandidate:VJ},updateInterval:0},Hme={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},qme={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Kme={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},zme={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};let Cde=class{constructor(s,d){D5(this,"onFirstVideoReceived",void 0),D5(this,"onFirstVideoDecoded",void 0),D5(this,"onFirstAudioReceived",void 0),D5(this,"onFirstVideoDecodedTimeout",void 0),D5(this,"onFirstAudioDecoded",void 0),D5(this,"onSelectedLocalCandidateChanged",void 0),D5(this,"onSelectedRemoteCandidateChanged",void 0),D5(this,"videoIsReady",!1),D5(this,"videoIsReady2",{}),D5(this,"pc",void 0),D5(this,"options",void 0),D5(this,"intervalTimer",void 0),D5(this,"stats",mY(Tne)),D5(this,"isFirstVideoReceived",{}),D5(this,"isFirstVideoDecoded",{}),D5(this,"isFirstAudioReceived",{}),D5(this,"isFirstAudioDecoded",{}),D5(this,"isFirstVideoDecodedTimeout",{}),D5(this,"lossRateWindowStats",[]),this.pc=s,this.options=d,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new u5(s=>{s({local:f5({},VJ),remote:f5({},VJ)})})}setVideoIsReady(s){this.videoIsReady=s}setVideoIsReady2(s,d){this.videoIsReady2[s]=d}getVideoIsReady(s){return this.videoIsReady2[s]||!1}setIsFirstAudioDecoded(s){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(s){this.lossRateWindowStats.push(s),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const d=this.lossRateWindowStats.length,l=["videoSend","audioSend","videoRecv","audioRecv"];let f=0,b=0,k=0,B=0;for(const Wt of l)s[Wt].forEach(($O,uN)=>{if(!this.lossRateWindowStats[d-1][Wt][uN]||!this.lossRateWindowStats[0][Wt][uN])return;const lN=this.lossRateWindowStats[d-1][Wt][uN].packets-this.lossRateWindowStats[0][Wt][uN].packets,_N=this.lossRateWindowStats[d-1][Wt][uN].packetsLost-this.lossRateWindowStats[0][Wt][uN].packetsLost;Wt==="videoSend"||Wt==="audioSend"?(f+=lN,k+=_N):(b+=lN,B+=_N),Number.isNaN(lN)||Number.isNaN(lN)?$O.packetLostRate=0:$O.packetLostRate=lN<=0||_N<=0?0:_N/(lN+_N)});s.sendPacketLossRate=f<=0||k<=0?0:k/(f+k),s.recvPacketLossRate=b<=0||B<=0?0:B/(b+B)}},uDe=class extends Cde{constructor(){super(...arguments),D5(this,"_stats",Tne),D5(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const s=await this._getStats(),d=this.statsResponsesToObjects(s);this._stats=mY(Tne);const l=d.filter(b=>b.type==="ssrc");this.processSSRCStats(l);const f=d.find(b=>b.type==="VideoBwe");f&&this.processBandwidthStats(f),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)}processSSRCStats(s){s.forEach(d=>{var l;const f=a5(l=d.id).call(l,"send");switch("".concat(d.mediaType,"_").concat(f?"send":"recv")){case"video_send":{const b=mY(qme);b.codec=d.googCodecName,b.adaptionChangeReason="none",d.googCpuLimitedResolution&&(b.adaptionChangeReason="cpu"),d.googBandwidthLimitedResolution&&(b.adaptionChangeReason="bandwidth"),b.avgEncodeMs=Number(d.googAvgEncodeMs),b.inputFrame={width:Number(d.googFrameWidthInput)||Number(d.googFrameWidthSent),height:Number(d.googFrameHeightInput)||Number(d.googFrameHeightSent),frameRate:Number(d.googFrameRateInput)},b.sentFrame={width:Number(d.googFrameWidthSent),height:Number(d.googFrameHeightSent),frameRate:Number(d.googFrameRateInput)},b.firsCount=Number(d.googFirReceived),b.nacksCount=Number(d.googNacksReceived),b.plisCount=Number(d.googPlisReceived),b.frameCount=Number(d.framesEncoded),b.bytes=Number(d.bytesSent),b.packets=Number(d.packetsSent),b.packetsLost=Number(d.packetsLost),b.ssrc=Number(d.ssrc),b.rttMs=Number(d.googRtt||0),this._stats.videoSend.push(b),this._stats.rtt=b.rttMs;break}case"video_recv":{const b=mY(Hme),k=this.lastDecodeVideoReceiverStats.get(Number(d.ssrc));if(b.codec=d.googCodecName,b.targetDelayMs=Number(d.googTargetDelayMs),b.renderDelayMs=Number(d.googRenderDelayMs),b.currentDelayMs=Number(d.googCurrentDelayMs),b.minPlayoutDelayMs=Number(d.googMinPlayoutDelayMs),b.decodeMs=Number(d.googDecodeMs),b.maxDecodeMs=Number(d.googMaxDecodeMs),b.receivedFrame={width:Number(d.googFrameWidthReceived),height:Number(d.googFrameHeightReceived),frameRate:Number(d.googFrameRateReceived)},b.decodedFrame={width:Number(d.googFrameWidthReceived),height:Number(d.googFrameHeightReceived),frameRate:Number(d.googFrameRateDecoded)},b.decodeFrameRate=Number(d.googFrameRateDecoded),b.outputFrame={width:Number(d.googFrameWidthReceived),height:Number(d.googFrameHeightReceived),frameRate:Number(d.googFrameRateOutput)},b.jitterBufferMs=Number(d.googJitterBufferMs),b.firsCount=Number(d.googFirsSent),b.nacksCount=Number(d.googNacksSent),b.plisCount=Number(d.googPlisSent),b.framesDecodeCount=Number(d.framesDecoded),b.bytes=Number(d.bytesReceived),b.packets=Number(d.packetsReceived),b.packetsLost=Number(d.packetsLost),b.ssrc=Number(d.ssrc),b.packets>0&&!this.isFirstVideoReceived[b.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(b.ssrc),this.isFirstVideoReceived[b.ssrc]=!0),b.framesDecodeCount>0&&!this.isFirstVideoDecoded[b.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(b.ssrc,b.decodedFrame.width,b.decodedFrame.height),this.isFirstVideoDecoded[b.ssrc]=!0),k){const B=k.stats,Wt=Date.now()-k.lts;b.framesDecodeFreezeTime=B.framesDecodeFreezeTime,b.framesDecodeInterval=B.framesDecodeInterval,b.framesDecodeCount>B.framesDecodeCount&&this.isFirstVideoDecoded[b.ssrc]?(k.lts=Date.now(),b.framesDecodeInterval=Wt,b.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(d.ssrc,10))?b.framesDecodeFreezeTime+=b.framesDecodeInterval:this.setVideoIsReady2(parseInt(d.ssrc,10),!0))):b.framesDecodeCount<k.stats.framesDecodeCount&&(b.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(b.ssrc,{stats:f5({},b),lts:Date.now()}),this._stats.videoRecv.push(b);break}case"audio_recv":{const b=mY(zme);b.codec=d.googCodecName,b.outputLevel=Math.abs(Number(d.audioOutputLevel))/32767,b.decodingCNG=Number(d.googDecodingCNG),b.decodingCTN=Number(d.googDecodingCTN),b.decodingCTSG=Number(d.googDecodingCTSG),b.decodingNormal=Number(d.googDecodingNormal),b.decodingPLC=Number(d.googDecodingPLC),b.decodingPLCCNG=Number(d.googDecodingPLCCNG),b.expandRate=Number(d.googExpandRate),b.accelerateRate=Number(d.googAccelerateRate),b.preemptiveExpandRate=Number(d.googPreemptiveExpandRate),b.secondaryDecodedRate=Number(d.googSecondaryDecodedRate),b.speechExpandRate=Number(d.googSpeechExpandRate),b.preferredJitterBufferMs=Number(d.googPreferredJitterBufferMs),b.jitterBufferMs=Number(d.googJitterBufferMs),b.jitterMs=Number(d.googJitterReceived),b.bytes=Number(d.bytesReceived),b.packets=Number(d.packetsReceived),b.packetsLost=Number(d.packetsLost),b.ssrc=Number(d.ssrc),b.receivedFrames=Number(d.googDecodingCTN)||Number(d.packetsReceived),b.droppedFrames=Number(d.googDecodingPLC)+Number(d.googDecodingPLCCNG)||Number(d.packetsLost),b.receivedFrames>0&&!this.isFirstAudioReceived[b.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(b.ssrc),this.isFirstAudioReceived[b.ssrc]=!0),b.decodingNormal>0&&!this.isFirstAudioDecoded[b.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(b.ssrc),this.isFirstAudioDecoded[b.ssrc]=!0),this._stats.audioRecv.push(b);break}case"audio_send":{const b=mY(Kme);b.codec=d.googCodecName,b.inputLevel=Math.abs(Number(d.audioInputLevel))/32767,b.aecReturnLoss=Number(d.googEchoCancellationReturnLoss||0),b.aecReturnLossEnhancement=Number(d.googEchoCancellationReturnLossEnhancement||0),b.residualEchoLikelihood=Number(d.googResidualEchoLikelihood||0),b.residualEchoLikelihoodRecentMax=Number(d.googResidualEchoLikelihoodRecentMax||0),b.bytes=Number(d.bytesSent),b.packets=Number(d.packetsSent),b.packetsLost=Number(d.packetsLost),b.ssrc=Number(d.ssrc),b.rttMs=Number(d.googRtt||0),this._stats.rtt=b.rttMs,this._stats.audioSend.push(b);break}}})}_getStats(){return new u5((s,d)=>{this.pc.getStats(s,d)})}statsResponsesToObjects(s){const d=[];return s.result().forEach(l=>{const f={id:l.id,timestamp:l.timestamp.valueOf().toString(),type:l.type};l.names().forEach(b=>{f[b]=l.stat(b)}),d.push(f)}),d}},Sne=function(s){return s.BANDWIDTH="bandwidth",s.CPU="cpu",s.NONE="none",s.OTHER="other",s}({}),toe=function(s){return s.L1T1="L1T1",s.L1T2="L1T2",s.L1T3="L1T3",s.L1T3_KEY="L1T3_KEY",s.L2T1_KEY="L2T1_KEY",s.L2T2_KEY="L2T2_KEY",s.L2T3_KEY="L2T3_KEY",s.L3T1_KEY="L3T1_KEY",s.L3T2_KEY="L3T2_KEY",s.L3T3_KEY="L3T3_KEY",s}({}),Ide=function(s){return s[s.new=0]="new",s[s.connecting=1]="connecting",s[s.connected=2]="connected",s[s.disconnected=3]="disconnected",s[s.failed=4]="failed",s[s.closed=5]="closed",s}({}),b8=function(s){return s.CERTIFICATE="certificate",s.CODEC="codec",s.CANDIDATE_PAIR="candidate-pair",s.LOCAL_CANDIDATE="local-candidate",s.REMOTE_CANDIDATE="remote-candidate",s.INBOUND="inbound-rtp",s.TRACK="track",s.OUTBOUND="outbound-rtp",s.PC="peer-connection",s.REMOTE_INBOUND="remote-inbound-rtp",s.REMOTE_OUTBOUND="remote-outbound-rtp",s.TRANSPORT="transport",s.CSRC="csrc",s.DATA_CHANNEL="data-channel",s.STREAM="stream",s.SENDER="sender",s.RECEIVER="receiver",s}({});var P$=function(s){return s[s.kNone=1]="kNone",s[s.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",s[s.kBytesToBits=8]="kBytesToBits",s}(P$||{});function yne(s,d,l,f){let b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:P$.kNone;if(!d)return;const k=Number(d[l]);if(typeof k!="number")return;const B=Number(d[f]);if(typeof B!="number")return;if(!s)return B?k/B*b:void 0;const Wt=Number(s[l]);if(typeof Wt!="number")return;const $O=Number(s[f]);if(typeof $O!="number")return;const uN=B-$O;return uN?(k-Wt)/uN*b:void 0}let Yme=class extends Cde{constructor(){super(...arguments),D5(this,"_stats",Tne),D5(this,"report",void 0),D5(this,"lastDecodeVideoReceiverStats",new Map),D5(this,"lastVideoFramesRecv",new Map),D5(this,"lastVideoFramesSent",new Map),D5(this,"lastVideoFramesDecode",new Map),D5(this,"lastVideoFramesOutput",new Map),D5(this,"lastVideoJBDelay",new Map),D5(this,"lastAudioJBDelay",new Map),D5(this,"mediaBytesSent",new Map),D5(this,"mediaBytesRetransmit",new Map),D5(this,"mediaBytesTargetEncode",new Map),D5(this,"lastDecodeAudioReceiverStats",new Map),D5(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=mY(Tne),this.report.forEach(s=>{switch(s.type){case b8.OUTBOUND:case b8.INBOUND:{const d=s.mediaType||s.kind,l=!d&&"frameWidth"in s,f=!d&&!("frameWidth"in s);s.type===b8.OUTBOUND?d==="audio"||f?this.processAudioOutboundStats(s):(d==="video"||l)&&this.processVideoOutboundStats(s):s.type===b8.INBOUND&&(d==="audio"||f?this.processAudioInboundStats(s):(d==="video"||l)&&this.processVideoInboundStats(s));break}case b8.TRANSPORT:{const d=this.report.get(s.selectedCandidatePairId);d&&this.processCandidatePairStats(d);break}case b8.CANDIDATE_PAIR:s.selected&&this.processCandidatePairStats(s)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const s=await this.pc.getStats(),d={local:f5({},VJ),remote:f5({},VJ)};return s.forEach(l=>{let f;if(l.type===b8.TRANSPORT&&(f=s.get(l.selectedCandidatePairId)),l.type===b8.CANDIDATE_PAIR&&l.selected&&(f=l),f){const b=(k,B)=>{k.type=B.type,k.id=B.id,B.address&&(k.address=B.address),B.candidateType&&(k.candidateType=B.candidateType),B.port&&(k.port=B.port),B.priority&&(k.priority=B.priority),B.protocol&&(k.protocol=B.protocol),B.relayProtocol&&(k.relayProtocol=B.relayProtocol)};if(f.localCandidateId){const k=s.get(f.localCandidateId);k&&b(d.local,k)}if(f.remoteCandidateId){const k=s.get(f.remoteCandidateId);k&&b(d.remote,k)}}}),d}processCandidatePairStats(s){if(this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(d=>{s.currentRoundTripTime&&(d.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(d=>{s.currentRoundTripTime&&(d.rttMs=1e3*s.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=s.id,s.localCandidateId){const d=this.report.get(s.localCandidateId);d&&this.processCandidateStats(d)}if(s.remoteCandidateId){const d=this.report.get(s.remoteCandidateId);d&&this.processCandidateStats(d)}}processCandidateStats(s){let d;s.type===b8.LOCAL_CANDIDATE&&(d=this._stats.selectedCandidatePair.localCandidate),s.type===b8.REMOTE_CANDIDATE&&(d=this._stats.selectedCandidatePair.remoteCandidate),d&&(d.type=s.type,d.id=s.id,s.address&&(d.address=s.address),s.candidateType&&(d.candidateType=s.candidateType),s.port&&(d.port=s.port),s.priority&&(d.priority=s.priority),s.protocol&&(d.protocol=s.protocol),s.relayProtocol&&(d.relayProtocol=s.relayProtocol),s.type===b8.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==d.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(f5({},d),f5({},this.stats.selectedCandidatePair.localCandidate)),s.type===b8.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==d.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(f5({},d),f5({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(s){let d=this._stats.audioRecv.find(f=>f.ssrc===s.ssrc);d||(d=mY(zme),this._stats.audioRecv.push(d)),d.ssrc=s.ssrc,d.packets=s.packetsReceived,d.packetsLost=s.packetsLost,d.packetsDiscarded=s.packetsDiscarded,d.bytes=s.bytesReceived,d.jitterMs=1e3*s.jitter,d.retransmittedBytesReceived=s.retransmittedBytesReceived,d.retransmittedPacketsReceived=s.retransmittedPacketsReceived,d.totalProcessingDelay=s.totalProcessingDelay,d.jitterBufferEmittedCount=s.jitterBufferEmittedCount;const l=this.lastDecodeAudioReceiverStats.get(d.ssrc);d.avgProcessingDelayMs=yne(l,d,"totalProcessingDelay","jitterBufferEmittedCount",P$.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(s,s.trackId,d),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),d.receivedFrames||(d.receivedFrames=s.packetsReceived),d.droppedFrames||(d.droppedFrames=s.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.outputLevel&&d.outputLevel>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),typeof s.concealedSamples=="number"&&(d.concealedSamples=s.concealedSamples),this.lastDecodeAudioReceiverStats.set(d.ssrc,f5({},d))}processVideoInboundStats(s){let d=this._stats.videoRecv.find(B=>B.ssrc===s.ssrc);d||(d=mY(Hme),this._stats.videoRecv.push(d)),d.ssrc=s.ssrc,d.packets=s.packetsReceived,d.packetsLost=s.packetsLost,d.bytes=s.bytesReceived,d.firsCount=s.firCount,d.nacksCount=s.nackCount,d.plisCount=s.pliCount,d.framesDecodeCount=s.framesDecoded,d.framesDroppedCount=s.framesDropped,d.totalInterFrameDelay=s.totalInterFrameDelay,d.totalSquaredInterFrameDelay=s.totalSquaredInterFrameDelay,d.totalFreezesDuration=s.totalFreezesDuration,d.totalProcessingDelay=s.totalProcessingDelay,d.packetsDiscarded=s.packetsDiscarded,d.framesAssembledFromMultiplePackets=s.framesAssembledFromMultiplePackets,d.totalAssemblyTime=s.totalAssemblyTime,d.keyFramesDecoded=s.keyFramesDecoded,d.retransmittedBytesReceived=s.retransmittedBytesReceived,d.retransmittedPacketsReceived=s.retransmittedPacketsReceived;const l=this.lastDecodeVideoReceiverStats.get(d.ssrc),f=this.lastVideoFramesDecode.get(d.ssrc),b=this.lastVideoFramesOutput.get(d.ssrc),k=Date.now();if(d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]){const B=d.decodedFrame?d.decodedFrame.width:0,Wt=d.decodedFrame?d.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,B,Wt),this.isFirstVideoDecoded[d.ssrc]=!0}if(l){const B=l.stats,Wt=k-l.lts;d.framesDecodeFreezeTime=B.framesDecodeFreezeTime,d.framesDecodeInterval=B.framesDecodeInterval,!this.isFirstVideoDecoded[d.ssrc]&&Wt>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[d.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(d.ssrc),this.isFirstVideoDecodedTimeout[d.ssrc]=!0),d.framesDecodeCount>B.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(l.lts=Date.now(),d.framesDecodeInterval=Wt,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(s.ssrc))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(s.ssrc,10),!0))):d.framesDecodeCount<B.framesDecodeCount&&(d.framesDecodeInterval=0),s.framesDecoded&&s.qpSum&&(l.stats.framesDecodeCount>s.framesDecoded?d.qpSumPerFrame=s.qpSum/s.framesDecoded:d.qpSumPerFrame=(s.qpSum-l.qpSum)/(s.framesDecoded-l.stats.framesDecodeCount))}s.totalDecodeTime&&(d.decodeMs=1e3*s.totalDecodeTime,d.avgDecodeMs=yne(l==null?void 0:l.stats,d,"decodeMs","framesDecodeCount")),d.avgProcessingDelayMs=yne(l==null?void 0:l.stats,d,"totalProcessingDelay","framesDecodeCount",P$.kMillisecondsFromSeconds),d.avgFramesAssembledFromMultiplePacketsMs=yne(l==null?void 0:l.stats,d,"totalAssemblyTime","framesAssembledFromMultiplePackets",P$.kMillisecondsFromSeconds),d.avgInterFrameDelayMs=yne(l==null?void 0:l.stats,d,"totalInterFrameDelay","framesDecodeCount",P$.kMillisecondsFromSeconds),f&&k-f.lts>=800?(d.decodeFrameRate=Math.round((d.framesDecodeCount-f.count)/((k-f.lts)/1e3)),this.lastVideoFramesDecode.set(d.ssrc,{count:d.framesDecodeCount,lts:k,rate:d.decodeFrameRate})):f?d.decodeFrameRate=f.rate:this.lastVideoFramesDecode.set(d.ssrc,{count:d.framesDecodeCount,lts:k,rate:0}),d.framesDroppedCount&&s.framesReceived&&(b&&k-b.lts>=800?(d.outputFrameRate=Math.round((s.framesReceived-d.framesDroppedCount-b.count)/((k-b.lts)/1e3)),this.lastVideoFramesOutput.set(d.ssrc,{count:s.framesReceived-d.framesDroppedCount,lts:k,rate:Math.max(d.outputFrameRate,0)})):b?d.outputFrameRate=b.rate:this.lastVideoFramesOutput.set(d.ssrc,{count:s.framesReceived-d.framesDroppedCount,lts:k,rate:0})),this.processVideoTrackReceiverStats(s,s.trackId,d),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(d.framesRateFirefox=s.framerateMean),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:f5({},d),lts:l?l.lts:Date.now(),qpSum:s.qpSum})}processVideoOutboundStats(s){let d=this._stats.videoSend.find(f=>f.ssrc===s.ssrc);d||(d=mY(qme),this._stats.videoSend.push(d));const l=this.mediaBytesSent.get(s.ssrc);if(l)l.add(s.bytesSent);else{const f=new vde(10);f.add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,f)}if(s.retransmittedBytesSent!==void 0){const f=this.mediaBytesRetransmit.get(s.ssrc);if(f)f.add(s.retransmittedBytesSent);else{const b=new vde(10);b.add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,b)}}if(s.totalEncodedBytesTarget){const f=this.mediaBytesTargetEncode.get(s.ssrc);if(f)f.add(s.totalEncodedBytesTarget);else{const b=new vde(10);b.add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,b)}}if(d.ssrc=s.ssrc,d.bytes=s.bytesSent,d.packets=s.packetsSent,d.firsCount=s.firCount,d.nacksCount=s.nackCount,d.plisCount=s.pliCount,d.frameCount=s.framesEncoded,d.adaptionChangeReason=s.qualityLimitationReason,d.scalabilityMode=s.scalabilityMode,d.retransmittedBytesSent=s.retransmittedBytesSent,d.retransmittedPacketsSent=s.retransmittedPacketsSent,d.hugeFramesSent=s.hugeFramesSent,d.keyFramesEncoded=s.keyFramesEncoded,s.totalEncodeTime&&s.framesEncoded){const f=this.lastEncoderMs.get(s.ssrc);if(!f||f.lastFrameCount>s.framesEncoded)d.avgEncodeMs=1e3*s.totalEncodeTime/s.framesEncoded;else{const b=s.framesEncoded-f.lastFrameCount,k=s.totalEncodeTime-f.lastEncoderTime;d.avgEncodeMs=1e3*k/b}}if(s.framesEncoded&&s.qpSum){const f=this.lastEncoderMs.get(s.ssrc);!f||f.lastFrameCount>s.framesEncoded?d.qpSumPerFrame=s.qpSum/s.framesEncoded:d.qpSumPerFrame=(s.qpSum-f.lastQpSum)/(s.framesEncoded-f.lastFrameCount)}if(this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lastQpSum:s.qpSum,lts:Date.now()}),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,d),this.processVideoTrackSenderStats(s,s.trackId,d),s.remoteId)this.processRemoteInboundStats(s.remoteId,d);else{const f=this.findRemoteStatsId(s.ssrc,b8.REMOTE_INBOUND);f&&this.processRemoteInboundStats(f,d)}}processAudioOutboundStats(s){let d=this._stats.audioSend.find(l=>l.ssrc===s.ssrc);if(d||(d=mY(Kme),this._stats.audioSend.push(d)),d.ssrc=s.ssrc,d.packets=s.packetsSent,d.bytes=s.bytesSent,d.retransmittedBytesSent=s.retransmittedBytesSent,d.retransmittedPacketsSent=s.retransmittedPacketsSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,d),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),this.processAudioTrackSenderStats(s,s.trackId,d),s.remoteId)this.processRemoteInboundStats(s.remoteId,d);else{const l=this.findRemoteStatsId(s.ssrc,b8.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,d)}}findRemoteStatsId(s,d){var l;const f=Array.from(S8(l=this.report).call(l)).find(b=>b.type===d&&b.ssrc===s);return f?f.id:null}processVideoMediaSource(s,d){const l=this.report.get(s);l&&l.width&&l.height&&l.framesPerSecond&&(d.inputFrame={width:l.width,height:l.height,frameRate:l.framesPerSecond})}processAudioMediaSource(s,d){const l=this.report.get(s);l&&(d.inputLevel=l.audioLevel)}processVideoTrackSenderStats(s,d,l){var f,b,k,B;const Wt=d?this.report.get(d):void 0,$O=(f=Wt==null?void 0:Wt.framesSent)!==null&&f!==void 0?f:s.framesSent;if(typeof $O!="number")return;let uN=(b=Wt==null?void 0:Wt.frameWidth)!==null&&b!==void 0?b:s.frameWidth,lN=(k=Wt==null?void 0:Wt.frameHeight)!==null&&k!==void 0?k:s.frameHeight,_N=(B=Wt==null?void 0:Wt.framesPerSecond)!==null&&B!==void 0?B:s.framesPerSecond;if(typeof uN=="number"&&typeof lN=="number"||(uN=0,lN=0),_N==null){const TN=Date.now(),vN=this.lastVideoFramesSent.get(l.ssrc);vN&&TN-vN.lts>=800?(_N=Math.round(($O-vN.count)/((TN-vN.lts)/1e3)),this.lastVideoFramesSent.set(l.ssrc,{count:$O,lts:TN,rate:_N})):vN?_N=vN.rate:this.lastVideoFramesSent.set(l.ssrc,{count:$O,lts:TN,rate:0})}l.sentFrame={width:uN,height:lN,frameRate:Math.max(0,_N)}}processVideoTrackReceiverStats(s,d,l){var f,b,k,B,Wt;const $O=d?this.report.get(d):void 0,uN=(f=$O==null?void 0:$O.framesReceived)!==null&&f!==void 0?f:s.framesReceived,lN=(b=$O==null?void 0:$O.frameWidth)!==null&&b!==void 0?b:s.frameWidth,_N=(k=$O==null?void 0:$O.frameHeight)!==null&&k!==void 0?k:s.frameHeight,TN=(B=$O==null?void 0:$O.jitterBufferDelay)!==null&&B!==void 0?B:s.jitterBufferDelay,vN=(Wt=$O==null?void 0:$O.jitterBufferEmittedCount)!==null&&Wt!==void 0?Wt:s.jitterBufferEmittedCount;if(typeof uN=="number"){const uH=this.lastVideoFramesRecv.get(l.ssrc),rH=Date.now();l.framesReceivedCount=uN;let iH=0;uH&&rH-uH.lts>=800?(iH=Math.round((uN-uH.count)/((rH-uH.lts)/1e3)),this.lastVideoFramesRecv.set(l.ssrc,{count:uN,lts:rH,rate:iH})):uH?iH=uH.rate:this.lastVideoFramesRecv.set(l.ssrc,{count:uN,lts:rH,rate:0}),l.receivedFrame={width:lN||0,height:_N||0,frameRate:iH||0},l.decodedFrame={width:lN||0,height:_N||0,frameRate:l.decodeFrameRate||0},l.outputFrame={width:lN||0,height:_N||0,frameRate:l.outputFrameRate||l.decodeFrameRate||0}}if(TN&&vN){const uH=this.lastVideoJBDelay.get(l.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let rH=uH.jitterBufferMs;const iH=vN-uH.jitterBufferEmittedCount;iH>0&&(rH=1e3*(TN-uH.jitterBufferDelay)/iH),l.jitterBufferMs=rH,l.currentDelayMs=Math.round(rH),this.lastVideoJBDelay.set(l.ssrc,{jitterBufferDelay:TN,jitterBufferEmittedCount:vN,jitterBufferMs:l.currentDelayMs})}}processAudioTrackSenderStats(s,d,l){var f,b,k,B;const Wt=d?this.report.get(d):void 0,$O=(f=(b=Wt==null?void 0:Wt.echoReturnLoss)!==null&&b!==void 0?b:s.echoReturnLoss)!==null&&f!==void 0?f:0,uN=(k=(B=Wt==null?void 0:Wt.echoReturnLossEnhancement)!==null&&B!==void 0?B:s.echoReturnLossEnhancement)!==null&&k!==void 0?k:0;l.aecReturnLoss=$O,l.aecReturnLossEnhancement=uN}processAudioTrackReceiverStats(s,d,l){var f,b,k,B,Wt,$O,uN;const lN=d?this.report.get(d):void 0,_N=(f=lN==null?void 0:lN.removedSamplesForAcceleration)!==null&&f!==void 0?f:s.removedSamplesForAcceleration,TN=(b=lN==null?void 0:lN.totalSamplesReceived)!==null&&b!==void 0?b:s.totalSamplesReceived,vN=(k=lN==null?void 0:lN.jitterBufferDelay)!==null&&k!==void 0?k:s.jitterBufferDelay,uH=(B=lN==null?void 0:lN.jitterBufferEmittedCount)!==null&&B!==void 0?B:s.jitterBufferEmittedCount,rH=(Wt=lN==null?void 0:lN.audioLevel)!==null&&Wt!==void 0?Wt:s==null?void 0:s.audioLevel,iH=($O=lN==null?void 0:lN.totalSamplesDuration)!==null&&$O!==void 0?$O:s==null?void 0:s.totalSamplesDuration,lH=(uN=lN==null?void 0:lN.concealedSamples)!==null&&uN!==void 0?uN:s.concealedSamples;if(_N&&TN&&(l.accelerateRate=_N/TN),vN&&uH){const bH=this.lastAudioJBDelay.get(l.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let PH=bH.jitterBufferMs;const OH=uH-bH.jitterBufferEmittedCount;OH>0&&(PH=1e3*(vN-bH.jitterBufferDelay)/OH),l.jitterBufferMs=Math.round(PH),this.lastAudioJBDelay.set(l.ssrc,{jitterBufferDelay:vN,jitterBufferEmittedCount:uH,jitterBufferMs:l.jitterBufferMs})}l.outputLevel=rH;let hH=1920;iH&&TN&&(hH=TN/iH/50,l.receivedFrames=Math.round(TN/hH)),lH&&(l.droppedFrames=Math.round(lH/hH))}processRemoteInboundStats(s,d){const l=this.report.get(s);l&&(d.packetsLost=l.packetsLost,l.roundTripTime&&(d.rttMs=1e3*l.roundTripTime),l.jitter&&(d.jitterMs=1e3*l.jitter),l.timestamp&&(d.timestamp=l.timestamp))}getCodecFromCodecStats(s){const d=this.report.get(s);if(!d)return"";const l=d.mimeType.match(/\/(.*)$/);return l&&l[1]?l[1]:""}updateSendBitrate(){let s=0,d=null,l=null;this.mediaBytesSent.forEach(b=>{s+=b.diffMean()}),this.mediaBytesRetransmit.forEach(b=>{d=d===null?b.diffMean():d+b.diffMean()}),this.mediaBytesTargetEncode.forEach(b=>{l=l===null?b.diffMean():l+b.diffMean()});const f=d!==null?s-d:s;this._stats.bitrate={actualEncoded:8*f/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},d!==null&&(this._stats.bitrate.retransmit=8*d/(this.options.updateInterval/1e3)),l!==null&&(this._stats.bitrate.targetEncoded=8*l/(this.options.updateInterval/1e3))}},dDe=class extends Cde{updateStats(){return u5.resolve()}};function wde(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const k=function(){const B=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return B&&B[0]?Number(B[0].split("/")[1]):null}();return k?k<76?new uDe(s,{updateInterval:d,lossRateInterval:l,freezeRateLimit:f,firstVideoDecodedTimeout:b}):new Yme(s,{updateInterval:d,lossRateInterval:l,freezeRateLimit:f,firstVideoDecodedTimeout:b}):function(B){if(!window.RTCStatsReport)return!1;const Wt=B.getStats();return!!(Wt instanceof u5||function($O){return!!$O&&(typeof $O=="object"||typeof $O=="function")&&typeof $O.then=="function"}(Wt))}(s)?new Yme(s,{updateInterval:d,lossRateInterval:l,freezeRateLimit:f,firstVideoDecodedTimeout:b}):new dDe(s,{updateInterval:d,lossRateInterval:l,freezeRateLimit:f,firstVideoDecodedTimeout:b})}const Jme="websdk_ng_install_id";function Ade(){try{if(_H("INSTALL_ID"))return _H("INSTALL_ID");let s=window.localStorage.getItem(Jme);return s||(s=EQ(),window.localStorage.setItem(Jme,s)),S6("INSTALL_ID",s),s}catch{return}}const q8=function(s){if(s.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return s;const d=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(d&&d[1]&&d[2]){const l=d[1],f=d[2];return"".concat(l,".").concat(f)}return"4.0.0.999"}("4.23.1"),Ode=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let mQ=function(s){return s.Default="default",s.Auto="auto",s.Relay="relay",s.SdRtn="sd-rtn",s}({});const JK=function(){const s="us".concat("erna","me"),d="pa".concat("sswo","rd"),l=["t","s","t"];l.splice(1,0,"e");const f=l.join(""),b=[];for(let Wt=0;Wt<6;Wt++)b.push("1");const k=b.join(""),B={};return B[s]=f,B[d]=k,Object.assign(B,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=JK;const noe={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},Nde={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Pde="v4.23.1-0-gea45199f-dirty(1/16/2025, 3:18:04 PM)",Dde={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"]},H6=f5(f5(f5({},Dde),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Nde,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},noe),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function S6(s,d,l){var f,b,k;a5(f=Object.keys(H6)).call(f,s)&&(!l&&a5(b=Object.keys($Y)).call(b,s)||(H6[s]=d,s!=="ENABLE_VIDEO_SEI"&&s!=="ENABLE_AUDIO_TOPN"&&s!=="ENABLE_AUDIO_METADATA"||d!==!0||(H6.ENABLE_ENCODED_TRANSFORM=!0),s==="USE_NEW_NETWORK_CONFIG"&&d&&(k=!!d,H6.USE_NEW_NETWORK_CONFIG=k,k&&(H6.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],H6.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],H6.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],H6.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],H6.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",H6.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",H6.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),s==="ENABLE_PRE_SUB"&&d&&(H6.ENABLE_INSTANT_VIDEO=!0,H6.ENABLE_PREALLOC_PC=!0),s==="ENABLE_SVC"&&d&&(H6.ENABLE_AUT_CC=!0)))}function _H(s){return H6[s]}Ode||(H6.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],H6.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],H6.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],H6.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],H6.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],H6.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],H6.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",H6.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",H6.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",H6.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",H6.AREAS=["NORTH_AMERICA","OVERSEA"]);let Xme=function(s){return s[s.REALTIME=1]="REALTIME",s}({});const $Y={};var Y5=function(s){return s.SET_SESSION_ID="SET_SESSION_ID",s.SET_P2P_ID="SET_P2P_id",s.SET_DC_ID="SET_DC_id",s.SET_UID="SET_UID",s.SET_INT_UID="SET_INT_UID",s.SET_PUB_ID="SET_PUB_ID",s.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",s.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",s.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",s.AVOID_JOIN_START="AVOID_JOIN_START",s.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",s.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",s.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",s.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",s.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",s.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",s.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",s.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",s.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",s.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",s.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",s.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",s.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",s.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",s.RESET_KEY_METRICS="RESET_KEY_METRICS",s.SET_USE_P2P="SET_USE_P2P",s.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",s}(Y5||{});let lDe=class{constructor(s,d,l,f){D5(this,"state",void 0),this.state={codec:s,audioCodec:d,mode:l,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:mQ.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(s){this.state=function(d,l){switch(l.type){case Y5.SET_SESSION_ID:return f5(f5({},d),{},{sessionId:l.sessionId});case Y5.SET_P2P_ID:return f5(f5({},d),{},{p2pId:l.p2pId});case Y5.SET_UID:return f5(f5({},d),{},{uid:l.uid});case Y5.SET_INT_UID:return f5(f5({},d),{},{intUid:l.intUid});case Y5.SET_PUB_ID:return f5(f5({},d),{},{pubId:l.pubId});case Y5.KEY_METRIC_CLIENT_CREATED:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{clientCreated:l.metric})});case Y5.KEY_METRIC_JOIN_START:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{joinStart:l.metric})});case Y5.AVOID_JOIN_START:return f5(f5({},d),{},{avoidJoinStart:l.avoidJoinStart});case Y5.KEY_METRIC_JOIN_END:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{joinEnd:l.metric})});case Y5.KEY_METRIC_REQUEST_AP_START:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{requestAPStart:l.metric})});case Y5.KEY_METRIC_REQUEST_AP_END:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{requestAPEnd:l.metric})});case Y5.KEY_METRIC_JOIN_GATEWAY_START:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{joinGatewayStart:l.metric})});case Y5.KEY_METRIC_JOIN_GATEWAY_END:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{joinGatewayEnd:l.metric})});case Y5.KEY_METRIC_PEER_CONNECTION_START:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{peerConnectionStart:l.metric})});case Y5.KEY_METRIC_PEER_CONNECTION_END:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{peerConnectionEnd:l.metric})});case Y5.KEY_METRIC_DESCRIPTION_START:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{descriptionStart:l.metric})});case Y5.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{signalChannelOpen:l.metric})});case Y5.KEY_METRIC_ICE_CONNECTION_END:return f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{iceConnectionEnd:l.metric})});case Y5.KEY_METRIC_PUBLISH:{const f=d.keyMetrics.publish,b=f.findIndex(k=>k.trackId===l.metric.trackId);return b!==-1?(f[b]=f5(f5({},f[b]),l.metric),f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{publish:[...f]})})):f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,l.metric]})})}case Y5.KEY_METRIC_SUBSCRIBE:{const f=d.keyMetrics.subscribe,b=f.findIndex(k=>k.userId===l.metric.userId&&k.type===l.metric.type);return b!==-1?(f[b]=f5(f5({},f[b]),l.metric),f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{subscribe:[...f]})})):f5(f5({},d),{},{keyMetrics:f5(f5({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,l.metric]})})}case Y5.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=l.mode,d;case Y5.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,l.record]:(d.joinChannelServiceRecords[l.index]=f5(f5({},d.joinChannelServiceRecords[l.index]),l.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case Y5.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case Y5.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case Y5.SET_USE_P2P:return f5(f5({},d),{},{useP2P:l.val});case Y5.SET_TRANSPORT_TYPE:return f5(f5({},d),{},{p2pTransport:l.val});default:return d}}(this.state,s)}set sessionId(s){this.dispatch({type:Y5.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}set cid(s){this.state.cid=s}get cid(){return this.state.cid}set codec(s){this.state.codec=s}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:Y5.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:Y5.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:Y5.SET_UID,uid:s})}get uid(){return this.state.uid}set intUid(s){this.dispatch({type:Y5.SET_INT_UID,intUid:s})}get intUid(){return this.state.intUid}set pubId(s){this.dispatch({type:Y5.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:Y5.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(s){this.dispatch({type:Y5.SET_USE_P2P,val:s})}get useP2P(){return this.state.useP2P}set p2pTransport(s){this.dispatch({type:Y5.SET_TRANSPORT_TYPE,val:s})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(s){this.state.hasStartJoinChannel=s}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(s){this.state.isABTestSuccess=s}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Y5.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Y5.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Y5.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Y5.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Y5.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Y5.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Y5.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Y5.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Y5.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Y5.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Y5.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Y5.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,d,l,f){this.dispatch({type:Y5.KEY_METRIC_PUBLISH,metric:f5(f5({trackId:s,type:d},l&&{publishStart:l}),f&&{publishEnd:f})})}subscribe(s,d,l,f,b,k,B){this.dispatch({type:Y5.KEY_METRIC_SUBSCRIBE,metric:f5(f5(f5(f5(f5({userId:s,type:d},l&&{subscribeStart:l}),f&&{subscribeEnd:f}),b&&{firstFrame:b}),k&&{streamAdded:k}),B&&{firstDecoded:B})})}massSubscribe(s,d,l,f){s.forEach(b=>{this.dispatch({type:Y5.KEY_METRIC_SUBSCRIBE,metric:f5(f5(f5({userId:b.userId,type:b.type},d&&{subscribeStart:d}),l&&{subscribeEnd:l}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,d){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:Y5.RECORD_JOIN_CHANNEL_SERVICE,record:f5(f5({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Y5.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Y5.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Y5.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(s){this.dispatch({type:Y5.AVOID_JOIN_START,avoidJoinStart:s})}},roe=function(s){return s.h264="h264",s.h265="h265",s.vp8="vp8",s.vp9="vp9",s.av1="av1",s}({});(function(s){s.opus="opus",s.pcma="pcma",s.pcmu="pcmu",s.g722="g722"})({});let hDe=0;var Qme=(()=>{var s={8:(f,b,k)=>{k.r(b),k.d(b,{Parser:()=>d5,Printer:()=>aK,parse:()=>o5,print:()=>g5});const B=`
`,Wt="".concat("\r").concat(B),$O=" ";let uN;function lN(YH){return YH>="0"&&YH<="9"}function _N(YH){return YH>="!"&&YH<="~"}function TN(YH){return _N(YH)||YH>=""&&YH<="ÿ"}function vN(YH){return YH==="!"||YH>="#"&&YH<="'"||YH>="*"&&YH<="+"||YH>="-"&&YH<="."||YH>="0"&&YH<="9"||YH>="A"&&YH<="Z"||YH>="^"&&YH<="~"}function uH(YH){return YH>="1"&&YH<="9"}function rH(YH){return YH>="A"&&YH<="Z"||YH>="a"&&YH<="z"}function iH(YH){return YH==="d"||YH==="h"||YH==="m"||YH==="s"}function lH(YH){return YH>""&&YH<"	"||YH>"\v"&&YH<"\f"||YH>""&&YH<"ÿ"}function hH(YH){return rH(YH)||lN(YH)||YH==="+"||YH==="/"}function bH(YH){return lN(YH)||rH(YH)||YH==="+"||YH==="/"||YH==="-"||YH==="_"}function PH(YH){return rH(YH)||lN(YH)||YH==="+"||YH==="/"}function OH(YH,NW){var EH=Object.keys(YH);if(Object.getOwnPropertySymbols){var RH=Object.getOwnPropertySymbols(YH);NW&&(RH=RH.filter(function(ZH){return Object.getOwnPropertyDescriptor(YH,ZH).enumerable})),EH.push.apply(EH,RH)}return EH}function wH(YH){for(var NW=1;NW<arguments.length;NW++){var EH=arguments[NW]!=null?arguments[NW]:{};NW%2?OH(Object(EH),!0).forEach(function(RH){BH(YH,RH,EH[RH])}):Object.getOwnPropertyDescriptors?Object.defineProperties(YH,Object.getOwnPropertyDescriptors(EH)):OH(Object(EH)).forEach(function(RH){Object.defineProperty(YH,RH,Object.getOwnPropertyDescriptor(EH,RH))})}return YH}function BH(YH,NW,EH){return NW in YH?Object.defineProperty(YH,NW,{value:EH,enumerable:!0,configurable:!0,writable:!0}):YH[NW]=EH,YH}(function(YH){YH.VERSION="v",YH.ORIGIN="o",YH.SESSION_NAME="s",YH.INFORMATION="i",YH.URI="u",YH.EMAIL="e",YH.PHONE="p",YH.CONNECTION="c",YH.BANDWIDTH="b",YH.TIME="t",YH.REPEAT="r",YH.ZONE_ADJUSTMENTS="z",YH.KEY="k",YH.ATTRIBUTE="a",YH.MEDIA="m"})(uN||(uN={}));class XH{consumeText(NW,EH){let RH=EH;for(;RH<NW.length;){const ZH=NW[RH];if(ZH==="\0"||ZH==="\r"||ZH===B)break;RH+=1}if(RH-EH==0)throw new Error("Invalid text, at ".concat(NW));return RH}consumeUnicastAddress(NW,EH,RH){return this.consumeTill(NW,EH,$O)}consumeOneOrMore(NW,EH,RH){let ZH=EH;for(;RH(NW[ZH]);)ZH++;if(ZH-EH==0)throw new Error("Invalid rule at ".concat(EH,"."));return ZH}consumeSpace(NW,EH){if(NW[EH]===$O)return EH+1;throw new Error("Invalid space at ".concat(EH,"."))}consumeIP4Address(NW,EH){let RH=EH;for(let ZH=0;ZH<4;ZH++)if(RH=this.consumeDecimalUChar(NW,RH),ZH!==3){if(NW[RH]!==".")throw new Error("Invalid IP4 address.");RH++}return RH}consumeDecimalUChar(NW,EH){let RH=EH;for(let M5=0;M5<3&&lN(NW[RH]);M5++,RH++);if(RH-EH==0)throw new Error("Invalid decimal uchar.");const ZH=parseInt(NW.slice(EH,RH));if(ZH>=0&&ZH<=255)return RH;throw new Error("Invalid decimal uchar")}consumeIP6Address(NW,EH){let RH=this.consumeHexpart(NW,EH);return NW[RH]===":"&&(RH+=1,RH=this.consumeIP4Address(NW,RH)),RH}consumeHexpart(NW,EH){let RH=EH;if(NW[RH]===":"&&NW[RH+1]===":"){RH+=2;try{RH=this.consumeHexseq(NW,RH)}catch{}return RH}if(RH=this.consumeHexseq(NW,RH),NW[RH]===":"&&NW[RH+1]===":"){RH+=2;try{RH=this.consumeHexseq(NW,RH)}catch{}return RH}return RH}consumeHexseq(NW,EH){let RH=EH;for(;RH=this.consumeHex4(NW,RH),NW[RH]===":"&&NW[RH+1]!==":";)RH+=1;return RH}consumeHex4(NW,EH){let RH=0;for(;RH<4;RH++)if(!((ZH=NW[EH+RH])>="0"&&ZH<="9"||ZH>="a"&&ZH<="f"||ZH>="A"&&ZH<="F")){if(RH===0)throw new Error("Invalid hex 4");break}var ZH;return EH+RH}consumeFQDN(NW,EH){let RH=EH;for(;lN(NW[RH])||rH(NW[RH])||NW[RH]==="-"||NW[RH]===".";)RH+=1;if(RH-EH<4)throw new Error("Invalid FQDN");return RH}consumeExtnAddr(NW,EH){return this.consumeOneOrMore(NW,EH,TN)}consumeMulticastAddress(NW,EH,RH){switch(RH){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(NW,EH);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(NW,EH);default:try{return this.consumeFQDN(NW,EH)}catch{return this.consumeExtnAddr(NW,EH)}}}consumeIP6MulticastAddress(NW,EH){const RH=this.consumeHexpart(NW,EH);return NW[RH]==="/"?this.consumeInteger(NW,RH+1):RH}consumeIP4MulticastAddress(NW,EH){let RH=EH+3;const ZH=NW.slice(EH,RH),M5=parseInt(ZH);if(M5<224||M5>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let v6=0;v6<3;v6++){if(NW[RH]!==".")throw new Error("Invalid IP4 multicast address.");RH+=1,RH=this.consumeDecimalUChar(NW,RH)}return NW[RH]==="/"&&(RH+=1),RH=this.consumeTTL(NW,RH),NW[RH]==="/"&&(RH=this.consumeInteger(NW,RH)),RH}consumeInteger(NW,EH){if(!uH(NW[EH]))throw new Error("Invalid integer.");for(EH+=1;lN(NW[EH]);)EH+=1;return EH}consumeTTL(NW,EH){if(NW[EH]==="0")return EH+1;if(!uH(NW[EH]))throw new Error("Invalid TTL.");EH+=1;for(let RH=0;RH<2&&lN(NW[EH]);RH++)EH+=1;return EH}consumeToken(NW,EH){return this.consumeOneOrMore(NW,EH,vN)}consumeTime(NW,EH){let RH=EH;if(NW[RH]==="0")return RH+1;for(uH(NW[RH])&&(RH+=1);lN(NW[RH]);)RH++;if(RH-EH<10)throw new Error("Invalid time");return RH}consumeAddress(NW,EH){return this.consumeTill(NW,EH,$O)}consumeTypedTime(NW,EH){let RH=EH;return RH=this.consumeOneOrMore(NW,RH,lN),iH(NW[RH])?RH+1:RH}consumeRepeatInterval(NW,EH){if(!uH(NW[EH]))throw new Error("Invalid repeat interval");for(EH+=1;lN(NW[EH]);)EH+=1;return iH(NW[EH])&&(EH+=1),EH}consumePort(NW,EH){return this.consumeOneOrMore(NW,EH,lN)}consume(NW,EH,RH){for(let ZH=0;ZH<RH.length;ZH++){if(EH+ZH>=NW.length)throw new Error("consume exceeding value length");if(NW[EH+ZH]!==RH[ZH])throw new Error("consume ".concat(RH," failed at ").concat(ZH))}return EH+RH.length}consumeTill(NW,EH,RH){let ZH=EH;for(;ZH<NW.length&&(typeof RH!="string"||NW[ZH]!==RH)&&(typeof RH!="function"||!RH(NW[ZH]));)ZH++;return ZH}}class d5 extends XH{constructor(){super(),BH(this,"records",[]),BH(this,"currentLine",0)}parse(NW){const EH=this.probeEOL(NW);this.records=NW.split(EH).filter(jQ=>!!p4(jQ).call(jQ)).map(this.parseLine),this.currentLine=0;const RH=this.parseVersion(),ZH=this.parseOrigin(),M5=this.parseSessionName(),v6=this.parseInformation(),PK=this.parseUri(),i8=this.parseEmail(),B7=this.parsePhone(),FQ=this.parseConnection(),ire=this.parseBandWidth(),uae=this.parseTimeFields(),dae=this.parseKey(),$8=this.parseSessionAttribute(),ZX=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:RH,origin:ZH,sessionName:M5,information:v6,uri:PK,emails:i8,phones:B7,connection:FQ,bandwidths:ire,timeFields:uae,key:dae,attributes:$8,mediaDescriptions:ZX}}getCurrentRecord(){const NW=this.records[this.currentLine];if(!NW)throw new Error("Record doesn't exit.");return NW}probeEOL(NW){for(let EH=0;EH<NW.length;EH++)if(NW[EH]===B)return NW[EH-1]==="\r"?Wt:B;throw new Error("Invalid newline character.")}parseLine(NW,EH){if(NW.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const RH=NW[0];if(NW[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:RH,value:NW.slice(2),line:EH,cur:0}}parseSessionAttribute(){const NW=new $5;for(;this.currentLine<this.records.length;){const EH=this.getCurrentRecord();if(EH.type!==uN.ATTRIBUTE)break;const RH={attField:this.extractOneOrMore(EH,ZH=>vN(ZH)&&ZH!==":"),_cur:0};EH.value[EH.cur]===":"&&(EH.cur+=1,RH.attValue=this.extractOneOrMore(EH,lH)),NW.parse(RH),this.currentLine++}return NW.digest()}parseMediaAttributes(NW){const EH=new e6(NW);for(;this.currentLine<this.records.length;){const RH=this.getCurrentRecord();if(RH.type!==uN.ATTRIBUTE)break;const ZH={attField:this.extractOneOrMore(RH,M5=>vN(M5)&&M5!==":"),_cur:0};RH.value[RH.cur]===":"&&(RH.cur+=1,ZH.attValue=this.extractOneOrMore(RH,lH)),EH.parse(ZH),this.currentLine++}return EH.digest()}parseKey(){const NW=this.getCurrentRecord();if(NW.type===uN.KEY){if(NW.value==="prompt"||NW.value==="clear:"||NW.value==="base64:"||NW.value==="uri:")return NW.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const NW=this.getCurrentRecord();if(NW.type===uN.ZONE_ADJUSTMENTS){const EH=[];for(;;)try{const RH=this.extract(NW,this.consumeTime);this.consumeSpaceForRecord(NW);let ZH=!1;NW.value[NW.cur]==="-"&&(ZH=!0,NW.cur+=1);const M5=this.extract(NW,this.consumeTypedTime);EH.push({time:RH,typedTime:M5,back:ZH})}catch{break}if(EH.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,EH}return[]}parseRepeat(){const NW=[];for(;;){const EH=this.getCurrentRecord();if(EH.type!==uN.REPEAT)break;{const RH=this.extract(EH,this.consumeRepeatInterval),ZH=this.parseTypedTime(EH);NW.push({repeatInterval:RH,typedTimes:ZH}),this.currentLine++}}return NW}parseTypedTime(NW){const EH=[];for(;;)try{this.consumeSpaceForRecord(NW),EH.push(this.extract(NW,this.consumeTypedTime))}catch{break}if(EH.length===0)throw new Error("Invalid typed time.");return EH}parseTime(){const NW=this.getCurrentRecord(),EH=this.extract(NW,this.consumeTime);this.consumeSpaceForRecord(NW);const RH=this.extract(NW,this.consumeTime);return this.currentLine++,{startTime:EH,stopTime:RH}}parseBandWidth(){const NW=[];for(;this.currentLine<this.records.length;){const EH=this.getCurrentRecord();if(EH.type!==uN.BANDWIDTH)break;{const RH=this.extractOneOrMore(EH,vN);if(EH.value[EH.cur]!==":")throw new Error("Invalid bandwidth field.");EH.cur++;const ZH=this.extractOneOrMore(EH,lN);NW.push({bwtype:RH,bandwidth:ZH}),this.currentLine++}}return NW}parseVersion(){const NW=this.getCurrentRecord();if(NW.type!==uN.VERSION)throw new Error("first sdp record must be version");const EH=NW.value.slice(0,this.consumeOneOrMore(NW.value,0,lN));if(EH.length!==NW.value.length)throw new Error('invalid proto version, "v='.concat(NW.value,'"'));return this.currentLine++,EH}parseOrigin(){const NW=this.getCurrentRecord();if(NW.type!==uN.ORIGIN)throw new Error("second line of sdp must be origin");const EH=this.extractOneOrMore(NW,TN);this.consumeSpaceForRecord(NW);const RH=this.extractOneOrMore(NW,lN);this.consumeSpaceForRecord(NW);const ZH=this.extractOneOrMore(NW,lN);this.consumeSpaceForRecord(NW);const M5=this.extractOneOrMore(NW,vN);this.consumeSpaceForRecord(NW);const v6=this.extractOneOrMore(NW,vN);this.consumeSpaceForRecord(NW);const PK=this.extract(NW,this.consumeUnicastAddress);return this.currentLine++,{username:EH,sessId:RH,sessVersion:ZH,nettype:M5,addrtype:v6,unicastAddress:PK}}parseSessionName(){const NW=this.getCurrentRecord();if(NW.type===uN.SESSION_NAME){const EH=this.extract(NW,this.consumeText);return this.currentLine++,EH}}parseInformation(){const NW=this.getCurrentRecord();if(NW.type!==uN.INFORMATION)return;const EH=this.extract(NW,this.consumeText);return this.currentLine++,EH}parseUri(){const NW=this.getCurrentRecord();if(NW.type===uN.URI)return this.currentLine++,NW.value}parseEmail(){const NW=[];for(;;){const EH=this.getCurrentRecord();if(EH.type!==uN.EMAIL)break;NW.push(EH.value),this.currentLine++}return NW}parsePhone(){const NW=[];for(;;){const EH=this.getCurrentRecord();if(EH.type!==uN.PHONE)break;NW.push(EH.value),this.currentLine++}return NW}parseConnection(){const NW=this.getCurrentRecord();if(NW.type===uN.CONNECTION){const EH=this.extractOneOrMore(NW,vN);this.consumeSpaceForRecord(NW);const RH=this.extractOneOrMore(NW,vN);this.consumeSpaceForRecord(NW);const ZH=this.extract(NW,this.consumeAddress);return this.currentLine++,{nettype:EH,addrtype:RH,address:ZH}}}parseMedia(){const NW=this.getCurrentRecord(),EH=this.extract(NW,this.consumeToken);this.consumeSpaceForRecord(NW);let RH=this.extract(NW,this.consumePort);NW.value[NW.cur]==="/"&&(NW.cur+=1,RH+=this.extract(NW,this.consumeInteger)),this.consumeSpaceForRecord(NW);const ZH=[];for(ZH.push(this.extract(NW,this.consumeToken));NW.value[NW.cur]==="/";)NW.cur+=1,ZH.push(this.extract(NW,this.consumeToken));if(ZH.length===0)throw new Error("Invalid proto");const M5=this.parseFmt(NW);return this.currentLine++,{mediaType:EH,port:RH,protos:ZH,fmts:M5}}parseTimeFields(){const NW=[];for(;this.getCurrentRecord().type===uN.TIME;){const EH=this.parseTime(),RH=this.parseRepeat(),ZH=this.parseZone();NW.push({time:EH,repeats:RH,zones:ZH})}return NW}parseMediaDescription(){const NW=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===uN.MEDIA;){const EH=this.parseMedia(),RH=this.parseInformation(),ZH=this.parseConnections(),M5=this.parseBandWidth(),v6=this.parseKey(),PK=this.parseMediaAttributes(EH);NW.push({media:EH,information:RH,connections:ZH,bandwidths:M5,key:v6,attributes:PK})}return NW}parseConnections(){const NW=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===uN.CONNECTION;)NW.push(this.parseConnection());return NW}parseFmt(NW){const EH=[];for(;;)try{this.consumeSpaceForRecord(NW),EH.push(this.extract(NW,this.consumeToken))}catch{break}if(EH.length===0)throw new Error("Invalid fmts");return EH}extract(NW,EH){for(var RH=arguments.length,ZH=new Array(RH>2?RH-2:0),M5=2;M5<RH;M5++)ZH[M5-2]=arguments[M5];const v6=EH.call(this,NW.value,NW.cur,...ZH),PK=NW.value.slice(NW.cur,v6);return NW.cur=v6,PK}extractOneOrMore(NW,EH){const RH=this.consumeOneOrMore(NW.value,NW.cur,EH),ZH=NW.value.slice(NW.cur,RH);return NW.cur=RH,ZH}consumeSpaceForRecord(NW){if(NW.value[NW.cur]!==$O)throw new Error("Invalid space at ".concat(NW.cur,"."));NW.cur+=1}}class p5 extends XH{constructor(){super(...arguments),BH(this,"attributes",void 0),BH(this,"digested",!1)}extractOneOrMore(NW,EH,RH){const ZH=this.consumeOneOrMore(NW.attValue,NW._cur,EH),M5=NW.attValue.slice(NW._cur,ZH),[v6,PK]=RH||[];if(typeof v6=="number"&&M5.length<v6)throw new Error("error in length, should be more or equal than ".concat(v6," characters."));if(typeof PK=="number"&&M5.length>PK)throw new Error("error in length, should be less or equal than ".concat(PK," characters."));return NW._cur=ZH,M5}consumeAttributeSpace(NW){if(NW.attValue[NW._cur]!==$O)throw new Error("Invalid space at ".concat(NW._cur,"."));NW._cur+=1}extract(NW,EH){if(!NW.attValue)throw new Error("Nothing to extract from attValue.");for(var RH=arguments.length,ZH=new Array(RH>2?RH-2:0),M5=2;M5<RH;M5++)ZH[M5-2]=arguments[M5];const v6=EH.call(this,NW.attValue,NW._cur,...ZH),PK=NW.attValue.slice(NW._cur,v6);return NW._cur=v6,PK}atEnd(NW){if(!NW.attValue)throw new Error;return NW._cur>=NW.attValue.length}peekChar(NW){if(!NW.attValue)throw new Error;return NW.attValue[NW._cur]}peek(NW,EH){if(!NW.attValue)throw new Error;for(let RH=0;RH<EH.length;RH++)if(EH[RH]!==NW.attValue[NW._cur+RH])return!1;return!0}parseIceUfrag(NW){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(NW,hH,[4,256])}parseIcePwd(NW){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(NW,hH,[22,256])}parseIceOptions(NW){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const EH=[];for(;!this.atEnd(NW);){EH.push(this.extractOneOrMore(NW,hH));try{this.consumeAttributeSpace(NW)}catch(RH){if(this.atEnd(NW))break;throw RH}}this.attributes.iceOptions=EH}parseFingerprint(NW){const EH=this.extract(NW,this.consumeToken);this.consumeAttributeSpace(NW);const RH=this.extract(NW,this.consumeTill);this.attributes.fingerprints.push({hashFunction:EH,fingerprint:RH})}parseExtmap(NW){const EH=this.extractOneOrMore(NW,lN);let RH;this.peekChar(NW)==="/"&&(this.extract(NW,this.consume,"/"),RH=this.extract(NW,this.consumeToken)),this.consumeAttributeSpace(NW);const ZH=this.extract(NW,this.consumeTill,$O),M5=wH(wH({entry:parseInt(EH,10)},RH&&{direction:RH}),{},{extensionName:ZH});this.peekChar(NW)===$O&&(this.consumeAttributeSpace(NW),M5.extensionAttributes=this.extract(NW,this.consumeTill)),this.attributes.extmaps.push(M5)}parseSetup(NW){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const EH=this.extract(NW,this.consumeTill);if(EH!=="active"&&EH!=="passive"&&EH!=="actpass"&&EH!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=EH}}class $5 extends p5{constructor(){super(...arguments),BH(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(NW){if(this.digested)throw new Error("already digested");try{switch(NW.attField){case"group":this.parseGroup(NW);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(NW);break;case"ice-pwd":this.parseIcePwd(NW);break;case"ice-options":this.parseIceOptions(NW);break;case"fingerprint":this.parseFingerprint(NW);break;case"setup":this.parseSetup(NW);break;case"tls-id":this.parseTlsId(NW);break;case"identity":this.parseIdentity(NW);break;case"extmap":this.parseExtmap(NW);break;case"msid-semantic":this.parseMsidSemantic(NW);break;default:NW.ignored=!0,this.attributes.unrecognized.push(NW)}}catch(EH){throw console.error("parsing session attribute ".concat(NW.attField,' error, "a=').concat(NW.attField,":").concat(NW.attValue,'"')),EH}if(!NW.ignored&&NW.attValue&&!this.atEnd(NW))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(NW){const EH=this.extract(NW,this.consumeToken),RH=[];for(;!this.atEnd(NW)&&this.peekChar(NW)===$O;)this.consumeAttributeSpace(NW),RH.push(this.extract(NW,this.consumeToken));this.attributes.groups.push({semantic:EH,identificationTag:RH})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(NW){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(NW,bH)}parseIdentity(NW){const EH=this.extractOneOrMore(NW,PH),RH=[];for(;!this.atEnd(NW)&&this.peekChar(NW)===$O;){this.consumeAttributeSpace(NW);const ZH=this.extract(NW,this.consumeToken);this.extract(NW,this.consume,"=");const M5=this.extractOneOrMore(NW,v6=>v6!==$O&&lH(v6));RH.push({name:ZH,value:M5})}this.attributes.identities.push({assertionValue:EH,extensions:RH})}parseMsidSemantic(NW){this.peekChar(NW)===$O&&this.consumeAttributeSpace(NW);const EH={semantic:this.extract(NW,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(NW)}catch{break}if(this.peekChar(NW)==="*"){this.extract(NW,this.consume,"*"),EH.applyForAll=!0;break}{const RH=this.extract(NW,this.consumeTill,$O);EH.identifierList.push(RH)}}this.attributes.msidSemantic=EH}}class e6 extends p5{constructor(NW){super(),BH(this,"attributes",void 0),NW.protos.indexOf("RTP")!==-1||NW.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(NW){if(this.digested)throw new Error("already digested");try{switch(NW.attField){case"extmap":this.parseExtmap(NW);break;case"setup":this.parseSetup(NW);break;case"ice-ufrag":this.parseIceUfrag(NW);break;case"ice-pwd":this.parseIcePwd(NW);break;case"ice-options":this.parseIceOptions(NW);break;case"candidate":this.parseCandidate(NW);break;case"remote-candidate":this.parseRemoteCandidate(NW);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(NW);break;case"rtpmap":this.parseRtpmap(NW);break;case"ptime":this.parsePtime(NW);break;case"maxptime":this.parseMaxPtime(NW);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(NW);break;case"ssrc":this.parseSSRC(NW);break;case"fmtp":this.parseFmtp(NW);break;case"rtcp-fb":this.parseRtcpFb(NW);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(NW);break;case"mid":this.parseMid(NW);break;case"msid":this.parseMsid(NW);break;case"imageattr":this.parseImageAttr(NW);break;case"rid":this.parseRid(NW);break;case"simulcast":this.parseSimulcast(NW);break;case"sctp-port":this.parseSctpPort(NW);break;case"max-message-size":this.parseMaxMessageSize(NW);break;case"ssrc-group":this.parseSSRCGroup(NW);break;default:NW.ignored=!0,this.attributes.unrecognized.push(NW)}}catch(EH){throw console.error("parsing media attribute ".concat(NW.attField,' error, "a=').concat(NW.attField,":").concat(NW.attValue,'"')),EH}if(!NW.ignored&&NW.attValue&&!this.atEnd(NW))throw new Error("attribute parsing error")}parseCandidate(NW){const EH=this.extractOneOrMore(NW,hH,[1,32]);this.consumeAttributeSpace(NW);const RH=this.extractOneOrMore(NW,lN,[1,5]);this.consumeAttributeSpace(NW);const ZH=this.extract(NW,this.consumeToken);this.consumeAttributeSpace(NW);const M5=this.extractOneOrMore(NW,lN,[1,10]);this.consumeAttributeSpace(NW);const v6=this.extract(NW,this.consumeAddress);this.consumeAttributeSpace(NW);const PK=this.extract(NW,this.consumePort);this.consumeAttributeSpace(NW),this.extract(NW,this.consume,"typ"),this.consumeAttributeSpace(NW);const i8={foundation:EH,componentId:RH,transport:ZH,priority:M5,connectionAddress:v6,port:PK,type:this.extract(NW,this.consumeToken),extension:{}};for(this.peek(NW," raddr")&&(this.extract(NW,this.consume," raddr"),this.consumeAttributeSpace(NW),i8.relAddr=this.extract(NW,this.consumeAddress)),this.peek(NW," rport")&&(this.extract(NW,this.consume," rport"),this.consumeAttributeSpace(NW),i8.relPort=this.extract(NW,this.consumePort));this.peekChar(NW)===$O;){this.consumeAttributeSpace(NW);const B7=this.extract(NW,this.consumeToken);this.consumeAttributeSpace(NW),i8.extension[B7]=this.extractOneOrMore(NW,_N)}this.attributes.candidates.push(i8)}parseRemoteCandidate(NW){const EH=[];for(;;){const RH=this.extractOneOrMore(NW,lN,[1,5]);this.consumeAttributeSpace(NW);const ZH=this.extract(NW,this.consumeAddress);this.consumeAttributeSpace(NW);const M5=this.extract(NW,this.consumePort);EH.push({componentId:RH,connectionAddress:ZH,port:M5});try{this.consumeAttributeSpace(NW)}catch{break}}this.attributes.remoteCandidatesList.push(EH)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(NW){const EH=this.extract(NW,this.consumeToken);this.consumeAttributeSpace(NW);const RH=this.extract(NW,this.consumeTill,"/");this.extract(NW,this.consume,"/");const ZH={encodingName:RH,clockRate:this.extractOneOrMore(NW,lN)};this.atEnd(NW)||this.peekChar(NW)!=="/"||(this.extract(NW,this.consume,"/"),ZH.encodingParameters=parseInt(this.extract(NW,this.consumeTill),10));const M5=this.attributes.payloads.find(v6=>v6.payloadType===parseInt(EH,10));M5?M5.rtpMap=ZH:this.attributes.payloads.push({payloadType:parseInt(EH,10),rtpMap:ZH,rtcpFeedbacks:[]})}parsePtime(NW){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(NW,this.consumeTill)}parseMaxPtime(NW){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(NW,this.consumeTill)}parseDirection(NW){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=NW.attField}parseSSRC(NW){const EH=this.extractOneOrMore(NW,lN);this.consumeAttributeSpace(NW);const RH=this.extract(NW,this.consumeTill,":");let ZH;this.peekChar(NW)===":"&&(this.extract(NW,this.consume,":"),ZH=this.extract(NW,this.consumeTill));const M5=this.attributes.ssrcs.find(v6=>v6.ssrcId===parseInt(EH,10));M5?M5.attributes[RH]=ZH:this.attributes.ssrcs.push({ssrcId:parseInt(EH,10),attributes:{[RH]:ZH}})}parseFmtp(NW){const EH=this.extract(NW,this.consumeTill,$O);this.consumeAttributeSpace(NW);const RH=this.extract(NW,this.consumeTill),ZH={};RH.split(";").forEach(v6=>{let[PK,i8]=v6.split("=");PK=p4(PK).call(PK);const B7=typeof i8=="string"?p4(i8).call(i8):null;typeof PK=="string"&&PK.length>0&&(ZH[PK]=B7)});const M5=this.attributes.payloads.find(v6=>v6.payloadType===parseInt(EH,10));M5?M5.fmtp={parameters:ZH}:this.attributes.payloads.push({payloadType:parseInt(EH,10),rtcpFeedbacks:[],fmtp:{parameters:ZH}})}parseFmtParameters(NW){const EH={},RH=this.extract(NW,this.consumeTill,"=");NW._cur++;const ZH=this.extract(NW,this.consumeTill,";");for(EH[RH]=ZH;NW.attValue[NW._cur]===";";){const M5=this.extract(NW,this.consumeTill,"=");NW._cur++;const v6=this.extract(NW,this.consumeTill,";");EH[M5]=v6}return EH}parseRtcpFb(NW){let EH="";EH=this.peekChar(NW)==="*"?this.extract(NW,this.consume,"*"):this.extract(NW,this.consumeTill,$O),this.consumeAttributeSpace(NW);const RH=this.extract(NW,this.consumeTill,$O);let ZH;if(RH==="trr-int")ZH={type:RH,interval:this.extract(NW,this.consumeTill)};else{const M5={type:RH};this.peekChar(NW)===$O&&(this.consumeAttributeSpace(NW),M5.parameter=this.extract(NW,this.consumeToken),this.peekChar(NW)===$O&&(M5.additional=this.extract(NW,this.consumeTill))),ZH=M5}if(EH==="*")this.attributes.rtcpFeedbackWildcards.push(ZH);else{const M5=this.attributes.payloads.find(v6=>v6.payloadType===parseInt(EH,10));M5?M5.rtcpFeedbacks.push(ZH):this.attributes.payloads.push({payloadType:parseInt(EH,10),rtcpFeedbacks:[ZH]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(NW){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const EH={port:this.extract(NW,this.consumePort)};this.peekChar(NW)===$O&&(this.consumeAttributeSpace(NW),EH.netType=this.extractOneOrMore(NW,vN),this.consumeAttributeSpace(NW),EH.addressType=this.extractOneOrMore(NW,vN),this.consumeAttributeSpace(NW),EH.address=this.extract(NW,this.consumeAddress)),this.attributes.rtcp=EH}parseMsid(NW){const EH={id:this.extractOneOrMore(NW,vN,[1,64])};this.peekChar(NW)===$O&&(this.consumeAttributeSpace(NW),EH.appdata=this.extractOneOrMore(NW,vN,[1,64])),this.attributes.msids.push(EH)}parseImageAttr(NW){this.attributes.imageattr.push(NW.attValue)}parseRid(NW){const EH=this.extractOneOrMore(NW,ZH=>rH(ZH)||lN(ZH)||ZH==="_"||ZH==="-");this.consumeAttributeSpace(NW);const RH={id:EH,direction:this.extract(NW,this.consumeToken),params:[]};if(this.peekChar(NW)===$O){if(this.consumeAttributeSpace(NW),this.peek(NW,"pt=")){this.extract(NW,this.consume,"pt=");const ZH=[];for(;;){const M5=this.extract(NW,this.consumeToken);ZH.push(M5);try{this.extract(NW,this.consume,",")}catch{break}}RH.payloads=ZH,this.peekChar(NW)===$O&&this.extract(NW,this.consume,$O)}for(;;){const ZH=this.extract(NW,this.consumeToken);switch(ZH){case"depend":{const M5={type:ZH,rids:this.extract(NW,this.consume,"=").split(",")};RH.params.push(M5);break}default:{const M5={type:ZH};this.peekChar(NW)==="="&&(this.extract(NW,this.consume,"="),M5.val=this.extract(NW,this.consumeTill,";")),RH.params.push(M5)}}try{this.extract(NW,this.consume,";")}catch{break}}}this.attributes.rids.push(RH)}parseSimulcast(NW){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=NW.attValue,this.extract(NW,this.consumeTill)}parseSctpPort(NW){this.attributes.sctpPort=this.extractOneOrMore(NW,lN,[1,5])}parseMaxMessageSize(NW){this.attributes.maxMessageSize=this.extractOneOrMore(NW,lN,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(NW){this.attributes.mid=this.extract(NW,this.consumeToken)}parseSSRCGroup(NW){const EH=this.extract(NW,this.consumeToken),RH=[];for(;;)try{this.consumeAttributeSpace(NW);const ZH=this.extract(NW,this.consumeInteger);RH.push(parseInt(ZH,10))}catch{break}this.attributes.ssrcGroups.push({semantic:EH,ssrcIds:RH})}}function N6(YH,NW,EH){return NW in YH?Object.defineProperty(YH,NW,{value:EH,enumerable:!0,configurable:!0,writable:!0}):YH[NW]=EH,YH}class aK{constructor(){N6(this,"eol",Wt)}print(NW,EH){let RH="";return EH&&(this.eol=EH),RH+=this.printVersion(NW.version),RH+=this.printOrigin(NW.origin),RH+=this.printSessionName(NW.sessionName),RH+=this.printInformation(NW.information),RH+=this.printUri(NW.uri),RH+=this.printEmail(NW.emails),RH+=this.printPhone(NW.phones),RH+=this.printConnection(NW.connection),RH+=this.printBandwidth(NW.bandwidths),RH+=this.printTimeFields(NW.timeFields),RH+=this.printKey(NW.key),RH+=this.printSessionAttributes(NW.attributes),RH+=this.printMediaDescription(NW.mediaDescriptions),RH}printVersion(NW){return"v=".concat(NW).concat(this.eol)}printOrigin(NW){return"o=".concat(NW.username," ").concat(NW.sessId," ").concat(NW.sessVersion," ").concat(NW.nettype," ").concat(NW.addrtype," ").concat(NW.unicastAddress).concat(this.eol)}printSessionName(NW){return NW?"s=".concat(NW).concat(this.eol):""}printInformation(NW){return NW?"i=".concat(NW).concat(this.eol):""}printUri(NW){return NW?"u=".concat(NW).concat(this.eol):""}printEmail(NW){let EH="";for(const RH of NW)EH+="e=".concat(RH).concat(this.eol);return EH}printPhone(NW){let EH="";for(const RH of NW)EH+="e=".concat(RH).concat(this.eol);return EH}printConnection(NW){return NW?"c=".concat(NW.nettype," ").concat(NW.addrtype," ").concat(NW.address).concat(this.eol):""}printBandwidth(NW){let EH="";for(const RH of NW)EH+="b=".concat(RH.bwtype,":").concat(RH.bandwidth).concat(this.eol);return EH}printTimeFields(NW){let EH="";for(const RH of NW){EH+="t=".concat(RH.time.startTime," ").concat(RH.time.startTime).concat(this.eol);for(const ZH of RH.repeats)EH+="r=".concat(ZH.repeatInterval," ").concat(ZH.typedTimes.join(" ")).concat(this.eol);RH.zoneAdjustments&&(EH+="z=",EH+="z=".concat(RH.zoneAdjustments.map(ZH=>"".concat(ZH.time," ").concat(ZH.back?"-":""," ").concat(ZH.typedTime)).join(" ")).concat(this.eol),EH+=this.eol)}return EH}printKey(NW){return NW?"k=".concat(NW).concat(this.eol):""}printAttributes(NW){let EH="";for(const RH of NW)EH+="a=".concat(RH.attField).concat(RH.attValue?":".concat(RH.attValue):"").concat(this.eol);return EH}printMediaDescription(NW){let EH="";for(const RH of NW)EH+=this.printMedia(RH.media),EH+=this.printInformation(RH.information),EH+=this.printConnections(RH.connections),EH+=this.printBandwidth(RH.bandwidths),EH+=this.printKey(RH.key),EH+=this.printMediaAttributes(RH);return EH}printConnections(NW){let EH="";for(const RH of NW)EH+=this.printConnection(RH);return EH}printMedia(NW){return"m=".concat(NW.mediaType," ").concat(NW.port," ").concat(NW.protos.join("/")," ").concat(NW.fmts.join(" ")).concat(this.eol)}printSessionAttributes(NW){return new H4(this.eol).print(NW)}printMediaAttributes(NW){return new qH(this.eol).print(NW)}}class eK{constructor(NW){N6(this,"eol",void 0),this.eol=NW}printIceUfrag(NW){return NW===void 0?"":"a=ice-ufrag:".concat(NW).concat(this.eol)}printIcePwd(NW){return NW===void 0?"":"a=ice-pwd:".concat(NW).concat(this.eol)}printIceOptions(NW){return NW===void 0?"":"a=ice-options:".concat(NW.join($O)).concat(this.eol)}printFingerprints(NW){return NW.length>0?NW.map(EH=>"a=fingerprint:".concat(EH.hashFunction).concat($O).concat(EH.fingerprint)).join(this.eol)+this.eol:""}printExtmap(NW){return NW.map(EH=>"a=extmap:".concat(EH.entry).concat(EH.direction?"/".concat(EH.direction):"").concat($O).concat(EH.extensionName).concat(EH.extensionAttributes?"".concat($O).concat(EH.extensionAttributes):"").concat(this.eol)).join("")}printSetup(NW){return NW===void 0?"":"a=setup:".concat(NW).concat(this.eol)}printUnrecognized(NW){return NW.map(EH=>"a=".concat(EH.attField).concat(EH.attValue?":".concat(EH.attValue):"").concat(this.eol)).join("")}}class H4 extends eK{print(NW){let EH="";return EH+=this.printGroups(NW.groups),EH+=this.printMsidSemantic(NW.msidSemantic),EH+=this.printIceLite(NW.iceLite),EH+=this.printIceUfrag(NW.iceUfrag),EH+=this.printIcePwd(NW.icePwd),EH+=this.printIceOptions(NW.iceOptions),EH+=this.printFingerprints(NW.fingerprints),EH+=this.printSetup(NW.setup),EH+=this.printTlsId(NW.tlsId),EH+=this.printIdentity(NW.identities),EH+=this.printExtmap(NW.extmaps),EH+=this.printUnrecognized(NW.unrecognized),EH}printGroups(NW){let EH="";return NW.length>0&&(EH+=NW.map(RH=>"a=group:".concat(RH.semantic).concat(RH.identificationTag.map(ZH=>"".concat($O).concat(ZH)).join("")).concat(this.eol)).join("")),EH}printIceLite(NW){return NW===void 0?"":"a=ice-lite"+this.eol}printTlsId(NW){return NW?"a=tls-id:".concat(NW).concat(this.eol):""}printIdentity(NW){return NW.length===0?"":NW.map(EH=>"a=identity:".concat(EH.assertionValue).concat(EH.extensions.map(RH=>"".concat($O).concat(RH.name).concat(RH.value?"=".concat(RH.value):"")))).join(this.eol)+this.eol}printMsidSemantic(NW){if(!NW)return"";let EH="a=msid-semantic:".concat(NW.semantic);return NW.applyForAll?EH+="".concat($O,"*"):NW.identifierList.length>0&&(EH+=NW.identifierList.map(RH=>"".concat($O).concat(RH))),EH+this.eol}}class qH extends eK{print(NW){const EH=NW.attributes;let RH="";return RH+=this.printRTCP(EH.rtcp),RH+=this.printIceUfrag(EH.iceUfrag),RH+=this.printIcePwd(EH.icePwd),RH+=this.printIceOptions(EH.iceOptions),RH+=this.printCandidates(EH.candidates),RH+=this.printRemoteCandidatesList(EH.remoteCandidatesList),RH+=this.printEndOfCandidates(EH.endOfCandidates),RH+=this.printFingerprints(EH.fingerprints),RH+=this.printSetup(EH.setup),RH+=this.printMid(EH.mid),RH+=this.printExtmap(EH.extmaps),RH+=this.printRTPRelated(EH),RH+=this.printPtime(EH.ptime),RH+=this.printMaxPtime(EH.maxPtime),RH+=this.printDirection(EH.direction),RH+=this.printSSRCGroups(EH.ssrcGroups),RH+=this.printSSRC(EH.ssrcs),RH+=this.printRTCPMux(EH.rtcpMux),RH+=this.printRTCPMuxOnly(EH.rtcpMuxOnly),RH+=this.printRTCPRsize(EH.rtcpRsize),RH+=this.printMSId(EH.msids),RH+=this.printImageattr(EH.imageattr),RH+=this.printRid(EH.rids),RH+=this.printSimulcast(EH.simulcast),RH+=this.printSCTPPort(EH.sctpPort),RH+=this.printMaxMessageSize(EH.maxMessageSize),RH+=this.printUnrecognized(EH.unrecognized),RH}printCandidates(NW){return NW.map(EH=>"a=candidate:".concat(EH.foundation).concat($O).concat(EH.componentId).concat($O).concat(EH.transport).concat($O).concat(EH.priority).concat($O).concat(EH.connectionAddress).concat($O).concat(EH.port).concat($O,"typ").concat($O).concat(EH.type).concat(EH.relAddr?"".concat($O,"raddr").concat($O).concat(EH.relAddr):"").concat(EH.relPort?"".concat($O,"rport").concat($O).concat(EH.relPort):"").concat(Object.keys(EH.extension).map(RH=>"".concat($O).concat(RH).concat($O).concat(EH.extension[RH])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(NW){return NW.map(EH=>"a=remote-candidates:".concat(EH.join($O)).concat(this.eol)).join("")}printEndOfCandidates(NW){return NW===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(NW){if(!NW.payloads)return"";const EH=NW.payloads;let RH="";RH+=NW.rtcpFeedbackWildcards.map(ZH=>this.printRTCPFeedback("*",ZH)).join("");for(const ZH of EH)RH+=this.printRtpMap(ZH.payloadType,ZH.rtpMap),RH+=this.printFmtp(ZH.payloadType,ZH.fmtp),RH+=ZH.rtcpFeedbacks.map(M5=>this.printRTCPFeedback(ZH.payloadType,M5)).join("");return RH}printFmtp(NW,EH){if(!EH)return"";const RH=Object.keys(EH.parameters);return RH.length===1&&EH.parameters[RH[0]]===null?"a=fmtp:".concat(NW).concat($O).concat(RH[0]).concat(this.eol):"a=fmtp:".concat(NW).concat($O).concat(Object.keys(EH.parameters).map(ZH=>"".concat(ZH,"=").concat(EH.parameters[ZH])).join(";")).concat(this.eol)}printRtpMap(NW,EH){return EH?"a=rtpmap:".concat(NW).concat($O).concat(EH.encodingName,"/").concat(EH.clockRate).concat(EH.encodingParameters?"/".concat(EH.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(NW,EH){let RH="a=rtcp-fb:".concat(NW).concat($O),ZH=EH;return ZH.type==="trr-int"?RH+="ttr-int".concat($O).concat(ZH.interval):(RH+="".concat(ZH.type),ZH.parameter&&(RH+="".concat($O).concat(ZH.parameter),ZH.additional&&(RH+="".concat($O).concat(ZH.additional)))),RH+this.eol}printPtime(NW){return NW===void 0?"":"a=ptime:".concat(NW).concat(this.eol)}printMaxPtime(NW){return NW===void 0?"":"a=maxptime:".concat(NW).concat(this.eol)}printDirection(NW){return NW===void 0?"":"a=".concat(NW).concat(this.eol)}printSSRC(NW){return NW.map(EH=>Object.keys(EH.attributes).map(RH=>"a=ssrc:".concat(EH.ssrcId.toString(10)).concat($O).concat(RH).concat(EH.attributes[RH]?":".concat(EH.attributes[RH]):"").concat(this.eol)).join("")).join("")}printRTCPMux(NW){return NW===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(NW){return NW===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(NW){return NW===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(NW){if(NW===void 0)return"";let EH="a=rtcp:".concat(NW.port);return NW.netType&&(EH+="".concat($O).concat(NW.netType)),NW.addressType&&(EH+="".concat($O).concat(NW.addressType)),NW.address&&(EH+="".concat($O).concat(NW.address)),EH+this.eol}printMSId(NW){return NW.map(EH=>"a=msid:".concat(EH.id).concat(EH.appdata?"".concat($O).concat(EH.appdata):"").concat(this.eol)).join("")}printImageattr(NW){return NW.map(EH=>"a=imageattr:".concat(EH).concat(this.eol)).join("")}printRid(NW){return NW.map(EH=>{let RH="a=rid:".concat(EH.id).concat($O).concat(EH.direction);return EH.payloads&&(RH+="".concat($O,"pt=").concat(EH.payloads.join(","))),EH.params.length>0&&(RH+="".concat($O).concat(EH.params.map(ZH=>ZH.type==="depend"?"depend=".concat(ZH.rids.join(",")):"".concat(ZH.type,"=").concat(ZH.val)).join(";"))),RH+this.eol}).join("")}printSimulcast(NW){return NW===void 0?"":"a=simulcast:".concat(NW).concat(this.eol)}printSCTPPort(NW){return NW===void 0?"":"a=sctp-port:".concat(NW).concat(this.eol)}printMaxMessageSize(NW){return NW===void 0?"":"a=max-message-size:".concat(NW).concat(this.eol)}printMid(NW){return NW===void 0?"":"a=mid:".concat(NW).concat(this.eol)}printSSRCGroups(NW){return NW.map(EH=>"a=ssrc-group:".concat(EH.semantic).concat(EH.ssrcIds.map(RH=>"".concat($O).concat(RH.toString(10))).join("")).concat(this.eol)).join("")}}function o5(YH){return new d5().parse(YH)}function g5(YH,NW){return new aK().print(YH,NW)}}},d={};function l(f){if(d[f])return d[f].exports;var b=d[f]={exports:{}};return s[f](b,b.exports,l),b.exports}return l.d=(f,b)=>{for(var k in b)l.o(b,k)&&!l.o(f,k)&&Object.defineProperty(f,k,{enumerable:!0,get:b[k]})},l.o=(f,b)=>Object.prototype.hasOwnProperty.call(f,b),l.r=f=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},l(8)})();function $4(s){return Qme.parse(s)}function UX(s,d){return Qme.print(s,d)}var pDe=l4("Array","keys"),fDe=eY,_De=kK,EDe=dN,mDe=pDe,kde=Array.prototype,gDe={DOMTokenList:!0,NodeList:!0},TDe=function(s){var d=s.keys;return s===kde||EDe(kde,s)&&d===kde.keys||_De(gDe,fDe(s))?mDe:d},v8=h(TDe);function J6(s,d,l){return(d=function(f){var b=function(k){if(typeof k!="object"||!k)return k;var B=k[Symbol.toPrimitive];if(B!==void 0){var Wt=B.call(k,"string");if(typeof Wt!="object")return Wt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(k)}(f);return typeof b=="symbol"?b:b+""}(d))in s?Object.defineProperty(s,d,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[d]=l,s}function Zme(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function F5(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?Zme(Object(l),!0).forEach(function(f){J6(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):Zme(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const $me=new class extends W6{constructor(){super(...arguments),J6(this,"currentUploadLogID",0)}reportLogUploadError(s){const{errorRange:d}=s;d[d.length-1]&&d[d.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=d[d.length-1],this.emit("REPORT_LOG_UPLOAD",s))}};class SDe{constructor(d){J6(this,"logger",void 0),J6(this,"prefixLists",[]),this.logger=d}debug(){for(var d=arguments.length,l=new Array(d),f=0;f<d;f++)l[f]=arguments[f];this.logger.debug(...this.prefixLists,...l)}info(){for(var d=arguments.length,l=new Array(d),f=0;f<d;f++)l[f]=arguments[f];this.logger.info(...this.prefixLists,...l)}warning(){for(var d=arguments.length,l=new Array(d),f=0;f<d;f++)l[f]=arguments[f];this.logger.warning(...this.prefixLists,...l)}error(){for(var d=arguments.length,l=new Array(d),f=0;f<d;f++)l[f]=arguments[f];this.logger.error(...this.prefixLists,...l)}prefix(d){return this.prefixLists.push(d),this}popPrefix(){return this.prefixLists.pop(),this}}function Lde(){const s=new Date;return s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}function ege(){const s=new Date,d=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return d?(d==null?void 0:d[0])+":"+s.getUTCMilliseconds():s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}const K8={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},ioe=Date.now(),Rne=s=>{for(const d in K8)if(Object.prototype.hasOwnProperty.call(K8,d)&&K8[d]===s)return d;return"DEFAULT"},CN=new class{constructor(){J6(this,"proxyServerURL",void 0),J6(this,"logLevel",K8.DEBUG),J6(this,"uploadState","collecting"),J6(this,"uploadLogWaitingList",[]),J6(this,"uploadLogUploadingList",[]),J6(this,"uploadErrorCount",0),J6(this,"currentLogID",0),J6(this,"url",void 0),J6(this,"extLog",(s,d)=>{this.appendLogToWaitingList(s,...d)})}debug(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];const f=[K8.DEBUG].concat(d);this.log.apply(this,f)}info(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];const f=[K8.INFO].concat(d);this.log.apply(this,f)}warning(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];const f=[K8.WARNING].concat(d);this.log.apply(this,f)}warn(){this.warning(...arguments)}error(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];const f=[K8.ERROR].concat(d);this.log.apply(this,f)}upload(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];const f=[K8.DEBUG].concat(d);this.uploadLog.apply(this,f)}setLogLevel(s){s=Math.min(Math.max(0,s),4),this.logLevel=s}enableLogUpload(){S6("UPLOAD_LOG",!0)}disableLogUpload(){S6("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(s){this.proxyServerURL=s}prefix(s){return new SDe(this).prefix(s)}log(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];if(Date.now()-ioe<100)return void setTimeout(()=>{this.log(...d)},Date.now()-ioe);const f=Math.max(0,Math.min(4,d[0]));if(d[0]=Lde()+" Agora-SDK [".concat(Rne(f),"]:"),this.appendLogToWaitingList(f,...d),f<this.logLevel)return;const b=Lde()+" %cAgora-SDK [".concat(Rne(f),"]:");let k=[];if(!_H("USE_NEW_LOG"))switch(f){case K8.DEBUG:k=[b,"color: #64B5F6;"].concat(d.slice(1)),console.log.apply(console,k);break;case K8.INFO:k=[b,"color: #1E88E5; font-weight: bold;"].concat(d.slice(1)),console.log.apply(console,k);break;case K8.WARNING:k=[b,"color: #FB8C00; font-weight: bold;"].concat(d.slice(1)),console.warn.apply(console,k);break;case K8.ERROR:k=[b,"color: #B00020; font-weight: bold;"].concat(d.slice(1)),console.error.apply(console,k)}}uploadLog(){for(var s=arguments.length,d=new Array(s),l=0;l<s;l++)d[l]=arguments[l];if(Date.now()-ioe<100)return void setTimeout(()=>{this.uploadLog(...d)},Date.now()-ioe);const f=Math.max(0,Math.min(4,d[0]));d[0]=Lde()+" Agora-SDK [".concat(Rne(f),"]:"),this.appendLogToWaitingList(f,...d)}appendLogToWaitingList(s){if(!_H("UPLOAD_LOG"))return;for(var d=arguments.length,l=new Array(d>1?d-1:0),f=1;f<d;f++)l[f-1]=arguments[f];Array.isArray(l[0])?l[0][0]=ege()+" Agora-SDK [".concat(Rne(s),"]:"):l[0]=ege()+" Agora-SDK [".concat(Rne(s),"]:");let b="";l.forEach(k=>{typeof k=="object"&&(k=JSON.stringify(k)),b+="".concat(k," ")}),this.uploadLogWaitingList.push({payload_str:b,log_level:s,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const s=this.uploadLogUploadingList,d={sdk_version:q8,process_id:_H("PROCESS_ID"),payload:JSON.stringify(s)};return ZY(async()=>{const l=await F4.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(_H("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(_H("LOG_UPLOAD_SERVER"),"/upload/v1")),d,{responseType:"text"});if(l.data!=="OK"){const f=new Error("unexpected upload log response");throw f.response=l,f}},()=>(this.uploadLogUploadingList=[],!1),l=>{const f={status:-1,message:l.message,errorRange:s.map(b=>b.log_item_id)};return l.response?(f.status=l.response.status,f.data=l.response.data,f.headers=l.response.headers):l.request&&(f.status=l.request.status),$me.reportLogUploadError(f),!0},{timeout:_H("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:_H("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,_H("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),_H("UPLOAD_LOG_INTERVAL"))}).catch(s=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),_H("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),_H("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var tge;function yDe(s){return jK(s.reportId,"params.reportId",0,100,!1),jK(s.category,"params.category",0,100,!1),jK(s.event,"params.event",0,100,!1),jK(s.label,"params.label",0,100,!1),b6(s.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(tge={}).FREE="free",tge.UPLOADING="uploading",function(s){s[s.MISC=0]="MISC",s[s.INTERNAL_EVENT=1]="INTERNAL_EVENT",s[s.PUBLIC_EVENT=2]="PUBLIC_EVENT",s[s.WEB_EVENT=3]="WEB_EVENT",s[s.INTERNAL_API=4]="INTERNAL_API",s[s.WEB_API=5]="WEB_API",s[s.PUBLIC_API=6]="PUBLIC_API"}({});const RDe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let OK=function(s){return s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.WS_COMPRESSOR_INIT="ws_compressor_init",s.SESSION_INIT="session_init",s.JOIN_CHOOSE_SERVER="join_choose_server",s.REQ_USER_ACCOUNT="req_user_account",s.JOIN_GATEWAY="join_gateway",s.REJOIN_GATEWAY="rejoin_gateway",s.STREAM_SWITCH="stream_switch",s.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",s.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",s.FIRST_VIDEO_RECEIVED="first_video_received",s.FIRST_AUDIO_RECEIVED="first_audio_received",s.FIRST_VIDEO_DECODE="first_video_decode",s.FIRST_AUDIO_DECODE="first_audio_decode",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_UPDATE_STREAM="on_update_stream",s.ON_REMOVE_STREAM="on_remove_stream",s.USER_ANALYTICS="req_user_analytics",s.PC_STATS="pc_stats",s.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",s.AB_TEST="ab_test",s}({}),j6=function(s){return s.SESSION="io.agora.pb.Wrtc.Session",s.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",s.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",s.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",s.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",s.PUBLISH="io.agora.pb.Wrtc.Publish",s.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",s.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",s.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",s.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",s.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",s.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",s.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",s.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",s.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",s.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",s.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",s.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",s.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",s.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",s.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",s.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",s.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",s.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",s.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",s.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",s.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",s.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",s.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",s.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",s.PC_STATS="io.agora.pb.Wrtc.PCStats",s.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",s.AB_TEST="io.agora.pb.Wrtc.ABTest",s}({});(function(s){s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let bDe=function(s){return s[s.SESSION=26]="SESSION",s[s.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",s[s.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",s[s.JOIN_GATEWAY=28]="JOIN_GATEWAY",s[s.PUBLISH=30]="PUBLISH",s[s.SUBSCRIBE=29]="SUBSCRIBE",s[s.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",s[s.STREAM_SWITCH=32]="STREAM_SWITCH",s[s.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",s[s.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",s[s.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",s[s.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",s[s.API_INVOKE=41]="API_INVOKE",s[s.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",s[s.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",s[s.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",s[s.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",s[s.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",s[s.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",s[s.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",s[s.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",s[s.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",s[s.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",s[s.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",s[s.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",s[s.USER_ANALYTICS=1e4]="USER_ANALYTICS",s[s.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",s}({});function A5(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(d,l,f){const b=f.value;if(typeof b=="function"){const k=s.className||d.__className__||(d.constructor.name==="AgoraRTCClient"?"Client":d.constructor.name);f.value=function(){for(var B,Wt=arguments.length,$O=new Array(Wt),uN=0;uN<Wt;uN++)$O[uN]=arguments[uN];let lN=$O;if(s.argsMap)try{lN=s.argsMap(this,...$O)}catch(TN){CN.warning(TN),lN=[]}try{JSON.stringify(lN)}catch{CN.warning("arguments for method ".concat(k,".").concat(String(l)," not serializable for apiInvoke.")),lN=[]}const _N=(s.report||T5).reportApiInvoke(this._sessionId||null,{id:this._clientId||((B=this.store)===null||B===void 0?void 0:B.clientId)||this._ID,name:"".concat(k,".").concat(String(l)),options:lN,tag:Y6.TRACER,reportResult:s.reportResult},s.throttleTime);try{const TN=b.apply(this,$O);return TN instanceof u5?TN.then(vN=>(_N.onSuccess(s.reportResult&&vN),vN)).catch(vN=>{throw _N.onError(vN),vN}):(_N.onSuccess(s.reportResult&&TN),TN)}catch(TN){throw _N.onError(TN),TN}}}return f}}const T5=new class{constructor(){J6(this,"baseInfoMap",new Map),J6(this,"proxyServer",void 0),J6(this,"eventUploadTimer",void 0),J6(this,"setSessionIdTimer",void 0),J6(this,"url",void 0),J6(this,"sids",new Set),J6(this,"backupUrl",void 0),J6(this,"_appId",void 0),J6(this,"_aid",0),J6(this,"keyEventUploadPendingItems",[]),J6(this,"normalEventUploadPendingItems",[]),J6(this,"apiInvokeUploadPendingItems",[]),J6(this,"apiInvokeCount",0),J6(this,"apiInvokeLoggedCount",0),J6(this,"ltsList",[]),J6(this,"lastSendNormalEventTime",Date.now()),J6(this,"customReportCounterTimer",void 0),J6(this,"customReportCount",0),J6(this,"extApiInvoke",async s=>{for(const d of s){const l=F5(F5({},d),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Y6.TRACER});this.sendApiInvoke(l)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),_H("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),_H("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(s){return this.baseInfoMap.get(s)}setAppId(s){this._appId=s,this._aid=parseInt(s.replace(/[a-fA-F0-9]{8}/g,d=>{let[l,f]=d;return l+f}),16)||0}reportApiInvoke(s,d,l){d.timeout=d.timeout||6e4,d.reportResult=d.reportResult===void 0||d.reportResult;const f=Date.now();this.apiInvokeCount+=1;const b=this.apiInvokeCount,k=!!_H("SHOW_REPORT_INVOKER_LOG"),B=!!_H("SHOW_REPORT_USER_INVOKER_LOG"),Wt=k||B&&d.id;Wt&&(this.apiInvokeLoggedCount+=1);const $O=this.apiInvokeLoggedCount;function uN(vN,uH){if(Wt){let rH="[apiInvoke-".concat($O,"]");d.id&&(rH+="[".concat(d.id,"]")),d.name&&(rH+="[".concat(d.name,"]")),CN.info("".concat(rH," ").concat(vN),vN==="start"?d.options:uH||"")}}const lN=()=>({tag:d.tag,invokeId:b,sid:s,name:d.name,apiInvokeTime:f,options:d.options,states:d.states||null});uN("start");let _N=!1;BK(d.timeout).then(()=>{_N||(this.sendApiInvoke(F5(F5({},lN()),{},{error:dH.API_INVOKE_TIMEOUT,success:!1})),uN("timeout"))});const TN=new jH(dH.UNEXPECTED_ERROR,"".concat(d.name,": this api invoke is end"));return{onSuccess:vN=>{const uH=()=>{if(_N)throw TN;return _N=!0,this.sendApiInvoke(F5(F5({},lN()),{},{success:!0},d.reportResult&&{result:vN})),uN("onSuccess"),vN};return l?Ume(uH,d.name+"Success",l,()=>_N=!0):uH()},onError:vN=>{const uH=()=>{if(_N)throw vN;_N=!0,this.sendApiInvoke(F5(F5({},lN()),{},{success:!1,error:vN})),uN("onFailure",vN.toString())};return l?Ume(uH,d.name+"Error",l,()=>_N=!0):uH()}}}sessionInit(s,d){if(this.baseInfoMap.has(s))return;const l=Date.now(),f=this.createBaseInfo(s,l);f.cname=d.cname;const b=Object.assign({},{willUploadConsoleLog:_H("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ode?"global":"oversea",areas:_H("AREAS")&&_H("AREAS").join(",")},d.extend),{stringUid:k,channelProfile:B,channelMode:Wt,isABTestSuccess:$O,lsid:uN,clientRole:lN}=d,_N=Date.now(),TN=F5(F5({},f),{},{eventType:OK.SESSION_INIT,appid:d.appid,browser:navigator.userAgent,buildFormat:d.buildFormat,build:Pde,lts:_N,elapse:_N-l,extend:JSON.stringify(b),mode:d.mode,process:_H("PROCESS_ID"),appType:_H("APP_TYPE"),success:!0,version:q8,stringUid:k,channelProfile:B,channelMode:Wt,isABTestSuccess:$O,lsid:uN,clientType:a5(vN=window.navigator.userAgent).call(vN,"AgoraWebView")?42:20,clientRole:lN,serviceId:_H("PROCESS_ID"),extensionID:_H("PLUGIN_INFO").join(",")||""});var vN;this.send({type:j6.SESSION,data:TN},!0)}joinChooseServer(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{role:d.role,eventType:OK.JOIN_CHOOSE_SERVER,lts:b,eventElapse:d.elapse||b-d.lts,chooseServerAddr:d.csAddr,errorCode:d.ec,elapse:b-l.startTime,success:d.succ,chooseServerAddrList:JSON.stringify(d.serverList),uid:d.uid?parseInt(d.uid):null,cid:d.cid?parseInt(d.cid):null,chooseServerIp:d.csIp||"",opid:d.opid,unilbsServerIds:d.unilbsServerIds,extend:d.extend||void 0,isHttp3:d.isHttp3,corssRegionTagReq:d.corssRegionTagReq||void 0,corssRegionTagRes:d.corssRegionTagRes||void 0});this.send({type:j6.JOIN_CHOOSE_SERVER,data:k},!0)}reqUserAccount(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{eventType:OK.REQ_USER_ACCOUNT,lts:b,success:d.success,serverAddress:d.serverAddr,stringUid:d.stringUid,uid:d.uid,errorCode:d.errorCode,elapse:d.elapse||b-l.startTime,eventElapse:b-d.lts,extend:JSON.stringify(d.extend)});this.send({type:j6.REQ_USER_ACCOUNT,data:k},!0)}joinGateway(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info;d.vid&&(f.vid=d.vid),f.uid=d.uid,f.cid=d.cid;const b=Date.now(),{firstSuccess:k,avoidJoinStartTime:B,addr:Wt,isProxy:$O}=d,uN=b-(k&&B?B:l.startTime),lN=F5(F5({},f),{},{eventType:OK.JOIN_GATEWAY,lts:b,gatewayAddr:d.addr,success:d.succ,errorCode:d.ec,errorMsg:d.errorMsg||"",elapse:uN,eventElapse:b-d.lts,firstSuccess:k,signalChannel:d.signalChannel,preload:d.preload?1:0,installId:Ade(),isABTestSuccess:d.isABTestSuccess?1:0}),_N=lN.success?1:0;if(d.succ&&(l.lastJoinSuccessTime=b),k)this.send({type:j6.JOIN_GATEWAY,data:lN},!0);else{let TN;if(Wt)if($O){const uH=Wt.match(/h=(\d{1,3}-){3}\d{1,3}/g),rH=Wt.match(/p=[0-9]{1,6}/g);TN={isSuccess:_N,gatewayIp:uH&&uH.length?uH[0].split("=")[1].replace(/-/g,"."):"",port:rH&&rH.length?rH[0].split("=")[1]:"",isProxy:$O?1:0}}else{const uH=Wt.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),rH=Wt.match(/(:|p=)[0-9]{1,6}/g);TN={isSuccess:_N,gatewayIp:uH&&uH.length?uH[0].split("//")[1].replace(/-/g,"."):"",port:rH&&rH.length?rH[0].split(/:|p=/g)[1]:"",isProxy:$O?1:0}}else TN={isSuccess:_N,gatewayIp:"",port:"",isProxy:$O?1:0};delete lN.success,delete lN.eventType,delete lN.firstSuccess,lN.vid=Number(lN.vid);const vN=Object.assign({},lN,TN,{eventType:OK.REJOIN_GATEWAY});this.send({type:j6.RE_JOIN_GATEWAY,data:vN},!0)}}joinChannelTimeout(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=Date.now(),b=F5(F5({},l.info),{},{lts:f,timeout:d,elapse:f-l.startTime});this.send({type:j6.JOIN_CHANNEL_TIMEOUT,data:b},!0)}publish(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{eventType:OK.PUBLISH,lts:b,eventElapse:d.eventElapse,elapse:b-l.startTime,success:d.succ,errorCode:d.ec,videoName:d.videoName,audioName:d.audioName,screenName:d.screenName,screenshare:d.screenshare,audio:d.audio,video:d.video,p2pid:d.p2pid,publishRequestid:d.publishRequestid});this.send({type:j6.PUBLISH,data:k},!0)}subscribe(s,d,l){const f=this.baseInfoMap.get(s);if(!f)return;const b=f.info,k=Date.now(),B=F5(F5({},b),{},{eventType:OK.SUBSCRIBE,lts:k,eventElapse:d.eventElapse,elapse:k-f.startTime,success:d.succ,errorCode:d.ec,video:d.video,audio:d.audio,subscribeRequestid:d.subscribeRequestid,p2pid:d.p2pid,preSsrc:d.preSsrc?1:0},l&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof d.peerid=="string"?B.peerSuid=d.peerid:B.peer=d.peerid,this.send({type:j6.SUBSCRIBE,data:B},!0)}wsCompressorInit(s){var d;const l=[...v8(d=this.baseInfoMap).call(d)],f=l.length?l[0]:"UnableToGetSid",b=this.baseInfoMap.get(f);if(!b)return;const k=b.info,B=Date.now(),Wt=F5(F5({},k),{},{eventType:OK.WS_COMPRESSOR_INIT,lts:B,eventElapse:s.eventElapse,elapse:B-b.startTime,status:s.status?1:2});this.send({type:j6.WS_COMPRESSOR_INIT,data:Wt},!0)}firstRemoteVideoDecode(s,d,l,f){const b=this.baseInfoMap.get(s);if(!b)return;const k=b.info,B=Date.now(),Wt=F5(F5(F5({},k),f),{},{elapse:B-b.startTime,eventType:d,lts:B,firstDecodeFrame:Math.max((f.firstFrame||B)-b.startTime,0),apEnd:Math.max(f.apEnd-b.startTime,0),apStart:Math.max(f.apStart-b.startTime,0),joinGwEnd:Math.max(f.joinGwEnd-b.startTime,0),joinGwStart:Math.max(f.joinGwStart-b.startTime,0),pcEnd:Math.max(f.pcEnd-b.startTime,0),pcStart:Math.max(f.pcStart-b.startTime,0),subscriberEnd:Math.max(f.subscriberEnd-b.startTime,0),subscriberStart:Math.max(f.subscriberStart-b.startTime,0),videoAddNotify:Math.max(f.videoAddNotify-b.startTime,0)});this.send({type:l,data:Wt},!0)}firstRemoteFrame(s,d,l,f){const b=this.baseInfoMap.get(s);if(!b)return;const k=b.info,B=Date.now(),Wt=F5(F5(F5({},k),f),{},{elapse:B-b.startTime,eventType:d,lts:B});this.send({type:l,data:Wt},!0)}abTest(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5(F5({},f),d),{},{vid:f.vid===void 0?0:Number(f.vid),elapse:b-l.startTime,eventType:OK.AB_TEST,lts:b});this.send({type:j6.AB_TEST,data:k},!0)}pcStats(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5(F5({},f),d),{},{vid:f.vid===void 0?0:Number(f.vid),elapse:b-l.startTime,eventType:OK.PC_STATS,lts:b,preallocation:d.preallocation?1:0});this.send({type:j6.PC_STATS,data:k},!0)}updateRemoteRTPCapabilities(s,d){if(s){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5(F5({},f),d),{},{vid:f.vid===void 0?0:Number(f.vid),eventType:OK.UPDATE_REMOTE_RTPCAPABILITIES,lts:b});this.send({type:j6.UPDATE_REMOTE_RTPCAPABILITIES,data:k},!0)}}onGatewayStream(s,d,l,f){const b=this.baseInfoMap.get(s);if(!b)return;const k=b.info,B=Date.now(),Wt=F5(F5(F5({},k),f),{},{eventType:d,lts:B});this.send({type:l,data:Wt},!0)}streamSwitch(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{eventType:OK.STREAM_SWITCH,lts:b,isDual:d.isdual,elapse:b-l.startTime,success:d.succ});this.send({type:j6.STREAM_SWITCH,data:k},!0)}requestProxyAppCenter(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{eventType:OK.REQUEST_PROXY_APPCENTER,lts:b,eventElapse:b-d.lts,elapse:b-l.startTime,APAddr:d.APAddr,workerManagerList:d.workerManagerList,response:d.response,errorCode:d.ec,success:d.succ});this.send({type:j6.REQUEST_PROXY_APPCENTER,data:k},!0)}requestProxyWorkerManager(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{eventType:OK.REQUEST_PROXY_WORKER_MANAGER,lts:b,eventElapse:b-d.lts,elapse:b-l.startTime,workerManagerAddr:d.workerManagerAddr,response:d.response,errorCode:d.ec,success:d.succ});this.send({type:j6.REQUEST_PROXY_WORKER_MANAGER,data:k},!0)}setProxyServer(s){this.proxyServer=s,s?CN.debug("reportProxyServerurl: ".concat(s)):CN.debug("disable reportProxyServerurl: ".concat(s))}peerPublishStatus(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5({},f),{},{subscribeElapse:d.subscribeElapse,peer:d.peer,peerPublishDuration:Math.max(d.audioPublishDuration,d.videoPublishDuration),audiotag:d.audioPublishDuration>0?1:-1,videotag:d.videoPublishDuration>0?1:-1,lts:b,elapse:b-l.startTime,joinChannelSuccessElapse:b-(l.lastJoinSuccessTime||b),peerPublishDurationVideo:d.videoPublishDuration,peerPublishDurationAudio:d.audioPublishDuration});this.send({type:j6.PEER_PUBLISH_STATUS,data:k},!0)}workerEvent(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now();(function(k,B,Wt){const $O=k[B];if(!$O||typeof $O!="string")return[k];k[B]="";const uN=xJ(JSON.stringify(k));let lN=0;const _N=[];let TN=0;for(let vN=0;vN<$O.length;vN++)TN+=$O.charCodeAt(vN)<=127?1:3,TN<=Wt-uN||(_N[_N.length]=f5(f5({},k),{},{[B]:$O.substring(lN,vN)}),lN=vN,TN=$O.charCodeAt(vN)<=127?1:3);return lN!==$O.length-1&&(_N[_N.length]=f5(f5({},k),{},{[B]:$O.substring(lN)})),_N})(F5(F5(F5({},f),d),{},{elapse:b-l.startTime,lts:b,productType:"WebRTC"}),"payload",1300).forEach(k=>this.send({type:j6.WORKER_EVENT,data:k},!0))}apworkerEvent(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5(F5({},f),d),{},{elapse:b-l.startTime,lts:b});this.send({type:j6.AP_WORKER_EVENT,data:k},!0)}joinWebProxyAP(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5(F5({},f),d),{},{elapse:b-l.startTime,lts:b,extend:d.extend||void 0});this.send({type:j6.JOIN_WEB_PROXY_AP,data:k},!0)}WebSocketQuit(s,d){const l=this.baseInfoMap.get(s);if(!l)return;const f=l.info,b=Date.now(),k=F5(F5(F5({},f),d),{},{elapse:b-l.startTime,lts:b});this.send({type:j6.WEBSOCKET_QUIT,data:k},!0)}async sendCustomReportMessage(s,d){if(this.customReportCount+=d.length,this.customReportCount>_H("CUSTOM_REPORT_LIMIT"))throw new jH(dH.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const l=Date.now(),f=d.map(b=>({type:j6.USER_ANALYTICS,data:F5(F5({sid:s},b),{},{lts:l})}));try{_H("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(f):await this.postDataToStatsCollector(f)}catch(b){throw CN.error("send custom report message failed",b.toString()),new jH(dH.CUSTOM_REPORT_SEND_FAILED,b.message)}}sendApiInvoke(s){const d=_H("NOT_REPORT_EVENT");if(s.tag&&a5(d)&&a5(d).call(d,s.tag))return!1;if(s.sid===null)return this.apiInvokeUploadPendingItems.push(s),!1;const l=this.baseInfoMap.get(s.sid);if(!l)return this.apiInvokeUploadPendingItems.push(s),!1;const{cname:f,uid:b,cid:k}=l.info;let B;if(s.lts=s.lts||Date.now(),s.error)if(s.error instanceof jH){const{code:$O,message:uN}=s.error;B=$O||uN||s.error.toString()}else B=s.error.toString();const Wt={invokeId:s.invokeId,sid:s.sid,cname:f,cid:k,uid:b,lts:s.lts,success:s.success,elapse:s.lts-l.startTime,execElapse:s.lts-s.apiInvokeTime,apiName:s.name,options:s.options?JSON.stringify(s.options):void 0,execStates:s.states?JSON.stringify(s.states):void 0,execResult:s.result?JSON.stringify(s.result):void 0,errorCode:s.error?B:void 0,errorMsg:s.error?JSON.stringify(s.error):void 0};return this.send({type:j6.API_INVOKE,data:Wt},!1),!0}addSid(s){this.sids.add(s)}removeSid(s){this.sids.delete(s)}appendSessionId(){const s=this.apiInvokeUploadPendingItems;if(s.length===0)return;const d=Array.from(this.sids).find(l=>l!==null);d&&s.forEach(l=>{l&&(l.sid=d,this.sendApiInvoke(Object.assign({},l)))}),s.length=0}send(s,d){if(d)return this.keyEventUploadPendingItems.push(s),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(s),this.normalEventUploadPendingItems.length>_H("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(s,d){const l=[],f=[];for(;s.length;){const k=s.shift();l.length<20?l.push(k):f.push(k)}s.push(...f);for(const k of[...l]){var b;this.ltsList.indexOf(k.data.lts)!==-1?(k.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(k.data.lts)):(this.ltsList.push(k.data.lts),nne(b=this.ltsList).call(b,(B,Wt)=>B-Wt))}return d||(this.lastSendNormalEventTime=Date.now()),_H("ENABLE_EVENT_REPORT")&&l.length&&(_H("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(l):this.postDataToStatsCollector(l)).catch((k=>B=>{_H("EVENT_REPORT_RETRY")&&(d?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(k):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(k),this.normalEventUploadPendingItems.length>_H("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-_H("NORMAL_EVENT_QUEUE_CAPACITY")),CN.warning("report: drop normal events"))))})(l)),s}async postDataToStatsCollector2(s){uK.networkState===l8.OFFLINE&&await u5.race([uK.onlineWaiter,BK(2*EK.maxRetryTimeout)]);const d=b=>{let k=new Uint8Array;return b.forEach(B=>{const Wt=Ede(JSON.stringify(B.data)),$O=new ArrayBuffer(5),uN=(_N=>{let TN=0;return Object.entries(j6).forEach(vN=>{let[uH,rH]=vN;rH===_N.type&&(TN=bDe[uH])}),TN})(B),lN=new DataView($O);lN.setUint16(0,Wt.byteLength,!0),lN.setUint8(2,255&uN),lN.setUint8(3,uN>>>8&255),lN.setUint8(4,uN>>>16&255),k=wme(k,new Uint8Array($O)),k=wme(k,Wt)}),k},l="event";let f=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_H("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(l):"https://".concat(_H("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(l);for(let b=0;b<2;b+=1){b===1&&(f=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_H("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(l):"https://".concat(_H("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(l));try{await bde(f,{timeout:1e4,data:d(s),headers:F5(F5({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(k){if(b===1)throw k;continue}return}}async postDataToStatsCollector(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const l=(Wt=>{const $O=Wt&&Wt.data.sid&&this.baseInfoMap.get(Wt.data.sid);return $O&&$O.info.vid&&+$O.info.vid||0})(s[0]),f=l?void 0:this._aid,b={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:s.map(Wt=>JSON.stringify(Wt)),vid:l,aid:f};uK.networkState===l8.OFFLINE&&await u5.race([uK.onlineWaiter,BK(2*EK.maxRetryTimeout)]);const k=d?"/events/proto-raws":"/events/messages";let B=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_H("EVENT_REPORT_DOMAIN"),"&p=").concat(_H("STATS_COLLECTOR_PORT"),"&d=").concat(k):"https://".concat(_H("EVENT_REPORT_DOMAIN"),":").concat(_H("STATS_COLLECTOR_PORT")).concat(k));for(let Wt=0;Wt<2;Wt+=1){Wt===1&&(B=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_H("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(_H("STATS_COLLECTOR_PORT"),"&d=").concat(k):"https://".concat(_H("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(_H("STATS_COLLECTOR_PORT")).concat(k)));try{d?await cDe(B,{timeout:1e4,data:b}):await bde(B,{timeout:1e4,data:b})}catch($O){if(Wt===1)throw $O;continue}return}}createBaseInfo(s,d){const l=Object.assign({},RDe);return l.sid=s,this.baseInfoMap.set(s,{info:l,startTime:d}),l}reportResourceTiming(s,d){const l=performance.getEntriesByName(s),f=l[l.length-1];f&&this.reportApiInvoke(d,{name:"Client.resourceTiming",options:f,tag:Y6.TRACER}).onSuccess()}};$me.on("REPORT_LOG_UPLOAD",s=>{s.networkState=uK.networkState,T5.reportApiInvoke(null,{name:"logUploadError",options:s,tag:Y6.TRACER}).onSuccess("logUploadError")});class LH extends jH{constructor(d){super(d,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),J6(this,"name","AgoraRTCException")}print(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(d,CN)}throw(){super.throw(CN)}}const GK={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function u6(){return GK}function nge(){return"setSinkId"in HTMLAudioElement.prototype&&(!_H("RESTRICTION_SET_PLAYBACK_DEVICE")||(w7()||_me())&&!pde())}function rge(){return!GK.supportUnifiedPlan||_H("CHROME_FORCE_PLAN_B")&&A7()}let WK=function(s){return s.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",s.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",s.IOS_INTERRUPTION_START="ios-interruption-start",s.IOS_INTERRUPTION_END="ios-interruption-end",s.STATE_CHANGE="state-change",s}({});function D$(s,d,l){return{sampleRate:s,stereo:d,bitrate:l}}function s6(s,d,l,f,b){return{width:s,height:d,frameRate:l,bitrateMin:f,bitrateMax:b}}function gY(s,d,l,f,b){return{width:{max:s},height:{max:d},frameRate:l,bitrateMin:f,bitrateMax:b}}function Mde(s,d){return{numSpatialLayers:s,numTemporalLayers:d}}const vDe={"90p":s6(160,90),"90p_1":s6(160,90),"120p":s6(160,120,15,30,65),"120p_1":s6(160,120,15,30,65),"120p_3":s6(120,120,15,30,50),"120p_4":s6(212,120),"180p":s6(320,180,15,30,140),"180p_1":s6(320,180,15,30,140),"180p_3":s6(180,180,15,30,100),"180p_4":s6(240,180,15,30,120),"240p":s6(320,240,15,40,200),"240p_1":s6(320,240,15,40,200),"240p_3":s6(240,240,15,40,140),"240p_4":s6(424,240,15,40,220),"360p":s6(640,360,15,80,400),"360p_1":s6(640,360,15,80,400),"360p_3":s6(360,360,15,80,260),"360p_4":s6(640,360,30,80,600),"360p_6":s6(360,360,30,80,400),"360p_7":s6(480,360,15,80,320),"360p_8":s6(480,360,30,80,490),"360p_9":s6(640,360,15,80,800),"360p_10":s6(640,360,24,80,800),"360p_11":s6(640,360,24,80,1e3),"480p":s6(640,480,15,100,500),"480p_1":s6(640,480,15,100,500),"480p_2":s6(640,480,30,100,1e3),"480p_3":s6(480,480,15,100,400),"480p_4":s6(640,480,30,100,750),"480p_6":s6(480,480,30,100,600),"480p_8":s6(848,480,15,100,610),"480p_9":s6(848,480,30,100,930),"480p_10":s6(640,480,10,100,400),"720p":s6(1280,720,15,120,1130),"720p_auto":s6(1280,720,30,900,3e3),"720p_1":s6(1280,720,15,120,1130),"720p_2":s6(1280,720,30,120,2e3),"720p_3":s6(1280,720,30,120,1710),"720p_5":s6(960,720,15,120,910),"720p_6":s6(960,720,30,120,1380),"1080p":s6(1920,1080,15,120,2080),"1080p_1":s6(1920,1080,15,120,2080),"1080p_2":s6(1920,1080,30,120,3e3),"1080p_3":s6(1920,1080,30,120,3150),"1080p_5":s6(1920,1080,60,120,4780),"1440p":s6(2560,1440,30,120,4850),"1440p_1":s6(2560,1440,30,120,4850),"1440p_2":s6(2560,1440,60,120,7350),"4k":s6(3840,2160,30,120,8910),"4k_1":s6(3840,2160,30,120,8910),"4k_3":s6(3840,2160,60,120,13500)},CDe={"480p":gY(640,480,5),"480p_1":gY(640,480,5),"480p_2":gY(640,480,30),"480p_3":gY(640,480,15),"720p":gY(1280,720,5),"720p_auto":s6(1280,720,30,900,3e3),"720p_1":gY(1280,720,5),"720p_2":gY(1280,720,30),"720p_3":gY(1280,720,15),"1080p":gY(1920,1080,5),"1080p_1":gY(1920,1080,5),"1080p_2":gY(1920,1080,30),"1080p_3":gY(1920,1080,15)},IDe={"1SL1TL":Mde(1,1),"3SL3TL":Mde(3,3),"2SL3TL":Mde(2,3)};function FJ(s){return s||(s="480p_1"),typeof s=="string"?Object.assign({},vDe[s]):s}function Ude(s){return typeof s=="string"?Object.assign({},CDe[s]):s}function soe(s){return typeof s=="string"?Object.assign({},IDe[s]):s}const wDe={speech_low_quality:D$(16e3,!1),speech_standard:D$(32e3,!1,18),music_standard:D$(48e3,!1),standard_stereo:D$(48e3,!0,56),high_quality:D$(48e3,!1,128),high_quality_stereo:D$(48e3,!0,192)};function ooe(s){return typeof s=="string"?Object.assign({},wDe[s]):s}const k$=[];function ige(s){return vK(s,"mediaSource",["screen","window","application"]),!0}let E5=function(s){return s.NEED_RENEGOTIATE="@need_renegotiate",s.NEED_REPLACE_TRACK="@need_replace_track",s.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",s.NEED_CLOSE="@need_close",s.NEED_ENABLE_TRACK="@need_enable_track",s.NEED_DISABLE_TRACK="@need_disable_track",s.NEED_SESSION_ID="@need_sid",s.SET_OPTIMIZATION_MODE="@set_optimization_mode",s.GET_STATS="@get_stats",s.GET_RTC_STATS="@get_rtc_stats",s.GET_LOW_VIDEO_TRACK="@get_low_video_track",s.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",s.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",s.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",s.NEED_MUTE_TRACK="@need_mute_track",s.NEED_UNMUTE_TRACK="@need_unmute_track",s}({}),O6=function(s){return s.SCREEN_TRACK="screen_track",s.CUSTOM_TRACK="custome_track",s.LOW_STREAM="low_stream",s.SCREEN_LOW_TRACK="screen_low_track",s}({}),L$=function(s){return s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM",s}({}),ADe=function(s){return s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",s[s.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",s[s.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",s[s.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",s[s.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",s[s.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",s}({}),ODe=function(s){return s[s.DISABLE=0]="DISABLE",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.AUDIO_ONLY=2]="AUDIO_ONLY",s[s.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",s[s.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",s[s.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",s[s.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",s[s.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",s[s.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",s}({}),gQ=function(s){return s.TRANSCEIVER_UPDATED="transceiver-updated",s.SEI_TO_SEND="sei-to-send",s.SEI_RECEIVED="sei-received",s.TRACK_UPDATED="track-updated",s}({}),M$=function(s){return s.SOURCE_STATE_CHANGE="source-state-change",s.TRACK_ENDED="track-ended",s.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.CLOSED="closed",s}({}),U$=function(s){return s.FIRST_FRAME_DECODED="first-frame-decoded",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.VIDEO_STATE_CHANGED="video-state-changed",s}({}),x$=function(s){return s.AUDIO="audio",s.VIDEO="video",s.DATA="data",s}({}),C8=function(s){return s.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",s.RECEIVE_TRACK_BUFFER="receive_track_buffer",s.ON_AUDIO_BUFFER="on_audio_buffer",s.UPDATE_SOURCE="update_source",s}({});(function(s){s.UPDATE_TRACK_SOURCE="update-track-source"})({});const xde={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Vde={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},sge={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},NDe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},oge={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let w4=function(s){return s.ON_TRACK="on_track",s.ON_NODE="on_node",s}({}),I8=function(s){return s.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",s.REQUEST_CONSTRAINTS="request_constraints",s}({}),bne=function(s){return s.IDLE="IDLE",s.INITING="INITING",s.INITEND="INITEND",s}({}),TQ=function(s){return s.STATE_CHANGE="state_change",s.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",s.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",s.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",s}({}),f4=function(s){return s.NONE="none",s.INIT="init",s.CANPLAY="canplay",s.PLAYING="playing",s.PAUSED="paused",s.SUSPEND="suspend",s.STALLED="stalled",s.WAITING="waiting",s.ERROR="error",s.DESTROYED="destroyed",s.ABORT="abort",s.ENDED="ended",s.EMPTIED="emptied",s.LOADEDDATA="loadeddata",s}({}),jJ=function(s){return s[s.VideoStateStopped=0]="VideoStateStopped",s[s.VideoStateStarting=1]="VideoStateStarting",s[s.VideoStateDecoding=2]="VideoStateDecoding",s[s.VideoStateFrozen=3]="VideoStateFrozen",s}({});const Fde={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let aoe=function(s){return s.OPEN="open",s.MESSAGE="message",s.CLOSE="close",s.CLOSING="closing",s.ERROR="error",s}({});function o6(s,d,l,f,b){var k,B,Wt={};return Object.keys(f).forEach(function($O){Wt[$O]=f[$O]}),Wt.enumerable=!!Wt.enumerable,Wt.configurable=!!Wt.configurable,("value"in Wt||Wt.initializer)&&(Wt.writable=!0),Wt=z4(k=hZ(B=l.slice()).call(B)).call(k,function($O,uN){return uN(s,d,$O)||$O},Wt),b&&Wt.initializer!==void 0&&(Wt.value=Wt.initializer?Wt.initializer.call(b):void 0,Wt.initializer=void 0),Wt.initializer===void 0?(Object.defineProperty(s,d,Wt),null):Wt}function kH(s,d,l){return(d=function(f){var b=function(k){if(typeof k!="object"||!k)return k;var B=k[Symbol.toPrimitive];if(B!==void 0){var Wt=B.call(k,"string");if(typeof Wt!="object")return Wt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(k)}(f);return typeof b=="symbol"?b:b+""}(d))in s?Object.defineProperty(s,d,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[d]=l,s}function age(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function B6(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?age(Object(l),!0).forEach(function(f){kH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):age(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}class cge extends W6{set _mediaStreamTrack(d){d!==this.mediaStreamTrack&&(this.safeEmit(gQ.TRACK_UPDATED,d),this.mediaStreamTrack=d)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(d,l){super(),kH(this,"trackMediaType",void 0),kH(this,"_ID",void 0),kH(this,"_rtpTransceiver",void 0),kH(this,"_lowRtpTransceiver",void 0),kH(this,"_hints",[]),kH(this,"_isClosed",!1),kH(this,"_originMediaStreamTrack",void 0),kH(this,"mediaStreamTrack",void 0),kH(this,"_external",{}),this._ID=l||A6(8,"track-"),this._originMediaStreamTrack=d,this.mediaStreamTrack=d,function(f){a5(k$).call(k$,f)||k$.push(f)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(d){return d||LX(()=>{var l;T5.reportApiInvoke(null,{name:_K.GET_MEDIA_STREAM_TRACK,options:[],tag:Y6.TRACER}).onSuccess(((l=this._mediaStreamTrack)===null||l===void 0?void 0:l.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(d){return d===L$.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(d){const l=k$.indexOf(d);l!==-1&&k$.splice(l,1)}(this),this.emit(M$.CLOSED),this.removeAllListeners(gQ.SEI_RECEIVED)}_updateRtpTransceiver(d,l){if(l===L$.LOW_STREAM){if(this._lowRtpTransceiver===d)return;this._lowRtpTransceiver=d}else{if(this._rtpTransceiver===d)return;this._rtpTransceiver=d}this.emit(gQ.TRANSCEIVER_UPDATED,d,l)}}class V$ extends cge{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(d,l){super(d,l),kH(this,"_enabled",!0),kH(this,"_muted",!1),kH(this,"_isExternalTrack",!1),kH(this,"_isClosed",!1),kH(this,"_enabledMutex",void 0),kH(this,"processor",void 0),kH(this,"_processorContext",void 0),kH(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new t4("".concat(this.getTrackId())),d.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var d,l;return(d=(l=this._originMediaStreamTrack)===null||l===void 0?void 0:l.label)!==null&&d!==void 0?d:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,CN.debug("[".concat(this.getTrackId(),"] close")),this.emit(E5.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(d,l){let f=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=f,d!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),l&&this._originMediaStreamTrack.stop()),d.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=d,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await w6(this,E5.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){CN.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(M$.TRACK_ENDED)}stateCheck(d,l){if(CN.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(d,": ").concat(l,"]")),O7(l,d),this._enabled&&this._muted&&d==="enabled"&&l===!1)throw new jH(dH.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",CN);if(!this._enabled&&!this._muted&&d==="muted"&&l===!0)throw new jH(dH.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",CN)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():u5.resolve([])}}const uge=window.AudioContext||window.webkitAudioContext;let w8=null;const y6=new class extends W6{constructor(){super(...arguments),kH(this,"prevState",void 0),kH(this,"curState",void 0),kH(this,"currentTime",void 0),kH(this,"currentTimeStuckAt",void 0),kH(this,"interruptDetectorTrack",void 0),kH(this,"onLocalAudioTrackMute",()=>{CN.info("ios15-interruption-start"),this.emit(WK.IOS_15_16_INTERRUPTION_START)}),kH(this,"onLocalAudioTrackUnmute",async()=>{CN.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?CN.info("ios15-interruption-end-canceled"):(w8&&await w8.suspend(),this.emit(WK.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(s){CN.debug("webaudio bindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=s,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(s){CN.debug("webaudio unbindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===s&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function F$(){if(!w8){if(function(){if(!uge)return void CN.error("your browser is not support web audio");CN.info("create audio context");const s=B6({},_H("WEBAUDIO_INIT_OPTIONS"));CN.debug("audio context init option:",JSON.stringify(s)),w8=new uge(s),y6.curState=w8.state,w8.onstatechange=()=>{y6.prevState=y6.curState,y6.curState=w8?w8.state:void 0;const{prevState:d,curState:l}=y6,f=l==="running",b=l==="interrupted",k=d==="running",B=d==="suspended",Wt=d==="interrupted",$O=c6().osVersion;(I4()||EY())&&k&&b&&(CN.info("ios".concat($O,"-interruption-start")),y6.emit(WK.IOS_INTERRUPTION_START)),(I4()||EY())&&(B||Wt)&&f&&(CN.info("ios".concat($O,"-interruption-end")),y6.emit(WK.IOS_INTERRUPTION_END)),d!==l&&y6.emit(WK.STATE_CHANGE,l,d)},setInterval(()=>{var d;const l=(d=w8)===null||d===void 0?void 0:d.currentTime;y6.currentTime!==l?(y6.currentTimeStuckAt&&(CN.debug("AudioContext current time resume at ".concat(l)),y6.currentTimeStuckAt=void 0),y6.currentTime=l):(l!==y6.currentTimeStuckAt&&(T5.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:l},tag:Y6.TRACER}).onSuccess(),CN.warning("AudioContext current time stuck at ".concat(l))),y6.currentTimeStuckAt=l)},5e3),async function(d){const l=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let f,b=!1,k=!1,B=!1;function Wt(rH){d.state==="running"?$O(!1):I4()||EY()?d.state==="suspended"&&($O(!0),rH&&d.resume().then(uN,uN)):d.state!=="closed"&&($O(!0),rH&&d.resume().then(uN,uN))}function $O(rH){if(b!==rH){b=rH;for(let iH=0,lH=l;iH<lH.length;iH+=1){const hH=lH[iH];rH?window.addEventListener(hH,lN,{capture:!0,passive:!0}):window.removeEventListener(hH,lN,{capture:!0,passive:!0})}}}function uN(){Wt(!1)}function lN(){Wt(!0)}function _N(rH){if(!B)if(f.paused)if(rH){let iH;TN(!1),B=!0;try{iH=f.play(),iH?iH.then(vN,vN):(f.addEventListener("playing",vN),f.addEventListener("abort",vN),f.addEventListener("error",vN))}catch{vN()}}else TN(!0);else TN(!1)}function TN(rH){if(k!==rH){k=rH;for(let iH=0,lH=l;iH<lH.length;iH++){const hH=lH[iH];rH?window.addEventListener(hH,uH,{capture:!0,passive:!0}):window.removeEventListener(hH,uH,{capture:!0,passive:!0})}}}function vN(){f.removeEventListener("playing",vN),f.removeEventListener("abort",vN),f.removeEventListener("error",vN),B=!1,_N(!1)}function uH(){_N(!0)}if(I4()){const rH=d.createMediaStreamDestination(),iH=document.createElement("div");iH.innerHTML="<audio x-webkit-airplay='deny'></audio>",f=iH.children.item(0),f.controls=!1,f.disableRemotePlayback=!0,f.preload="auto",f.srcObject=rH.stream,_N(!0)}y6.on(WK.STATE_CHANGE,function(){Wt(!0)}),Wt(!1)}(w8)}(),!w8)throw new jH(dH.NOT_SUPPORTED,"can not create audio context");return w8}return w8}function SQ(s){if(function(){if(jde!==null)return jde;const f=F$(),b=f.createBufferSource(),k=f.createGain(),B=f.createGain();b.connect(k),b.connect(B),b.disconnect(k);let Wt=!1;try{b.disconnect(k)}catch{Wt=!0}return b.disconnect(),jde=Wt,Wt}())return;const d=s.connect,l=s.disconnect;s.connect=(f,b,k)=>{var B;return s._inputNodes||(s._inputNodes=[]),a5(B=s._inputNodes).call(B,f)||(f instanceof AudioNode?(s._inputNodes.push(f),d.call(s,f,b,k)):d.call(s,f,b)),s},s.disconnect=(f,b,k)=>{l.call(s),f?Xse(s._inputNodes,f):s._inputNodes=[];for(const B of s._inputNodes)d.call(s,B)}}let jde=null;function Bde(s,d){let l=!1;const f=1/d;if(_H("DISABLE_WEBAUDIO")){const b=window.setInterval(()=>{l?window.clearInterval(b):s(performance.now()/1e3)},1e3*f)}else{const b=F$();let k=b.createGain();k.gain.value=0,k.connect(b.destination);const B=()=>{if(l)return void(k=null);const Wt=b.createOscillator();Wt.onended=B,Wt.connect(k),Wt.start(0),Wt.stop(b.currentTime+f),s(b.currentTime)};B()}return()=>{l=!0}}class dge{constructor(){kH(this,"context",void 0),kH(this,"analyserNode",void 0),kH(this,"sourceNode",void 0),this.context=F$(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(d){if(d!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=d,d==null||d.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||I4()||EY()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const d=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(d);else{const f=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(f);for(let b=0;b<d.length;++b)d[b]=f[b]/128-1}const l=z4(d).call(d,(f,b)=>f+b*b,0)/d.length;return Math.max(10*Math.log10(l)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var d,l;(d=this.sourceNode)===null||d===void 0||d.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(l=this.sourceNode)===null||l===void 0||l.connect(this.analyserNode)}catch{CN.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class lge extends W6{get processSourceNode(){return this.sourceNode}set processedNode(d){var l;if(!this.isDestroyed&&this._processedNode!==d){try{var f;(f=this.sourceNode)===null||f===void 0||f.disconnect(this.outputNode)}catch{}(l=this._processedNode)===null||l===void 0||l.disconnect(),this._processedNode=d,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),kH(this,"outputNode",void 0),kH(this,"outputTrack",void 0),kH(this,"isPlayed",!1),kH(this,"sourceNode",void 0),kH(this,"context",void 0),kH(this,"audioBufferNode",void 0),kH(this,"destNode",void 0),kH(this,"audioOutputLevel",0),kH(this,"volumeLevelAnalyser",void 0),kH(this,"_processedNode",void 0),kH(this,"playNode",void 0),kH(this,"isDestroyed",!1),kH(this,"onNoAudioInput",void 0),kH(this,"isNoAudioInput",!1),kH(this,"_noAudioInputCount",0),this.context=F$(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),SQ(this.outputNode),this.volumeLevelAnalyser=new dge}startGetAudioBuffer(d){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(d),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=l=>{this.emit(C8.ON_AUDIO_BUFFER,function(f){for(let b=0;b<f.outputBuffer.numberOfChannels;b+=1){const k=f.outputBuffer.getChannelData(b);for(let B=0;B<k.length;B+=1)k[B]=0}return f.inputBuffer}(l))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!u6().webAudioMediaStreamDest)throw new jH(dH.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(d){this.context.state!=="running"&&Qse(()=>{y6.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=d||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(d>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;I4()||EY()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const l=this.volumeLevelAnalyser.getAnalyserNode();let f;l.getFloatTimeDomainData?(f=new Float32Array(l.fftSize),l.getFloatTimeDomainData(f)):(f=new Uint8Array(l.fftSize),l.getByteTimeDomainData(f));let b=!1;for(let k=0;k<f.length;k++)f[k]!==0&&(b=!0);return b?(this.isNoAudioInput=!1,!0):(await BK(200),await this.checkHasAudioInput(d?d+1:1)&&b)}getAudioVolume(){return this.outputNode.gain.value}setVolume(d){this.outputNode.gain.setValueAtTime(d,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var d,l;(d=this.processedNode)===null||d===void 0||d.disconnect(),(l=this.sourceNode)===null||l===void 0||l.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var d;this.processedNode?(d=this.processedNode)===null||d===void 0||d.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class hge extends lge{get isFreeze(){return!1}constructor(d,l,f){var b;if(super(),kH(this,"sourceNode",void 0),kH(this,"track",void 0),kH(this,"clonedTrack",void 0),kH(this,"audioElement",void 0),kH(this,"isCurrentTrackCloned",!1),kH(this,"isRemoteTrack",!1),kH(this,"originVolumeLevelAnalyser",void 0),kH(this,"rebuildWebAudio",async()=>{if(CN.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void CN.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>CN.info("resume success")),CN.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const Wt=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?Wt.stop():this.isCurrentTrackCloned=!0;const $O=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource($O),SQ(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const uN=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(uN,this.context.currentTime),SQ(this.outputNode),this.emit(C8.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=$O,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),d.kind!=="audio")throw new jH(dH.UNEXPECTED_ERROR);this.track=d;const k=new MediaStream([this.track]);if(this.isRemoteTrack=!!l,this.sourceNode=this.context.createMediaStreamSource(k),SQ(this.sourceNode),f){const Wt=f.clone();Wt.enabled=!0,this.clonedTrack=Wt,CN.debug("create an unmuted track ".concat(Wt.id," from the original track ").concat(f.id," to get the volume"));const $O=this.context.createMediaStreamSource(new MediaStream([Wt]));SQ($O),this.originVolumeLevelAnalyser=new dge,this.originVolumeLevelAnalyser.updateSource($O)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=k;const B=c6();l&&B.os===AK.IOS&&Number((b=B.osVersion)===null||b===void 0?void 0:b.split(".")[0])<15&&(y6.on(WK.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(Wt=>{Wt||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(d){this.sourceNode.disconnect(),this.track=d,this.isCurrentTrackCloned=!1;const l=new MediaStream([d]);this.sourceNode=this.context.createMediaStreamSource(l),SQ(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(C8.UPDATE_SOURCE),this.audioElement.srcObject=l}destroy(){var d;this.audioElement.srcObject=null,this.audioElement.remove(),y6.off("state-change",this.rebuildWebAudio),(d=this.originVolumeLevelAnalyser)===null||d===void 0||d.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(d){return this.context.createMediaStreamSource(new MediaStream([d]))}updateOriginTrack(d){const l=d.clone();l.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=l),CN.debug("create an unmuted track ".concat(l.id," from the original track ").concat(d.id," to get the volume"));const f=this.context.createMediaStreamSource(new MediaStream([l]));SQ(f),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(f)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function pge(s,d,l){const f=(k,B)=>k?typeof k!="number"?k.max||k.exact||k.ideal||k.min||B:k:B,b={audio:!!l&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:f(d.height,1080),maxWidth:f(d.width,1920)}}};return d.frameRate&&typeof d.frameRate!="number"?(b.video.mandatory.maxFrameRate=d.frameRate.max,b.video.mandatory.minFrameRate=d.frameRate.min):typeof d.frameRate=="number"&&(b.video.mandatory.maxFrameRate=d.frameRate),await navigator.mediaDevices.getUserMedia(b)}async function PDe(s,d){const l=await fge(s.mediaSource),{sourceId:f,audio:b}=await function(k){let B=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new u5((Wt,$O)=>{const uN=document.createElement("div");uN.innerText="share screen",uN.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const lN=document.createElement("div");lN.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _N=document.createElement("div");_N.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_N.setAttribute("style","height: 12%;");const TN=document.createElement("div");TN.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const vN=document.createElement("div");vN.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const uH=document.createElement("button");uH.innerHTML="cancel",uH.setAttribute("style","width: 85px;"),uH.onclick=()=>{document.body.removeChild(lH);const hH=new Error("NotAllowedError");hH.name="NotAllowedError",$O(hH)};let rH=B;const iH=document.createElement("div");if(B){const hH=document.createElement("input");hH.setAttribute("type","checkbox");const bH=document.createElement("span");hH.setAttribute("style","margin-right: 6px;"),bH.innerText="Share audio",hH.checked=rH,hH.onchange=()=>{rH=hH.checked},iH.appendChild(hH),iH.appendChild(bH)}vN.appendChild(iH),vN.appendChild(uH),lN.appendChild(_N),lN.appendChild(TN),lN.appendChild(vN);const lH=document.createElement("div");lH.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),lH.appendChild(uN),lH.appendChild(lN),document.body.appendChild(lH),k.map(hH=>{if(hH.id){const bH=document.createElement("div");bH.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let PH=hH.thumbnail;try{const{width:OH}=PH.getSize();OH>1920&&(PH=PH.resize({width:1920}))}catch(OH){throw OH&&OH.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),OH}bH.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+PH.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+hH.name.replace(/[\u00A0-\u9999<>\&]/g,function(OH){return"&#"+OH.charCodeAt(0)+";"})+"</span>",bH.onclick=()=>{document.body.removeChild(lH),Wt({sourceId:hH.id,audio:rH})},TN.appendChild(bH)}})})}(l,d);return await pge(f,s,b)}async function fge(s){let d=["window","screen"];s!=="application"&&s!=="window"||(d=["window"]),s==="screen"&&(d=["screen"]);const l=Ame();if(!l)throw console.error("failed to fetch electron, please mount it to window"),new jH(dH.ELECTRON_IS_NULL);let f=null;try{var b;f=((b=l.desktopCapturer)===null||b===void 0?void 0:b.getSources({types:d}))||l.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:d})}catch{f=null}f&&f.then||(f=new u5((k,B)=>{l.desktopCapturer.getSources({types:d},(Wt,$O)=>{Wt?B(Wt):k($O)})}));try{return await f}catch(k){throw new jH(dH.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,k.toString())}}const Gde=new t4("safari");let _ge=!1,Ege=!1;async function A8(s,d){let l=0,f=null;for(;l<2;)try{f=await DDe(s,d,l>0);break}catch(b){if(b instanceof jH)throw CN.error("[".concat(d,"] ").concat(b.toString())),b;const k=coe(b.name||b.code||b,b.message);if(k.code===dH.MEDIA_OPTION_INVALID){CN.debug("[".concat(d,"] detect media option invalid, retry")),l+=1,await BK(500);continue}throw CN.error("[".concat(d,"] ").concat(k.toString())),k}if(!f)throw new jH(dH.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return f}async function DDe(s,d,l){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new jH(dH.NOT_SUPPORTED,"can not find getUserMedia");l&&(s.video&&(delete s.video.width,delete s.video.height),s.screen&&(delete s.screen.width,delete s.screen.height));const f=u6(),b=new MediaStream;if(s.audioSource&&b.addTrack(s.audioSource),s.videoSource&&b.addTrack(s.videoSource),!s.audio&&!s.video&&!s.screen)return CN.debug("Using Video Source/ Audio Source"),b;if(s.screen)if(Ame())s.screen.sourceId?j$(b,await pge(s.screen.sourceId,s.screen,!!s.screenAudio)):j$(b,await PDe(s.screen,!!s.screenAudio));else if(w7()&&s.screen.extensionId&&s.screen.mandatory){if(!f.getStreamFromExtension)throw new jH(dH.NOT_SUPPORTED,"This browser does not support screen sharing");CN.debug("[".concat(d,'] Screen access on chrome stable, looking for extension"'));const TN=await(B=s.screen.extensionId,Wt=d,new u5((vN,uH)=>{try{chrome.runtime.sendMessage(B,{getStream:!0},rH=>{if(!rH||!rH.streamId)return CN.error("[".concat(Wt,"] No response from Chrome Plugin. Plugin not installed properly"),rH),void uH(new jH(dH.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));vN(rH.streamId)})}catch(rH){CN.error("[".concat(Wt,"] AgoraRTC screensharing plugin is not accessible(").concat(B,")"),rH.toString()),uH(new jH(dH.CHROME_PLUGIN_NOT_INSTALL))}}));s.screen.mandatory.chromeMediaSourceId=TN,j$(b,await navigator.mediaDevices.getUserMedia({video:{mandatory:s.screen.mandatory}}))}else if(f.getDisplayMedia){var k;s.screen.mediaSource&&ige(s.screen.mediaSource);const TN={width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate,displaySurface:(k=s.screen.displaySurface)!==null&&k!==void 0?k:s.screen.mediaSource==="screen"?"monitor":s.screen.mediaSource},{selfBrowserSurface:vN,surfaceSwitching:uH,systemAudio:rH,preferCurrentTab:iH}=s.screen,lH={selfBrowserSurface:vN,surfaceSwitching:uH,systemAudio:rH,preferCurrentTab:iH};!vN&&delete lH.selfBrowserSurface,!uH&&delete lH.surfaceSwitching,!rH&&delete lH.systemAudio,!iH&&delete lH.preferCurrentTab,CN.debug("[".concat(d,"] getDisplayMedia:"),JSON.stringify({video:TN,audio:s.screenAudio,controls:lH})),j$(b,await navigator.mediaDevices.getDisplayMedia(B6({video:TN,audio:s.screenAudio},lH)))}else{if(!Z6())throw CN.error("[".concat(d,"] This browser does not support screenSharing")),new jH(dH.NOT_SUPPORTED,"This browser does not support screen sharing");{s.screen.mediaSource&&ige(s.screen.mediaSource);const TN={video:{mediaSource:s.screen.mediaSource,width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate}};CN.debug("[".concat(d,"] getUserMedia: ").concat(JSON.stringify(TN))),j$(b,await navigator.mediaDevices.getUserMedia(TN))}}var B,Wt;if(!s.video&&!s.audio)return b;let $O={video:s.video,audio:s.audio},uN=_H("MEDIA_DEVICE_CONSTRAINTS");if(uN)try{typeof uN=="string"&&(uN=JSON.parse(uN)),$O=Tde($O,uN)}catch{}CN.debug("[".concat(d,"] GetUserMedia"),JSON.stringify($O)),c6();let lN,_N=null;(KK()||I4()||Yse())&&(_N=await Gde.lock());try{lN=await navigator.mediaDevices.getUserMedia($O)}catch(TN){throw _N&&_N(),TN}return $O.audio&&(_ge=!0),$O.video&&(Ege=!0),j$(b,lN),_N&&_N(),b}function coe(s,d){switch(s){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new jH(dH.MEDIA_OPTION_INVALID,"".concat(s,": ").concat(d));case"NotFoundError":case"DevicesNotFoundError":return new jH(dH.DEVICE_NOT_FOUND,"".concat(s,": ").concat(d));case"NotSupportedError":return new jH(dH.NOT_SUPPORTED,"".concat(s,": ").concat(d));case"NotReadableError":return new jH(dH.NOT_READABLE,"".concat(s,": ").concat(d));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new jH(dH.PERMISSION_DENIED,"".concat(s,": ").concat(d));case"ConstraintNotSatisfiedError":return new jH(dH.CONSTRAINT_NOT_SATISFIED,"".concat(s,": ").concat(d));default:return CN.error("getUserMedia unexpected error",s),new jH(dH.UNEXPECTED_ERROR,"".concat(s,": ").concat(d))}}function j$(s,d){const l=s.getVideoTracks()[0],f=s.getAudioTracks()[0],b=d.getVideoTracks()[0],k=d.getAudioTracks()[0];k&&(f&&s.removeTrack(f),s.addTrack(k)),b&&(l&&s.removeTrack(l),s.addTrack(b))}const O8=new class extends W6{get state(){return this._state}set state(s){s!==this._state&&(this.emit(TQ.STATE_CHANGE,s),this._state=s)}constructor(){super(),kH(this,"_state",bne.IDLE),kH(this,"isAccessMicrophonePermission",!1),kH(this,"isAccessCameraPermission",!1),kH(this,"lastAccessMicrophonePermission",!1),kH(this,"lastAccessCameraPermission",!1),kH(this,"checkdeviceMatched",!1),kH(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(_H("ENUMERATE_DEVICES_INTERVAL")||(Jse()||zse()===AK.HARMONY_OS)&&A7())&&this.updateDevicesInfo()},_H("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(s=>CN.error(s.toString()))}async enumerateDevices(s,d){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new jH(dH.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const f=await navigator.mediaDevices.enumerateDevices(),b=this.checkMediaDeviceInfoIsOk(f);let k=!this.isAccessMicrophonePermission&&s,B=!this.isAccessCameraPermission&&d;b.audio&&(k=!1),b.video&&(B=!1);let Wt=null,$O=null,uN=null;if(!l&&(k||B)){if(Gde.isLocked&&(CN.debug("[device manager] wait GUM lock"),(await Gde.lock())(),CN.debug("[device manager] GUM unlock")),_ge&&(k=!1,this.isAccessMicrophonePermission=!0),Ege&&(B=!1,this.isAccessCameraPermission=!0),CN.debug("[device manager] check media device permissions",s,d,k,B),k&&B){try{uN=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(lN){const _N=coe(lN.name||lN.code||lN,lN.message);if(_N.code===dH.PERMISSION_DENIED)throw _N;CN.warning("getUserMedia failed in getDevices",_N)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(k){try{Wt=await navigator.mediaDevices.getUserMedia({audio:s})}catch(lN){const _N=coe(lN.name||lN.code||lN,lN.message);if(_N.code===dH.PERMISSION_DENIED)throw _N;CN.warning("getUserMedia failed in getDevices",_N)}this.isAccessMicrophonePermission=!0}else if(B){try{$O=await navigator.mediaDevices.getUserMedia({video:d})}catch(lN){const _N=coe(lN.name||lN.code||lN,lN.message);if(_N.code===dH.PERMISSION_DENIED)throw _N;CN.warning("getUserMedia failed in getDevices",_N)}this.isAccessCameraPermission=!0}CN.debug("[device manager] mic permission",s,"cam permission",d)}try{const lN=await navigator.mediaDevices.enumerateDevices();return Wt&&Wt.getTracks().forEach(_N=>_N.stop()),$O&&$O.getTracks().forEach(_N=>_N.stop()),uN&&uN.getTracks().forEach(_N=>_N.stop()),Wt=null,$O=null,uN=null,lN}catch(lN){return Wt&&Wt.getTracks().forEach(_N=>_N.stop()),$O&&$O.getTracks().forEach(_N=>_N.stop()),uN&&uN.getTracks().forEach(_N=>_N.stop()),Wt=null,$O=null,uN=null,new jH(dH.ENUMERATE_DEVICES_FAILED,lN.toString()).throw()}}async getRecordingDevices(){let s=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,s)).filter(d=>d.kind==="audioinput")}async getCamerasDevices(){let s=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,s)).filter(d=>d.kind==="videoinput")}async getSpeakers(){let s=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,s)).filter(d=>d.kind==="audiooutput")}searchDeviceIdByName(s){let d=null;return this.deviceInfoMap.forEach(l=>{l.device.label===s&&(d=l.device.deviceId)}),d}async getDeviceById(s){const d=(await this.enumerateDevices(!0,!0,!0)).find(l=>l.deviceId===s);if(!d)throw new jH(dH.DEVICE_NOT_FOUND,"deviceId: ".concat(s));return d}async init(){this.state=bne.INITING;try{await this.updateDevicesInfo(),this.state=bne.INITEND}catch(s){throw CN.warning("Device Detection functionality cannot start properly.",s.toString()),this.state=bne.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new jH(dH.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),s}}async updateDevicesInfo(){const s=await this.enumerateDevices(!0,!0,!0),d=Date.now(),l=[];if(s[0]&&s[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const b=s.find(B=>B.kind==="audioinput"&&B.deviceId==="default"),k=s.find(B=>B.kind==="audiooutput"&&B.deviceId==="default");b&&k?k.groupId===b.groupId?CN.debug("[device-check] default input ".concat(b.label," and output ").concat(k.label," is the same group")):CN.debug("[device-check] default input ".concat(b.label," and output ").concat(k.label," is not the same group")):CN.debug("[device-check] default input or output not found")}const f=this.checkMediaDeviceInfoIsOk(s);if(s.forEach(b=>{if(!b.deviceId)return;const k=this.deviceInfoMap.get("".concat(b.kind,"_").concat(b.deviceId));if((k?k.state:"INACTIVE")!=="ACTIVE"){const B={initAt:d,updateAt:d,device:b,state:"ACTIVE"};this.deviceInfoMap.set("".concat(b.kind,"_").concat(b.deviceId),B),l.push(B)}k&&(k.updateAt=d)}),this.deviceInfoMap.forEach((b,k)=>{b.state==="ACTIVE"&&b.updateAt!==d&&(b.state="INACTIVE",l.push(b))}),this.state!==bne.INITEND)return f.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(f.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));l.forEach(b=>{switch(b.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(TQ.RECORDING_DEVICE_CHANGED,b);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(TQ.CAMERA_DEVICE_CHANGED,b);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(TQ.PLAYOUT_DEVICE_CHANGED,b)}}),f.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),f.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(s){const d=s.filter(b=>b.kind==="audioinput"),l=s.filter(b=>b.kind==="videoinput"),f={audio:!1,video:!1};for(const b of d)if(b.label&&b.deviceId){f.audio=!0;break}for(const b of l)if(b.label&&b.deviceId){f.video=!0;break}return f}};let Wde=!1;const N8=new class extends W6{constructor(){super(...arguments),kH(this,"onAutoplayFailed",void 0),kH(this,"onAudioAutoplayFailed",void 0)}};function mge(){if(c6(),!Wde){const s=d=>{d.preventDefault(),Wde=!1,fne()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};Wde=!0,fne()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),CN.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),N8.onAutoplayFailed?N8.onAutoplayFailed():N8.onAudioAutoplayFailed?CN.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):CN.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),N8.emit("autoplay-failed")}}function gge(s,d,l,f){if(!s)return;const b=T5.getBaseInfoBySessionId(s);if(!b)return;const k=b.info,B=Date.now(),Wt=B6(B6({},k),{},{vid:k.vid===void 0?0:Number(k.vid),lts:B,elapse:B-b.startTime,cbRegistered:N8.onAutoplayFailed||N8.onAudioAutoplayFailed?1:-1,errorMsg:l,mediaType:d,trackId:f,extend:void 0});T5.send({type:j6.AUTOPLAY_FAILED,data:Wt},!0)}const kDe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],j4=new class{constructor(){kH(this,"onAutoplayFailed",void 0),kH(this,"elementMap",new Map),kH(this,"elementStateMap",new Map),kH(this,"elementsNeedToResume",[]),kH(this,"sinkIdMap",new Map),kH(this,"autoResumeAfterInterruption",s=>{Array.from(this.elementMap.entries()).forEach(d=>{let[l,f]=d;const b=this.elementStateMap.get(l),k=f.srcObject.getAudioTracks()[0],B=k&&k.readyState;if(CN.debug("resume after interrupted, ele: ".concat(b," audio: ").concat(B," ").concat(s)),B==="live"){if(s)return f.pause(),void f.play();if(y6.curState==="running")return w$()?(f.pause(),void f.play()):void(b&&b==="paused"&&f.play())}})}),kH(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[d,l]=s;const f=l.srcObject.getAudioTracks()[0];f&&f.readyState==="live"&&(CN.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),l.pause(),l.play())})}),this.autoResumeAudioElement(),y6.on(WK.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),y6.on(WK.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),y6.on(WK.STATE_CHANGE,()=>{I4()&&y6.prevState==="suspended"&&y6.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(s,d){const l=this.elementMap.get(s);if(this.sinkIdMap.set(s,d),l)try{await l.setSinkId(d)}catch(f){throw new jH(dH.PERMISSION_DENIED,"can not set sink id: "+f.toString())}}play(s,d,l,f){if(this.elementMap.has(d))return;const b=document.createElement("audio");b.autoplay=!0,b.srcObject=new MediaStream([s]),this.bindAudioElementEvents(d,b),this.elementMap.set(d,b),this.elementStateMap.set(d,f4.INIT),this.setVolume(d,l);const k=this.sinkIdMap.get(d);if(k)try{b.setSinkId(k).catch(Wt=>{CN.warning("[".concat(d,"] set sink id failed"),Wt.toString())})}catch(Wt){CN.warning("[".concat(d,"] set sink id failed"),Wt.toString())}const B=b.play();B&&B.then&&B.catch(Wt=>{f&&gge(f,"audio",Wt.message,d),CN.warning("audio element play warning",Wt.toString()),this.elementMap.has(d)&&Wt.name==="NotAllowedError"&&(CN.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(b),Qse(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),mge()}))})}updateTrack(s,d){const l=this.elementMap.get(s);l&&(l.srcObject=new MediaStream([d]))}isPlaying(s){return this.elementMap.has(s)&&this.elementStateMap.get(s)==="playing"}setVolume(s,d){const l=this.elementMap.get(s);l&&(d=Math.max(0,Math.min(100,d)),l.volume=d/100)}stop(s){const d=this.elementMap.get(s);if(this.sinkIdMap.delete(s),!d)return;const l=this.elementsNeedToResume.indexOf(d);this.elementsNeedToResume.splice(l,1),d.srcObject=null,d.remove(),this.elementMap.delete(s),this.elementStateMap.delete(s)}bindAudioElementEvents(s,d){kDe.forEach(l=>{d.addEventListener(l,f=>{const b=this.elementStateMap.get(s),k=f.type==="pause"?"paused":f.type;if(CN.debug("[".concat(s,"] audio-element-status change ").concat(b," => ").concat(k)),f.type==="error"){const B=d==null?void 0:d.error;B&&CN.error("[".concat(s,"] media error, code: ").concat(B.code,", message: ").concat(B.message))}this.elementStateMap.set(s,k)})})}getPlayerState(s){return this.elementStateMap.get(s)||"uninit"}autoResumeAudioElement(){const s=()=>{this.elementsNeedToResume.forEach(d=>{d.play().then(l=>{CN.debug("Auto resume audio element success")}).catch(l=>{CN.warning("Auto resume audio element failed!",l)})}),this.elementsNeedToResume=[]};new u5(d=>{document.body?d():window.addEventListener("load",()=>d())}).then(()=>{fne()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0))})}};function sK(){return function(s,d,l){const f=l.value;return typeof f=="function"&&(l.value=function(){this._isClosed&&new jH(dH.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",CN);for(var b=arguments.length,k=new Array(b),B=0;B<b;B++)k[B]=arguments[B];const Wt=f.apply(this,k);return Wt instanceof u5?new u5(($O,uN)=>{Wt.then($O).catch(uN)}):Wt}),l}}class Tge extends W6{constructor(d){super(),kH(this,"name","VideoProcessorDestination"),kH(this,"ID","0"),kH(this,"_source",void 0),kH(this,"videoContext",void 0),kH(this,"inputTrack",void 0),this.videoContext=d}get kind(){return"video"}get enabled(){return!0}pipe(){throw new jH(dH.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new jH(dH.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(d){if(d.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);d.track&&d.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=d.track,this.emit(w4.ON_TRACK,d.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(w4.ON_TRACK,void 0)}}class Sge extends W6{set chained(d){this._chained=d}get chained(){return this._chained}constructor(d,l){super(),kH(this,"constraintsMap",new Map),kH(this,"statsRegistry",[]),kH(this,"usageRegistry",[]),kH(this,"trackId",void 0),kH(this,"direction",void 0),kH(this,"_chained",!1),this.trackId=d,this.direction=l}async getConstraints(){return await YK(this,I8.REQUEST_CONSTRAINTS)}async requestApplyConstraints(d,l){var f;return CN.info("processor ".concat(l.name," requestApplyConstraints for ").concat(this.trackId)),d&&this.constraintsMap.set(l,d),w6(this,I8.REQUEST_UPDATE_CONSTRAINTS,Array.from(S8(f=this.constraintsMap).call(f)))}async requestRevertConstraints(d){var l;if(this.constraintsMap.has(d))return CN.info("processor ".concat(d.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(d),w6(this,I8.REQUEST_UPDATE_CONSTRAINTS,Array.from(S8(l=this.constraintsMap).call(l)))}registerStats(d,l,f){this.statsRegistry.find(b=>b.processorID===d.ID&&b.processorName===d.name&&b.type===l)||this.statsRegistry.push({processorName:d.name,processorID:d.ID,type:l,cb:f})}unregisterStats(d,l){const f=this.statsRegistry.findIndex(b=>b.processorID===d.ID&&b.processorName===d.name&&b.type===l);f!==-1&&this.statsRegistry.splice(f,1)}gatherStats(){const d=[];for(const{processorID:l,processorName:f,type:b,cb:k}of this.statsRegistry)try{const B=k();d.push({processorID:l,processorName:f,type:b,stats:B})}catch(B){CN.error(new jH(dH.UNEXPECTED_ERROR,B.message))}return d}registerUsage(d,l){this.usageRegistry.find(f=>f.processorID===d.ID&&f.processorName===d.name)||this.usageRegistry.push({processorID:d.ID,processorName:d.name,cb:l})}unregisterUsage(d){const l=this.usageRegistry.findIndex(f=>f.processorID===d.ID&&f.processorName===d.name);l!==-1&&this.usageRegistry.splice(l,1)}async gatherUsage(){const d=[];if(!this.chained)return[];for(const{cb:l}of this.usageRegistry)try{let f=l();f instanceof u5&&(f=await f),d.push(B6(B6({},f),{},{direction:this.direction}))}catch(f){CN.error("gather extension usage error",f)}return d}getDirection(){return this.direction}}class yge extends W6{constructor(d){super(),kH(this,"name","AudioProcessorDestination"),kH(this,"ID","0"),kH(this,"inputTrack",void 0),kH(this,"inputNode",void 0),kH(this,"audioProcessorContext",void 0),kH(this,"_source",void 0),this.audioProcessorContext=d}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new jH(dH.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new jH(dH.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(w4.ON_TRACK,void 0),this.emit(w4.ON_NODE,void 0)}updateInput(d){if(d.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);d.track&&this.inputTrack!==d.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=d.track,this.emit(w4.ON_TRACK,this.inputTrack)),d.node&&this.inputNode!==d.node&&(this.audioProcessorContext.chained=!0,this.inputNode=d.node,this.emit(w4.ON_NODE,this.inputNode))}}class Rge extends W6{set chained(d){this._chained=d}get chained(){return this._chained}constructor(d,l,f){super(),kH(this,"constraintsMap",new Map),kH(this,"statsRegistry",[]),kH(this,"audioContext",void 0),kH(this,"trackId",void 0),kH(this,"direction",void 0),kH(this,"usageRegistry",[]),kH(this,"_chained",!1),this.audioContext=d,this.trackId=l,this.direction=f}async getConstraints(){return YK(this,I8.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(d,l){var f;return CN.info("processor ".concat(l.name," requestApplyConstraints for ").concat(this.trackId)),d&&this.constraintsMap.set(l,d),w6(this,I8.REQUEST_UPDATE_CONSTRAINTS,Array.from(S8(f=this.constraintsMap).call(f)))}async requestRevertConstraints(d){var l;if(this.constraintsMap.has(d))return this.constraintsMap.delete(d),w6(this,I8.REQUEST_UPDATE_CONSTRAINTS,Array.from(S8(l=this.constraintsMap).call(l)))}registerStats(d,l,f){this.statsRegistry.find(b=>b.processorID===d.ID&&b.processorName===d.name&&b.type===l)||this.statsRegistry.push({processorName:d.name,processorID:d.ID,type:l,cb:f})}unregisterStats(d,l){const f=this.statsRegistry.findIndex(b=>b.processorID===d.ID&&b.processorName===d.name&&b.type===l);f!==-1&&this.statsRegistry.splice(f,1)}gatherStats(){const d=[];for(const{processorID:l,processorName:f,type:b,cb:k}of this.statsRegistry)try{const B=k();d.push({processorID:l,processorName:f,type:b,stats:B})}catch(B){CN.error(new jH(dH.UNEXPECTED_ERROR,B.message))}return d}registerUsage(d,l){this.usageRegistry.find(f=>f.processorID===d.ID&&f.processorName===d.name)||this.usageRegistry.push({processorID:d.ID,processorName:d.name,cb:l})}unregisterUsage(d){const l=this.usageRegistry.findIndex(f=>f.processorID===d.ID&&f.processorName===d.name);l!==-1&&this.usageRegistry.splice(l,1)}async gatherUsage(){const d=[];if(!this.chained)return[];for(const{cb:l}of this.usageRegistry)try{let f=l();f instanceof u5&&(f=await f),d.push(B6(B6({},f),{},{direction:this.direction}))}catch(f){CN.error("gather extension usage error",f)}return d}getDirection(){return this.direction}}class Hde extends W6{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),kH(this,"context",void 0),kH(this,"processSourceNode",void 0),kH(this,"outputTrack",void 0),kH(this,"processedNode",void 0),kH(this,"clonedTrack",void 0),kH(this,"outputNode",void 0),this.outputNode=new LDe}setVolume(){}createOutputTrack(){throw new jH(dH.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class LDe{disconnect(){}connect(){}}function bge(s){return new u5((d,l)=>{let f=!1;const b=document.createElement("video");b.setAttribute("autoplay",""),b.setAttribute("muted",""),b.muted=!0,b.autoplay=!0,b.setAttribute("playsinline",""),b.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(b);const k=I4()?"canplay":"playing";b.addEventListener(k,()=>{const B=b.videoWidth,Wt=b.videoHeight;!B&&Z6()||(f=!0,b.srcObject=null,b.remove(),d([B,Wt]))}),b.srcObject=new MediaStream([s]),b.play().catch(Zse),setTimeout(()=>{f||(b.srcObject=null,b.remove(),d([b.videoWidth,b.videoHeight]))},4e3)})}function uoe(s){const d={};s.facingMode&&(d.facingMode=s.facingMode),s.cameraId&&(d.deviceId={exact:s.cameraId});const l=FJ(s.encoderConfig);return l.width!=null&&(d.width=l.width),l.height!=null&&(d.height=l.height),!bme()&&l.frameRate&&(d.frameRate=l.frameRate),_me()&&typeof d.frameRate=="object"&&(d.frameRate.max=60),Z6()&&(d.frameRate={ideal:30,max:30}),d}function vge(s){const d={};return bme()||(s.AGC!==void 0&&(d.autoGainControl=s.AGC),s.AEC!==void 0&&(d.echoCancellation=s.AEC),s.ANS!==void 0&&(d.noiseSuppression=s.ANS,w7()&&s.ANS&&(d.googHighpassFilter=s.ANS))),d}function Cge(s){const d=vge(s);if(s.encoderConfig){const l=ooe(s.encoderConfig);d.channelCount=l.stereo?2:1,d.sampleRate=l.sampleRate,d.sampleSize=l.sampleSize}return s.microphoneId&&(d.deviceId={exact:s.microphoneId}),Jse()&&(d.sampleRate=void 0),d}const MDe=s=>{const d=s._encoderConfig;if(!d)return;const{frameRate:l,width:f,height:b}=s.getMediaStreamTrackSettings();let{frameRate:k=l,width:B=f,height:Wt=b}=d;if(!k||!B||!Wt)return;B=Sde(B),Wt=Sde(Wt),k=Sde(k);const{max:$O,min:uN}=function(vN,uH,rH){const iH=200*Math.pow(rH/15,.6)*Math.pow(vN*uH/640/360,.75);return{min:Math.floor(iH),max:Math.floor(4*iH)}}(B,Wt,k),{bitrateMax:lN,bitrateMin:_N}=d||{};lN||CN.debug("calculate bitrate: [w: ".concat(B,", h: ").concat(Wt,", fps: ").concat(k,"] => [brMax: ").concat(lN,", brMin: ").concat(_N,"]"));const{maxFramerate:TN}=_H("ENCODER_CONFIG_LIMIT");return TN&&typeof TN=="number"&&(k=Math.min(k,TN)),{frameRate:k,bitrateMax:lN||$O,bitrateMin:_N||uN,scaleResolutionDownBy:1,scale:0}},Ige=async(s,d,l)=>await(async(f,b,k)=>{const B=function(uN){const lN=[];for(let _N=0;_N<uN.length;_N+=2)lN.push(parseInt(uN.slice(_N,_N+2),16));return Uint8Array.from(lN)}(Fme(""+b+k)).slice(0,16),Wt=B.slice(0,12),$O=await window.crypto.subtle.importKey("raw",B,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:Wt},$O,f))})(s.buffer,d,l),qde=s=>{const d=document.createElement("canvas");return d.width=2,d.height=2,new u5((l,f)=>{d.toBlob(async b=>{if(d.remove(),b){const k=await wge(b);l({buffer:k,width:d.width,height:d.height})}else f(new jH(dH.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},s,1)})},wge=async s=>{const d=await s.arrayBuffer();return new Uint8Array(d)};var Age,Oge,Nge,Pge,Dge,kge,Lge,Mge,Uge,xge,Vge,Fge,jge,Bge,Gge,Wge,Hge,qge,q6,Kge,zge,Yge,Jge,Xge,Qge,BJ,Zge,$ge,eTe,tTe,nTe,rTe,iTe,sTe,oTe,aTe,cTe,uTe,dTe,XK;let _q=(Age=A5({argsMap:(s,d)=>[s.getTrackId(),d],throttleTime:300}),Oge=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),Nge=sK(),Pge=N$("LocalAudioTrack","_enabledMutex"),Dge=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),kge=sK(),Lge=N$("LocalAudioTrack","_enabledMutex"),Mge=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),Uge=sK(),xge=sK(),Vge=sK(),Fge=A5({argsMap:s=>[s.getTrackId()]}),jge=sK(),Bge=A5({argsMap:s=>[s.getTrackId()]}),Gge=sK(),Wge=A5({argsMap:s=>[s.getTrackId()]}),Hge=A5({argsMap:(s,d)=>[s.getTrackId(),d.name]}),qge=A5({argsMap:s=>[s.getTrackId()]}),o6((q6=class extends V${get _source(){return this.initWebAudio()}set _source(s){this._trackSource=s}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?j4.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(s,d,l,f){super(s,l),kH(this,"trackMediaType",x$.AUDIO),kH(this,"_encoderConfig",void 0),kH(this,"_trackSource",void 0),kH(this,"metadata",[]),kH(this,"_enabled",!0),kH(this,"_volume",100),kH(this,"_useAudioElement",!0),kH(this,"_bypassWebAudio",!1),kH(this,"processor",void 0),kH(this,"_processorContext",void 0),kH(this,"_processorDestination",void 0),kH(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=d,this._getOriginVolumeLevel=!!f,this._trackSource=new Hde,_H("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),_H("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),KK()&&!w8?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(s){b6(s,"volume",0,1e3),this._volume=s,this._source.setVolume(s/100),this._useAudioElement&&j4.setVolume(this.getTrackId(),s);try{if(this._bypassWebAudio)return void CN.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const d=this._source.createOutputTrack();this._mediaStreamTrack!==d&&(this._mediaStreamTrack=d,w6(this,E5.NEED_REPLACE_TRACK,this).then(()=>{CN.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(l=>{CN.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),l)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(s){if(!this._useAudioElement||!nge())throw new jH(dH.NOT_SUPPORTED,"your browser does not support setting the audio output device");await j4.setSinkID(this.getTrackId(),s)}async setEnabled(s,d,l){return this._setEnabled(s,d,l)}async _setEnabled(s,d,l){if(!l){if(s===this._enabled)return;this.stateCheck("enabled",s)}if(CN.info("[".concat(this.getTrackId(),"] start setEnabled"),s),s){this._originMediaStreamTrack.enabled=!0;try{l||(this._enabled=!0),await w6(this,E5.NEED_ENABLE_TRACK,this),CN.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(s," success"))}catch(f){throw l||(this._enabled=!1),CN.error("[".concat(this.getTrackId(),"] setEnabled to true error"),f.toString()),f}}else{this._originMediaStreamTrack.enabled=!1,l||(this._enabled=!1);try{await w6(this,E5.NEED_DISABLE_TRACK,this)}catch(f){throw l||(this._enabled=!0),CN.error("[".concat(this.getTrackId(),"] setEnabled to false error"),f.toString()),f}}}async setMuted(s){s!==this._muted&&(this.stateCheck("muted",s),this._muted=s,this._originMediaStreamTrack.enabled=!s,CN.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(s)),s?await w6(this,E5.NEED_MUTE_TRACK,this):await w6(this,E5.NEED_UNMUTE_TRACK,this))}getStats(){return LX(()=>{CN.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),R8(this,E5.GET_STATS)||B6({},xde)}setAudioFrameCallback(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!s)return this._source.removeAllListeners(C8.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(d),this._source.removeAllListeners(C8.ON_AUDIO_BUFFER),this._source.on(C8.ON_AUDIO_BUFFER,l=>s(l))}play(){CN.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(CN.debug("[".concat(this.getTrackId(),"] start audio playback in element")),j4.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){CN.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?j4.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];CN.debug("[".concat(this.getTrackId(),"] update player source track")),s&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&j4.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(s,d){this._originMediaStreamTrack!==s&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),d&&this._originMediaStreamTrack.stop()),s.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=s,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:s,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await w6(this,E5.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(s))}renewMediaStreamTrack(s){return u5.resolve(void 0)}pipe(s){if(this._bypassWebAudio)throw new jH(dH.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===s)return s;if(s._source)throw new jH(dH.INVALID_OPERATION,"Processor ".concat(s.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=s,this.processor._source=this,s.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),s}unpipe(){var s;if(!this.processor)return;const d=this.processor;(s=this._source.processSourceNode)===null||s===void 0||s.disconnect(),this.processor._source=!1,this.processor=void 0,d.reset()}bindProcessorDestinationEvents(s){s.on(w4.ON_TRACK,async d=>{d?d!==this._mediaStreamTrack&&(this._mediaStreamTrack=d,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(d),await w6(this,E5.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await w6(this,E5.NEED_REPLACE_TRACK,this))}),s.on(w4.ON_NODE,d=>{this._source.processedNode=d})}unbindProcessorDestinationEvents(s){s.removeAllListeners(w4.ON_TRACK),s.removeAllListeners(w4.ON_NODE)}bindProcessorContextEvents(s){s.on(I8.REQUEST_CONSTRAINTS,async d=>{d(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(s){s.removeAllListeners(I8.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Hde&&(this._trackSource=new hge(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const s=new Rge(this._source.context,this.getTrackId(),"local"),d=new yge(s);return this._processorContext=s,this._processorDestination=d,this.bindProcessorContextEvents(s),this.bindProcessorDestinationEvents(d),this._source.on(C8.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:s})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(j4.stop(this.getTrackId()),this._source.play()),w6(this,E5.NEED_REPLACE_MIXING_TRACK,this).then(()=>{CN.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(l=>{CN.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),l)})),{processorContext:s,processorDestination:d}}}).prototype,"setVolume",[Age],Object.getOwnPropertyDescriptor(q6.prototype,"setVolume"),q6.prototype),o6(q6.prototype,"setPlaybackDevice",[Oge,Nge],Object.getOwnPropertyDescriptor(q6.prototype,"setPlaybackDevice"),q6.prototype),o6(q6.prototype,"setEnabled",[Pge,Dge,kge],Object.getOwnPropertyDescriptor(q6.prototype,"setEnabled"),q6.prototype),o6(q6.prototype,"setMuted",[Lge,Mge,Uge],Object.getOwnPropertyDescriptor(q6.prototype,"setMuted"),q6.prototype),o6(q6.prototype,"getStats",[xge],Object.getOwnPropertyDescriptor(q6.prototype,"getStats"),q6.prototype),o6(q6.prototype,"setAudioFrameCallback",[Vge],Object.getOwnPropertyDescriptor(q6.prototype,"setAudioFrameCallback"),q6.prototype),o6(q6.prototype,"play",[Fge,jge],Object.getOwnPropertyDescriptor(q6.prototype,"play"),q6.prototype),o6(q6.prototype,"stop",[Bge,Gge],Object.getOwnPropertyDescriptor(q6.prototype,"stop"),q6.prototype),o6(q6.prototype,"close",[Wge],Object.getOwnPropertyDescriptor(q6.prototype,"close"),q6.prototype),o6(q6.prototype,"pipe",[Hge],Object.getOwnPropertyDescriptor(q6.prototype,"pipe"),q6.prototype),o6(q6.prototype,"unpipe",[qge],Object.getOwnPropertyDescriptor(q6.prototype,"unpipe"),q6.prototype),q6),doe=(Kge=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),zge=sK(),Yge=N$("MicrophoneAudioTrack","_enabledMutex"),Jge=A5({argsMap:(s,d,l)=>[s.getTrackId(),d,l]}),Xge=sK(),Qge=A5({argsMap:s=>[s.getTrackId()]}),o6((BJ=class extends _q{get __className__(){return"MicrophoneAudioTrack"}constructor(s,d,l,f){super(s,d.encoderConfig?ooe(d.encoderConfig):{},f,_H("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),kH(this,"_config",void 0),kH(this,"_deviceName","default"),kH(this,"_constraints",void 0),kH(this,"_originalConstraints",void 0),kH(this,"_enabled",!0),this._config=d,this._constraints=l,this._originalConstraints=l,this._deviceName=s.label,typeof d.bypassWebAudio=="boolean"&&(this._bypassWebAudio=d.bypassWebAudio),(w$()||hde())&&y6.bindInterruptDetectorTrack(this)}async setDevice(s){if(CN.info("[".concat(this.getTrackId(),"] start set device to ").concat(s)),this._enabled)try{const d=await O8.getDeviceById(s),l={};l.audio=B6({},this._constraints),l.audio.deviceId={exact:s},this._originMediaStreamTrack.stop();let f=null;try{f=await A8(l,this.getTrackId())}catch(b){throw CN.error("[".concat(this.getTrackId(),"] setDevice failed"),b.toString()),f=await A8({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),b}await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),this._deviceName=d.label,this._config.microphoneId=s,this._constraints.deviceId={exact:s}}catch(d){throw CN.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}else try{const d=await O8.getDeviceById(s);this._deviceName=d.label,this._config.microphoneId=s,this._constraints.deviceId={exact:s}}catch(d){throw CN.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}CN.info("[".concat(this.getTrackId(),"] set device to ").concat(s," success"))}async setEnabled(s,d,l){if(d)return CN.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(s);if(!l){if(s===this._enabled)return;this.stateCheck("enabled",s)}if(CN.info("[".concat(this.getTrackId(),"] start setEnabled"),s),_H("AUTO_RESET_AUDIO_ROUTE")&&(I4()||EY())){const B=navigator.audioSession;B&&(s||(B.type="playback"),B.type="auto")}if(!s){var f;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(f=this._source.clonedTrack)===null||f===void 0||f.stop(),l||(this._enabled=!1);try{await w6(this,E5.NEED_DISABLE_TRACK,this)}catch(B){throw CN.error("[".concat(this.getTrackId(),"] setEnabled false failed"),B.toString()),B}return}const b=B6({},this._constraints),k=O8.searchDeviceIdByName(this._deviceName);k&&!b.deviceId&&(b.deviceId=k);try{l||(this._enabled=!0);const B=await A8({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(B.getAudioTracks()[0],!1),await w6(this,E5.NEED_ENABLE_TRACK,this)}catch(B){throw l||(this._enabled=!1),CN.error("[".concat(this.getTrackId(),"] setEnabled true failed"),B.toString()),B}CN.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(w$()||hde())&&y6.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((I4()||EY())&&this._enabled&&!this._isClosed&&y6.duringInterruption){const s=async()=>{y6.off(WK.IOS_INTERRUPTION_END,s),this._enabled&&!this._isClosed&&(CN.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};y6.on(WK.IOS_INTERRUPTION_END,s)}else CN.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(M$.TRACK_ENDED)}async renewMediaStreamTrack(s){const d=s||this._constraints,l=O8.searchDeviceIdByName(this._deviceName);if(l&&!d.deviceId&&(d.deviceId=l),this._constraints=d,this._enabled){this._originMediaStreamTrack.stop();const f=await A8({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!0)}}bindProcessorContextEvents(s){super.bindProcessorContextEvents(s),s.on(I8.REQUEST_UPDATE_CONSTRAINTS,async(d,l,f)=>{try{const b=Object.assign({},this._originalConstraints,...d);await this.renewMediaStreamTrack(b),l()}catch(b){f(b)}})}unbindProcessorContextEvents(s){super.unbindProcessorContextEvents(s),s.removeAllListeners(I8.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Kge,zge],Object.getOwnPropertyDescriptor(BJ.prototype,"setDevice"),BJ.prototype),o6(BJ.prototype,"setEnabled",[Yge,Jge,Xge],Object.getOwnPropertyDescriptor(BJ.prototype,"setEnabled"),BJ.prototype),o6(BJ.prototype,"close",[Qge],Object.getOwnPropertyDescriptor(BJ.prototype,"close"),BJ.prototype),BJ),UDe=(Zge=A5({argsMap:(s,d)=>[s.getTrackId(),d,s.duration]}),$ge=sK(),eTe=A5({argsMap:s=>[s.getTrackId()]}),tTe=sK(),nTe=A5({argsMap:s=>[s.getTrackId()]}),rTe=sK(),iTe=A5({argsMap:s=>[s.getTrackId()]}),sTe=sK(),oTe=A5({argsMap:s=>[s.getTrackId()]}),aTe=sK(),cTe=A5({argsMap:s=>[s.getTrackId()]}),uTe=A5({argsMap:s=>[s.getTrackId()]}),dTe=sK(),o6((XK=class extends _q{get __className__(){return"BufferSourceAudioTrack"}constructor(s,d,l,f){super(d.createOutputTrack(),l,f),kH(this,"source",void 0),kH(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=s,this._bufferSource=d,this._bufferSource.on(C8.AUDIO_SOURCE_STATE_CHANGE,b=>{this.safeEmit(M$.SOURCE_STATE_CHANGE,b)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(s){s&&this._bufferSource.updateOptions(s),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(s){this._bufferSource.seekAudioBuffer(s)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(s){b6(s,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(s)}}).prototype,"startProcessAudioBuffer",[Zge,$ge],Object.getOwnPropertyDescriptor(XK.prototype,"startProcessAudioBuffer"),XK.prototype),o6(XK.prototype,"pauseProcessAudioBuffer",[eTe,tTe],Object.getOwnPropertyDescriptor(XK.prototype,"pauseProcessAudioBuffer"),XK.prototype),o6(XK.prototype,"seekAudioBuffer",[nTe,rTe],Object.getOwnPropertyDescriptor(XK.prototype,"seekAudioBuffer"),XK.prototype),o6(XK.prototype,"resumeProcessAudioBuffer",[iTe,sTe],Object.getOwnPropertyDescriptor(XK.prototype,"resumeProcessAudioBuffer"),XK.prototype),o6(XK.prototype,"stopProcessAudioBuffer",[oTe,aTe],Object.getOwnPropertyDescriptor(XK.prototype,"stopProcessAudioBuffer"),XK.prototype),o6(XK.prototype,"close",[cTe],Object.getOwnPropertyDescriptor(XK.prototype,"close"),XK.prototype),o6(XK.prototype,"setAudioBufferPlaybackSpeed",[uTe,dTe],Object.getOwnPropertyDescriptor(XK.prototype,"setAudioBufferPlaybackSpeed"),XK.prototype),XK);class SK extends _q{get __className__(){return"MixingAudioTrack"}get isActive(){for(const d of this.trackList)if(d._enabled&&!d._isClosed&&!d.muted)return!0;return!1}constructor(){const d=F$().createMediaStreamDestination();super(d.stream.getAudioTracks()[0],void 0,A6(8,"track-mix-")),kH(this,"trackList",void 0),kH(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=d,this.trackList=[]}hasAudioTrack(d){return this.trackList.indexOf(d)!==-1}addAudioTrack(d){this.trackList.indexOf(d)===-1?(CN.debug("add ".concat(d.getTrackId()," to mixing track")),d._source.outputNode.connect(this.destNode),this.trackList.push(d),this.updateEncoderConfig()):CN.debug("track ".concat(d.getTrackId()," is already added"))}removeAudioTrack(d){if(this.trackList.indexOf(d)!==-1){CN.debug("remove ".concat(d.getTrackId()," from mixing track"));try{d._source.outputNode.disconnect(this.destNode)}catch{}Xse(this.trackList,d),this.updateEncoderConfig()}}updateEncoderConfig(){const d={};this.trackList.forEach(l=>{l._encoderConfig&&((l._encoderConfig.bitrate||0)>(d.bitrate||0)&&(d.bitrate=l._encoderConfig.bitrate),(l._encoderConfig.sampleRate||0)>(d.sampleRate||0)&&(d.sampleRate=l._encoderConfig.sampleRate),(l._encoderConfig.sampleSize||0)>(d.sampleSize||0)&&(d.sampleSize=l._encoderConfig.sampleSize),l._encoderConfig.stereo&&(d.stereo=!0))}),this._encoderConfig=d}_updateRtpTransceiver(d){this._rtpTransceiver!==d&&(this._rtpTransceiver=d,this.trackList.forEach(l=>{l instanceof SK?l.emit(gQ.TRANSCEIVER_UPDATED,d):l._updateRtpTransceiver(d)}))}}class xDe extends lge{set currentState(d){d!==this._currentState&&(this._currentState=d,this.safeEmit(C8.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),kH(this,"audioBuffer",void 0),kH(this,"sourceNode",void 0),kH(this,"startPlayTime",0),kH(this,"startPlayOffset",0),kH(this,"pausePlayTime",0),kH(this,"options",void 0),kH(this,"currentLoopCount",0),kH(this,"currentPlaybackSpeed",100),kH(this,"_currentState","stopped"),this.audioBuffer=d,this.options=l,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(d){this.currentState==="stopped"?(this.options=d,this.startPlayOffset=this.options.startPlayTime||0):CN.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(d){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=d,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=d))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(d){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=d/100),this.currentPlaybackSpeed=d}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const d=this.context.createBufferSource();return d.buffer=this.audioBuffer,d.loop=!!this.options.loop,d.connect(this.outputNode),d.playbackRate.value=this.currentPlaybackSpeed/100,d}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const lTe=new Map;class Kde{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const d=this.renderStats.curTs-this.renderStats.lastTs,l=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/d;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,l}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(d){d!==this._videoElementStatus&&(CN.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(d)),this._videoElementStatus=d)}get videoState(){return this._videoState}set videoState(d){var l;d!==this._videoState&&(this._videoState=d,(l=this.onVideoStateChanged)===null||l===void 0||l.call(this,this.videoState))}constructor(d){kH(this,"trackId",void 0),kH(this,"config",void 0),kH(this,"onFirstVideoFrameDecoded",void 0),kH(this,"onVideoStateChanged",void 0),kH(this,"freezeTimeCounterList",[]),kH(this,"renderFreezeAccTime",0),kH(this,"isKeepLastFrame",!1),kH(this,"timeUpdatedCount",0),kH(this,"freezeTime",0),kH(this,"playbackTime",0),kH(this,"lastTimeUpdatedTime",0),kH(this,"autoplayFailed",!1),kH(this,"videoTrack",void 0),kH(this,"videoElement",void 0),kH(this,"cacheVideoElement",void 0),kH(this,"renderStats",void 0),kH(this,"_videoState",jJ.VideoStateStopped),kH(this,"videoElementCheckInterval",void 0),kH(this,"videoElementFreezeTimeout",void 0),kH(this,"_videoElementStatus",f4.NONE),kH(this,"isGettingVideoDimensions",!1),kH(this,"startGetVideoDimensions",()=>{const l=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return CN.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(l,500)};!this.isGettingVideoDimensions&&l()}),kH(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&y6.curState==="running"&&(CN.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(fme())),yme()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),kH(this,"handleVideoEvents",l=>{switch(l.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=f4.PLAYING;break;case"loadeddata":if(this.videoState=jJ.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=f4.CANPLAY;break;case"stalled":this.videoElementStatus=f4.STALLED;break;case"suspend":this.videoElementStatus=f4.SUSPEND;break;case"pause":this.videoElementStatus=f4.PAUSED,I4()||EY()||KK()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(CN.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=f4.WAITING;break;case"abort":this.videoElementStatus=f4.ABORT;break;case"ended":this.videoElementStatus=f4.ENDED;break;case"emptied":this.videoElementStatus=f4.EMPTIED;break;case"error":{const f=this.videoElement.error;f&&(this.videoElementStatus=f4.ERROR,CN.error("[".concat(this.trackId,"] media error: ").concat(f.message," (").concat(f.code,")")));break}case"timeupdate":{const f=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=f);const b=f-this.lastTimeUpdatedTime,k=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=f,P7.lastVisibleTime<P7.lastHiddenTime||k<P7.lastHiddenTime||k<P7.lastVisibleTime)return;for(b>_H("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=b),this.playbackTime+=b;this.playbackTime>=6e3;){this.playbackTime-=6e3;const B=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(B),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),kH(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(CN.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(fme())),yme()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=d.trackId,this.config=d,d.element instanceof HTMLVideoElement?this.videoElement=d.element:this.videoElement=document.createElement("video"),y6.on(WK.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),y6.on(WK.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var d;return(d=this.videoElement.parentElement)!==null&&d!==void 0?d:void 0}updateConfig(d){this.config=d,this.trackId=d.trackId,d.element!==this.videoElement&&(this.destroy(),this.videoElement=d.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(d){this.videoTrack!==d&&(this.videoTrack=d,this.initVideoElement())}play(d){const l=this.videoElement.play();l&&l.catch&&l.catch(b=>{d&&gge(d,"video",b.message,this.trackId),b.name==="NotAllowedError"?(CN.warning("detected video element autoplay failed",b),this.autoplayFailed=!0,this.handleAutoPlayFailed()):CN.warning("[".concat(this.trackId,"] play warning: "),b)});const f=c6();if((f.name==="Safari"&&Number(f.version)===15||w$())&&l&&l.then){const b=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};l.then(b).catch(b)}}getCurrentFrame(){const d=document.createElement("canvas");d.width=this.videoElement.videoWidth,d.height=this.videoElement.videoHeight;const l=d.getContext("2d");if(!l)return CN.error("create canvas context failed!"),new ImageData(2,2);l.drawImage(this.videoElement,0,0,d.width,d.height);const f=l.getImageData(0,0,d.width,d.height);return d.remove(),f}async getCurrentFrameToUint8Array(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const f=document.createElement("canvas");f.width=this.videoElement.videoWidth,f.height=this.videoElement.videoHeight;const b=f.getContext("2d");return b?(b.drawImage(this.videoElement,0,0,f.width,f.height),new u5((k,B)=>{f.toBlob(async Wt=>{if(f.remove(),Wt){const $O=await wge(Wt);k({buffer:$O,width:f.width,height:f.height})}else B(new jH(dH.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},d,l<0?.1:l>1?1:l)})):await qde(d)}destroy(){this.renderStats=void 0,y6.off(WK.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),y6.off(WK.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=jJ.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=f4.INIT,!this.videoElementCheckInterval&&(hTe.forEach(k=>{this.videoElement.addEventListener(k,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(k){return k!==document.body&&document.body.contains(k)})(this.videoElement)||(this.videoElementStatus=f4.DESTROYED)},1e3),_H("ENABLE_VIDEO_FRAME_CALLBACK"))){var d,l;let k;const B=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",B),this.videoElementFreezeTimeout=window.setTimeout(Wt,_H("VIDEO_FREEZE_DURATION")))},Wt=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===jJ.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=jJ.VideoStateFrozen:document.addEventListener("visibilitychange",B))},$O=(uN,lN)=>{if(this.videoElementStatus===f4.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=lN.mediaTime):this.renderStats={lastTs:lN.mediaTime,curTs:lN.mediaTime,lastRenderNum:0,renderNum:0},k){const vN=lN.presentationTime-k.presentationTime;this.videoState===jJ.VideoStateStarting&&(this.videoState=jJ.VideoStateDecoding),this.videoState===jJ.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(Wt,_H("VIDEO_FREEZE_DURATION"))),vN<_H("VIDEO_FREEZE_DURATION")&&this.videoState===jJ.VideoStateFrozen&&(this.videoState=jJ.VideoStateDecoding),vN>_H("VIDEO_FREEZE_DURATION")&&P7.lastVisibleTime>=P7.lastHiddenTime&&k.timestamp>P7.lastVisibleTime&&k.timestamp>P7.lastHiddenTime&&(this.renderFreezeAccTime+=vN)}k=B6(B6({},lN),{},{timestamp:uN})}var _N,TN;_H("ENABLE_VIDEO_FRAME_CALLBACK")&&((_N=(TN=this.videoElement).requestVideoFrameCallback)===null||_N===void 0||_N.call(TN,$O))};(d=(l=this.videoElement).requestVideoFrameCallback)===null||d===void 0||d.call(l,$O)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Jse()&&!_H("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const f=c6();f.name==="Safari"&&Number(f.version)===15||w$()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Z6()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Z6()&&this.videoElement.load());const b=this.videoElement.play();b!==void 0&&b.catch(k=>{CN.debug("[".concat(this.trackId,"] playback interrupted"),k.toString())})}resetVideoElement(){hTe.forEach(d=>{this.videoElement&&this.videoElement.removeEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=f4.NONE}handleAutoPlayFailed(){const d=l=>{l.preventDefault(),this.videoElement.play().then(()=>{CN.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(f=>{CN.error(f)}),this.autoplayFailed=!1,fne()?document.body.removeEventListener("click",d,!0):(document.body.removeEventListener("touchstart",d,!0),document.body.removeEventListener("mousedown",d,!0))};fne()?document.body.addEventListener("click",d,!0):(document.body.addEventListener("touchstart",d,!0),document.body.addEventListener("mousedown",d,!0)),mge()}}const hTe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class pTe extends Kde{constructor(d){super(d),kH(this,"container",void 0),kH(this,"slot",void 0),this.slot=d.element,this.updateConfig(d)}updateConfig(d){this.config=d,this.trackId=d.trackId;const l=d.element;l!==this.slot&&(this.destroy(),this.slot=l),this.createElements()}updateVideoTrack(d){this.videoTrack!==d&&(this.videoTrack=d,this.createElements())}play(d){var l;(l=this.container)!==null&&l!==void 0&&l.contains(this.videoElement)&&super.play(d)}getCurrentFrame(){var d;return(d=this.container)!==null&&d!==void 0&&d.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(d){var l;let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(l=this.container)!==null&&l!==void 0&&l.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(d,f):await qde(d)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",_H("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var d;!this.container||(d=this.container)!==null&&d!==void 0&&d.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var d;if((d=this.container)!==null&&d!==void 0&&d.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var d;(d=this.container)!==null&&d!==void 0&&d.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var fTe,_Te,ETe,mTe,gTe,TTe,STe,yTe,RTe,bTe,vTe,CTe,ITe,wTe,ATe,OTe,NTe,PTe,DTe,kTe,LTe,MTe,UTe,xTe,n6,VTe,FTe,jTe,BTe,GTe,WTe,HTe,qTe,P8;let x6=(fTe=A5({argsMap:(s,d,l)=>[s.getTrackId(),typeof d=="string"?d:d instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",l]}),_Te=sK(),ETe=A5({argsMap:s=>[s.getTrackId()]}),mTe=N$("LocalVideoTrack","_enabledMutex"),gTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),TTe=sK(),STe=N$("LocalVideoTrack","_enabledMutex"),yTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),RTe=sK(),bTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),vTe=sK(),CTe=sK(),ITe=A5({argsMap:(s,d,l)=>[s.getTrackId(),d,l]}),wTe=sK(),ATe=sK(),OTe=sK(),NTe=sK(),PTe=sK(),DTe=sK(),kTe=sK(),LTe=A5({argsMap:(s,d)=>[s.getTrackId(),d.name]}),MTe=A5({argsMap:s=>[s.getTrackId()]}),UTe=A5({argsMap:s=>[s.getTrackId()]}),xTe=A5({argsMap:(s,d,l)=>[s.getTrackId(),d.label,l]}),n6=class Rve extends V${get videoHeight(){if(KK()){const{height:d}=this._mediaStreamTrack.getSettings();return this._videoHeight=d,this._videoHeight}return this._videoHeight}get videoWidth(){if(KK()){const{width:d}=this._mediaStreamTrack.getSettings();return this._videoWidth=d,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==f4.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(d){this._processorContext=d}get __className__(){return"LocalVideoTrack"}constructor(d,l,f,b,k,B){if(super(d,k),kH(this,"trackMediaType",x$.VIDEO),kH(this,"_player",void 0),kH(this,"isUseScaleResolutionDownBy",!1),kH(this,"_videoVisibleTimer",null),kH(this,"_previousVideoVisibleStatus",void 0),kH(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),kH(this,"_encoderConfig",void 0),kH(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),kH(this,"_optimizationMode",void 0),kH(this,"_videoHeight",void 0),kH(this,"_videoWidth",void 0),kH(this,"_forceBitrateLimit",void 0),kH(this,"_enabled",!0),kH(this,"_processorDestination",void 0),kH(this,"_processorContext",void 0),KK()){const{width:Wt,height:$O}=d.getSettings();this._videoWidth=Wt,this._videoHeight=$O}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=l,this._scalabilityMode=f,this._optimizationMode=b,this._hints=B||[],this._hints.indexOf(O6.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ude(p6.CHROME,115)&&zse().indexOf("Windows")!==-1){const Wt=function($O,uN){if("VideoFrame"in window&&"TransformStream"in window&&u6().supportWebRTCInsertableStream){const lN=new MediaStreamTrackProcessor($O),_N=new MediaStreamTrackGenerator({kind:"video"});let TN,vN,uH=Date.now();const rH=()=>{iH&&(clearInterval(iH),iH=void 0),TN&&(TN.close(),TN=void 0),$O.stop(),vN=void 0,_N.removeEventListener("ended",rH)};let iH=window.setInterval(()=>{if(vN&&TN&&Date.now()-uH>1e3)try{_N.readyState==="live"?vN.enqueue(TN.clone()):rH()}catch{rH()}},1e3);const lH=new TransformStream({transform:(hH,bH)=>{_N.readyState==="live"?(vN=bH,uH=Date.now(),TN===void 0?(TN=hH,bH.enqueue(hH.clone())):(bH.enqueue(TN),TN=hH)):hH.close()}});return _N.addEventListener("ended",rH),lN.readable.pipeThrough(lH).pipeTo(_N.writable),_N}}(d);Wt&&(CN.info("local screen video track begin to inject frame"),this._mediaStreamTrack=Wt)}l&&this._hints.indexOf(O6.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(l),this._processorContext=new Sge(this.getTrackId(),"local"),this._processorDestination=new Tge(this.processorContext),this.bindProcessorDestinationEvents()}play(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof d=="string"){const b=document.getElementById(d);b?d=b:(CN.warning("[".concat(this.getTrackId(),'] can not find "#').concat(d,'" element, use document.body')),d=document.body)}CN.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(d instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(l));const f=B6(B6(B6({},this._getDefaultPlayerConfig()),l),{},{trackId:this.getTrackId(),element:d});this._player?this._player.updateConfig(f):(d instanceof HTMLVideoElement?this._player=new Kde(f):this._player=new pTe(f),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const b=this.getVideoElementVisibleStatus();this.safeEmit(M$.VIDEO_ELEMENT_VISIBLE_STATUS,b)}catch{}},_H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,CN.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(d,l){if(!l){if(d===this._enabled)return;this.stateCheck("enabled",d)}if(CN.info("[".concat(this.getTrackId(),"] start setEnabled"),d),!d){this._originMediaStreamTrack.enabled=!1;try{await w6(this,E5.NEED_DISABLE_TRACK,this)}catch(f){throw CN.error("[".concat(this.getTrackId(),"] setEnabled to false error"),f.toString()),f}return l||(this._enabled=!1),void CN.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await w6(this,E5.NEED_ENABLE_TRACK,this)}catch(f){throw CN.error("[".concat(this.getTrackId(),"] setEnabled to true error"),f.toString()),f}CN.info("[".concat(this.getTrackId(),"] setEnabled to true success")),l||(this._enabled=!0)}async setMuted(d){d!==this._muted&&(this.stateCheck("muted",d),this._muted=d,this._originMediaStreamTrack.enabled=!d,CN.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(d)),d?await w6(this,E5.NEED_MUTE_TRACK,this):await w6(this,E5.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(d,l){if(!this._enabled)throw new jH(dH.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(d=FJ(d),this._forceBitrateLimit&&(d.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:d.bitrateMax,d.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:d.bitrateMin),d.width||d.height||d.frameRate){const f=uoe({encoderConfig:d});(KK()||I4()||EY())&&(f.deviceId=void 0),CN.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(d),JSON.stringify(f));try{await this._originMediaStreamTrack.applyConstraints(f),this.updateMediaStreamTrackResolution()}catch(b){const k=new jH(dH.UNEXPECTED_ERROR,b.toString());throw CN.error("[".concat(this.getTrackId(),"] applyConstraints error"),k.toString()),k}}this._encoderConfig=d,this._hints.indexOf(O6.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await w6(this,E5.NEED_UPDATE_VIDEO_ENCODER,this)}catch(f){return f.throw(CN)}}getStats(){return LX(()=>{CN.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),R8(this,E5.GET_STATS)||B6({},Vde)}async setBeautyEffect(d){CN.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(d,l):await qde(d)}async setBitrateLimit(d){CN.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(d))),d&&(this._forceBitrateLimit=d,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<d.max_bitrate?this._encoderConfig.bitrateMax:d.max_bitrate:this._encoderConfig.bitrateMax=d.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=d.min_bitrate))}async setOptimizationMode(d){if(d!=="motion"&&d!=="detail"&&d!=="balanced")return void CN.error(dH.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const l=this._optimizationMode;try{this._optimizationMode=d,await w6(this,E5.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(f){throw this._optimizationMode=l,CN.error("[".concat(this.getTrackId(),"] set optimization mode failed"),f.toString()),f}CN.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(d,")"))}setScalabiltyMode(d){if(d.numSpatialLayers===1&&d.numTemporalLayers!==1)return CN.error(dH.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=d,CN.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(d,")"))}updateMediaStreamTrackResolution(){bge(this._originMediaStreamTrack).then(d=>{let[l,f]=d;this._videoHeight=f,this._videoWidth=l}).catch(Zse)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(d){if(!this._enabled)throw new jH(dH.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");CN.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(d)),d=FJ(d),this._forceBitrateLimit&&(d.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:d.bitrateMax,d.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:d.bitrateMin),this._encoderConfig=d,this._hints.indexOf(O6.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await w6(this,E5.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(CN)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:d,height:l,frameRate:f}=this.getMediaStreamTrackSettings();if(!d||!l||!f)return;const{bitrateMax:b,bitrateMin:k}=this._encoderConfig;if(k==null||b==null){const{max:B,min:Wt}=function($O,uN,lN,_N,TN){const vN=_H("BITRATE_ADAPTER_TYPE");if(vN==="DEFAULT_BITRATE")return{min:_N,max:TN};if(TN===void 0){var uH;const iH=Math.floor(200*Math.pow(lN/15,.6)*Math.pow($O*uN/640/360,.75));TN=vN==="STANDARD_BITRATE"?4*iH:2*iH,_N=(uH=_N)!==null&&uH!==void 0?uH:iH}else{var rH;_N=(rH=_N)!==null&&rH!==void 0?rH:Math.floor(TN/10)}return{min:_N,max:TN}}(d,l,f,k,b);this._encoderConfig.bitrateMin=Wt,this._encoderConfig.bitrateMax=B,CN.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(d,", h: ").concat(l,", fps: ").concat(f,"] => [brMax: ").concat(B,", brMin: ").concat(Wt,"]"))}}getVideoElementVisibleStatus(){try{var d,l;const f=this==null||(d=this._player)===null||d===void 0?void 0:d.getContainerElement(),b={track:this,element:this==null||(l=this._player)===null||l===void 0?void 0:l.getVideoElement(),slot:f==null?void 0:f.parentElement},{element:k,slot:B}=b;if(this.isPlaying&&k instanceof HTMLVideoElement&&B instanceof HTMLElement){const Wt=Ime.checkOneElementVisible(k),$O=Object.assign({},Wt);if($O.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=$O.visible;const uN=T5.reportApiInvoke(null,{tag:Y6.TRACER,name:_K.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});$O.visible?uN.onSuccess("Video is visible"):uN.onSuccess("Invisible because of ".concat($O.reason))}return $O}return}catch(f){throw new jH(dH.GET_VIDEO_ELEMENT_VISIBLE_ERROR,f.message)}}async renewMediaStreamTrack(d){}pipe(d){if(this.processor===d)return d;if(d._source)throw new jH(dH.INVALID_OPERATION,"Processor ".concat(d.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=d,this.processor._source=this,d.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),d}unpipe(){if(!this.processor)return;const d=this.processor;this.processor._source=void 0,this.processor=void 0,d.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(d){let l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],f=this._encoderConfig;d&&(f=B6(B6({},f),FJ(d))),f=fQ(f);const b=A6(8,"track-video-cloned-"),k=new Rve(l?this._mediaStreamTrack.clone():this._mediaStreamTrack,f,fQ(this._scalabilityMode),this._optimizationMode,b,fQ(this._hints));return d&&f&&k.setEncoderConfiguration(f),CN.debug("clone video track from ".concat(this.getTrackId()," to ").concat(b,", clone ").concat(l)),k}async replaceTrack(d,l){if(!(d instanceof MediaStreamTrack))throw new jH(dH.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(d.kind!=="video")throw new jH(dH.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(d,l,!0),this.updateMediaStreamTrackResolution()}sendSeiData(d){if(LX(()=>{T5.reportApiInvoke(null,{name:_K.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Y6.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!_H("ENABLE_VIDEO_SEI")||!_H("ENABLE_ENCODED_TRANSFORM"))return void CN.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(d instanceof Uint8Array==0)return new jH(dH.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const l=this.getRTCRtpTransceiver();if(!l)return void CN.warning("Video track is not published, SEI can not be send");const f=l.sender.getParameters();if(f.codecs.length===0)return;const b=f.codecs[0].mimeType.toLocaleLowerCase();b==="video/h264"?this.safeEmit("sei-to-send",d):CN.warning("SEI is not supported by ".concat(b))}bindProcessorDestinationEvents(){this.processorDestination.on(w4.ON_TRACK,async d=>{d?d!==this._mediaStreamTrack&&(this._mediaStreamTrack=d,this._updatePlayerSource(),await w6(this,E5.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await w6(this,E5.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(w4.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(I8.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(I8.REQUEST_CONSTRAINTS)}},o6(n6.prototype,"play",[fTe,_Te],Object.getOwnPropertyDescriptor(n6.prototype,"play"),n6.prototype),o6(n6.prototype,"stop",[ETe],Object.getOwnPropertyDescriptor(n6.prototype,"stop"),n6.prototype),o6(n6.prototype,"setEnabled",[mTe,gTe,TTe],Object.getOwnPropertyDescriptor(n6.prototype,"setEnabled"),n6.prototype),o6(n6.prototype,"setMuted",[STe,yTe,RTe],Object.getOwnPropertyDescriptor(n6.prototype,"setMuted"),n6.prototype),o6(n6.prototype,"setEncoderConfiguration",[bTe,vTe],Object.getOwnPropertyDescriptor(n6.prototype,"setEncoderConfiguration"),n6.prototype),o6(n6.prototype,"getStats",[CTe],Object.getOwnPropertyDescriptor(n6.prototype,"getStats"),n6.prototype),o6(n6.prototype,"setBeautyEffect",[ITe,wTe],Object.getOwnPropertyDescriptor(n6.prototype,"setBeautyEffect"),n6.prototype),o6(n6.prototype,"getCurrentFrameData",[ATe],Object.getOwnPropertyDescriptor(n6.prototype,"getCurrentFrameData"),n6.prototype),o6(n6.prototype,"getCurrentFrameImage",[OTe],Object.getOwnPropertyDescriptor(n6.prototype,"getCurrentFrameImage"),n6.prototype),o6(n6.prototype,"setBitrateLimit",[NTe],Object.getOwnPropertyDescriptor(n6.prototype,"setBitrateLimit"),n6.prototype),o6(n6.prototype,"setOptimizationMode",[PTe],Object.getOwnPropertyDescriptor(n6.prototype,"setOptimizationMode"),n6.prototype),o6(n6.prototype,"setScalabiltyMode",[DTe],Object.getOwnPropertyDescriptor(n6.prototype,"setScalabiltyMode"),n6.prototype),o6(n6.prototype,"updateMediaStreamTrackResolution",[kTe],Object.getOwnPropertyDescriptor(n6.prototype,"updateMediaStreamTrackResolution"),n6.prototype),o6(n6.prototype,"pipe",[LTe],Object.getOwnPropertyDescriptor(n6.prototype,"pipe"),n6.prototype),o6(n6.prototype,"unpipe",[MTe],Object.getOwnPropertyDescriptor(n6.prototype,"unpipe"),n6.prototype),o6(n6.prototype,"close",[UTe],Object.getOwnPropertyDescriptor(n6.prototype,"close"),n6.prototype),o6(n6.prototype,"replaceTrack",[xTe],Object.getOwnPropertyDescriptor(n6.prototype,"replaceTrack"),n6.prototype),n6),zde=(VTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),FTe=sK(),jTe=N$("CameraVideoTrack","_enabledMutex"),BTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),GTe=sK(),WTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),HTe=sK(),qTe=A5({argsMap:s=>[s.getTrackId()]}),P8=class bve extends x6{get __className__(){return"CameraVideoTrack"}constructor(d,l,f,b,k,B){super(d,FJ(l.encoderConfig),b,k,B),kH(this,"_config",void 0),kH(this,"_originalConstraints",void 0),kH(this,"_constraints",void 0),kH(this,"_enabled",!0),kH(this,"_deviceName","default"),kH(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(w$()||hde())&&!function(){const Wt=c6();if(Wt.os!==AK.IOS||!Wt.osVersion)return!1;const $O=Wt.osVersion.split(".");return Number($O[0])===15&&Number($O[1])>=2}()&&Rme()&&this._enabled&&!this._isClosed&&(CN.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=l,this._originalConstraints=f,this._constraints=f,this._deviceName=d.label,this._encoderConfig=FJ(this._config.encoderConfig),y6.on(WK.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),y6.on(WK.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(d){return typeof d=="string"?this._setDeviceById(d):d.deviceId?this._setDeviceById(d.deviceId):d.facingMode?this._setDeviceByFacingModel(d.facingMode):void 0}async _setDeviceById(d){if(CN.info("[".concat(this.getTrackId(),"] set device to ").concat(d)),this._enabled)try{const l=await O8.getDeviceById(d),f={};f.video=B6({},this._constraints),f.video.deviceId={exact:d},f.video.facingMode=void 0,this._originMediaStreamTrack.stop();let b=null;try{b=await A8(f,this.getTrackId())}catch(k){throw CN.error("[".concat(this.getTrackId(),"] setDevice failed"),k.toString()),b=await A8({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(b.getVideoTracks()[0],!1),k}await this._updateOriginMediaStreamTrack(b.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=l.label,this._config.cameraId=d,this._constraints.deviceId={exact:d}}catch(l){throw CN.error("[".concat(this.getTrackId(),"] setDevice error"),l.toString()),l}else try{const l=await O8.getDeviceById(d);this._deviceName=l.label,this._config.cameraId=d,this._constraints.deviceId={exact:d}}catch(l){throw CN.error("[".concat(this.getTrackId(),"] setDevice error"),l.toString()),l}CN.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(d){CN.info("[".concat(this.getTrackId(),"] set facingMode ").concat(d));const l={video:B6(B6({},this._constraints),{},{deviceId:void 0,facingMode:{exact:d}})};if(this._enabled){this._originMediaStreamTrack.stop();let f=null;try{f=await A8(l,this.getTrackId())}catch(b){throw CN.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),b.toString()),f=await A8({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(f.getVideoTracks()[0],!1),b}await this._updateOriginMediaStreamTrack(f.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=d,this._config.cameraId=void 0,this._constraints=B6({},l.video),CN.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(d,l){if(!l){if(d===this._enabled)return;this.stateCheck("enabled",d)}if(CN.info("[".concat(this.getTrackId(),"] start setEnabled"),d),d){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const f=await A8({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getVideoTracks()[0],!1)}await w6(this,E5.NEED_ENABLE_TRACK,this)}catch(f){throw CN.error("[".concat(this.getTrackId(),"] setEnabled true error"),f.toString()),f}this.updateMediaStreamTrackResolution(),CN.info("[".concat(this.getTrackId(),"] setEnabled to true success")),l||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),l||(this._enabled=!1);try{await w6(this,E5.NEED_DISABLE_TRACK,this)}catch(f){throw CN.error("[".concat(this.getTrackId(),"] setEnabled to false error"),f.toString()),f}CN.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(d,l){if(!this._enabled)throw new jH(dH.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");d=FJ(d),this._forceBitrateLimit&&(d.bitrateMax=this._forceBitrateLimit.max_bitrate||d.bitrateMax,d.bitrateMin=this._forceBitrateLimit.min_bitrate||d.bitrateMin);const f=$6(this._config);f.encoderConfig=d;const b=uoe(f);(KK()||I4()||EY())&&(b.deviceId=void 0),CN.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(d),JSON.stringify(b));try{await this._originMediaStreamTrack.applyConstraints(b),this.updateMediaStreamTrackResolution()}catch(k){const B=new jH(dH.UNEXPECTED_ERROR,k.toString());throw CN.error("[".concat(this.getTrackId(),"] applyConstraints error"),B.toString()),B}this._config=f,this._constraints=b,this._originalConstraints=b,this._encoderConfig=d,this._hints.indexOf(O6.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await w6(this,E5.NEED_UPDATE_VIDEO_ENCODER,this)}catch(k){return k.throw(CN)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((I4()||EY())&&this._enabled&&!this._isClosed&&y6.duringInterruption){const d=async()=>{y6.off(WK.IOS_INTERRUPTION_END,d),this._enabled&&!this._isClosed&&(CN.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};y6.on(WK.IOS_INTERRUPTION_END,d)}else CN.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(M$.TRACK_ENDED)}async renewMediaStreamTrack(d){const l=d||this._constraints,f=O8.searchDeviceIdByName(this._deviceName);if(f&&!l.deviceId&&(l.deviceId={exact:f}),this._enabled){const b=await A8({video:l},this.getTrackId());this._constraints=l,await this._updateOriginMediaStreamTrack(b.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),y6.off(WK.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),y6.off(WK.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(d){let l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],f=this._encoderConfig;d&&(f=B6(B6({},f),FJ(d))),f=fQ(f);const b=A6(8,"track-cam-cloned-"),k=new bve(l?this._mediaStreamTrack.clone():this._mediaStreamTrack,fQ(B6(B6({},this._config),{},{encoderConfig:f})),fQ(this._constraints),fQ(this._scalabilityMode),this._optimizationMode,b);return d&&f&&k.setEncoderConfiguration(f),CN.debug("clone track from ".concat(this.getTrackId()," to ").concat(b,", clone ").concat(l)),k}bindProcessorContextEvents(){this.processorContext.on(I8.REQUEST_UPDATE_CONSTRAINTS,async(d,l,f)=>{try{const b=Object.assign({},this._originalConstraints,...d);await this.renewMediaStreamTrack(b),l()}catch(b){f(b)}}),this.processorContext.on(I8.REQUEST_CONSTRAINTS,async d=>{d(this._originMediaStreamTrack.getSettings())})}},o6(P8.prototype,"setDevice",[VTe,FTe],Object.getOwnPropertyDescriptor(P8.prototype,"setDevice"),P8.prototype),o6(P8.prototype,"setEnabled",[jTe,BTe,GTe],Object.getOwnPropertyDescriptor(P8.prototype,"setEnabled"),P8.prototype),o6(P8.prototype,"setEncoderConfiguration",[WTe,HTe],Object.getOwnPropertyDescriptor(P8.prototype,"setEncoderConfiguration"),P8.prototype),o6(P8.prototype,"close",[qTe],Object.getOwnPropertyDescriptor(P8.prototype,"close"),P8.prototype),P8);function Yde(s,d,l,f){l.optimizationMode&&(f&&f.width&&f.height?(l.encoderConfig=B6(B6({},f),{},{bitrateMin:f.bitrateMin,bitrateMax:f.bitrateMax}),l.optimizationMode!=="motion"&&l.optimizationMode!=="detail"||(d.contentHint=l.optimizationMode,d.contentHint===l.optimizationMode?CN.debug("[".concat(s,"] set content hint to"),l.optimizationMode):CN.debug("[".concat(s,"] set content hint failed")))):CN.warning("[".concat(s,"] can not apply optimization mode bitrate config, no encoderConfig")))}var KTe,zTe,YTe,JTe,z8,XTe,QTe,ZTe,$Te,eSe,tSe,_4;class nSe extends cge{getUserId(){return this._userId}constructor(d,l,f,b){super(d,"track-".concat(d.kind,"-").concat(l,"-").concat(b.clientId,"_").concat(A6(5,""))),kH(this,"_userId",void 0),kH(this,"_uintId",void 0),kH(this,"_isDestroyed",!1),kH(this,"store",void 0),kH(this,"processor",void 0),kH(this,"processorContext",void 0),this._userId=l,this._uintId=f,this.store=b}_updateOriginMediaStreamTrack(d){this._originMediaStreamTrack=d,this._mediaStreamTrack=d,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,CN.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let B$=(KTe=A5({argsMap:(s,d,l)=>[s.getTrackId(),typeof d=="string"?d:d instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",l]}),zTe=A5({argsMap:s=>[s.getTrackId()]}),YTe=A5({argsMap:(s,d)=>[s.getTrackId(),d.name]}),JTe=A5({argsMap:s=>[s.getTrackId()]}),o6((z8=class extends nSe{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==f4.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(s,d,l,f){super(s,d,l,f),kH(this,"_videoVisibleTimer",null),kH(this,"_previousVideoVisibleStatus",void 0),kH(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),kH(this,"trackMediaType",x$.VIDEO),kH(this,"_videoWidth",void 0),kH(this,"_videoHeight",void 0),kH(this,"_player",void 0),kH(this,"processorDestination",void 0),kH(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Sge(this.getTrackId(),"remote"),this.processorDestination=new Tge(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return LX(()=>{CN.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),R8(this,E5.GET_STATS)||B6({},oge)}play(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof s=="string"){const f=document.getElementById(s);f?s=f:(CN.warning("[".concat(this.getTrackId(),'] can not find "#').concat(s,'" element, use document.body')),s=document.body)}CN.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(d));const l=B6(B6({fit:"cover"},d),{},{trackId:this.getTrackId(),element:s});this._player?this._player.updateConfig(l):(s instanceof HTMLVideoElement?this._player=new Kde(l):this._player=new pTe(l),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(U$.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=f=>{this.safeEmit(U$.VIDEO_STATE_CHANGED,f)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const f=this.getVideoElementVisibleStatus();this.safeEmit(U$.VIDEO_ELEMENT_VISIBLE_STATUS,f)}catch{}},_H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,CN.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){bge(this._originMediaStreamTrack).then(s=>{let[d,l]=s;this._videoHeight=l,this._videoWidth=d}).catch(Zse)}_updatePlayerSource(){CN.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var s,d;const l=this==null||(s=this._player)===null||s===void 0?void 0:s.getContainerElement(),f={track:this,element:this==null||(d=this._player)===null||d===void 0?void 0:d.getVideoElement(),slot:l==null?void 0:l.parentElement},{element:b,slot:k}=f;if(this.isPlaying&&b instanceof HTMLVideoElement&&k instanceof HTMLElement){const B=Ime.checkOneElementVisible(b),Wt=Object.assign({},B);if(Wt.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=Wt.visible;const $O=T5.reportApiInvoke(null,{tag:Y6.TRACER,name:_K.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});Wt.visible?$O.onSuccess("Video is visible"):$O.onSuccess("Invisible because of ".concat(Wt.reason))}return Wt}return}catch(l){throw new jH(dH.GET_VIDEO_ELEMENT_VISIBLE_ERROR,l.message)}}pipe(s){if(this.processor===s)return s;if(s._source)throw new jH(dH.INVALID_OPERATION,"Processor ".concat(s.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=s,this.processor._source=this,s.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),s}unpipe(){if(!this.processor)return;const s=this.processor;this.processor._source=void 0,this.processor=void 0,s.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(w4.ON_TRACK,async s=>{s?s!==this._mediaStreamTrack&&(this._mediaStreamTrack=s,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(w4.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(s){this.emit(gQ.SEI_RECEIVED,s)}}).prototype,"play",[KTe],Object.getOwnPropertyDescriptor(z8.prototype,"play"),z8.prototype),o6(z8.prototype,"stop",[zTe],Object.getOwnPropertyDescriptor(z8.prototype,"stop"),z8.prototype),o6(z8.prototype,"pipe",[YTe],Object.getOwnPropertyDescriptor(z8.prototype,"pipe"),z8.prototype),o6(z8.prototype,"unpipe",[JTe],Object.getOwnPropertyDescriptor(z8.prototype,"unpipe"),z8.prototype),z8),G$=(XTe=A5({argsMap:(s,d)=>[s.getTrackId(),d],throttleTime:300}),QTe=A5({argsMap:(s,d)=>[s.getTrackId(),d]}),ZTe=A5({argsMap:s=>[s.getTrackId()]}),$Te=A5({argsMap:s=>[s.getTrackId()]}),eSe=A5({argsMap:(s,d)=>[s.getTrackId(),d.name]}),tSe=A5({argsMap:s=>[s.getTrackId()]}),o6((_4=class extends nSe{get isPlaying(){return this._useAudioElement?j4.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(s,d,l,f){super(s,d,l,f),kH(this,"trackMediaType",x$.AUDIO),kH(this,"_source",void 0),kH(this,"_useAudioElement",!0),kH(this,"_volume",100),kH(this,"processorContext",void 0),kH(this,"processorDestination",void 0),kH(this,"_played",!1),kH(this,"_bypassWebAudio",!1),_H("DISABLE_WEBAUDIO")?(this._source=new Hde,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new hge(s,!0),_H("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(C8.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(U$.FIRST_FRAME_DECODED)}),this.processorContext=new Rge(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new yge(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(C8.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!s)return this._source.removeAllListeners(C8.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(d),this._source.removeAllListeners(C8.ON_AUDIO_BUFFER),this._source.on(C8.ON_AUDIO_BUFFER,l=>s(l))}setVolume(s){this._volume=s,this._useAudioElement?j4.setVolume(this.getTrackId(),s):this._source.setVolume(s/100)}async setPlaybackDevice(s){if(!this._useAudioElement||!nge())throw new jH(dH.NOT_SUPPORTED,"your browser does not support setting the audio output device");await j4.setSinkID(this.getTrackId(),s)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return LX(()=>{CN.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),R8(this,E5.GET_STATS)||B6({},sge)}play(){CN.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(CN.debug("[".concat(this.getTrackId(),"] use audio element to play")),j4.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){CN.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?j4.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];CN.debug("[".concat(this.getTrackId(),"] update player source track")),s&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&j4.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(s){if(this._bypassWebAudio)throw new jH(dH.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===s)return s;if(s._source)throw new jH(dH.INVALID_OPERATION,"Processor ".concat(s.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=s,this.processor._source=this,s.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),s}unpipe(){var s;if(this._bypassWebAudio)throw new jH(dH.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const d=this.processor;(s=this._source.processSourceNode)===null||s===void 0||s.disconnect(),this.processor._source=!1,this.processor=void 0,d.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(w4.ON_TRACK,async s=>{s?s!==this._mediaStreamTrack&&(this._mediaStreamTrack=s,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(s)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(w4.ON_NODE,s=>{this._source.processedNode=s;const d=!s;this._useAudioElement!==d&&(this._played?(this.stop(),this._useAudioElement=d,this.play()):this._useAudioElement=d)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(w4.ON_TRACK),this.processorDestination.removeAllListeners(w4.ON_NODE)}}).prototype,"setVolume",[XTe],Object.getOwnPropertyDescriptor(_4.prototype,"setVolume"),_4.prototype),o6(_4.prototype,"setPlaybackDevice",[QTe],Object.getOwnPropertyDescriptor(_4.prototype,"setPlaybackDevice"),_4.prototype),o6(_4.prototype,"play",[ZTe],Object.getOwnPropertyDescriptor(_4.prototype,"play"),_4.prototype),o6(_4.prototype,"stop",[$Te],Object.getOwnPropertyDescriptor(_4.prototype,"stop"),_4.prototype),o6(_4.prototype,"pipe",[eSe],Object.getOwnPropertyDescriptor(_4.prototype,"pipe"),_4.prototype),o6(_4.prototype,"unpipe",[tSe],Object.getOwnPropertyDescriptor(_4.prototype,"unpipe"),_4.prototype),_4);const P7=new class extends W6{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),kH(this,"_lastHiddenTime",0),kH(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),CN.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class rSe extends W6{constructor(d,l){super(),kH(this,"trackMediaType",x$.DATA),kH(this,"_version",1),kH(this,"_type",3),kH(this,"_config",void 0),kH(this,"_originDataChannel",void 0),kH(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),kH(this,"_dataStreamPacketHandler",{serialize:f=>f,deserialize:f=>f}),kH(this,"_datachannelEventMap",new Map),this._config=d,l&&(this._originDataChannel=l,this._bandDataChannelEvents(l)),this._initPacketHeader()}useDataStream(d){this._dataStreamPacketHandler=d}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return _H("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var d,l;return(d=(l=this._originDataChannel)===null||l===void 0?void 0:l.readyState)!==null&&d!==void 0?d:"connecting"}get _originDataChannelId(){var d,l;return(d=(l=this._originDataChannel)===null||l===void 0?void 0:l.id)!==null&&d!==void 0?d:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new u5((d,l)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&d();const f=setTimeout(()=>{var b;l(new jH(dH.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((b=this._originDataChannel)===null||b===void 0?void 0:b.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(f),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),d()},this._originDataChannel.onerror=()=>{throw clearTimeout(f),new jH(dH.DATACHANNEL_CONNECTION_TIMEOUT)}}else l(new jH(dH.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(d){this._originDataChannel=d,this._bandDataChannelEvents(d)}_initPacketHeader(){const d=new DataView(this._dataStreamPacketHeader);d.setUint16(0,this._version),d.setUint8(2,this._type),d.setUint8(3,this._config.id)}_bandDataChannelEvents(d){this._unbindDataChannelEvents(d),[aoe.OPEN,aoe.CLOSE,aoe.ERROR].forEach(l=>{const f=()=>{this.emit(l)};this._datachannelEventMap.set(l,f),d.addEventListener(l,f)})}_unbindDataChannelEvents(d){Array.from(this._datachannelEventMap.entries()).forEach(l=>{let[f,b]=l;d.removeEventListener(f,b)}),this._datachannelEventMap.clear()}}class VDe extends rSe{constructor(d){super(d),kH(this,"_messageListener",void 0),this._messageListener=l=>{if(l.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const f=l.data.slice(0,this._dataStreamPacketHeader.byteLength),b=new DataView(f).getUint8(3);if(b!==this.id)return void(_H("SHOW_DATASTREAM2_LOG")&&CN.debug("invalid datachannel id: ".concat(b," !== ").concat(this.id)));let k=l.data.slice(this._dataStreamPacketHeader.byteLength);k=this._dataStreamPacketHandler.deserialize(k),this.emit(aoe.MESSAGE,k)}}_updateOriginDataChannel(d){super._updateOriginDataChannel(d),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class FDe extends rSe{send(d){if(this._originDataChannel){let l=d;l=this._dataStreamPacketHandler.serialize(d);const f=new Uint8Array(this._dataStreamPacketHeader.byteLength+l.byteLength);f.set(new Uint8Array(this._dataStreamPacketHeader),0),f.set(new Uint8Array(l),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(f.buffer)}}}function loe(){const s=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>lse.revokeObjectURL(s),0),new Worker(lse.createObjectURL(s))}var W$=function(s){return s[s.AUDIO_LEVEL=1]="AUDIO_LEVEL",s[s.METADATA=2]="METADATA",s}(W$||{});function iSe(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const l=s.getUint8(0);if(l!==71)return;const f=s.getUint16(1),b=3+f,k=new Uint8Array(s.byteLength-b);k.set(new Uint8Array(s.buffer,b,s.byteLength-b));const B={m:l,tlvLen:f,tlv:[],frame:k};let Wt=3;for(;Wt<b;){const $O=s.getUint8(Wt),uN=s.getUint16(Wt+1),lN=3;if($O===W$.AUDIO_LEVEL){let _N=s.getUint8(Wt+lN);for(let TN=1;TN<uN;TN++)_N=_N<<8|s.getUint8(Wt+lN+TN);B.tlv.push({tag:$O,length:uN,value:d?127^_N>>1:127&_N})}else if($O===W$.METADATA){const _N=new Uint8Array(uN);for(let TN=0;TN<uN;TN++)_N[TN]=s.getUint8(Wt+lN+TN);B.tlv.push({tag:$O,length:uN,value:_N})}Wt+=lN+uN}return B}const hoe=new Map;async function jDe(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!u6().supportWebRTCEncodedTransform)return void CN.warning("browser not support audio encoded transform");if(hoe.has(s)||!s.track)return;const l={track:s.track};if(w7()){if(!s.createEncodedStreams)return void CN.warning("browser not support createEncodedStreams() API");let b=null;try{b=s.createEncodedStreams()}catch(B){return void CN.error("create audio-encoded-streams error",B&&B.message)}const k=new TransformStream({transform(B,Wt){l.controller||(l.controller=Wt),s.track&&s.track.id!==l.track.id&&(CN.debug("audio track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f));const $O=d.metadata&&d.metadata();$O?function(uN,lN){const{chunk:_N,controller:TN}=lN;_N.data=function(vN,uH,rH){const iH=rH.byteLength,lH=iH+1+2,hH=3+lH,bH=new ArrayBuffer(vN.byteLength+hH),PH=new DataView(bH);PH.setUint8(0,71),PH.setUint16(1,lH),PH.setUint8(3,uH),PH.setUint16(4,iH);for(let wH=0;wH<iH;wH++)PH.setUint8(6+wH,rH[wH]);const OH=new Uint8Array(PH.buffer);return OH.set(new Uint8Array(vN),hH),OH.buffer}(_N.data,W$.METADATA,uN),TN.enqueue(_N)}($O,{sender:s,chunk:B,controller:Wt}):Wt.enqueue(B)}});b.readable.pipeThrough(k).pipeTo(b.writable)}else if(KK()){if(typeof RTCRtpScriptTransform>"u")return void CN.warning("browser not support RTCRtpScriptTransform");const b=loe(),k=new MessageChannel;await new u5(Wt=>b.onmessage=$O=>{$O.data==="registered"&&Wt(void 0)});const B=new RTCRtpScriptTransform(b,{name:"tx",port:k.port2},[k.port2]);s.transform=B,await new u5(Wt=>b.onmessage=$O=>{$O.data==="started"&&Wt(void 0)}),k.port1.onmessage=Wt=>{var $O;Wt.data.transformed&&s.track&&(($O=s.track)===null||$O===void 0?void 0:$O.id)!==l.track.id&&(CN.debug("audio track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f))},l.worker=b}function f(){if(s.track){if(this.id!==s.track.id)return;s.track.removeEventListener("ended",f)}const b=hoe.get(s);if(b){hoe.delete(s);try{var k,B;(k=b.controller)===null||k===void 0||k.terminate(),(B=b.worker)===null||B===void 0||B.terminate()}catch(Wt){CN.warning(Wt&&Wt.message)}}}hoe.set(s,l),s.track.addEventListener("ended",f)}const poe=127,yQ=1e-10,Jde=139/13,foe=new Map;function Xde(s,d,l){const f="".concat(s,"-").concat(d,"-").concat(l);let b=0;return foe.has(f)?b=foe.get(f):(b=Math.log(function(B,Wt){const $O=B-Wt;Wt<$O&&(Wt=$O);let uN=1;for(let lN=B,_N=1;lN>Wt;lN--,_N++)uN=uN*lN/_N;return uN}(d,s))+s*Math.log(.5)+(d-s)*Math.log(1-.5)-Math.log(l)+l*s,foe.set(f,b)),b<yQ&&(b=yQ),b}function sSe(s,d,l){const f=d.length,b=s.length/f;let k=!1;for(let B=0,Wt=0;B<f;B++){let $O=0;for(let uN=Wt+b;Wt<uN;Wt++)s[Wt]>l&&$O++;d[B]!==$O&&(d[B]=$O,k=!0)}return k}window.cache=foe;let BDe=0;class oSe{constructor(d){kH(this,"id",void 0),kH(this,"immediates",[]),kH(this,"lastNonSilence",-1),kH(this,"immediateSpeechActivityScore",yQ),kH(this,"lastLevelChangedTime",Date.now()),kH(this,"levels",[]),kH(this,"longs",[]),kH(this,"longSpeechActivityScore",yQ),kH(this,"mediums",[]),kH(this,"mediumSpeechActivityScore",yQ),kH(this,"minLevel",0),kH(this,"nextMinLevel",0),kH(this,"nextMinLevelWindowLength",0),kH(this,"energyScore",0),this.id=d||"".concat(BDe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const d=this.immediates,l=this.levels,f=this.minLevel+Jde;let b=!1;for(let k=0;k<d.length;++k){let B=l[k];B<f&&(B=0);const Wt=Math.floor(B/Jde);d[k]!==Wt&&(d[k]=Wt,b=!0)}return b}computeLongs(){return sSe(this.mediums,this.longs,4)}computeMediums(){return sSe(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Xde(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(d){this.longSpeechActivityScore=Xde(this.longs[0],10,47),this.longSpeechActivityScore>yQ&&(this.lastNonSilence=d)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Xde(this.mediums[0],5,24)}evaluateSpeechActivityScores(d){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(d)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var d;return"[".concat(hZ(d=[...this.levels]).call(d).join(),"]")}getSpeechActivityScore(d){switch(d){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+d)}}levelChanged(d,l){if(this.lastLevelChangedTime<=l){this.lastLevelChangedTime=l;let f=d;return d<0&&(f=0),d>poe&&(f=poe),this.levels.unshift(f),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(f),f>=this.minLevel+Jde?f:f/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(d){if(d!==0){if(this.minLevel===0||this.minLevel>d)return this.minLevel=d,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=d,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>d&&(this.nextMinLevel=d),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let l=Math.sqrt(this.minLevel*this.nextMinLevel);l<0?l=0:l>poe&&(l=poe),this.minLevel=l,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class GDe{constructor(d){kH(this,"algorithm",void 0),this.algorithm=d}execute(){let d=!this.algorithm;if(!d)try{const l=this.algorithm.runInDecisionMaker(this);l<=0?d=!0:setTimeout(this.execute.bind(this),l)}catch{d=!0}d&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Qde{constructor(d,l,f){kH(this,"isDominant",void 0),kH(this,"energyRanking",void 0),kH(this,"energyScore",void 0),this.isDominant=d,this.energyRanking=l,this.energyScore=f}}class WDe extends W6{constructor(d){super(),kH(this,"dominantId",null),kH(this,"lastDecisionTime",0),kH(this,"lastLevelChangedTime",0),kH(this,"lastLevelIdleTime",0),kH(this,"relativeSpeechActivities",[]),kH(this,"speakers",new Map),kH(this,"enableSilence",!1),kH(this,"timeoutToSilenceInterval",0),kH(this,"decisionMaker",null),kH(this,"loudest",[]),kH(this,"numLoudestToTrack",3),kH(this,"energyExpireTimeMs",250),kH(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=d,this.enableSilence=d>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,l=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=d,l!=null&&(this.energyExpireTimeMs=l),f!=null&&(this.energyAlphaPct=f),this.loudest.length>d&&this.loudest.splice(d)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(d){return this.loudest.some(l=>l.id===d)}levelChanged(d,l){const f=Date.now(),b=this.getOrCreateSpeaker(d);this.lastLevelChangedTime<f&&(this.lastLevelChangedTime=f,this.maybeStartDecisionMaker());const k=b.levelChanged(l,f);return this.updateLoudestList(b,k,f)}runInDecisionMaker(d){return this.decisionMaker!==d||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(d){this.decisionMaker===d&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(d){d.forEach(l=>{this.speakers.has(l.id)||this.speakers.set(l.id,l)})}removeSpeakers(d){d.forEach(l=>{this.speakers.delete(l.id)})}getOrCreateSpeaker(d){let l=this.speakers.get(d);return l||(l=new oSe(d),this.speakers.set(d,l),this.maybeStartDecisionMaker()),l}updateLoudestList(d,l,f){const b=d.id===this.dominantId;if(l<0){let $O=0;for(;$O<this.loudest.length&&this.loudest[$O]!==d;)++$O;return new Qde(b,$O,d.energyScore)}if(d.energyScore=Math.floor((this.energyAlphaPct*l+(100-this.energyAlphaPct)*d.energyScore+50)/100),this.numLoudestToTrack===0)return new Qde(b,0,d.energyScore);const k=f-this.energyExpireTimeMs;let B=0;for(;B<this.loudest.length;){const $O=this.loudest[B];if($O.getLastLevelChangedTime()<k&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(B,1);else if($O.id!==d.id)++B;else if(this.loudest.splice(B,1),this.loudest.length<this.numLoudestToTrack)break}let Wt=0;for(;Wt<this.loudest.length&&!(this.loudest[Wt].energyScore<d.energyScore);)++Wt;return Wt<this.numLoudestToTrack&&(this.loudest.splice(Wt,0,d),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Qde(b,Wt,d.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new GDe(this),this.decisionMaker.execute())}makeDecision(d){let l=null,f=null;const b=this.speakers.size;let k=null;if(b===0)k=null;else if(b===1){var B;const Wt=S8(B=this.speakers).call(B).next().value;this.enableSilence&&Wt&&(k=Wt.id,Wt.evaluateSpeechActivityScores(d),d-Wt.lastNonSilence>this.timeoutToSilenceInterval&&(k=null))}else{let Wt=this.dominantId==null?null:this.speakers.get(this.dominantId);if(Wt==null){const lN=this.speakers.entries().next();lN.value&&(k=lN.value[0],Wt=lN.value[1])}else k=Wt.id;Wt!=null&&Wt.evaluateSpeechActivityScores(d);const $O=this.relativeSpeechActivities;let uN=2;for(const lN of this.speakers.entries()){const[_N,TN]=lN;if(TN===Wt)continue;TN.evaluateSpeechActivityScores(d);for(let iH=0;iH<$O.length;++iH){const lH=Wt==null?yQ:Wt.getSpeechActivityScore(iH);$O[iH]=Math.log(TN.getSpeechActivityScore(iH)/lH)}const vN=$O[0],uH=$O[1],rH=$O[2];vN>3&&uH>2&&rH>0&&uH>uN&&(uN=uH,k=_N)}this.enableSilence&&Wt!=null&&k===Wt.id&&d-Wt.lastNonSilence>this.timeoutToSilenceInterval&&(k=null)}k==null&&!this.enableSilence||k===this.dominantId||(l=this.dominantId,this.dominantId=k,f=this.dominantId),f==null&&!this.enableSilence||f===l||this.emit("ActiveSpeakerChanged",f)}_runInDecisionMaker(){const d=Date.now(),l=300-(d-this.lastLevelIdleTime);let f=0;l<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(d),this.lastLevelIdleTime=d):f=l;let b=300-(d-this.lastDecisionTime);return b<=0&&(this.lastDecisionTime=d,this.makeDecision(d),b=300-(Date.now()-d)),b>0&&f>b&&(f=b),f}timeoutIdleLevels(d){const l=[];for(const b of S8(f=this.speakers).call(f)){var f;const k=d-b.getLastLevelChangedTime();36e5<k&&(this.dominantId==null||b.id!==this.dominantId)?l.push(b.id):300<k&&b.levelTimedOut()}l.forEach(b=>this.speakers.delete(b))}}const H$=new Map;let eJ=null,_oe=null,RQ=[];const HDe=1e3/15,tJ=new Map,Eoe=new Map;class qDe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(d,l){kH(this,"id",void 0),kH(this,"track",void 0),kH(this,"score",0),kH(this,"active",!0),kH(this,"muted",!1),kH(this,"timer",0),kH(this,"actives",0),kH(this,"inactives",0),this.id=d,this.track=l,this.setActive(tJ.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const d=this.active;this.active=this.activeRate>=.8;const{actives:l,inactives:f}=function(){const b=[],k=[];return Array.from(S8(tJ).call(tJ)).forEach(B=>{B.active?b.push(B):k.push(B)}),{actives:b,inactives:k}}();if(l.length>3){let b;l.forEach(k=>{(!b||b.score>k.score)&&(b=k)}),b&&b.setActive(!1)}if(l.length<3&&f.length>0){let b;f.forEach(k=>{(!b||b.score<k.score)&&k.id!==this.id&&(b=k)}),b&&d&&!this.active&&(b.samples>40&&b.activeRate-this.activeRate>.4?b.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(d){this.active=d,this.resetTimer(),this.setMuted(!d)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const d=function(l){let f;return Array.from(S8(tJ).call(tJ)).forEach(b=>{!b.active||b.id===l||b.samples<40||(!f||b.score<f.score)&&(f=b)}),f}(this.id);d&&this.activeRate-d.activeRate>.4&&(d.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const d=function(l){let f;return Array.from(S8(tJ).call(tJ)).forEach(b=>{b.active||b.id===l||b.samples<40||(!f||b.score>f.score)&&(f=b)}),f}(this.id);d&&d.activeRate-this.activeRate>.4&&(d.setActive(!0),this.setActive(!1))}addSample(d){d?this.actives+=1:this.inactives+=1,this.samples>HDe&&this.autoCheckActive()}setMuted(d){this.track&&(this.track.enabled=!d,this.muted=d)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let moe;function aSe(s){const d=tJ.get(s);d&&(tJ.delete(s),d.clearTimer())}const goe=new Map,KDe=new Map;async function Zde(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!u6().supportWebRTCEncodedTransform)return void CN.warning("browser not support audio encoded transform");if(goe.has(s))return;const l={track:s.track};if(w7()){if(!s.createEncodedStreams)return void CN.warning("browser not support createEncodedStreams() API");ude(p6.CHROME,87,116)||(d.enableTopn=!1);let b=null;try{b=s.createEncodedStreams()}catch(B){return void CN.error("create audio-encoded-streams error",B&&B.message)}const k=new TransformStream({transform(B,Wt){l.controller||(l.controller=Wt),s.track&&s.track.id!==l.track.id&&(CN.debug("audio track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f)),d.enableTopn?function($O,uN,lN){var _N;const TN=iSe(new DataView(uN.data));if(!TN)return lN.enqueue(uN);const vN=$O.track.id;KDe.set(vN,$O.track);const uH=(_N=TN.tlv.find(PH=>PH.tag===W$.AUDIO_LEVEL))===null||_N===void 0?void 0:_N.value;let rH=0;typeof uH=="number"&&(rH=127-uH);const iH=Math.round(Math.pow(10,rH/60)-1),{selected:lH,speaker:hH}=function(PH,OH){let wH=H$.get(PH);if(wH||(wH=function(BH){const XH=new oSe;return H$.set(BH,XH),eJ||(eJ=new WDe(_H("TOPN_SILENCE_THRESHOLD")||500),eJ.on("ActiveSpeakerChanged",d5=>{d5!=null&&(_oe=d5)})),eJ.addSpeakers([XH]),XH}(PH)),H$.size<=3)return{selected:!0,speaker:wH};if(!eJ)throw new Error("no active speaker detector");return eJ.levelChanged(wH.id,OH),RQ=eJ.loudest.map(BH=>BH.id),_oe&&!a5(RQ).call(RQ,_oe)&&RQ.length>=3&&RQ.pop(),{selected:a5(RQ).call(RQ,wH.id)||wH.id===_oe,speaker:wH}}($O,iH),bH=function(PH,OH,wH){const BH=tJ.get(PH)||new qDe(PH,OH);return BH.score=wH,tJ.set(PH,BH),function(XH){if(Eoe.set(XH,!0),!moe)return void(moe=Date.now());const d5=Date.now();d5-moe>1e3&&(Eoe.get(XH)?Eoe.set(XH,!1):(aSe(XH),Eoe.delete(XH)),moe=d5)}(PH),BH}(vN,$O.track,hH.energyScore);bH.addSample(lH),bH.active&&(uN.data=TN.frame.buffer,lN.enqueue(uN))}(s,B,Wt):d.enableMetadata?function($O,uN,lN){const _N=iSe(new DataView($O.data));if(!_N)return uN.enqueue($O);const TN=_N.tlv.find(vN=>vN.tag===W$.METADATA);TN&&lN&&TN.value instanceof Uint8Array&&lN(TN.value),$O.data=_N.frame.buffer,uN.enqueue($O)}(B,Wt,d.onMetadata):Wt.enqueue(B)}});b.readable.pipeThrough(k).pipeTo(b.writable)}else if(KK()){if(typeof RTCRtpScriptTransform>"u")return void CN.warning("browser not support RTCRtpScriptTransform");const b=loe(),k=new MessageChannel;await new u5(Wt=>b.onmessage=$O=>{$O.data==="registered"&&Wt(void 0)});const B=new RTCRtpScriptTransform(b,{name:"rx",port:k.port2},[k.port2]);s.transform=B,await new u5(Wt=>b.onmessage=$O=>{$O.data==="started"&&Wt(void 0)}),k.port1.onmessage=Wt=>{var $O;Wt.data.transformed&&s.track&&(($O=s.track)===null||$O===void 0?void 0:$O.id)!==l.track.id&&(CN.debug("audio track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f))},l.worker=b}function f(){s.track.removeEventListener("ended",f),function(b){const k=goe.get(b);if(k){(function($O){const uN=H$.get($O);uN&&(H$.delete($O),eJ&&(eJ.removeSpeakers([uN]),H$.size===0&&(eJ.destroy(),eJ=null)))})(b),aSe(b.track.id),goe.delete(b);try{var B,Wt;(B=k.controller)===null||B===void 0||B.terminate(),(Wt=k.worker)===null||Wt===void 0||Wt.terminate()}catch($O){CN.warning($O&&$O.message)}}}(s)}goe.set(s,l),s.track.addEventListener("ended",f)}function zDe(s,d,l){let f=new Uint8Array(s,d,l),b=[],k=0;for(;b.length<l;)k+3<l&&f[k]===0&&f[k+1]===0&&f[k+2]===3&&(f[k+3]===0||f[k+3]===1||f[k+3]===2||f[k+3]===3)?(b.push(f[k],f[k+1],f[k+3]),k+=4):(b.push(f[k]),k++);return new Uint8Array(b)}const Toe=new Map;async function YDe(s,d){if(!u6().supportWebRTCEncodedTransform)return void CN.warning("browser not support video encoded transform");if(Toe.has(s)||!s.track)return;const l={track:s.track};if(w7()){if(!s.createEncodedStreams)return void CN.warning("browser not support createEncodedStreams() API");let b=null;try{b=s.createEncodedStreams()}catch(Wt){return void CN.error("create video-encoded-streams error",Wt&&Wt.message)}const k=[];d.on("sei-to-send",Wt=>{k.push(Wt)});const B=new TransformStream({transform(Wt,$O){l.controller||(l.controller=$O),s.track&&s.track.id!==l.track.id&&(CN.debug("video track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f));const uN=k.shift();uN&&(Wt.data=function(lN,_N){const TN=function(hH){const bH=hH.length;let PH=[],OH=0;for(;OH<bH;)OH+2<bH&&hH[OH]===0&&hH[OH+1]===0&&(hH[OH+2]===0||hH[OH+2]===1||hH[OH+2]===2||hH[OH+2]===3)?(PH.push(hH[OH],hH[OH+1],3,hH[OH+2]),OH+=3):(PH.push(hH[OH]),OH++);return new Uint8Array(PH)}(_N),vN=TN.length,uH=Math.floor(vN/255),rH=vN%255,iH=new Uint8Array(6+uH+1+vN+lN.byteLength);iH[0]=0,iH[1]=0,iH[2]=0,iH[3]=1,iH[4]=6,iH[5]=101;let lH=0;for(;lH<uH;)iH[6+lH]=255,lH++;return iH[6+lH]=rH,lH++,iH.set(TN,6+lH),iH.set(new Uint8Array(lN),6+lH+vN),iH.buffer}(Wt.data,uN)),$O.enqueue(Wt)}});b.readable.pipeThrough(B).pipeTo(b.writable)}else{if(!KK())return;{if(typeof RTCRtpScriptTransform>"u")return void CN.warning("browser not support RTCRtpScriptTransform");const b=loe(),k=new MessageChannel;await new u5(Wt=>b.onmessage=$O=>{$O.data==="registered"&&Wt(void 0)});const B=new RTCRtpScriptTransform(b,{name:"tx",port:k.port2},[k.port2]);s.transform=B,await new u5(Wt=>b.onmessage=$O=>{$O.data==="started"&&Wt(void 0)}),d.on("sei-to-send",Wt=>{k.port1.postMessage({sei:Wt})}),k.port1.onmessage=Wt=>{var $O;Wt.data.transformed&&s.track&&(($O=s.track)===null||$O===void 0?void 0:$O.id)!==l.track.id&&(CN.debug("video track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f))},l.worker=b}}function f(){if(s.track){if(this.id!==s.track.id)return;s.track.removeEventListener("ended",f)}const b=Toe.get(s);if(b){Toe.delete(s);try{var k,B;(k=b.controller)===null||k===void 0||k.terminate(),(B=b.worker)===null||B===void 0||B.terminate()}catch(Wt){CN.warning(Wt&&Wt.message)}}}Toe.set(s,l),s.track.addEventListener("ended",f)}const vne=new Map;async function $de(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!u6().supportWebRTCEncodedTransform)return void CN.warning("browser not support video encoded transform");if(!s.track)return;if(vne.has(s)){const b=vne.get(s);return void(b&&(b.onSei=d.onSei))}const l={track:s.track,onSei:d.onSei};if(w7()){if(!s.createEncodedStreams)return void CN.warning("browser not support createEncodedStreams() API");let b=null;try{b=s.createEncodedStreams()}catch(B){return void CN.error("create video-encoded-streams error",B&&B.message)}const k=new TransformStream({transform(B,Wt){l.controller||(l.controller=Wt),s.track&&s.track.id!==l.track.id&&(CN.debug("video track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f));const $O=function(uN){const lN=new DataView(uN.data);let _N=0;for(;_N+4<uN.data.byteLength;){if(lN.getUint8(_N+0)===0&&lN.getUint8(_N+1)===0&&lN.getUint8(_N+2)===0&&lN.getUint8(_N+3)===1&&lN.getUint8(_N+4)===6){let TN=_N+6,vN=0,uH=0;for(;(uH=lN.getUint8(TN++))===255;)vN+=255;vN+=uH;const rH=zDe(uN.data,TN,vN);return new Uint8Array(rH)}_N++}return null}(B);$O&&l.onSei&&l.onSei($O),Wt.enqueue(B)}});b.readable.pipeThrough(k).pipeTo(b.writable)}else if(KK()){if(typeof RTCRtpScriptTransform>"u")return void CN.warning("browser not support RTCRtpScriptTransform");const b=loe(),k=new MessageChannel;await new u5(Wt=>b.onmessage=$O=>{$O.data==="registered"&&Wt(void 0)});const B=new RTCRtpScriptTransform(b,{name:"rx",port:k.port2},[k.port2]);s.transform=B,await new u5(Wt=>b.onmessage=$O=>{$O.data==="started"&&Wt(void 0)}),k.port1.onmessage=Wt=>{var $O;Wt.data.transformed&&s.track&&(($O=s.track)===null||$O===void 0?void 0:$O.id)!==l.track.id?(CN.debug("video track changed: ".concat(l.track.id," => ").concat(s.track.id)),l.track.removeEventListener("ended",f),l.track=s.track,l.track.addEventListener("ended",f)):Wt.data.sei&&l.onSei&&l.onSei(Wt.data.sei)},l.worker=b}function f(){if(s.track){if(this.id!==s.track.id)return;s.track.removeEventListener("ended",f)}(function(b){const k=vne.get(b);if(k){vne.delete(b);try{var B,Wt;(B=k.controller)===null||B===void 0||B.terminate(),(Wt=k.worker)===null||Wt===void 0||Wt.terminate()}catch($O){CN.warning($O&&$O.message)}}})(s)}vne.set(s,l),s.track.addEventListener("ended",f)}(function(){const s=c6();GK.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),GK.getStreamFromExtension=s.name===p6.CHROME&&Number(s.version)>34,GK.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const d=new RTCPeerConnection;let l=!1;try{d.addTransceiver("audio"),l=!0}catch{}return d.close(),l}(),GK.supportMinBitrate=s.name===p6.CHROME||s.name===p6.EDGE,GK.supportSetRtpSenderParameters=function(){const d=c6();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!A7()||!(!KK()&&!Yse())||d.name===p6.FIREFOX&&Number(d.version)>=64)}(),s.name===p6.SAFARI&&(Number(s.version)>=14?GK.supportDualStream=!0:GK.supportDualStream=!1),GK.webAudioMediaStreamDest=function(){const d=c6();return!(d.name===p6.SAFARI&&Number(d.version)<12)}(),GK.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",GK.supportWebGL=typeof WebGLRenderingContext<"u",GK.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,A7()||(GK.webAudioWithAEC=!0),GK.supportShareAudio=function(){const d=c6();return(d.os===AK.WIN_10||d.os===AK.WIN_81||d.os===AK.WIN_7||d.os===AK.LINUX||d.os===AK.MAC_OS||d.os===AK.CHROMIUM_OS)&&d.name===p6.CHROME&&Number(d.version)>=74}(),GK.supportDataChannel=!!(I$(76)||function(d){const l=c6();return!(l.name!==p6.FIREFOX||!l.osVersion)&&Number(l.version)>=d}(68)||mme(14)),GK.supportPCSetConfiguration=function(){const d=window.RTCPeerConnection;return!Z6()&&!!d&&d.prototype.setConfiguration instanceof Function}(),GK.supportWebRTCEncodedTransform=function(){const d=c6();return d.name==="Chrome"&&Number(d.version)>=87||d.name==="Safari"&&Number(d.version)>=15}(),GK.supportWebRTCInsertableStream=function(){const d=c6();return(d.name===p6.CHROME||d.name===p6.EDGE)&&Number(d.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),GK.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,GK.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Qse(()=>{GK.supportDualStreamEncoding=function(){const d=c6();return!!_H("DISABLE_WEBAUDIO")||d.name==="Safari"&&Number(d.version)>=14||!!(d.name==="Chrome"&&/Windows/i.test(d.os||"")&&Number(d.version)>=100&&_H("CHROME_DUAL_STREAM_USE_ENCODING"))}(),CN.debug("browser ua: ",navigator.userAgent),CN.info("browser info: ",s),CN.info("browser compatibility: ",GK)})})();const JDe=["CHINA","GLOBAL"],cSe=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],bQ=[],q$=[];function vQ(s,d){return!!d&&bQ.some(l=>l.uid===s&&l.channelName===d)}function ele(){return q$.length>0}var XDe=L_e.forEach,uSe=I9("forEach")?[].forEach:function(s){return XDe(this,s,arguments.length>1?arguments[1]:void 0)};f6({target:"Array",proto:!0,forced:[].forEach!==uSe},{forEach:uSe});var QDe=l4("Array","forEach"),ZDe=eY,$De=kK,eke=dN,tke=QDe,tle=Array.prototype,nke={DOMTokenList:!0,NodeList:!0},rke=function(s){var d=s.forEach;return s===tle||eke(tle,s)&&d===tle.forEach||$De(nke,ZDe(s))?tke:d},ike=h(rke),ske=Q6,dSe=L4;f6({target:"Object",stat:!0,forced:p(function(){dSe(1)})},{keys:function(s){return dSe(ske(s))}});var lSe=h(M6.Object.keys),oke=h(cZ),ake=h(P9),cke=f6,hSe=iX,uke=R4,dke=Q5,pSe=Uee,lke=mJ,hke=y5,pke=Wce,fke=K6,_ke=cY,Eke=v_e("slice"),mke=fke("species"),nle=Array,gke=Math.max;cke({target:"Array",proto:!0,forced:!Eke},{slice:function(s,d){var l,f,b,k=hke(this),B=lke(k),Wt=pSe(s,B),$O=pSe(d===void 0?B:d,B);if(hSe(k)&&(l=k.constructor,(uke(l)&&(l===nle||hSe(l.prototype))||dke(l)&&(l=l[mke])===null)&&(l=void 0),l===nle||l===void 0))return _ke(k,Wt,$O);for(f=new(l===void 0?nle:l)(gke($O-Wt,0)),b=0;Wt<$O;Wt++,b++)Wt in k&&pke(f,b,k[Wt]);return f.length=b,f}});var Tke=l4("Array","slice"),Ske=dN,yke=Tke,rle=Array.prototype,Rke=function(s){var d=s.slice;return s===rle||Ske(rle,s)&&d===rle.slice?yke:d},bke=h(Rke);function m5(s,d,l,f,b){var k,B,Wt,$O={};return ike(k=lSe(f)).call(k,function(uN){$O[uN]=f[uN]}),$O.enumerable=!!$O.enumerable,$O.configurable=!!$O.configurable,("value"in $O||$O.initializer)&&($O.writable=!0),$O=oke(B=ake(Wt=bke(l).call(l)).call(Wt)).call(B,function(uN,lN){return lN(s,d,uN)||uN},$O),b&&$O.initializer!==void 0&&($O.value=$O.initializer?$O.initializer.call(b):void 0,$O.initializer=void 0),$O.initializer===void 0&&(S_e(s,d,$O),$O=null),$O}let Soe=function(s){return s[s.ACCESS_POINT=101]="ACCESS_POINT",s[s.UNILBS=201]="UNILBS",s[s.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",s}({}),ile=function(s){return s[s.IIIEGAL_APPID=1]="IIIEGAL_APPID",s[s.IIIEGAL_UID=2]="IIIEGAL_UID",s[s.INTERNAL_ERROR=3]="INTERNAL_ERROR",s}({}),TY=function(s){return s[s.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",s[s.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",s[s.INTERNAL_ERROR=8]="INTERNAL_ERROR",s[s.NO_AUTHORIZED=9]="NO_AUTHORIZED",s[s.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",s[s.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",s[s.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",s[s.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",s[s.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",s[s.USER_OVERLOAD=16]="USER_OVERLOAD",s[s.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",s[s.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",s}({}),A4=function(s){return s[s.NO_FLAG_SET=100]="NO_FLAG_SET",s[s.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",s[s.INVALID_FALG_SET=102]="INVALID_FALG_SET",s[s.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",s[s.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",s[s.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",s[s.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",s[s.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",s[s.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",s[s.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",s[s.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",s[s.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",s[s.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",s[s.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",s[s.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",s[s.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",s[s.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",s[s.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",s[s.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",s}({}),I5=function(s){return s[s.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",s[s.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",s[s.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",s[s.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",s[s.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",s[s.K_TICKET_INVALID=7]="K_TICKET_INVALID",s[s.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",s[s.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",s[s.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",s[s.K_UID_BANNED=14]="K_UID_BANNED",s[s.K_IP_BANNED=15]="K_IP_BANNED",s[s.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",s[s.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",s[s.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",s[s.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",s[s.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",s[s.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",s[s.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",s[s.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",s[s.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",s[s.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",s[s.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",s[s.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",s[s.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",s[s.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",s[s.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",s[s.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",s[s.ERR_INVALID_UID=117]="ERR_INVALID_UID",s[s.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",s[s.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",s[s.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",s[s.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",s[s.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",s[s.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",s[s.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",s[s.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",s[s.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",s[s.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",s[s.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",s[s.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",s[s.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",s[s.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",s[s.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",s[s.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",s[s.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",s[s.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",s[s.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",s[s.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",s[s.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",s[s.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",s[s.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",s[s.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",s[s.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",s[s.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",s[s.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",s[s.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",s[s.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",s[s.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",s[s.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",s[s.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",s[s.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",s[s.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",s[s.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",s[s.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",s[s.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",s}({}),D6=function(s){return s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.CLOSED="closed",s}({}),P5=function(s){return s.WS_CONNECTED="ws_connected",s.WS_RECONNECTING="ws_reconnecting",s.WS_CLOSED="ws_closed",s.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",s.ON_BINARY_DATA="on_binary_data",s.REQUEST_RECOVER="request_recover",s.REQUEST_JOIN_INFO="request_join_info",s.REQUEST_REJOIN_INFO="req_rejoin_info",s.IS_P2P_DISCONNECTED="is_p2p_dis",s.DISCONNECT_P2P="dis_p2p",s.ABORT_P2P_EXECUTION="abort_p2p_execution",s.NEED_RENEW_SESSION="need-sid",s.REPORT_JOIN_GATEWAY="report_join_gateway",s.REQUEST_TIMEOUT="request_timeout",s.REQUEST_SUCCESS="request_success",s.JOIN_RESPONSE="join_response",s.PRE_CONNECT_PC="pre_connect_pc",s.P2P_CONNECTION="p2p_connection",s.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",s.P2P_SUBSCRIBE="p2p_subscribe",s.P2P_UNSUBSCRIBE="p2p_unsubscribe",s.P2P_EXCHANGE_SDP="p2p_exchange_sdp",s.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",s.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",s.RECOVER_NOTIFICATION="recover_notification",s}({}),N5=function(s){return s.PING="ping",s.PING_BACK="ping_back",s.JOIN="join_v3",s.REJOIN="rejoin_v3",s.LEAVE="leave",s.SET_CLIENT_ROLE="set_client_role",s.PUBLISH="publish",s.PUBLISH_DATASTREAM="publish_datastream",s.UNPUBLISH="unpublish",s.UNPUBLISH_DATASTREAM="unpublish_datastream",s.SUBSCRIBE="subscribe",s.PRE_SUBSCRIBE="pre_subscribe",s.SUBSCRIBE_DATASTREAM="subscribe_datastream",s.SUBSCRIBE_STREAMS="subscribe_streams",s.UNSUBSCRIBE="unsubscribe",s.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",s.UNSUBSCRIBE_STREAMS="unsubscribe_streams",s.SUBSCRIBE_CHANGE="subscribe_change",s.TRAFFIC_STATS="traffic_stats",s.RENEW_TOKEN="renew_token",s.SWITCH_VIDEO_STREAM="switch_video_stream",s.DEFAULT_VIDEO_STREAM="default_video_stream",s.SET_FALLBACK_OPTION="set_fallback_option",s.GATEWAY_INFO="gateway_info",s.CONTROL="control",s.SEND_METADATA="send_metadata",s.DATA_STREAM="data_stream",s.PICK_SVC_LAYER="pick_svc_layer",s.RESTART_ICE="restart_ice",s.CONNECT_PC="connect_pc",s.SET_VIDEO_PROFILE="set_video_profile",s.SET_PARAMETER="set_parameter",s.SET_RTM2_FLAG="set_rtm2_flag",s}({}),Cne=function(s){return s.WRTC_STATS="wrtc_stats",s.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",s.DENOISER_STATS="denoiser_stats",s.EXTENSION_USAGE_STATS="extension_usage_stats",s}({}),J5=function(s){return s.ON_USER_ONLINE="on_user_online",s.ON_USER_OFFLINE="on_user_offline",s.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",s.ON_PUBLISH_STREAM="on_publish_stream",s.ON_UPLINK_STATS="on_uplink_stats",s.ON_P2P_LOST="on_p2p_lost",s.ON_REMOVE_STREAM="on_remove_stream",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",s.ON_USER_BANNED="on_user_banned",s.ON_USER_LICENSE_BANNED="on_user_license_banned",s.ON_NOTIFICATION="on_notification",s.ON_CRYPT_ERROR="on_crypt_error",s.MUTE_AUDIO="mute_audio",s.MUTE_VIDEO="mute_video",s.UNMUTE_AUDIO="unmute_audio",s.UNMUTE_VIDEO="unmute_video",s.ON_P2P_OK="on_p2p_ok",s.RECEIVE_METADATA="receive_metadata",s.ON_DATA_STREAM="on_data_stream",s.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",s.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",s.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",s.ENABLE_LOCAL_VIDEO="enable_local_video",s.DISABLE_LOCAL_VIDEO="disable_local_video",s.ENABLE_LOCAL_AUDIO="enable_local_audio",s.DISABLE_LOCAL_AUDIO="disable_local_audio",s.ON_PUBLISHED_USER_LIST="on_published_user_list",s}({}),O4=function(s){return s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY",s}({}),U5=function(s){return s.CONNECTED="websocket:connected",s.RECONNECTING="websocket:reconnecting",s.WILL_RECONNECT="websocket:will_reconnect",s.CLOSED="websocket:closed",s.FAILED="websocket:failed",s.ON_MESSAGE="websocket:on_message",s.REQUEST_NEW_URLS="websocket:request_new_urls",s.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",s}({});function yoe(s){if(typeof s!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(s))throw CN.error("Invalid Channel Name ".concat(s)),new LH(dH.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Roe(s){if(d=s,!(typeof d=="number"&&Math.floor(d)===d&&0<=d&&d<=4294967295||Cme(s,1,255)))throw new LH(dH.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var d;typeof s=="string"&&CN.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let D7=function(s){return s.TRANSCODE="mix_streaming",s.RAW="raw_streaming",s}({});const vke={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},sle={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ole(s,d){jK(s.url,"".concat(d,".url"),1,1e3,!1),z6(s.x)||b6(s.x,"".concat(d,".x"),0,1e4),z6(s.y)||b6(s.y,"".concat(d,".y"),0,1e4),z6(s.width)||b6(s.width,"".concat(d,".width"),0,1e4),z6(s.height)||b6(s.height,"".concat(d,".height"),0,1e4),z6(s.zOrder)||b6(s.zOrder,"".concat(d,".zOrder"),0,255),z6(s.alpha)||b6(s.alpha,"".concat(d,".alpha"),0,1,!1)}const Cke={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let xX=function(s){return s.WARNING="@live_uap-warning",s.ERROR="@line_uap-error",s.PUBLISH_STREAM_STATUS="@live_uap-publish-status",s.WORKER_STATUS="@live_uap-worker-status",s.REQUEST_NEW_ADDRESS="@live_uap-request-address",s}({}),ale=function(s){return s.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",s}({}),yK=function(s){return s[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",s}({});function fSe(s){if(!s.channelName)throw new LH(dH.INVALID_PARAMS,"invalid channelName in info");if(typeof s.uid!="number")throw new LH(dH.INVALID_PARAMS,"invalid uid in info, uid must be a number");return s.token&&jK(s.token,"info.token",1,2047),Roe(s.uid),yoe(s.channelName),!0}let N4=function(s){return s[s.SetSdkProfile=0]="SetSdkProfile",s[s.SetSourceChannel=1]="SetSourceChannel",s[s.SetSourceUserId=2]="SetSourceUserId",s[s.SetDestChannel=3]="SetDestChannel",s[s.StartPacketTransfer=4]="StartPacketTransfer",s[s.StopPacketTransfer=5]="StopPacketTransfer",s[s.UpdateDestChannel=6]="UpdateDestChannel",s[s.Reconnect=7]="Reconnect",s[s.SetVideoProfile=8]="SetVideoProfile",s}({}),k7=function(s){return s.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",s.NETWORK_CONNECTED="NETWORK_CONNECTED",s.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",s.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",s.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",s.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",s.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",s.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",s.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",s.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",s}({}),e8=function(s){return s.RELAY_STATE_IDLE="RELAY_STATE_IDLE",s.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",s.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",s.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",s}({}),K$=function(s){return s.RELAY_OK="RELAY_OK",s.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",s.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",s.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",s}({}),m6=function(s){return s.High="high",s.Low="low",s.Audio="audio",s.Screen="screen",s.ScreenLow="screen_low",s}({}),LK=function(s){return s.DISCONNECT="disconnect",s.CONNECTION_STATE_CHANGE="connection-state-change",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGE="stream-type-change",s.IS_P2P_DISCONNECTED="is-p2p-dis",s.DISCONNECT_P2P="dis-p2p",s.REQUEST_NEW_GATEWAY_LIST="req-gate-url",s.NEED_RENEW_SESSION="need-sid",s.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",s.JOIN_RESPONSE="join-response",s.RESET_CONNECTION_EVENTS="reset-connection-events",s.PRE_CONNECT_PC="pre-connect_pc",s.UPDATE_GATEWAY_CONFIG="update-gateway-config",s}({}),boe=function(s){return s.P2P_DISCONNECTED="P2P_DISCONNECTED",s.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",s.TIMEOUT="TIMEOUT",s.UNKNOWN_REASON="UNKNOWN_REASON",s}({}),NK=function(s){return s[s.Nothing=0]="Nothing",s[s.Audio=1]="Audio",s[s.LwoVideo=2]="LwoVideo",s[s.Video=4]="Video",s[s.Data=8]="Data",s[s.DataStream0=256]="DataStream0",s[s.DataStream1=512]="DataStream1",s[s.DataStream2=1024]="DataStream2",s[s.DataStream3=2048]="DataStream3",s[s.DataStream4=4096]="DataStream4",s[s.DataStream5=8192]="DataStream5",s[s.DataStream6=16384]="DataStream6",s[s.DataStream7=32768]="DataStream7",s}({}),l6=function(s){return s.CHINA="CHINA",s.ASIA="ASIA",s.NORTH_AMERICA="NORTH_AMERICA",s.EUROPE="EUROPE",s.JAPAN="JAPAN",s.INDIA="INDIA",s.KOREA="KOREA",s.HKMC="HKMC",s.US="US",s.OCEANIA="OCEANIA",s.SOUTH_AMERICA="SOUTH_AMERICA",s.AFRICA="AFRICA",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="EXTENSIONS",s}({});const _Se=[l6.AFRICA,l6.ASIA,l6.CHINA,l6.EUROPE,l6.GLOBAL,l6.INDIA,l6.JAPAN,l6.NORTH_AMERICA,l6.OCEANIA,l6.OVERSEA,l6.SOUTH_AMERICA];let n4=function(s){return s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.KOREA="KR",s.HKMC="HK",s.US="US",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="GLOBAL",s}({});const voe={CHINA:{},ASIA:{CODE:n4.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:n4.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:n4.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:n4.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:n4.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:n4.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:n4.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:n4.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:n4.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:n4.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:n4.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:n4.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:n4.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Ode&&(voe.CHINA={CODE:n4.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Ine=function(s){return s.UPDATE_BITRATE_LIMIT="update_bitrate_limit",s.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",s}({});function ESe(s){return!!s&&!(!s.uplink||!s.id)&&s.uplink.max_bitrate!==void 0&&s.uplink.min_bitrate!==void 0}class mSe extends W6{constructor(d,l){super(),cH(this,"onICEConnectionStateChange",void 0),cH(this,"onConnectionStateChange",void 0),cH(this,"onDTLSTransportStateChange",void 0),cH(this,"onDTLSTransportError",void 0),cH(this,"onICETransportStateChange",void 0),cH(this,"onFirstAudioReceived",void 0),cH(this,"onFirstVideoReceived",void 0),cH(this,"onFirstAudioDecoded",void 0),cH(this,"onFirstVideoDecoded",void 0),cH(this,"onFirstVideoDecodedTimeout",void 0),cH(this,"onSelectedLocalCandidateChanged",void 0),cH(this,"onSelectedRemoteCandidateChanged",void 0),cH(this,"onICECandidateError",void 0),cH(this,"getLocalVideoStats",void 0)}}class gSe extends mSe{constructor(d,l){super(d,l),cH(this,"establishPromise",void 0)}}let _5=function(s){return s.VIDEO="video",s.AUDIO="audio",s}({}),d4=function(s){return s.UDP_RELAY="udp_relay",s.UDP_TCP_RELAY="udp_tcp_relay",s.TCP_RELAY="tcp_relay",s.RELAY="relay",s}({}),L7=function(s){return s[s.FIRST_CONNECTION=0]="FIRST_CONNECTION",s[s.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",s[s.RELAY_RESTART=2]="RELAY_RESTART",s[s.TCP_RESTART=3]="TCP_RESTART",s[s.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",s[s.OLD_RESTART=11]="OLD_RESTART",s[s.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",s}({});const TSe=["disconnected","failed"];let JH=function(s){return s.LocalVideoTrack="videoTrack",s.LocalAudioTrack="audioTrack",s.LocalVideoLowTrack="videoLowTrack",s}({}),E6=function(s){return s.New="new",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnected="disconnected",s}({}),v5=function(s){return s.AudioMetadata="audioMetadata",s.StateChange="stateChange",s.IceConnectionStateChange="iceConnectionStateChange",s.RequestMuteLocal="requestMuteLocal",s.RequestUnmuteLocal="requestUnmuteLocal",s.RequestRePublish="requestRePublish",s.RequestRePublishDataChannel="requestRePublishDataChannel",s.RequestReSubscribe="requestReSubscribe",s.RequestUploadStats="requestUploadStats",s.RequestUpload="requestUpload",s.MediaReconnectStart="MediaReconnectStart",s.MediaReconnectEnd="MediaReconnectEnd",s.NeedSignalRTT="NeedSignalRTT",s.RequestRestartICE="RequestRestartIce",s.PeerConnectionStateChange="PeerConnectionStateChange",s.RequestReconnect="RequestReconnect",s.RequestReconnectPC="RequestReconnectPC",s.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",s.P2PLost="P2PLost",s.UpdateVideoEncoder="UpdateVideoEncoder",s.ConnectionTypeChange="ConnectionTypeChange",s.RequestLowStreamParameter="RequestLowStreamParameter",s.QueryClientConnectionState="QueryClientConnectionState",s.LocalCandidate="LocalCandidate",s.RequestP2PMuteLocal="requestP2PMuteLocal",s.RequestP2PUnPublish="RequestP2PUnPublish",s.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",s.RequestP2PMuteRemote="RequestP2PMuteRemote",s.RequestP2PRestartICE="RequestP2PRestartICE",s}({}),SY=function(s){return s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED",s}({}),yY=function(s){return s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED",s}({}),MK=function(s){return s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url",s}({}),SSe=function(s){return s.CONNECTED="transmitter:connected",s.RECONNECTING="transmitter:reconnecting",s.WILL_RECONNECT="transmitter:will_reconnect",s.CLOSED="transmitter:closed",s.FAILED="transmitter:failed",s.ON_MESSAGE="transmitter:on_message",s.REQUEST_NEW_URLS="transmitter:request_new_urls",s.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",s.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",s.FAILBACK="transmitter:failback",s.PRE_CONNECT_PC="transmitter:pre_connect_pc",s}({}),GJ=function(s){return s.CAMERA_CHANGED="camera-changed",s.MICROPHONE_CHANGED="microphone-changed",s.PLAYBACK_DEVICE_CHANGED="playback-device-changed",s.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",s.AUTOPLAY_FAILED="autoplay-failed",s.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",s.SECURITY_POLICY_VIOLATION="security-policy-violation",s}({}),Y8=function(s){return s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED",s}({}),nJ=function(s){return s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url",s}({}),z$=function(s){return s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED",s}({}),oK=function(s){return s.CALL="call",s.CANDIDATE="candidate",s.PUBLISH="publish",s.UNPUBLISH="unpublish",s.CONTROL="control",s.RESTART_ICE="restart_ice",s.ACK="ack",s.RESPONSE="response",s.JOIN="join",s.CHECK="check",s}({}),Y$=function(s){return s.ABORT="abort",s}({}),VX=function(s){return s.MUTE_LOCAL_AUDIO="mute_local_audio",s.MUTE_LOCAL_VIDEO="mute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video",s}({}),Ike=function(s){return s.P2P_TOKEN_TIMEOUT="p2p_token_timeout",s.P2P_TOKEN_CHANGED="p2p_token_changed",s}({});const wke={[Soe.ACCESS_POINT]:{[A4.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[A4.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[A4.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[A4.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[A4.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[A4.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[A4.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Soe.UNILBS]:{[TY.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[TY.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[TY.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[TY.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[TY.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[TY.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[TY.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[TY.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[TY.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[TY.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[TY.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[TY.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Soe.STRING_UID_ALLOCATOR]:{[ile.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ile.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ile.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function J$(s){const d=wke[Math.floor(s/1e4)];if(!d)return{desc:"unknown error",retry:!1};const l=d[s%1e4];if(!l){if(Math.floor(s/1e4)===Soe.ACCESS_POINT){const f=s%1e4;if(f.toString()[0]==="1")return{desc:s.toString(),retry:!1};if(f.toString()[0]==="2")return{desc:s.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return l}const Ake={[I5.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[I5.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[I5.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[I5.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[I5.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[I5.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[I5.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[I5.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[I5.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[I5.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[I5.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[I5.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[I5.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[I5.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[I5.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[I5.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[I5.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[I5.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[I5.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[I5.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[I5.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[I5.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[I5.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[I5.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[I5.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[I5.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[I5.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[I5.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[I5.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[I5.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[I5.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[I5.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[I5.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[I5.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[I5.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[I5.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[I5.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[I5.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[I5.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[I5.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[I5.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[I5.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[I5.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[I5.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[I5.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[I5.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[I5.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[I5.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[I5.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[I5.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[I5.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[I5.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[I5.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[I5.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[I5.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[I5.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[I5.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[I5.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[I5.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[I5.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[I5.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[I5.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[I5.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[I5.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function wne(s){return Ake[s]||{desc:"UNKNOWN_ERROR_".concat(s),action:"failed"}}function ySe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function cle(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?ySe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):ySe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}function RSe(s,d){if(typeof s=="string")return s;const{proxy:l,host:f,port:b}=s;if(d){const k=_H("JOIN_GATEWAY_FALLBACK_PORT")||443;return k===443?"wss://".concat(f,"/ws/?p=").concat(Number(b)+150):"wss://".concat(f,":").concat(k,"/ws/?p=").concat(Number(b)+150)}return l?"wss://".concat(l,"/ws/?h=").concat(f,"&p=").concat(b):"wss://".concat(f,":").concat(b)}const Oke=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Nke=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Pke=/wss:\/\/(.+):([0-9]+)\/?/,Dke=/wss:\/\/(.[^\/]+)\/?/;let kke=0;class Lke{constructor(d,l){cH(this,"id",0),cH(this,"store",void 0),cH(this,"recordIndex",void 0),cH(this,"websockets",[]),cH(this,"try443PortDuration",2e3),cH(this,"forceCloseWSDuration",5e3),cH(this,"try443PortTimeout",null),cH(this,"forceCloseTimeout",null),cH(this,"isTry443PortFailed",!1),cH(this,"isNormalPortFailed",!1),cH(this,"useDoubleDomain",!1),cH(this,"useProxy",!1),cH(this,"startTime",Date.now()),this.id=++kke,this.try443PortDuration=_H("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=d||5e3,this.store=l}closeAllWebsockets(){this.websockets.forEach(d=>{d.onopen=null,d.onclose=null,d.onmessage=null,d.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var d;const l=Date.now()-this.startTime;for(var f=arguments.length,b=new Array(f),k=0;k<f;k++)b[k]=arguments[k];CN.debug("[choose-best-ws ".concat((d=this.store)===null||d===void 0?void 0:d.clientId," ").concat(this.id,"] ").concat(l,"ms:"),...b)}createWebSocket(d,l,f){this.logger("createWebSocket:",d,{isTry443Port:l,hasTimeoutDetection:f});const b=_H("GATEWAY_DOMAINS"),k=Date.now(),B=[],Wt=b.find(TN=>{var vN;return a5(vN=d.host).call(vN,TN)});Wt||(this.useDoubleDomain=!1);const $O=[];if(this.useDoubleDomain)b.forEach(TN=>{$O.push(RSe(cle(cle({},d),{},{host:d.host.replace(Wt,TN)}),l))});else{const TN=cle({},d);if(l&&Wt){const vN=b.find(uH=>uH!==Wt);vN&&(TN.host=TN.host.replace(Wt,vN))}$O.push(RSe(TN,l))}try{$O.forEach(TN=>{const vN=new WebSocket(TN);vN.binaryType="arraybuffer",B.push(vN),this.logger("ws is connecting:",vN.url)})}catch(TN){if(this.logger("ws create failed"),B.forEach(vN=>vN.close()),B.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(d,l,f);if(!l&&Number(d.port)!==443)return this.createWebSocket(d,!0,f);throw new LH(dH.WS_ERR,"init websocket failed! Error: ".concat(TN.toString()))}const uN=pne();this.store&&this.store.recordJoinChannelService({urls:B.map(TN=>TN.url),service:"gateway"},this.recordIndex),B.forEach(TN=>{TN.onopen=()=>{this.logger("onopen: ws ".concat(TN.url," open cost ").concat(Date.now()-k,"ms")),this.websockets.forEach(vN=>{vN!==TN&&(vN.onopen=null,vN.onclose=null,vN.onmessage=null,vN.close(),this.logger("close backup websocket: ".concat(vN.url)))}),this.websockets.length=0,uN.resolve(TN)},TN.onclose=vN=>{this.logger("onclose: ws ".concat(TN.url," closed cost ").concat(Date.now()-k,"ms state: ").concat(TN.readyState));const uH=B.every(rH=>rH.readyState===WebSocket.CLOSED||rH.readyState===WebSocket.CLOSING);this.logger("".concat(l?"443":"47xx"," websocket closed, all failed: ").concat(uH)),uH&&(l||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(vN.reason)),uN.reject({code:vN.code,reason:boe.A_ROUND_WS_FAILED})):!l&&uH&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_N()),l?this.isTry443PortFailed=uH:this.isNormalPortFailed=uH},TN.onmessage=vN=>this.logger("".concat(TN.url," onmessage: ").concat(vN.data))}),this.websockets.push(...B);const lN=()=>{this.websockets.forEach(TN=>TN.readyState!==WebSocket.OPEN&&TN.close())},_N=()=>{if(uN.isResolved)return lN();c6().os===AK.MAC_OS&&Z6()&&lN(),this.createWebSocket(d,!0,!0).then(TN=>{uN.resolve(TN)}).catch(TN=>{this.isNormalPortFailed&&uN.reject(TN),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",uN.isResolved),this.forceCloseTimeout=null,lN()},this.forceCloseWSDuration)};return f||(()=>{if(l||this.useProxy)return this.logger("add 5s timeout at ".concat(l?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,lN()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",uN.isResolved),this.try443PortTimeout=null,_N()},this.try443PortDuration)})(),uN.promise}chooseBestWebsocket(d,l,f,b){return this.useDoubleDomain=!!l,typeof d=="string"&&(d=function(k){let B,Wt,$O;return[,B,Wt,$O]=k.match(Oke)||[],B||([,Wt,$O]=k.match(Nke)||[]),Wt&&$O||([,Wt,$O]=k.match(Pke)||[]),Wt&&$O||([,Wt]=k.match(Dke)||[]),Wt||CN.warning("un-destructible url: ",k),{proxy:B,host:Wt,port:$O||"443"}}(d)),this.recordIndex=b,this.useProxy=!!d.proxy,f&&this.useProxy&&(CN.warn("cannot use 443 only when use proxy"),f=!1),this.createWebSocket(d,!!f,!1).finally(()=>this.clearTimeout())}}function bSe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}class vSe extends W6{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(d){var l;a5(l=["tryNext","recover"]).call(l,d)&&this.resetReconnectCount(d),this._reconnectMode=d}get state(){return this._state}set state(d){d!==this._state&&(this._state=d,this._state==="reconnecting"?this.emit(U5.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(U5.CONNECTED):this._state==="closed"?this.emit(U5.CLOSED):this._state==="failed"&&this.emit(U5.FAILED))}resetReconnectCount(d){CN.debug("websocket reset reconnect count, reason: "+d),this.reconnectCount=0}constructor(d,l){let f=arguments.length>2&&arguments[2]!==void 0&&arguments[2],b=arguments.length>3&&arguments[3]!==void 0&&arguments[3],k=arguments.length>4&&arguments[4]!==void 0&&arguments[4],B=arguments.length>5?arguments[5]:void 0;super(),cH(this,"connectionID",0),cH(this,"currentURLIndex",0),cH(this,"urls",[]),cH(this,"_reconnectMode","tryNext"),cH(this,"reconnectReason",void 0),cH(this,"_initMutex",void 0),cH(this,"name",void 0),cH(this,"_state","closed"),cH(this,"reconnectInterrupter",void 0),cH(this,"websocket",void 0),cH(this,"retryConfig",void 0),cH(this,"reconnectCount",0),cH(this,"forceCloseTimeout",5e3),cH(this,"onlineReconnectListener",void 0),cH(this,"useCompress",void 0),cH(this,"tryDoubleDomain",!1),cH(this,"use443PortOnly",!1),cH(this,"wsInflateLength",0),cH(this,"wsDeflateLength",0),cH(this,"closeEstablishingWs",()=>{}),cH(this,"store",void 0),cH(this,"joinGatewayRecordIndex",void 0),this.store=B,this.name=d,this.retryConfig=function(_N){for(var TN=1;TN<arguments.length;TN++){var vN=arguments[TN]!=null?arguments[TN]:{};TN%2?bSe(Object(vN),!0).forEach(function(uH){cH(_N,uH,vN[uH])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_N,Object.getOwnPropertyDescriptors(vN)):bSe(Object(vN)).forEach(function(uH){Object.defineProperty(_N,uH,Object.getOwnPropertyDescriptor(vN,uH))})}return _N}({},l),this.useCompress=f,this.tryDoubleDomain=b,this.use443PortOnly=k,this._initMutex=new t4("websocket",B?B.clientId:void 0);const{timeout:Wt,timeoutFactor:$O}=l,uN=Math.max(300,Math.floor(3*Wt/5)),lN=Math.max(1.2,Math.floor(8*$O)/10);l8.ONLINE&&(this.retryConfig.timeout=uN,this.retryConfig.timeoutFactor=lN),uK.on(A$.NETWORK_STATE_CHANGE,(_N,TN)=>{_N!==TN&&(this.resetReconnectCount("network state change: ".concat(TN," -> ").concat(_N)),_N===l8.ONLINE?(this.retryConfig.timeout=uN,this.retryConfig.timeoutFactor=lN):(this.retryConfig.timeout=Wt,this.retryConfig.timeoutFactor=$O))})}getConnection(){return this.websocket||void 0}async init(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const f=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=l,this.urls=d,this.state="connecting";try{const b=pne(),k=this.urls[this.currentURLIndex];_H("ENABLE_PREALLOC_PC")&&this.emit(SSe.PRE_CONNECT_PC),this.createWebSocketConnection(k).then(b.resolve).catch(b.reject),this.once(U5.CLOSED,()=>{b.reject(new jH(dH.WS_DISCONNECT))}),this.once(U5.CONNECTED,b.resolve),await b.promise}catch{}finally{f()}}close(d,l){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const f=this.websocket;l?setTimeout(()=>f.close(),500):f.close(),this.websocket=void 0}this.state=d?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(d,l){if(!this.websocket)return void CN.warning("[".concat(this.name,"] can not reconnect, no websocket"));d!==void 0&&(this.reconnectMode=d),CN.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(l)]},this.joinGatewayRecordIndex);const f=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),f&&f.bind(this.websocket)({code:9999,reason:l})}sendMessage(d){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new jH(dH.WS_ABORT,"websocket is not ready");try{l||(d=JSON.stringify(d)),this.websocket.send(d)}catch(f){throw new jH(dH.WS_ERR,"send websocket message error"+f.toString())}}setWsInflateData(d){this.wsDeflateLength=this.wsDeflateLength+d.originLength,this.wsInflateLength=this.wsInflateLength+d.compressedLength}getWsInflateData(){const d=this.wsInflateLength,l=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:d,wsDeflateLength:l}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(d){var l;const f=pne();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const b=lN=>{var _N;(_N=this.store)===null||_N===void 0||_N.signalChannelOpen(),CN.debug("[".concat(this.name,"] websocket opened:"),lN),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),f.resolve()},k=async lN=>{var _N;if(CN.debug("[".concat(this.name,"] websocket close ").concat((_N=this.websocket)===null||_N===void 0?void 0:_N.url,", code: ").concat(lN.code,", reason: ").concat(lN.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)f.reject(new jH(dH.WS_DISCONNECT,"websocket close: ".concat(lN.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=lN.reason,this.state="reconnecting");const TN=R8(this,U5.WILL_RECONNECT,this.reconnectMode,lN.reason)||this.reconnectMode,vN=await this.reconnectWithAction(TN);if(this.state==="closed")return void CN.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!vN)return f.reject(new jH(dH.WS_DISCONNECT,"websocket reconnect failed: ".concat(lN.code))),this.close(!0);f.resolve()}},B=lN=>{this.emit(U5.ON_MESSAGE,lN)},Wt=lN=>{CN.warn("[".concat(this.connectionID,"] ws open error ").concat(lN))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),_H("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(d=_H("GATEWAY_WSS_ADDRESS")),CN.debug("[".concat(this.name,"] start connect, url:"),d);const $O=(l=this.store)===null||l===void 0?void 0:l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var uN;const lN=await this.chooseBestWebsocketConnection(d);this.websocket=lN,b&&b(this.websocket.url),this.websocket.onclose=k,this.websocket.onmessage=B,this.websocket.onerror=Wt,(uN=this.store)===null||uN===void 0||uN.recordJoinChannelService({endTs:Date.now(),status:"success"},$O),this.joinGatewayRecordIndex=$O}catch(lN){const _N=this.state==="closed",TN=lN instanceof jH,vN=TN&&lN.code===dH.WS_ABORT,uH=TN&&lN.code===dH.WS_ERR,rH=TN?lN.message:lN&&(lN.reason||lN.toString());CN.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(rH)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:vN?"aborted":"error",errors:[lN]},$O),_N||uH?(f.reject(_N?new jH(dH.WS_DISCONNECT,"websocket is closed: ".concat(rH)):new jH(dH.WS_ERR,"init websocket failed: ".concat(rH))),uH&&CN.error("[".concat(this.name,"] init websocket failed: ").concat(rH))):k(lN)}return f.promise}async reconnectWithAction(d){let l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;CN.warning("[choose-best-ws] action: =>",d),this.onlineReconnectListener||uK.isOnline||!uK.onlineWaiter||(this.onlineReconnectListener=uK.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let f=!0;if(this.reconnectInterrupter=()=>f=!1,l){const B=yde(this.reconnectCount,this.retryConfig);CN.debug("[".concat(this.name,"] wait ").concat(B,"ms to reconnect websocket, mode: ").concat(d)),await u5.race([BK(B),this.onlineReconnectListener||new u5(()=>{})])}if(this._state==="closed"||!f)return!1;this.reconnectCount+=1;const b=async(B,Wt)=>{this.emit(U5.RECONNECT_CREATE_CONNECTION,Wt),await this.createWebSocketConnection(B)};try{if(d==="retry")await b(this.urls[this.currentURLIndex],d);else if(d==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);CN.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await b(this.urls[this.currentURLIndex],d)}else d==="recover"&&(CN.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await YK(this,U5.REQUEST_NEW_URLS),this.currentURLIndex=0,await b(this.urls[this.currentURLIndex],d))}catch(B){var k;CN.error("[".concat(this.name,"] reconnect failed ").concat(B&&B.toString()));const Wt=B==null||(k=B.data)===null||k===void 0?void 0:k.desc;return Array.isArray(Wt)&&a5(Wt).call(Wt,"dynamic key expired")?(this.emit(U5.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(d,l)}return!0}}class ule extends vSe{constructor(d,l){super(d,l,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(d,l){const f=pne(),b=function(B,Wt){return new Lke(B,Wt)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{CN.debug("[choose-best-ws] close establishing websockets"),b.closeAllWebsockets(),f.reject(new jH(dH.WS_ABORT,"choose best websocket aborted"))};const k=_H("GATEWAY_DOMAINS");return CN.debug("[choose-best-ws] currentDomain: ",d,", domains: ",k,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),b.chooseBestWebsocket(d,this.tryDoubleDomain,this.use443PortOnly,l).then(f.resolve).catch(f.reject),f.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ane extends vSe{constructor(d,l){super(d,l,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(d,l){return new u5((f,b)=>{let k=!1;const B=[];this.closeEstablishingWs=()=>{CN.debug("[choose-best-ws] close establishing websockets"),B.forEach(uH=>{uH.onclose=null,uH.onopen=null,uH.onmessage=null,uH.close()}),b(new jH(dH.WS_ABORT,"choose best websocket aborted"))};const Wt=_H("GATEWAY_DOMAINS");let $O;const uN=d.indexOf("?h="),lN=Wt.find(uH=>uN!==-1?a5(d).call(d,uH,uN):a5(d).call(d,uH));CN.debug("[choose-best-ws] currentDomain: ",lN,", domains: ",Wt);let _N=!this.tryDoubleDomain||!lN;if(!_N&&lN){var TN;const uH=Date.now();try{Wt.forEach(rH=>{const iH=uN===-1?d.replace(lN,rH):d.substr(0,uN)+d.substr(uN).replace(lN,rH),lH=new WebSocket(iH);lH.binaryType="arraybuffer",B.push(lH),CN.debug("[choose-best-ws] ws is connecting:",lH.url)})}catch{for(CN.debug("[choose-best-ws] ws create failed, fallback to single url"),B.forEach(iH=>iH.close());B.length;)B.pop();_N=!0}(TN=this.store)===null||TN===void 0||TN.recordJoinChannelService({urls:B.map(rH=>rH.url),service:"gateway"},l),B.forEach(rH=>{rH.onopen=()=>{if(k)return;const iH=Date.now()-uH;CN.debug("[choose-best-ws] ws open cost ".concat(iH,"ms")),B.filter(lH=>lH!==rH).forEach(lH=>{CN.debug("[choose-best-ws]close backup websocket: ".concat(lH.url)),lH.close()}),k=!0,f(rH)},rH.onclose=iH=>{$O=iH,!k&&(B.find(lH=>!(lH.readyState===WebSocket.CLOSED||lH.readyState===WebSocket.CLOSING))||(CN.debug("[choose-best-ws] all websocket is closed"),k=!0,b($O)))},rH.onmessage=iH=>{CN.debug("[choose-best-ws]".concat(rH.url," onmessage: ").concat(iH.data))}}),BK(this.forceCloseTimeout).then(()=>{B.forEach(rH=>{rH.readyState!==WebSocket.OPEN&&rH.close()})})}if(_N){var vN;let uH;CN.debug("[choose-best-ws] use single url: ",d),(vN=this.store)===null||vN===void 0||vN.recordJoinChannelService({urls:[d],service:"gateway"},l);try{uH=new WebSocket(d),B.push(uH),uH.binaryType="arraybuffer"}catch(rH){const iH=new jH(dH.WS_ERR,"init websocket failed! Error: ".concat(rH.toString()));return CN.error("[".concat(this.name,"]").concat(iH)),void b(iH)}uH.onopen=()=>{f(uH)},uH.onclose=rH=>{b(rH)},uH.onmessage=rH=>{CN.debug("[choose-best-ws]".concat(uH.url," onmessage: ").concat(rH.data))},BK(this.forceCloseTimeout).then(()=>{uH&&uH.readyState!==WebSocket.OPEN&&uH.close()})}}).then(f=>(this.closeEstablishingWs=void 0,f)).catch(f=>{throw this.closeEstablishingWs=void 0,f})}}class Mke extends W6{get connectionState(){return this._connectionState}set connectionState(d){d!==this._connectionState&&(this._connectionState=d,d===D6.CONNECTED?this.emit(P5.WS_CONNECTED):d===D6.RECONNECTING?this.emit(P5.WS_RECONNECTING,this._websocketReconnectReason):d===D6.CLOSED&&this.emit(P5.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(d,l){super(),cH(this,"_disconnectedReason",void 0),cH(this,"_websocketReconnectReason",void 0),cH(this,"_connectionState",D6.CLOSED),cH(this,"reconnectToken",void 0),cH(this,"websocket",void 0),cH(this,"openConnectionTime",void 0),cH(this,"clientId",void 0),cH(this,"lastMsgTime",Date.now()),cH(this,"uploadCache",[]),cH(this,"uploadCacheInterval",void 0),cH(this,"rttRolling",new Bme(5)),cH(this,"pingpongTimer",void 0),cH(this,"wsInflateDataTimer",void 0),cH(this,"pingpongTimeoutCount",0),cH(this,"joinResponse",void 0),cH(this,"multiIpOption",void 0),cH(this,"initError",void 0),cH(this,"spec",void 0),cH(this,"store",void 0),cH(this,"onWebsocketMessage",f=>{if(f.data instanceof ArrayBuffer)return void this.emit(P5.ON_BINARY_DATA,f.data);const b=JSON.parse(f.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(b,"_id")){const k="res-@".concat(b._id);this.emit(k,b._result,b._message)}else if(Object.prototype.hasOwnProperty.call(b,"_type")){if(this.emit(b._type,b._message),b._type===J5.ON_NOTIFICATION&&this.handleNotification(b._message),b._type===J5.ON_USER_BANNED)switch(b._message.error_code){case 14:this.close(_6.UID_BANNED);break;case 15:this.close(_6.IP_BANNED);break;case 16:this.close(_6.CHANNEL_BANNED)}if(b._type===J5.ON_USER_LICENSE_BANNED)switch(b._message.error_code){case I5.ERR_LICENSE_MISSING:this.close(_6.LICENSE_MISSING);break;case I5.ERR_LICENSE_EXPIRED:this.close(_6.LICENSE_EXPIRED);break;case I5.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_6.LICENSE_MINUTES_EXCEEDED);break;case I5.ERR_LICENSE_PERIOD_INVALID:this.close(_6.LICENSE_PERIOD_INVALID);break;case I5.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_6.LICENSE_MULTIPLE_SDK_SERVICE);break;case I5.ERR_LICENSE_ILLEGAL:this.close(_6.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=d.clientId,this.spec=d,this.store=l,this.websocket=new ule("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),_H("JOIN_GATEWAY_USE_443PORT_ONLY"),l),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===D6.CONNECTED&&this.reconnect("retry",zK.OFFLINE)})}async request(d,l,f,b){const k=A6(6,""),B={_id:k,_type:d,_message:l},Wt=this.websocket.connectionID,$O=()=>new u5((uH,rH)=>{if(this.connectionState===D6.CONNECTED)return uH();const iH=()=>{this.off(P5.WS_CLOSED,lH),uH()},lH=()=>{this.off(P5.WS_CONNECTED,iH),rH(new LH(dH.WS_ABORT))};this.once(P5.WS_CONNECTED,iH),this.once(P5.WS_CLOSED,lH),d!==N5.PUBLISH&&d!==N5.PUBLISH_DATASTREAM&&d!==N5.SUBSCRIBE&&d!==N5.SUBSCRIBE_DATASTREAM&&d!==N5.UNSUBSCRIBE&&d!==N5.UNSUBSCRIBE_DATASTREAM&&d!==N5.UNPUBLISH&&d!==N5.UNPUBLISH_DATASTREAM&&d!==N5.CONTROL&&d!==N5.RESTART_ICE||this.once(P5.DISCONNECT_P2P,()=>{rH(new LH(dH.DISCONNECT_P2P))}),d!==N5.PUBLISH&&d!==N5.RESTART_ICE||this.once(P5.ABORT_P2P_EXECUTION,()=>{rH(new LH(dH.DISCONNECT_P2P))})});if(this.connectionState!==D6.CONNECTING&&this.connectionState!==D6.RECONNECTING||d===N5.JOIN||d===N5.REJOIN||await $O(),this.websocket.sendMessage(B,!0),b)return;const uN=new u5((uH,rH)=>{let iH=!1;const lH=(bH,PH)=>{iH=!0,uH({isSuccess:bH==="success",message:PH||{}}),this.off(P5.WS_CLOSED,hH),this.off(P5.WS_RECONNECTING,hH),this.emit(P5.REQUEST_SUCCESS,d,l)};this.once("res-@".concat(k),lH);const hH=()=>{rH(new LH(dH.WS_ABORT,"type: ".concat(d))),this.off(P5.WS_CLOSED,hH),this.off(P5.WS_RECONNECTING,hH),this.off("res-@".concat(k),lH)};this.once(P5.WS_CLOSED,hH),this.once(P5.WS_RECONNECTING,hH),BK(_H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==Wt||iH||(CN.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(d)),this.emit(P5.REQUEST_TIMEOUT,d,l))})});let lN=null;try{lN=await uN}catch(uH){if(this.connectionState===D6.CLOSED||d===N5.LEAVE)throw new LH(dH.WS_ABORT);return!this.spec.forceWaitGatewayResponse||f?uH.throw():d===N5.JOIN||d===N5.REJOIN?null:(await $O(),await this.request(d,l))}if(lN.isSuccess)return lN.message;const _N=Number(lN.message.error_code||lN.message.code),TN=wne(_N),vN=new LH(dH.UNEXPECTED_RESPONSE,"".concat(TN.desc,": ").concat(lN.message.error_str),{code:_N,data:lN.message,desc:TN.desc});return TN.action==="success"?lN.message:(CN.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(d,", error_code: ").concat(_N,", message: ").concat(TN.desc,", action: ").concat(TN.action)),_N===I5.ERR_TOO_MANY_BROADCASTERS?((d===N5.JOIN||d===N5.REJOIN)&&(this.initError=vN,this.close()),vN.throw()):TN.action==="failed"?vN.throw():TN.action==="quit"?(this.initError=vN,this.close(),vN.throw()):(_N===I5.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=lN.message.option,CN.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zK.MULTI_IP)):this.reconnect(TN.action,zK.SERVER_ERROR),d===N5.JOIN||d===N5.REJOIN?null:await this.request(d,l)))}waitMessage(d,l){return new u5(f=>{const b=k=>{(!l||l(k))&&(this.off(d,b),f(k))};this.on(d,b)})}uploadWRTCStats(d){if(!this.store.sessionId)return void CN.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const l={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:d};this.upload(Cne.WRTC_STATS,l)}upload(d,l){const f={_type:d,_message:l};try{this.websocket.sendMessage(f)}catch{const k=_H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(f),this.uploadCache.length>k&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==D6.CONNECTED)return;const B=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(B._type,B._message)},_H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(d,l){const f={_type:d,_message:l};this.websocket.sendMessage(f)}init(d){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new u5((l,f)=>{this.once(P5.WS_CONNECTED,()=>l(this.joinResponse)),this.once(P5.WS_CLOSED,b=>f(this.initError||new LH(dH.WS_ABORT,b))),this.connectionState=D6.CONNECTING,this.websocket.init(d).catch(f),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(d){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=d||_6.LEAVE,this.connectionState=D6.CLOSED,CN.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(P5.ABORT_P2P_EXECUTION);const d=await YK(this,P5.REQUEST_JOIN_INFO),l=await this.request(N5.JOIN,d);if(!l)return this.emit(P5.REPORT_JOIN_GATEWAY,boe.TIMEOUT,this.url||""),!1;this.joinResponse=l,this.emit(P5.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=D6.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new LH(dH.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const d=gne(this,P5.REQUEST_REJOIN_INFO);d.token=this.reconnectToken;const l=await this.request(N5.REJOIN,d);return!!l&&(this.connectionState=D6.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),l.peers&&l.peers.forEach(f=>{this.emit(J5.ON_USER_ONLINE,{uid:f.uid}),f.audio&&this.emit(J5.ON_ADD_AUDIO_STREAM,{uid:f.uid,uint_id:f.uint_id,audio:!0,ssrcId:f.audio_ssrc}),f.video&&this.emit(J5.ON_ADD_VIDEO_STREAM,{uid:f.uid,uint_id:f.uint_id,video:!0,ssrcId:f.video_ssrc}),f.audio_mute?this.emit(J5.MUTE_AUDIO,{uid:f.uid}):this.emit(J5.UNMUTE_AUDIO,{uid:f.uid}),f.video_mute?this.emit(J5.MUTE_VIDEO,{uid:f.uid}):this.emit(J5.UNMUTE_VIDEO,{uid:f.uid}),f.audio_enable_local?this.emit(J5.ENABLE_LOCAL_AUDIO,{uid:f.uid}):this.emit(J5.DISABLE_LOCAL_AUDIO,{uid:f.uid}),f.video_enable_local?this.emit(J5.ENABLE_LOCAL_VIDEO,{uid:f.uid}):this.emit(J5.DISABLE_LOCAL_VIDEO,{uid:f.uid}),f.audio||f.video||this.emit(J5.ON_REMOVE_STREAM,{uid:f.uid,uint_id:f.uint_id})}),!0)}reconnect(d,l){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(d,l)}handleNotification(d){CN.debug("[".concat(this.clientId,"] receive notification: "),d);const l=wne(d.code);if(d.code===28&&"detail"in d&&(CN.info("[".concat(this.clientId,"] receive recover notification: "),d.detail),this.emit(P5.RECOVER_NOTIFICATION,d.detail)),l.action!=="success"){if(l.action!=="failed")return l.action==="quit"?(l.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_6.UID_BANNED),void this.close()):void this.reconnect(l.action,zK.SERVER_ERROR);CN.error("[".concat(this.clientId,"] ignore error: "),l.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const d=_H("PING_PONG_TIME_OUT"),l=Date.now();this.pingpongTimeoutCount>=d&&(CN.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(l-this.lastMsgTime,"ms")),l-this.lastMsgTime>_H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zK.TIMEOUT):this.request(N5.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const f=Date.now()-l;this.rttRolling.add(f),_H("REPORT_STATS")&&this.send(N5.PING_BACK,{pingpongElapse:f})}).catch(f=>{})}handleWsInflateData(){const{wsInflateLength:d,wsDeflateLength:l}=this.websocket.getWsInflateData();d!==0&&l!==0&&this.upload(Cne.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:l,ws_inflate_length:d})}handleWebsocketEvents(){this.websocket.on(U5.RECONNECT_CREATE_CONNECTION,d=>{this.emit(P5.WS_RECONNECT_CREATE_CONNECTION,d)}),this.websocket.on(U5.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(U5.CLOSED,()=>{this.connectionState=D6.CLOSED}),this.websocket.on(U5.FAILED,()=>{this._disconnectedReason=_6.NETWORK_ERROR,this.connectionState=D6.CLOSED}),this.websocket.on(U5.RECONNECTING,d=>{this._websocketReconnectReason=d,this.joinResponse=void 0,this.connectionState===D6.CONNECTED?this.connectionState=D6.RECONNECTING:this.connectionState=D6.CONNECTING}),this.websocket.on(U5.WILL_RECONNECT,(d,l,f)=>{const b=gne(this,P5.IS_P2P_DISCONNECTED),k=b||d!=="retry";b&&d==="retry"&&(CN.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),d="tryNext",l=boe.P2P_DISCONNECTED),k&&(CN.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(d)),this.emit(P5.REPORT_JOIN_GATEWAY,l||boe.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(P5.DISCONNECT_P2P)),f(d)}),this.websocket.on(U5.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(d=>{CN.warning("[".concat(this.clientId,"] rejoin failed ").concat(d)),this.reconnect("tryNext",zK.SERVER_ERROR)}):this.join().catch(d=>{if(this.emit(P5.REPORT_JOIN_GATEWAY,d,this.url||""),d instanceof LH){if(d.code===dH.UNEXPECTED_RESPONSE&&d.data.code===I5.ERR_NO_AUTHORIZED)return this.initError=new LH(dH.TOKEN_EXPIRE,"dynamic key expired"),void this.close(_6.TOKEN_EXPIRE);CN.error("[".concat(this.clientId,"] join gateway request failed"),d.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zK.SERVER_ERROR):(this.initError=d,this.close())}})}),this.websocket.on(U5.REQUEST_NEW_URLS,(d,l)=>{YK(this,P5.REQUEST_RECOVER,this.multiIpOption).then(d).catch(l)}),this.websocket.on(U5.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(J5.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(SSe.PRE_CONNECT_PC,()=>{this.emit(P5.PRE_CONNECT_PC)})}}let Uke=function(s){return s.NATIVE_RTC="native_rtc",s.NATIVE_RTM="native_rtm",s.WEB_RTC="web_rtc",s.WEB_RTM="web_rtm",s}({}),dK=function(s){return s[s.CHOOSE_SERVER=11]="CHOOSE_SERVER",s[s.CLOUD_PROXY=18]="CLOUD_PROXY",s[s.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",s[s.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",s}({});function CSe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function Coe(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?CSe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):CSe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}function X$(s){return s.match(/^[\.\:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".").concat(_H("TURN_DOMAIN")):(CN.debug("Cannot recognized as ip address: ".concat(s,", use as host")),s)}function dle(s,d){s.addresses||(s.addresses=[]);const l=function(Wt,$O){if(_H("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return Wt.map(_N=>{let{ip:TN,port:vN}=_N;return{address:"".concat(TN,":").concat(vN)}});const uN=_H("GATEWAY_DOMAINS");let lN=uN[1]&&a5($O).call($O,uN[1])?1:0;return Wt.map(_N=>{let{domain_prefix:TN,port:vN,ip:uH}=_N;if(TN)return{address:"".concat(TN,".").concat(uN[lN++%uN.length],":").concat(vN)};const rH=/^[\.\:\d]+$/.test(uH),iH=rH?"".concat(uH.replace(/[^\d]/g,"-"),".").concat(uN[lN++%uN.length],":").concat(vN):"".concat(uH,":").concat(vN);return rH||CN.debug("Cannot recognized as ip address: ".concat(uH,", use as host")),{ip:uH,port:vN,address:iH}})}(s.addresses,d),f=Array.isArray(s.detail)&&s.detail[18];if(f&&typeof f=="string"){const Wt=f.split(";");for(let $O=0;$O<Wt.length;$O++){var b;const uN=p4(b=Wt[$O]).call(b);l[$O]&&uN&&(l[$O].ip6=uN)}}const k=s.detail&&s.detail.candidate;let B;if(k){const[Wt,$O]=k.split(":");Wt&&$O&&(B={port:Number($O),ip:Wt,address:"".concat(Wt,":").concat($O)})}return{gatewayAddrs:l,apGatewayAddress:B,uid:s.uid,cid:s.cid,cert:s.cert,vid:s.detail&&s.detail[8],uni_lbs_ip:s.detail&&s.detail[1],res:s,csIp:s.detail&&s.detail[502]}}function h8(s){return typeof s=="number"?s:s.exact||s.ideal||s.max||s.min||0}function ISe(s){const d=s._encoderConfig;if(!d)return{};const l={resolution:d.width&&d.height?"".concat(h8(d.width),"x").concat(h8(d.height)):void 0,maxVideoBW:d.bitrateMax,minVideoBW:d.bitrateMin};return typeof d.frameRate=="number"?(l.maxFrameRate=d.frameRate,l.minFrameRate=d.frameRate):d.frameRate&&(l.maxFrameRate=d.frameRate.max||d.frameRate.ideal||d.frameRate.exact||d.frameRate.min,l.minFrameRate=d.frameRate.min||d.frameRate.ideal||d.frameRate.exact||d.frameRate.max),l}function wSe(s){return s>=0&&s<.17?1:s>=.17&&s<.36?2:s>=.36&&s<.59?3:s>=.59&&s<=1?4:s>1?5:0}function One(s,d){let l,f,b;switch(d){case dK.CHOOSE_SERVER:f=4096,b="choose server";break;case dK.CLOUD_PROXY:f=1048576,b="proxy";break;case dK.CLOUD_PROXY_5:f=4194304,b="proxy5";break;case dK.CLOUD_PROXY_FALLBACK:f=4194310,b="proxy fallback";break;default:throw new LH(dH.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:s.detail&&s.detail[502],retry:!1})}if(s.response_body.forEach(k=>{k.buffer&&k.buffer.flag===f&&(l={code:k.buffer.code,addresses:(k.buffer.edges_services||[]).map(B=>Coe(Coe({},B),{},{ticket:k.buffer.cert})),server_ts:s.enter_ts,uid:k.buffer.uid,cid:k.buffer.cid,cname:k.buffer.cname,detail:Coe(Coe({},k.buffer.detail),s.detail),flag:k.buffer.flag,opid:s.opid,cert:k.buffer.cert})}),!l)throw new LH(dH.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(b," from multi unilbs response"),{csIp:s.detail&&s.detail[502]});return l}async function ASe(s,d){return await u5.all(s.addresses.map(async l=>({address:X$(l.ip),tcpport:l.port,udpport:l.port,username:d&&_H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?d.toString():JK.username,password:d&&_H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await mde(d.toString()):JK.password})))}function lle(s,d){const l=d.getMediaStreamTrack(!0).getSettings(),f=d.videoHeight||l.height,b=d.videoWidth||l.width;return f&&b?Math.max(Math.min(f,b)/Math.min(h8(s.height),h8(s.width)),1):(CN.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function FX(s){let{candidateType:d,relayProtocol:l,type:f,address:b,port:k,protocol:B}=s;const Wt={candidateType:d,relayProtocol:l,protocol:B};if(f!=="local-candidate"){const $O=b.split(".");$O.length>=4&&($O[1]="*",$O[2]="*"),Wt.address=$O.join("."),Wt.port=k}return Wt}function Ioe(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_H("SVC_MODE");if(_H("ENABLE_SVC"))return function(d){return d in toe}(s)?s:toe.L1T3}const OSe={[_5.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[_5.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function woe(s,d,l){d.forEach(f=>{var b;const k=OSe[s].find(Wt=>{var $O;let{key:uN}=Wt;return a5($O=f.extensionName).call($O,uN)});if(!k)return;const B=l.find(Wt=>{let{extensionName:$O}=Wt;return a5($O).call($O,k.key)});B&&a5(b=B.extensionName).call(b,"gdpr_forbidden")&&(f.extensionName=B.extensionName)})}function Q$(s,d){d.forEach(l=>{var f;const b=OSe[s].find(k=>{var B;let{key:Wt}=k;return a5(B=l.extensionName).call(B,Wt)});a5(f=l.extensionName).call(f,"gdpr_forbidden")&&b&&(l.extensionName=b.extensionName)})}function NSe(s){return s==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||a5(s).call(s,"abs-send-time")}function Aoe(s){return s==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||a5(s).call(s,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function PSe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function DSe(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?PSe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):PSe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}function Nne(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},f=arguments.length>3?arguments[3]:void 0;const{filterRTX:b,filterVideoFec:k,filterAudioFec:B,filterAudioCodec:Wt,filterVideoCodec:$O}=d,{useXR:uN}=l;let lN=[],_N=[],TN=[],vN=[],uH=!1,rH=!1;if($4(s).mediaDescriptions.forEach(lH=>{f&&f!==lH.attributes.direction||(lH.media.mediaType!=="video"||uH||(_N=lH.attributes.payloads,vN=lH.attributes.extmaps,uH=!0),lH.media.mediaType!=="audio"||rH||(lN=lH.attributes.payloads,TN=lH.attributes.extmaps,rH=!0))}),!vN||_N.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!TN||lN.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(_N.forEach(lH=>{var hH;(hH=lH.rtpMap)!==null&&hH!==void 0&&hH.clockRate&&(lH.rtpMap.clockRate=parseInt(lH.rtpMap.clockRate)),uN&&lH.rtcpFeedbacks.push({type:"rrtr"})}),lN.forEach(lH=>{var hH;(hH=lH.rtpMap)!==null&&hH!==void 0&&hH.clockRate&&(lH.rtpMap.clockRate=parseInt(lH.rtpMap.clockRate)),uN&&lH.rtcpFeedbacks.push({type:"rrtr"})}),b&&(lN=lN.filter(lH=>{var hH;return((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName.toLowerCase())!=="rtx"}),_N=_N.filter(lH=>{var hH;return((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName.toLowerCase())!=="rtx"})),k&&(_N=_N.filter(lH=>{var hH;return!/(red)|(ulpfec)|(flexfec)/i.test(((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName)||"")})),B&&(lN=lN.filter(lH=>{var hH;return!/(red)|(ulpfec)|(flexfec)/i.test(((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName)||"")})),Wt&&(Wt==null?void 0:Wt.length)>0&&(lN=lN.filter(lH=>{var hH;return a5(Wt).call(Wt,((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName.toLowerCase())||"")})),$O&&($O==null?void 0:$O.length)>0){const lH=_N.filter(hH=>{var bH;return a5($O).call($O,((bH=hH.rtpMap)===null||bH===void 0?void 0:bH.encodingName.toLowerCase())||"")});_N=lH.concat(b?[]:fle(lH,_N))}const iH=_H("UNSUPPORTED_VIDEO_CODEC");return iH&&iH.length>0&&(_N=_N.filter(lH=>!(lH.rtpMap&&a5(iH).call(iH,lH.rtpMap.encodingName.toLowerCase())))),{audioCodecs:lN,videoCodecs:_N,audioExtensions:TN,videoExtensions:vN}}function jX(s){const d=$4(s);let l,f;for(const b of d.mediaDescriptions){if(!l){const k=b.attributes.iceUfrag,B=b.attributes.icePwd;if(!k||!B)throw new Error("Cannot get iceUfrag or icePwd from SDP.");l={iceUfrag:k,icePwd:B}}if(!f){const k=b.attributes.fingerprints;k.length>0&&(f={fingerprints:k})}}if(!f&&d.attributes.fingerprints.length>0&&(f={fingerprints:d.attributes.fingerprints}),!f||!l)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:l,dtlsParameters:f}}function kSe(s,d){const l=[],f=s.attributes.ssrcGroups.filter(B=>B.semantic==="FID"),b=s.attributes.ssrcGroups.find(B=>B.semantic==="SIM"),k=s.attributes.ssrcs;if(b)b.ssrcIds.forEach(B=>{var Wt;const $O=(Wt=f.find(uN=>uN.ssrcIds[0]===B))===null||Wt===void 0?void 0:Wt.ssrcIds[1];l.push({ssrcId:B,rtx:d?$O:void 0})});else if(f.length>0){const B=f[0].ssrcIds[0],Wt=f[0].ssrcIds[1];l.push({ssrcId:B,rtx:d?Wt:void 0})}else{if(k.length===0)throw new Error("No ssrcs found on local media description.");l.push({ssrcId:k[0].ssrcId})}return l}function LSe(s,d,l){const{cname:f}=s;let b=[];d&&(b=MSe(d)),b.length===0&&(b=s.iceParameters.candidates.map(lN=>({foundation:lN.foundation,componentId:"1",transport:lN.protocol,priority:lN.priority.toString(),connectionAddress:lN.ip,port:lN.port.toString(),type:lN.type,extension:{}})),CN.debug("Using candidates from gateway."));const k={fingerprints:s.dtlsParameters.fingerprints.map(lN=>({hashFunction:lN.algorithm,fingerprint:lN.fingerprint}))},B={iceUfrag:s.iceParameters.iceUfrag,icePwd:s.iceParameters.icePwd};let Wt;switch(s.dtlsParameters.role){case"server":Wt="passive";break;case"client":Wt="active";break;case"auto":Wt="actpass"}const $O=Noe(s.rtpCapabilities),uN=[];return Array.isArray(l)&&l.length>0&&l.forEach(lN=>{uN.push({kind:_5.VIDEO,ssrcId:lN.v,rtx:lN.v_rtx,mslabel:"".concat(lN.v,"_").concat(lN.a)},{kind:_5.AUDIO,ssrcId:lN.a,mslabel:"".concat(lN.v,"_").concat(lN.a)})}),{dtlsParameters:k,iceParameters:B,candidates:b,rtpCapabilities:$O,setup:Wt,cname:f,preSSRCs:uN}}function MSe(s){let d=[];return s.ip&&typeof s.port=="number"&&(d=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:s.ip,port:s.port.toString(),type:"host",extension:{}}],CN.debug("Using remote candidate from AP ".concat(s.ip,":").concat(s.port)),s.ip6&&(d.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:s.ip6,port:s.port.toString(),type:"host",extension:{}}),CN.debug("Using IPV6 remote candidate from AP ".concat(s.ip6,":").concat(s.port)))),d}function CQ(s,d,l){const f=[],b=[];return s.forEach(k=>{let{ssrcId:B,rtx:Wt}=k;const $O=A6(8,"track-"),uN={ssrcId:B,attributes:DSe({label:$O,mslabel:l=l||A6(10,""),msid:"".concat(l," ").concat($O)},d&&{cname:d})};if(f.push(uN),Wt!==void 0){const lN={ssrcId:Wt,attributes:DSe({label:$O,mslabel:l,msid:"".concat(l," ").concat($O)},d&&{cname:d})};f.push(lN),b.push({semantic:"FID",ssrcIds:[B,Wt]})}}),s.length>1&&b.push({semantic:"SIM",ssrcIds:s.map(k=>{let{ssrcId:B}=k;return B})}),{ssrcs:f,ssrcGroups:b}}function Z$(s,d){d instanceof _q&&s.attributes.payloads.forEach(l=>{var f;const b=(f=l.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase();if(!b||["opus","pcmu","pcma","g722"].indexOf(b)===-1)return;l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters.minptime="10",l.fmtp.parameters.useinbandfec="1";const k=d._encoderConfig;k&&b!=="pcmu"&&b!=="pcma"&&b!=="g722"&&(k.bitrate&&!Z6()&&(l.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*k.bitrate))),k.sampleRate&&(l.fmtp.parameters.maxplaybackrate="".concat(k.sampleRate),l.fmtp.parameters["sprop-maxcapturerate"]="".concat(k.sampleRate)),k.stereo&&(l.fmtp.parameters.stereo="1",l.fmtp.parameters["sprop-stereo"]="1"))})}function hle(s){const d=s.attributes.unrecognized.findIndex(l=>l.attField==="x-google-flag"&&l.attValue==="conference");d!==-1&&s.attributes.unrecognized.splice(d,1)}function ple(s,d){var l;if(!(d instanceof x6&&d._encoderConfig&&d._hints.indexOf(O6.SCREEN_TRACK)===-1))return;const f=d._encoderConfig;u6().supportMinBitrate&&f.bitrateMin&&s.attributes.payloads.forEach(b=>{var k,B;a5(k=["h264","h265","vp8","vp9","av1"]).call(k,((B=b.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())||"")&&(b.fmtp||(b.fmtp={parameters:{}}),b.fmtp.parameters["x-google-min-bitrate"]="".concat(f.bitrateMin))}),u6().supportMinBitrate&&!a5(l=d._hints).call(l,O6.LOW_STREAM)&&f.bitrateMax&&s.attributes.payloads.forEach(b=>{var k,B;a5(k=["h264","h265","vp8","vp9","av1"]).call(k,((B=b.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())||"")&&(b.fmtp||(b.fmtp={parameters:{}}),b.fmtp.parameters["x-google-start-bitrate"]="".concat(_H("X_GOOGLE_START_BITRATE")||Math.floor(f.bitrateMax)))})}function USe(s){if(s.media.mediaType!=="video")return;const d=c6();if(d.name!==p6.SAFARI&&d.os!==AK.IOS)return;const l=s.attributes.extmaps.findIndex(f=>/video-orientation/g.test(f.extensionName));l!==-1&&s.attributes.extmaps.splice(l,1)}function Ooe(s,d,l){if(!d)return;let f,b;if(s.media.mediaType==="video"?(f=l.videoExtensions,b=l.videoCodecs):(f=l.audioExtensions,b=l.audioCodecs),d.twcc===!0){const k=f.find(B=>Aoe(B.extensionName));if(k){const B=k.extensionName;s.attributes.extmaps.find($O=>Aoe($O.extensionName))||s.attributes.extmaps.push({entry:k.entry,extensionName:B}),function($O,uN){return uN.filter(lN=>!!$O.find(_N=>_N.payloadType===lN.payloadType&&!!_N.rtcpFeedbacks.find(TN=>TN.type==="transport-cc")))}(b,s.attributes.payloads).forEach($O=>{$O.rtcpFeedbacks.find(uN=>uN.type==="transport-cc")||$O.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(d.twcc===!1){const k=s.attributes.extmaps.findIndex(B=>Aoe(B.extensionName));k!==-1&&s.attributes.extmaps.splice(k,1),s.attributes.payloads.forEach(B=>{const Wt=B.rtcpFeedbacks.findIndex($O=>$O.type==="transport-cc");Wt!==-1&&B.rtcpFeedbacks.splice(Wt,1)})}if(d.remb===!0){const k=f.find(B=>NSe(B.extensionName));if(k){const B=k.extensionName;s.attributes.extmaps.find($O=>$O.extensionName===B)||s.attributes.extmaps.push({entry:k.entry,extensionName:B}),function($O,uN){return uN.filter(lN=>!!$O.find(_N=>_N.payloadType===lN.payloadType&&!!_N.rtcpFeedbacks.find(TN=>TN.type==="goog-remb")))}(b,s.attributes.payloads).forEach($O=>{$O.rtcpFeedbacks.find(uN=>uN.type==="goog-remb")||$O.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(d.remb===!1){const k=s.attributes.extmaps.findIndex(B=>NSe(B.extensionName));k!==-1&&s.attributes.extmaps.splice(k,1),s.attributes.payloads.forEach(B=>{const Wt=B.rtcpFeedbacks.findIndex($O=>$O.type==="goog-remb");Wt!==-1&&B.rtcpFeedbacks.splice(Wt,1)})}}function xSe(s,d,l){if(Z6()||s.media.mediaType!=="video"||!(d instanceof x6)||l!=="vp9"&&l!=="vp8"||l==="vp8"&&!_H("SIMULCAST")||l==="vp9"&&_H("ENABLE_SVC")||d._scalabilityMode===void 0||d._scalabilityMode.numSpatialLayers<=1)return;const f=l==="vp8"?2:d._scalabilityMode.numSpatialLayers,b=s.attributes.ssrcs[0],k=s.attributes.ssrcGroups.find(Wt=>Wt.semantic==="FID"&&Wt.ssrcIds[0]===b.ssrcId),B={semantic:"SIM",ssrcIds:[b.ssrcId]};for(let Wt=1;Wt<f;Wt++)s.attributes.ssrcs.push({ssrcId:b.ssrcId+Wt,attributes:$6(b.attributes)}),B.ssrcIds.push(b.ssrcId+Wt),k&&(s.attributes.ssrcs.push({ssrcId:k.ssrcIds[1]+Wt,attributes:$6(b.attributes)}),s.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[b.ssrcId+Wt,k.ssrcIds[1]+Wt]}));s.attributes.ssrcGroups.unshift(B)}async function VSe(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly"}),l.addTransceiver("audio",{direction:"sendonly"}),l.addTransceiver("video",{direction:"recvonly"}),l.addTransceiver("audio",{direction:"recvonly"});const f=(await l.createOffer()).sdp,{send:b,recv:k,sendrecv:B}=function(){let Wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},$O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},uN=arguments.length>2?arguments[2]:void 0;const lN=Nne(uN,Wt,$O,"sendonly"),_N=Nne(uN,Wt,$O,"recvonly"),TN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},vN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},uH={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(RY(lN,_N,"videoExtensions",TN,vN,uH),RY(lN,_N,"videoCodecs",TN,vN,uH),RY(lN,_N,"audioExtensions",TN,vN,uH),RY(lN,_N,"audioCodecs",TN,vN,uH),_H("RAISE_H264_BASELINE_PRIORITY")){const rH=[],iH=[];uH.videoCodecs.forEach((lH,hH)=>{var bH;if(((bH=lH.rtpMap)===null||bH===void 0?void 0:bH.encodingName.toLocaleLowerCase())==="h264"){var PH,OH;const wH=uH.videoCodecs[hH+1],BH=wH&&WSe(lH,wH),XH=(PH=lH.fmtp)===null||PH===void 0?void 0:PH.parameters["profile-level-id"],d5=(OH=lH.fmtp)===null||OH===void 0?void 0:OH.parameters["packetization-mode"];!XH||XH!==_H("FIRST_H264_PROFILE_LEVEL_ID")||_H("FIRST_PACKETIZATION_MODE")&&d5!==_H("FIRST_PACKETIZATION_MODE")?BH?iH.push([lH,wH]):iH.push([lH]):BH?rH.push([lH,wH]):rH.push([lH])}}),rH.length>0&&iH.length>0&&(CN.debug("raising H264 baseline profile priority"),uH.videoCodecs.forEach((lH,hH)=>{var bH;if(((bH=lH.rtpMap)===null||bH===void 0?void 0:bH.encodingName.toLocaleLowerCase())==="h264"){const PH=WSe(lH,uH.videoCodecs[hH+1]),OH=rH.shift()||iH.shift()||[];OH.length>0&&(PH?uH.videoCodecs.splice(hH,2,...OH):uH.videoCodecs.splice(hH,1,...OH))}}),vN.videoCodecs=vN.videoCodecs.filter(lH=>{var hH,bH;return!(((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName.toLocaleLowerCase())==="h264"&&((bH=lH.fmtp)===null||bH===void 0?void 0:bH.parameters["profile-level-id"])!==_H("FIRST_H264_PROFILE_LEVEL_ID"))}),_H("FILTER_SEND_H264_BASELINE")&&(TN.videoCodecs=TN.videoCodecs.filter(lH=>{var hH,bH;return!(((hH=lH.rtpMap)===null||hH===void 0?void 0:hH.encodingName.toLocaleLowerCase())==="h264"&&((bH=lH.fmtp)===null||bH===void 0?void 0:bH.parameters["profile-level-id"])!==_H("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:TN,recv:vN,sendrecv:uH}}(s,d,f);try{l.close()}catch{}return{send:b,recv:k,sendrecv:B}}function FSe(){const s={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},d=Nne(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(RY(s,d,"videoExtensions",l,f,b),RY(s,d,"videoCodecs",l,f,b),RY(s,d,"audioExtensions",l,f,b),RY(s,d,"audioCodecs",l,f,b),_H("RAISE_H264_BASELINE_PRIORITY")){const k=b.videoCodecs.findIndex(B=>B.rtpMap&&B.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&B.fmtp&&B.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){const B=b.videoCodecs.findIndex(Wt=>Wt.rtpMap&&Wt.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(B<k){CN.debug("raising H264 baseline profile priority");const Wt=b.videoCodecs[k];b.videoCodecs.splice(k,1),b.videoCodecs.splice(B,0,Wt)}B!==-1&&(f.videoCodecs=f.videoCodecs.filter(Wt=>!(Wt.rtpMap&&Wt.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Wt.fmtp&&Wt.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:l,recv:f,sendrecv:b}}function RY(s,d,l,f,b,k){if(l==="videoExtensions"||l==="audioExtensions"){const B=[];return s[l].forEach(Wt=>{d[l].some(($O,uN)=>{if(Wt.entry===$O.entry&&Wt.extensionName===$O.extensionName)return B.push(uN),!0})?k[l].push(Wt):f[l].push(Wt)}),void d[l].forEach((Wt,$O)=>{B.indexOf($O)===-1&&b[l].push(Wt)})}if(l==="videoCodecs"||l==="audioCodecs"){const B=[];return s[l].forEach(Wt=>{d[l].some(($O,uN)=>{if(Wt.payloadType===$O.payloadType&&JSON.stringify(Wt)===JSON.stringify($O))return B.push(uN),!0})?k[l].push(Wt):f[l].push(Wt)}),void d[l].forEach((Wt,$O)=>{B.indexOf($O)===-1&&b[l].push(Wt)})}}function Noe(s){const{send:d,recv:l,sendrecv:f}=s;if(!f){if(!d||!l)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:d,recv:l}}let b,k;return d?(b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b.audioCodecs=[...d.audioCodecs,...f.audioCodecs],b.videoCodecs=[...d.videoCodecs,...f.videoCodecs],b.audioExtensions=[...d.audioExtensions,...f.audioExtensions],b.videoExtensions=[...d.videoExtensions,...f.videoExtensions]):b=f,l?(k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k.audioCodecs=[...l.audioCodecs,...f.audioCodecs],k.videoCodecs=[...l.videoCodecs,...f.videoCodecs],k.audioExtensions=[...l.audioExtensions,...f.audioExtensions],k.videoExtensions=[...l.videoExtensions,...f.videoExtensions]):k=f,{send:b,recv:k}}function $$(s){s.media.mediaType==="audio"&&s.attributes.payloads.filter(d=>{var l;return((l=d.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="opus"}).forEach(d=>{d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters.stereo="1",d.fmtp.parameters["sprop-stereo"]="1"})}function Pne(s,d,l,f){let b=[];if(s===_5.VIDEO){if(_H("H264_PROFILE_LEVEL_ID")&&f==="h264"&&(b=d.videoCodecs.filter(k=>{var B;return a5(B=k.rtpMap&&k.rtpMap.encodingName.toLowerCase()||"").call(B,f)&&k&&k.fmtp&&k.fmtp.parameters["profile-level-id"]===_H("H264_PROFILE_LEVEL_ID")})),!Array.isArray(b)||b.length===0){let k=[];const B=[],Wt=[],$O=[];if(l.videoCodecs.forEach(uN=>{const lN=uN.rtpMap&&uN.rtpMap.encodingName.toLowerCase()||"";a5(lN).call(lN,f)?k.push(uN):a5(lN).call(lN,"vp9")?B.push(uN):a5(lN).call(lN,"vp8")?Wt.push(uN):a5(lN).call(lN,"h264")&&$O.push(uN)}),k.length===0){let uN="";B.length!==0?(k=B,uN="vp9"):Wt.length!==0?(k=Wt,uN="vp8"):$O.length!==0&&(k=$O,uN="h264"),CN.warning("codec ".concat(f," not included in rtpCapabilities, fallback to default payloads: ").concat(uN))}k.length!==0&&(b=d.videoCodecs.filter(uN=>k.some(lN=>lN.payloadType===uN.payloadType)))}if(b.length===0&&(CN.warning("codec ".concat(f," not included in rtpCapabilities, fallback to default payloads: ").concat(d.videoCodecs[0].rtpMap&&d.videoCodecs[0].rtpMap.encodingName)),b=d.videoCodecs),_H("USE_PUB_RTX")||_H("USE_SUB_RTX")){const k=fle(b,d.videoCodecs);b=[...b,...k]}}else b=d.audioCodecs.filter(k=>{var B;return a5(B=k.rtpMap&&k.rtpMap.encodingName.toLowerCase()||"").call(B,f)}),b.length===0&&(CN.warning("codec ".concat(f," not included in rtpCapabilities, fallback to opus")),b=d.audioCodecs.filter(k=>{var B;return a5(B=k.rtpMap&&k.rtpMap.encodingName.toLowerCase()||"").call(B,"opus")}));return b}function fle(s,d){const l=s.map(f=>f.payloadType.toString());return d.filter(f=>f.rtpMap&&f.rtpMap.encodingName==="rtx"&&f.fmtp&&f.fmtp.parameters.apt&&a5(l).call(l,f.fmtp&&f.fmtp.parameters.apt))}async function Poe(s,d,l){const f=d.toString(),b=BSe(f,"offer","remote","exchangeSDP");await s.setRemoteDescription({type:"offer",sdp:f});const k=await s.createAnswer();if(!k.sdp)throw new Error("cannot get answer sdp");let B=k.sdp;B=jSe(B,l||{}),b==null||b(B||""),await s.setLocalDescription({type:"answer",sdp:B})}function jSe(s,d,l){const f=$4(s),{useXR:b}=d;return f.mediaDescriptions.forEach(k=>{var B;k.attributes.mid&&(Array.isArray(l)&&!a5(l).call(l,k.attributes.mid)||(k.media.mediaType==="audio"&&$$(k),b&&a5(B=["audio","video"]).call(B,k.media.mediaType)&&k.attributes.payloads.forEach(Wt=>{Wt.rtcpFeedbacks.findIndex($O=>$O.type==="rrtr")===-1&&Wt.rtcpFeedbacks.push({type:"rrtr"})})))}),UX(f)}function BSe(s,d,l,f){if(_H("SDP_LOGGING"))return CN.upload("exchanging ".concat(l," ").concat(d," SDP during P2PConnection.").concat(f,`
`),s),d==="offer"?b=>{BSe(b,"answer",l==="local"?"remote":"local",f)}:void 0}function GSe(s){const d=_H("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(d)&&d.length>0)&&d.some(l=>a5(s).call(s,l))}function WSe(s,d){try{var l;return((l=s.fmtp)===null||l===void 0?void 0:l.parameters.apt)===d.payloadType.toString()}catch{return!1}}function HSe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function J8(s,d){return typeof _H(s)===d?_H(s):void 0}function xke(){try{const s=_H("EXPERIMENTS")||{};return typeof s=="string"||Array.isArray(s)?{}:function(d){for(var l=1;l<arguments.length;l++){var f=arguments[l]!=null?arguments[l]:{};l%2?HSe(Object(f),!0).forEach(function(b){cH(d,b,f[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):HSe(Object(f)).forEach(function(b){Object.defineProperty(d,b,Object.getOwnPropertyDescriptor(f,b))})}return d}({},s)}catch(s){return CN.debug("handle gateway attributes failed: ",s),{}}}const qSe={};function IQ(s){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&CN.debug("install service ".concat(s.name)),qSe[s.name]=s}function BX(s){const d=qSe[s];if(!d)throw new jH(dH.INVALID_OPERATION,"".concat(s," not found, please use AgoraRTC.use(").concat(s,"Service) to load it first"));return d}function KSe(s,d){return BX("DataStream").create(s,d)}function zSe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function M7(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?zSe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):zSe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const _le=new Map;class Vke extends W6{get state(){return this._state}set state(d){if(d===this._state)return;const l=this._state;this._state=d,d==="DISCONNECTED"&&this._disconnectedReason?this.emit(LK.CONNECTION_STATE_CHANGE,d,l,this._disconnectedReason):this.emit(LK.CONNECTION_STATE_CHANGE,d,l)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(d){CN.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(d)),this._joinGatewayStartTime=d}constructor(d,l){var f,b,k;super(),cH(this,"store",void 0),cH(this,"joinInfo",void 0),cH(this,"key",void 0),cH(this,"ntpOffset",0),cH(this,"signal",void 0),cH(this,"role",void 0),cH(this,"inChannelInfo",{joinAt:null,duration:0}),cH(this,"spec",void 0),cH(this,"_state","DISCONNECTED"),cH(this,"_statsCollector",void 0),cH(this,"_disconnectedReason",void 0),cH(this,"isSignalRecover",!1),cH(this,"hasChangeBGPAddress",!1),cH(this,"trafficStatsInterval",void 0),cH(this,"networkQualityInterval",void 0),cH(this,"_joinGatewayStartTime",0),cH(this,"_signalTimeout",!1),cH(this,"_clientRoleOptions",void 0),cH(this,"_isProactiveJoin",!1),this.store=d,this.spec=l,this.signal=this.store.useP2P?(f={spec:M7(M7({},l),{},{retryConfig:l.websocketRetryConfig}),store:d},(b=(k=BX("P2PChannel")).createSubmodule)===null||b===void 0?void 0:b.call(k,f)):new Mke(M7(M7({},l),{},{retryConfig:l.websocketRetryConfig}),d),this._statsCollector=l.statsCollector,this.role=l.role||"audience",this._clientRoleOptions=l.clientRoleOptions,this.handleSignalEvents()}async join(d,l,f){this.store.joinGatewayStart(),d.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const b=Date.now();let k=_le.get(d.cname);if(k||(k=new Map,_le.set(d.cname,k)),this._isProactiveJoin=!0,k.has(d.uid)){const uN=new LH(dH.UID_CONFLICT);throw T5.joinGateway(d.sid,{lts:b,succ:!1,ec:uN.code,addr:null,uid:d.uid,cid:d.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!d.proxyServer,signalChannel:"0",preload:d.preload}),uN}k.set(d.uid,!0),this.joinInfo=d,this.key=l;let B=0;this.joinGatewayStartTime=b;const Wt=d.proxyServer;try{CN.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(B));const uN=d.gatewayAddrs.map(lN=>{let{address:_N}=lN;const[TN,vN]=_N.split(":"),uH={host:TN,port:vN};return d.proxyServer&&(uH.proxy=d.proxyServer),uH});B=(await this.signal.init(uN)).uid,CN.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(B," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(uN){var $O;throw CN.error("[".concat(this.store.clientId,"] User join failed"),uN.toString()),T5.joinGateway(d.sid,{lts:b,succ:!1,ec:(($O=uN.data)===null||$O===void 0?void 0:$O.desc)||uN.code,errorMsg:uN.message,addr:this.signal.url,uid:d.uid,cid:d.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!Wt,signalChannel:"0",preload:d.preload}),k.delete(d.uid),this.signal.close(),uN}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),CN.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(uN=>{CN.warning("[".concat(this.store.clientId,"] get traffic stats error"),uN.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(LK.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(LK.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(LK.NETWORK_QUALITY,{uplinkNetworkQuality:wSe(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:wSe(this._statsCollector.trafficStats.B_dnq)}):this.emit(LK.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),B}async leave(){let d=arguments.length>0&&arguments[0]!==void 0&&arguments[0],l=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){l!==_6.FALLBACK&&(this.state="DISCONNECTING");try{d||this.signal.connectionState!==D6.CONNECTED||await function(f,b){return b===1/0?f:u5.race([f,oDe(b)])}(this.signal.request(N5.LEAVE,void 0,!0),3e3)}catch(f){CN.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),f)}this.signal.close(l),l!==_6.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(d,l,f){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const b={state:"offer",p2p_id:this.store.p2pId,ortc:l,mode:this.spec.mode,extend:_H("PUB_EXTEND"),twcc:!!_H("PUBLISH_TWCC"),rtx:!!_H("USE_PUB_RTX")};try{return(await this.signal.request(N5.PUBLISH,b,!0))._message}catch(k){if(f&&k.data&&k.data.code===I5.ERR_PUBLISH_REQUEST_INVALID)return CN.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),k.toString()),await this.tryUnpubBeforeRepub(d,l),this.publish(d,l,!1);throw k}}async publishDataChannel(d,l,f){var b;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const k={stream_id:l.streamId,ordered:l.ordered?1:0,max_retrans_times:(b=l.maxRetransmits)!==null&&b!==void 0?b:10,channel_id:l.channelId,metadata:l.metadata};try{await this.signal.request(N5.PUBLISH_DATASTREAM,k,!0)}catch(B){if(f&&B.data&&B.data.code===I5.ERR_PUBLISH_REQUEST_INVALID)return CN.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),B.toString()),await this.tryUnpubDataChannelBeforeRepub(d,l),this.publishDataChannel(d,l,!1);throw B}}async unpublish(d,l){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(N5.UNPUBLISH,{stream_id:l,ortc:d},!0)}catch(f){CN.warning("[".concat(this.store.clientId,"] unpublish warning: "),f)}}async unpublishDataChannel(d){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await u5.all(d.map(l=>this.signal.request(N5.UNPUBLISH_DATASTREAM,{channel_id:l},!0)))}catch(l){CN.warning("unpublish datachannels warning: ",l)}}async presubscribe(d,l,f){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const b={stream_id:d,stream_type:l,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_H("SUBSCRIBE_TWCC"),rtx:!!_H("USE_SUB_RTX")||void 0,extend:_H("SUB_EXTEND"),svc:Array.isArray(_H("SVC"))&&_H("SVC").length!==0?_H("SVC"):void 0};try{return await this.signal.request(N5.PRE_SUBSCRIBE,b,!0)}catch(k){if(f&&k.data&&k.data.code===I5.ERR_SUBSCRIBE_REQUEST_INVALID)return CN.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),k.toString()),this.presubscribe(d,l,!1);throw k}}async subscribe(d,l,f){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const b={stream_id:d,stream_type:l.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_H("SUBSCRIBE_TWCC"),rtx:!!_H("USE_SUB_RTX"),extend:_H("SUB_EXTEND"),ssrcId:l.ssrcId,svc:Array.isArray(_H("SVC"))&&_H("SVC").length!==0?_H("SVC"):void 0};try{return(await this.signal.request(N5.SUBSCRIBE,b,!0))._message}catch(k){if(f&&k.data&&k.data.code===I5.ERR_SUBSCRIBE_REQUEST_INVALID)return CN.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),k.toString()),await this.tryUnsubBeforeResub(d,l),await this.subscribe(d,l,!1);throw k}}async subscribeDataChannel(d,l,f){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const b={uid:d,stream_id:l.id,channel_id:l.datachannelId};try{return void await this.signal.request(N5.SUBSCRIBE_DATASTREAM,b,!0)}catch(k){if(f&&k.data&&k.data.code===I5.ERR_SUBSCRIBE_REQUEST_INVALID)return CN.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),k.toString()),await this.tryUnsubDataChannelBeforeResub(d,l),await this.subscribeDataChannel(d,l,!1);throw k}}async subscribeAll(d,l){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const f={p2p_id:this.store.p2pId,users:d,dtx:!1,rtx:!!_H("USE_SUB_RTX"),twcc:!!_H("SUBSCRIBE_TWCC"),svc:Array.isArray(_H("SVC"))&&_H("SVC").length!==0?_H("SVC"):void 0};try{return await this.signal.request(N5.SUBSCRIBE_STREAMS,f,!0)}catch(b){if(l&&b.data&&b.data.code===I5.ERR_SUBSCRIBE_REQUEST_INVALID)return CN.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),b.toString()),await this.tryMassUnsubBeforeResub(d),await this.subscribeAll(d,!1);throw b}}async setVideoProfile(d){const l=function(f){if(!(f.bitrateMax&&f.bitrateMin&&f.frameRate&&f.height&&f.width))return;let b=f.frameRate,k=f.width,B=f.height,Wt=!0;return typeof b!="number"&&(b=b.exact||b.ideal||b.max||b.min||0,b||(Wt=!1)),typeof k!="number"&&(k=k.exact||k.ideal||k.max||k.min||0,k||(Wt=!1)),typeof B!="number"&&(B=B.exact||B.ideal||B.max||B.min||0,b||(Wt=!1)),Wt?{stream_type:0,width:k,height:B,fps:b,start_bps:1e3*f.bitrateMax,min_bps:1e3*f.bitrateMin,target_bps:1e3*f.bitrateMax}:void 0}(d);if(l)return this.signal.request(N5.SET_VIDEO_PROFILE,l);CN.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(d,l){try{await this.signal.request(N5.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:d,stream_id:l},!0)}catch(f){CN.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),f)}}async unsubscribeDataChannel(d,l){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await u5.all(d.map(f=>this.signal.request(N5.UNSUBSCRIBE_DATASTREAM,{stream_id:f,uid:l},!0)))}catch(f){CN.warning("unsubscribeDataChannel warning: ",f)}}async massUnsubscribe(d){try{await this.signal.request(N5.UNSUBSCRIBE_STREAMS,d,!0)}catch(l){CN.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),l)}}async reconnectPC(d){const{iceParameters:l,dtlsParameters:f,rtpCapabilities:b}=d;return{gatewayEstablishParams:await this.signal.request(N5.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:l,dtlsParameters:f,rtpCapabilities:b}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(N5.GATEWAY_INFO)}async renewToken(d){await this.signal.request(N5.RENEW_TOKEN,d),this.key=d.token}updateClientRole(d,l){l&&(this._clientRoleOptions=Object.assign({},l)),_H("CLIENT_ROLE_OPTIONS")&&(CN.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(_H("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},_H("CLIENT_ROLE_OPTIONS"))),this.role=d}async setClientRole(d,l){if(l&&(this._clientRoleOptions=Object.assign({},l)),_H("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},_H("CLIENT_ROLE_OPTIONS")),CN.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(_H("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=d);let f,b=0;d==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(f=this._clientRoleOptions.delay,b=1):b=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:b=0,await this.signal.request(N5.SET_CLIENT_ROLE,{role:d,level:b,delay:f,client_ts:Date.now()}),this.role=d}async setRemoteVideoStreamType(d,l){await this.signal.request(N5.SWITCH_VIDEO_STREAM,{stream_id:d,stream_type:l})}async setDefaultRemoteVideoStreamType(d){await this.signal.request(N5.DEFAULT_VIDEO_STREAM,{stream_type:d})}async setStreamFallbackOption(d,l){await this.signal.request(N5.SET_FALLBACK_OPTION,{stream_id:d,fallback_type:l})}async pickSVCLayer(d,l){await this.signal.request(N5.PICK_SVC_LAYER,{stream_id:d,spatial_layer:l.spatialLayer,temporal_layer:l.temporalLayer})}async setRTM2Flag(d){await this.signal.request(N5.SET_RTM2_FLAG,{rtm2_flag:d})}async sendExtensionMessage(d,l,f){if(this.store.useP2P)return this.signal.sendExtensionMessage(d,l,f)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),M7({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(N5.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const d=_le.get(this.joinInfo.cname);d&&d.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const d=function(l){let f;return f=l.startsWith("dc")?l.match(/(dc\:\/\/)?([^:]+):(\d+)/):l.match(/(wss\:\/\/)?([^:]+):(\d+)/),f?{username:JK.username,password:JK.password,turnServerURL:f[2],tcpport:parseInt(f[3])+30,udpport:parseInt(f[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],d&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(M7(M7({},JK),{},{turnServerURL:d.turnServerURL,tcpport:d.tcpport,udpport:d.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const d=await this.signal.request(N5.TRAFFIC_STATS,void 0,!0);d.timestamp=Date.now(),d.ntp_offset!=null&&(this.ntpOffset=d.ntp_offset),d.peer_delay.forEach(l=>{const f=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(b=>b.peer_uid===l.peer_uid);f&&f.B_st!==l.B_st&&Qse(()=>{this.emit(LK.STREAM_TYPE_CHANGE,l.peer_uid,l.B_st)})}),this._statsCollector.updateTrafficStats(d)}getJoinMessage(d){if(!this.joinInfo||!this.key)throw new LH(dH.UNEXPECTED_ERROR,"can not generate join message, no join info");const l=Object.assign({},this.joinInfo.apResponse);let f=_H("REPORT_APP_SCENARIO");if(typeof f!="string")try{f=JSON.stringify(f)}catch{f=void 0}var b;f&&f.length>128&&(f=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(LK.UPDATE_GATEWAY_CONFIG),b=this.store.clientId,a5(q$).call(q$,b)||q$.push(b);const k=!(Z6()||Eme(87)||rge())&&typeof _H("ENABLE_PRE_SUB")=="boolean"&&_H("ENABLE_PRE_SUB"),B=!rge()&&J8("ENABLE_PREALLOC_PC","boolean"),Wt=xke(),$O=M7({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:q8,browser:navigator.userAgent,process_id:_H("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:l,extend:_H("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:f,attributes:{userAttributes:M7({enableEncodedTransform:!!_H("ENABLE_AUDIO_METADATA")&&I$(87)||!!_H("ENABLE_AUDIO_TOPN")&&ude(p6.CHROME,87,116)||void 0,enableAudioMetadata:!!_H("ENABLE_AUDIO_METADATA")&&I$(87),topnSmoothLevel:_H("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:_H("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:_H("TOPN_SWITCH_HOLD_MS"),topnAudioGain:_H("TOPN_AUDIO_GAIN"),enablePublishedUserList:_H("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:_H("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:J8("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:J8("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:J8("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:_H("USE_PUB_RTX")===!0||_H("USE_SUB_RTX")===!0||void 0,disableFEC:_H("DISABLE_FEC"),enableNTPReport:!!_H("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!_H("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!_H("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:J8("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!_H("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!_H("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:J8("USE_XR","boolean"),enableLossbasedBwe:J8("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!_H("ENABLE_AUT_CC")||void 0,enableCCFallback:J8("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:B,preSubNum:k?J8("PRE_SUB_NUM","number"):void 0,enablePubTWCC:J8("PUBLISH_TWCC","boolean"),enableSubTWCC:J8("SUBSCRIBE_TWCC","boolean"),enablePubRTX:J8("USE_PUB_RTX","boolean"),enableSubRTX:J8("USE_SUB_RTX","boolean"),enableSubSVC:_H("ENABLE_SVC")?_H("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(_H("SVC"))&&_H("SVC").length!==0?_H("SVC"):void 0,enableSvcExtended:_H("ENABLE_SVC")&&Array.isArray(_H("SVC_EXTENDED"))&&_H("SVC_EXTENDED").length!==0?_H("SVC_EXTENDED"):void 0},Wt)},join_ts:this.joinGatewayStartTime},d);return this.joinInfo.stringUid&&($O.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&($O.aes_mode=this.joinInfo.aesmode,_H("ENCRYPT_AES")?($O.aes_secret=this.joinInfo.aespassword,$O.aes_encrypt=!0):$O.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&($O.aes_salt=this.joinInfo.aessalt)),l.addresses[this.signal.websocket.currentURLIndex]&&($O.ap_response.ticket=l.addresses[this.signal.websocket.currentURLIndex].ticket,delete l.addresses),this.joinInfo.defaultVideoStream!==void 0&&($O.default_video_stream=this.joinInfo.defaultVideoStream),$O}getRejoinMessage(){if(!this.joinInfo)throw new LH(dH.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(P5.WS_RECONNECT_CREATE_CONNECTION,d=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(P5.WS_RECONNECTING,d=>{this.joinInfo&&T5.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:d||zK.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",T5.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(P5.WS_CLOSED,d=>{let l;switch(d){case _6.LEAVE:l=zK.LEAVE;break;case _6.UID_BANNED:case _6.IP_BANNED:case _6.CHANNEL_BANNED:case _6.SERVER_ERROR:l=zK.SERVER_ERROR;break;case _6.FALLBACK:l=zK.FALLBACK;break;case _6.LICENSE_MISSING:case _6.LICENSE_EXPIRED:case _6.LICENSE_MINUTES_EXCEEDED:case _6.LICENSE_PERIOD_INVALID:case _6.LICENSE_MULTIPLE_SDK_SERVICE:case _6.LICENSE_ILLEGAL:case _6.TOKEN_EXPIRE:l=d;break;default:l=zK.NETWORK_ERROR}CN.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(l||"undefined -> "+zK.NETWORK_ERROR)),this.joinInfo&&T5.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:d===_6.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:l}),this._disconnectedReason=d,d!==_6.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(P5.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const d=_H("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;d&&(d.level||d.delay)&&(CN.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(d.level,", delay: ").concat(d.delay)),this.setClientRole(this.role,d))}if(T5.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const d=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!d)return void CN.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(d));S6("EVENT_REPORT_DOMAIN",d[1]),S6("EVENT_REPORT_BACKUP_DOMAIN",d[1]),S6("LOG_UPLOAD_SERVER","".concat(d[1],":6444"))}}}),this.signal.on(J5.ON_UPLINK_STATS,d=>{this._statsCollector.updateUplinkStats(d)}),this.signal.on(P5.REQUEST_RECOVER,(d,l,f)=>{if(!this.joinInfo)return f(new LH(dH.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));d&&(this.joinInfo.multiIP=d,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,YK(this,LK.REQUEST_NEW_GATEWAY_LIST).then(l).catch(f)}),this.signal.on(P5.REQUEST_JOIN_INFO,async(d,l,f)=>{var b;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void d(this.getJoinMessage({ortc:{}}));const{iceParameters:k,dtlsParameters:B,rtpCapabilities:Wt}=await YK(this,LK.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(b=this.joinInfo)===null||b===void 0?void 0:b.turnServer});try{d(this.getJoinMessage({ortc:{iceParameters:k,dtlsParameters:B,rtpCapabilities:Wt,version:"2"}}))}catch($O){l($O)}}),this.signal.on(P5.REQUEST_REJOIN_INFO,d=>{d(this.getRejoinMessage())}),this.signal.on(P5.REPORT_JOIN_GATEWAY,(d,l)=>{if(!this.joinInfo)return;let f,b="";var k;d instanceof LH?(f=((k=d.data)===null||k===void 0?void 0:k.desc)||d.code,b=d.message):f=d,T5.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:f,errorMsg:b,addr:l,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(P5.IS_P2P_DISCONNECTED,d=>{d(gne(this,LK.IS_P2P_DISCONNECTED))}),this.signal.on(P5.DISCONNECT_P2P,()=>{this.emit(LK.DISCONNECT_P2P)}),this.signal.on(P5.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(P5.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(P5.JOIN_RESPONSE,d=>{const l=this.getCurrentGatewayAddress();this.emit(LK.JOIN_RESPONSE,d,l)}),this.signal.on(P5.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const d=this.getCurrentGatewayAddress(),l=_H("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(d&&l){const f=MSe(d);this.emit(LK.PRE_CONNECT_PC,{candidates:f,fingerprint:l})}}}),this.signal.on(P5.RECOVER_NOTIFICATION,d=>{this.joinInfo&&typeof _H("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(_H("AP_REQUEST_DETAIL"),";").concat(d))})}async tryUnsubBeforeResub(d,l){try{await this.signal.request(N5.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:d,ortc:[l]},!0)}catch(f){throw CN.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),f),f}}async tryUnsubDataChannelBeforeResub(d,l){try{await this.signal.request(N5.UNSUBSCRIBE,{stream_id:l.id},!0)}catch(f){throw CN.warning("unsubscribe datachannel warning",f),f}}async tryUnpubBeforeRepub(d,l){try{await this.signal.request(N5.UNPUBLISH,{stream_id:d,ortc:l},!0)}catch(f){throw CN.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),f),f}}async tryUnpubDataChannelBeforeRepub(d,l){try{await this.signal.request(N5.UNPUBLISH_DATASTREAM,{channnel_id:l.channelId},!0)}catch(f){throw CN.warning("unpublish datastream warning: ",f),f}}async tryMassUnsubBeforeResub(d){const l={users:d.map(f=>({stream_id:f.stream_id,stream_type:f.stream_type}))};try{await this.signal.request(N5.UNSUBSCRIBE_STREAMS,l,!0)}catch(f){throw CN.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),f),f}}async muteLocal(d,l){const f={action:d.find(b=>b.stream_type===m6.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:d,stream_id:l};try{await this.signal.request(N5.CONTROL,f,!0,!0)}catch(b){throw CN.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),b),b}}async unmuteLocal(d,l){const f={action:d.find(b=>b.stream_type===m6.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:d,stream_id:l};try{await this.signal.request(N5.CONTROL,f,!0,!0)}catch(b){throw CN.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),b),b}}async muteRemote(d,l){const f={action:d===_5.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:l};try{await this.signal.request(N5.CONTROL,f,!0,!0)}catch(b){throw CN.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),b),b}}async unmuteRemote(d,l){const f={action:d===_5.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:l};try{await this.signal.request(N5.CONTROL,f,!0,!0)}catch(b){throw CN.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),b),b}}uploadWRTCStats(d){this.signal.uploadWRTCStats(d)}upload(d,l){this.signal.upload(d,l)}getSignalRTT(){return this.signal.rtt}async restartICE(d){const l={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:d};try{return await this.signal.request(N5.RESTART_ICE,l,!0)}catch(f){throw CN.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),f),f}}reconnect(d,l){this.state==="CONNECTED"&&this.signal.reconnect(d||void 0,l||zK.P2P_FAILED)}getCurrentGatewayAddress(){var d,l;if(!_H("GATEWAY_WSS_ADDRESS"))return _H("USE_CANDIDATE_FROM_AP_DETAIL")&&(d=this.joinInfo)!==null&&d!==void 0&&d.apGatewayAddress?(CN.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(l=this.joinInfo)!==null&&l!==void 0&&l.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(d){await this.signal.request(N5.SET_PARAMETER,{enablePublishAudioFilter:d})}}let Doe=0,Ele=0;function rJ(s,d,l,f){return new u5((b,k)=>{d.timeout=d.timeout||_H("HTTP_CONNECT_TIMEOUT"),d.responseType=d.responseType||"json",d.data&&!l?(d.data=JSON.stringify(d.data),Doe+=xJ(d.data)):l&&(d.data.size?Doe+=d.data.size:d.data instanceof FormData?Doe+=Lme(d.data):Doe+=xJ(JSON.stringify(d.data))),d.headers=d.headers||{},d.headers["Content-Type"]=d.headers["Content-Type"]||"application/json",d.method="POST",d.url=s,F4.request(d).then(B=>{typeof B.data=="string"?Ele+=xJ(B.data):B.data instanceof ArrayBuffer||B.data instanceof Uint8Array?Ele+=B.data.byteLength:Ele+=xJ(JSON.stringify(B.data)),f&&b({data:B.data,headers:B.headers}),b(B.data)}).catch(B=>{F4.isCancel(B)?k(new LH(dH.OPERATION_ABORTED,"cancel token canceled")):B.code==="ECONNABORTED"?k(new LH(dH.NETWORK_TIMEOUT,B.message)):B.response?k(new LH(dH.NETWORK_RESPONSE_ERROR,B.response.status)):k(new LH(dH.NETWORK_ERROR,B.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var s;function d(qH){var o5=0;return function(){return o5<qH.length?{done:!1,value:qH[o5++]}:{done:!0}}}var l=typeof Object.defineProperties=="function"?Object.defineProperty:function(qH,o5,g5){return qH==Array.prototype||qH==Object.prototype||(qH[o5]=g5.value),qH},f,b=function(qH){qH=[typeof globalThis=="object"&&globalThis,qH,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var o5=0;o5<qH.length;++o5){var g5=qH[o5];if(g5&&g5.Math==Math)return g5}throw Error("Cannot find global object")}(this);function k(qH,o5){if(o5)e:{var g5=b;qH=qH.split(".");for(var YH=0;YH<qH.length-1;YH++){var NW=qH[YH];if(!(NW in g5))break e;g5=g5[NW]}(o5=o5(YH=g5[qH=qH[qH.length-1]]))!=YH&&o5!=null&&l(g5,qH,{configurable:!0,writable:!0,value:o5})}}function B(qH){return(qH={next:qH})[Symbol.iterator]=function(){return this},qH}function Wt(qH){var o5=typeof Symbol<"u"&&Symbol.iterator&&qH[Symbol.iterator];return o5?o5.call(qH):{next:d(qH)}}if(k("Symbol",function(qH){function o5(NW,EH){this.A=NW,l(this,"description",{configurable:!0,writable:!0,value:EH})}if(qH)return qH;o5.prototype.toString=function(){return this.A};var g5="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",YH=0;return function NW(EH){if(this instanceof NW)throw new TypeError("Symbol is not a constructor");return new o5(g5+(EH||"")+"_"+YH++,EH)}}),k("Symbol.iterator",function(qH){if(qH)return qH;qH=Symbol("Symbol.iterator");for(var o5="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),g5=0;g5<o5.length;g5++){var YH=b[o5[g5]];typeof YH=="function"&&typeof YH.prototype[qH]!="function"&&l(YH.prototype,qH,{configurable:!0,writable:!0,value:function(){return B(d(this))}})}return qH}),typeof Object.setPrototypeOf=="function")f=Object.setPrototypeOf;else{var $O;e:{var uN={};try{uN.__proto__={a:!0},$O=uN.a;break e}catch{}$O=!1}f=$O?function(qH,o5){if(qH.__proto__=o5,qH.__proto__!==o5)throw new TypeError(qH+" is not extensible");return qH}:null}var lN=f;function _N(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function TN(qH){if(qH.m)throw new TypeError("Generator is already running");qH.m=!0}function vN(qH,o5){return qH.h=3,{value:o5}}function uH(qH){this.g=new _N,this.G=qH}function rH(qH,o5,g5,YH){try{var NW=o5.call(qH.g.j,g5);if(!(NW instanceof Object))throw new TypeError("Iterator result "+NW+" is not an object");if(!NW.done)return qH.g.m=!1,NW;var EH=NW.value}catch(RH){return qH.g.j=null,qH.g.s(RH),iH(qH)}return qH.g.j=null,YH.call(qH.g,EH),iH(qH)}function iH(qH){for(;qH.g.h;)try{var o5=qH.G(qH.g);if(o5)return qH.g.m=!1,{value:o5.value,done:!1}}catch(g5){qH.g.v=void 0,qH.g.s(g5)}if(qH.g.m=!1,qH.g.l){if(o5=qH.g.l,qH.g.l=null,o5.F)throw o5.D;return{value:o5.return,done:!0}}return{value:void 0,done:!0}}function lH(qH){this.next=function(o5){return qH.o(o5)},this.throw=function(o5){return qH.s(o5)},this.return=function(o5){return function(g5,YH){TN(g5.g);var NW=g5.g.j;return NW?rH(g5,"return"in NW?NW.return:function(EH){return{value:EH,done:!0}},YH,g5.g.return):(g5.g.return(YH),iH(g5))}(qH,o5)},this[Symbol.iterator]=function(){return this}}function hH(qH,o5){return o5=new lH(new uH(o5)),lN&&qH.prototype&&lN(o5,qH.prototype),o5}if(_N.prototype.o=function(qH){this.v=qH},_N.prototype.s=function(qH){this.l={D:qH,F:!0},this.h=this.C||this.u},_N.prototype.return=function(qH){this.l={return:qH},this.h=this.u},uH.prototype.o=function(qH){return TN(this.g),this.g.j?rH(this,this.g.j.next,qH,this.g.o):(this.g.o(qH),iH(this))},uH.prototype.s=function(qH){return TN(this.g),this.g.j?rH(this,this.g.j.throw,qH,this.g.o):(this.g.s(qH),iH(this))},k("Array.prototype.entries",function(qH){return qH||function(){return function(o5,g5){o5 instanceof String&&(o5+="");var YH=0,NW=!1,EH={next:function(){if(!NW&&YH<o5.length){var RH=YH++;return{value:g5(RH,o5[RH]),done:!1}}return NW=!0,{done:!0,value:void 0}}};return EH[Symbol.iterator]=function(){return EH},EH}(this,function(o5,g5){return[o5,g5]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var bH=function(qH,o5){for(var g5=0;g5<qH.length;g5++)o5(qH[g5])},PH=function(qH){return qH.replace(/\r?\n|\r/g,`\r
`)},OH=function(qH,o5,g5){return o5 instanceof Blob?(g5=g5!==void 0?g5+"":typeof o5.name=="string"?o5.name:"blob",o5.name===g5&&Object.prototype.toString.call(o5)!=="[object Blob]"||(o5=new File([o5],g5)),[String(qH),o5]):[String(qH),String(o5)]},wH=function(qH,o5){if(qH.length<o5)throw new TypeError(o5+" argument required, but only "+qH.length+" present.")},BH=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,XH=BH.FormData,d5=BH.XMLHttpRequest&&BH.XMLHttpRequest.prototype.send,p5=BH.Request&&BH.fetch,$5=BH.navigator&&BH.navigator.sendBeacon,e6=BH.Element&&BH.Element.prototype,N6=BH.Symbol&&Symbol.toStringTag;N6&&(Blob.prototype[N6]||(Blob.prototype[N6]="Blob"),"File"in BH&&!File.prototype[N6]&&(File.prototype[N6]="File"));try{new File([],"")}catch{BH.File=function(o5,g5,YH){return o5=new Blob(o5,YH||{}),Object.defineProperties(o5,{name:{value:g5},lastModified:{value:+(YH&&YH.lastModified!==void 0?new Date(YH.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),N6&&Object.defineProperty(o5,N6,{value:"File"}),o5}}var aK=function(qH){return qH.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},eK=function(qH){this.i=[];var o5=this;qH&&bH(qH.elements,function(g5){if(g5.name&&!g5.disabled&&g5.type!=="submit"&&g5.type!=="button"&&!g5.matches("form fieldset[disabled] *"))if(g5.type==="file"){var YH=g5.files&&g5.files.length?g5.files:[new File([],"",{type:"application/octet-stream"})];bH(YH,function(NW){o5.append(g5.name,NW)})}else g5.type==="select-multiple"||g5.type==="select-one"?bH(g5.options,function(NW){!NW.disabled&&NW.selected&&o5.append(g5.name,NW.value)}):g5.type==="checkbox"||g5.type==="radio"?g5.checked&&o5.append(g5.name,g5.value):(YH=g5.type==="textarea"?PH(g5.value):g5.value,o5.append(g5.name,YH))})};if((s=eK.prototype).append=function(qH,o5,g5){wH(arguments,2),this.i.push(OH(qH,o5,g5))},s.delete=function(qH){wH(arguments,1);var o5=[];qH=String(qH),bH(this.i,function(g5){g5[0]!==qH&&o5.push(g5)}),this.i=o5},s.entries=function qH(){var o5,g5=this;return hH(qH,function(YH){if(YH.h==1&&(o5=0),YH.h!=3)return o5<g5.i.length?YH=vN(YH,g5.i[o5]):(YH.h=0,YH=void 0),YH;o5++,YH.h=2})},s.forEach=function(qH,o5){wH(arguments,1);for(var g5=Wt(this),YH=g5.next();!YH.done;YH=g5.next()){var NW=Wt(YH.value);YH=NW.next().value,NW=NW.next().value,qH.call(o5,NW,YH,this)}},s.get=function(qH){wH(arguments,1);var o5=this.i;qH=String(qH);for(var g5=0;g5<o5.length;g5++)if(o5[g5][0]===qH)return o5[g5][1];return null},s.getAll=function(qH){wH(arguments,1);var o5=[];return qH=String(qH),bH(this.i,function(g5){g5[0]===qH&&o5.push(g5[1])}),o5},s.has=function(qH){wH(arguments,1),qH=String(qH);for(var o5=0;o5<this.i.length;o5++)if(this.i[o5][0]===qH)return!0;return!1},s.keys=function qH(){var o5,g5,YH,NW,EH=this;return hH(qH,function(RH){if(RH.h==1&&(o5=Wt(EH),g5=o5.next()),RH.h!=3)return g5.done?void(RH.h=0):(YH=g5.value,NW=Wt(YH),vN(RH,NW.next().value));g5=o5.next(),RH.h=2})},s.set=function(qH,o5,g5){wH(arguments,2),qH=String(qH);var YH=[],NW=OH(qH,o5,g5),EH=!0;bH(this.i,function(RH){RH[0]===qH?EH&&(EH=!YH.push(NW)):YH.push(RH)}),EH&&YH.push(NW),this.i=YH},s.values=function qH(){var o5,g5,YH,NW,EH=this;return hH(qH,function(RH){if(RH.h==1&&(o5=Wt(EH),g5=o5.next()),RH.h!=3)return g5.done?void(RH.h=0):(YH=g5.value,(NW=Wt(YH)).next(),vN(RH,NW.next().value));g5=o5.next(),RH.h=2})},eK.prototype._asNative=function(){for(var qH=new XH,o5=Wt(this),g5=o5.next();!g5.done;g5=o5.next()){var YH=Wt(g5.value);g5=YH.next().value,YH=YH.next().value,qH.append(g5,YH)}return qH},eK.prototype._blob=function(){var qH="----formdata-polyfill-"+Math.random(),o5=[],g5="--"+qH+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(YH,NW){return typeof YH=="string"?o5.push(g5+aK(PH(NW))+`"\r
\r
`+PH(YH)+`\r
`):o5.push(g5+aK(PH(NW))+'"; filename="'+aK(YH.name)+`"\r
Content-Type: `+(YH.type||"application/octet-stream")+`\r
\r
`,YH,`\r
`)}),o5.push("--"+qH+"--"),new Blob(o5,{type:"multipart/form-data; boundary="+qH})},eK.prototype[Symbol.iterator]=function(){return this.entries()},eK.prototype.toString=function(){return"[object FormData]"},e6&&!e6.matches&&(e6.matches=e6.matchesSelector||e6.mozMatchesSelector||e6.msMatchesSelector||e6.oMatchesSelector||e6.webkitMatchesSelector||function(qH){for(var o5=(qH=(this.document||this.ownerDocument).querySelectorAll(qH)).length;0<=--o5&&qH.item(o5)!==this;);return-1<o5}),N6&&(eK.prototype[N6]="FormData"),d5){var H4=BH.XMLHttpRequest.prototype.setRequestHeader;BH.XMLHttpRequest.prototype.setRequestHeader=function(qH,o5){H4.call(this,qH,o5),qH.toLowerCase()==="content-type"&&(this.B=!0)},BH.XMLHttpRequest.prototype.send=function(qH){qH instanceof eK?(qH=qH._blob(),this.B||this.setRequestHeader("Content-Type",qH.type),d5.call(this,qH)):d5.call(this,qH)}}p5&&(BH.fetch=function(qH,o5){return o5&&o5.body&&o5.body instanceof eK&&(o5.body=o5.body._blob()),p5.call(this,qH,o5)}),$5&&(BH.navigator.sendBeacon=function(qH,o5){return o5 instanceof eK&&(o5=o5._asNative()),$5.call(this,qH,o5)}),BH.FormData=eK}})();const Dne=()=>{const s=_H("AREAS");return s.length===0&&s.push(l6.GLOBAL),z4(s).call(s,(d,l,f)=>{const b=YSe(l);return b?f===0?b:"".concat(d,",").concat(b):d},"")},YSe=s=>s===l6.OVERSEA?"".concat(n4.ASIA,",").concat(n4.EUROPE,",").concat(n4.AFRICA,",").concat(n4.NORTH_AMERICA,",").concat(n4.SOUTH_AMERICA,",").concat(n4.OCEANIA):n4[s],koe={GLOBAL:{ASIA:[l6.CHINA,l6.JAPAN,l6.INDIA,l6.KOREA,l6.HKMC],EUROPE:[],NORTH_AMERICA:[l6.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Loe=Object.keys(koe[l6.GLOBAL]),mle=[l6.CHINA,l6.NORTH_AMERICA,l6.EUROPE,l6.ASIA,l6.JAPAN,l6.INDIA,l6.OCEANIA,l6.SOUTH_AMERICA,l6.AFRICA,l6.KOREA,l6.HKMC,l6.US],Fke=function(s,d){let l=[];if(a5(s).call(s,l6.GLOBAL)){const k=[l6.GLOBAL,l6.OVERSEA],B=Object.keys(voe);if(d===l6.GLOBAL)throw new LH(dH.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(d===l6.CHINA)l=[l6.OVERSEA];else if(b=d,a5(Loe).call(Loe,b)){const Wt=(f=d,koe[l6.GLOBAL][f]||[]),$O=[...k,d,...Wt];l=B.filter(uN=>!a5($O).call($O,uN))}else if(function(Wt){let $O=!1;return Loe.forEach(uN=>{var lN;a5(lN=koe[l6.GLOBAL][uN]).call(lN,Wt)&&($O=!0)}),$O}(d)){const Wt=function(uN){let lN;return Loe.forEach(_N=>{var TN;a5(TN=koe[l6.GLOBAL][_N]).call(TN,uN)&&(lN=_N)}),lN}(d),$O=[...k,Wt,d];l=B.filter(uN=>!a5($O).call($O,uN))}else l=s;l=function(Wt){const $O=[];return mle.forEach(uN=>{a5(Wt).call(Wt,uN)&&$O.push(uN)}),$O.concat(Wt.filter(uN=>!a5(mle).call(mle,uN)))}(l)}else l=s;var f,b;return l};function JSe(s){var d,l;if(!s&&a5(d=_H("AREAS")).call(d,l6.EXTENSIONS))return CN.debug("update area from ap : reset"),void gle(JDe,!0);if(!a5(l=_H("AREAS")).call(l,l6.GLOBAL)||!s)return;let f=voe.EXTENSIONS;f&&(f={CODE:YSe(l6.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(s,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(s,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(s,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(s,".agora.io"),"cds-ap-web-2-".concat(s,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(s,".agora.io"),"sua-ap-web-2-".concat(s,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(s,".agora.io"),"uap-ap-web-2-".concat(s,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(s,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(s,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(s,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(s,".agora.io")]},CN.debug("update area from ap success: ".concat(s,",config is "),f),S6("AREAS",[l6.EXTENSIONS],!0),Object.keys(f).map(b=>{b==="LOG_UPLOAD_SERVER"||b==="EVENT_REPORT_DOMAIN"||b==="EVENT_REPORT_BACKUP_DOMAIN"||b==="PROXY_SERVER_TYPE3"?S6(b,f[b][0]):S6(b,f[b])}))}function gle(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const l=T5.reportApiInvoke(null,{name:_K.SET_AREA,options:s,tag:Y6.TRACER});try{let f=[];if(typeof s=="string"&&(f=[s]),Array.isArray(s)&&(s.forEach(k=>{if(!a5(_Se).call(_Se,k))throw new LH(dH.INVALID_PARAMS,"invalid area code")}),f=s),Object.prototype.toString.call(s)==="[object Object]"){const{areaCode:k,excludedArea:B}=s;if(!k)throw new LH(dH.INVALID_PARAMS,"area code is needed");let Wt=k;typeof k=="string"&&(Wt=[k]),f=B?Fke(Wt,B):Wt}if(!d){if($Y.AREAS){const k=new LH(dH.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return l.onError(k),void CN.warning("setArea is prohibited because of config-distribute")}if(a5(f).call(f,l6.GLOBAL)&&_H("AREAS")===l6.EXTENSIONS){const k=new LH(dH.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return l.onError(k),void CN.warning("setArea is prohibited because of ap extensions")}}S6("AREAS",f,d);const b=(k=>{const B={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return k.map(Wt=>{const $O=voe[Wt],uN=Object.keys($O);uN&&uN.map(lN=>{lN!=="CODE"&&(B[lN]=B[lN].concat($O[lN]))})}),B})(f);Object.keys(b).map(k=>{k==="LOG_UPLOAD_SERVER"||k==="EVENT_REPORT_DOMAIN"||k==="EVENT_REPORT_BACKUP_DOMAIN"||k==="PROXY_SERVER_TYPE3"?S6(k,b[k][0]):S6(k,b[k])}),CN.debug("set area success:",f.join(","))}catch(f){throw l.onError(f),f}l.onSuccess()}function XSe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function WJ(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?XSe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):XSe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}let Tle=1;function jke(s,d,l,f,b){Tle+=1;const k={sid:l.sid,command:"convergeAllocateEdge",uid:"666",appId:l.appId,ts:Math.floor(Date.now()/1e3),seq:Tle,requestId:Tle,version:q8,cname:l.cname},B={service_name:d,json_body:JSON.stringify(k)};let Wt,$O,uN=s[0];return ZY(async()=>{Wt=Date.now();const lN=await rJ(uN,{data:B,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if($O=Date.now()-Wt,lN.code!==0){const vN=new LH(dH.UNEXPECTED_RESPONSE,"live streaming ap error, code"+lN.code,{retry:!0,responseTime:$O});throw CN.error(vN.toString()),vN}const _N=JSON.parse(lN.json_body);if(_N.code!==200){const vN=new LH(dH.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_N.code,", reason: ").concat(_N.reason),{code:_N.code,responseTime:$O});throw CN.error(vN.toString()),vN}if(!_N.servers||_N.servers.length===0){const vN=new LH(dH.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_N.code,responseTime:$O});throw CN.error(vN.toString()),vN}const TN=function(vN,uH){return{addressList:vN.servers.map(rH=>"wss://".concat(rH.address.replace(/\./g,"-"),".").concat(_H("WORKER_DOMAIN"),":").concat(rH.wss,"?serviceName=").concat(encodeURIComponent(uH))),workerToken:vN.workerToken,vid:vN.vid}}(_N,d);return _H("LIVE_STREAMING_ADDRESS")&&(TN.addressList=_H("LIVE_STREAMING_ADDRESS")instanceof Array?_H("LIVE_STREAMING_ADDRESS"):[_H("LIVE_STREAMING_ADDRESS")]),WJ(WJ({},TN),{},{responseTime:$O})},(lN,_N)=>(T5.apworkerEvent(l.sid,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(lN.addressList),firstSuccess:_N===0,responseTime:$O,serverIp:s[_N%s.length]}),!1),(lN,_N)=>(T5.apworkerEvent(l.sid,{success:!1,sc:lN.data&&lN.data.code||200,serviceName:d,responseTime:$O,serverIp:s[_N%s.length]}),!!(lN.code!==dH.OPERATION_ABORTED&&lN.code!==dH.UNEXPECTED_RESPONSE||lN.data&&lN.data.retry)&&(uN=s[(_N+1)%s.length],!0)),b)}let Sle=1;function QSe(s,d,l,f){let{url:b,areaCode:k}=s;const{clientId:B,sid:Wt}=d,$O=Date.now();let uN;const lN=d.role,[_N,TN]=Rle(d,k,[dK.CHOOSE_SERVER]);let vN=uK.networkState;return ZY(async()=>{vN&&uK.networkState===l8.OFFLINE&&uK.onlineWaiter&&await u5.race([uK.onlineWaiter,BK(f&&f.maxRetryTimeout||EK.maxRetryTimeout)]),vN=uK.networkState;const{data:uH,headers:rH}=await rJ(b,{data:_N,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);uN=rH.http3==="1"?1:-1,T5.reportResourceTiming(b,Wt),$Se(uH,b,d,$O,[dK.CHOOSE_SERVER],uN);const iH=One(uH,dK.CHOOSE_SERVER);return yle(iH),dle(iH,b)},uH=>(uH&&T5.joinChooseServer(Wt,{role:lN,lts:$O,succ:!0,csAddr:b,opid:TN,serverList:uH.gatewayAddrs.map(rH=>rH.address),ec:null,cid:uH.cid.toString(),uid:uH.uid.toString(),csIp:uH.csIp,unilbsServerIds:[dK.CHOOSE_SERVER].toString(),isHttp3:uN,corssRegionTagReq:d.apRequestDetail,corssRegionTagRes:uH.res.detail&&uH.res.detail[38]}),!1),uH=>uH.code!==dH.OPERATION_ABORTED&&(uH.code===dH.CAN_NOT_GET_GATEWAY_SERVER?uH.data.retry:(T5.joinChooseServer(Wt,{role:lN,lts:$O,succ:!1,csAddr:b,serverList:null,opid:TN,ec:uH.code,csIp:uH.data&&uH.data.csIp,unilbsServerIds:[dK.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:vN}),isHttp3:uN,corssRegionTagReq:d.apRequestDetail}),CN.warning("[".concat(B||"sid-".concat(Wt.slice(0,6)),"] Choose server network error, retry"),uH),!0)),f)}function ZSe(s,d,l,f){let b,{url:k,areaCode:B,serviceIds:Wt}=s;const $O=Date.now(),uN=d.role,[lN,_N]=Rle(d,B,Wt);let TN;return ZY(async()=>{TN&&uK.networkState===l8.OFFLINE&&uK.onlineWaiter&&await u5.race([uK.onlineWaiter,BK(f&&f.maxRetryTimeout||EK.maxRetryTimeout)]),TN=uK.networkState;const{data:vN,headers:uH}=await rJ(k,{data:lN,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);b=uH.http3==="1"?1:-1,T5.reportResourceTiming(k,d.sid),$Se(vN,k,d,$O,Wt,b);const rH=One(vN,dK.CHOOSE_SERVER),iH=One(vN,d.cloudProxyServer==="proxy5"?dK.CLOUD_PROXY_5:d.cloudProxyServer==="proxy3"||d.cloudProxyServer==="proxy4"?dK.CLOUD_PROXY:dK.CLOUD_PROXY_FALLBACK);return yle(rH),{gatewayInfo:dle(rH,k),proxyInfo:iH,url:k}},vN=>(vN.gatewayInfo&&T5.joinChooseServer(d.sid,{role:uN,lts:$O,succ:!0,csAddr:k,serverList:vN.gatewayInfo.gatewayAddrs.map(uH=>uH.address),ec:null,opid:_N,cid:vN.gatewayInfo.cid.toString(),uid:vN.gatewayInfo.uid.toString(),csIp:vN.gatewayInfo.csIp,unilbsServerIds:Wt.toString(),isHttp3:b,corssRegionTagReq:d.apRequestDetail,corssRegionTagRes:vN.gatewayInfo.res.detail&&vN.gatewayInfo.res.detail[38]}),vN.proxyInfo&&T5.joinWebProxyAP(d.sid,{lts:$O,sucess:1,apServerAddr:k,turnServerAddrList:vN.proxyInfo.addresses.map(uH=>uH.ip).join(","),errorCode:null,eventType:d.cloudProxyServer,unilbsServerIds:Wt.toString()}),!1),vN=>vN.code!==dH.OPERATION_ABORTED&&(vN.code===dH.CAN_NOT_GET_GATEWAY_SERVER?vN.data.retry:(T5.joinWebProxyAP(d.sid,{lts:$O,sucess:0,apServerAddr:k,turnServerAddrList:null,errorCode:vN.code,eventType:d.cloudProxyServer,unilbsServerIds:Wt.toString(),extend:JSON.stringify({networkState:TN})}),CN.warning("[".concat(d.clientId,"] multi unilbs network error, retry"),vN),!0)),f)}const $Se=(s,d,l,f,b,k)=>{const{sid:B,clientId:Wt,cloudProxyServer:$O}=l,uN=[],lN=_N=>{_N.flag===4096?T5.joinChooseServer(B,{role:l.role,lts:f,succ:!1,csAddr:d,opid:s.opid,serverList:null,ec:_N.error.message,csIp:_N.error.data&&_N.error.data.csIp,unilbsServerIds:b.toString(),isHttp3:k,corssRegionTagReq:l.apRequestDetail}):_N.flag!==1048576&&_N.flag!==4194304&&_N.flag!==4194310||T5.joinWebProxyAP(B,{lts:f,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:_N.error.code,eventType:$O,unilbsServerIds:b.toString()})};if(s.response_body.forEach(_N=>{const TN=_N.buffer.code;if(_N.uri===23&&TN===0&&!_N.buffer.edges_services)if(_N.buffer.flag===4194310)CN.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_N.buffer.edges_services=[];else{const vN={error:new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:s.detail[502]}),flag:_N.buffer.flag};uN.push(vN),lN(vN)}if(TN!==0){const vN=J$(TN),uH={error:new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,vN.desc,{desc:vN.desc,retry:vN.retry,csIp:s.detail[502]}),flag:_N.buffer.flag};_N.buffer.flag===4194310?CN.warning(uH.error.toString()):uN.push(uH),lN(uH)}}),uN.length)throw CN.warning("[".concat(Wt||"sid-".concat(B.slice(0,6)),"] multi unilbs ").concat(d," failed, ").concat(uN.map(_N=>"flag: ".concat(_N.flag,", message: ").concat(_N.error.message,", retry: ").concat(_N.error.data.retry)).join(" | "))),new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,uN.map(_N=>"flag: ".concat(_N.flag,", message: ").concat(_N.error.message)).join(" | "),{retry:!!uN.find(_N=>_N.error.data.retry),csIp:s.detail[502],desc:[...new Set(uN.map(_N=>{var TN;return _N==null||(TN=_N.error)===null||TN===void 0||(TN=TN.data)===null||TN===void 0?void 0:TN.desc}).filter(_N=>!!_N))]})},yle=s=>{var d,l,f,b;if(s.addresses&&s.addresses.length===0&&s.code===0)throw new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:s.detail&&s.detail[502]});if(_H("AP_AREA")&&((f=s.detail)!==null&&f!==void 0&&f[23]&&typeof((b=s.detail)===null||b===void 0?void 0:b[23])=="string"?JSe(s.detail[23].toLowerCase()):JSe()),(d=s.detail)!==null&&d!==void 0&&d[19]&&typeof((l=s.detail)===null||l===void 0?void 0:l[19])=="string"){const B=s.detail[19],Wt=B==null?void 0:B.split(";");for(let $O=0;$O<Wt.length;$O++){var k;const uN=p4(k=Wt[$O]).call(k);s.addresses[$O]&&Wt&&(s.addresses[$O].fingerprint=uN)}}if(_H("GATEWAY_ADDRESS")&&_H("GATEWAY_ADDRESS").length>0){CN.debug("assign gateway address to",_H("GATEWAY_ADDRESS"));const B=_H("GATEWAY_ADDRESS").map(Wt=>{var $O,uN;const lN=($O=(uN=s.addresses.find(_N=>_N.ip===Wt.ip&&_N.port===Wt.port))===null||uN===void 0?void 0:uN.fingerprint)!==null&&$O!==void 0?$O:"";return{ip:Wt.ip,port:Wt.port,ticket:s.addresses[0]&&s.addresses[0].ticket,fingerprint:lN}});s.addresses=B}},Bke=(s,d)=>{if(s.response_body&&s.response_body.length){const l=s.response_body[0];if(l.buffer.code!==0){const f=J$(l.buffer.code);throw new LH(dH.UPDATE_TICKET_FAILED,"[".concat(l.buffer.code,"]: ").concat(f.desc),{retry:f.retry})}return l.buffer.ticket}throw CN.debug("update ticket request received ap response without response body:",d),new LH(dH.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Rle=(s,d,l)=>{const f=Math.floor(Math.random()*1e12),b=s.role==="host"?"1":s.role==="audience"?"2":void 0,k={appid:s.appId,client_ts:Date.now(),opid:f,sid:s.sid,request_bodies:[{uri:22,buffer:{cname:s.cname,detail:WJ(WJ(WJ({6:s.stringUid,11:d,12:_H("USE_NEW_TOKEN")?"1":void 0},b?{17:b}:{}),{},{22:d},s.apRequestDetail?{33:s.apRequestDetail}:{}),s.apRTM?{26:"RTM2"}:{}),key:s.token,service_ids:l,uid:s.uid||0}}]};k.request_bodies.forEach(Wt=>{s.multiIP&&s.multiIP.gateway_ip&&(Wt.buffer.detail[5]=JSON.stringify({vocs_ip:[s.multiIP.uni_lbs_ip],vos_ip:[s.multiIP.gateway_ip]}))});const B=new FormData;return B.append("request",JSON.stringify(k)),[B,f]},Gke=(s,d)=>{const l=Math.floor(Math.random()*1e12),f={appid:s.appId,client_ts:Date.now(),opid:l,sid:s.sid,request_bodies:[{uri:28,buffer:{cname:s.cname,detail:{1:"",6:s.stringUid,12:"1"},token:s.token,service_ids:d,uid:s.uid||0,edges_services:s.apResponse.addresses.map(k=>({ip:k.ip,port:k.port}))}}]},b=new FormData;return b.append("request",JSON.stringify(f)),[b,l]};let eee=0;function tee(s){return u5.all(s.map(d=>d.then(l=>{throw l},l=>l))).then(d=>{throw d},d=>d)}const kne=async s=>{let{fragementLength:d,referenceList:l,asyncMapHandler:f,allFailedhandler:b,promisesCollector:k}=s,B=0;const Wt=d;let $O,uN=0;const lN=async()=>{const _N=(()=>{const TN=B*Wt,vN=TN+Wt;return l.slice(TN,vN).map(f)})();k&&k.push(..._N);try{$O=await tee(_N)}catch(TN){if(uN+=Wt,B++,!(uN>=l.length))return void await lN();b(TN)}_N.forEach(TN=>TN.cancel())};return await lN(),$O},eye=async s=>{let{referenceList:d,asyncMapHandler:l,closeFn:f}=s;const b=d.length;let k=0;const B=async()=>{const Wt=l(d.shift());try{return await Wt}catch($O){if(k++,k>=b||f!=null&&f($O))throw $O;return B()}};return B()};async function ble(s,d,l,f){return{gatewayInfo:await async function(k,B,Wt,$O){let uN=null;const lN=[],_N=async()=>{const vN=_H("WEBCS_DOMAIN").slice(0,_H("AJAX_REQUEST_CONCURRENT")).map(iH=>({url:k.proxyServer?"https://".concat(k.proxyServer,"/ap/?url=").concat(iH+"/api/v2/transpond/webrtc?v=2"):"https://".concat(iH,"/api/v2/transpond/webrtc?v=2"),areaCode:Dne()})),uH=$O.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:vN.map(iH=>iH.url)}),rH=await kne({fragementLength:_H("FRAGEMENT_LENGTH"),referenceList:vN,asyncMapHandler:iH=>(CN.debug("[".concat(k.clientId,"] Connect to choose_server:"),iH.url),QSe(iH,k,B,Wt)),allFailedhandler:iH=>{throw $O.recordJoinChannelService({endTs:Date.now(),status:"error",errors:iH},uH),iH[0]},promisesCollector:lN});return $O.recordJoinChannelService({endTs:Date.now(),status:"success"},uH),rH},TN=async()=>{if(await BK(1e3),uN!==null)return uN;const vN=_H("WEBCS_DOMAIN_BACKUP_LIST").map(iH=>({url:k.proxyServer?"https://".concat(k.proxyServer,"/ap/?url=").concat(iH+"/api/v2/transpond/webrtc?v=2"):"https://".concat(iH,"/api/v2/transpond/webrtc?v=2"),areaCode:Dne()})),uH=$O.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:vN.map(iH=>iH.url)}),rH=await kne({fragementLength:_H("FRAGEMENT_LENGTH"),referenceList:vN,asyncMapHandler:iH=>(CN.debug("[".concat(k.clientId,"] Connect to backup choose_server:"),iH.url),QSe(iH,k,B,Wt)),allFailedhandler:iH=>{throw $O.recordJoinChannelService({endTs:Date.now(),status:"error",errors:iH},uH),iH[0]},promisesCollector:lN});return $O.recordJoinChannelService({endTs:Date.now(),status:"success"},uH),rH};try{return uN=await tee([_N(),TN()]),lN.length&&lN.forEach(vN=>vN.cancel&&typeof vN.cancel=="function"&&vN.cancel()),uN}catch(vN){throw vN[0]}}(s,d,l,f)}}async function tye(s,d,l,f,b){const k=s.cloudProxyServer;if(k==="disabled"){if(s.useLocalAccessPoint)return await ble(s,d,l,b);if(_H("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:TN,proxyInfo:vN}=await iye(s,d,l,b);if(s.turnServer&&s.turnServer.mode!=="auto")return{gatewayInfo:TN};const uH=vN.map(rH=>({turnServerURL:rH.address,tcpport:rH.tcpport||JK.tcpport,udpport:rH.udpport||JK.udpport,username:rH.username||JK.username,password:rH.password||JK.password,forceturn:!1,security:!0}));if(b.useP2P){var B;const rH=(B=s.uid)!==null&&B!==void 0?B:TN.uid,iH="glb:".concat(rH.toString()),lH=await mde(iH),hH=vN.map(bH=>({turnServerURL:bH.address,tcpport:bH.tcpport||JK.tcpport,udpport:bH.udpport||JK.udpport,username:iH,password:lH,forceturn:!1,security:!0}));uH.push(...hH)}return s.turnServer={mode:"manual",servers:uH},{gatewayInfo:TN}}return await ble(s,d,l,b)}const{proxyInfo:Wt,gatewayInfo:$O}=await iye(s,d,l,b),uN={gatewayInfo:$O},lN=Wt.map(TN=>({turnServerURL:TN.address,tcpport:k==="proxy3"?void 0:TN.tcpport?TN.tcpport:JK.tcpport,udpport:k==="proxy4"?void 0:TN.udpport?TN.udpport:JK.udpport,username:TN.username||JK.username,password:TN.password||JK.password,forceturn:k!=="proxy4",security:k==="proxy5"}));if(b.useP2P){var _N;const TN=(_N=s.uid)!==null&&_N!==void 0?_N:$O.uid,vN="glb:".concat(TN.toString()),uH=await mde(vN),rH=Wt.map(iH=>({turnServerURL:iH.address,tcpport:k==="proxy3"?void 0:iH.tcpport||JK.tcpport,udpport:k==="proxy4"?void 0:iH.udpport||JK.udpport,username:vN,password:uH,forceturn:k!=="proxy4",security:k==="proxy5"}));lN.push(...rH)}return s.turnServer={mode:"manual",servers:lN},CN.debug("[".concat(s.clientId,"] set proxy server: ").concat(s.proxyServer,", mode: ").concat(k)),uN}async function nye(s,d,l,f,b){const k=_H("ACCOUNT_REGISTER").slice(0,_H("AJAX_REQUEST_CONCURRENT"));let B=[];B=d.proxyServer?k.map($O=>"https://".concat(d.proxyServer,"/ap/?url=").concat($O+"/api/v1")):k.map($O=>"https://".concat($O,"/api/v1"));const Wt=b==null?void 0:b.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:B});try{const $O=await async function(uN,lN,_N,TN,vN){const uH=Date.now(),rH={sid:_N.sid,opid:10,appid:_N.appId,string_uid:lN};let iH=uN[0];const lH=await ZY(()=>rJ(iH+"".concat(iH.indexOf("?")===-1?"?":"&","action=stringuid"),{data:rH,cancelToken:TN,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(hH,bH)=>{if(hH.code===0){if(hH.uid<=0||hH.uid>=Math.pow(2,32))throw CN.error("Invalid Uint Uid ".concat(lN," => ").concat(hH.uid),hH),T5.reqUserAccount(rH.sid,{lts:uH,success:!1,serverAddr:iH,stringUid:rH.string_uid,uid:hH.uid,errorCode:dH.INVALID_UINT_UID_FROM_STRING_UID,extend:rH}),new LH(dH.INVALID_UINT_UID_FROM_STRING_UID);return T5.reqUserAccount(rH.sid,{lts:uH,success:!0,serverAddr:iH,stringUid:rH.string_uid,uid:hH.uid,errorCode:null,extend:rH}),!1}const PH=J$(hH.code);return PH.retry&&(iH=uN[(bH+1)%uN.length]),T5.reqUserAccount(rH.sid,{lts:uH,success:!1,serverAddr:iH,stringUid:rH.string_uid,uid:hH.uid,errorCode:PH.desc,extend:rH}),PH.retry},(hH,bH)=>hH.code!==dH.OPERATION_ABORTED&&(T5.reqUserAccount(rH.sid,{lts:uH,success:!1,serverAddr:iH,stringUid:rH.string_uid,uid:null,errorCode:hH.code,extend:rH}),iH=uN[(bH+1)%uN.length],!0),vN);if(lH.code!==0){const hH=J$(lH.code);throw new LH(dH.UNEXPECTED_RESPONSE,hH.desc)}return lH}(B,s,d,l,f);return b==null||b.recordJoinChannelService({status:"success",endTs:Date.now()},Wt),$O.uid}catch($O){throw b==null||b.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[$O]},Wt),$O}}async function Wke(s,d,l){const f=_H("ACCOUNT_REGISTER");let b=[];b=d.proxyServer?f.map(k=>"https://".concat(d.proxyServer,"/ap/?url=").concat(k+"/api/v1")):f.map(k=>"https://".concat(k,"/api/v1"));try{return await eye({referenceList:b,asyncMapHandler:B=>async function(Wt,$O,uN,lN){const _N=Date.now(),TN={sid:uN.sid,opid:10,appid:uN.appId,string_uid:$O};try{const vN=await rJ(Wt+"".concat(Wt.indexOf("?")===-1?"?":"&","action=stringuid"),{data:TN,cancelToken:lN,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(vN.code!==0){const uH=J$(vN.code);throw new LH(dH.UNEXPECTED_RESPONSE,"preload sua error:".concat(uH.desc),uH)}if(vN.uid<=0||vN.uid>=Math.pow(2,32))throw new LH(dH.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_N,url:Wt,req:TN,uid:vN.uid,elapse:Date.now()-_N}}catch(vN){throw vN}}(B,s,d,l),closeFn:B=>B.code===dH.OPERATION_ABORTED||B.code===dH.UNEXPECTED_RESPONSE&&!B.data.retry})}catch(k){throw k}}async function Hke(s,d,l){const f=_H("CDS_AP").slice(0,_H("AJAX_REQUEST_CONCURRENT")).map($O=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat($O+"/api/v1"):"https://".concat($O,"/api/v1?action=config")),b=f.map($O=>function(uN,lN,_N,TN){const vN=c6(),uH={flag:64,cipher_method:0,features:WJ(WJ(WJ(WJ(WJ({install_id:Ade(),device:vN.name,system:vN.os,system_general:navigator.userAgent,vendor:lN.appId,version:q8,cname:lN.cname,session_id:lN.sid,proxyServer:lN.proxyServer,sdk_type:Uke.WEB_RTC,browser_name:vN.name,browser_version:vN.version,user_agent:navigator.userAgent,channel_name:lN.cname},lN.stringUid&&{string_uid:lN.stringUid}),lN.uid&&{uid:lN.uid+""}),vN.os&&{os_name:vN.os}),vN.osVersion&&{os_version:vN.osVersion}),{},{detail:""})};return ZY(()=>rJ(uN,{data:uH,timeout:1e3,cancelToken:_N,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,rH=>rH.code!==dH.OPERATION_ABORTED,TN)}($O,s,d,l));let k=null,B=null,Wt={};try{k=await tee(b)}catch($O){if($O.code===dH.OPERATION_ABORTED)throw $O;B=$O}if(b.forEach($O=>$O.cancel()),T5.reportApiInvoke(s.sid,{name:_K.REQUEST_CONFIG_DISTRIBUTE,options:{error:B,res:k}}).onSuccess(),k&&k.test_tags)try{Wt=function($O){if(!$O.test_tags)return{};const uN=$O.test_tags,lN=Object.keys(uN),_N={};return lN.forEach(TN=>{var vN;const uH=p4(vN=TN.slice(4)).call(vN),rH=JSON.parse(uN[TN]),iH=rH[1];_N[uH]={tag:rH[0]||"",value:iH}}),_N}(k)}catch{}return Wt}async function rye(s,d){const l=_H("WEBCS_DOMAIN").concat(_H("WEBCS_DOMAIN_BACKUP_LIST")).map(f=>({url:"https://".concat(f,"/api/v2/transpond/webrtc?v=2"),areaCode:Dne(),serviceIds:[dK.CHOOSE_SERVER,dK.CLOUD_PROXY_FALLBACK]}));try{return await eye({referenceList:l,asyncMapHandler:b=>async function(k,B,Wt){let $O,{url:uN,areaCode:lN,serviceIds:_N}=k;const TN=Date.now(),[vN,uH]=Rle(B,lN,_N);let rH=uK.networkState;try{rH&&uK.networkState===l8.OFFLINE&&uK.onlineWaiter&&await u5.race([uK.onlineWaiter,BK(EK.maxRetryTimeout)]),rH=uK.networkState;const{data:iH,headers:lH}=await rJ(uN,{data:vN,cancelToken:Wt,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);$O=lH.http3==="1"?1:-1,(OH=>{const wH=[];if(OH.response_body.forEach(BH=>{const XH=BH.buffer.code;if(BH.uri===23&&XH===0&&!BH.buffer.edges_services)if(BH.buffer.flag===4194310)BH.buffer.edges_services=[];else{const d5={error:new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:OH.detail[502]}),flag:BH.buffer.flag};wH.push(d5)}if(XH!==0){const d5=J$(XH),p5={error:new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,d5.desc,{desc:d5.desc,retry:d5.retry,csIp:OH.detail[502]}),flag:BH.buffer.flag};BH.buffer.flag===4194310?CN.warning(p5.error.toString()):wH.push(p5)}}),wH.length)throw new LH(dH.CAN_NOT_GET_GATEWAY_SERVER,wH.map(BH=>"flag: ".concat(BH.flag,", message: ").concat(BH.error.message)).join(" | "),{retry:!!wH.find(BH=>BH.error.data.retry),csIp:OH.detail[502],desc:[...new Set(wH.map(BH=>{var XH;return BH==null||(XH=BH.error)===null||XH===void 0||(XH=XH.data)===null||XH===void 0?void 0:XH.desc}).filter(BH=>!!BH))]})})(iH);const bH=One(iH,dK.CHOOSE_SERVER),PH=One(iH,dK.CLOUD_PROXY_FALLBACK);return yle(bH),{gatewayInfo:dle(bH,uN),proxyInfo:PH,opid:uH,requestTime:TN,url:uN,isHttp3:$O,elapse:Date.now()-TN}}catch(iH){throw iH}}(b,s,d),closeFn:b=>b.code===dH.OPERATION_ABORTED||b.code===dH.CAN_NOT_GET_GATEWAY_SERVER&&!b.data.retry})}catch(f){throw f}}async function iye(s,d,l,f){const b=_H("PROXY_SERVER_TYPE3"),k=(vN,uH,rH)=>{let iH=rH||b;return Array.isArray(iH)&&(iH=uH%2==0?b[1]:b[0]),"https://".concat(iH,"/ap/?url=").concat(vN)};let B=null;const Wt=[],$O=async()=>{const vN=_H("WEBCS_DOMAIN").slice(0,_H("AJAX_REQUEST_CONCURRENT")).map((iH,lH)=>{let hH;return hH=s.cloudProxyServer==="disabled"&&s.proxyServer?k("".concat(iH,"/api/v2/transpond/webrtc?v=2"),lH,s.proxyServer):s.cloudProxyServer==="disabled"||s.cloudProxyServer==="fallback"?"https://".concat(iH,"/api/v2/transpond/webrtc?v=2"):k("".concat(iH,"/api/v2/transpond/webrtc?v=2"),lH),{url:hH,areaCode:Dne(),serviceIds:[dK.CHOOSE_SERVER,s.cloudProxyServer==="proxy5"?dK.CLOUD_PROXY_5:s.cloudProxyServer==="proxy3"||s.cloudProxyServer==="proxy4"?dK.CLOUD_PROXY:dK.CLOUD_PROXY_FALLBACK]}}),uH=f.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:vN.map(iH=>iH.url)}),rH=await kne({fragementLength:_H("FRAGEMENT_LENGTH"),referenceList:vN,asyncMapHandler:iH=>(CN.debug("[".concat(s.clientId,"] Connect to choose_server:"),iH.url),ZSe(iH,s,d,l)),allFailedhandler:iH=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:iH},uH),iH[0]},promisesCollector:Wt});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},uH),rH},uN=async()=>{if(await BK(1e3),B!==null)return B;const vN=_H("WEBCS_DOMAIN_BACKUP_LIST").map((iH,lH)=>{let hH;return hH=s.cloudProxyServer==="disabled"&&s.proxyServer?k("".concat(iH,"/api/v2/transpond/webrtc?v=2"),lH,s.proxyServer):s.cloudProxyServer==="disabled"||s.cloudProxyServer==="fallback"?"https://".concat(iH,"/api/v2/transpond/webrtc?v=2"):k("".concat(iH,"/api/v2/transpond/webrtc?v=2"),lH),{url:hH,areaCode:Dne(),serviceIds:[dK.CHOOSE_SERVER,s.cloudProxyServer==="proxy5"?dK.CLOUD_PROXY_5:s.cloudProxyServer==="proxy3"||s.cloudProxyServer==="proxy4"?dK.CLOUD_PROXY:dK.CLOUD_PROXY_FALLBACK]}}),uH=f.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:vN.map(iH=>iH.url)}),rH=await kne({fragementLength:_H("FRAGEMENT_LENGTH"),referenceList:vN,asyncMapHandler:iH=>(CN.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),iH.url),ZSe(iH,s,d,l)),allFailedhandler:iH=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:iH},uH),iH[0]},promisesCollector:Wt});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},uH),rH};let lN,_N,TN;try{({gatewayInfo:lN,proxyInfo:_N,url:TN}=await tee([$O(),uN()]))}catch(vN){throw vN[0]}if(Wt.length&&Wt.forEach(vN=>vN.cancel&&typeof vN.cancel=="function"&&vN.cancel()),!lN||!_N)throw new LH(dH.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(s.apUrl=TN,s.cloudProxyServer!=="disabled"&&Array.isArray(b)&&TN){const vN=/^https?:\/\/(.+?)(\/.*)?$/.exec(TN)[1];a5(b).call(b,vN)&&(s.proxyServer=vN,CN.setProxyServer(vN),T5.setProxyServer(vN))}return B={gatewayInfo:lN,proxyInfo:await ASe(_N,lN.uid)},B}async function qke(s,d,l){const f=_H("UAP_AP").slice(0,_H("AJAX_REQUEST_CONCURRENT")).map(k=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(k+"/api/v1?action=uap"):"https://".concat(k,"/api/v1?action=uap")),b=f.map(k=>function(B,Wt,$O,uN){const lN={command:"convergeAllocateEdge",sid:Wt.sid,appId:Wt.appId,token:Wt.token,ts:Date.now(),version:q8,cname:Wt.cname,uid:Wt.uid.toString(),requestId:Sle,seq:Sle};Sle+=1;const _N={service_name:"tele_channel",json_body:JSON.stringify(lN)};return ZY(async()=>{const TN=await rJ(B,{data:_N,cancelToken:$O,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(TN.code!==0){const uH=new LH(dH.UNEXPECTED_RESPONSE,"cross channel ap error, code"+TN.code,{retry:!0});throw CN.error(uH.toString()),uH}const vN=JSON.parse(TN.json_body);if(vN.code!==200){const uH=new LH(dH.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(vN.code,", reason: ").concat(vN.reason));throw CN.error(uH.toString()),uH}if(!vN.servers||vN.servers.length===0){const uH=new LH(dH.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw CN.error(uH.toString()),uH}return{vid:vN.vid,workerToken:vN.workerToken,addressList:(_H("CHANNEL_MEDIA_RELAY_SERVERS")||vN.servers).map(uH=>"wss://".concat(uH.address.replace(/\./g,"-"),".").concat(_H("WORKER_DOMAIN"),":").concat(uH.wss))}},void 0,TN=>!!(TN.code!==dH.OPERATION_ABORTED&&TN.code!==dH.UNEXPECTED_RESPONSE||TN.data&&TN.data.retry),uN)}(k,s,d,l));try{const k=await tee(b);return b.forEach(B=>B.cancel()),k}catch(k){throw k[0]}}async function Kke(s,d,l){let f=null;const b=[],k=async B=>{const Wt=_H(B?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map($O=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat($O+"/api/v2/transpond/webrtc?v=2"):"https://".concat($O,"/api/v2/transpond/webrtc?v=2"));return B&&(await BK(1e3),f!==null)?f:await kne({fragementLength:_H("FRAGEMENT_LENGTH"),referenceList:Wt,asyncMapHandler:$O=>(CN.debug("[".concat(s.clientId,"] update ticket, Connect to ").concat(B?"backup":""," choose_server:"),$O),function(uN,lN,_N,TN){const[vN]=Gke(lN,[dK.CHOOSE_SERVER]);let uH=uK.networkState;return ZY(async()=>{uH&&uK.networkState===l8.OFFLINE&&uK.onlineWaiter&&await u5.race([uK.onlineWaiter,BK(TN&&TN.maxRetryTimeout||EK.maxRetryTimeout)]),uH=uK.networkState;const rH=await rJ(uN,{data:vN,cancelToken:_N,headers:{"Content-Type":"multipart/form-data;"}},!0);return Bke(rH,uN)},()=>!1,rH=>rH.code!==dH.OPERATION_ABORTED&&(rH.code===dH.UPDATE_TICKET_FAILED?rH.data.retry:(CN.warning("[".concat(lN.clientId,"] update ticket network error, retry"),rH),!0)),TN)}($O,s,d,l)),allFailedhandler:$O=>{throw $O[0]},promisesCollector:b})};try{return f=await tee([k(!1),k(!0)]),b.length&&b.forEach(B=>B.cancel&&typeof B.cancel=="function"&&B.cancel()),f}catch(B){throw B[0]}}function sye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function vle(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?sye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):sye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}class zke extends W6{get isSuccess(){return!!this.configs}constructor(d,l){super(),cH(this,"configs",void 0),cH(this,"store",void 0),cH(this,"joinInfo",void 0),cH(this,"cancelToken",void 0),cH(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),cH(this,"interval",void 0),cH(this,"mutex",void 0),cH(this,"mutableParamsRead",!1),cH(this,"configCache",{}),cH(this,"limit_bitrate",void 0),this.mutex=new t4("config-distribute",d),this.store=l}startGetConfigDistribute(d,l){this.joinInfo=d,this.cancelToken=l,this.interval&&this.stopGetConfigDistribute(),_H("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},_H("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,T5.reportApiInvoke(null,{options:void 0,name:_K.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Y6.TRACER}).onSuccess(JSON.stringify($Y))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void CN.debug("[config-distribute] get config distribute interrupted have no joininfo");let d;const l=await this.mutex.lock();try{d=await Hke(this.joinInfo,this.cancelToken,this.retryConfig),CN.debug("[config-distribute] get config distribute",JSON.stringify(d));const f=function(b){var k;const B=nne(k=Object.keys(b).filter(uN=>/^webrtc_ng_global_parameter/.test(uN))).call(k);for(let uN=0;uN<B.length;uN++)for(let lN=B.length-1;lN>uN;lN--){const _N=B[lN],TN=b[_N].value;if(typeof TN.__priority=="number"){const vN=TN.__priority,uH=B[lN-1],rH=b[uH].value;if(typeof rH.__priority=="number"){if(!(vN>rH.__priority))continue;{const iH=_N;B[lN]=B[lN-1],B[lN-1]=iH}}else{const iH=_N;B[lN]=B[lN-1],B[lN-1]=iH}}}const Wt=Date.now();let $O={};return B.forEach(uN=>{const lN=b[uN].value.__expires;lN&&lN<=Wt||($O[uN]=b[uN])}),$O}(d);this.cacheGlobalParameterConfig(f),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=f}catch(f){const b=new LH(dH.NETWORK_RESPONSE_ERROR,f);CN.warning("[config-distribute] ".concat(b.toString()))}finally{l()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(d){ESe(d)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==d.id&&this.emit(Ine.UPDATE_BITRATE_LIMIT,d):this.emit(Ine.UPDATE_BITRATE_LIMIT,d))}getLowStreamConfigDistribute(){return this.limit_bitrate&&vle({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(d){try{const l={},f=Object.keys(d),b=[];f.forEach(k=>{const B=d[k].value;l[k]=B;const Wt=B.__id;if(Wt&&this.configCache[k]&&this.configCache[k].__id===Wt)return;const $O=B.__type,uN=d[k].value,lN=d[k].tag;let _N=0;$O?$O===Xme.REALTIME&&(_N=1):Object.keys(uN).some(TN=>Object.prototype.hasOwnProperty.call(Dde,TN)||!ele()&&Object.prototype.hasOwnProperty.call(noe,TN)?(_N=1,!0):void 0),b.push({tag:lN,isApplied:_N,feature:k,params:JSON.stringify(B)})}),b.forEach(k=>{let{tag:B,feature:Wt,params:$O,isApplied:uN}=k;this.store.sessionId&&T5.abTest(this.store.sessionId,{intSucc:1,isApplied:uN,tag:B,feature:Wt,params:$O,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=l}catch(l){CN.debug("handleABTestConfigDistribute error",l)}}cacheGlobalParameterConfig(d){const l=function(b){const k={};return Object.keys(b).forEach(B=>{const Wt=b[B].value,$O=Wt.__expires,uN=Wt.__type;Object.keys(Wt).forEach(lN=>{lN==="__id"||lN==="__type"||lN==="__priority"||lN==="__expires"||Object.prototype.hasOwnProperty.call(k,lN)||(k[lN]=vle(vle({value:Wt[lN]},$O&&{expires:$O}),uN&&{type:uN}))})}),k}(d);try{var f;const b=(f=l.LIMIT_BITRATE)===null||f===void 0?void 0:f.value;delete l.LIMIT_BITRATE,b&&ESe(b)&&this.handleBitrateLimit(b),this.limit_bitrate=b,this.handleGlobalParameterConfig(l),this.handleABTestConfigDistribute(d),function(Wt){try{const $O=Date.now();Object.keys(Wt).forEach(uN=>{const{value:lN,type:_N,expires:TN}=Wt[uN];TN&&TN<=$O||((_N===Xme.REALTIME||Object.prototype.hasOwnProperty.call(Dde,uN))&&($Y[uN]=lN,H6[uN]=lN,CN.debug("Update realtime parameters from config distribute",uN,lN)),_N||ele()||!Object.prototype.hasOwnProperty.call(noe,uN)||($Y[uN]=lN,H6[uN]=lN,CN.debug("Update gateway parameters from config distribute",uN,lN)))})}catch($O){CN.error("Error update config immediately: ".concat(Wt),$O.message)}}(l);const k=JSON.stringify(l),B=window.btoa(k);window.localStorage.setItem("websdk_ng_global_parameter",B),CN.debug("Caching global parameters ".concat(k))}catch(b){CN.error("Error caching global parameters:",b.message)}}handleGlobalParameterConfig(d){try{const l=Date.now();Object.keys(d).forEach(f=>{if(f==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(H6,f)){const{value:b,expires:k}=d[f];if(k&&k<=l)return;(function(B,Wt){try{return typeof B=="object"&&typeof Wt=="object"&&JSON.stringify(B)===JSON.stringify(Wt)}catch{return!1}})(H6[f],b)||($Y[f]=b,H6[f]=b,this.emit(Ine.UPDATE_CLIENT_ROLE_OPTIONS,b),CN.debug("Updating client role options: ".concat(JSON.stringify(b))))}})}catch(l){CN.error("Error handling global parameter config:",l.message)}}}class Yke extends W6{constructor(){super(...arguments),cH(this,"resultStorage",new Map)}setLocalAudioStats(d,l,f){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",d,this.checkAudioInputLevel(f,l)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",d,this.checkSendAudioBitrate(f,l))}setLocalVideoStats(d,l,f){this.record("SEND_VIDEO_BITRATE_TOO_LOW",d,this.checkSendVideoBitrate(f,l)),this.record("FRAMERATE_INPUT_TOO_LOW",d,this.checkFramerateInput(f,l)),this.record("FRAMERATE_SENT_TOO_LOW",d,this.checkFramerateSent(f))}setRemoteAudioStats(d,l){const f=d.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",f,this.checkAudioOutputLevel(l))}setRemoteVideoStats(d,l){const f=d.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",f,this.checkVideoDecode(l))}record(d,l,f){if(_H("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(d)||this.resultStorage.set(d,{result:[],isPrevNormal:!0});const b=this.resultStorage.get(d);if(b&&(b.result.push(f),b.result.length>=5)){var k;const B=a5(k=b.result).call(k,!0);b.isPrevNormal&&!B&&this.emit("exception",oye[d],d,l),!b.isPrevNormal&&B&&this.emit("exception",oye[d]+2e3,d+"_RECOVER",l),b.isPrevNormal=B,b.result=[]}}checkAudioOutputLevel(d){return!(d.receiveBitrate>0&&d.receiveLevel===0)}checkAudioInputLevel(d,l){return l instanceof SK&&!l.isActive||!!l.muted||d.sendVolumeLevel!==0}checkFramerateInput(d,l){let f=null;l._encoderConfig&&l._encoderConfig.frameRate&&(f=h8(l._encoderConfig.frameRate));const b=d.captureFrameRate;return!f||!b||!(f>10&&b<5||f<10&&f>=5&&b<=1)}checkFramerateSent(d){return!(d.captureFrameRate&&d.sendFrameRate&&d.captureFrameRate>5&&d.sendFrameRate<=1)}checkSendVideoBitrate(d,l){return!!l.muted||d.sendBitrate!==0}checkSendAudioBitrate(d,l){return l instanceof SK&&!l.isActive||!!l.muted||d.sendBitrate!==0}checkVideoDecode(d){return d.receiveBitrate===0||d.decodeFrameRate!==0}}const oye={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},r4=new class{markSubscribeStart(s,d){performance.mark("agora-web-sdk/".concat(s,"/subscribe-").concat(d))}markPublishStart(s,d){performance.mark("agora-web-sdk/".concat(s,"/publish-").concat(d))}measureFromSubscribeStart(s,d){const l=performance.getEntriesByName("agora-web-sdk/".concat(s,"/subscribe-").concat(d));if(l.length>0){const f=l[l.length-1];return Math.round(performance.now()-f.startTime)}return 0}measureFromPublishStart(s,d){const l=performance.getEntriesByName("agora-web-sdk/".concat(s,"/publish-").concat(d));if(l.length>0){const f=l[l.length-1];return Math.round(performance.now()-f.startTime)}return 0}};function aye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function wQ(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?aye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):aye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}class Lne{constructor(d){cH(this,"store",void 0),cH(this,"onStatsException",void 0),cH(this,"onUploadPublishDuration",void 0),cH(this,"onStatsChanged",void 0),cH(this,"localStats",new Map),cH(this,"remoteStats",new Map),cH(this,"updateStatsInterval",void 0),cH(this,"trafficStats",void 0),cH(this,"trafficStatsPeerList",[]),cH(this,"uplinkStats",void 0),cH(this,"exceptionMonitor",void 0),cH(this,"p2pChannel",void 0),cH(this,"scalabilityMode",toe.L1T1),cH(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=d,this.exceptionMonitor=new Yke,this.exceptionMonitor.on("exception",(l,f,b)=>{this.onStatsException&&this.onStatsException(l,f,b)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(JH.LocalAudioTrack)||wQ({},xde)}getLocalVideoTrackStats(){return this.localStats.get(JH.LocalVideoTrack)||wQ({},Vde)}getRemoteAudioTrackStats(d){const l=(k,B)=>{if(!this.trafficStats)return B;const Wt=this.trafficStats.peer_delay.find($O=>$O.peer_uid===k);return Wt&&(B.publishDuration=Wt.B_ppad+(Date.now()-this.trafficStats.timestamp)),B},f={};if(d){var b;const k=(b=this.remoteStats.get(d))===null||b===void 0?void 0:b.audioStats;k&&(f[d]=l(d,k))}else Array.from(this.remoteStats.entries()).forEach(k=>{let[B,{audioStats:Wt}]=k;Wt&&(f[B]=l(B,Wt))});return f}getRemoteNetworkQualityStats(d){const l={};if(d){var f;const b=(f=this.remoteStats.get(d))===null||f===void 0?void 0:f.networkStats;b&&(l[d]=b)}else Array.from(this.remoteStats.entries()).forEach(b=>{let[k,{networkStats:B}]=b;B&&(l[k]=B)});return l}getRemoteVideoTrackStats(d){const l=(k,B)=>{if(!this.trafficStats)return B;const Wt=this.trafficStats.peer_delay.find($O=>$O.peer_uid===k);return Wt&&(B.publishDuration=Wt.B_ppvd+(Date.now()-this.trafficStats.timestamp)),B},f={};if(d){var b;const k=(b=this.remoteStats.get(d))===null||b===void 0?void 0:b.videoStats;k&&(f[d]=l(d,k))}else Array.from(this.remoteStats.entries()).forEach(k=>{let[B,{videoStats:Wt}]=k;Wt&&(f[B]=l(B,Wt))});return f}getRTCStats(){let d=0,l=0,f=0,b=0;const k=this.localStats.get(JH.LocalAudioTrack);k&&(d+=k.sendBytes,l+=k.sendBitrate);const B=this.localStats.get(JH.LocalVideoTrack);B&&(d+=B.sendBytes,l+=B.sendBitrate);const Wt=this.localStats.get(JH.LocalVideoLowTrack);Wt&&(d+=Wt.sendBytes,l+=Wt.sendBitrate),this.remoteStats.forEach(uN=>{let{audioStats:lN,videoStats:_N}=uN;lN&&(f+=lN.receiveBytes,b+=lN.receiveBitrate),_N&&(f+=_N.receiveBytes,b+=_N.receiveBitrate)});let $O=1;return this.trafficStats&&($O+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:$O,SendBitrate:l,SendBytes:d,RecvBytes:f,RecvBitrate:b,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(d){this.localStats.set(d,void 0)}removeLocalStats(d){d?this.localStats.delete(d):this.localStats.clear()}addRemoteStats(d){this.remoteStats.set(d,{})}removeRemoteStats(d){d?this.remoteStats.delete(d):this.remoteStats.clear()}addP2PChannel(d){this.p2pChannel=d}updateTrafficStats(d){d.peer_delay=d.peer_delay.filter(l=>l.B_ppad!==void 0||l.B_ppvd!==void 0),d.peer_delay.filter(l=>this.trafficStatsPeerList.indexOf(l.peer_uid)===-1).forEach(l=>{var f;const b=(f=this.p2pChannel)===null||f===void 0?void 0:f.getRemoteMedia(l.peer_uid),k=b!=null&&b.videoSSRC?r4.measureFromSubscribeStart(this.store.clientId,b.videoSSRC):0,B=b!=null&&b.audioSSRC?r4.measureFromSubscribeStart(this.store.clientId,b.audioSSRC):0;l.B_ppad!==void 0&&l.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(l.peer_uid,l.B_ppad,l.B_ppvd,k>B?k:B),this.trafficStatsPeerList.push(l.peer_uid))}),this.trafficStats=d}updateUplinkStats(d){this.uplinkStats&&this.uplinkStats.B_fir!==d.B_fir&&CN.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(d.B_fir)),this.uplinkStats=d}static isRemoteVideoFreeze(d,l,f){if(!d)return!1;const b=!!f&&l.framesDecodeFreezeTime>f.framesDecodeFreezeTime,k=!f||l.framesDecodeCount>f.framesDecodeCount;return b||!k}static isRemoteAudioFreeze(d){return!!d&&d._isFreeze()}isLocalVideoFreeze(d){return!(!d.inputFrame||!d.sentFrame)&&d.inputFrame.frameRate>5&&d.sentFrame.frameRate<3}updateLocalStats(d){Array.from(this.localStats.entries()).forEach(l=>{let[f,b]=l;switch(f){case JH.LocalVideoTrack:case JH.LocalVideoLowTrack:{const B=b,Wt=wQ({},Vde),$O=d.getStats(),uN=d.getLocalMedia(f);if($O){const lN=$O.videoSend.find(_N=>_N.ssrc===(uN==null?void 0:uN.ssrcs[0].ssrcId));if(lN){const _N=d.getLocalVideoSize(),TN=d.getEncoderConfig(JH.LocalVideoTrack);lN.codec!=="H264"&&lN.codec!=="H265"&&lN.codec!=="VP8"&&lN.codec!=="VP9"&&lN.codec!=="AV1X"&&lN.codec!=="AV1"||(Wt.codecType=lN.codec),Wt.sendBytes=lN.bytes,Wt.sendBitrate=B?8*Math.max(0,Wt.sendBytes-B.sendBytes):0,lN.inputFrame?(Wt.captureFrameRate=lN.inputFrame.frameRate,Wt.captureResolutionHeight=lN.inputFrame.height,Wt.captureResolutionWidth=lN.inputFrame.width):_N&&(Wt.captureResolutionWidth=_N.width,Wt.captureResolutionHeight=_N.height),lN.sentFrame?(Wt.sendFrameRate=lN.sentFrame.frameRate,Wt.sendResolutionHeight=lN.sentFrame.height,Wt.sendResolutionWidth=lN.sentFrame.width):_N&&(Wt.sendResolutionWidth=_N.width,Wt.sendResolutionHeight=_N.height),lN.avgEncodeMs&&(Wt.encodeDelay=lN.avgEncodeMs),TN&&TN.bitrateMax&&(Wt.targetSendBitrate=1e3*TN.bitrateMax),Wt.sendPackets=lN.packets,Wt.sendPacketsLost=lN.packetsLost,Wt.sendJitterMs=lN.jitterMs,Wt.sendRttMs=lN.rttMs,Wt.totalDuration=B?B.totalDuration+1:1,Wt.totalFreezeTime=B?B.totalFreezeTime:0,this.isLocalVideoFreeze(lN)&&(Wt.totalFreezeTime+=1),lN.scalabilityMode&&this.scalabilityMode!==lN.scalabilityMode&&(CN.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(lN.scalabilityMode)),this.scalabilityMode=lN.scalabilityMode)}this.trafficStats&&(Wt.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var k;this.localStats.set(f,Wt),((B==null?void 0:B.sendResolutionWidth)!==Wt.sendResolutionWidth||(B==null?void 0:B.sendResolutionHeight)!==Wt.sendResolutionHeight)&&((k=this.onStatsChanged)===null||k===void 0||k.call(this,"resolution",{width:Wt.sendResolutionWidth,height:Wt.sendResolutionHeight})),Wt&&uN&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,uN.track,Wt);break}case JH.LocalAudioTrack:{const B=b,Wt=wQ({},xde),$O=d.getStats(),uN=d.getLocalMedia(f);if($O){const lN=$O.audioSend.find(_N=>_N.ssrc===(uN==null?void 0:uN.ssrcs[0].ssrcId));if(lN){if(lN.codec!=="opus"&&lN.codec!=="aac"&&lN.codec!=="PCMU"&&lN.codec!=="PCMA"&&lN.codec!=="G722"||(Wt.codecType=lN.codec),lN.inputLevel)Wt.sendVolumeLevel=Math.round(32767*lN.inputLevel);else{const _N=d.getLocalAudioVolume();_N&&(Wt.sendVolumeLevel=Math.round(32767*_N))}Wt.sendBytes=lN.bytes,Wt.sendPackets=lN.packets,Wt.sendPacketsLost=lN.packetsLost,Wt.sendJitterMs=lN.jitterMs,Wt.sendRttMs=lN.rttMs,Wt.sendBitrate=B?8*Math.max(0,Wt.sendBytes-B.sendBytes):0}}this.trafficStats&&(Wt.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(JH.LocalAudioTrack,Wt),Wt&&uN&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,uN.track,Wt);break}}})}updateRemoteStats(d){Array.from(this.remoteStats.entries()).forEach(l=>{var f,b;let[k,{videoStats:B,audioStats:Wt,videoPcStats:$O}]=l;const uN=Wt,lN=B,_N=$O,TN=wQ({},sge),vN=wQ({},oge),uH=wQ({},NDe),{audioTrack:rH,videoTrack:iH,audioSSRC:lH,videoSSRC:hH}=d.getRemoteMedia(k);let bH;bH=this.store.useP2P?d.getStats(!0):d.getStats();const PH=(f=bH)===null||f===void 0?void 0:f.audioRecv.find(XH=>XH.ssrc===lH),OH=(b=bH)===null||b===void 0?void 0:b.videoRecv.find(XH=>XH.ssrc===hH),wH=this.trafficStats&&this.trafficStats.peer_delay.find(XH=>XH.peer_uid===k);if(PH&&(PH.codec!=="opus"&&PH.codec!=="aac"&&PH.codec!=="PCMU"&&PH.codec!=="PCMA"&&PH.codec!=="G722"||(TN.codecType=PH.codec),PH.outputLevel?TN.receiveLevel=Math.round(32767*PH.outputLevel):rH&&(TN.receiveLevel=Math.round(32767*rH.getVolumeLevel())),TN.receiveBytes=PH.bytes,TN.receivePackets=PH.packets,TN.receivePacketsLost=PH.packetsLost,TN.receivePacketsDiscarded=PH.packetsDiscarded,TN.packetLossRate=TN.receivePacketsLost/(TN.receivePackets+TN.receivePacketsLost),TN.receiveBitrate=uN?8*Math.max(0,TN.receiveBytes-uN.receiveBytes):0,TN.totalDuration=uN?uN.totalDuration+1:1,TN.totalFreezeTime=uN?uN.totalFreezeTime:0,TN.freezeRate=TN.totalFreezeTime/TN.totalDuration,TN.receiveDelay=PH.jitterBufferMs,TN.totalDuration>10&&Lne.isRemoteAudioFreeze(rH)&&(TN.totalFreezeTime+=1)),OH){var BH;OH.codec!=="H264"&&OH.codec!=="H265"&&OH.codec!=="VP8"&&OH.codec!=="VP9"&&OH.codec!=="AV1X"&&OH.codec!=="AV1"||(vN.codecType=OH.codec),vN.receiveBytes=OH.bytes,vN.receiveBitrate=lN?8*Math.max(0,vN.receiveBytes-lN.receiveBytes):0,vN.decodeFrameRate=OH.decodeFrameRate<0?0:OH.decodeFrameRate,vN.renderFrameRate=OH.decodeFrameRate<0?0:OH.decodeFrameRate,OH.outputFrame&&(vN.renderFrameRate=OH.outputFrame.frameRate),OH.receivedFrame?(vN.receiveFrameRate=OH.receivedFrame.frameRate,vN.receiveResolutionHeight=OH.receivedFrame.height,vN.receiveResolutionWidth=OH.receivedFrame.width):iH&&(vN.receiveResolutionHeight=iH._videoHeight||0,vN.receiveResolutionWidth=iH._videoWidth||0),OH.framesRateFirefox!==void 0&&(vN.receiveFrameRate=Math.round(OH.framesRateFirefox)),vN.receivePackets=OH.packets,vN.receivePacketsLost=OH.packetsLost,vN.packetLossRate=vN.receivePacketsLost/(vN.receivePackets+vN.receivePacketsLost);const XH=lN?lN.totalFreezeTime:0,d5=lN?lN.totalDuration:0;vN.totalDuration=lN?lN.totalDuration+1:1,vN.totalFreezeTime=(BH=OH.totalFreezesDuration)!==null&&BH!==void 0?BH:XH||0,vN.receiveDelay=OH.jitterBufferMs||0;const p5=!!hH&&d.getRemoteVideoIsReady(hH);OH.totalFreezesDuration===void 0&&iH&&p5&&Lne.isRemoteVideoFreeze(iH,OH,_N)&&(vN.totalFreezeTime+=1),vN.freezeRate=Math.max(0,Math.min((vN.totalFreezeTime-XH)/(vN.totalDuration-d5),1))}wH&&(TN.end2EndDelay=wH.B_ad,vN.end2EndDelay=wH.B_vd,TN.transportDelay=wH.B_ed,vN.transportDelay=wH.B_ed,TN.currentPacketLossRate=wH.B_ealr4/100,vN.currentPacketLossRate=wH.B_evlr4/100,uH.uplinkNetworkQuality=wH.B_punq?wH.B_punq:0,uH.downlinkNetworkQuality=wH.B_pdnq?wH.B_pdnq:0),this.remoteStats.set(k,{audioStats:TN,videoStats:vN,videoPcStats:OH,networkStats:uH}),rH&&this.exceptionMonitor.setRemoteAudioStats(rH,TN),iH&&this.exceptionMonitor.setRemoteVideoStats(iH,vN)})}}class cye{constructor(){cH(this,"destChannelMediaInfos",new Map),cH(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(d){fSe(d),this.srcChannelMediaInfo=d}addDestChannelInfo(d){fSe(d),this.destChannelMediaInfos.set(d.channelName,d)}removeDestChannelInfo(d){yoe(d),this.destChannelMediaInfos.delete(d)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function uye(s){if(!(s instanceof cye))return new LH(dH.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const d=s.getSrcChannelMediaInfo(),l=s.getDestChannelMediaInfo();if(!d)return new LH(dH.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(l.size===0)return new LH(dH.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class GX{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(d,l){cH(this,"uid",void 0),cH(this,"_uintid",void 0),cH(this,"_trust_in_room_",!0),cH(this,"_trust_audio_enabled_state_",!0),cH(this,"_trust_video_enabled_state_",!0),cH(this,"_trust_audio_mute_state_",!0),cH(this,"_trust_video_mute_state_",!0),cH(this,"_audio_muted_",!1),cH(this,"_video_muted_",!1),cH(this,"_audio_enabled_",!0),cH(this,"_video_enabled_",!0),cH(this,"_audio_added_",!1),cH(this,"_video_added_",!1),cH(this,"_is_pre_created",!1),cH(this,"_video_pre_subscribed",!1),cH(this,"_audio_pre_subscribed",!1),cH(this,"_trust_video_stream_added_state_",!0),cH(this,"_trust_audio_stream_added_state_",!0),cH(this,"_audioTrack",void 0),cH(this,"_videoTrack",void 0),cH(this,"_dataChannels",[]),cH(this,"_audioSSRC",void 0),cH(this,"_videoSSRC",void 0),cH(this,"_audioOrtc",void 0),cH(this,"_videoOrtc",void 0),cH(this,"_cname",void 0),cH(this,"_rtxSsrcId",void 0),cH(this,"_videoMid",void 0),cH(this,"_audioMid",void 0),this.uid=d,this._uintid=l}}function dye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function lye(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?dye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):dye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const Mne="9",hye=4e4;let Jke=class{get localCapabilities(){return $6(this._localCapabilities)}get rtpCapabilities(){return $6(this._rtpCapabilities)}get candidates(){return $6(this._candidates)}get iceParameters(){return $6(this._iceParameters)}get dtlsParameters(){return $6(this._dtlsParameters)}constructor(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];cH(this,"sessionDesc",void 0),cH(this,"_localCapabilities",void 0),cH(this,"_rtpCapabilities",void 0),cH(this,"_candidates",void 0),cH(this,"_originCandidates",void 0),cH(this,"_iceParameters",void 0),cH(this,"_isUseExtmapAllowMixed",void 0),cH(this,"_dtlsParameters",void 0),cH(this,"setup",void 0),cH(this,"currentMidIndex",void 0),cH(this,"cname",void 0),cH(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=d,s=$6(s);const{iceParameters:l,dtlsParameters:f,candidates:b,rtpCapabilities:k,setup:B,localCapabilities:Wt,cname:$O}=s;this._rtpCapabilities=k,this._candidates=b,this._originCandidates=$6(b),this._iceParameters=l,this._dtlsParameters=f,this._localCapabilities=Wt,this.setup=B,this.cname=$O,this.sessionDesc=this.updateRemoteRTPCapabilities(k),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(s){const d=this.candidates,l=this.dtlsParameters,f=this.iceParameters,b=this.rtpCapabilities.send;let k=this.sessionDesc.mediaDescriptions.length-1;for(let B=1;B<s;B++){const Wt=2*B+2e4,$O=2*B+hye,{ssrcs:uN,ssrcGroups:lN}=CQ([{ssrcId:Wt}],this.cname),{ssrcs:_N,ssrcGroups:TN}=CQ([{ssrcId:$O,rtx:_H("USE_SUB_RTX")?$O+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Mne,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.videoCodecs.map(vN=>vN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:f.iceUfrag,icePwd:f.icePwd,unrecognized:[],candidates:d,extmaps:b.videoExtensions,fingerprints:l.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_N,ssrcGroups:TN,rtcpFeedbackWildcards:[],payloads:b.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++k)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Mne,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.audioCodecs.map(vN=>vN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:f.iceUfrag,icePwd:f.icePwd,unrecognized:[],candidates:d,extmaps:b.audioExtensions,fingerprints:l.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:uN,ssrcGroups:lN,rtcpFeedbackWildcards:[],payloads:b.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++k)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return UX(this.sessionDesc)}send(s,d,l,f){const{ssrcs:b,ssrcGroups:k}=CQ(d,this.cname,_H("SYNC_GROUP")?l:void 0),B=this.findPreloadMediaDesc(b);if(B){if(Z6()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,B.attributes.mid),f&&(f.twcc||f.remb)){const Wt=this.sessionDesc.mediaDescriptions.indexOf(B);return this.sessionDesc.mediaDescriptions[Wt]=this.mungSendMediaDesc(B,f),{mid:B.attributes.mid,needExchangeSDP:!0}}return{mid:B.attributes.mid,needExchangeSDP:!1}}{const Wt=this.findAvailableMediaIndex(s,b);let $O;return Wt===-1||Wt===1&&(KK()||function(){const uN=c6();return!(uN.name!==p6.CHROME||!uN.osVersion)&&Number(uN.version)<=90}()||_H("ENABLE_ENCODED_TRANSFORM")&&w7())||Wt===0&&_H("USE_SUB_RTX")||Sme()?($O=this.createOrRecycleSendMedia(s,b,k,"sendonly",f),this.updateBundleMids()):($O=$6(this.sessionDesc.mediaDescriptions[Wt]),$O.attributes.direction="sendonly",$O.attributes.ssrcs=b,$O.attributes.ssrcGroups=k,this.sessionDesc.mediaDescriptions[Wt]=this.mungSendMediaDesc($O,f)),Z6()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,$O.attributes.mid),{mid:$O.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:s,needExchangeSDP:d}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:s.attributes.mid,needExchangeSDP:d}}batchSend(s){const d=s.map(b=>{let{kind:k,ssrcMsg:B,mslabel:Wt}=b;return this.send(k,B,Wt)}),l=[];let f=!1;return d.forEach(b=>{let{mid:k,needExchangeSDP:B}=b;B&&(f=!0),l.push(k)}),{mids:l,needExchangeSDP:f}}stopSending(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>l.attributes.mid&&s.indexOf(l.attributes.mid)!==-1);if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");d.forEach(l=>{l.attributes.mid==="0"||Z6()||Sme()?l.attributes.ssrcs=[]:(l.attributes.ssrcs=[],l.attributes.direction="inactive",l.media.port="0")}),this.updateBundleMids()}mute(s){const d=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===s);if(!d)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.mute."));d.attributes.direction="inactive"}unmute(s){const d=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===s);if(!d)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.unmute."));d.attributes.direction="sendonly"}muteRemote(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>a5(s).call(s,l.attributes.mid||""));if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(l=>{l.attributes.direction="inactive"})}unmuteRemote(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>a5(s).call(s,l.attributes.mid||""));if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(l=>{l.attributes.direction="recvonly"})}receive(s,d,l,f){s.forEach((b,k)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",d,l,f[k])}),this.updateBundleMids()}stopReceiving(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>s.indexOf(l.attributes.mid)!==-1);if(d.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");d.forEach(l=>{l.media.port="0",l.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(s){const d=this.sessionDesc||$4((l=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(l?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var l;this._rtpCapabilities=s;const f=this.rtpCapabilities.send,b=this.localCapabilities.send;for(const k of d.mediaDescriptions){if(k.attributes.iceUfrag=this._iceParameters.iceUfrag,k.attributes.icePwd=this._iceParameters.icePwd,k.attributes.fingerprints=this._dtlsParameters.fingerprints,k.attributes.candidates=this._candidates,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"){if(f.videoCodecs.length===0){const B=b.videoCodecs.filter(Wt=>{var $O,uN;return($O=Wt.rtpMap)===null||$O===void 0?void 0:a5(uN=$O.encodingName.toLowerCase()).call(uN,"vp8")})||[b.videoCodecs[0]];k.media.fmts=B.map(Wt=>Wt.payloadType.toString(10)),k.attributes.payloads=B,k.attributes.extmaps=[]}else if(k.media.fmts=f.videoCodecs.map(B=>B.payloadType.toString(10)),k.attributes.payloads=f.videoCodecs,k.attributes.extmaps=f.videoExtensions,_H("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:B,ssrcGroups:Wt}=CQ([{ssrcId:hye,rtx:_H("USE_SUB_RTX")?40001:void 0}],this.cname);k.attributes.ssrcs=B,k.attributes.ssrcGroups=Wt}}if(k.media.mediaType==="audio"){if(f.audioCodecs.length===0){const B=b.audioCodecs.filter(Wt=>{var $O,uN;return($O=Wt.rtpMap)===null||$O===void 0?void 0:a5(uN=$O.encodingName.toLowerCase()).call(uN,"opus")})||[b.audioCodecs[0]];k.media.fmts=B.map(Wt=>Wt.payloadType.toString(10)),k.attributes.payloads=B,k.attributes.extmaps=[]}else if(k.media.fmts=f.audioCodecs.map(B=>B.payloadType.toString(10)),k.attributes.payloads=f.audioCodecs,k.attributes.extmaps=f.audioExtensions,$$(k),_H("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:B,ssrcGroups:Wt}=CQ([{ssrcId:2e4}],this.cname);k.attributes.ssrcs=B,k.attributes.ssrcGroups=Wt}}}return this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(s){const d=this._originCandidates.filter(f=>f.transport==="udp"),l=[];if(d.forEach(f=>{l.push(lye(lye({},f),{},{foundation:"tcpcandidate",priority:Number(f.priority)-1+"",transport:"tcp",port:Number(f.port)+90+""}))}),d.length!==0){switch(s){case d4.TCP_RELAY:this._candidates=l;break;case d4.UDP_TCP_RELAY:case d4.RELAY:this._candidates=[...d,...l];break;default:this._candidates=d}for(const f of this.sessionDesc.mediaDescriptions)f.attributes.candidates=this.candidates}}restartICE(s){s=$6(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.iceUfrag=s.iceUfrag,d.attributes.icePwd=s.icePwd})}predictReceivingMids(s){const d=[];for(let l=0;l<s;l++)d.push((this.currentMidIndex+l+1).toString(10));return d}findAvailableMediaIndex(s,d){return this.sessionDesc.mediaDescriptions.findIndex(l=>{const f=l.media.mediaType===s&&l.media.port!=="0"&&(l.attributes.direction==="sendonly"||l.attributes.direction==="sendrecv")&&l.attributes.ssrcs.length===0;if(Z6()){if(f){const b=this.firefoxSsrcMidMap.get(d[0].ssrcId);return!(b||l.attributes.mid!=="0"&&l.attributes.mid!=="1")||!(!b||b!==l.attributes.mid)}return!1}return f})}createOrRecycleDataChannel(){for(const l of this.sessionDesc.mediaDescriptions)if(l.media.mediaType==="application")return{mediaDesc:l,needExchangeSDP:!1};this.currentMidIndex+=1;const s="".concat(this.currentMidIndex),d={media:{mediaType:"application",port:Mne,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(s),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(d),{mediaDesc:d,needExchangeSDP:!0}}createOrRecycleRecvMedia(s,d,l,f,b,k){const B=s._mediaStreamTrack.kind,Wt=this.rtpCapabilities.recv,$O=Pne(B,Wt,this.localCapabilities.send,B===_5.VIDEO?f:b),uN=B===_5.VIDEO?Wt.videoExtensions:Wt.audioExtensions;this.currentMidIndex+=1;const lN="".concat(this.currentMidIndex);let _N={media:{mediaType:B,port:Mne,protos:["UDP","TLS","RTP","SAVPF"],fmts:$O.map(vN=>vN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:uN,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:$O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(lN)}};_N=this.mungRecvMediaDsec(_N,s,k);const TN=this.findFirstClosedMedia(B);if(TN){const vN=this.sessionDesc.mediaDescriptions.indexOf(TN);this.sessionDesc.mediaDescriptions[vN]=_N}else this.sessionDesc.mediaDescriptions.push(_N);return _N}updateRemoteCodec(s,d,l){const f=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_N=>_N.rtpMap&&_N.rtpMap.encodingName.toLowerCase()||"").filter(_N=>{var TN;return a5(TN=Object.keys(roe)).call(TN,_N)}))],b=new Set(d);if(f.every(_N=>b.has(_N)))return CN.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(d)),!1;const k=this._rtpCapabilities.recv.videoCodecs.filter(_N=>d.some(TN=>{var vN;return a5(vN=_N.rtpMap&&_N.rtpMap.encodingName.toLowerCase()||"").call(vN,TN)}));if(k.length===0)return CN.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(f," codecs: ").concat(d)),!1;const B=[...new Set(k.map(_N=>_N.rtpMap&&_N.rtpMap.encodingName.toLowerCase()||""))];let Wt;if(CN.debug("updateRemoteCodec, from ".concat(f," to ").concat(B)),s.length===0)Wt=this.sessionDesc.mediaDescriptions.filter(_N=>_N.media.mediaType==="video"&&_N.attributes.direction==="recvonly");else if(Wt=this.sessionDesc.mediaDescriptions.filter(_N=>_N.attributes.mid&&a5(s).call(s,_N.attributes.mid)&&_N.attributes.direction==="recvonly"),Wt.length!==s.length)return CN.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(s,", codecs: ").concat(d)),!1;if(_H("USE_PUB_RTX")||_H("USE_SUB_RTX")){const _N=fle(k,this.rtpCapabilities.recv.videoCodecs);k.push(..._N)}this._rtpCapabilities.recv.videoCodecs=k;const $O=this.localCapabilities.send,uN=this.rtpCapabilities.recv,lN=Pne(_5.VIDEO,uN,$O,l);return Wt.forEach(_N=>{const TN=lN.map(vN=>vN.payloadType.toString(10));CN.debug("updateRemoteCodec mid: ".concat(_N.attributes.mid,", from"),_N.attributes.payloads,"to",lN),_N.attributes.payloads=lN,_N.media.fmts=TN}),!0}createOrRecycleSendMedia(s,d,l,f,b){const k=this.rtpCapabilities.send,B=s===_5.VIDEO?k.videoCodecs:k.audioCodecs,Wt=s===_5.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;const $O="".concat(this.currentMidIndex);let uN={media:{mediaType:s,port:Mne,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(_N=>_N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Wt,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:f,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($O)}};uN=this.mungSendMediaDesc(uN,b);const lN=this.findFirstClosedMedia(s);if(lN){const _N=this.sessionDesc.mediaDescriptions.indexOf(lN);this.sessionDesc.mediaDescriptions[_N]=uN}else this.sessionDesc.mediaDescriptions.push(uN);return uN}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>s.media.port!=="0").map(s=>s.attributes.mid)}mungRecvMediaDsec(s,d,l){const f=$6(s);return hle(f),Z$(f,d),ple(f,d),USe(f),Ooe(f,l,this.localCapabilities.send),f}mungSendMediaDesc(s,d){const l=$6(s);return Ooe(l,d,this.localCapabilities.recv),$$(l),l}updateRecvMedia(s,d){const l=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===s);if(l!==-1){const f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],d);this.sessionDesc.mediaDescriptions[l]=f}}bumpMid(s){this.currentMidIndex+=s}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(d=>Z6()?d.media.port==="0"&&d.media.mediaType===s:d.media.port==="0")}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(d=>{var l;return((l=d.attributes)===null||l===void 0||(l=l.ssrcs[0])===null||l===void 0?void 0:l.ssrcId)===s[0].ssrcId})}getSSRC(s){var d;return(d=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===s))===null||d===void 0?void 0:d.attributes.ssrcs}};function pye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function U7(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?pye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):pye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}var nee=function(s){return s[s.DOWN=0]="DOWN",s[s.UP=1]="UP",s}(nee||{});const Moe=new Map;function fye(s,d,l,f){let{scale:b}=s;if(b===0&&f===nee.UP||b>=d.length-1&&f===nee.DOWN)return s;let k=U7(U7({},s),{},{scale:f===nee.DOWN?++b:--b});switch(l){case"maintain-framerate":k=U7(U7({},k),d[b].motion);break;case"maintain-resolution":k=U7(U7({},k),d[b].detail);break;case"balanced":k=U7(U7({},k),d[b].balanced)}return k}function _ye(s,d){if(d){const l={overUse:0,underUse:0,adaptationList:Eye(d)};Moe.set(s,l)}else Moe.delete(s)}function Eye(s){const d=U7({},s),{bitrateMax:l,frameRate:f,scaleResolutionDownBy:b,bitrateMin:k}=d,{MIN_FRAME_RATE:B,MAX_THRESHOLD_FRAMERATE:Wt,MAX_SCALE:$O,BITRATE_MIN_THRESHOLD:uN,BITRATE_MAX_THRESHOLD:lN,BWE_SCALE_UP_THRESHOLD:_N,BWE_SCALE_DOWN_THRESHOLD:TN,PERF_SCALE_DOWN_THRESHOLD:vN,PERF_SCALE_UP_THRESHOLD:uH,BALANCE_BITRATE_FACTOR:rH,BALANCE_FRAMERATE_FACTOR:iH,BALANCE_RESOLUTION_FACTOR:lH,MOTION_RESOLUTION_FACTOR:hH,MOTION_BITRATE_FACTOR:bH,DETAIL_FRAMERATE_FACTOR:PH,DETAIL_BITRATE_FACTOR:OH}=Nde,wH=Math.min(d.frameRate,Wt),BH=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(TN,1)*l),bwe_up:l,fps_down:Math.round(Math.pow(vN,1)*wH),fps_up:f},balanced:{scaleResolutionDownBy:1,frameRate:f,bitrateMax:l,bitrateMin:k},motion:{scaleResolutionDownBy:1,frameRate:f,bitrateMax:l,bitrateMin:k},detail:{scaleResolutionDownBy:1,frameRate:f,bitrateMax:l,bitrateMin:k}}];for(let XH=1;XH<=$O;XH++){const d5={bwe_up:Math.round(Math.pow(_N,XH)*l),bwe_down:Math.round(Math.pow(TN,XH+1)*l),fps_up:Math.round(Math.pow(uH,XH)*wH),fps_down:Math.round(Math.pow(vN,XH+1)*wH)},p5={scaleResolutionDownBy:b/Math.pow(lH,XH),frameRate:Math.max(Math.round(Math.pow(iH,XH)*f),B),bitrateMax:Math.max(Math.round(Math.pow(rH,XH)*l),lN),bitrateMin:Math.max(Math.round(Math.pow(rH,XH)*k),uN)},$5={scaleResolutionDownBy:b/Math.pow(hH,XH),frameRate:f,bitrateMax:Math.max(Math.round(Math.pow(bH,XH)*l),lN),bitrateMin:Math.max(Math.round(Math.pow(bH,XH)*k),uN)},e6={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(PH,XH)*f),B),bitrateMax:Math.max(Math.round(Math.pow(OH,XH)*l),lN),bitrateMin:Math.max(Math.round(Math.pow(OH,XH)*k),uN)};BH.push({scale:XH,threshold:d5,balanced:p5,motion:$5,detail:e6})}return BH}function Xke(s,d,l,f,b,k){const B=Moe.get(s)||{overUse:0,underUse:0,adaptationList:Eye(b)},{adaptationList:Wt}=B;Moe.set(s,B);const{OVERUSE_TIMES_THRESHOLD:$O,UNDERUSE_TIMES_THRESHOLD:uN}=Nde,{scale:lN}=f;let _N,TN;return typeof d=="number"&&d>0&&function(vN,uH,rH,iH){if(uH>=rH.length)return!1;let{threshold:{fps_down:lH}}=rH[uH];return _H("FORCE_AG_HIGH_FRAMERATE")&&iH==="maintain-framerate"&&(lH=rH[0].threshold.fps_down),vN<lH}(d,lN,Wt,k)&&(B.overUse++,TN=Sne.CPU,B.overUse>$O)||typeof l=="number"&&l>0&&function(vN,uH,rH){if(uH>=rH.length)return!1;const{threshold:{bwe_down:iH}}=rH[uH];return vN<iH}(l,lN,Wt)&&(B.overUse++,TN=Sne.BANDWIDTH,B.overUse>$O)?(B.overUse=0,B.underUse=0,_N=fye(f,Wt,k,nee.DOWN),[_N,TN]):(typeof d=="number"&&d>0&&typeof l=="number"&&l>0&&function(vN,uH,rH,iH){if(uH===0)return;let{threshold:{fps_up:lH}}=rH[uH];return _H("FORCE_AG_HIGH_FRAMERATE")&&iH==="maintain-framerate"&&(lH=rH[1].threshold.fps_up),vN>lH}(d,lN,Wt,k)&&function(vN,uH,rH){if(uH===0)return;const{threshold:{bwe_up:iH}}=rH[uH];return vN>iH}(l,lN,Wt)&&(B.underUse++,B.underUse>uN&&(B.overUse=0,B.underUse=0,_N=fye(f,Wt,k,nee.UP),_N.scale===0&&(TN=Sne.NONE))),[_N,TN])}function mye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function Cle(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?mye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):mye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}function Qke(s){var d;return!!_H("ENABLE_AG_ADAPTATION")&&!!(s instanceof zde||a5(d=s._hints).call(d,O6.CUSTOM_TRACK))&&(!!_H("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(l){const f=c6();if(f.os!==AK.IOS||!f.osVersion)return!1;const b=f.osVersion.split(".");return Number(b[0])>=l}(14)&&gme(17,4,!0)||mme(14)&&Tme(17,4,!0)))}const Uoe=new Map;function xoe(s,d){const l=Uoe.get(s);if(l){const{timer:f}=l;window.clearTimeout(f),Uoe.delete(s)}d.qualityLimitationReason=Sne.NONE,_ye(s)}function Zke(s,d){var l;let f;switch(d){case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoTrack:f=a5(l=s._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalVideoLowTrack:f=m6.Low}return f}function Ile(s){const d=u6();if(s.some(l=>l._bypassWebAudio))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!d.webAudioMediaStreamDest)throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function wle(s,d){Ile(s);const l=new SK;return s.forEach(f=>l.addAudioTrack(f)),l}const $ke=!u6().supportUnifiedPlan||_H("CHROME_FORCE_PLAN_B")&&A7();function Voe(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var l;return $ke?(l={spec:d,store:s},BX("PlanBConnection").create(l)):new x7(d,s)}function Ale(s){return s&&(s.iceConnectionState==="disconnected"||s.iceConnectionState==="checking"||s.iceConnectionState==="failed")}function gye(s){try{if(s.iceServers)return!1;if(s.turnServer&&s.turnServer.mode!=="off"){if(mne(s.turnServer.servers))return!1;if(_H("FORCE_TURN_TCP")||s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).some(d=>d.forceturn))return!0}return!1}catch{return!1}}var r6;function Tye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function iJ(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?Tye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):Tye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}let x7=(r6=class are extends gSe{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var d,l;return(d=(l=this.peerConnection.getReceivers()[0])===null||l===void 0||(l=l.transport)===null||l===void 0?void 0:l.state)!==null&&d!==void 0?d:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").filter(d=>{var l;return a5(l=Object.keys(roe)).call(l,d)}))]}constructor(d,l){super(d,l),cH(this,"id",A6(5,"connection-")),cH(this,"store",void 0),cH(this,"peerConnection",void 0),cH(this,"forceTurn",!1),cH(this,"remoteSDP",void 0),cH(this,"initialOffer",void 0),cH(this,"transportEventReceiver",void 0),cH(this,"statsFilter",void 0),cH(this,"extension",{useXR:_H("USE_XR")}),cH(this,"localCapabilities",void 0),cH(this,"remoteCodecs",void 0),cH(this,"localCandidateCount",0),cH(this,"allCandidatesReceived",!1),cH(this,"isPreallocation",!1),cH(this,"preSSRCMap",new Map),cH(this,"dataStreamChannelMap",new Map),cH(this,"establishPromise",void 0),cH(this,"recoveredDataChannelIds",[]),cH(this,"currentDataChannelId",1),cH(this,"supportAV1RtpSpec",!1),cH(this,"mutex",void 0),cH(this,"qualityLimitationReason",Sne.NONE),this.store=l,this.forceTurn=gye(d),this.mutex=new t4("P2PConnection-mutex",l.clientId),this.peerConnection=new RTCPeerConnection(are.resolvePCConfiguration(d),{optional:[{googDscp:!0}]}),this.statsFilter=wde(this.peerConnection,_H("STATS_UPDATE_INTERVAL"),void 0,Z6()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(d){const l=this.preSSRCMap.get(d);if(l!==void 0){const f=this.peerConnection.getTransceivers().find(b=>b.mid===l);if(f)return{transceiver:f,track:f.receiver.track,id:l}}}async updateRemoteRTPCapabilities(d,l){if(this.remoteCodecs=l,!this.remoteSDP)return void CN.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(l));if(this.remoteSDP.updateRemoteCodec(d,l,this.store.codec)){const f=await this.peerConnection.createOffer(),b=this.logSDPExchange(f.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(f);const k=this.remoteSDP.toString();b==null||b(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}else CN.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const f=await this.peerConnection.createOffer();if(!f.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const b=jX(f.sdp),k=await VSe({filterRTX:!_H("USE_PUB_RTX")&&!_H("USE_SUB_RTX"),filterVideoFec:_H("FILTER_VIDEO_FEC"),filterAudioFec:_H("FILTER_AUDIO_FEC"),filterVideoCodec:_H("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=Noe(k),this.initialOffer=f,_H("ENABLE_SVC")&&this.store.codec=="av1"){const Wt=await async function(){try{const $O=new RTCPeerConnection;$O.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:toe.L1T3}]});const uN=await $O.createOffer();if(!uN.sdp)return void $O.close();const lN=$4(uN.sdp).mediaDescriptions[0];if(!lN)return;const _N=lN.attributes.extmaps.find(TN=>TN.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return $O.close(),_N}catch{return}}();var d;Wt&&(this.supportAV1RtpSpec=!0,(d=k.send)===null||d===void 0||d.videoExtensions.push(Wt))}let B;return f.sdp&&GSe(f.sdp)&&(B=$6(k),(l=B).send&&(Q$(_5.VIDEO,l.send.videoExtensions),Q$(_5.AUDIO,l.send.audioExtensions)),l.recv&&(Q$(_5.VIDEO,l.recv.videoExtensions),Q$(_5.AUDIO,l.recv.audioExtensions)),l.sendrecv&&(Q$(_5.VIDEO,l.sendrecv.videoExtensions),Q$(_5.AUDIO,l.sendrecv.audioExtensions))),iJ(iJ({},b),{},{rtpCapabilities:B||k,offerSDP:f.sdp})}catch(f){throw new jH(dH.GET_LOCAL_CONNECTION_PARAMS_FAILED,f.toString())}var l}async connect(d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&GSe(this.initialOffer.sdp)&&(l=d.rtpCapabilities,f=this.localCapabilities,l.send&&(woe(_5.VIDEO,l.send.videoExtensions,f.send.videoExtensions),woe(_5.AUDIO,l.send.audioExtensions,f.send.audioExtensions)),l.recv&&(woe(_5.VIDEO,l.recv.videoExtensions,f.recv.videoExtensions),woe(_5.AUDIO,l.recv.audioExtensions,f.recv.audioExtensions))),this.remoteSDP=new Jke(iJ(iJ({},d),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),d.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const b=this.remoteSDP.toString(),k=jSe(this.initialOffer.sdp,this.extension),B=this.logSDPExchange(k||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:k}),B==null||B(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b});const Wt=this.peerConnection.getTransceivers()[0];if(Wt!=null&&Wt.receiver&&this.tryBindTransportEvents(Wt.receiver),_H("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(_H("PRELOAD_MEDIA_COUNT"));const uN=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:uN});const lN=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(lN)}const{preSSRCs:$O}=d;if(Array.isArray($O)&&$O.length>0){const{mids:uN}=this.remoteSDP.batchSend($O.map(lN=>({kind:lN.kind,ssrcMsg:[{ssrcId:lN.ssrcId,rtx:lN.rtx}],mslabel:lN.mslabel})));uN.forEach((lN,_N)=>{this.preSSRCMap.set($O[_N].ssrcId,lN)}),await Poe(this.peerConnection,this.remoteSDP,this.extension),CN.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(b){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(b.toString()))}var l,f}async updateRemoteConnect(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:l}=d;this.remoteSDP.updateRemoteRTPCapabilities(l),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:f}=d;if(Array.isArray(f)&&f.length>0){const{mids:b}=this.remoteSDP.batchSend(f.map(k=>Object.assign({},{kind:k.kind,ssrcMsg:[{ssrcId:k.ssrcId,rtx:k.rtx}],mslabel:k.mslabel})));b.forEach((k,B)=>{this.preSSRCMap.set(f[B].ssrcId,k)})}await Poe(this.peerConnection,this.remoteSDP,this.extension),CN.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(l.toString()))}}send(d,l,f){var b=this;return H8(function*(){const k=yield i6(b.mutex.lock("From P2PConnection.send"));try{if(!b.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const B=[],Wt=Ioe();d.forEach(iH=>{const lH=b.peerConnection.addTransceiver(iH._mediaStreamTrack,iJ({direction:"sendonly"},iH.trackMediaType==="video"&&b.supportAV1RtpSpec&&Wt?{sendEncodings:[{scalabilityMode:Wt}]}:{}));B.push(lH),iH._updateRtpTransceiver(lH)}),Z6()&&_H("SIMULCAST")===!0&&(yield i6(b.applySimulcastForFirefox(B,d)));const $O=yield i6(b.peerConnection.createOffer()),uN=b.remoteSDP.predictReceivingMids(d.length),lN=b.mungSendOfferSDP($O.sdp,d,uN),_N=$4(lN),TN=uN.map(iH=>{const lH=_N.mediaDescriptions.find(hH=>hH.attributes.mid===iH);if(!lH)throw new Error("Cannot extract ssrc from mediaDescription.");return kSe(lH,_H("USE_PUB_RTX"))});let vN;try{vN=yield TN}catch(iH){vN=[],b.remoteSDP.receive(d,l,f,vN);const lH=b.remoteSDP.toString();throw yield i6(b.peerConnection.setLocalDescription({type:"offer",sdp:lN})),yield i6(b.peerConnection.setRemoteDescription({type:"answer",sdp:lH})),yield i6(b.stopSending(uN,!0)),iH}b.remoteSDP.receive(d,l,f,vN);const uH=b.remoteSDP.toString(),rH=b.logSDPExchange(lN,"offer","local","send");return yield i6(b.peerConnection.setLocalDescription({type:"offer",sdp:lN})),yield i6(b.applySimulcastEncodings(B,d)),yield i6(b.applySendEncodings(B,d)),rH==null||rH(uH),yield i6(b.peerConnection.setRemoteDescription({type:"answer",sdp:uH})),B.map((iH,lH)=>{const hH=uN[lH];return{localSSRC:TN[lH],id:hH,transceiver:iH}})}catch(B){throw B instanceof jH?B:new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(B.toString()))}finally{k()}})()}async createDataChannels(d,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let f=this.dataStreamChannelMap.get(d);if(f&&f.readyState==="open")CN.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const k=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof k!="number")throw new Error("create DataChannel error, because cannot get dc id");f=this.peerConnection.createDataChannel("datastream-channel",{id:k,negotiated:!0,ordered:!1,maxRetransmits:_H("DATASTREAM_MAX_RETRANSMITS")}),f.binaryType="arraybuffer",this.dataStreamChannelMap.set(d,f)}l.forEach(k=>{k._updateOriginDataChannel(f)});const{needExchangeSDP:b}=this.remoteSDP.sendDataChannel();if(b){const k=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:k});const B=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(B),CN.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else CN.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(f){throw f instanceof jH?f:new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(f.toString()))}}async stopDataChannels(d){try{const l=this.dataStreamChannelMap.get(d);return l&&(l.id&&this.recoveredDataChannelIds.push(l.id),l.close()),void this.dataStreamChannelMap.delete(d)}catch(l){throw l instanceof jH?l:new jH(dH.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(l.toString()))}}async stopSending(d,l){const f=l?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const b=this.peerConnection.getTransceivers().filter($O=>d.indexOf($O.mid)!==-1);if(b.length!==d.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");b.map($O=>{var uN;xoe(this.id+$O.mid,this),$O.direction="inactive",(uN=$O.stop)===null||uN===void 0||uN.call($O)});const k=await this.peerConnection.createOffer(),B=this.logSDPExchange(k.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(k),this.remoteSDP.stopReceiving(d);const Wt=this.remoteSDP.toString();B==null||B(Wt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:Wt})}catch(b){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(b.toString()))}finally{f&&f()}}async receive(d,l,f,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(d," before remoteSDP created."));const{mid:k,needExchangeSDP:B}=this.remoteSDP.send(d,l,f,b);B&&(await Poe(this.peerConnection,this.remoteSDP,this.extension),CN.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(d," by exchanging SDP.")));const Wt=this.peerConnection.getTransceivers().find($O=>$O.mid===k);if(!Wt)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:Wt.receiver.track,id:k,transceiver:Wt}}catch(k){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(k.toString()))}}async batchReceive(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:l,needExchangeSDP:f}=this.remoteSDP.batchSend(d);return f&&(await Poe(this.peerConnection,this.remoteSDP,this.extension),CN.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),l.map(b=>{const k=this.peerConnection.getTransceivers().find(B=>B.mid===b);if(!k)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:k.receiver.track,id:b,transceiver:k}})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");d.forEach(k=>{Array.from(this.preSSRCMap.entries()).some(B=>{let[Wt,$O]=B;if($O===k)return this.preSSRCMap.delete(Wt),!0})}),this.remoteSDP.stopSending(d);const l=this.remoteSDP.toString(),f=this.logSDPExchange(l,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const b=await this.peerConnection.createAnswer();f==null||f(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}}async muteRemote(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(d," before remote SDP created."));this.remoteSDP.mute(d);const l=this.remoteSDP.toString(),f=this.logSDPExchange(l,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const b=await this.peerConnection.createAnswer();f==null||f(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(l.toString()))}}async unmuteRemote(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(d," before remote SDP created."));this.remoteSDP.unmute(d);const l=this.remoteSDP.toString(),f=this.logSDPExchange(l,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const b=await this.peerConnection.createAnswer();f==null||f(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(l.toString()))}}async muteLocal(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(B=>B.mid&&d.indexOf(B.mid)!==-1);if(l.length!==d.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(B=>{B.direction="inactive"});const f=await this.peerConnection.createOffer(),b=this.logSDPExchange(f.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(f),this.remoteSDP.muteRemote(d);const k=this.remoteSDP.toString();b==null||b(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(l.toString()))}}async unmuteLocal(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(B=>B.mid&&d.indexOf(B.mid)!==-1);if(l.length!==d.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(async(B,Wt)=>{B.direction="sendonly"});const f=await this.peerConnection.createOffer(),b=this.logSDPExchange(f.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(f),this.remoteSDP.unmuteRemote(d),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(d,this.remoteCodecs,this.store.codec);const k=this.remoteSDP.toString();b==null||b(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(l.toString()))}}restartICE(d){var l=this;return H8(function*(){const f=yield i6(l.mutex.lock("From P2PConnection.restartICE"));try{if(!l.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const b=u6().supportPCSetConfiguration,k=_H("FORCE_TURN_TCP")||l.forceTurn;if(d===d4.RELAY&&!b)return;if(b&&!k){const _N=d===d4.RELAY?"relay":"all",TN=l.peerConnection.getConfiguration();TN.iceTransportPolicy!==_N&&(CN.debug("[".concat(l.store.clientId,"] restartICE change iceTransportPolicy from [").concat(TN.iceTransportPolicy,"] to [").concat(_N,"]")),TN.iceTransportPolicy=_N,l.peerConnection.setConfiguration(TN))}l.remoteSDP.updateCandidates(d);const B=yield i6(l.peerConnection.createOffer({iceRestart:!0}));if(!B.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const Wt=jX(B.sdp),{remoteIceParameters:$O}=yield Wt.iceParameters;l.remoteSDP.restartICE($O);const uN=l.remoteSDP.toString(),lN=l.logSDPExchange(B.sdp||"","offer","local","restartICE");l.store.descriptionStart(),yield i6(l.peerConnection.setLocalDescription(B)),lN==null||lN(uN),yield i6(l.peerConnection.setRemoteDescription({type:"answer",sdp:uN}))}catch(b){CN.warning("[".concat(l.store.clientId,"] restart ICE failed, abort operation"),b)}finally{f()}})()}close(){var d;this.peerConnection.getTransceivers().forEach(l=>{xoe(this.id+l.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(d=this.onConnectionStateChange)===null||d===void 0||d.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return iJ(iJ({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(d){return this.statsFilter.getVideoIsReady(d)}async updateEncoderConfig(d,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const f=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(f.sdp,[l],[d]);this.remoteSDP.updateRecvMedia(d,l);const k=this.remoteSDP.toString(),B=this.logSDPExchange(b,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),B==null||B(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(f){throw new jH(dH.EXCHANGE_SDP_FAILED,f.toString())}}async updateSendParameters(d,l){const f=this.peerConnection.getTransceivers().filter(b=>b.mid===d);f.length===1&&(this.isVP8Simulcast(l)?Z6()||await this.applySimulcastEncodings(f,[l]):await this.applySendEncodings(f,[l]))}setStatsRemoteVideoIsReady(d,l){this.statsFilter.setVideoIsReady2(d,l)}async replaceTrack(d,l){const f=this.peerConnection.getTransceivers().find(b=>b.mid===l);f&&await f.sender.replaceTrack(d._mediaStreamTrack)}async getSelectedCandidatePair(){const d=this.peerConnection.getReceivers();if(d.length>0&&d[0].transport&&d[0].transport.iceTransport&&d[0].transport.iceTransport.getSelectedCandidatePair&&d[0].transport.iceTransport.getSelectedCandidatePair()){const l=d[0].transport.iceTransport,{local:f,remote:b}=l.getSelectedCandidatePair();return{local:iJ(iJ({},VJ),{},{candidateType:f.type,protocol:f.protocol,address:f.address,port:f.port}),remote:iJ(iJ({},VJ),{},{candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var d;(d=this.onICEConnectionStateChange)===null||d===void 0||d.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var d;(d=this.onConnectionStateChange)===null||d===void 0||d.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=d=>{if(d&&(d.errorCode||d.errorText)){var l;const f="code: ".concat(d.errorCode,", message: ").concat(d.errorText),b=d.port?"local: ".concat(d.port):"";CN.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(f,"), url: ").concat(d.url||"",", host_candidate:").concat(b)),(l=this.onICECandidateError)===null||l===void 0||l.call(this,f)}},this.peerConnection.onicegatheringstatechange=d=>{d&&d.target&&"iceGatheringState"in d.target&&CN.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(d.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=d=>{d.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,CN.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,CN.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(d){const l={iceServers:[]};return d.iceServers?l.iceServers=d.iceServers:d.turnServer&&d.turnServer.mode!=="off"&&(mne(d.turnServer.servers)?l.iceServers=d.turnServer.servers:(l.iceServers&&l.iceServers.push(...are.turnServerConfigToIceServers(d.turnServer.servers)),_H("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&d.turnServer.serversFromGateway&&l.iceServers.push(...are.turnServerConfigToIceServers(d.turnServer.serversFromGateway)),_H("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":d.turnServer.servers.concat(d.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(l.iceTransportPolicy="relay")}))),_H("ENABLE_ENCODED_TRANSFORM")&&u6().supportWebRTCEncodedTransform&&(l.encodedInsertableStreams=!0),l}static turnServerConfigToIceServers(d){const l=[];return d.forEach(f=>{f.security?f.tcpport&&l.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(X$(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}):(f.udpport&&!_H("FORCE_TURN_TCP")&&l.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.udpport,"?transport=udp")}),f.tcpport&&l.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=tcp")}))}),l}tryBindTransportEvents(d){const l=d.transport;if(l){this.transportEventReceiver=d,l.onstatechange=()=>{var b;l!=null&&l.state&&((b=this.onDTLSTransportStateChange)===null||b===void 0||b.call(this,l.state))},l.onerror=b=>{var k;(k=this.onDTLSTransportError)===null||k===void 0||k.call(this,"error"in b?b.error:b)};const f=l.iceTransport;f&&(f.onstatechange=()=>{const b=l==null?void 0:l.iceTransport.state;var k;b&&((k=this.onICETransportStateChange)===null||k===void 0||k.call(this,b))},f.getSelectedCandidatePair&&(f.onselectedcandidatepairchange=()=>{if(f.getSelectedCandidatePair()){const{local:b,remote:k}=f.getSelectedCandidatePair();CN.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol}),", remote ").concat(JSON.stringify({candidateType:k.type,protocol:k.protocol,address:k.address,port:k.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(d,l){var f,b;if(l||(l=this.peerConnection.getSenders().find(iH=>iH.track===d._mediaStreamTrack)),!l)return CN.warn("[".concat(d.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(d))return CN.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!u6().supportSetRtpSenderParameters)return CN.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const k={},B={};switch(d._optimizationMode){case"motion":k.degradationPreference="maintain-framerate";break;case"detail":k.degradationPreference="maintain-resolution";break;case"balanced":k.degradationPreference="balanced"}const Wt=function(rH,iH){return rH.getTransceivers().find(lH=>lH.sender.track===iH||lH.receiver.track===iH)}(this.peerConnection,d._mediaStreamTrack),$O=MDe(d);if(Qke(d)&&Wt&&l&&$O&&this.getLocalVideoStats&&a5(f=["vp8","vp9"]).call(f,this.store.codec)){var uN;const rH=k.degradationPreference||(a5(uN=d._hints).call(uN,O6.CUSTOM_TRACK)?_H("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(iH,lH,hH,bH,PH,OH){if(xoe(iH,hH),PH(lH),bH!=="balanced"&&bH!=="maintain-framerate"&&bH!=="maintain-resolution")return;let wH=-1;_ye(iH,lH);const BH=window.setInterval(()=>{const d5=Uoe.get(iH);if(!_H("ENABLE_AG_ADAPTATION")||!d5)return xoe(iH,hH),void PH(lH);const p5=OH();if(p5.sendPackets>0&&p5.OutgoingAvailableBandwidth>0){if(wH===-1)return void(wH=Date.now());if(Date.now()-wH<1e3)return;const $5=p5.sendFrameRate,e6=p5.OutgoingAvailableBandwidth,[N6,aK]=Xke(iH,$5,e6,d5.adaptationConfig,lH,bH);aK&&(hH.qualityLimitationReason=aK),N6&&d5.adaptationConfig.scale!==N6.scale&&(CN.debug("[".concat(iH,"] applyAdaptation: ").concat(hH.qualityLimitationReason,`
           sendFps `).concat($5,", bwe ").concat(e6,", switch from ").concat(d5.adaptationConfig.scale," to ").concat(N6.scale," ")),d5.adaptationConfig=Cle(Cle({},d5.adaptationConfig),N6),PH(N6))}},_H("CHECK_LOCAL_STATS_INTERVAL")),XH=Cle({},lH);Uoe.set(iH,{timer:BH,adaptationConfig:XH,originConfig:lH,adaptationFunc:PH}),CN.debug("[".concat(iH,"] start adaptation, originConfig: ").concat(JSON.stringify(lH),", degradationPreference: ").concat(bH))})(this.id+Wt.mid,$O,this,rH,iH=>{l&&this.updateAdaptation(l,iH)},this.getLocalVideoStats.bind(this))}if(d._encoderConfig){var lN;const{bitrateMax:rH,frameRate:iH,scaleResolutionDownBy:lH}=d._encoderConfig;rH&&(B.maxBitrate=1e3*rH),(a5(lN=d._hints).call(lN,O6.LOW_STREAM)||d.isUseScaleResolutionDownBy)&&(iH&&(B.maxFramerate=h8(iH)),lH&&lH>=1&&(B.scaleResolutionDownBy=lH))}const{maxFramerate:_N}=_H("ENCODER_CONFIG_LIMIT");if(_N&&typeof _N=="number"&&(B.maxFramerate=B.maxFramerate?Math.min(B.maxFramerate,_N):_N),_H("DSCP_TYPE")&&A7()){var TN;const rH=_H("DSCP_TYPE");a5(TN=["very-low","low","medium","high"]).call(TN,rH)&&(B.networkPriority=rH)}const vN=l.getParameters(),uH=(b=vN.encodings)===null||b===void 0?void 0:b[0];Z6()&&!uH&&(k.encodings=[B]),uH&&Object.assign(uH,B),Object.assign(vN,k),CN.debug("[".concat(d.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(vN.encodings))),await l.setParameters(vN),await async function(rH,iH,lH){try{var hH;if(!u6().supportSetRtpSenderParameters||!function(BH){return BH==="vp9"||BH==="av1"}(rH)||!_H("ENABLE_SVC"))return;const bH={},PH={},OH=iH.getParameters(),wH=(hH=OH.encodings)===null||hH===void 0?void 0:hH[0];PH.scalabilityMode=Ioe(lH),wH&&Object.assign(wH,PH),Object.assign(OH,bH),await iH.setParameters(OH),CN.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(OH.encodings)))}catch(bH){CN.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",bH)}}(this.store.codec,l,_H("SVC_MODE"))}async updateAdaptation(d,l){var f,b;if(!d)return CN.debug("[updateAdaptation] no rtpSender found");if(!u6().supportSetRtpSenderParameters)return CN.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const k={},{bitrateMax:B,frameRate:Wt,scaleResolutionDownBy:$O}=l;B&&(k.maxBitrate=1e3*B),Wt&&(k.maxFramerate=h8(Wt)),$O&&$O>=1&&a5(f=["vp8","vp9"]).call(f,this.store.codec)&&(k.scaleResolutionDownBy=$O);const uN=d.getParameters(),lN=(b=uN.encodings)===null||b===void 0?void 0:b[0];lN&&Object.assign(lN,k),Object.assign(uN,{});try{await d.setParameters(uN),CN.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(uN.encodings)))}catch(_N){!("transport"in d)||d.transport&&d.transport.state==="connected"?this.peerConnectionState!=="connected"?CN.debug("[updateAdaptation] peerConnection not connected}"):CN.debug("[updateAdaptation] updateRtpSenderEncodings failed",_N):CN.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(d,l){try{if(!u6().supportSetRtpSenderParameters||d.length!==l.length)return;for(let f=0;f<d.length;f++){const b=d[f],k=l[f];k instanceof x6&&!this.isVP8Simulcast(k)&&await this.updateRtpSenderEncodings(k,b.sender)}}catch{CN.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(d,l,f){const b=$4(d);return l.forEach((k,B)=>{const Wt=f[B],$O=b.mediaDescriptions.find(uN=>uN.attributes.mid===Wt);$O&&(Z$($O,k),xSe($O,k,this.store.codec))}),UX(b)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=d=>{var l;(l=this.onFirstAudioReceived)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstVideoReceived=d=>{var l;(l=this.onFirstVideoReceived)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstAudioDecoded=d=>{var l;(l=this.onFirstAudioDecoded)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstVideoDecoded=(d,l,f)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,d,l,f)},this.statsFilter.onSelectedLocalCandidateChanged=(d,l)=>{var f;(f=this.onSelectedLocalCandidateChanged)===null||f===void 0||f.call(this,d,l)},this.statsFilter.onSelectedRemoteCandidateChanged=(d,l)=>{var f;(f=this.onSelectedRemoteCandidateChanged)===null||f===void 0||f.call(this,d,l)},this.statsFilter.onFirstVideoDecodedTimeout=d=>{var l;(l=this.onFirstVideoDecodedTimeout)===null||l===void 0||l.call(this,d)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(d,l){if(d.length===l.length)for(let $O=0;$O<d.length;$O++){var f,b,k,B,Wt;const uN=d[$O],lN=l[$O];if(lN instanceof x6&&!a5(f=lN._hints).call(f,O6.LOW_STREAM)&&(b=lN._encoderConfig)!==null&&b!==void 0&&b.bitrateMax&&((k=lN._encoderConfig)===null||k===void 0?void 0:k.bitrateMax)>200&&(B=lN._scalabilityMode)!==null&&B!==void 0&&B.numSpatialLayers&&((Wt=lN._scalabilityMode)===null||Wt===void 0?void 0:Wt.numSpatialLayers)>1&&this.store.codec==="vp8"){const _N={},TN={high:1e3*(lN._encoderConfig.bitrateMax-50),medium:5e4};_N.encodings=[{rid:"m",active:!0,maxBitrate:TN.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:TN.high}];const vN=uN.sender.getParameters();await uN.sender.setParameters(Object.assign(vN,_N))}}}async applySimulcastEncodings(d,l){if(!Z6()&&d.length===l.length)for(let f=0;f<d.length;f++){const b=l[f];if(b instanceof x6&&this.isVP8Simulcast(b)){const k=d[f],B={},Wt={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};B.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:Wt.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:Wt.medium,scaleResolutionDownBy:4}];const $O=k.sender.getParameters();await k.sender.setParameters(Object.assign($O,B))}}}isVP8Simulcast(d){var l,f,b,k,B;return!!(d instanceof x6&&_H("SIMULCAST")&&this.store.codec==="vp8"&&!a5(l=d._hints).call(l,O6.LOW_STREAM)&&(f=d._encoderConfig)!==null&&f!==void 0&&f.bitrateMax&&((b=d._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&(k=d._scalabilityMode)!==null&&k!==void 0&&k.numSpatialLayers&&((B=d._scalabilityMode)===null||B===void 0?void 0:B.numSpatialLayers)>1)}logSDPExchange(d,l,f,b){if(_H("SDP_LOGGING"))return CN.upload("[".concat(this.store.clientId,"] exchanging ").concat(f," ").concat(l," SDP during P2PConnection.").concat(b,`
`),d),l==="offer"?k=>{this.logSDPExchange(k,"answer",f==="local"?"remote":"local",b)}:void 0}async getRemoteSSRC(d){if(!this.remoteSDP)return;const l=this.remoteSDP.getSSRC(d);return l&&l.length!==0?l[0].ssrcId:void 0}setConfiguration(d){if(u6().supportPCSetConfiguration){const l=are.resolvePCConfiguration(d);this.peerConnection.setConfiguration(l)}}},m5(r6.prototype,"updateRemoteRTPCapabilities",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"updateRemoteRTPCapabilities"),r6.prototype),m5(r6.prototype,"connect",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"connect"),r6.prototype),m5(r6.prototype,"updateRemoteConnect",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"updateRemoteConnect"),r6.prototype),m5(r6.prototype,"createDataChannels",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"createDataChannels"),r6.prototype),m5(r6.prototype,"receive",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"receive"),r6.prototype),m5(r6.prototype,"batchReceive",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"batchReceive"),r6.prototype),m5(r6.prototype,"stopReceiving",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"stopReceiving"),r6.prototype),m5(r6.prototype,"muteRemote",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"muteRemote"),r6.prototype),m5(r6.prototype,"unmuteRemote",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"unmuteRemote"),r6.prototype),m5(r6.prototype,"muteLocal",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"muteLocal"),r6.prototype),m5(r6.prototype,"unmuteLocal",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"unmuteLocal"),r6.prototype),m5(r6.prototype,"close",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"close"),r6.prototype),m5(r6.prototype,"updateEncoderConfig",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"updateEncoderConfig"),r6.prototype),m5(r6.prototype,"updateSendParameters",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"updateSendParameters"),r6.prototype),m5(r6.prototype,"replaceTrack",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"replaceTrack"),r6.prototype),m5(r6.prototype,"updateAdaptation",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"updateAdaptation"),r6.prototype),m5(r6.prototype,"getRemoteSSRC",[B4],Object.getOwnPropertyDescriptor(r6.prototype,"getRemoteSSRC"),r6.prototype),r6);function B4(s,d,l){const f=s[d];if(typeof f!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const b=this.mutex,k=await b.lock("From P2PConnection.".concat(d));try{for(var B=arguments.length,Wt=new Array(B),$O=0;$O<B;$O++)Wt[$O]=arguments[$O];return await f.apply(this,Wt)}finally{k()}},l}function Ole(s,d){let l=document.createElement("video"),f=document.createElement("canvas");l.setAttribute("style","display:none"),f.setAttribute("style","display:none"),l.setAttribute("muted",""),l.muted=!0,l.setAttribute("autoplay",""),l.autoplay=!0,l.setAttribute("playsinline",""),f.width=h8(d.width),f.height=h8(d.height);const b=h8(d.framerate||15);document.body.append(l),document.body.append(f);let k=s._mediaStreamTrack;l.srcObject=new MediaStream([k]),l.play();const B=f.getContext("2d");if(!B)throw new LH(dH.UNEXPECTED_ERROR,"can not get canvas context");const Wt=u6(),$O=f.captureStream(Wt.supportRequestFrame?0:b).getVideoTracks()[0];$O.canvas||($O.canvas=f),f.startCapture=()=>{if(!l)return f.stopCapture&&f.stopCapture();if(l.paused&&l.play(),l.videoHeight>2&&l.videoWidth>2){const lN=l.videoWidth,_N=l.videoHeight/lN,TN=f.width*_N;Math.abs(TN-f.height)>=2&&(CN.debug("adjust low stream resolution","".concat(f.width,"x").concat(f.height," -> ").concat(f.width,"x").concat(TN)),f.height=TN)}B.drawImage(l,0,0,f.width,f.height),$O.requestFrame&&$O.requestFrame(),k!==s._mediaStreamTrack&&(k=s._mediaStreamTrack,l.srcObject=new MediaStream([k]))},f.stopCapture=Bde(()=>f.startCapture&&f.startCapture(),b);const uN=$O.stop;return $O.stop=()=>{uN.call($O),l&&(l.remove(),l.srcObject=null,l=null),f&&(f.width=0,f.remove(),f.stopCapture&&f.stopCapture(),f.startCapture=void 0,f.stopCapture=void 0,f=null),CN.debug("clean low stream renderer")},$O}var Foe=function(s){return s[s.HEIGHT=2033]="HEIGHT",s[s.FRAME_RATE=2034]="FRAME_RATE",s[s.WIDTH=2035]="WIDTH",s}(Foe||{}),lK=function(s){return s[s.FRAME_RATE=2002]="FRAME_RATE",s[s.WIDTH=2003]="WIDTH",s[s.HEIGHT=2004]="HEIGHT",s[s.PACKAGE_LOST=2005]="PACKAGE_LOST",s[s.AVG_ENCODE=2007]="AVG_ENCODE",s[s.NACKS=2009]="NACKS",s[s.PLIS=2010]="PLIS",s[s.FIRS=2011]="FIRS",s[s.BITRATE=2012]="BITRATE",s[s.PACKAGE_RATE=2031]="PACKAGE_RATE",s[s.ADAPTATION=2032]="ADAPTATION",s[s.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",s[s.BANDWIDTH=2061]="BANDWIDTH",s[s.RETRANSMIT=2062]="RETRANSMIT",s[s.TARGET_ENCODED=2064]="TARGET_ENCODED",s[s.TRANSMIT=2066]="TRANSMIT",s[s.FREEZE=2082]="FREEZE",s[s.DISABLED=2095]="DISABLED",s[s.PLAYER_STATUS=2128]="PLAYER_STATUS",s[s.QP_SUM=2143]="QP_SUM",s[s.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",s[s.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",s[s.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",s[s.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",s}(lK||{}),AQ=function(s){return s[s.BITRATE=2069]="BITRATE",s[s.PACKAGE_LOST=2070]="PACKAGE_LOST",s[s.PACKAGE_RATE=2071]="PACKAGE_RATE",s[s.HEIGHT=2073]="HEIGHT",s[s.FRAME_RATE=2075]="FRAME_RATE",s[s.WIDTH=2077]="WIDTH",s}(AQ||{}),hK=function(s){return s[s.JITTER=-1]="JITTER",s[s.PACKAGE_LOST=2014]="PACKAGE_LOST",s[s.WIDTH=2018]="WIDTH",s[s.HEIGHT=2019]="HEIGHT",s[s.FRAME_RATE=2020]="FRAME_RATE",s[s.JITTER_BUFFER=2023]="JITTER_BUFFER",s[s.CURRENT_DELAY=2024]="CURRENT_DELAY",s[s.NACKS=2026]="NACKS",s[s.PLIS=2027]="PLIS",s[s.FIRS=2028]="FIRS",s[s.BITRATE=2029]="BITRATE",s[s.PACKAGE_RATE=2078]="PACKAGE_RATE",s[s.FREEZE=2084]="FREEZE",s[s.DISABLED=2101]="DISABLED",s[s.PLAYER_STATUS=2129]="PLAYER_STATUS",s[s.QP_SUM=2144]="QP_SUM",s[s.I_FRAME_DELAY=2149]="I_FRAME_DELAY",s[s.FRAMES_DROPPED=2181]="FRAMES_DROPPED",s[s.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",s[s.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",s[s.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",s[s.AVG_DECODE=2200]="AVG_DECODE",s[s.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",s[s.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",s[s.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",s[s.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",s}(hK||{}),OQ=function(s){return s[s.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",s[s.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",s[s.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",s[s.FREEZE_TIME=2109]="FREEZE_TIME",s[s.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",s[s.FREEZE_DURATION=2156]="FREEZE_DURATION",s}(OQ||{}),Sye=function(s){return s[s.PCM_LEVEL=2104]="PCM_LEVEL",s}(Sye||{}),HJ=function(s){return s[s.PACKAGE_LOST=-1]="PACKAGE_LOST",s[s.LEVEL=2038]="LEVEL",s[s.BITRATE=2039]="BITRATE",s[s.PACKAGE_RATE=2040]="PACKAGE_RATE",s[s.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",s[s.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",s[s.FREEZE=2081]="FREEZE",s[s.DISABLED=2096]="DISABLED",s[s.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",s[s.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",s}(HJ||{}),t8=function(s){return s[s.BITRATE=2044]="BITRATE",s[s.PACKAGE_LOST=2045]="PACKAGE_LOST",s[s.PACKAGE_RATE=2046]="PACKAGE_RATE",s[s.CURRENT_DELAY=2047]="CURRENT_DELAY",s[s.JITTER_BUFFER=2054]="JITTER_BUFFER",s[s.JITTER=2055]="JITTER",s[s.FREEZE=2083]="FREEZE",s[s.DISABLED=2102]="DISABLED",s[s.PCM_LEVEL=2105]="PCM_LEVEL",s[s.PLAYER_STATUS=2130]="PLAYER_STATUS",s[s.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",s[s.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",s[s.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",s[s.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",s[s.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",s}(t8||{}),yye=function(s){return s[s.FREEZE_TIME=-1]="FREEZE_TIME",s[s.LEVEL=2043]="LEVEL",s}(yye||{}),G4=function(s){return s[s.RTT=2006]="RTT",s[s.CONN_TYPE=801]="CONN_TYPE",s[s.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",s}(G4||{}),joe=function(s){return s[s.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",s}(joe||{});const Boe=1e3,e0e=Math.max(6,3);function O5(s,d,l){l!=null&&Number.isFinite(l)&&(s[d]=Math.round(Math.max(0,l)))}function Rye(s){const d={[G4.CONN_TYPE]:0,[G4.RTT]:s.rtt,[G4.STATS_UPDATE_INTERVAL]:s.updateInterval?Math.round(Math.max(0,s.updateInterval)):void 0};switch(s.selectedCandidatePair.localCandidate.candidateType){case"relay":{const l=s.selectedCandidatePair.localCandidate.relayProtocol;l==="udp"&&(d[G4.CONN_TYPE]=1),l==="tcp"&&(d[G4.CONN_TYPE]=3),l==="tls"&&(d[G4.CONN_TYPE]=4);break}case"srflx":d[G4.CONN_TYPE]=2;break;case"unknown":d[G4.CONN_TYPE]=5;break;default:d[G4.CONN_TYPE]=0}return d}function bye(s){let d=0;switch(s){case"none":d=0;break;case"cpu":d=1;break;case"bandwidth":d=2;break;case"other":d=3}return d}class vye extends W6{constructor(d){super(),cH(this,"store",void 0),cH(this,"uploadWRTCStatsTimer",void 0),cH(this,"uploadOutboundDenoiserStatsTimer",void 0),cH(this,"uploadExtStatsTimer",void 0),cH(this,"uploadExtUsageStatsTimer",void 0),cH(this,"uploadInboundExtStatsTimer",void 0),cH(this,"requestStats",void 0),cH(this,"requestTransportStats",void 0),cH(this,"requestLocalMedia",void 0),cH(this,"requestRemoteMedia",void 0),cH(this,"requestAllTracks",void 0),cH(this,"requestVideoIsReady",void 0),cH(this,"requestUploadStats",void 0),cH(this,"requestUpload",void 0),cH(this,"uploadOutboundStarted",!1),cH(this,"uploadInboundStarted",!1),cH(this,"uploadTransportStarted",!1),cH(this,"uploadBaseStatsStarted",!1),cH(this,"uploadExtensionUsageStarted",!1),cH(this,"lastRecvStats",void 0),cH(this,"lastSendStats",void 0),cH(this,"lastRefRecvStats",void 0),cH(this,"lastRefSendStats",void 0),cH(this,"lastFullRecvStats",void 0),cH(this,"lastFullSendStats",void 0),cH(this,"needUploadRenderFreezeTime",!0),this.store=d}uploadWRTCStats(d){if(!this.requestStats||!this.requestUploadStats)return;const l=d%3==0,f=d%6==0;let b,k;if(this.uploadTransportStarted&&(b=this.requestStats(),this.store.useP2P&&(k=this.requestStats(!0))),!b&&this.uploadOutboundStarted&&(b=this.requestStats()),!k&&this.uploadInboundStarted&&(k=this.requestStats(!0)),b||k){var B;const Wt={};if(this.uploadTransportStarted&&b){const uN=this.getTransportStats(b,k,l);uN&&(Wt.misc=[uN])}if(this.uploadOutboundStarted&&b){const uN=this.getOutboundStats(b,f?this.lastFullSendStats:l?this.lastRefSendStats:this.lastSendStats,l,f);uN&&(Wt.outbound=[uN])}if(this.uploadInboundStarted&&k){const uN=this.getInboundStats(k,f?this.lastFullRecvStats:l?this.lastRefRecvStats:this.lastRecvStats,l,f);uN&&(Wt.inbound=uN)}const $O=(B=this.requestTransportStats)===null||B===void 0?void 0:B.call(this).connectState;$O&&(Array.isArray(Wt.misc)?Wt.misc[0]&&Wt.misc[0].addition&&(Wt.misc[0].addition[joe.RTC_PEER_CONNECTION_STATE]=Ide[$O]):Wt.misc=[{addition:{[joe.RTC_PEER_CONNECTION_STATE]:Ide[$O]}}]),this.requestUploadStats(Wt)}this.lastRecvStats=k,this.lastSendStats=b,f&&(this.lastFullRecvStats=k,this.lastFullSendStats=b),l&&(this.lastRefRecvStats=k,this.lastRefSendStats=b)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let d=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var l,f;const b=(l=this.requestTransportStats)===null||l===void 0?void 0:l.call(this);return void(b&&((f=this.requestUploadStats)===null||f===void 0||f.call(this,{misc:[{addition:{[joe.RTC_PEER_CONNECTION_STATE]:Ide[b.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(d),++d===e0e+1&&(d=1)},Boe)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(d,l,f){if(!this.requestStats)return;if(!f)return d.rtt==null?void 0:{addition:{[G4.RTT]:d.rtt,[G4.CONN_TYPE]:void 0,[G4.STATS_UPDATE_INTERVAL]:d.updateInterval||void 0}};const b=Rye(d);if(this.store.useP2P){if(l){const k=Rye(l);b[G4.CONN_TYPE]+=k[G4.CONN_TYPE]<<3}b[G4.CONN_TYPE]+=110}else b[G4.CONN_TYPE]+=100;return{addition:b}}getOutboundStats(d,l,f,b){if(!this.requestUploadStats||!this.requestLocalMedia)return;const k=this.requestLocalMedia();if(!k||k.length===0)return;let B,Wt,$O;return k.forEach(uN=>{let[lN,{track:_N,ssrcs:TN}]=uN;switch(lN){case JH.LocalVideoLowTrack:case JH.LocalVideoTrack:if(lN===JH.LocalVideoTrack){const vN=function(iH,lH,hH,bH,PH,OH){const wH=lH.videoSend.find(p5=>p5.ssrc===iH);if(!wH)return;const BH={},{sentFrame:XH,inputFrame:d5}=wH;if(OH&&(O5(BH,lK.QP_SUM,wH.qpSumPerFrame),d5&&XH)){const p5=d5.frameRate,$5=XH.frameRate;BH[lK.FREEZE]=function(e6,N6){let aK=!0;return aK=!(e6<=5)&&(e6<=10?N6<3:e6<=20?N6<4:N6<5),aK}(p5,$5)?1:0}if(PH){switch(XH&&(O5(BH,lK.HEIGHT,XH.height),O5(BH,lK.WIDTH,XH.width),O5(BH,lK.FRAME_RATE,XH.frameRate)),BH[lK.DISABLED]=bH._originMediaStreamTrack&&!bH._originMediaStreamTrack.enabled||bH._mediaStreamTrack&&!bH._mediaStreamTrack.enabled?1:0,wH.adaptionChangeReason){case"none":BH[lK.ADAPTATION]=0;break;case"cpu":BH[lK.ADAPTATION]=1;break;case"bandwidth":BH[lK.ADAPTATION]=2;break;case"other":BH[lK.ADAPTATION]=3}let p5=0;wH.adaptionChangeReason&&(p5+=bye(wH.adaptionChangeReason)),lH.qualityLimitationReason&&(p5+=bye(lH.qualityLimitationReason)<<3),BH[lK.ADAPTATION]=p5,BH[lK.PLAYER_STATUS]=Fde[bH._player?bH._player.videoElementStatus:"uninit"],O5(BH,lK.NACKS,wH.nacksCount),O5(BH,lK.PLIS,wH.plisCount),O5(BH,lK.FIRS,wH.firsCount),O5(BH,lK.AVG_ENCODE,wH.avgEncodeMs),O5(BH,lK.HUGE_FRAME_SENT,wH.hugeFramesSent),O5(BH,lK.BYTES_RETRANSMIT,wH.retransmittedBytesSent),O5(BH,lK.PACKAGES_RETRANSMIT,wH.retransmittedPacketsSent),O5(BH,lK.KEY_FRAMES_ENCODED,wH.keyFramesEncoded);const $5=hH&&hH.videoSend.find(e6=>e6.ssrc===iH);if($5){let e6=PH?Boe:6e3;$5.timestamp&&wH.timestamp&&(e6=wH.timestamp-$5.timestamp),$5.packets!=null&&wH.packets!=null&&O5(BH,lK.PACKAGE_RATE,1e3*(wH.packets-$5.packets)/e6),wH.packetsLost!=null&&$5.packetsLost!=null&&O5(BH,lK.PACKAGE_LOST,wH.packetsLost-$5.packetsLost),$5.bytes!=null&&wH.bytes!=null&&O5(BH,lK.BITRATE,8*(wH.bytes-$5.bytes)/e6)}}return BH}(TN[0].ssrcId,d,l,_N,f,b),uH=_N&&function(iH,lH,hH,bH){const PH=lH.videoSend.find(wH=>wH.ssrc===iH);if(!PH)return null;const OH={};if(bH){const wH=PH.inputFrame,BH=wH&&wH.height||hH.videoHeight||0,XH=wH&&wH.width||hH.videoWidth||0,d5=wH&&wH.frameRate||0;O5(OH,Foe.HEIGHT,BH),O5(OH,Foe.WIDTH,XH),O5(OH,Foe.FRAME_RATE,d5)}return OH}(TN[0].ssrcId,d,_N,f),rH=function(iH,lH){const hH={};return lH&&(O5(hH,lK.RETRANSMIT,iH.bitrate.retransmit),O5(hH,lK.TARGET_ENCODED,iH.bitrate.targetEncoded),O5(hH,lK.ACTUAL_ENCODED,iH.bitrate.actualEncoded),O5(hH,lK.TRANSMIT,iH.bitrate.transmit),O5(hH,lK.BANDWIDTH,iH.sendBandwidth)),hH}(d,f);Wt=Object.assign({},vN,uH,rH)}else $O=function(vN,uH,rH,iH){const lH=uH.videoSend.find(bH=>bH.ssrc===vN);if(!lH)return;const hH={};if(iH){const bH=lH.sentFrame;if(bH&&(O5(hH,AQ.HEIGHT,bH.height),O5(hH,AQ.WIDTH,bH.width),O5(hH,AQ.FRAME_RATE,bH.frameRate)),rH){const PH=rH.videoSend.find(OH=>OH.ssrc===vN);if(PH){let OH=6e3;PH.timestamp&&lH.timestamp&&(OH=lH.timestamp-PH.timestamp),PH.packets!=null&&lH.packets!=null&&O5(hH,AQ.PACKAGE_RATE,1e3*(lH.packets-PH.packets)/OH),lH.packetsLost!=null&&PH.packetsLost!=null&&O5(hH,AQ.PACKAGE_LOST,lH.packetsLost-PH.packetsLost),PH.bytes!=null&&lH.bytes!=null&&O5(hH,AQ.BITRATE,8*(lH.bytes-PH.bytes)/OH)}}}return hH}(TN[0].ssrcId,d,l,f);break;case JH.LocalAudioTrack:B=_N&&function(vN,uH,rH,iH,lH){const hH=uH.audioSend.find(PH=>PH.ssrc===vN);if(!hH)return;const bH={};if(lH){bH[HJ.DISABLED]=iH._originMediaStreamTrack&&!iH._originMediaStreamTrack.enabled||iH._mediaStreamTrack&&!iH._mediaStreamTrack.enabled?1:0;const PH=100*iH._source.getAccurateVolumeLevel(),OH=hH.inputLevel;if(OH!=null){const BH=Math.ceil(50*Math.log10(100*OH+1));O5(bH,HJ.LEVEL,BH)}O5(bH,Sye.PCM_LEVEL,PH),O5(bH,HJ.AEC_RETURN_LOSS,hH.aecReturnLoss),O5(bH,HJ.AEC_RETURN_LOSS_ENH,hH.aecReturnLossEnhancement),O5(bH,HJ.BYTES_RETRANSMIT,hH.retransmittedBytesSent),O5(bH,HJ.PACKAGES_RETRANSMIT,hH.retransmittedPacketsSent),bH[HJ.FREEZE]=0;const wH=rH&&rH.audioSend.find(BH=>BH.ssrc===vN);if(wH){let BH=6e3;wH.timestamp&&hH.timestamp&&(BH=hH.timestamp-wH.timestamp),wH.bytes!=null&&hH.bytes!=null&&O5(bH,HJ.BITRATE,8*(hH.bytes-wH.bytes)/BH),wH.packets!=null&&hH.packets!=null&&O5(bH,HJ.PACKAGE_RATE,1e3*(hH.packets-wH.packets)/BH)}}return bH}(TN[0].ssrcId,d,l,_N,f)}}),{high:Wt,low:$O,audio:B}}getInboundStats(d,l,f,b){if(!this.requestRemoteMedia)return;const k=this.requestRemoteMedia()||[],B=[];return k.forEach(Wt=>{let[$O,uN]=Wt;const lN={peer:$O.uid};if(uN.has(_5.VIDEO)&&$O.videoTrack){const _N=$O._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady($O._videoSSRC)||!1,TN=$O.videoTrack?function(vN,uH,rH,iH,lH,hH,bH,PH){const OH=uH.videoRecv.find(e6=>e6.ssrc===vN);if(!OH)return;const wH={},{receivedFrame:BH,outputFrame:XH,decodeFrameRate:d5}=OH,p5=rH&&rH.videoRecv.find(e6=>e6.ssrc===vN);if(O5(wH,OQ.FRAME_RATE_DECODE,d5),OH.framesRateFirefox&&O5(wH,hK.FRAME_RATE,OH.framesRateFirefox),BH&&O5(wH,hK.FRAME_RATE,BH.frameRate),O5(wH,hK.FRAMES_DROPPED,OH.framesDroppedCount),O5(wH,hK.BYTES_RETRANSMIT,OH.retransmittedBytesReceived),O5(wH,hK.PACKAGES_RETRANSMIT,OH.retransmittedPacketsReceived),O5(wH,hK.PACKAGES_DISCARDED,OH.packetsDiscarded),O5(wH,hK.AVG_DECODE,OH.avgDecodeMs),O5(wH,hK.AVG_PROCESSING_DELAY,OH.avgProcessingDelayMs),O5(wH,hK.AVG_ASSEMBLY_TIME,OH.avgFramesAssembledFromMultiplePacketsMs),O5(wH,hK.AVG_INTER_FRAME_DELAY,OH.avgInterFrameDelayMs),O5(wH,hK.KEY_FRAMES_DECODED,OH.keyFramesDecoded),p5){const e6=uH.timestamp-rH.timestamp||Boe*(PH?6:bH?3:1);OH.packetsLost!=null&&p5.packetsLost!=null&&O5(wH,hK.PACKAGE_LOST,OH.packetsLost-p5.packetsLost),p5.bytes!=null&&OH.bytes!=null&&O5(wH,hK.BITRATE,8*(OH.bytes-p5.bytes)/e6),p5.packets!=null&&OH.packets!=null&&O5(wH,hK.PACKAGE_RATE,1e3*(OH.packets-p5.packets)/e6)}if(PH&&(O5(wH,hK.QP_SUM,OH.qpSumPerFrame),wH[hK.FREEZE]=lH&&Lne.isRemoteVideoFreeze(iH,OH,p5)?1:0),bH){var $5;BH?(O5(wH,hK.HEIGHT,BH.height),O5(wH,hK.WIDTH,BH.width)):iH&&(O5(wH,hK.HEIGHT,iH._videoHeight||0),O5(wH,hK.WIDTH,iH._videoWidth||0)),XH&&O5(wH,OQ.FRAME_RATE_OUTPUT,XH.frameRate);const e6=($5=iH._player)===null||$5===void 0?void 0:$5.rendFrameRate.toFixed(0);if(e6&&O5(wH,OQ.FRAME_RATE_RENDER,+e6),O5(wH,hK.JITTER_BUFFER,OH.jitterBufferMs),O5(wH,hK.CURRENT_DELAY,OH.currentDelayMs),O5(wH,hK.FIRS,OH.firsCount),O5(wH,hK.NACKS,OH.nacksCount),O5(wH,hK.PLIS,OH.plisCount),iH){wH[hK.DISABLED]=iH._originMediaStreamTrack.enabled&&iH._mediaStreamTrack.enabled?0:1;const N6=iH._player;if(N6){const{freezeTimeCounterList:aK,renderFreezeAccTime:eK,videoElementStatus:H4}=N6;if(aK&&aK.length>0&&O5(wH,OQ.FREEZE_TIME,aK.splice(0,1)[0]),hH&&P7.visibility==="visible"&&H4===f4.PLAYING&&u6().supportRequestVideoFrameCallback){const qH=Math.min(6e3,eK);N6.renderFreezeAccTime=Math.max(0,eK-qH),O5(wH,OQ.FREEZE_TIME_RENDER,qH)}if(typeof OH.totalFreezesDuration=="number"){const qH=p5&&p5.totalFreezesDuration?OH.totalFreezesDuration-p5.totalFreezesDuration:OH.totalFreezesDuration;O5(wH,OQ.FREEZE_DURATION,1e3*qH)}}}if(wH[hK.PLAYER_STATUS]=Fde[iH._player?iH._player.videoElementStatus:"uninit"],p5&&OH.totalInterFrameDelay!==void 0&&OH.totalSquaredInterFrameDelay!==void 0&&p5.totalInterFrameDelay!==void 0&&p5.totalSquaredInterFrameDelay!==void 0){const N6=OH.totalInterFrameDelay-p5.totalInterFrameDelay,aK=OH.totalSquaredInterFrameDelay-p5.totalSquaredInterFrameDelay,eK=OH.framesDecodeCount-p5.framesDecodeCount,H4=N6/eK*1e3,qH=Math.round(1e3*Math.sqrt((aK-Math.pow(N6,2)/eK)/eK));!isNaN(qH)&&H4+qH>Math.max(3*H4,H4+150)&&(wH[hK.I_FRAME_DELAY]=qH)}}return wH}($O._videoSSRC,d,l,$O.videoTrack,_N===!0,this.needUploadRenderFreezeTime,f,b):void 0;TN&&(lN.video=TN)}if(uN.has(_5.AUDIO)&&$O.audioTrack){const _N=$O.audioTrack?function(TN,vN,uH,rH,iH,lH){const hH=vN.audioRecv.find(wH=>wH.ssrc===TN);if(!hH)return;const bH={},PH=uH&&uH.audioRecv.find(wH=>wH.ssrc===TN);if(O5(bH,t8.JITTER,hH.jitterMs),O5(bH,t8.BYTES_RETRANSMIT,hH.retransmittedBytesReceived),O5(bH,t8.PACKAGES_RETRANSMIT,hH.retransmittedPacketsReceived),O5(bH,t8.PACKAGES_DISCARDED,hH.packetsDiscarded),O5(bH,t8.AVG_PROCESSING_DELAY,hH.avgProcessingDelayMs),PH){const wH=vN.timestamp-uH.timestamp||Boe*(lH?6:iH?3:1);hH.packets!=null&&PH.packets!=null&&O5(bH,t8.PACKAGE_RATE,1e3*(hH.packets-PH.packets)/wH),iH&&PH.bytes!=null&&hH.bytes!=null&&O5(bH,t8.BITRATE,8*(hH.bytes-PH.bytes)/wH),hH.packetsLost!=null&&PH.packetsLost!=null&&O5(bH,t8.PACKAGE_LOST,hH.packetsLost-PH.packetsLost)}if(lH){const{receivedFrames:wH,droppedFrames:BH}=hH;wH!=null&&BH!=null&&(bH[t8.FREEZE]=(OH=wH)===0||100*BH/OH>20?1:0)}var OH;if(iH){const wH=100*rH._source.getAccurateVolumeLevel(),BH=hH.outputLevel;if(BH!=null){const XH=Math.ceil(50*Math.log10(100*BH+1));O5(bH,yye.LEVEL,XH)}if(O5(bH,t8.PCM_LEVEL,wH),rH&&(bH[t8.DISABLED]=rH._originMediaStreamTrack.enabled&&rH._mediaStreamTrack.enabled?0:1),O5(bH,t8.JITTER_BUFFER,hH.jitterBufferMs),O5(bH,t8.CURRENT_DELAY,hH.jitterBufferMs),bH[t8.PLAYER_STATUS]=Fde[j4.getPlayerState(rH.getTrackId())],PH){const XH=hH.concealedSamples-PH.concealedSamples;XH>0&&O5(bH,t8.CONCEALED_SAMPLES,XH)}}return bH}($O._audioSSRC,d,l,$O.audioTrack,f,b):void 0;_N&&(lN.audio=_N)}(lN.video||lN.audio)&&B.push(lN)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,B}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const d=(this.requestAllTracks()||[]).find(l=>l instanceof doe);if(d&&d._external.getDenoiserStats){const l=d._external.getDenoiserStats();l&&this.requestUpload(Cne.DENOISER_STATS,l)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(d=>{d.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(d=>{let[l,f]=d;f.has(_5.VIDEO)&&l.videoTrack&&l.videoTrack.getProcessorStats().forEach(b=>{this.requestUpload&&this.requestUpload(b.type,b.stats)}),f.has(_5.AUDIO)&&l.audioTrack&&l.audioTrack.getProcessorStats().forEach(b=>{this.requestUpload&&this.requestUpload(b.type,b.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const d=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const l=Date.now(),f={connectionInterval:_H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:l};let b=[];const k=this.requestAllTracks&&this.requestAllTracks()||[];for(const uN of k)!uN.muted&&uN.enabled&&(b=b.concat(await uN.getProcessorUsage()));const B=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[uN,lN]of B)lN.has(_5.VIDEO)&&uN.videoTrack&&(b=b.concat(await uN.videoTrack.getProcessorUsage())),lN.has(_5.AUDIO)&&uN.audioTrack&&(b=b.concat(await uN.audioTrack.getProcessorUsage()));if(b.length===0)return;f.details=function(uN,lN){const _N={};for(const{id:rH,value:iH,level:lH,direction:hH}of uN){var TN;const bH=(TN=lN.get(rH))!==null&&TN!==void 0?TN:0,PH=iH===2?bH+_H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:bH;var vN,uH;lN.set(rH,PH),_N[rH]?(iH===2&&(_N[rH].value=iH),lH>_N[rH].level&&(_N[rH].level=lH),hH==="remote"&&(_N[rH].remoteUidCount+=1),_N[rH].totalTs=(vN=lN.get(rH))!==null&&vN!==void 0?vN:0):_N[rH]={value:iH,level:lH,remoteUidCount:hH==="local"?0:1,totalTs:(uH=lN.get(rH))!==null&&uH!==void 0?uH:0}}return Object.keys(_N).map(rH=>{const{level:iH,value:lH,totalTs:hH}=_N[rH];return{id:rH,level:iH,value:lH,totalTs:hH}})}(b,d);const Wt=Date.now(),$O=Wt>l?Wt:l+1;this.requestUpload&&this.requestUpload(Cne.EXTENSION_USAGE_STATS,{usageStats:f,sendTs:$O})},_H("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const t0e=_H("ICE_RESTART_INTERVAL");let Goe=new Map,ree=new Map,WX=[d4.UDP_TCP_RELAY,d4.TCP_RELAY,d4.RELAY],Nle=_H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&u6().supportPCSetConfiguration;function Cye(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const l=Goe.get(s.id);l&&(window.clearTimeout(l),Goe.delete(s.id));const f=ree.get(s.id);d&&f&&f.index===WX.length-1&&(CN.debug("[".concat(s.id,"] reset ICE restart policy")),ree.delete(s.id))}function Iye(s,d,l){if(Goe.size===0&&ree.size===0&&(Array.isArray(_H("RESTART_SEQUENCE"))&&_H("RESTART_SEQUENCE").length>0&&!function(Wt,$O){if(Wt.length!==$O.length)return!1;for(let uN=0;uN<Wt.length;uN+=1){const lN=Wt[uN];if(Wt.filter(_N=>_N===lN).length!==$O.filter(_N=>_N===lN).length)return!1}return!0}(WX,_H("RESTART_SEQUENCE"))&&(WX=_H("RESTART_SEQUENCE").filter(Wt=>{var $O;if(a5($O=Object.values(d4)).call($O,Wt))return!0}),CN.debug("use reconnection policy from config distribution, queues: ".concat(WX.join(" => ")))),Nle=_H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&u6().supportPCSetConfiguration),WX.length===0)return void l();let f,{index:b=0,type:k}=ree.get(s.id)||{};if(Nle&&k===d4.RELAY)return void l();let B=k&&b>=WX.length-1;if(Nle)k=d4.RELAY;else{if(B)return void l();k?(b++,k=WX[b]):(k=WX[0],b=0)}CN.debug("[".concat(s.id,"] choose ICE restart policy: ").concat(k,", index: ").concat(b)),d(k),ree.set(s.id,{index:b,type:k}),f=window.setTimeout(()=>Iye(s,d,l),t0e),Goe.set(s.id,f)}var q5;function wye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function qJ(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?wye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):wye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}function Aye(s){var d,l,f,b=2;for(typeof Symbol<"u"&&(l=nde,f=Symbol.iterator);b--;){if(l&&(d=s[l])!=null)return d.call(s);if(f&&(d=s[f])!=null)return new Woe(d.call(s));l="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}function Woe(s){function d(l){if(Object(l)!==l)return u5.reject(new TypeError(l+" is not an object."));var f=l.done;return u5.resolve(l.value).then(function(b){return{value:b,done:f}})}return Woe=function(l){this.s=l,this.n=l.next},Woe.prototype={s:null,n:null,next:function(){return d(this.n.apply(this.s,arguments))},return:function(l){var f=this.s.return;return f===void 0?u5.resolve({value:l,done:!0}):d(f.apply(this.s,arguments))},throw:function(l){var f=this.s.return;return f===void 0?u5.reject(l):d(f.apply(this.s,arguments))}},new Woe(s)}let Une=(q5=class extends W6{get state(){return this._state}set state(s){const d=this._state;this._state=s,this.emit(v5.StateChange,d,this._state)}constructor(s,d){super(),cH(this,"isPlanB",void 0),cH(this,"store",void 0),cH(this,"statsUploader",void 0),cH(this,"connection",void 0),cH(this,"localTrackMap",new Map),cH(this,"remoteUserMap",new Map),cH(this,"localDataChannels",[]),cH(this,"remoteDataChannelMap",new Map),cH(this,"pendingLocalTracks",[]),cH(this,"pendingRemoteTracks",[]),cH(this,"pendingLocalDataChannels",[]),cH(this,"pendingRemoteDataChannels",[]),cH(this,"statsCollector",void 0),cH(this,"shouldForwardP2PCreation",void 0),cH(this,"iceFailedCount",0),cH(this,"dtlsFailedCount",0),cH(this,"mutex",void 0),cH(this,"_state",E6.Disconnected),cH(this,"_pcStatsUploadType",_H("NEW_ICE_RESTART")?L7.FIRST_CONNECTION:L7.OLD_FIRST_CONNECTION),cH(this,"_isStartRestartIce",!1),cH(this,"_restartTimer",void 0),cH(this,"_isTryConnecting",!1),cH(this,"_iceError",null),cH(this,"_forceTurn",!1),cH(this,"_isWaitPcToRePub",!1),cH(this,"handleMuteLocalTrack",async(l,f,b)=>{const k=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==E6.Connected)return void b(new jH(dH.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const B=this.filterTobeMutedTracks(l);if(B.length===0)return void f();const Wt=B.find(uN=>uN[0]==="videoLowTrack");Wt&&Wt[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(B.map(uN=>{let[,{id:lN}]=uN;return lN}));const $O=this.createMuteMessage(B);await w6(this,v5.RequestMuteLocal,$O),f()}catch(B){b(B)}finally{k()}}),cH(this,"handleUnmuteLocalTrack",async(l,f,b)=>{const k=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==E6.Connected)return void b(new jH(dH.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const B=this.filterTobeUnmutedTracks(l);if(B.length===0)return void f();const Wt=B.find(uN=>uN[0]==="videoLowTrack");if(Wt){const uN=Wt[1];if(uN.track._originMediaStreamTrack.stop(),!_H("DISABLE_DUAL_STREAM_USE_ENCODING")&&u6().supportDualStreamEncoding){const lN=l._mediaStreamTrack.clone();uN.track._mediaStreamTrack=lN,uN.track._originMediaStreamTrack=lN}else{const lN=Ole(l,gne(this,v5.RequestLowStreamParameter));uN.track._mediaStreamTrack=lN,uN.track._originMediaStreamTrack=lN}await new u5((lN,_N)=>{this.handleReplaceTrack(uN.track,lN,_N,!0)})}await this.connection.unmuteLocal(B.map(uN=>{let[,{id:lN}]=uN;return lN}));const $O=this.createUnmuteMessage(B);await w6(this,v5.RequestUnmuteLocal,$O),f()}catch(B){b(B)}finally{k()}}),cH(this,"handleUpdateVideoEncoder",async(l,f,b,k)=>{let B;k||(B=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const $O=this.localTrackMap.get(JH.LocalVideoTrack);if(!this.connection||!$O||$O.track!==l||this.state!==E6.Connected)return void f();const{id:uN,track:lN}=$O;await this.connection.updateSendParameters(uN,lN),await this.connection.updateEncoderConfig(uN,lN),this.emit(v5.UpdateVideoEncoder,lN),f()}catch($O){b($O)}finally{var Wt;(Wt=B)===null||Wt===void 0||Wt()}}),cH(this,"handleUpdateVideoSendParameters",async(l,f,b)=>{const k=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const B=this.localTrackMap.get(JH.LocalVideoTrack);if(!this.connection||!B||B.track!==l||this.state!==E6.Connected)return void f();const{id:Wt,track:$O}=B;await this.connection.updateSendParameters(Wt,$O),f()}catch(B){b(B)}finally{k()}}),cH(this,"handleReplaceMixingTrack",async(l,f,b,k)=>{if(!this.connection||this.state!==E6.Connected)return void f();const B=wle([l]);let Wt;CN.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(B.getTrackId(),"]")),typeof k=="boolean"&&k||(Wt=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(l,B),f()}catch(uN){b(uN)}finally{var $O;($O=Wt)===null||$O===void 0||$O()}}),cH(this,"handleReplaceTrack",async(l,f,b,k)=>{let B;CN.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),typeof k=="boolean"&&k||(B=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var Wt;const uN=Array.from(this.localTrackMap.entries()).find(lN=>{let[,{track:_N}]=lN;return l===_N});if(!this.connection||!uN||this.state!==E6.Connected)return void f();if(await((Wt=this.connection)===null||Wt===void 0?void 0:Wt.replaceTrack(l,uN[1].id)),this.isPlanB){const lN=uN[1];lN.id=l._mediaStreamTrack.id,this.localTrackMap.set(uN[0],lN)}if(uN[0]===JH.LocalVideoTrack&&!_H("DISABLE_DUAL_STREAM_USE_ENCODING")&&u6().supportDualStreamEncoding){const lN=this.localTrackMap.get(JH.LocalVideoLowTrack);if(lN){const _N=l._mediaStreamTrack.clone();lN.track._originMediaStreamTrack.stop(),lN.track._mediaStreamTrack=_N,lN.track._originMediaStreamTrack=_N,await new u5((TN,vN)=>{this.handleReplaceTrack(lN.track,TN,vN,!0)})}}f()}catch(uN){b(uN)}finally{var $O;($O=B)===null||$O===void 0||$O()}}),cH(this,"handleGetRTCStats",l=>{l(this.statsCollector.getRTCStats())}),cH(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),cH(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),cH(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),cH(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=s,this.statsCollector=d,this.statsCollector.addP2PChannel(this),this.statsUploader=new vye(this.store),this.bindStatsUploaderEvents(),this.mutex=new t4("P2PChannel-mutex",this.store.clientId),this.isPlanB=!u6().supportUnifiedPlan||_H("CHROME_FORCE_PLAN_B")&&A7(),this.shouldForwardP2PCreation=_H("FORWARD_P2P_CREATION")&&u6().supportPCSetConfiguration&&pde(),this.shouldForwardP2PCreation&&(this.connection=Voe(this.store),this.emit(v5.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(s){var d;this.state=E6.New,this._forceTurn=gye(s),CN.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const l=this.shouldForwardP2PCreation&&((d=this.connection)===null||d===void 0?void 0:d.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!l||(l&&this.connection&&(CN.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Voe(this.store,s),this.emit(v5.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new jH(dH.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=_H("NEW_ICE_RESTART")?L7.FIRST_CONNECTION:L7.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(s),this.connection.establishPromise}async connect(s){if(!this.connection)throw new jH(dH.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");_H("ENABLE_PREALLOC_PC")&&this.state===E6.Connected?await this.connection.updateRemoteConnect(s):(this.store.peerConnectionStart(),await this.connection.connect(s),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=E6.Connected)}updateRemoteRTPCapabilities(s){const d=Array.from(this.localTrackMap.entries()).filter(b=>{var k;let[B]=b;return a5(k=[JH.LocalVideoLowTrack,JH.LocalVideoTrack]).call(k,B)}),l=d.map(b=>{let[,{id:k}]=b;return k}),f=d.map(b=>{let[k]=b;return k});if(this.connection instanceof x7){if(T5.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(f),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(s)}),!a5(s).call(s,this.store.codec)){const b=["vp9","vp8","h264"].find(k=>a5(s).call(s,k));b&&(this.store.codec=b,CN.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(b,".")))}this.connection.updateRemoteRTPCapabilities(l,s)}}async getEstablishParams(){var s;if(this.connection instanceof x7&&this.connection.peerConnectionState!=="closed"&&a5(s=[E6.New,E6.Connected]).call(s,this.state))return this.connection.establishPromise}async publishDataChannel(s){if(!this.connection||this.state!==E6.Connected){if(this.state===E6.Disconnected)throw new jH(dH.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return s.forEach(l=>{var f;a5(f=this.pendingLocalDataChannels).call(f,l)||this.pendingLocalDataChannels.push(l)}),[]}const d=this.filterTobePublishedDataChannels(s);return d.length===0?[]:(d.forEach(l=>{const f=Date.now();this.store.publish(l.id.toString(),"datachannel",f)}),await this.connection.createDataChannels(this.store.uid,d),d.forEach(l=>{this.localDataChannels.push(l);const f=Date.now();this.store.publish(l.id+"","datachannel",void 0,f)}),s.map(l=>({streamId:l.id,ordered:l.ordered,maxRetransmits:l.maxRetransmits,metadata:l.metadata,channelId:l._originDataChannelId})))}publish(s,d,l){var f=this;return H8(function*(){const b=yield i6(f.mutex.lock("From P2PChannel.publish"));try{var k;const B=f.connection&&a5(k=["disconnected","failed"]).call(k,f.connection.peerConnectionState);if(!f.connection||f.state!==E6.Connected||B){if(f.state===E6.Disconnected)throw new jH(dH.UNEXPECTED_ERROR,"PeerConnection already disconnected.");f.throwIfTrackTypeNotMatch(s);const $O=s.filter(uN=>f.pendingLocalTracks.indexOf(uN)===-1);return f.pendingLocalTracks=f.pendingLocalTracks.concat($O),void(B&&(f._isWaitPcToRePub=!0))}f.store.pubId=f.store.pubId+1,r4.markPublishStart(f.store.clientId,f.store.pubId);const Wt=f.filterTobePublishedTracks(s,d,l);if(Wt.length===0)return void(yield i6(f.tryToUnmuteAudio(s)));yield*xse(Aye(f.doPublish(f.connection,Wt)))}finally{b()}})()}doPublish(s,d){var l=this;return H8(function*(){d.forEach(TN=>{let{track:vN,type:uH}=TN;const rH=Date.now();l.store.publish(vN.getTrackId(),uH===JH.LocalAudioTrack?"audio":"video",rH)}),l.bindLocalTrackEvents(d);const f=d.map(TN=>{let{track:vN}=TN;return vN}),b=yield i6(s.send(f,l.store.codec,l.store.audioCodec)),k=(yield i6(b.next())).value,B=l.createGatewayPublishMessage(d,k);let Wt;try{Wt=yield B}catch(TN){throw b.throw(TN),(TN==null?void 0:TN.code)===dH.WS_ABORT&&d.forEach(vN=>{let{track:uH}=vN;l.pendingLocalTracks.indexOf(uH)===-1&&l.pendingLocalTracks.push(uH)}),l.unbindLocalTrackEvents(d),TN}const $O=l.mapPubResToRemoteConfig(B,Wt,f),uN=(yield i6(b.next($O))).value;if(l.state===E6.Disconnected)throw new jH(dH.UNEXPECTED_ERROR,"PeerConnection already disconnected.");_H("ENABLE_VIDEO_SEI");const lN=_H("ENABLE_ENCODED_TRANSFORM"),_N=_H("ENABLE_AUDIO_METADATA");f.forEach(async TN=>{const vN=TN.getRTCRtpTransceiver();vN&&lN&&(TN.trackMediaType===_5.VIDEO?await YDe(vN.sender,TN):TN.trackMediaType===_5.AUDIO&&await jDe(vN.sender,{metadata:_N?()=>{const uH=TN.metadata.shift();return uH&&uH.value}:void 0}))}),d.forEach(TN=>{let{type:vN}=TN;l.statsCollector.addLocalStats(vN)}),l.assignLocalTracks(d,uN),l.statsUploader.startUploadOutboundStats(),d.forEach(TN=>{let{track:vN,type:uH}=TN;const rH=Date.now();l.store.publish(vN.getTrackId(),uH===JH.LocalAudioTrack?"audio":"video",void 0,rH)})})()}async updateVideoStreamParameter(s,d){const l=this.localTrackMap.get(d);if(!l||!this.connection)return;if(!(l.track instanceof x6))return CN.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:f}=l,b=function(k,B){const Wt={};return k.height&&k.width&&(Wt.scaleResolutionDownBy=lle(k,B)),Wt.maxFramerate=k.framerate?h8(k.framerate):void 0,Wt.maxBitrate=k.bitrate?1e3*k.bitrate:void 0,Wt}(s,f);if(f._encoderConfig||(f._encoderConfig={}),d!==JH.LocalVideoLowTrack||!_H("DISABLE_DUAL_STREAM_USE_ENCODING")&&u6().supportDualStreamEncoding)b.scaleResolutionDownBy!=null&&(f._encoderConfig.scaleResolutionDownBy=b.scaleResolutionDownBy);else{const k=f._originMediaStreamTrack;if(!k.canvas)return CN.warn("[".concat(f.getTrackId(),"] no canvas on track"));(function(B,Wt){const $O=B.canvas;Wt.width&&($O.width=h8(Wt.width)),Wt.height&&($O.height=h8(Wt.height)),Wt.framerate&&($O.stopCapture&&$O.stopCapture(),$O.stopCapture=Bde(()=>{!$O.startCapture&&$O.stopCapture&&$O.stopCapture(),$O.startCapture&&$O.startCapture()},h8(Wt.framerate)))})(k,s)}b.maxBitrate!=null&&(f._encoderConfig.bitrateMax=b.maxBitrate/1e3),b.maxFramerate!=null&&(f._encoderConfig.frameRate&&typeof f._encoderConfig.frameRate=="object"?f._encoderConfig.frameRate.max=b.maxFramerate:f._encoderConfig.frameRate={max:b.maxFramerate}),CN.debug("[".concat(f.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(f._encoderConfig))),await this.connection.updateRtpSenderEncodings(f)}publishLowStream(s){var d=this;return H8(function*(){if(!d.connection||d.state!==E6.Connected)return;const l=yield i6(d.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const b=d.localTrackMap.get(JH.LocalVideoTrack);if(!b)throw new jH(dH.UNEXPECTED_ERROR,"Could not find high stream");if(d.localTrackMap.has(JH.LocalVideoLowTrack))throw new jH(dH.UNEXPECTED_ERROR,"[".concat(d.store.clientId,"] Can't publish low stream when stream already publish"));const k=[{track:d.getLowVideoTrack(b.track,s),type:JH.LocalVideoLowTrack}];if(yield*xse(Aye(d.doPublish(d.connection,k))),b.track.muted||!b.track.enabled){var f;const B=(f=d.localTrackMap.get(JH.LocalVideoLowTrack))===null||f===void 0?void 0:f.id;B!==void 0&&(yield i6(d.connection.muteLocal([B])))}}finally{l()}})()}async republish(){this.pendingLocalTracks.length>0&&(CN.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await YK(this,v5.RequestRePublish,this.pendingLocalTracks),this.emit(v5.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(CN.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await YK(this,v5.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(s){for(let d=this.pendingRemoteTracks.length-1;d>=0;d--){const{user:l,kind:f}=this.pendingRemoteTracks[d];(f!==_5.AUDIO||l._audio_added_&&l._audioSSRC)&&(f!==_5.VIDEO||l._video_added_&&l._videoSSRC)||this.pendingRemoteTracks.splice(d,1)}if(s)await YK(this,v5.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:d,kind:l}of this.pendingRemoteTracks)await this.subscribe(d,l,l===_5.VIDEO?d._videoSSRC:d._audioSSRC);this.pendingRemoteTracks.forEach(d=>{let{user:l}=d;this.emit(v5.MediaReconnectEnd,l.uid)}),this.pendingRemoteTracks=[]}async unpublish(s){if(!this.connection||this.state!==E6.Connected)return void s.forEach(f=>{const b=this.pendingLocalTracks.indexOf(f);b!==-1&&this.pendingLocalTracks.splice(b,1)});const d=this.filterTobeUnpublishedTracks(s);if(d.length===0)return;const l=d.find(f=>f[0]==="videoLowTrack");return l&&l[1].track.close(),this.doUnpublish(this.connection,d)}async unpublishDataChannel(s){if(!this.connection||this.state!==E6.Connected)return void s.forEach(l=>{const f=this.pendingLocalDataChannels.indexOf(l);f!==-1&&this.pendingLocalDataChannels.splice(f,1)});const d=this.filterTobeUnpublishedDataChannels(s);return d.length!==0?(d.forEach(l=>{const f=this.localDataChannels.indexOf(l);f!==-1&&this.localDataChannels.splice(f,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),d.map(l=>l.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==E6.Connected)return;const s=this.localTrackMap.get(JH.LocalVideoLowTrack);if(!s)return;s.track.close();const d=[[JH.LocalVideoLowTrack,s]];return this.doUnpublish(this.connection,d)}async doUnpublish(s,d){const l=this.createGatewayUnpublishMessage(d);return await s.stopSending(d.map(f=>{let[,{id:b}]=f;return b})),this.withdrawLocalTracks(d),this.unbindLocalTrackEvents(d.map(f=>{let[b,{track:k}]=f;return{type:b,track:k}})),d.forEach(f=>{let[b]=f;this.statsCollector.removeLocalStats(b)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),l}async subscribeDataChannel(s,d){if(!this.connection||this.state!==E6.Connected)throw new jH(dH.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const l=d.filter(f=>{var b;return!((b=this.remoteDataChannelMap.get(s))!==null&&b!==void 0&&b.get(f.id))});if(l.length!==0)return await this.connection.createDataChannels(s.uid,l),l.forEach(f=>{var b;this.remoteDataChannelMap.has(s)?(b=this.remoteDataChannelMap.get(s))===null||b===void 0||b.set(f.id,f):this.remoteDataChannelMap.set(s,new Map([[f.id,f]]));const k=this.pendingRemoteDataChannels.findIndex(B=>{let{user:Wt,id:$O}=B;return Wt.uid===s.uid&&$O===f.id});k!==-1&&this.pendingRemoteDataChannels.splice(k,1)}),l.map(f=>f.id)}async subscribe(s,d,l,f,b){var k;if(!this.connection||this.state!==E6.Connected)throw new jH(dH.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((k=this.remoteUserMap.get(s))!==null&&k!==void 0&&k.has(d))return;let B,Wt,$O;const uN=this.connection.getPreMedia(l);if(uN)CN.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(l,", no need to send sub to gateway.")),$O=uN.transceiver,B=uN.track,Wt=uN.id;else if(b){const TN=b.find(uH=>{let{stream_type:rH}=uH;return rH===d});if(!TN)throw new jH(dH.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(d," for user: ").concat(s.uid," because subscribe answer from gateway does not contain stream_type: ").concat(d,"."));const vN=await this.connection.receive(d,TN.ssrcs,String(s._uintid),TN.attributes);this.connection instanceof x7&&($O=vN.transceiver),B=vN.track,Wt=vN.id}else{const TN=await this.connection.receive(d,[{ssrcId:l,rtx:f}],String(s._uintid),void 0);this.connection instanceof x7&&($O=TN.transceiver),B=TN.track,Wt=TN.id}d===_5.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(B):(s._audioTrack=new G$(B,s.uid,s._uintid,this.store),CN.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),$O&&s._audioTrack._updateRtpTransceiver($O),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(B):(s._videoTrack=new B$(B,s.uid,s._uintid,this.store),CN.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),$O&&s._videoTrack._updateRtpTransceiver($O),this.bindRemoteTrackEvents(s,s._videoTrack)),$O&&_H("ENABLE_ENCODED_TRANSFORM")&&(d==_5.VIDEO?await $de($O.receiver,{onSei:_H("ENABLE_VIDEO_SEI")&&(TN=>{var vN;return(vN=s._videoTrack)===null||vN===void 0?void 0:vN._onSei(TN)})}):d==_5.AUDIO&&await Zde($O.receiver,{enableTopn:!!_H("ENABLE_AUDIO_TOPN"),enableMetadata:!!_H("ENABLE_AUDIO_METADATA"),onMetadata:TN=>{this.safeEmit(v5.AudioMetadata,TN)}}));const lN=this.remoteUserMap.get(s);lN?lN.set(d,Wt):this.remoteUserMap.set(s,new Map([[d,Wt]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const _N=this.pendingRemoteTracks.findIndex(TN=>{let{user:vN,kind:uH}=TN;return vN.uid===s.uid&&d===uH});_N!==-1&&(this.pendingRemoteTracks.splice(_N,1),this.emit(v5.MediaReconnectEnd,s.uid))}async massSubscribe(s){return this.massSubscribeNoLock(s)}async massSubscribeNoLock(s){if(!this.connection||this.state!==E6.Connected)throw new jH(dH.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");s=s.filter(b=>{var k;let{user:B,mediaType:Wt}=b;return!((k=this.remoteUserMap.get(B))!==null&&k!==void 0&&k.has(Wt))});const d=[],l=new Map;s.forEach(b=>{if(!this.connection)return;const k=this.connection.getPreMedia(b.ssrcId);k?l.set(b.ssrcId,k):d.push(b)});const f=await this.connection.batchReceive(d.map(b=>{let{user:k,mediaType:B,ssrcId:Wt,rtxSsrcId:$O}=b;return{kind:B,ssrcMsg:[{ssrcId:Wt,rtx:$O}],mslabel:String(k._uintid)}}));d.forEach((b,k)=>{l.set(b.ssrcId,f[k])});for(const{user:b,mediaType:k,ssrcId:B}of s){const Wt=l.get(B);if(!Wt)return void CN.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(b.uid," subscribe data,").concat(k,", ").concat(B));const{track:$O,id:uN,transceiver:lN}=Wt;lN&&_H("ENABLE_ENCODED_TRANSFORM")&&(k==_5.VIDEO?await $de(lN.receiver,{onSei:_H("ENABLE_VIDEO_SEI")&&(vN=>{var uH;return(uH=b._videoTrack)===null||uH===void 0?void 0:uH._onSei(vN)})}):k==_5.AUDIO&&await Zde(lN.receiver,{enableTopn:!!_H("ENABLE_AUDIO_TOPN"),enableMetadata:!!_H("ENABLE_AUDIO_METADATA"),onMetadata:vN=>{this.safeEmit(v5.AudioMetadata,vN)}})),k===_5.AUDIO?(b._audioTrack?b._audioTrack._updateOriginMediaStreamTrack($O):(b._audioTrack=new G$($O,b.uid,b._uintid,this.store),CN.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(b._audioTrack.getTrackId()))),lN&&b._audioTrack._updateRtpTransceiver(lN),this.bindRemoteTrackEvents(b,b._audioTrack)):(b._videoTrack?b._videoTrack._updateOriginMediaStreamTrack($O):(b._videoTrack=new B$($O,b.uid,b._uintid,this.store),CN.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(b._videoTrack.getTrackId()))),lN&&b._videoTrack._updateRtpTransceiver(lN),this.bindRemoteTrackEvents(b,b._videoTrack)),_H("ENABLE_VIDEO_SEI")&&lN&&(k==_5.VIDEO?await $de(lN.receiver,{onSei:vN=>{var uH;(uH=b._videoTrack)===null||uH===void 0||uH._onSei(vN)}}):k==_5.AUDIO&&await Zde(lN.receiver));const _N=this.remoteUserMap.get(b);_N?_N.set(k,uN):this.remoteUserMap.set(b,new Map([[k,uN]])),this.statsCollector.addRemoteStats(b.uid),this.statsUploader.startUploadInboundStats();const TN=this.pendingRemoteTracks.findIndex(vN=>{let{user:uH,kind:rH}=vN;return uH.uid===b.uid&&k===rH});TN!==-1&&(this.pendingRemoteTracks.splice(TN,1),this.emit(v5.MediaReconnectEnd,b.uid))}}async unsubscribe(s,d,l){const f=this.pendingRemoteTracks.filter(B=>{let{user:Wt,kind:$O}=B;return d!==void 0?Wt.uid===s.uid&&d===$O:Wt.uid===s.uid});if(f.forEach(B=>{const Wt=this.pendingRemoteTracks.indexOf(B);this.pendingRemoteTracks.splice(Wt,1)}),this.connection&&this.state===E6.Connected||l||f.forEach(B=>{let{kind:Wt}=B;var $O;if(Wt===_5.AUDIO)($O=s._audioTrack)===null||$O===void 0||$O._destroy(),s._audioTrack=void 0;else if(Wt===_5.VIDEO){var uN;(uN=s._videoTrack)===null||uN===void 0||uN._destroy(),s._videoTrack=void 0}}),!this.connection||this.state!==E6.Connected)return;const b=this.filterTobeUnSubscribedTracks(s,d);if(b.length===0)return;await this.connection.stopReceiving(b.map(B=>{let[,{id:Wt}]=B;return Wt}));const k=this.createUnsubscribeMessage(b);return this.withdrawRemoteTracks(b),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),b.forEach(B=>{let[Wt,{kind:$O}]=B;var uN,lN;if($O===_5.VIDEO&&Wt._videoSSRC&&((uN=this.connection)===null||uN===void 0||uN.setStatsRemoteVideoIsReady(Wt._videoSSRC,!1)),$O===_5.VIDEO)this.unbindRemoteTrackEvents(Wt._videoTrack),l||((lN=Wt._videoTrack)===null||lN===void 0||lN._destroy(),Wt._videoTrack=void 0);else if($O===_5.AUDIO){var _N;this.unbindRemoteTrackEvents(Wt._audioTrack),!l&&((_N=Wt._audioTrack)===null||_N===void 0||_N._destroy(),Wt._audioTrack=void 0)}}),k}async unsubscribeDataChannel(s,d){if(d.forEach(b=>{const k=this.pendingRemoteDataChannels.findIndex(B=>B.id===b.id);k!==-1&&this.pendingRemoteDataChannels.splice(k,1)}),!this.connection)return;const l=this.filterTobeUnSubscribedDataChannels(s,d);if(l.length===0)return;d.forEach(b=>{b._close()});const f=this.remoteDataChannelMap.get(s);return l.forEach(b=>{f&&f.delete(b.id)}),f&&f.size===0&&(this.remoteDataChannelMap.delete(s),await this.connection.stopDataChannels(s.uid)),l.map(b=>b.id)}async massUnsubscribe(s){return this.massUnsubscribeNoLock(s)}async massUnsubscribeNoLock(s){let d=[];for(const{user:b,mediaType:k}of s){const B=this.pendingRemoteTracks.filter(Wt=>{let{user:$O,kind:uN}=Wt;return k!==void 0?$O.uid===b.uid&&k===uN:$O.uid===b.uid});B.forEach(Wt=>{const $O=this.pendingRemoteTracks.indexOf(Wt);this.pendingRemoteTracks.splice($O,1)}),d=d.concat(B)}if(!this.connection||this.state!==E6.Connected)return void d.forEach(b=>{let{user:k,kind:B}=b;var Wt;if(B===_5.AUDIO)(Wt=k._audioTrack)===null||Wt===void 0||Wt._destroy(),k._audioTrack=void 0;else if(B===_5.VIDEO){var $O;($O=k._videoTrack)===null||$O===void 0||$O._destroy(),k._videoTrack=void 0}});const l=z4(s).call(s,(b,k)=>{let{user:B,mediaType:Wt}=k;const $O=this.filterTobeUnSubscribedTracks(B,Wt);return b.concat($O)},[]);if(l.length===0)return;await this.connection.stopReceiving(l.map(b=>{let[,{id:k}]=b;return k}));const f=this.createUnsubscribeAllMessage(l);return this.withdrawRemoteTracks(l),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),l.forEach(b=>{let[k,{kind:B}]=b;var Wt,$O;if(B===_5.VIDEO&&k._videoSSRC&&((Wt=this.connection)===null||Wt===void 0||Wt.setStatsRemoteVideoIsReady(k._videoSSRC,!1)),B===_5.VIDEO)this.unbindRemoteTrackEvents(k._videoTrack),($O=k._videoTrack)===null||$O===void 0||$O._destroy(),k._videoTrack=void 0;else if(B===_5.AUDIO){var uN;this.unbindRemoteTrackEvents(k._audioTrack),(uN=k._audioTrack)===null||uN===void 0||uN._destroy(),k._audioTrack=void 0}}),f}isPreSubScribe(s){return!this.connection||this.state!==E6.Connected?!1:!!this.connection.getPreMedia(s)}async muteRemote(s,d){if(!this.connection)return;const l=this.remoteUserMap.get(s);if(!l)return void CN.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(s.uid,"."));if(!l.get(d))return void CN.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(s.uid," media type ").concat(d,"."));const f=d===_5.VIDEO?s._videoSSRC:s._audioSSRC;f!==void 0&&this.connection.setStatsRemoteVideoIsReady(f,!1)}async unmuteRemote(s,d){return this.unmuteRemoteNoLock(s,d)}async unmuteRemoteNoLock(s,d){if(!this.connection)return;const l=this.remoteUserMap.get(s);if(!l)return void CN.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(s.uid,"."));l.get(d)||CN.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(s.uid," media type ").concat(d,"."))}addAudioMetadata(s){const d=this.localTrackMap.get(JH.LocalAudioTrack),l=d&&d.track;l&&l.metadata.push(s)}getAllTracks(s){const d=this.localTrackMap.get(JH.LocalAudioTrack);if((d==null?void 0:d.track)instanceof SK){const l=d.track;return Array.from(this.localTrackMap.entries()).filter(f=>{let[b]=f;return b!==JH.LocalAudioTrack}).filter(f=>{let[b]=f;return!(s&&b===JH.LocalVideoLowTrack)}).map(f=>{let[,{track:b}]=f;return b}).concat(l.trackList)}return Array.from(this.localTrackMap.entries()).filter(l=>{let[f]=l;return!(s&&f===JH.LocalVideoLowTrack)}).map(l=>{let[,{track:f}]=l;return f})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(s,d,l,f,b){if(s){const B=this.localTrackMap.get(JH.LocalAudioTrack),Wt=f?this.localTrackMap.get(JH.LocalVideoLowTrack):this.localTrackMap.get(JH.LocalVideoTrack);T5.publish(this.store.sessionId,{eventElapse:r4.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:s,ec:d,audioName:B==null?void 0:B.track.getTrackLabel(),videoName:Wt==null?void 0:Wt.track.getTrackLabel(),screenshare:(Wt==null?void 0:Wt.track._hints.indexOf(O6.SCREEN_TRACK))!==-1,audio:!!B,video:!!Wt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}else{var k;l||(l=[]);const B=l.find($O=>$O instanceof _q),Wt=f?(k=this.localTrackMap.get(JH.LocalVideoTrack))===null||k===void 0?void 0:k.track:l.find($O=>$O instanceof x6);T5.publish(this.store.sessionId,{eventElapse:r4.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:s,ec:d,audioName:B==null?void 0:B.getTrackLabel(),videoName:Wt==null?void 0:Wt.getTrackLabel(),screenshare:(Wt==null?void 0:Wt._hints.indexOf(O6.SCREEN_TRACK))!==-1,audio:!!B,video:!!Wt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}}reportSubscribeEvent(s,d,l,f){const b=f===_5.VIDEO?l._videoSSRC:l._audioSSRC;b&&T5.subscribe(this.store.sessionId,{succ:s,ec:d,video:f===_5.VIDEO,audio:f===_5.AUDIO,peerid:l.uid,subscribeRequestid:b,p2pid:this.store.p2pId,eventElapse:r4.measureFromSubscribeStart(this.store.clientId,b),preSsrc:this.isPreSubScribe(b)})}reset(){CN.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new t4("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Voe(this.store),this.emit(v5.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const s=this.localTrackMap.get(JH.LocalAudioTrack);if((s==null?void 0:s.track)instanceof SK){if(s.track.trackList.length>0){const d=s.track;s.track.trackList.forEach(l=>{d.removeAudioTrack(l)})}s.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=E6.Disconnected}getStats(){var s;return(s=this.connection)===null||s===void 0?void 0:s.getStats()}getRemoteVideoIsReady(s){var d;return((d=this.connection)===null||d===void 0?void 0:d.getRemoteVideoIsReady(s))||!1}getLocalAudioVolume(){const s=this.localTrackMap.get(JH.LocalAudioTrack);if(s)return s.track.getVolumeLevel()}getLocalVideoSize(){const s=this.localTrackMap.get(JH.LocalVideoTrack);if(s)return{width:s.track.videoWidth||0,height:s.track.videoHeight||0}}getEncoderConfig(s){const d=this.localTrackMap.get(s);return d&&d.track instanceof x6||d&&d.track instanceof _q?d.track._encoderConfig:void 0}getLocalMedia(s){return this.localTrackMap.get(s)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(s,d){if(!s)return this.remoteUserMap.size>0;const l=this.remoteUserMap.get(s);return!!l&&(!d||l.has(d))}async hasRemoteMediaWithLock(s,d){if(!s)return this.remoteUserMap.size>0;const l=this.remoteUserMap.get(s);return!!l&&(!d||l.has(d))}getRemoteMedia(s){var d;const l=Array.from(v8(d=this.remoteUserMap).call(d)).find(f=>f.uid===s);return l?{audioTrack:l.audioTrack,audioSSRC:l._audioSSRC,videoTrack:l.videoTrack,videoSSRC:l._videoSSRC}:{}}getAudioLevels(){let s=Array.from(this.remoteUserMap.entries()).map(l=>{let[f]=l;return{uid:f.uid,level:f.audioTrack?100*f.audioTrack._source.getAccurateVolumeLevel():0}});const d=this.localTrackMap.get(JH.LocalAudioTrack);return d&&s.push({level:100*d.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),s=nne(s).call(s,(l,f)=>l.level-f.level),s}async disconnectForReconnect(){this.connection&&(CN.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=E6.Reconnecting,_H("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(s=>{let[d]=s;var l;d._videoTrack&&d._videoTrack._player&&((l=d._videoTrack._player.getVideoElement())===null||l===void 0||l.pause(),d._videoTrack._player.isKeepLastFrame=!0,d._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Voe(this.store),this.emit(v5.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(s=>{var d;let[l,{track:f}]=s;switch(l){case JH.LocalVideoTrack:a5(d=f._hints).call(d,O6.LOW_STREAM)?f.close():this.pendingLocalTracks.push(f);break;case JH.LocalAudioTrack:f instanceof SK?this.pendingLocalTracks=this.pendingLocalTracks.concat(f.trackList):this.pendingLocalTracks.push(f);case JH.LocalVideoLowTrack:}}),this.emit(v5.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(s=>{let[d,l]=s;Array.from(v8(l).call(l)).forEach(f=>{this.setPendingRemoteMedia(d,f)}),this.emit(v5.MediaReconnectStart,d.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(s=>{this.pendingLocalDataChannels.push(s)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(s=>{let[d,l]=s;Array.from(v8(l).call(l)).forEach(f=>{this.setPendingRemoteDataChannel(d,f)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),CN.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(s,d){for(const l of this.pendingRemoteDataChannels){const{user:f,id:b}=l;if((s instanceof GX?s.uid:s)===f.uid&&b===d)return!0}return!1}setPendingRemoteDataChannel(s,d){this.hasPendingRemoteDataChannel(s,d)||this.pendingRemoteDataChannels.push({user:s,id:d})}hasPendingRemoteMedia(s,d){for(const l of this.pendingRemoteTracks){const{user:f,kind:b}=l;if((s instanceof GX?s.uid:s)===f.uid&&d===b)return!0}return!1}setPendingRemoteMedia(s,d){this.hasPendingRemoteMedia(s,d)||this.pendingRemoteTracks.push({user:s,kind:d})}restartICE(s){var d=this;return H8(function*(){if(!d.connection||d.state!==E6.Connected)return;const l=yield i6(d.mutex.lock("From P2PChannel.restartICE"));let f;try{f=yield i6(d.connection.restartICE(s));const k=yield i6(f.next());if(k.done)return;const B=k.value,Wt=yield B;switch(Ale(d.connection)&&d.reportPCStats(Date.now(),!1,d._pcStatsUploadType),s){case d4.UDP_TCP_RELAY:d._pcStatsUploadType=L7.UDP_TCP_RESTART;break;case d4.TCP_RELAY:d._pcStatsUploadType=L7.TCP_RESTART;break;case d4.RELAY:d._pcStatsUploadType=L7.RELAY_RESTART;break;default:d._pcStatsUploadType=L7.OLD_RESTART}d._isTryConnecting=!0,f.next(Wt)}catch(k){var b;(b=f)===null||b===void 0||b.throw(k)}finally{l()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const s=this.connection.getStats(),d=this.localTrackMap.get(JH.LocalVideoTrack),l=this.localTrackMap.get(JH.LocalAudioTrack),f=s.videoSend.find(vN=>vN.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId)),b=s.audioSend.find(vN=>vN.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(!f||!b)return 1;const k=R8(this,v5.NeedSignalRTT),B=f?f.rttMs:void 0,Wt=b?b.rttMs:void 0,$O=B&&Wt?(B+Wt)/2:B||Wt,uN=($O&&k?($O+k)/2:$O||k)||0,lN=100*s.sendPacketLossRate*.7/50+.3*uN/1500,_N=lN<.17?1:lN<.36?2:lN<.59?3:lN<.1?4:5,TN=d==null?void 0:d.track;if(TN&&TN._encoderConfig&&TN._hints.indexOf(O6.SCREEN_TRACK)===-1){const vN=TN._encoderConfig.bitrateMax,uH=s.bitrate.actualEncoded;if(vN&&uH){const rH=(1e3*vN-uH)/(1e3*vN);return cSe[rH<.15?0:rH<.3?1:rH<.45?2:rH<.6?3:4][_N]}}return _N}getDownlinkNetworkQuality(){if(!this.connection)return 0;const s=this.connection.getStats();let d=0;return Array.from(this.remoteUserMap.entries()).forEach(l=>{let[f]=l;const b=f._audioSSRC,k=f._videoSSRC,B=s.audioRecv.find(uH=>uH.ssrc===b),Wt=s.videoRecv.find(uH=>uH.ssrc===k);if(!B&&!Wt)return void(d+=1);const $O=R8(this,v5.NeedSignalRTT),uN=s.rtt,lN=(uN&&$O?(uN+$O)/2:uN||$O)||0,_N=B?B.jitterMs:void 0,TN=s.recvPacketLossRate;let vN=.7*TN*100/50+.3*lN/1500;_N&&(vN=.6*TN*100/50+.2*lN/1500+.2*_N/400),d+=vN<.1?1:vN<.17?2:vN<.36?3:vN<.59?4:5}),this.remoteUserMap.size>0?Math.round(d/this.remoteUserMap.size):d}async muteLocalTrack(s){return new u5((d,l)=>{this.handleMuteLocalTrack(s,d,l)})}async replaceTrack(s,d){var l;if(CN.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(s.getTrackId(),"] to [").concat(d.getTrackId(),"]")),!this.connection||this.state!==E6.Connected)return;const f=Array.from(this.localTrackMap.entries()).find(k=>{let[,{track:B}]=k;return s===B});if(!f)return;const b=f[0];if(s!==d&&(this.unbindLocalTrackEvents([{track:s,type:b}]),this.bindLocalTrackEvents([{track:d,type:b}]),f[1].track=d),await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(d,f[1].id)),this.isPlanB){const k=f[1];k.id=d._mediaStreamTrack.id,this.localTrackMap.set(b,k)}if(b===JH.LocalVideoTrack&&!_H("DISABLE_DUAL_STREAM_USE_ENCODING")&&u6().supportDualStreamEncoding){const k=this.localTrackMap.get(JH.LocalVideoLowTrack);if(k){const B=s._mediaStreamTrack.clone();k.track._originMediaStreamTrack.stop(),k.track._mediaStreamTrack=B,k.track._originMediaStreamTrack=B,await new u5((Wt,$O)=>{this.handleReplaceTrack(k.track,Wt,$O,!0)})}}}filterTobePublishedTracks(s,d,l){const f=[],b=this.getAllTracks();s=O$(s=s.filter($O=>b.indexOf($O)===-1));let k,B=!1;const Wt=this.localTrackMap.get(JH.LocalAudioTrack);for(const $O of s){if($O instanceof x6&&(this.localTrackMap.has(JH.LocalVideoTrack)||B?new jH(dH.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(f.push({track:$O,type:JH.LocalVideoTrack}),B=!0),d)){const uN=this.getLowVideoTrack($O,l);f.push({track:uN,type:JH.LocalVideoLowTrack})}if($O instanceof _q)if(Wt){const uN=Wt.track;if(uN instanceof SK)Ile([$O]),uN.addAudioTrack($O),this.bindLocalAudioTrackEvents($O,!0);else{const lN=wle([uN,$O]);CN.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(lN.getTrackId(),"]")),this.replaceTrack(uN,lN)}}else k instanceof SK?(Ile([$O]),k.addAudioTrack($O)):k||!$O._useAudioElement&&u6().webAudioMediaStreamDest&&!$O._bypassWebAudio?k=wle(k?[$O,k]:[$O]):k=$O}return k&&(CN.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(k.getTrackId(),"]")),f.push({track:k,type:JH.LocalAudioTrack})),f}filterTobeUnpublishedTracks(s){const d=[],l=this.getAllTracks();s=O$(s=s.filter(f=>l.indexOf(f)!==-1));for(const f of s){if(f instanceof _q){const b=this.localTrackMap.get(JH.LocalAudioTrack);if(!b)continue;b.track instanceof SK?(b.track.removeAudioTrack(f),this.unbindLocalAudioTrackEvents(f),b.track.trackList.length===0&&(d.push([JH.LocalAudioTrack,b]),b.track.close())):d.push([JH.LocalAudioTrack,b])}if(f instanceof x6){const b=this.localTrackMap.get(JH.LocalVideoTrack);if(!b)continue;d.push([JH.LocalVideoTrack,b]);const k=this.localTrackMap.get(JH.LocalVideoLowTrack);k&&d.push([JH.LocalVideoLowTrack,k])}}return d}filterTobePublishedDataChannels(s){return s=(s=O$(s)).filter(d=>this.localDataChannels.findIndex(l=>l.id===d.id)===-1)}filterTobeUnpublishedDataChannels(s){return s=(s=(s=O$(s)).filter(d=>this.localDataChannels.indexOf(d)!==-1)).filter(d=>d._originDataChannel)}bindLocalTrackEvents(s){s.forEach(d=>{let{track:l,type:f}=d;switch(f){case JH.LocalVideoTrack:l.addListener(E5.GET_STATS,this.handleGetLocalVideoStats),l.addListener(E5.GET_RTC_STATS,this.handleGetRTCStats),l.addListener(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.addListener(E5.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.addListener(E5.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),l.addListener(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.addListener(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case JH.LocalAudioTrack:this.bindLocalAudioTrackEvents(l);case JH.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(s,d){s instanceof SK?s.trackList.forEach(l=>{l.addListener(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.addListener(E5.GET_STATS,this.handleGetLocalAudioStats),l.addListener(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(s.addListener(E5.GET_STATS,this.handleGetLocalAudioStats),s.addListener(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),d||(s.addListener(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(E5.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(s){s||(s=Array.from(this.localTrackMap.entries()).map(d=>{let[l,{track:f}]=d;return{track:f,type:l}})),s.forEach(d=>{let{track:l,type:f}=d;switch(f){case JH.LocalVideoTrack:l.off(E5.GET_STATS,this.handleGetLocalVideoStats),l.off(E5.GET_RTC_STATS,this.handleGetRTCStats),l.off(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.off(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.off(E5.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.off(E5.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),l.off(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.off(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.off(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case JH.LocalAudioTrack:this.unbindLocalAudioTrackEvents(l);case JH.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(s){s instanceof SK?s.trackList.forEach(d=>{d.off(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.off(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.off(E5.GET_STATS,this.handleGetLocalAudioStats),d.off(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.off(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(s.off(E5.GET_STATS,this.handleGetLocalAudioStats),s.off(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(E5.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),s.off(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(s,d){d instanceof B$&&d.addListener(E5.GET_STATS,l=>{l(this.handleGetRemoteVideoStats(s))}),d instanceof G$&&d.addListener(E5.GET_STATS,l=>{l(this.handleGetRemoteAudioStats(s))})}unbindRemoteTrackEvents(s){s&&s.removeAllListeners(E5.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(s=>{let[d,l]=s;l.has(_5.AUDIO)&&this.unbindRemoteTrackEvents(d._audioTrack),l.has(_5.VIDEO)&&this.unbindRemoteTrackEvents(d._videoTrack)})}createGatewayPublishMessage(s,d){return s.map((l,f)=>{var b;let k,B,{track:Wt,type:$O}=l;switch($O){case JH.LocalAudioTrack:k=m6.Audio,B={dtx:Wt instanceof doe&&Wt._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case JH.LocalVideoTrack:k=a5(b=Wt._hints).call(b,O6.SCREEN_TRACK)?m6.Screen:m6.High,B=qJ(qJ({},ISe(Wt)),{},{codec:this.store.codec,svc_mode:Ioe()});break;case JH.LocalVideoLowTrack:k=m6.Low,B=qJ(qJ({},ISe(Wt)),{},{codec:this.store.codec,svc_mode:Ioe()})}return{stream_type:k,attributes:B,ssrcs:d[f]}})}createGatewayUnpublishMessage(s){return s.map(d=>{var l;let f,[b,{track:k,ssrcs:B,id:Wt}]=d;switch(b){case JH.LocalVideoTrack:f=a5(l=k._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoLowTrack:f=m6.Low}return{stream_type:f,ssrcs:B,mid:Wt}})}assignLocalTracks(s,d){s.forEach((l,f)=>{let{track:b,type:k}=l;this.localTrackMap.set(k,{track:b,id:d[f].id,ssrcs:d[f].localSSRC})})}withdrawLocalTracks(s){s.forEach(d=>{let[l]=d;this.localTrackMap.delete(l)})}bindConnectionEvents(s){s.onConnectionStateChange=async d=>{if(CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(d,")")),this.emit(v5.PeerConnectionStateChange,d),d!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),d==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),s instanceof x7&&Cye(s,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=L7.DISCONNECTED_OR_FAILED,R8(this,v5.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const l=this.pendingLocalTracks.map(b=>b.getTrackId()),f=this.pendingLocalDataChannels.map(b=>"dc_".concat(b.id));T5.reportApiInvoke(this.store.sessionId,{name:_K.REPUB_AFTER_PC_CONNECTED,options:l.concat(f),tag:Y6.TRACER}).onSuccess(),this.republish()}if(_H("NEW_ICE_RESTART")&&s instanceof x7&&!Z6()&&!this._forceTurn){if(a5(TSe).call(TSe,d)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const l=b=>{Ale(s)&&(CN.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(b)),R8(this,v5.QueryClientConnectionState)==="CONNECTED"&&this.emit(v5.RequestRestartICE,b))},f=()=>{Ale(s)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),CN.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(v5.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Iye(s,l,f)},800))}}else{if(d==="disconnected"&&s.iceConnectionState==="disconnected")return setTimeout(()=>{s.iceConnectionState==="disconnected"&&_H("ICE_RESTART")&&R8(this,v5.QueryClientConnectionState)==="CONNECTED"&&this.emit(v5.RequestRestartICE)},800),void setTimeout(()=>{s.peerConnectionState==="disconnected"&&(CN.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(v5.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);d==="failed"&&(CN.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(v5.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},s.onICEConnectionStateChange=d=>{d!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(d,")")),T5.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:d,tag:Y6.TRACER}).onSuccess(),this.emit(v5.IceConnectionStateChange,d)},s.onICETransportStateChange=d=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(d,")"))},s.onDTLSTransportStateChange=d=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(d,")"))},s.onDTLSTransportError=d=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(d,")"))},s.onFirstAudioDecoded=d=>{var l;const f=Array.from(v8(l=this.remoteUserMap).call(l)).find(k=>k._audioSSRC===d);var b;f&&(this.store.subscribe(f.uid,"audio",void 0,void 0,void 0,Date.now()),(b=f.audioTrack)===null||b===void 0||b.emit(U$.FIRST_FRAME_DECODED),T5.firstRemoteFrame(this.store.sessionId,OK.FIRST_AUDIO_DECODE,j6.FIRST_AUDIO_DECODE,{peer:f._uintid,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,d),subscribeRequestid:d,p2pid:this.store.p2pId}))},s.onFirstAudioReceived=d=>{var l;const f=Array.from(v8(l=this.remoteUserMap).call(l)).find(b=>b._audioSSRC===d);f&&T5.firstRemoteFrame(this.store.sessionId,OK.FIRST_AUDIO_RECEIVED,j6.FIRST_AUDIO_RECEIVED,{peer:f._uintid,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,d),subscribeRequestid:d,p2pid:this.store.p2pId})},s.onFirstVideoDecoded=(d,l,f)=>{this.reportVideoFirstFrameDecoded(d,l,f)},s.onFirstVideoReceived=d=>{var l;const f=Array.from(v8(l=this.remoteUserMap).call(l)).find(b=>b._videoSSRC===d);f&&T5.firstRemoteFrame(this.store.sessionId,OK.FIRST_VIDEO_RECEIVED,j6.FIRST_VIDEO_RECEIVED,{peer:f._uintid,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,d),subscribeRequestid:d,p2pid:this.store.p2pId})},s.onSelectedLocalCandidateChanged=(d,l)=>{const f=d.candidateType==="relay",b=l.candidateType==="relay";l.candidateType!=="unknown"&&f===b||this.emit(v5.ConnectionTypeChange,f),CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(FX(l))," -> ").concat(JSON.stringify(FX(d)),")"))},s.onSelectedRemoteCandidateChanged=(d,l)=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(FX(l))," -> ").concat(JSON.stringify(FX(d)),")"))},s.onFirstVideoDecodedTimeout=d=>{this.reportVideoFirstFrameDecoded(d,void 0,void 0,!0)},s.getLocalVideoStats=()=>{const d=this.statsCollector.getLocalVideoTrackStats(),l=this.statsCollector.getRTCStats();return qJ(qJ({},d),l)},s.onICECandidateError=d=>{this._iceError=d}}resetConnection(s){s instanceof x7&&function(d){ree.delete(d.id),Cye(d)}(s),s.close(),this.emit(v5.PeerConnectionStateChange,"closed"),function(d){d.onConnectionStateChange=void 0,d.onICEConnectionStateChange=void 0,d.onICETransportStateChange=void 0,d.onDTLSTransportStateChange=void 0,d.onDTLSTransportError=void 0,d.onFirstAudioDecoded=void 0,d.onFirstAudioReceived=void 0,d.onFirstVideoDecoded=void 0,d.onFirstVideoReceived=void 0,d.onSelectedLocalCandidateChanged=void 0,d.onSelectedRemoteCandidateChanged=void 0,d.onFirstVideoDecodedTimeout=void 0,d.getLocalVideoStats=void 0}(s),this._isWaitPcToRePub=!1}filterTobeMutedTracks(s){const d=[];if(this.getAllTracks().indexOf(s)===-1)return d;const l=this.localTrackMap.get(JH.LocalAudioTrack);if(s instanceof _q&&(l==null?void 0:l.track)instanceof SK)return l.track.isActive||d.push([JH.LocalAudioTrack,l]),d;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:k}]=b;return s===k});if(f&&(d.push(f),f[0]===JH.LocalVideoTrack)){const b=this.localTrackMap.get(JH.LocalVideoLowTrack);b&&d.push([JH.LocalVideoLowTrack,b])}return d}filterTobeUnmutedTracks(s){const d=[],l=this.localTrackMap.get(JH.LocalAudioTrack);if(s instanceof _q&&(l==null?void 0:l.track)instanceof SK)return l.track.isActive&&d.push([JH.LocalAudioTrack,l]),d;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:k}]=b;return s===k});if(f)if(f[0]===JH.LocalVideoTrack){d.push(f);const b=this.localTrackMap.get(JH.LocalVideoLowTrack);b&&d.push([JH.LocalVideoLowTrack,b])}else d.push(f);return d}createMuteMessage(s){return s.map(d=>{var l;let f,[b,{track:k,ssrcs:B,id:Wt}]=d;switch(b){case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoTrack:f=a5(l=k._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalVideoLowTrack:f=m6.Low}return{stream_type:f,ssrcs:B,mid:Wt}})}createUnmuteMessage(s){return s.map(d=>{var l;let f,[b,{track:k,ssrcs:B,id:Wt}]=d;switch(b){case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoTrack:f=a5(l=k._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalVideoLowTrack:f=m6.Low}return{stream_type:f,ssrcs:B,mid:Wt}})}filterTobeUnSubscribedTracks(s,d){const l=[],f=this.remoteUserMap.get(s);if(!f)return l;if(d){const b=f.get(d);if(!b)return l;l.push([s,{kind:d,id:b}])}else Array.from(f.entries()).forEach(b=>{let[k,B]=b;l.push([s,{kind:k,id:B}])});return l}filterTobeUnSubscribedDataChannels(s,d){const l=[];return d.forEach(f=>{var b;(b=this.remoteDataChannelMap.get(s))!==null&&b!==void 0&&b.has(f.id)&&l.push(f)}),l}createUnsubscribeMessage(s){const d=[];return s.forEach(l=>{let[f,{kind:b,id:k}]=l;switch(b){case _5.VIDEO:return void(f._videoSSRC&&d.push({stream_type:_5.VIDEO,ssrcId:f._videoSSRC}));case _5.AUDIO:return void(f._audioSSRC&&d.push({stream_type:_5.AUDIO,ssrcId:f._audioSSRC}))}}),d}createUnsubscribeAllMessage(s){const d=new Map;return s.forEach(l=>{let[f,{kind:b}]=l;if(d.has(f)){let k=d.get(f);b===_5.VIDEO?k|=NK.Video:k|=NK.Audio,d.set(f,k)}else b===_5.VIDEO?d.set(f,NK.Video):d.set(f,NK.Audio)}),{users:Array.from(d.entries()).map(l=>{let[f,b]=l;return{stream_id:f.uid,stream_type:b}})}}withdrawRemoteTracks(s){s.forEach(d=>{let[l,{kind:f}]=d;const b=this.remoteUserMap.get(l);b&&(b.delete(f),Array.from(b.entries()).length===0&&this.remoteUserMap.delete(l))})}async updateBitrateLimit(s){const d=this.localTrackMap.get(JH.LocalVideoTrack),l=this.localTrackMap.get(JH.LocalVideoLowTrack);d&&(await d.track.setBitrateLimit(s.uplink),await new u5((f,b)=>{this.handleUpdateVideoEncoder(d.track,f,b,!0)})),l&&s.low_stream_uplink&&(await l.track.setBitrateLimit({max_bitrate:s.low_stream_uplink.bitrate,min_bitrate:s.low_stream_uplink.bitrate||0}),await new u5((f,b)=>{this.handleUpdateVideoEncoder(l.track,f,b,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(s,d,l){return s.map((f,b)=>{var k;let{stream_type:B}=f;const Wt=(k=d.find($O=>{let{stream_type:uN}=$O;return B===uN}))===null||k===void 0?void 0:k.attributes;if(Wt&&_H("DISABLE_SCREEN_SHARE_REMB")){const $O=l[b]._hints;(a5($O).call($O,O6.SCREEN_TRACK)||a5($O).call($O,O6.SCREEN_LOW_TRACK))&&(Wt.remb=!1,CN.debug("disable remb for screen share, hints:",$O))}return Wt})}async tryToUnmuteAudio(s){for(let l=0;l<s.length;l++)if(s[l]instanceof _q){var d;const f=this.filterTobeUnmutedTracks(s[l]);if(f.length===0)continue;await((d=this.connection)===null||d===void 0?void 0:d.unmuteLocal(f.map(k=>{let[,{id:B}]=k;return B})));const b=this.createUnmuteMessage(f);return void await w6(this,v5.RequestUnmuteLocal,b)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=s=>{var d;return!((d=this.connection)===null||d===void 0||!d.getRemoteVideoIsReady(s))},this.statsUploader.requestUpload=(s,d)=>this.emit(v5.RequestUpload,s,d),this.statsUploader.requestUploadStats=s=>this.emit(v5.RequestUploadStats,s),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var s;return{connectState:((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await BK(yde(this.dtlsFailedCount,EK)),this.emit(v5.RequestReconnect)}async reconnectP2P(){const s=Array.from(this.localTrackMap.entries()),d=this.createGatewayUnpublishMessage(s);Array.from(this.remoteUserMap.entries()),d.length>0&&await YK(this,v5.RequestUnpublishForReconnectPC,d),this.disconnectForReconnect(),this.emit(v5.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(JH.LocalVideoTrack)||this.pendingLocalTracks.some(s=>s instanceof x6)}throwIfTrackTypeNotMatch(s){if(s.filter(d=>d instanceof x6).length>1)throw new jH(dH.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(s.filter(d=>d instanceof _q).length>1&&(s.some(d=>d instanceof _q&&d._bypassWebAudio)||!u6().webAudioMediaStreamDest))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const d of s){if(d instanceof x6&&this.pendingLocalTracks.some(l=>l instanceof x6))throw new jH(dH.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(d instanceof _q&&this.pendingLocalTracks.some(l=>l instanceof _q)&&(!u6().webAudioMediaStreamDest||d._bypassWebAudio||this.pendingLocalTracks.some(l=>l instanceof _q&&l._bypassWebAudio)))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(s,d){var l;const f=!_H("DISABLE_DUAL_STREAM_USE_ENCODING")&&u6().supportDualStreamEncoding,b=qJ(qJ({},{width:160,height:120,framerate:15,bitrate:50}),d);let k;k=f?s._mediaStreamTrack.clone():Ole(s,b);const B=A6(8,"track-low-"),Wt=new x6(k,qJ(qJ({},f&&{scaleResolutionDownBy:lle(b,s)}),{},{frameRate:b.framerate,bitrateMax:b.bitrate,bitrateMin:b.bitrate}),void 0,void 0,B);return Wt.on(gQ.TRANSCEIVER_UPDATED,$O=>{s._updateRtpTransceiver($O,L$.LOW_STREAM)}),Wt._hints.push(O6.LOW_STREAM),a5(l=s._hints).call(l,O6.SCREEN_TRACK)&&Wt._hints.push(O6.SCREEN_LOW_TRACK),s.on("sei-to-send",$O=>{Wt.emit("sei-to-send",$O)}),s.addListener(E5.NEED_CLOSE,()=>{Wt.close()}),Wt}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(s,d,l){let f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof x7){var b,k,B,Wt;const $O=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:uN,dtlsTransportState:lN,peerConnectionState:_N}=this.connection,{local:TN,remote:vN}=await this.connection.getSelectedCandidatePair();T5.pcStats(this.store.sessionId,{startTime:$O,eventElapse:s-$O||0,iceconnectionsate:uN,dtlsstate:lN,connectionstate:_N,intSucc:d?1:2,error:this._iceError||f||"",selectedLocalCandidateProtocol:(b=TN==null?void 0:TN.protocol)!==null&&b!==void 0?b:"",selectedLocalCandidateType:(k=TN.candidateType)!==null&&k!==void 0?k:"",selectedLocalCandidateAddress:"".concat(TN.address,":").concat(TN.port),selectedRemoteCandidateProtocol:(B=vN.protocol)!==null&&B!==void 0?B:"",selectedRemoteCandidateType:(Wt=vN.candidateType)!==null&&Wt!==void 0?Wt:"",selectedRemoteCandidateAddress:"".concat(vN.address,":").concat(vN.port),restartCnt:l,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(s,d,l,f){var b;const k=Array.from(v8(b=this.remoteUserMap).call(b)).find(B=>B._videoSSRC===s);if(k){f||this.store.subscribe(k.uid,"video",void 0,void 0,void 0,void 0,Date.now());const B=this.store.keyMetrics,Wt=B.subscribe.find($O=>$O.userId===k.uid&&$O.type==="video");T5.firstRemoteVideoDecode(this.store.sessionId,OK.FIRST_VIDEO_DECODE,j6.FIRST_VIDEO_DECODE,{peer:k._uintid,videowidth:d,videoheight:l,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId,apEnd:B.requestAPEnd||0,apStart:B.requestAPStart||0,joinGwEnd:B.joinGatewayEnd||0,joinGwStart:B.joinGatewayStart||0,pcEnd:B.peerConnectionEnd||0,pcStart:B.peerConnectionStart||0,subscriberEnd:(Wt==null?void 0:Wt.subscribeEnd)||0,subscriberStart:(Wt==null?void 0:Wt.subscribeStart)||0,videoAddNotify:(Wt==null?void 0:Wt.streamAdded)||0,state:f?1:0,firstFrame:(Wt==null?void 0:Wt.firstFrame)||0})}}async remoteMediaSsrcChanged(s,d,l){if(!this.connection)return!1;const f=this.remoteUserMap.get(s);if(!f)return!1;const b=f.get(d);if(!b)return!1;const k=await this.connection.getRemoteSSRC(b);return k!==void 0&&k!==l}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(s=>{let[d,{track:l}]=s;d===JH.LocalVideoLowTrack?l._updateRtpTransceiver(void 0,L$.LOW_STREAM):l._updateRtpTransceiver(void 0)})}},m5(q5.prototype,"startP2PConnection",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"startP2PConnection"),q5.prototype),m5(q5.prototype,"connect",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"connect"),q5.prototype),m5(q5.prototype,"updateRemoteRTPCapabilities",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"updateRemoteRTPCapabilities"),q5.prototype),m5(q5.prototype,"publishDataChannel",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"publishDataChannel"),q5.prototype),m5(q5.prototype,"unpublish",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"unpublish"),q5.prototype),m5(q5.prototype,"unpublishDataChannel",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"unpublishDataChannel"),q5.prototype),m5(q5.prototype,"unpublishLowStream",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"unpublishLowStream"),q5.prototype),m5(q5.prototype,"subscribeDataChannel",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"subscribeDataChannel"),q5.prototype),m5(q5.prototype,"subscribe",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"subscribe"),q5.prototype),m5(q5.prototype,"massSubscribe",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"massSubscribe"),q5.prototype),m5(q5.prototype,"unsubscribe",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"unsubscribe"),q5.prototype),m5(q5.prototype,"unsubscribeDataChannel",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"unsubscribeDataChannel"),q5.prototype),m5(q5.prototype,"massUnsubscribe",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"massUnsubscribe"),q5.prototype),m5(q5.prototype,"muteRemote",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"muteRemote"),q5.prototype),m5(q5.prototype,"unmuteRemote",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"unmuteRemote"),q5.prototype),m5(q5.prototype,"hasRemoteMediaWithLock",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"hasRemoteMediaWithLock"),q5.prototype),m5(q5.prototype,"disconnectForReconnect",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"disconnectForReconnect"),q5.prototype),m5(q5.prototype,"updateBitrateLimit",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"updateBitrateLimit"),q5.prototype),m5(q5.prototype,"remoteMediaSsrcChanged",[E4],Object.getOwnPropertyDescriptor(q5.prototype,"remoteMediaSsrcChanged"),q5.prototype),q5);function E4(s,d,l){const f=s[d];if(typeof f!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const b=this.mutex,k=await b.lock("From P2PChannel.".concat(d));try{for(var B=arguments.length,Wt=new Array(B),$O=0;$O<B;$O++)Wt[$O]=arguments[$O];return await f.apply(this,Wt)}finally{k()}},l}function Oye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function Nye(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?Oye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):Oye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const n0e=Date.now(),Ple=new Map,Hoe=new Map;async function Pye(s){const d=Ple.get(s),l=Array.isArray(d)&&d[d.length-1],f=Hoe.get(s);if(!l)return void(f.isSyncing=!1);const b={uid:l.uid,payload:l.payload};f.firstRecvTs===0&&(f.firstRecvTs=l.recvTs,f.firstSendTs=l.sendTs);const k=l.sendTs-f.firstSendTs,B=k-(Date.now()-f.firstRecvTs);B>0&&(f.firstRecvTs=Date.now()-k);let Wt=l.mediaDelay+B;Wt<=0?(d.pop(),Dye(l.context,b),Wt=0):Wt=Math.min(Wt,20),setTimeout(()=>d.length&&Pye(s),Wt)}function Dye(s,d){s.safeEmit(z5.STREAM_MESSAGE,d.uid,d.payload),s.onStreamMessage&&s.onStreamMessage(d)}function r0e(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(!s.syncWithAudio)return Dye(l,{uid:s.uid,payload:s.payload});const f="".concat(l.id,"-").concat(s.uid),b=Ple.get(f)||[],k=b.findIndex(uN=>s.sendTs>=uN.sendTs),B=Nye(Nye({},s),{},{context:l,mediaDelay:d,recvTs:Date.now()});k===-1?b.push(B):b.splice(k,0,B),Ple.set(f,b);let Wt=!1;var $O;Hoe.has(f)?Wt=!(($O=Hoe.get(f))===null||$O===void 0||!$O.isSyncing):Hoe.set(f,{isSyncing:Wt,firstRecvTs:0,firstSendTs:0}),Wt||Pye(f)}const i0e=c6().name;function kye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function Lye(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?kye(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):kye(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const iee="websdk_ng_cache_parameter",s0e=_H("MAX_PRELOAD_ASYNC_LENGTH"),NQ=new Map,PQ=[];let Dle=null,kle=0,Lle=0;const qoe=new Map,o0e=function(s,d){const l=[];let f=0;const b=async()=>{const k=l.shift();k&&await k(),l.length>0&&f<d?b():f--};return async function(){for(var k=arguments.length,B=new Array(k),Wt=0;Wt<k;Wt++)B[Wt]=arguments[Wt];return new u5(async($O,uN)=>{l.push(async()=>{try{const lN=await s(...B);$O(lN)}catch(lN){uN(lN)}}),f<d&&(f++,b())})}}(Mye,s0e),Mle=F4.CancelToken.source();async function Mye(s,d,l,f,b,k){try{if(!_H("ENABLE_PRELOAD"))return;if(!u6().supportWebCrypto)return void LX(()=>{CN.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!l&&l!==null)throw new jH(dH.INVALID_PARAMS,"Invalid token: ".concat(l,". If you don not use token, set it to null"));l&&jK(l,"token",1,2047),jK(s,"appid",1,2047),yoe(d),f&&Roe(f);const B=EQ();CN.debug("preload channel ".concat(d,", uid is ").concat(f));const Wt={appId:s,cname:d,token:l||s,uid:typeof f!="string"?f:null,sid:B,proxyServer:b};let $O,uN;typeof f=="string"?(Wt.stringUid=f,[uN,$O]=await u5.all([Wke(f,{sid:B,appId:s},Mle.token),rye(Lye(Lye({},Wt),{},{token:l||s,uid:0}),Mle.token)]),Wt.uid=uN.uid,$O.gatewayInfo.uid=Wt.uid,$O.gatewayInfo.res.uid=Wt.uid):(k&&(Wt.stringUid=k),$O=await rye(Wt,Mle.token));const lN={sid:B,appId:s,cname:d,token:l||s,uid:Wt.stringUid||f,intUid:Wt.uid||$O.gatewayInfo.uid,stringUid:Wt.stringUid,ts:Date.now(),sua:uN,ap:$O};await async function(_N){let TN;try{_N.uid&&xye({appId:_N.appId,cname:_N.cname,token:_N.token,uid:_N.uid,stringUid:_N.stringUid});const vN=Bye(_N),uH=await async function(iH,lH){try{const hH=await window.crypto.subtle.importKey("raw",Dme(lH),"AES-GCM",!1,["encrypt"]),bH=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},hH,_Q(window.btoa(JSON.stringify(iH))));return MX(new Uint8Array(bH))}catch{return}}(_N,_N.token||_N.appId);if(!uH)return;TN=jye(iee);const rH=TN?JSON.parse(TN):[];rH.push({[vN]:uH}),rH.length>_H("AP_CACHE_NUM")&&rH.shift(),Koe(iee,JSON.stringify(rH))}catch(vN){CN.warn("Error caching server parameters:",vN.message),Koe(iee,"")}}(lN),kle++}catch(B){throw Lle++,function(Wt){Dle||(Dle=window.setTimeout(()=>{let uN="";qoe.forEach((lN,_N)=>{uN+="".concat(_N,": ").concat(lN," ;")}),T5.reportApiInvoke(null,{name:_K.PRELOAD,options:{success:kle,failed:Lle,err:uN}}).onError(Wt),kle=0,Lle=0,qoe.clear(),Dle=null},1e4));const $O=qoe.get(Wt.code)||0;qoe.set(Wt.code,$O+1)}(B),B}}async function Uye(s){try{if(_H("AP_REQUEST_DETAIL")||_H("ENABLE_ROLE_SELECT_EDGE"))return;const d=xye(s);if(!d||s.cloudProxyServer!=="disabled")return;const l=await async function(f,b){try{const k=await window.crypto.subtle.importKey("raw",Dme(b),"AES-GCM",!1,["decrypt"]),B=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},k,_Q(f));return JSON.parse(window.atob(MX(new Uint8Array(B))))}catch{return}}(d,s.token||s.appId);if(!l||!function(f,b){return f.cname===b.cname&&f.appId===b.appId&&f.token===b.token?b.stringUid?f.stringUid===b.stringUid:typeof b.uid=="number"?f.uid===b.uid:f.uid==b.uid:!1}(l,s))return;if(l&&Date.now()-l.ts<_H("AP_CACHE_LIFETIME"))return l}catch(d){CN.warn("Error get preloadInfo",d.message)}}function xye(s){let d;try{if(d=jye(iee),!d)return;const l=JSON.parse(d),f=Bye(s),b=function(B,Wt){for(let $O=B.length-1;$O>=0;$O--)if(Wt(B[$O]))return $O;return-1}(l,B=>f in B);if(b===-1)return;const k=l.splice(b,1)[0];return Koe(iee,JSON.stringify(l)),k[f]}catch(l){CN.warn("Error delete preload info: ".concat(d),l.message),Koe(iee,"")}}function Ule(s){if(s){let d=NQ.get(s);d&&(window.clearTimeout(d),d=null,NQ.delete(s)),a5(PQ).call(PQ,s)||s.cloudProxyServer!=="disabled"||PQ.push(s)}if(NQ.size<_H("AP_CACHE_NUM")&&PQ.length>0){const d=PQ.shift();NQ.set(d,window.setTimeout(async()=>{const{appId:l,cname:f,token:b,stringUid:k,uid:B,proxyServer:Wt}=d;try{await o0e(l,f,b,B,Wt,k),NQ.has(d)&&Ule(d)}catch($O){CN.warn("update preload failed",$O.message),Vye(d)}},_H("AP_UPDATE_INTERVAL")))}}function Vye(s){const d=PQ.indexOf(s);d!==-1&&PQ.splice(d,1);let l=NQ.get(s);l&&(window.clearTimeout(l),l=null,NQ.delete(s),Ule())}function Fye(s,d){const l=s.sua,f=s.ap;d&&l&&T5.reqUserAccount(s.sid,{lts:l.requestTime,elapse:l.elapse,success:!0,serverAddr:l.url,stringUid:d,uid:s.intUid,errorCode:null,extend:l.req}),T5.reportResourceTiming(s.ap.url,s.sid),T5.joinWebProxyAP(s.sid,{lts:f.requestTime,elapse:f.elapse,sucess:1,apServerAddr:f.url,turnServerAddrList:f.proxyInfo.addresses.map(b=>b.ip).join(","),eventType:"disabled",unilbsServerIds:[dK.CHOOSE_SERVER,dK.CLOUD_PROXY_FALLBACK].toString()}),T5.joinChooseServer(s.sid,{lts:f.requestTime,elapse:f.elapse,succ:!0,csAddr:f.url,opid:f.opid,serverList:f.gatewayInfo.gatewayAddrs.map(b=>b.address),ec:null,cid:f.gatewayInfo.cid.toString(),uid:f.gatewayInfo.uid.toString(),csIp:f.gatewayInfo.csIp,unilbsServerIds:[dK.CHOOSE_SERVER].toString(),isHttp3:f.isHttp3})}function jye(s){return window.atob(window.localStorage.getItem(s)||"")}function Koe(s,d){window.localStorage.setItem(s,window.btoa(d))}function Bye(s){let d="".concat(s.appId,"_").concat(s.cname);return typeof s.uid=="string"&&(d+="_s_".concat(s.uid)),typeof s.uid=="number"&&(d+="_".concat(s.uid)),s.token&&(d+="_".concat(s.token)),Fme(d)}function a0e(s){let d=function(){const l=d0e.pop();return l?(l.offset=l.limit=0,l):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(l,f){let b=l.appId;b!==void 0&&(pK(f,10),HX(f,b));let k=l.cid;k!==void 0&&(pK(f,16),pK(f,k));let B=l.cname;B!==void 0&&(pK(f,26),HX(f,B));let Wt=l.deviceId;Wt!==void 0&&(pK(f,34),HX(f,Wt));let $O=l.elapse;$O!==void 0&&(pK(f,40),qX(f,$O));let uN=l.fileSize;uN!==void 0&&(pK(f,48),qX(f,see(uN)));let lN=l.height;lN!==void 0&&(pK(f,56),qX(f,see(lN)));let _N=l.jpg;_N!==void 0&&(pK(f,66),pK(f,_N.length),Wye(f,_N));let TN=l.networkType;TN!==void 0&&(pK(f,72),qX(f,see(TN)));let vN=l.osType;vN!==void 0&&(pK(f,80),qX(f,see(vN)));let uH=l.requestId;uH!==void 0&&(pK(f,90),HX(f,uH));let rH=l.sdkVersion;rH!==void 0&&(pK(f,98),HX(f,rH));let iH=l.sequence;iH!==void 0&&(pK(f,104),qX(f,see(iH)));let lH=l.sid;lH!==void 0&&(pK(f,114),HX(f,lH));let hH=l.timestamp;hH!==void 0&&(pK(f,120),qX(f,hH));let bH=l.uid;bH!==void 0&&(pK(f,128),pK(f,bH));let PH=l.vid;PH!==void 0&&(pK(f,136),pK(f,PH));let OH=l.width;OH!==void 0&&(pK(f,144),qX(f,see(OH)));let wH=l.service;wH!==void 0&&(pK(f,152),pK(f,wH));let BH=l.callbackData;BH!==void 0&&(pK(f,162),pK(f,BH.length),Wye(f,BH));let XH=l.ticket;XH!==void 0&&(pK(f,170),HX(f,XH));let d5=l.vendorConfigs;d5!==void 0&&(pK(f,178),HX(f,d5))}(s,d),function(l){let f=l.bytes,b=l.limit;return f.length===b?f:f.subarray(0,b)}(d)}function c0e(s){return function(l){let f={};e:for(;!l0e(l);){let b=xne(l);switch(b>>>3){case 0:break e;case 1:f.code=xne(l);break;case 2:f.msg=Hye(l,xne(l));break;case 3:f.requestId=Hye(l,xne(l));break;case 4:f.timestamp=h0e(l,!1);break;default:u0e(l,7&b)}}return f}({bytes:d=s,offset:0,limit:d.length});var d}function u0e(s,d){switch(d){case 0:for(;128&bY(s););break;case 2:xle(s,xne(s));break;case 5:xle(s,4);break;case 1:xle(s,8);break;default:throw new Error("Unimplemented type: "+d)}}function see(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let d0e=[];function xle(s,d){if(s.offset+d>s.limit)throw new Error("Skip past limit");s.offset+=d}function l0e(s){return s.offset>=s.limit}function zoe(s,d){let l=s.bytes,f=s.offset,b=s.limit,k=f+d;if(k>l.length){let B=new Uint8Array(2*k);B.set(l),s.bytes=B}return s.offset=k,k>b&&(s.limit=k),f}function Gye(s,d){let l=s.offset;if(l+d>s.limit)throw new Error("Read past limit");return s.offset+=d,l}function Wye(s,d){let l=zoe(s,d.length);s.bytes.set(d,l)}function Hye(s,d){let l=Gye(s,d),f=String.fromCharCode,b=s.bytes,k="�",B="";for(let Wt=0;Wt<d;Wt++){let $O,uN,lN,_N,TN=b[Wt+l];128&TN?(224&TN)==192?Wt+1>=d?B+=k:($O=b[Wt+l+1],(192&$O)!=128?B+=k:(_N=(31&TN)<<6|63&$O,_N<128?B+=k:(B+=f(_N),Wt++))):(240&TN)==224?Wt+2>=d?B+=k:($O=b[Wt+l+1],uN=b[Wt+l+2],(49344&($O|uN<<8))!=32896?B+=k:(_N=(15&TN)<<12|(63&$O)<<6|63&uN,_N<2048||_N>=55296&&_N<=57343?B+=k:(B+=f(_N),Wt+=2))):(248&TN)==240?Wt+3>=d?B+=k:($O=b[Wt+l+1],uN=b[Wt+l+2],lN=b[Wt+l+3],(12632256&($O|uN<<8|lN<<16))!=8421504?B+=k:(_N=(7&TN)<<18|(63&$O)<<12|(63&uN)<<6|63&lN,_N<65536||_N>1114111?B+=k:(_N-=65536,B+=f(55296+(_N>>10),56320+(1023&_N)),Wt+=3))):B+=k:B+=f(TN)}return B}function HX(s,d){let l=d.length,f=0;for(let B=0;B<l;B++){let Wt=d.charCodeAt(B);Wt>=55296&&Wt<=56319&&B+1<l&&(Wt=(Wt<<10)+d.charCodeAt(++B)-56613888),f+=Wt<128?1:Wt<2048?2:Wt<65536?3:4}pK(s,f);let b=zoe(s,f),k=s.bytes;for(let B=0;B<l;B++){let Wt=d.charCodeAt(B);Wt>=55296&&Wt<=56319&&B+1<l&&(Wt=(Wt<<10)+d.charCodeAt(++B)-56613888),Wt<128?k[b++]=Wt:(Wt<2048?k[b++]=Wt>>6&31|192:(Wt<65536?k[b++]=Wt>>12&15|224:(k[b++]=Wt>>18&7|240,k[b++]=Wt>>12&63|128),k[b++]=Wt>>6&63|128),k[b++]=63&Wt|128)}}function bY(s){return s.bytes[Gye(s,1)]}function qye(s,d){let l=zoe(s,1);s.bytes[l]=d}function xne(s){let d,l=0,f=0;do d=bY(s),l<32&&(f|=(127&d)<<l),l+=7;while(128&d);return f}function pK(s,d){for(d>>>=0;d>=128;)qye(s,127&d|128),d>>>=7;qye(s,d)}function h0e(s,d){let l,f=0,b=0,k=0;return l=bY(s),f=127&l,128&l&&(l=bY(s),f|=(127&l)<<7,128&l&&(l=bY(s),f|=(127&l)<<14,128&l&&(l=bY(s),f|=(127&l)<<21,128&l&&(l=bY(s),b=127&l,128&l&&(l=bY(s),b|=(127&l)<<7,128&l&&(l=bY(s),b|=(127&l)<<14,128&l&&(l=bY(s),b|=(127&l)<<21,128&l&&(l=bY(s),k=127&l,128&l&&(l=bY(s),k|=(127&l)<<7))))))))),{low:f|b<<28,high:b>>>4|k<<24,unsigned:d}}function qX(s,d){let l=d.low>>>0,f=(d.low>>>28|d.high<<4)>>>0,b=d.high>>>24,k=b===0?f===0?l<16384?l<128?1:2:l<1<<21?3:4:f<16384?f<128?5:6:f<1<<21?7:8:b<128?9:10,B=zoe(s,k),Wt=s.bytes;switch(k){case 10:Wt[B+9]=b>>>7&1;case 9:Wt[B+8]=k!==9?128|b:127&b;case 8:Wt[B+7]=k!==8?f>>>21|128:f>>>21&127;case 7:Wt[B+6]=k!==7?f>>>14|128:f>>>14&127;case 6:Wt[B+5]=k!==6?f>>>7|128:f>>>7&127;case 5:Wt[B+4]=k!==5?128|f:127&f;case 4:Wt[B+3]=k!==4?l>>>21|128:l>>>21&127;case 3:Wt[B+2]=k!==3?l>>>14|128:l>>>14&127;case 2:Wt[B+1]=k!==2?l>>>7|128:l>>>7&127;case 1:Wt[B]=k!==1?128|l:127&l}}const Kye={},zye={},Yye=4294967296,p0e=18446744073709552e3,f0e=p0e/2;Xye(0,!0);const Jye=Xye(0),_0e=Vne(0,-2147483648,!1),E0e=Vne(-1,2147483647,!1);function Xye(s,d){let l,f,b;return d?(b=0<=(s>>>=0)&&s<256)&&(f=zye[s],f)?f:(l=Vne(s,0,!0),b&&(zye[s]=l),l):(b=-128<=(s|=0)&&s<128)&&(f=Kye[s],f)?f:(l=Vne(s,s<0?-1:0,!1),b&&(Kye[s]=l),l)}function Vne(s,d,l){return{low:0|s,high:0|d,unsigned:!!l}}function Qye(s,d){if(isNaN(s))return Jye;{if(s<=-9223372036854776e3)return _0e;if(s+1>=f0e)return E0e}return s<0?Jye:Vne(s%Yye|0,s/Yye|0,d)}function Zye(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}class Vle extends W6{get connectionState(){return this._connectionState}set connectionState(d){if(this._connectionState===d)return;const l=this._connectionState;this._connectionState=d,this.emit(nJ.CONNECTION_STATE_CHANGE,d,l)}get quality(){return this._quality}set quality(d){this._quality=d>1?1:d<.1?.1:d,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(d){var l;super(),cH(this,"name","AgoraRTCImageModeration"),cH(this,"_connectionState",Y8.CONNECTING),cH(this,"_sequence",0),cH(this,"_moderationStartTime",void 0),cH(this,"_workerConnection",void 0),cH(this,"_workerMessageLengthLimit",void 0),cH(this,"_qualityRatio",void 0),cH(this,"_connectInfo",void 0),cH(this,"_cancelTokenSource",F4.CancelToken.source()),cH(this,"_retryConfig",void 0),cH(this,"_moderationInterval",void 0),cH(this,"_moderationTimer",null),cH(this,"_moderationMode",1),cH(this,"_quality",1),cH(this,"_qualityTimer",null),cH(this,"_ticket",void 0),cH(this,"_moderationIntervalMinimum",void 0),cH(this,"_uploadFailedNum",0),cH(this,"_uploadNum",0),cH(this,"_uploadTimer",null),cH(this,"_extraInfo",void 0),cH(this,"_vendor",""),cH(this,"_encoder",new TextEncoder),cH(this,"_moderationId",void 0),cH(this,"inspectImage",()=>{if(this.connectionState!==Y8.CONNECTED)throw new LH(dH.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Y8.CONNECTED?this.requestToInspectImage():CN.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=A6(5,"image-moderation-"),this._workerMessageLengthLimit=_H("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=_H("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(l=d.interval)!==null&&l!==void 0?l:1e3,d.extraInfo&&(this._extraInfo=this._encoder.encode(d.extraInfo)),d.vendor&&(this._vendor=d.vendor),this._qualityRatio=_H("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ane("worker-"+this._moderationId,EK),this.on(nJ.STATE_CHANGE,(f,b)=>{CN.debug("[".concat(this._moderationId,"] Moderation operation :").concat(z$[f]," ").concat(b||""))}),this.handleWorkerEvents()}async init(d,l){this.emit(nJ.STATE_CHANGE,z$.CONNECT_AP),this._connectInfo=d;const f=this._cancelTokenSource.token;return this._retryConfig=l,new u5((b,k)=>{this.on(nJ.CONNECTION_STATE_CHANGE,(B,Wt)=>{B===Y8.CONNECTED&&b()}),this.requestAP(d,f,l).then(B=>{this.connectWorker(B)}).catch(B=>{k(B)})})}updateConfig(d){var l;this._moderationInterval=(l=d.interval)!==null&&l!==void 0?l:1e3,d.extraInfo&&(this._extraInfo=this._encoder.encode(d.extraInfo)),d.vendor&&(this._vendor=d.vendor),CN.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(d))),this.connectionState===Y8.CONNECTED&&this.inspectImage()}async requestAP(d,l,f){const b=_H("WEBCS_DOMAIN").map($O=>"https://".concat($O,"/api/v1")),k=await function($O,uN,lN,_N){let{appId:TN,areaCode:vN,cname:uH,sid:rH,token:iH,uid:lH}=uN;eee++;const hH="moderation_plugin",bH={service_name:hH,json_body:JSON.stringify({appId:TN,areaCode:vN,cname:uH,command:"allocateEdge",requestId:eee,seq:eee,sid:rH,appToken:iH,ts:Date.now(),uid:lH+""})};let PH,OH,wH=$O[0];return ZY(async()=>{PH=Date.now();const BH=await rJ(wH,{data:bH,cancelToken:lN,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(OH=Date.now()-PH,BH.code!==0){const p5=new LH(dH.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+BH.code,{retry:!0,responseTime:OH});throw CN.error(p5.toString()),p5}const XH=JSON.parse(BH.json_body);if(XH.code!==200){const p5=new LH(dH.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(XH.code,", reason: ").concat(XH.reason),{code:XH.code,responseTime:OH});throw CN.error(p5.toString()),p5}if(!XH.servers||!Array.isArray(XH.servers)||XH.servers.length===0){const p5=new LH(dH.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:XH.code,responseTime:OH});throw CN.error(p5.toString()),p5}if(!XH.servers.some(p5=>!!p5.wss)){const p5=new LH(dH.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:XH.code,responseTime:OH});throw CN.error(p5.toString()),p5}const d5=_H("IMAGE_MODERATION_WORKER_HOST");return{addressList:XH.servers.map(p5=>{let{address:$5,wss:e6}=p5;if($5&&e6)return"wss://".concat($5.replace(/\./g,"-"),".").concat(d5,":").concat(e6,"/moderation")}).filter(p5=>!!p5),workerToken:XH.workerToken,vid:XH.vid,ticket:XH.appTicket,responseTime:OH}},(BH,XH)=>(T5.apworkerEvent(rH,{success:!0,sc:200,serviceName:hH,responseDetail:JSON.stringify(BH.addressList),firstSuccess:XH===0,responseTime:OH,serverIp:$O[XH%$O.length]}),!1),(BH,XH)=>(T5.apworkerEvent(rH,{success:!1,sc:BH.data&&BH.data.code||200,serviceName:hH,responseTime:OH,serverIp:$O[XH%$O.length]}),!!(BH.code!==dH.OPERATION_ABORTED&&BH.code!==dH.UNEXPECTED_RESPONSE||BH.data&&BH.data.retry)&&(wH=$O[(XH+1)%$O.length],!0)),_N)}(b,d,l,f);this.emit(nJ.STATE_CHANGE,z$.AP_CONNECTED);const{addressList:B,ticket:Wt}=k;return this._ticket=Wt,B}async connectWorker(d){this.emit(nJ.STATE_CHANGE,z$.CONNECT_WORKER),await this._workerConnection.init(d,1e4)}handleWorkerEvents(){this._workerConnection.on(U5.CONNECTED,async()=>{this.emit(nJ.STATE_CHANGE,z$.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Y8.CONNECTED}),this._workerConnection.on(U5.CLOSED,()=>{this.connectionState=Y8.CLOSED}),this._workerConnection.on(U5.FAILED,()=>{this.connectionState=Y8.CLOSED}),this._workerConnection.on(U5.RECONNECTING,()=>{this.connectionState=this.connectionState===Y8.CONNECTED?Y8.RECONNECTING:Y8.CONNECTING}),this._workerConnection.on(U5.ON_MESSAGE,async d=>{if(d.data instanceof ArrayBuffer){const l=c0e(new Uint8Array(d.data));_H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&CN.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),this._uploadNum++,l.code===void 0||l.code===0||(this._uploadFailedNum++,CN.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{T5.reportApiInvoke(this._connectInfo.sid||null,{name:_K.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,l.code],tag:Y6.TRACER}).onError(new LH(dH.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),this._uploadTimer=null},_H("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else CN.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(U5.WILL_RECONNECT,(d,l,f)=>{d==="recover"&&f(d),f("tryNext")}),this._workerConnection.on(U5.REQUEST_NEW_URLS,(d,l)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(d).catch(l)})}static intToLong(d){return{low:d|=0,high:d>>31,unsigned:d>=0}}async requestToInspectImage(){const d=R8(this,nJ.CLIENT_LOCAL_VIDEO_TRACK),l={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(d){if(!d.isPlaying)return void(_H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&CN.debug("Only the track being played can be inspected"));this._sequence++;const f=await this.generateRequestData(d,l);this._workerConnection.sendMessage(f,!0,!0)}else _H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&CN.debug("Only the track being published can be inspected")}async generateRequestData(d,l){let{appId:f,cname:b,cid:k,vid:B,sid:Wt,uid:$O}=l;const uN=Date.now(),lN=await d.getCurrentFrameImage("image/jpeg",this.quality),_N=await Ige(lN,f,b),TN=this._sequence+"-"+k+"-"+$O+"-"+uN+"-"+A6(12,""),vN={appId:f,cid:k,cname:b,deviceId:"",elapse:Vle.intToLong(Number(uN-this._moderationStartTime)),fileSize:lN.buffer.byteLength,height:lN.height,width:lN.width,jpg:_N,networkType:6,osType:7,requestId:TN,sdkVersion:"4.23.1",sequence:this._sequence,sid:Wt,timestamp:Qye(uN),uid:$O,vid:B,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete vN.callbackData;const uH=a0e(vN);if(uH.byteLength<this._workerMessageLengthLimit){if(_H("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const rH=function(iH){for(var lH=1;lH<arguments.length;lH++){var hH=arguments[lH]!=null?arguments[lH]:{};lH%2?Zye(Object(hH),!0).forEach(function(bH){cH(iH,bH,hH[bH])}):Object.getOwnPropertyDescriptors?Object.defineProperties(iH,Object.getOwnPropertyDescriptors(hH)):Zye(Object(hH)).forEach(function(bH){Object.defineProperty(iH,bH,Object.getOwnPropertyDescriptor(hH,bH))})}return iH}({},vN);delete rH.jpg,CN.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(rH))}return uH}{const rH=this.quality*this._qualityRatio;return this.quality=rH,await this.generateRequestData(d,{appId:f,cname:b,cid:k,vid:B,sid:Wt,uid:$O})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=F4.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Y8.CLOSED,this.emit(nJ.STATE_CHANGE,z$.CLOSED)}}function $ye(s){if(b6(s.interval,"interval",1e3,1/0),s&&s.extraInfo&&s.extraInfo.length>1024)throw new LH(dH.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(s&&s.vendor&&s.vendor.length>1024)throw new LH(dH.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const m0e={name:"ImageModeration",create:function(s){let{config:d}=s;return $ye(d),new Vle(d)}};var eRe,tRe,nRe,rRe,iRe,sRe,oRe,aRe,cRe,uRe,dRe,lRe,hRe,pRe,fRe,_Re,ERe,mRe,gRe,TRe,SRe,yRe,RRe,bRe,vRe,CRe,IRe,wRe,ARe,ORe,NRe,PRe,DRe,kRe,LRe,MRe,URe,xRe,VRe,FRe,jRe,h5;function BRe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function vY(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?BRe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):BRe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}t4.setLogger(CN);let g0e=(eRe=A5(),tRe=A5({argsMap:(s,d)=>{if(!Array.isArray(d)){if(!(d instanceof V$))return[d];d=[d]}return d.map(l=>l?Object(l).toString():"null")}}),nRe=A5({argsMap:(s,d)=>(d||(d=[]),Array.isArray(d)||d.trackMediaType!==x$.DATA?(Array.isArray(d)||(d=[d]),d.map(l=>l.getTrackId())):[d.getChannelId()])}),rRe=A5({argsMap:(s,d,l,f)=>[typeof d=="object"?d.uid:d,l,f]}),iRe=A5({argsMap:(s,d,l)=>[d,l]}),sRe=A5({argsMap:(s,d)=>d.map(l=>{let{user:f,mediaType:b}=l;return[f==null?void 0:f.uid,b]})}),oRe=A5({argsMap:(s,d,l,f)=>[typeof d=="object"?d.uid:d,l,f]}),aRe=A5({argsMap:(s,d)=>d.map(l=>{let{user:f,mediaType:b}=l;return{uid:f==null?void 0:f.uid,mediaType:b}})}),cRe=A5(),uRe=A5(),dRe=A5(),lRe=A5(),hRe=A5(),pRe=A5(),fRe=A5(),_Re=A5(),ERe=A5(),mRe=A5(),gRe=A5(),TRe=A5(),SRe=A5(),yRe=A5(),RRe=A5(),bRe=A5({argsMap:(s,d)=>[d]}),vRe=A5(),CRe=A5(),IRe=A5(),wRe=A5(),ARe=A5(),ORe=A5(),NRe=A5(),PRe=A5(),DRe=A5({argsMap:(s,d)=>(Array.isArray(d)||(d=[d]),[JSON.stringify(d)])}),kRe=A5(),LRe=A5(),MRe=A5(),URe=A5(),xRe=A5(),VRe=A5(),FRe=A5({reportResult:!0}),jRe=A5(),h5=class extends W6{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var s;return((s=this._config)===null||s===void 0?void 0:s.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(s,d){let l;if(super(),cH(this,"store",void 0),cH(this,"_uid",void 0),cH(this,"_channelName",void 0),cH(this,"_uintUid",void 0),cH(this,"_users",[]),cH(this,"_config",void 0),cH(this,"_clientId",void 0),cH(this,"_appId",void 0),cH(this,"_sessionId",null),cH(this,"_key",void 0),cH(this,"_rtmConfig",{}),cH(this,"_joinInfo",void 0),cH(this,"_gateway",void 0),cH(this,"_statsCollector",void 0),cH(this,"_configDistribute",void 0),cH(this,"_leaveMutex",void 0),cH(this,"_publishMutex",void 0),cH(this,"_renewTokenMutex",void 0),cH(this,"_subscribeMutex",void 0),cH(this,"_encryptionMode","none"),cH(this,"_encryptionSecret",null),cH(this,"_encryptionSalt",null),cH(this,"_encryptDataStream",!1),cH(this,"_encryptDataStreamKey",null),cH(this,"_encryptDataStreamIv",null),cH(this,"_proxyServer",void 0),cH(this,"_turnServer",{servers:[],mode:"auto"}),cH(this,"_cloudProxyServerMode","disabled"),cH(this,"_isDualStreamEnabled",!1),cH(this,"_defaultStreamFallbackType",void 0),cH(this,"_lowStreamParameter",void 0),cH(this,"_streamFallbackTypeCacheMap",new Map),cH(this,"_remoteStreamTypeCacheMap",new Map),cH(this,"_axiosCancelSource",F4.CancelToken.source()),cH(this,"_audioVolumeIndicationInterval",void 0),cH(this,"_networkQualityInterval",void 0),cH(this,"_userOfflineTimeout",void 0),cH(this,"_streamRemovedTimeout",void 0),cH(this,"_liveTranscodeStreamingClient",void 0),cH(this,"_liveRawStreamingClient",void 0),cH(this,"_channelMediaRelayClient",void 0),cH(this,"_networkQualitySensitivity","normal"),cH(this,"_p2pChannel",void 0),cH(this,"_useLocalAccessPoint",!1),cH(this,"_setLocalAPVersion",void 0),cH(this,"_joinAndNotLeaveYet",!1),cH(this,"_numberOfJoinCount",0),cH(this,"_remoteDefaultVideoStreamType",void 0),cH(this,"_inspect",void 0),cH(this,"_moderation",void 0),cH(this,"_license",void 0),cH(this,"_pendingPublishedUsers",[]),cH(this,"ntpAlignErrorCount",0),cH(this,"remoteInboundOffset",0),cH(this,"_peerConnectionState",void 0),cH(this,"_handleLocalTrackEnable",(b,k,B)=>{this.publish(b,!1).then(k).catch(B)}),cH(this,"_handleLocalTrackDisable",(b,k,B)=>{this.unpublish(b).then(k).catch(B)}),cH(this,"_handleUserOnline",b=>{if(_H("BLOCK_LOCAL_CLIENT")&&vQ(b.uid,this.channelName))return void CN.debug("[".concat(b.uid,"] will be ignored in local"));this.isStringUID&&typeof b.uid!="string"&&CN.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const k=this._users.find(B=>B.uid===b.uid);if(k)k._trust_in_room_=!0,k._is_pre_created&&(k._is_pre_created=!1,this.safeEmit(z5.USER_JOINED,k));else{const B=new GX(b.uid,b.uint_id||b.uid);this._users.push(B),CN.debug("[".concat(this._clientId,"] user online"),b.uid),this.safeEmit(z5.USER_JOINED,B)}}),cH(this,"_handleUserOffline",b=>{if(_H("BLOCK_LOCAL_CLIENT")&&vQ(b.uid,this.channelName))return;const k=this._users.find(B=>B.uid===b.uid);k&&(this._handleRemoveStream(b),this._handleRemoveDataChannels(b),k._audio_pre_subscribed||k._video_pre_subscribed?k._is_pre_created=!0:Xse(this._users,k),this._remoteStreamTypeCacheMap.delete(k.uid),this._streamFallbackTypeCacheMap.delete(k.uid),CN.debug("[".concat(this._clientId,"] user offline"),b.uid,"reason:",b.reason),this.safeEmit(z5.USER_LEAVED,k,b.reason))}),cH(this,"_handleAddAudioOrVideoStream",(b,k,B,Wt,$O,uN,lN)=>{if(_H("BLOCK_LOCAL_CLIENT")&&vQ(k,this.channelName))return;const _N=this._users.find(vN=>vN.uid===k);if(!_N)return void CN.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));CN.debug("[".concat(this._clientId,"] stream added with uid ").concat(k,", type ").concat(b)),this.store.subscribe(_N.uid,b,void 0,void 0,void 0,Date.now());const TN=b==="audio"?_N.hasAudio:_N.hasVideo;_N._uintid||(_N._uintid=$O||k),b==="audio"?_N._trust_audio_stream_added_state_=!0:_N._trust_video_stream_added_state_=!0,b==="audio"?(_N._audio_added_=!0,B!==void 0&&(_N._audioSSRC=B),Wt!==void 0&&(_N._cname=Wt),uN&&(_N._audioOrtc=uN)):(_N._video_added_=!0,B!==void 0&&(_N._videoSSRC=B),Wt!==void 0&&(_N._cname=Wt),lN!==void 0&&(_N._rtxSsrcId=lN),uN&&(_N._videoOrtc=uN)),(b==="audio"?_N.hasAudio:_N.hasVideo)&&!TN&&(CN.info("[".concat(this._clientId,"] remote user ").concat(_N.uid," published ").concat(b)),this.safeEmit(z5.USER_PUBLISHED,_N,b)),b==="video"?T5.onGatewayStream(this._sessionId,OK.ON_ADD_VIDEO_STREAM,j6.ON_ADD_VIDEO_STREAM,{peer:$O||k,ssrc:_N._videoSSRC}):T5.onGatewayStream(this._sessionId,OK.ON_ADD_AUDIO_STREAM,j6.ON_ADD_AUDIO_STREAM,{peer:$O||k,ssrc:_N._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_N,b,B).then(vN=>{if(vN&&(CN.debug("[".concat(this._clientId,"] resubscribe ").concat(b," for user ").concat(_N.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Une))return this._p2pChannel.unsubscribe(_N,b,!0).then(()=>this._subscribe(_N,b,!0).catch(uH=>{CN.error("[".concat(this._clientId,"] resubscribe error"),uH.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_N,b)&&(CN.debug("[".concat(this._clientId,"] resubscribe ").concat(b," for user ").concat(_N.uid," after reconnect.")),this._subscribe(_N,b,!0).catch(vN=>{CN.error("[".concat(this._clientId,"] resubscribe error"),vN.toString())}))}),cH(this,"_handleRemoveStream",b=>{if(_H("BLOCK_LOCAL_CLIENT")&&vQ(b.uid,this.channelName))return;const k=this._users.find(Wt=>Wt.uid===b.uid);if(!k)return void CN.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));CN.debug("[".concat(this._clientId,"] stream removed with uid ").concat(b.uid));let B=()=>{};k.hasAudio&&k.hasVideo?B=()=>{CN.info("[".concat(this._clientId,"] remote user ").concat(k.uid," unpublished audio track")),this.safeEmit(z5.USER_UNPUBLISHED,k,"audio"),CN.info("[".concat(this._clientId,"] remote user ").concat(k.uid," unpublished video track")),this.safeEmit(z5.USER_UNPUBLISHED,k,"video")}:k.hasVideo?B=()=>{CN.info("[".concat(this._clientId,"] remote user ").concat(k.uid," unpublished video track")),this.safeEmit(z5.USER_UNPUBLISHED,k,"video")}:k.hasAudio&&(B=()=>{CN.info("[".concat(this._clientId,"] remote user ").concat(k.uid," unpublished audio track")),this.safeEmit(z5.USER_UNPUBLISHED,k,"audio")}),k._video_pre_subscribed||k._audio_pre_subscribed||(k._trust_audio_stream_added_state_=!0,k._trust_video_stream_added_state_=!0,k._audio_added_=!1,k._video_added_=!1,this._p2pChannel instanceof Une&&this._p2pChannel.unsubscribe(k).then(Wt=>{if(Wt)return this._gateway.unsubscribe(Wt,k.uid)}),k._audioSSRC=void 0,k._videoSSRC=void 0,k._audioOrtc=void 0,k._videoOrtc=void 0,k._rtxSsrcId=void 0),T5.onGatewayStream(this._sessionId,OK.ON_REMOVE_STREAM,j6.ON_REMOVE_STREAM,{peer:b.uint_id||b.uid}),B()}),cH(this,"_handleSetStreamLocalEnable",(b,k,B)=>{if(_H("BLOCK_LOCAL_CLIENT")&&vQ(k,this.channelName))return;const Wt=this._users.find(lN=>lN.uid===k);if(!Wt)return void CN.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));CN.debug("[".concat(this._clientId,"] local ").concat(b," ").concat(B?"enabled":"disabled"," with uid ").concat(k));const $O=b==="audio"?Wt.hasAudio:Wt.hasVideo;if(b==="audio"){Wt._trust_audio_enabled_state_=!0;const lN=Wt._audio_enabled_;if(Wt._audio_enabled_=B,Wt._audio_enabled_===lN)return;{const _N=Wt._audio_enabled_?"enable-local-audio":"disable-local-audio";CN.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(k,", msg: ").concat(_N)),this.safeEmit(z5.USER_INFO_UPDATED,k,_N)}}else{Wt._trust_video_enabled_state_=!0;const lN=Wt._video_enabled_;if(Wt._video_enabled_=B,Wt._video_enabled_===lN)return;{const _N=Wt._video_enabled_?"enable-local-video":"disable-local-video";CN.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(k,", msg: ").concat(_N)),this.safeEmit(z5.USER_INFO_UPDATED,k,_N)}}const uN=b==="audio"?Wt.hasAudio:Wt.hasVideo;return $O!==uN?!$O&&uN?(CN.info("[".concat(this._clientId,"] remote user ").concat(k," published ").concat(b)),void this.safeEmit(z5.USER_PUBLISHED,Wt,b)):(b==="video"&&Wt._videoTrack&&Wt._videoTrack._destroy(),b==="audio"&&Wt._audioTrack,this._p2pChannel.muteRemote(Wt,b),CN.info("[".concat(this._clientId,"] remote user ").concat(k," unpublished ").concat(b)),void this.safeEmit(z5.USER_UNPUBLISHED,Wt,b)):void 0}),cH(this,"_handleMuteStream",(b,k,B)=>{if(_H("BLOCK_LOCAL_CLIENT")&&vQ(b,this.channelName))return;CN.debug("[".concat(this._clientId,"] receive mute message"),b,k,B);const Wt=this._users.find(lN=>lN.uid===b);if(!Wt)return void CN.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(b));const $O=k==="audio"?Wt.hasAudio:Wt.hasVideo;if(k==="audio"){Wt._trust_audio_mute_state_=!0;const lN=Wt._audio_muted_;if(Wt._audio_muted_=B,Wt._audio_muted_===lN)return;{const _N=Wt._audio_muted_?"mute-audio":"unmute-audio";CN.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(b,", msg: ").concat(_N)),this.safeEmit(z5.USER_INFO_UPDATED,b,_N)}}else{Wt._trust_video_mute_state_=!0;const lN=Wt._video_muted_;if(Wt._video_muted_=B,Wt._video_muted_===lN)return;{const _N=Wt._video_muted_?"mute-video":"unmute-video";CN.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(b,", msg: ").concat(_N)),this.safeEmit(z5.USER_INFO_UPDATED,b,_N)}}const uN=k==="audio"?Wt.hasAudio:Wt.hasVideo;if($O!==uN){if(!$O&&uN)return(k==="audio"?Wt._audioSSRC:Wt._videoSSRC)?(CN.info("[".concat(this._clientId,"] remote user ").concat(b," published ").concat(k)),void this.safeEmit(z5.USER_PUBLISHED,Wt,k)):void CN.warning("[".concat(this._clientId,"] remote user ").concat(b," receive ").concat(k," unmute message  before add stream message, ").concat(k," SSRC doesn't exist yet."));k==="video"&&Wt._videoTrack&&!Wt._video_pre_subscribed&&Wt._videoTrack._destroy(),k==="audio"&&Wt._audioTrack,this._p2pChannel.muteRemote(Wt,k),CN.info("[".concat(this._clientId,"] remote user ").concat(b," unpublished ").concat(k)),this.safeEmit(z5.USER_UNPUBLISHED,Wt,k)}}),cH(this,"_handleP2PLost",async b=>{CN.debug("[".concat(this._clientId,"] receive p2p lost"),b),parseInt(b.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():CN.warning("[".concat(this._clientId,"] P2PLost stream not found"),b)}),cH(this,"_handleTokenWillExpire",()=>{CN.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(z5.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),cH(this,"_handleBeforeUnload",b=>{b.type==="beforeunload"&&b.returnValue!==void 0&&b.returnValue!==""||(this.leave(),CN.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),cH(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(z5.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const b={downlinkNetworkQuality:0,uplinkNetworkQuality:0};b.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),b.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(z5.NETWORK_QUALITY,b)}),cH(this,"_handleP2PAddAudioOrVideoStream",(b,k,B,Wt)=>{const $O=this._users.find(lN=>lN.uid===k);if(!$O)return void CN.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));CN.debug("[".concat(this._clientId,"] stream added with uid ").concat(k,", type ").concat(b)),this.store.subscribe($O.uid,b,void 0,void 0,void 0,Date.now());const uN=b==="audio"?$O.hasAudio:$O.hasVideo;b==="audio"?$O._trust_audio_stream_added_state_=!0:$O._trust_video_stream_added_state_=!0,b==="audio"?($O._audio_added_=!0,B!==void 0&&($O._audioSSRC=B),Wt!==void 0&&($O._audioMid=Wt)):($O._video_added_=!0,B!==void 0&&($O._videoSSRC=B),Wt!==void 0&&($O._videoMid=Wt)),(b==="audio"?$O.hasAudio:$O.hasVideo)&&!uN&&(CN.info("[".concat(this._clientId,"] remote user ").concat($O.uid," published ").concat(b)),this.safeEmit(z5.USER_PUBLISHED,$O,b)),this._p2pChannel.hasPendingRemoteMedia($O,b)&&(CN.debug("[".concat(this._clientId,"] resubscribe ").concat(b," for user ").concat($O.uid," after reconnect.")),this._subscribe($O,b,!0).catch(lN=>{CN.error("[".concat(this._clientId,"] resubscribe error"),lN.toString())}))}),this._config=s,this._clientId=d||A6(5,"client-"),this.store=new lDe(s.codec,s.audioCodec,s.mode,this._clientId),this._leaveMutex=new t4("client-leave",this._clientId),this._publishMutex=new t4("client-publish",this._clientId),this._renewTokenMutex=new t4("client-renewtoken",this._clientId),this._subscribeMutex=new t4("client-subscribe",this._clientId),this.store.clientCreated(),s.proxyServer&&this.setProxyServer(s.proxyServer,!0),s.turnServer&&this.setTurnServer(s.turnServer,!0),CN.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(q8," build: ").concat(Pde,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),s.clientRoleOptions)try{gde(s.clientRoleOptions),l=Object.assign({},s.clientRoleOptions)}catch(b){CN.warning("[".concat(this._clientId,"] ").concat(b.toString()))}var f;this._statsCollector=new Lne(this.store),this._statsCollector.onStatsException=(b,k,B)=>{CN.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(b,", msg: ").concat(k,", uid: ").concat(B)),this.safeEmit(z5.EXCEPTION,{code:b,msg:k,uid:B})},this._statsCollector.onUploadPublishDuration=(b,k,B,Wt)=>{const $O=this._users.find(uN=>uN.uid===b);$O&&T5.peerPublishStatus(this._sessionId,{subscribeElapse:Wt,audioPublishDuration:k,videoPublishDuration:B,peer:$O._uintid})},this.store.useP2P=s.mode==="p2p",this._gateway=new Vke(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:s.websocketRetryConfig||EK,httpRetryConfig:s.httpRetryConfig||EK,forceWaitGatewayResponse:s.forceWaitGatewayResponse===void 0||s.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:s.role,clientRoleOptions:l}),this._configDistribute=new zke(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(f={store:this.store,statsCollector:this._statsCollector},BX("P2PChannel").create(f)),this._handleP2PEvents()):this._p2pChannel=new Une(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(s,d,l,f,b){let k=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],B=arguments.length>6&&arguments[6]!==void 0&&arguments[6];S6("JOIN_GATEWAY_USE_443PORT_ONLY",k),S6("JOIN_GATEWAY_USE_DUAL_DOMAIN",B);const Wt=this._gateway.signal.websocket;return Wt instanceof ule&&(Wt.use443PortOnly=k,Wt.tryDoubleDomain=B),async function($O,uN,lN){qse.get($O)||qse.set($O,[]),Kse.get($O)||Kse.set($O,uN),UJ.get($O)||UJ.set($O,0);const _N=qse.get($O),TN=Kse.get($O);if(!_N||!TN)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(UJ.get($O)===TN){const lH=pne();_N.push(lH),await lH.promise}UJ.set($O,UJ.get($O)+1);for(var vN=arguments.length,uH=new Array(vN>3?vN-3:0),rH=3;rH<vN;rH++)uH[rH-3]=arguments[rH];const iH=await lN(...uH);return UJ.set($O,UJ.get($O)-1),UJ.get($O)===TN-1&&_N.length>0&&(_N[0].resolve(),_N.shift()),UJ.get($O)===0&&(qse.set($O,[]),Kse.set($O,0),UJ.set($O,0)),iH}("client.join",_H("JOIN_MAX_CONCURRENCY"),this.join.bind(this),s,d,l,f,b)}async join(s,d,l,f,b){const k=++this._numberOfJoinCount;this.store.joinStart(),f&&(this.store.uid=f);const B=($se||$se||($se=(window.location.protocol.split(":")[0]||"").toUpperCase(),$se))==="HTTPS",Wt=Gme()?window.isSecureContext:"Browser Not Support";(!Gme()&&!B||!window.isSecureContext)&&CN.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),CN.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),T5.setAppId(s);try{if(!l&&l!==null)throw new LH(dH.INVALID_PARAMS,"Invalid token: ".concat(l,". If you don not use token, set it to null"));l&&jK(l,"token",1,2047),jK(s,"appid",1,2047),yoe(d),f&&Roe(f),b&&jK(b,"optionalInfo",1,2047)}catch(rH){throw T5.reportApiInvoke(EQ(),{name:_K.JOIN,options:[s,d,l,f],states:{isHttps:B,isSecureContext:Wt},tag:Y6.TRACER}).onError(rH),rH}if(this._leaveMutex.isLocked&&(CN.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),CN.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const rH=new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw T5.reportApiInvoke(EQ(),{name:_K.JOIN,options:[s,d,l,f],states:{isHttps:B,isSecureContext:Wt},tag:Y6.TRACER}).onError(rH),rH}this._gateway.state="CONNECTING";const $O=await Uye({appId:s,cname:d,uid:f,stringUid:typeof f=="string"?f:void 0,token:l||s,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const uN=($O==null?void 0:$O.sid)||EQ();CN.info("[".concat(this._clientId,"] start join channel ").concat(d,", join number: ").concat(k)),this._sessionId||(this._sessionId=uN,this.store.sessionId=this._sessionId);const lN=T5.reportApiInvoke(uN,{id:this._clientId,name:_K.JOIN,options:[s,d,l,f],states:{isHttps:B,isSecureContext:Wt},tag:Y6.TRACER}),_N=vY(vY(vY({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:s,sid:this._sessionId,cname:d,uid:typeof f!="string"?f:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:l||s,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:b,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!$O},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:_H("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_N.setLocalAPVersion=this._setLocalAPVersion),typeof f=="string"&&(_N.stringUid=f,this._uintUid?(_N.uid=this._uintUid,this._uintUid=void 0):_N.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_N.aesmode=this._encryptionMode,_N.aespassword=await(async rH=>{const iH=function(){const PH=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),OH=new Uint8Array(new ArrayBuffer(PH.length));for(let wH=0;wH<PH.length;wH+=1)OH[wH]=PH.charCodeAt(wH);return OH}(),lH=await window.crypto.subtle.importKey("spki",iH,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),hH=Ede(rH),bH=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},lH,hH);return function(PH){let OH="";for(let wH=0;wH<PH.length;wH+=1)OH+=String.fromCharCode(PH[wH]);return window.btoa(OH)}(new Uint8Array(bH))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_N.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const rH=new TextEncoder,iH=_H("USE_PURE_ENCRYPTION_MASTER_KEY")?rH.encode(_N.appId+this._encryptionSecret+this._encryptionSecret):rH.encode(_N.appId+_N.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(lH,hH,bH){const PH=await window.crypto.subtle.importKey("raw",hH,"PBKDF2",!1,["deriveBits","deriveKey"]),OH=lH==="aes-128-gcm2"?128:256,wH=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:bH},PH,OH+96);return new Uint8Array(wH).subarray(OH/8)}(this._encryptionMode,iH,_Q(this._encryptionSalt)),this._encryptDataStreamKey=await async function(lH,hH,bH){const PH=await window.crypto.subtle.importKey("raw",hH,"PBKDF2",!1,["deriveBits","deriveKey"]),OH=lH==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:bH},PH,{name:"AES-GCM",length:OH},!0,["encrypt","decrypt"])}(this._encryptionMode,iH,_Q(this._encryptionSalt))}else Wt?CN.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):CN.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,CN.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:d,appId:s,stringUid:_N.stringUid});const TN=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&TN===this._sessionId&&T5.joinChannelTimeout(this._sessionId,5)},5e3);try{var vN;let rH;const iH=_N.cloudProxyServer;if(a5(vN=["proxy3","proxy4","proxy5"]).call(vN,iH)){const OH=_H("PROXY_SERVER_TYPE3");Array.isArray(OH)?_N.proxyServer=OH[0]:_N.proxyServer=OH}if(T5.setProxyServer(_N.proxyServer),CN.setProxyServer(_N.proxyServer),this.store.requestAPStart(),$O){if(CN.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_N.stringUid?", ".concat(_N.stringUid," => ").concat($O.intUid):""," ")),_N.stringUid&&!_N.uid&&(_N.uid=$O.intUid),rH={gatewayInfo:$O.ap.gatewayInfo},_H("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_N.turnServer.mode==="auto")if($O.ap.proxyInfo.addresses.length===0)CN.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const OH=(await ASe($O.ap.proxyInfo,$O.ap.gatewayInfo.uid)).map(wH=>({turnServerURL:wH.address,tcpport:wH.tcpport||JK.tcpport,udpport:wH.udpport||JK.udpport,username:wH.username||JK.username,password:wH.password||JK.password,forceturn:!1,security:!0}));_N.turnServer={mode:"manual",servers:OH}}Fye($O,_N.stringUid)}else{if(_N.stringUid&&!_N.uid){let OH;[OH,rH]=await u5.all([nye(_N.stringUid,_N,this._axiosCancelSource.token,this._config.httpRetryConfig||EK,this.store),tye(_N,this._axiosCancelSource.token,this._config.httpRetryConfig||EK,!0,this.store)]),CN.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_N.stringUid," => ").concat(OH)),_N.uid=OH,rH.gatewayInfo.uid=OH,rH.gatewayInfo.res.uid=OH}else rH=await tye(_N,this._axiosCancelSource.token,this._config.httpRetryConfig||EK,!0,this.store);if(!this._joinAndNotLeaveYet)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_N,this._axiosCancelSource.token),this._configDistribute.on(Ine.UPDATE_BITRATE_LIMIT,OH=>{this._p2pChannel.updateBitrateLimit(OH)}),this._configDistribute.on(Ine.UPDATE_CLIENT_ROLE_OPTIONS,OH=>{this._setClientRoleOptions(OH)})},0),this._key=l||s;const lH=rH.gatewayInfo,hH=_N.uid?_N.uid:lH.uid;this._joinInfo=vY(vY({},_N),{},{cid:lH.cid,uid:hH,vid:lH.vid,apResponse:lH.res,apGatewayAddress:lH.apGatewayAddress,uni_lbs_ip:lH.uni_lbs_ip,gatewayAddrs:lH.gatewayAddrs}),this.store.intUid=hH,this.store.cid=lH.cid;const bH=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));lN.onSuccess(bH),this._appId=s,this._channelName=_N.cname,this._uid=bH,this.store.uid=bH,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(KK()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const PH=_N.stringUid?"string uid: ".concat(_N.stringUid,",uid: ").concat(_N.uid):"uid: ".concat(this._uid);return CN.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(d,",").concat(PH)),setTimeout(()=>{CN.startUpload()},5e3),this.store.joinEnd(),uH=this,a5(bQ).call(bQ,uH)||bQ.push(uH),this._cloudProxyServerMode==="disabled"&&u6().supportWebCrypto&&_H("ENABLE_PRELOAD")&&Ule(this._joinInfo),bH}catch(rH){const iH=Array.isArray(rH)?rH[0]:rH;throw iH&&iH.code===dH.OPERATION_ABORTED?CN.warning("[".concat(this._clientId,"] join number: ").concat(k,", Joining channel failed, rollback"),iH):CN.error("[".concat(this._clientId,"] join number: ").concat(k,", Joining channel failed, rollback"),iH),iH.code!==dH.OPERATION_ABORTED&&this._numberOfJoinCount===k&&(this._gateway.state="DISCONNECTED",this._reset()),lN.onError(iH),iH}var uH}_joinGateway(){if(!this._joinInfo||!this._key)throw new LH(dH.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!_H("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){CN.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(KK()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(d){const l=bQ.indexOf(d);l!==-1&&bQ.splice(l,1)}(this),this._statsCollector.stopUpdateStats();const s=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return CN.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void s();await this._gateway.leave(this.connectionState!=="CONNECTED",_6.LEAVE),CN.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),s()}async publish(s){let d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(s)){if(!(s instanceof V$))return this._publishDataChannel(s);s=[s]}if(s.length===0)throw new LH(dH.INVALID_PARAMS,"param list is empty");const l=s;if(this._gateway.role==="audience")throw new LH(dH.INVALID_OPERATION,"audience can not publish stream");for(const b of l){if(!(b instanceof V$))throw new LH(dH.INVALID_PARAMS,"parameter is not local track");if(!b._enabled&&d)throw new LH(dH.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(b.getTrackId()))}CN.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(l.map(b=>"".concat(b.getTrackId()," "))));const f=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),d&&l.forEach(b=>{const k=this._configDistribute.getBitrateLimit();b instanceof x6&&k&&b.setBitrateLimit(k.uplink)});try{await this._publishHighStream(l),CN.info("[".concat(this._clientId,"] Publish success, id ").concat(l.map(b=>"".concat(b.getTrackId()," "))))}catch(b){throw CN.error("[".concat(this._clientId,"] publish error"),b.toString()),b}finally{f()}}async _publishDataChannel(s){b6(s.id,"id",0,65535,!0),O7(s.ordered,"ordered"),jK(s.metadata,"metadata",0,512),CN.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(s.id));const d=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(b=>b.id===s.id)!==-1)throw new LH(dH.INVALID_PARAMS,"Invalid id: ".concat(s.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new LH(dH.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_H("FORCE_TURN")&&!_H("TURN_ENABLE_TCP")&&!_H("TURN_ENABLE_UDP"))throw new LH(dH.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const l=function(b){return KSe(b,!1)}(s),f=await this._p2pChannel.publishDataChannel([l]);if(f.length>0){if(typeof l._originDataChannelId!="number")throw CN.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new LH(dH.CREATE_DATACHANNEL_ERROR);try{await u5.all(f.map(b=>this._uid&&this._gateway.publishDataChannel(this._uid,b,!0))),await l._waitTillOpen()}catch(b){if(b.code!==dH.DISCONNECT_P2P)throw b}}return CN.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(l.id)),l}catch(l){throw CN.error("[".concat(this._clientId,"] publish datachannels error"),l.toString()),l}finally{d()}}async unpublish(s){if(!this._joinInfo||this._uid===void 0)throw new LH(dH.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let d=[];if(s)if(Array.isArray(s))d=s;else{if(!(s instanceof V$))return this._unpublishDataChannel([s]);d=[s]}else this.store.useP2P||await this._unpublishDataChannel(),d=this._p2pChannel.getAllTracks(!0);CN.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(d.map(f=>"".concat(f.getTrackId()," "))," "));const l=await this._publishMutex.lock();try{if(this.store.useP2P){const f=await this._p2pChannel.unpublish(d);f&&await this._gateway.sendExtensionMessage(oK.UNPUBLISH,{unpubMsg:f},!0)}else{const f=await this._p2pChannel.unpublish(d);f&&await this._gateway.unpublish(f,this._uid),CN.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(d.map(b=>"".concat(b.getTrackId()))))}}catch(f){throw CN.error("[".concat(this._clientId,"] unpublish error"),f.toString()),f}finally{l&&l()}}async _unpublishDataChannel(s){s!==void 0&&s.length!==0||(s=this._p2pChannel.getAllDataChannels()),CN.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(s.map(l=>"".concat(l.id," "))," "));const d=await this._publishMutex.lock();try{const l=await this._p2pChannel.unpublishDataChannel(s);l&&await this._gateway.unpublishDataChannel(l),CN.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(s.map(f=>"".concat(f.id))))}catch(l){throw CN.error("[".concat(this._clientId,"] unpublish dataChannel error"),l.toString()),l}finally{d&&d()}}async subscribe(s,d,l){if(!(s instanceof GX)){const f=this.remoteUsers.find(b=>b.uid===s);if(!f)throw new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");s=f}return d==="datachannel"?this._subscribeDataChannel(s,l):this._subscribe(s,d)}async presubscribe(s,d){if(vK(d,"mediaType",["audio","video"]),this.store.useP2P)throw new LH(dH.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const l=d===_5.AUDIO,f=d===_5.VIDEO,b=await this._subscribeMutex.lock();try{const{ssrcId:k,ortc:B,rtxSsrcId:Wt,cname:$O,uint_id:uN}=await this._gateway.presubscribe(s,d,!0);if(k==null)throw new LH(dH.UNEXPECTED_RESPONSE,"no ssrc id");let lN=this._users.find(TN=>TN.uid===s);lN||(lN=new GX(s,uN||s),lN._is_pre_created=!0,this._users.push(lN)),$O&&(lN._cname=$O),lN._uintid||(lN._uintid=uN||s),l&&(lN._audioSSRC=k,lN._audio_pre_subscribed=!0,B&&(lN._audioOrtc=B)),f&&(lN._videoSSRC=k,lN._video_pre_subscribed=!0,B&&(lN._videoOrtc=B),Wt!=null&&(lN._rtxSsrcId=Wt)),CN.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(k)),await this._p2pChannel.subscribe(lN,d,k,Wt,B);const _N=l?lN._audioTrack:lN._videoTrack;if(!_N)throw new LH(dH.UNEXPECTED_ERROR,"can not find remote track in user");return l&&(lN._trust_audio_stream_added_state_=!0,lN._audio_added_=!0),f&&(lN._trust_video_stream_added_state_=!0,lN._video_added_=!0),_N}catch(k){throw CN.error("[".concat(this._clientId,"] presub user ").concat(s," error"),k),k}finally{b()}}async _subscribeDataChannel(s,d){var l;if(b6(d,"channelId",0,65535,!0),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(Wt=>Wt===s))throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid,", this user is not in the channel")),new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");if(!s.hasAudio&&!s.hasVideo&&s._dataChannels.length===0)throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid,", user is not published")),new LH(dH.INVALID_REMOTE_USER,"user is not published");const b=(l=s._dataChannels)===null||l===void 0?void 0:l.find(Wt=>Wt.id===d);if(!b)throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid," with mediaType datachannel, remote datachannel is not published")),new LH(dH.REMOTE_USER_IS_NOT_PUBLISHED);const k=await this._subscribeMutex.lock();CN.info("[".concat(this._clientId,"] subscribe user ").concat(s.uid,", mediaType: datachannel"));try{const Wt=await this._p2pChannel.subscribeDataChannel(s,[b]);if(Wt&&a5(Wt).call(Wt,b.id))try{var B;if(typeof b._originDataChannelId!="number")throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid," with mediaType datachannel, cannot get RTCDatachannel")),new LH(dH.CREATE_DATACHANNEL_ERROR);const $O={id:b.id,datachannelId:b._originDataChannelId,ordered:b.ordered,maxRetransmits:b.maxRetransmits,metadata:(B=b.metadata)!==null&&B!==void 0?B:""};await this._gateway.subscribeDataChannel(s.uid,$O,!0),await b._waitTillOpen()}catch($O){if(($O==null?void 0:$O.code)!==dH.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(s,[b]),$O;await this._p2pChannel.unsubscribeDataChannel(s,[b]),this._p2pChannel.setPendingRemoteDataChannel(s,b.id)}return CN.info("[".concat(this._clientId,"] subscribe success user ").concat(s.uid,", mediaType: datachannel")),b}finally{k()}}async _p2pSubscribe(s,d,l){if(vK(d,"mediaType",["audio","video"]),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(k=>k===s)){const k=new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid,", this user is not in the channel")),k}if(!s.hasAudio&&!s.hasVideo){const k=new LH(dH.INVALID_REMOTE_USER,"user is not published");throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid,", user is not published")),k}if(!l&&(d==="audio"&&!s.hasAudio||d==="video"&&!s.hasVideo)){const k=new LH(dH.REMOTE_USER_IS_NOT_PUBLISHED);throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid," with mediaType ").concat(d,", remote track is not published")),k}const b=await this._subscribeMutex.lock();CN.info("[".concat(this._clientId,"] subscribe user ").concat(s.uid,", mediaType: ").concat(d));try{if(await this._p2pChannel.hasRemoteMediaWithLock(s,d))await this._p2pChannel.unmuteRemote(s,d);else try{const B=d==="audio"?s._audioSSRC:s._videoSSRC,Wt=d==="audio"?s._audioMid:s._videoMid;this.store.subscribe(s.uid,d,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(s,d,B,Wt)}catch(B){throw B}CN.info("[".concat(this._clientId,"] subscribe success user ").concat(s.uid,", mediaType: ").concat(d)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(s.uid,this._defaultStreamFallbackType).catch(B=>{CN.warning("[".concat(this._clientId,"] auto set fallback failed"),B)});const k=d==="audio"?s._audioTrack:s._videoTrack;if(!k)throw new LH(dH.UNEXPECTED_ERROR,"can not find remote track in user object");return k}catch(k){throw CN.error("[".concat(this._clientId,"] subscribe user ").concat(s.uid," error"),k),k}finally{b()}}async _subscribe(s,d,l){if(this.store.useP2P)return this._p2pSubscribe(s,d);if(vK(d,"mediaType",["audio","video"]),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(uN=>uN===s)){const uN=new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid,", this user is not in the channel")),uN}if(!s.hasAudio&&!s.hasVideo){const uN=new LH(dH.INVALID_REMOTE_USER,"user is not published");throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid,", user is not published")),uN}if(!(l||(d!=="audio"||s.hasAudio&&s._audioSSRC!==void 0)&&(d!=="video"||s.hasVideo&&s._videoSSRC!==void 0))){const uN=new LH(dH.REMOTE_USER_IS_NOT_PUBLISHED);throw CN.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid," with mediaType ").concat(d,", remote track is not published")),uN}let b=d==="audio"?s._audioSSRC:s._videoSSRC,k=d==="audio"?s._audioOrtc:s._videoOrtc,B=d==="video"?s._rtxSsrcId:void 0,Wt={stream_type:d==="audio"?_5.AUDIO:_5.VIDEO,ssrcId:b};const $O=await this._subscribeMutex.lock();CN.info("[".concat(this._clientId,"] subscribe user ").concat(s.uid,", mediaType: ").concat(d));try{if(await this._p2pChannel.hasRemoteMediaWithLock(s,d))await this._p2pChannel.unmuteRemote(s,d);else try{const lN=d==="audio"?s._audioSSRC:s._videoSSRC;lN!==void 0&&lN!==b&&(b=lN,k=d==="audio"?s._audioOrtc:s._videoOrtc,B=d==="video"?s._rtxSsrcId:void 0,Wt={stream_type:d==="audio"?_5.AUDIO:_5.VIDEO,ssrcId:b}),r4.markSubscribeStart(this.store.clientId,b),this.store.subscribe(s.uid,d,Date.now()),await this._p2pChannel.subscribe(s,d,b,B,k);try{this._p2pChannel.isPreSubScribe(b)||await this._gateway.subscribe(s.uid,Wt,!0)}catch(_N){if((_N==null?void 0:_N.code)!==dH.WS_ABORT)throw await this._p2pChannel.unsubscribe(s,d),_N;await this._p2pChannel.unsubscribe(s,d,!0),this._p2pChannel.setPendingRemoteMedia(s,d)}this.store.subscribe(s.uid,d,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,s,d)}catch(lN){throw this._p2pChannel.reportSubscribeEvent(!1,lN==null?void 0:lN.code,s,d),lN}CN.info("[".concat(this._clientId,"] subscribe success user ").concat(s.uid,", mediaType: ").concat(d)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(s.uid,this._defaultStreamFallbackType).catch(lN=>{CN.warning("[".concat(this._clientId,"] auto set fallback failed"),lN)});const uN=d==="audio"?s._audioTrack:s._videoTrack;if(!uN)throw new LH(dH.UNEXPECTED_ERROR,"can not find remote track in user object");return uN}catch(uN){throw CN.error("[".concat(this._clientId,"] subscribe user ").concat(s.uid," error"),uN),uN}finally{$O()}}async massSubscribe(s){if(N7(s,"subscribeList"),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const d=Date.now(),l=new Map,f=await this._subscribeMutex.lock();CN.info("[".concat(this._clientId,"]start massSubscribe user ").concat(s.map(Wt=>{let{user:$O,mediaType:uN}=Wt;return"user: ".concat($O==null?void 0:$O.uid,", mediaType: ").concat(uN)}).join("; ")));const b=(s=[...s]).map(Wt=>{let{user:$O,mediaType:uN}=Wt;return{user:$O,mediaType:uN}}),k=await this._p2pChannel.globalLock();try{var B;for(let $O=s.length-1;$O>=0;$O--){const uN=s[$O],{user:lN,mediaType:_N}=uN;if(vK(_N,"mediaType",["audio","video"]),!lN){const rH=new LH(dH.INVALID_PARAMS,"user property does not exist in subscribeList item");throw CN.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),rH}if(!this._users.find(rH=>rH===lN)){const rH=new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");CN.error("[".concat(this._clientId,"] can not massSubscribe ").concat(lN.uid,", this user is not in the channel")),b[$O].error=rH,s.splice($O,1);continue}if(_N==="audio"&&(!lN.hasAudio||lN._audioSSRC===void 0)||_N==="video"&&(!lN.hasVideo||lN._videoSSRC===void 0)){const rH=new LH(dH.REMOTE_USER_IS_NOT_PUBLISHED);CN.error("[".concat(this._clientId,"] can not subscribe ").concat(lN.uid," with mediaType ").concat(_N,", remote user is not published")),b[$O].error=rH,s.splice($O,1);continue}const vN=NK.Video|NK.LwoVideo,uH=l.get(lN);if(uH){if(_N==="video"?uH&vN:uH&NK.Audio){s.splice($O,1),CN.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(lN.uid,", mediaType:").concat(_N," twice"));continue}l.set(lN,uH|(_N==="video"?vN:NK.Audio))}else l.set(lN,_N==="video"?vN:NK.Audio)}for(let $O=s.length-1;$O>=0;$O--){const uN=s[$O],{user:lN,mediaType:_N}=uN,TN=NK.Video|NK.LwoVideo;if(this._p2pChannel.hasRemoteMedia(lN,_N)){await this._p2pChannel.unmuteRemoteNoLock(lN,_N);const vN=l.get(lN);l.set(lN,_N==="video"?vN^TN:vN^NK.Audio),s.splice($O,1)}}this.store.massSubscribe(s.map($O=>({userId:$O.user.uid,type:$O.mediaType})),d);let Wt=z4(B=Array.from(l.entries())).call(B,($O,uN)=>{let[lN,_N]=uN;if(_N===0)return $O;const TN={stream_id:lN.uid,stream_type:_N};return _N&NK.Audio&&(TN.audio_ssrc=lN._audioSSRC),_N&NK.Video&&(TN.video_ssrc=lN._videoSSRC),$O.push(TN),$O},[]);try{s.length>0&&await this._p2pChannel.massSubscribeNoLock(s.map(uN=>{let{user:lN,mediaType:_N}=uN;return{user:lN,mediaType:_N,ssrcId:_N===_5.VIDEO?lN._videoSSRC:lN._audioSSRC,rtxSsrcId:_N===_5.VIDEO?lN._rtxSsrcId:void 0}}));const $O=new Map;if(Wt=Wt.filter(uN=>uN.video_ssrc&&!this._p2pChannel.isPreSubScribe(uN.video_ssrc)||uN.audio_ssrc&&!this._p2pChannel.isPreSubScribe(uN.audio_ssrc)||!uN.video_ssrc&&!uN.audio_ssrc),Wt.length>0){const uN=await this._gateway.subscribeAll(Wt,!0);((uN==null?void 0:uN.users)||[]).forEach(lN=>{let{stream_id:_N,video_error_code:TN,audio_error_code:vN,error_code:uH}=lN;(TN||vN||uH)&&$O.set(_N,{video_error_code:TN,audio_error_code:vN,error_code:uH})})}if(Array.from($O.entries()).length>0){const uN=[];Array.from($O.entries()).forEach(lN=>{let[_N,TN]=lN;const vN=this.remoteUsers.find(uH=>uH.uid===_N);if(vN){let uH;TN.error_code||TN.video_error_code&&TN.audio_error_code?uH=void 0:TN.video_error_code?uH=_5.VIDEO:TN.audio_error_code&&(uH=_5.AUDIO),uN.push({user:vN,mediaType:uH})}}),uN.length>0&&await this._p2pChannel.massUnsubscribeNoLock(uN)}for(const uN of b){const lN=$O.get(uN.user.uid);if(lN){const _N=lN.error_code||uN.mediaType==="audio"&&lN.audio_error_code||uN.mediaType==="video"&&lN.video_error_code;if(_N){const TN=wne(_N);CN.error("user:".concat(uN.user.uid," mediaType:").concat(uN.mediaType," has massSubscribe error ").concat(TN.desc)),uN.error=new LH(dH.SUBSCRIBE_FAILED,"code ".concat(_N,": ").concat(TN.desc))}}uN.error||(uN.mediaType==="video"?uN.track=uN.user.videoTrack:uN.track=uN.user.audioTrack)}return this.store.massSubscribe(b.filter(uN=>!uN.error).map(uN=>({userId:uN.user.uid,type:uN.mediaType})),void 0,Date.now()),b.forEach(uN=>{var lN;T5.subscribe(this.store.sessionId,{succ:!!uN.error,ec:((lN=uN.error)===null||lN===void 0?void 0:lN.code)||null,video:uN.mediaType===_5.VIDEO,audio:uN.mediaType===_5.AUDIO,peerid:uN.user.uid,subscribeRequestid:uN.mediaType===_5.VIDEO?uN.user._videoSSRC:uN.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-d),preSsrc:this._p2pChannel.isPreSubScribe(uN.user._videoSSRC)},!0)}),CN.info("[".concat(this._clientId,"] massSubscribe success ").concat(s.map(uN=>{let{user:lN,mediaType:_N}=uN;return"user: ".concat(lN==null?void 0:lN.uid,", mediaType: ").concat(_N)}).join("; "))),b}catch($O){throw await this._p2pChannel.massUnsubscribeNoLock(s),$O}}finally{k(),f()}}async unsubscribe(s,d,l){if(!(s instanceof GX)){const k=this.remoteUsers.find(B=>B.uid===s);if(!k)throw new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");s=k}if(d||this.store.useP2P){if(d==="datachannel")return this._unsubscribeDataChannel(s,l)}else await this._unsubscribeDataChannel(s,l);if(d&&vK(d,"mediaType",["audio","video"]),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(k=>k===s)){const k=new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");throw CN.error("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),k}CN.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(s.uid,", mediaType: ").concat(d));const b=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(s,d);else{const k=await this._p2pChannel.unsubscribe(s,d);k&&await this._gateway.unsubscribe(k,s.uid),d&&d!=="audio"||(s._audio_pre_subscribed=!1),d&&d!=="video"||(s._video_pre_subscribed=!1),s._is_pre_created&&Xse(this._users,s),CN.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(s.uid,", mediaType: ").concat(d))}}catch(k){if(k.code===dH.DISCONNECT_P2P)return void CN.warning("disconnecting p2p, abort unsubscribe request.");throw CN.error("[".concat(this._clientId,"] unsubscribe user ").concat(s.uid," error"),k.toString()),k}finally{b()}}async _unsubscribeDataChannel(s,d){if(d&&b6(d,"id",0,65535,!0),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(b=>b===s)){const b=new LH(dH.INVALID_REMOTE_USER,"user is not in the channel");throw CN.error("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),b}let f;if(typeof d=="number"){const b=s._dataChannels.find(k=>k.id===d);b&&(f=[b])}else f=s._dataChannels;if(f===void 0){const b=new LH(dH.REMOTE_USER_IS_NOT_PUBLISHED);throw CN.error("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid," with channelId ").concat(d,", remote datachannel is not published")),b}CN.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(s.uid,", mediaType: datachannel, ids: ").concat(f.map(b=>b.id)));try{const b=await this._p2pChannel.unsubscribeDataChannel(s,f);b&&await this._gateway.unsubscribeDataChannel(b,s.uid),CN.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(s.uid,", mediaType: datachannel, ids: ").concat(b))}catch(b){if(b.code===dH.DISCONNECT_P2P)return void CN.warning("disconnecting p2p, abort unsubscribe request.");throw CN.error("[".concat(this._clientId,"] unsubscribe user ").concat(s.uid," error"),b.toString()),b}}async massUnsubscribe(s){if(N7(s,"unsubscribeList"),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");CN.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(s.map(l=>{let{user:f,mediaType:b}=l;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(b,";")}).join())),s=[...s];const d=new Map;for(let l=s.length-1;l>=0;l--){const{user:f,mediaType:b}=s[l];if(!f){const Wt=new LH(dH.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw CN.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),Wt}if(vK(b,"mediaType",["video","audio",void 0]),!this._users.find(Wt=>Wt===f)){CN.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(f.uid,", user is not in the channel")),s.splice(l,1);continue}const B=NK.Video|NK.LwoVideo;if(d.has(f)){const Wt=d.get(f);let $O;switch(b){case"video":$O=Wt&B;break;case"audio":$O=Wt&NK.Audio;break;default:$O=Wt&(NK.Audio|B)}if($O){CN.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(f.uid,",mediaType:").concat(b," twice.")),s.splice(l,1);continue}b?b==="audio"?d.set(f,Wt|NK.Audio):b==="video"&&d.set(f,Wt|B):d.set(f,Wt|NK.Audio|B)}else b?b==="audio"?d.set(f,NK.Audio):b==="video"&&d.set(f,B):d.set(f,NK.Audio|B)}try{const l=await this._p2pChannel.massUnsubscribe(s);l&&await this._gateway.massUnsubscribe(l),CN.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(s.map(f=>{let{user:b,mediaType:k}=f;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(k,";")}).join()))}catch(l){if(l.code===dH.DISCONNECT_P2P)return void CN.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw CN.error("[".concat(this._clientId,"] massUnsubscribe error"),l.toString()),l}}async setLowStreamParameter(s){(function(l){if(!l)throw new jH(dH.INVALID_PARAMS);z6(l.width)||fde(l.width,"streamParameter.width"),z6(l.height)||fde(l.height,"streamParameter.height"),z6(l.framerate)||fde(l.framerate,"streamParameter.framerate"),z6(l.bitrate)||b6(l.bitrate,"streamParameter.bitrate")})(s),(!s.width&&s.height||s.width&&!s.height)&&CN.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),CN.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(s));const d=this._configDistribute.getLowStreamConfigDistribute();if(d&&d.bitrate&&s.bitrate&&d.bitrate<s.bitrate&&(s.bitrate=d.bitrate),this._lowStreamParameter=s,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(s,JH.LocalVideoLowTrack)}async enableDualStream(){if(!u6().supportDualStream)throw T5.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new LH(dH.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new LH(dH.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(s){throw T5.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),s}this._isDualStreamEnabled=!0,T5.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),CN.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(JH.LocalVideoLowTrack))try{const s=await this._p2pChannel.unpublishLowStream();s&&await this._gateway.unpublish(s,this._joinInfo.stringUid||this._joinInfo.uid)}catch(s){throw T5.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),s}this._isDualStreamEnabled=!1,T5.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),CN.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(s,d){if(function(f){vK(f,"role",["audience","host"])}(s),d&&gde(d),this.mode==="rtc"||this.mode==="p2p")throw CN.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new LH(dH.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(d&&d.level&&s==="host")throw new LH(dH.INVALID_OPERATION,"host mode can not set audience latency level");if(s==="audience"&&this._p2pChannel.hasLocalMedia())throw new LH(dH.INVALID_OPERATION,"can not set client role to audience when publishing stream");const l=this._config.role;this._joinInfo&&(this._joinInfo.role=s),s!==l&&_H("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(s,d),this._config.role=s,this._gateway.reconnect("recover",zK.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(s,d),this._config.role=s),CN.info("[".concat(this._clientId,"] set client role to ").concat(s,", level: ").concat(d&&d.level))}async _setClientRoleOptions(s){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let d=!1;try{s&&gde(s),await this._gateway.setClientRole(this._config.role,s),d=!0}catch{}finally{CN.info("[".concat(this._clientId,"] set client role options ").concat(d?"succeed":"failed",", options is ").concat(s))}}getRemoteInboundOffset(){var s;const d=(s=this._p2pChannel.getStats())===null||s===void 0?void 0:s.audioSend[0];if(!d||!d.timestamp)return 0;const l=d.timestamp-Date.now();return Math.abs(l)>1e3+d.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?l:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(s,d){if(jK(s,"proxyServer"),!d){if(this.connectionState!=="DISCONNECTED")throw new LH(dH.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new LH(dH.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=s,T5.setProxyServer(this._proxyServer),CN.setProxyServer(this._proxyServer),CN.info("[".concat(this._clientId,"] Set proxy server ").concat(d?"by initialize call":""," success."))}setTurnServer(s,d){if(Array.isArray(s)||(s=[s]),!d){if(this.connectionState!=="DISCONNECTED")throw new LH(dH.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new LH(dH.INVALID_OPERATION,"You have already set the proxy")}if(mne(s))return this._turnServer={servers:s,mode:"original-manual"},void CN.info("[".concat(this._clientId,"] Set original turnserver ").concat(d?"by initialize call":""," success: ").concat(s.map(l=>l.urls).join(","),"."));s.forEach(l=>Nme(l)),this._turnServer={servers:s,mode:"manual"},CN.info("[".concat(this._clientId,"] Set turnserver ").concat(d?"by initialize call":""," success."))}setLicense(s){if(this.connectionState!=="DISCONNECTED")throw new LH(dH.INVALID_OPERATION,"you should set license before join channel");if(jK(s,"license",32,32),!/^[A-Za-z\d]+$/.test(s))throw new LH(dH.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=s,CN.info("[".concat(this._clientId,"] set license success"),s)}startProxyServer(s){if(this.connectionState!=="DISCONNECTED")throw new LH(dH.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new LH(dH.INVALID_OPERATION,"You have already set the proxy");const d=[3,4,5];let l;switch(s===void 0&&(s=3),s){case 1:case 2:throw new LH(dH.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:l="proxy3";break;case 4:l="proxy4";break;case 5:l="proxy5";break;default:throw new LH(dH.INVALID_PARAMS,"proxy server mode must be ".concat(d.join("|")))}this._cloudProxyServerMode=l,this.store.cloudProxyServerMode=l,CN.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new LH(dH.INVALID_OPERATION,"Stop proxy server after leave channel");T5.setProxyServer(),CN.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",CN.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(s){if(!s.accessPoints)throw new LH(dH.INVALID_PARAMS,"accessPoints is required.");N7(s.accessPoints.serverList,"accessPoints.serverList"),jK(s.accessPoints.domain,"accessPoints.domain");const d=(TN,vN)=>{b6(TN,vN,0,65535,!0)};let l=443;if(s.accessPoints.port&&(d(s.accessPoints.port,"accessPoints.port"),l=s.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new LH(dH.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");_H("CLOSE_AFB_FOR_LOCAL_AP")&&(S6("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),S6("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const f=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,b=s.accessPoints.domain,k=s.accessPoints.serverList.map(TN=>f.test(TN)?"".concat(TN.replace(/\./g,"-"),".").concat(b):TN),B=k.map(TN=>"".concat(TN,":").concat(l));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,S6("WEBCS_DOMAIN",B),S6("WEBCS_DOMAIN_BACKUP_LIST",B),S6("GATEWAY_DOMAINS",[b]),s.report&&s.report.hostname&&Array.isArray(s.report.hostname)&&s.report.hostname.length?(N7(s.report.hostname,"report.hostname"),S6("EVENT_REPORT_DOMAIN",s.report.hostname[0]),S6("EVENT_REPORT_BACKUP_DOMAIN",s.report.hostname[1]||s.report.hostname[0])):(S6("EVENT_REPORT_DOMAIN",k[0]),S6("EVENT_REPORT_BACKUP_DOMAIN",k[1]||k[0]));let Wt=6443;s.report&&s.report.port&&(d(s.report.port,"report.port"),Wt=s.report.port),S6("STATS_COLLECTOR_PORT",Wt),s.report?S6("ENABLE_EVENT_REPORT",!0):S6("ENABLE_EVENT_REPORT",!1);let $O="";s.log&&s.log.hostname&&Array.isArray(s.log.hostname)&&s.log.hostname.length?(N7(s.log.hostname,"log.hostname"),$O=s.log.hostname[0]):$O=k[0];let uN=6444;s.log&&s.log.port&&(d(s.log.port,"log.port"),uN=s.log.port),S6("LOG_UPLOAD_SERVER","".concat($O,":").concat(uN));let lN=[];s.cds&&s.cds.hostname&&Array.isArray(s.cds.hostname)&&s.cds.hostname.length?(N7(s.cds.hostname,"cds.hostname"),lN=s.cds.hostname):lN=k;let _N=443;s.cds&&s.cds.port&&(d(s.cds.port,"cds.port"),_N=s.cds.port),S6("CDS_AP",lN.map(TN=>"".concat(TN,":").concat(_N))),s.cds?S6("ENABLE_CONFIG_DISTRIBUTE",!0):S6("ENABLE_CONFIG_DISTRIBUTE",!1),CN.info("set local access point v2 success")}setLocalAccessPoints(s,d){if(N7(s,"serverList"),jK(d,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new LH(dH.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const l=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;s=s.map(f=>l.test(f)?"".concat(f.replace(/\./g,"-"),".").concat(d):f),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,S6("WEBCS_DOMAIN",s),S6("WEBCS_DOMAIN_BACKUP_LIST",s),S6("GATEWAY_DOMAINS",[d]),S6("EVENT_REPORT_DOMAIN",s[0]),S6("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]),S6("LOG_UPLOAD_SERVER","".concat(s[0],":6444")),CN.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(s){if(vK(s,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=s,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(s),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(d){throw CN.error("[".concat(this._clientId,"] set default remote video stream type error"),d.toString()),d}else CN.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(s))}async setRemoteVideoStreamType(s,d){vK(d,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(s,d),setTimeout(()=>{const l=this._users.find(f=>f.uid===s);l&&l.videoTrack&&l.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(l){throw CN.error("[".concat(this._clientId,"] set remote video stream type error"),l.toString()),l}CN.info("[".concat(this._clientId,"] set remote ").concat(s," video stream type to ").concat(d)),this._remoteStreamTypeCacheMap.set(s,d)}async setStreamFallbackOption(s,d){vK(d,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(s,d)}catch(l){throw CN.error("[".concat(this._clientId,"] set stream fallback option"),l.toString()),l}CN.info("[".concat(this._clientId,"] set remote ").concat(s," stream fallback type to ").concat(d)),this._streamFallbackTypeCacheMap.set(s,d)}setEncryptionConfig(s,d,l,f){(function(k){vK(k,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(s),jK(d,"secret");const b=["aes-128-gcm2","aes-256-gcm2"];if(a5(b).call(b,s)){if(!l||!(l instanceof Uint8Array&&l.length===32))throw new LH(dH.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(l)throw new LH(dH.INVALID_PARAMS,"current encrypt mode does not need salt");if(f){if(O7(f,"encryptDataStream"),!a5(b).call(b,s))throw new LH(dH.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(d)||CN.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=s,this._encryptionSecret=d,l&&(this._encryptionSalt=MX(l))}async renewToken(s){if(jK(s,"token",1,2047),!this._key||!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"renewToken should not be called before user join");const d=this._key;this._key=s,this._joinInfo&&(this._joinInfo.token=s);const l=await this._renewTokenMutex.lock();try{if(_H("USE_NEW_TOKEN")){CN.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const f=await Kke(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||EK);CN.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:s,ticket:f})}else CN.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:s});CN.debug("[".concat(this._clientId,"] renewToken success"))}catch(f){throw this._key=d,this._joinInfo.token=d,CN.error("[".concat(this._clientId,"] renewToken failed"),f.toString()),f}finally{l()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?CN.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const s=this._p2pChannel.getAudioLevels();this.safeEmit(z5.VOLUME_INDICATOR,s)},_H("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const s=this._statsCollector.getRTCStats(),d=this._gateway.getInChannelInfo();return s.Duration=Math.round(d.duration/1e3),s}async startLiveStreaming(s,d){if(!d){if(this.codec!=="h264")throw new LH(dH.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new LH(dH.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(s)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(s))throw new LH(dH.LIVE_STREAMING_TASK_CONFLICT);const l=d?D7.TRANSCODE:D7.RAW;return this._createLiveStreamingClient(l).startLiveStreamingTask(s,l)}setLiveTranscoding(s){return this._createLiveStreamingClient(D7.TRANSCODE).setTranscodingConfig(s)}async stopLiveStreaming(s){const d=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(l=>l&&l.hasUrl(s));if(!d.length)throw new LH(dH.INVALID_PARAMS,"can not find live streaming url to stop");await u5.all(d.map(l=>l&&l.stopLiveStreamingTask(s)))}async startChannelMediaRelay(s){uye(s),await this._createChannelMediaRelayClient().startChannelMediaRelay(s)}async updateChannelMediaRelay(s){uye(s),await this._createChannelMediaRelayClient().updateChannelMediaRelay(s)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(s){this._p2pChannel instanceof Une&&this._p2pChannel.addAudioMetadata(s)}async sendStreamMessage(s){var d;let l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"can not send data stream, not joined");if((typeof s=="string"||s instanceof Uint8Array)&&(s={payload:s}),typeof s.payload=="string"){const b=new TextEncoder;s.payload=b.encode(s.payload)}let f=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&a5(d=["aes-128-gcm2","aes-256-gcm2"]).call(d,this._encryptionMode)&&(f=!0,s.payload=await async function(b,k,B){var Wt;const $O=z4(Wt=Array.from(B)).call(Wt,(rH,iH)=>rH+iH,0),uN={serverTs:0,seq:hDe++,length:B.length,checkSum:$O},lN=new Uint8Array(Vme($O,2)),_N=new ArrayBuffer(10),TN=new DataView(_N);TN.setUint32(0,uN.serverTs),TN.setUint16(4,uN.seq),TN.setUint16(6,uN.length),TN.setUint16(8,uN.checkSum);const vN=16-B.length%16;B=kme(B,new Uint8Array(vN));const uH=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:b,tagLength:128,additionalData:lN},k,B);return kme(new Uint8Array(_N),new Uint8Array(uH))}(this._encryptDataStreamIv,this._encryptDataStreamKey,s.payload)),new Blob([s.payload]).size>1024)throw new LH(dH.INVALID_PARAMS,f?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(N5.DATA_STREAM,{payload:MX(s.payload),syncWithAudio:s.syncWithAudio,sendTs:Date.now()-n0e},!l)}sendMetadata(s){if(!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([s]).size>1024)throw new LH(dH.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(N5.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:MX(s)})}async sendCustomReportMessage(s){if(Array.isArray(s)||(s=[s]),s.forEach(yDe),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"can not send custom report, not joined");await T5.sendCustomReportMessage(this._joinInfo.sid,s)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(s,d){vK(d.spatialLayer,"spatialLayer",[0,1,2,3]),vK(d.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(s,d)}catch(l){throw CN.error("[".concat(this._clientId,"] pick SVC layer failed"),l.toString()),l}}async setRTMConfig(s){const{apRTM:d=!1,rtmFlag:l}=s;if(O7(d,"apRTM"),b6(l,"rtmFlag",0),this._rtmConfig.apRTM=d,this._rtmConfig.rtmFlag=l,CN.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(s)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=d,this._joinInfo.rtmFlag=l,this._gateway.setRTM2Flag(l)}_reset(){if(CN.debug("[".concat(this._clientId,"] reset client")),function(s){const d=q$.indexOf(s);d!==-1&&q$.splice(d,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=F4.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Vye(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&T5.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(s=>{s._audioTrack&&s._audioTrack._destroy(),s._videoTrack&&s._videoTrack._destroy(),s._dataChannels&&(s._dataChannels.forEach(d=>d._close()),s._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new t4("client-publish",this._clientId),this._subscribeMutex=new t4("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(s,d){var l;const f=s||EQ();s?CN.debug("[".concat(this._clientId,"] new Session ").concat(f)):CN.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(f));const b=s?"":this._sessionId||"";this._sessionId=f,this.store.sessionId=f,T5.addSid(f);const k={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(d==null?void 0:d.stringUid)||((l=this._joinInfo)===null||l===void 0?void 0:l.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:b,clientRole:this.role==="audience"?2:1};T5.sessionInit(this._sessionId,vY({cname:d.channel,appid:d.appId},k)),this._joinInfo&&(this._joinInfo.sid=f),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=f)}async _publishHighStream(s){if(!this._joinInfo||this._uid===void 0)throw new LH(dH.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_H("FORCE_TURN")&&!_H("TURN_ENABLE_TCP")&&!_H("TURN_ENABLE_UDP"))throw new LH(dH.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");CN.debug("[".concat(this._clientId,"] publish high stream"));try{const l=await this._p2pChannel.publish(s,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const f=(await l.next()).value;if(f){try{await this._gateway.sendExtensionMessage(oK.PUBLISH,f,!0)}catch(b){throw l.throw(b),b}await l.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const f=(await l.next()).value;if(f){var d;let b;try{b=await this._gateway.publish(this._uid,f,!0)}catch(k){if(k.code!==dH.DISCONNECT_P2P)throw l.throw(k),k}await l.next(((d=b)===null||d===void 0?void 0:d.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const b of s)b instanceof x6&&b._encoderConfig&&this._gateway.setVideoProfile(b._encoderConfig).catch(k=>{CN.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!b.muted&&b.enabled||await this._p2pChannel.muteLocalTrack(b)}}catch(l){if(this._p2pChannel.reportPublishEvent(!1,l==null?void 0:l.code,s),(l==null?void 0:l.code)===dH.WS_ABORT)return;throw l}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new LH(dH.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new LH(dH.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));CN.debug("[".concat(this._clientId,"] publish low stream"));const s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&s.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=s.bitrate));try{const l=await this._p2pChannel.publishLowStream(this._lowStreamParameter),f=(await l.next()).value;if(f){var d;let b;try{b=await this._gateway.publish(this._uid,f,!0)}catch(k){if(k.code!==dH.DISCONNECT_P2P)throw l.throw(k),k}l.next(((d=b)===null||d===void 0?void 0:d.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(l){if(this._p2pChannel.reportPublishEvent(!1,l==null?void 0:l.code,void 0,!0),(l==null?void 0:l.code)===dH.WS_ABORT)return;throw l}}_createLiveStreamingClient(s){const d=()=>{if(!this._joinInfo||!this._appId)return new LH(dH.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const l=(f={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},BX("LiveStreaming").create(f));var f;return l.onLiveStreamError=(b,k)=>{T5.reportApiInvoke(this._sessionId,{name:_K.ON_LIVE_STREAM_ERROR,options:[b,k],tag:Y6.TRACER}).onSuccess(),this.safeEmit(z5.LIVE_STREAMING_ERROR,b,k)},l.onLiveStreamWarning=(b,k)=>{T5.reportApiInvoke(this._sessionId,{name:_K.ON_LIVE_STREAM_WARNING,options:[b,k],tag:Y6.TRACER}).onSuccess(),this.safeEmit(z5.LIVE_STREAMING_WARNING,b,k)},l.on(ale.REQUEST_WORKER_MANAGER_LIST,(b,k,B)=>{if(!this._joinInfo)return B(new LH(dH.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(Wt,$O,uN,lN){const _N=_H("UAP_AP").slice(0,_H("AJAX_REQUEST_CONCURRENT")).map(TN=>$O.proxyServer?"https://".concat($O.proxyServer,"/ap/?url=").concat(TN+"/api/v1?action=uap"):"https://".concat(TN,"/api/v1?action=uap"));return await jke(_N,Wt,$O,uN,lN)})(b,this._joinInfo,this._axiosCancelSource.token,EK).then(k).catch(B)}),l};return s===D7.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||d(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||d(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new LH(dH.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:d,sendResolutionHeight:l}=this.getLocalVideoStats(),f=(s={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:d,height:l}},BX("ChannelMediaRelay").create(s));f.on("state",b=>{b===e8.RELAY_STATE_FAILURE&&f&&f.dispose(),this.safeEmit(z5.CHANNEL_MEDIA_RELAY_STATE,b)}),f.on("event",b=>{this.safeEmit(z5.CHANNEL_MEDIA_RELAY_EVENT,b)}),this._channelMediaRelayClient=f,this._statsCollector.onStatsChanged=(b,k)=>{var B;b==="resolution"&&((B=this._channelMediaRelayClient)===null||B===void 0||B.setVideoProfile(k))}}var s;return this._channelMediaRelayClient}_handleUpdateDataChannel(s,d){const{added:l,deleted:f}=s,b=[];if(d){const k=[];this._users.forEach(B=>{B._dataChannels.forEach(Wt=>{l.every($O=>$O.uid!==B._uintid||$O.stream_id!==Wt.id)&&k.push({uid:B._uintid,stream_id:Wt.id,ordered:Wt.ordered,max_retrans_times:Wt.maxRetransmits,metadata:Wt.metadata})})}),k.length>0&&this._handleUpdateDataChannel({added:[],deleted:k})}Array.isArray(l)&&l.length>0&&l.forEach(k=>{const{uid:B,stream_id:Wt,ordered:$O,max_retrans_times:uN,metadata:lN}=k,_N=this._users.find(TN=>TN._uintid===B);if(!_N)return void CN.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(CN.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(B)),a5(b).call(b,_N)||b.push(_N),_N._uintid||(_N._uintid=B),_N._dataChannels.findIndex(TN=>TN.id===k.stream_id)===-1){const TN={id:Wt,ordered:!!$O,maxRetransmits:uN,metadata:lN},vN=function(uH){return KSe(uH,!0)}(TN);_N._dataChannels.push(vN),CN.info("[".concat(this._clientId,"] remote user ").concat(_N.uid," published datachannel")),d||this.safeEmit(z5.USER_PUBLISHED,_N,"datachannel",TN)}this._p2pChannel.hasPendingRemoteDataChannel(_N,k.stream_id)&&(CN.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_N.uid," after reconnect.")),this._subscribeDataChannel(_N,k.stream_id).catch(TN=>{CN.error("[".concat(this._clientId,"] resubscribe datachannel error"),TN.toString())}))}),d&&(this.safeEmit(z5.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(f)&&f.length>0&&f.forEach(k=>{const{uid:B,stream_id:Wt}=k,$O=this._users.find(lN=>lN._uintid===B);if(!$O)return void CN.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const uN=$O._dataChannels.find(lN=>lN.id===k.stream_id);uN&&(CN.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(B)),this._p2pChannel.unsubscribeDataChannel($O,[uN]).then(lN=>{if($O._dataChannels=$O._dataChannels.filter(_N=>_N!==uN),lN)return this._gateway.unsubscribeDataChannel(lN,$O.uid)}),CN.info("[".concat(this._clientId,"] remote user ").concat(B," unpublished datachannel ,id:").concat(uN.id)),this.safeEmit(z5.USER_UNPUBLISHED,$O,"datachannel",uN._config))})}_handleRemoveDataChannels(s){const d=this._users.find(l=>l.uid===s.uid);if(d){if(d._dataChannels!==void 0&&d._dataChannels.length>0){CN.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(s.uid));const l=()=>{CN.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished datachannel")),d._dataChannels.forEach(f=>{this.safeEmit(z5.USER_UNPUBLISHED,d,"datachannel",f._config)})};this._p2pChannel.unsubscribeDataChannel(d,d._dataChannels).then(f=>{if(f)return this._gateway.unsubscribeDataChannel(f,d.uid)}),l()}}else CN.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(LK.UPDATE_GATEWAY_CONFIG,()=>{(function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(d){return void CN.error("Error loading sdk config",d.message)}if(s)try{const d=JSON.parse(window.atob(s)),l=Date.now();Object.keys(d).forEach(f=>{const{value:b,type:k,expires:B}=d[f];B&&B<=l||k||ele()||!Object.prototype.hasOwnProperty.call(noe,f)||($Y[f]=b,H6[f]=b,CN.debug("Update gateway parameters from config distribute",f,b))})}catch(d){CN.error("Error update config from local cache",d.message)}})()}),this._gateway.on(LK.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(LK.CONNECTION_STATE_CHANGE,(s,d,l)=>{var f;if(l===_6.FALLBACK)return;const b=()=>{this.safeEmit(z5.CONNECTION_STATE_CHANGE,s,d,l)};if(T5.reportApiInvoke(this._sessionId||((f=this._gateway.joinInfo)===null||f===void 0?void 0:f.sid)||null,{name:_K.CONNECTION_STATE_CHANGE,options:[s,d,l],tag:Y6.TRACER}).onSuccess(JSON.stringify({cur:s,prev:d,reason:l})),CN.info("[".concat(this._clientId,"] signal connection state change: ").concat(d," -> ").concat(s)),s==="DISCONNECTED")return this._reset(),void b();if(s==="RECONNECTING")this._users.forEach(B=>{B._trust_in_room_=!1,B._trust_audio_enabled_state_=!1,B._trust_video_enabled_state_=!1,B._trust_audio_mute_state_=!1,B._trust_video_mute_state_=!1,B._trust_audio_stream_added_state_=!1,B._trust_video_stream_added_state_=!1,B._is_pre_created||(B._audio_pre_subscribed||(B._audioSSRC=void 0,B._audioOrtc=void 0),B._video_pre_subscribed||(B._videoSSRC=void 0,B._videoOrtc=void 0,B._rtxSsrcId=void 0),B._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(s==="CONNECTED"){var k;this._streamFallbackTypeCacheMap.forEach((B,Wt)=>{this._gateway.setStreamFallbackOption(Wt,B).catch($O=>{CN.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),$O)})}),this._remoteStreamTypeCacheMap.forEach((B,Wt)=>{this._gateway.setRemoteVideoStreamType(Wt,B).catch($O=>{CN.warning("[".concat(this._clientId,"] auto set remote stream type failed"),$O)})}),this._remoteDefaultVideoStreamType!==void 0&&((k=this._joinInfo)===null||k===void 0?void 0:k.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{CN.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(B=>{CN.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(B))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(B=>!B._trust_in_room_).forEach(B=>{CN.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(B.uid)),this._handleUserOffline({uid:B.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(B=>{B._trust_audio_mute_state_||(CN.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(B.uid)),this._handleMuteStream(B.uid,_5.AUDIO,!1)),B._trust_video_mute_state_||(CN.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(B.uid)),this._handleMuteStream(B.uid,_5.VIDEO,!1)),B._trust_audio_enabled_state_||(CN.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(B.uid)),this._handleSetStreamLocalEnable("audio",B.uid,!0)),B._trust_video_enabled_state_||(CN.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(B.uid)),this._handleSetStreamLocalEnable("video",B.uid,!0)),B._trust_video_stream_added_state_||(CN.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(B.uid)),this._handleResetAddStream(B,"video")),B._trust_audio_stream_added_state_||(CN.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(B.uid)),this._handleResetAddStream(B,"audio")),B._video_added_||B._audio_added_||(CN.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(B.uid)),this._handleRemoveStream({uid:B.uid,uint_id:B._uintid}))}))},1e3))}b()}),this._gateway.on(LK.REQUEST_NEW_GATEWAY_LIST,async(s,d)=>{if(!this._joinInfo)return d(new LH(dH.UNEXPECTED_ERROR,"can not recover, no join info"));try{let l;const f=await Uye(vY(vY({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));f?(l=f.ap,Fye(f),this._joinInfo.preload=!0):(l=await ble(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||EK,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=l.gatewayInfo.res,this._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip);const b=[];l.gatewayInfo.gatewayAddrs.forEach(k=>{let{address:B}=k;const[Wt,$O]=B.split(":");this._joinInfo&&this._joinInfo.proxyServer?b.push({proxy:this._joinInfo.proxyServer,host:Wt,port:$O}):b.push({host:Wt,port:$O})}),s(b)}catch(l){d(l)}}),this._gateway.on(LK.NETWORK_QUALITY,s=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(z5.NETWORK_QUALITY,s)}),this._gateway.on(LK.STREAM_TYPE_CHANGE,(s,d)=>{this.safeEmit(z5.STREAM_TYPE_CHANGED,s,d),T5.reportApiInvoke(this._sessionId,{name:_K.STREAM_TYPE_CHANGE,options:[s,d],tag:Y6.TRACER}).onSuccess(JSON.stringify({uid:s,streamType:d}))}),this._gateway.on(LK.IS_P2P_DISCONNECTED,s=>{this._p2pChannel.isP2PDisconnected()?s(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?s(!1):s(!0)}),this._gateway.on(LK.REQUEST_P2P_CONNECTION_PARAMS,async(s,d,l)=>{try{let f=await this._p2pChannel.getEstablishParams();_H("ENABLE_PREALLOC_PC")&&f||(f=await this._p2pChannel.startP2PConnection(s)),d(f)}catch(f){l(f)}}),this._gateway.on(LK.JOIN_RESPONSE,(s,d)=>{if(this.store.useP2P)return;let l;s.attributes?l=s.attributes.userAttributes.preSubSsrcs:CN.debug("no attributes in joinResponse");const f=LSe(s.ortc,d,l);this._p2pChannel.connect(f)}),this._gateway.on(LK.PRE_CONNECT_PC,async s=>{const{candidates:d,fingerprint:l}=s;if(this._joinInfo&&d.length>0&&!this._p2pChannel.isPlanB){var f;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:b,cid:k}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(k,"_").concat(b),icePwd:"".concat(k,"_").concat(b)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(f=_H("FINGERPRINT"))!==null&&f!==void 0?f:l}]},candidates:d,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(J5.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(J5.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(J5.ON_ADD_AUDIO_STREAM,s=>this._handleAddAudioOrVideoStream("audio",s.uid,s.ssrcId,s.cname,s.uint_id,s.ortc)),this._gateway.signal.on(J5.ON_ADD_VIDEO_STREAM,s=>this._handleAddAudioOrVideoStream("video",s.uid,s.ssrcId,s.cname,s.uint_id,s.ortc,s.rtxSsrcId)),this._gateway.signal.on(J5.ON_REMOTE_DATASTREAM_UPDATE,s=>{this._handleUpdateDataChannel(s)}),this._gateway.signal.on(J5.ON_REMOTE_FULL_DATASTREAM_INFO,s=>{this._handleUpdateDataChannel({added:s.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(J5.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(J5.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(J5.MUTE_AUDIO,s=>this._handleMuteStream(s.uid,_5.AUDIO,!0)),this._gateway.signal.on(J5.UNMUTE_AUDIO,s=>this._handleMuteStream(s.uid,_5.AUDIO,!1)),this._gateway.signal.on(J5.MUTE_VIDEO,s=>this._handleMuteStream(s.uid,_5.VIDEO,!0)),this._gateway.signal.on(J5.UNMUTE_VIDEO,s=>this._handleMuteStream(s.uid,_5.VIDEO,!1)),this._gateway.signal.on(J5.RECEIVE_METADATA,s=>{const d=_Q(s.metadata);this.safeEmit(z5.RECEIVE_METADATA,s.uid,d)}),this._gateway.signal.on(J5.ON_DATA_STREAM,async s=>{var d;if(!s)return;let l=_Q(s.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&a5(d=["aes-128-gcm2","aes-256-gcm2"]).call(d,this._encryptionMode)){if(s.payload.length<10)throw new LH(dH.UNEXPECTED_RESPONSE,"payload length ".concat(s.payload.length," is less than header length ").concat(10));l=await async function(k,B,Wt){const $O=Wt.subarray(0,10),uN=$O.slice(8,10),lN=(uN[0]<<8)+uN[1],_N=($O[6]<<8)+$O[7],TN=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:k,tagLength:128,additionalData:new Uint8Array(Vme(lN,2))},B,Wt.subarray(10));return new Uint8Array(TN).subarray(0,_N)}(this._encryptDataStreamIv,this._encryptDataStreamKey,l)}let f=0;if(s.ordered||s.syncWithAudio){const b=this._p2pChannel.getStats(),k=this.remoteUsers.find(Wt=>Wt.uid===s.uid),B=b==null?void 0:b.audioRecv.find(Wt=>Wt.ssrc===(k==null?void 0:k._audioSSRC));f=B==null?void 0:B.jitterBufferMs}(f==null||Number.isNaN(f))&&(f=0),r0e(vY(vY({},s),{},{payload:l}),f,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(J5.ON_CRYPT_ERROR,()=>{LX(()=>{CN.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(z5.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(J5.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(J5.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{CN.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,_6.TOKEN_EXPIRE),this.safeEmit(z5.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(J5.ON_STREAM_FALLBACK_UPDATE,s=>{CN.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(s.stream_id,", attr: ").concat(s.stream_type)),this.safeEmit(z5.STREAM_FALLBACK,s.stream_id,s.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(J5.ON_PUBLISH_STREAM,s=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:s.proxy})),CN.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(s))))}),this._gateway.signal.on(J5.ENABLE_LOCAL_VIDEO,s=>{this._handleSetStreamLocalEnable("video",s.uid,!0)}),this._gateway.signal.on(J5.DISABLE_LOCAL_VIDEO,s=>{this._handleSetStreamLocalEnable("video",s.uid,!1)}),this._gateway.signal.on(P5.REQUEST_TIMEOUT,(s,d)=>{if(this._joinInfo)switch(s){case N5.PUBLISH:{if(!d)return;const b=d.ortc;if(b){var l,f;const k=b.some($O=>{let{stream_type:uN}=$O;return uN===m6.Audio}),B=b.some($O=>{let{stream_type:uN}=$O;return uN!==m6.Audio}),Wt=b.some($O=>{let{stream_type:uN}=$O;return uN===m6.Screen||uN===m6.ScreenLow});d.state==="offer"&&T5.publish(this._joinInfo.sid,{eventElapse:r4.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:dH.TIMEOUT,audio:k,video:B,p2pid:d.p2p_id,publishRequestid:this.store.pubId,screenshare:Wt,audioName:k?(l=b.find($O=>{let{stream_type:uN}=$O;return uN===m6.Audio}))===null||l===void 0||(l=l.ssrcs[0])===null||l===void 0?void 0:l.ssrcId.toString():void 0,videoName:B?(f=b.find($O=>{let{stream_type:uN}=$O;return uN!==m6.Audio}))===null||f===void 0||(f=f.ssrcs[0])===null||f===void 0?void 0:f.ssrcId.toString():void 0})}break}case N5.SUBSCRIBE:d&&T5.subscribe(this._joinInfo.sid,{succ:!1,ec:dH.TIMEOUT,audio:d.stream_type===_5.AUDIO,video:d.stream_type===_5.VIDEO,peerid:d.stream_id,subscribeRequestid:d.ssrcId,p2pid:this.store.p2pId,eventElapse:r4.measureFromSubscribeStart(this.store.clientId,d.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(d.ssrcId)})}}),this._gateway.signal.on(J5.ON_P2P_OK,s=>{this.uid,this._uid}),this._gateway.signal.on(J5.ON_PUBLISHED_USER_LIST,s=>{if(s==null||!s.users)return;_H("BLOCK_LOCAL_CLIENT")&&(s.users=s.users.filter(f=>!vQ(f.string_id||f.stream_id,this.channelName)));const d=[],l=[];for(const f of s.users){let b=this._users.find(lN=>lN._uintid===f.stream_id);b?b._trust_in_room_=!0:(b=new GX(f.string_id||f.stream_id,f.stream_id),this._users.push(b),this.getListeners(z5.PUBLISHED_USER_LIST).length===0&&(CN.debug("[".concat(this._clientId,"] user online"),f.stream_id),this.safeEmit(z5.USER_JOINED,b)));const k=NK.Audio&f.stream_type,B=(NK.Video|NK.LwoVideo)&f.stream_type,Wt=!!(65280&f.stream_type),$O=k&&b.hasAudio,uN=B&&b.hasVideo;B&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0,b._videoSSRC=f.video_ssrc,b._rtxSsrcId=f.video_rtx),k&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0,b._audioSSRC=f.audio_ssrc),k&&!$O&&this.getListeners(z5.PUBLISHED_USER_LIST).length===0&&(CN.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published audio")),this.safeEmit(z5.USER_PUBLISHED,b,"audio")),B&&!uN&&this.getListeners(z5.PUBLISHED_USER_LIST).length===0&&(CN.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published video")),this.safeEmit(z5.USER_PUBLISHED,b,"video")),(k&&!$O||B&&!uN||Wt)&&d.push(b),B&&this._p2pChannel.hasPendingRemoteMedia(b,"video")&&l.push({user:b,mediaType:"video"}),k&&this._p2pChannel.hasPendingRemoteMedia(b,"audio")&&l.push({user:b,mediaType:"audio"})}l.length>0&&(CN.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(l.map(f=>"user: ".concat(f.user.uid,", mediaType: ").concat(f.mediaType)).join("; ")," ")),this.massSubscribe(l).catch(f=>{CN.error("[".concat(this._clientId,"] mass resubscribe error"),f.toString())})),this.getListeners(z5.PUBLISHED_USER_LIST).length>0?_H("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=d:(CN.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(d.map(f=>f.uid).join(", "))),this.safeEmit(z5.PUBLISHED_USER_LIST,d)):CN.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(d.map(f=>f.uid).join(", ")))}),this._gateway.signal.on(J5.ON_RTP_CAPABILITY_CHANGE,s=>{const{video_codec:d}=s;this._p2pChannel instanceof Une&&this._p2pChannel.updateRemoteRTPCapabilities(d.map(l=>l.toLowerCase()).filter(l=>{var f;return a5(f=Object.keys(roe)).call(f,l)}))})}_handleP2PEvents(){this._gateway.signal.on(J5.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oK.PUBLISH,(s,d,l)=>{const{uid:f}=s;s.forEach(b=>{const{kind:k,ssrcs:B,mid:Wt,isMuted:$O}=b;this._handleP2PAddAudioOrVideoStream(k,f,B[0].ssrcId,Wt);const uN=this._users.find(lN=>lN.uid===f);return uN&&this.store.useP2P?this._p2pChannel.mockSubscribe(uN,k,B[0].ssrcId,Wt).then(()=>{d()}).catch(l):d(),this._handleMuteStream(f,k,!!$O)})}),this._gateway.signal.on(oK.CALL,async(s,d,l)=>{if(this.store.useP2P)try{var f;d(await this._p2pChannel.startP2P({turnServer:(f=this._joinInfo)===null||f===void 0?void 0:f.turnServer},s))}catch(b){l(b)}}),this._gateway.signal.on(P5.P2P_CONNECTION,async s=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(s)}),this._gateway.signal.on(oK.UNPUBLISH,async(s,d,l)=>{if(this.store.useP2P){const{unpubMsg:f,uid:b}=s,k=this._users.find(B=>B.uid===b);if(!k)return CN.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(b)),void d();try{f.forEach(async B=>{let{stream_type:Wt}=B;const $O=Wt===m6.Audio?_5.AUDIO:_5.VIDEO;await this._p2pChannel.unsubscribe(k,$O),this._handleMuteStream(b,$O,!0)}),d()}catch(B){l(B)}}}),this._gateway.signal.on(oK.CONTROL,async(s,d)=>{const{action:l}=s;switch(l){case VX.MUTE_LOCAL_VIDEO:this._handleMuteStream(d,_5.VIDEO,!0);break;case VX.MUTE_LOCAL_AUDIO:this._handleMuteStream(d,_5.AUDIO,!0);break;case VX.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",d),this._handleMuteStream(d,_5.VIDEO,!1);break;case VX.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",d),this._handleMuteStream(d,_5.AUDIO,!1)}}),this._gateway.signal.on(oK.RESTART_ICE,async(s,d,l)=>{if(this.store.useP2P)try{const{direction:f,iceParameter:b}=s;f!==O4.SEND_ONLY||b?d(await this._p2pChannel.restartICE(f,b)):(this._p2pChannel.handleDisconnect(f),d())}catch(f){l(f)}}),this._gateway.signal.on(oK.CANDIDATE,s=>{if(this.store.useP2P){const{candidate:d,direction:l}=s;this._p2pChannel.addRemoteCandidate(d,l)}}),this._p2pChannel.on(v5.RequestP2PRestartICE,async(s,d,l)=>{try{const{direction:f}=s;d(await this._gateway.sendExtensionMessage(oK.RESTART_ICE,s,f===O4.SEND_ONLY))}catch(f){l(f)}}),this._p2pChannel.on(v5.LocalCandidate,s=>{this._gateway.sendExtensionMessage(oK.CANDIDATE,JSON.stringify(s),!0)}),this._p2pChannel.on(v5.RequestP2PMuteLocal,async(s,d,l)=>{try{await this._gateway.sendExtensionMessage(oK.CONTROL,s,!0),d()}catch(f){l(f)}}),this._p2pChannel.on(v5.RequestP2PUnmuteRemote,async(s,d,l)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(s,this._joinInfo.stringUid||this._joinInfo.uid),d()}catch(f){f.code===dH.DISCONNECT_P2P?d():l(f)}else d()}),this._p2pChannel.on(v5.RequestP2PMuteRemote,async(s,d,l)=>{if(this._joinInfo)try{await this._gateway.muteRemote(s,this._joinInfo.stringUid||this._joinInfo.uid),d()}catch(f){f.code===dH.DISCONNECT_P2P?d():l(f)}else d()}),this._p2pChannel.on(v5.StateChange,(s,d)=>{d===E6.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(v5.PeerConnectionStateChange,s=>{const d=this._peerConnectionState;s!==d&&(this.safeEmit(z5.PEERCONNECTION_STATE_CHANGE,s,d),this._peerConnectionState=s)}),this._p2pChannel.on(v5.RequestMuteLocal,async(s,d,l)=>{if(this._joinInfo)try{await this._gateway.muteLocal(s,this._joinInfo.stringUid||this._joinInfo.uid),d()}catch(f){f.code===dH.DISCONNECT_P2P?d():l(f)}else d()}),this._p2pChannel.on(v5.RequestUnmuteLocal,async(s,d,l)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(s,this._joinInfo.stringUid||this._joinInfo.uid),d()}catch(f){f.code===dH.DISCONNECT_P2P?d():l(f)}else d()}),this._p2pChannel.on(v5.RequestRePublish,(s,d,l)=>{this.publish(s,!1).then(d).catch(l)}),this._p2pChannel.on(v5.RequestRePublishDataChannel,(s,d,l)=>{u5.all(s.map(async f=>{const b=await this._p2pChannel.publishDataChannel([f]);try{b.forEach(k=>{this._uid&&this._gateway.publishDataChannel(this._uid,k,!0)})}catch(k){if(k.code!==dH.DISCONNECT_P2P)throw k}})).then(d).catch(l)}),this._p2pChannel.on(v5.RequestReSubscribe,async(s,d,l)=>{try{for(const{user:f,kind:b}of s)b===_5.VIDEO?await this.subscribe(f,"video"):await this.subscribe(f,"audio");d()}catch(f){l(f)}}),this._p2pChannel.on(v5.RequestUpload,(s,d)=>{this._gateway.upload(s,d)}),this._p2pChannel.on(v5.RequestUploadStats,s=>{this._gateway.uploadWRTCStats(s)}),this._p2pChannel.on(v5.MediaReconnectStart,s=>{this.safeEmit(z5.MEDIA_RECONNECT_START,s)}),this._p2pChannel.on(v5.MediaReconnectEnd,s=>{this.safeEmit(z5.MEDIA_RECONNECT_END,s)}),this._p2pChannel.on(v5.NeedSignalRTT,s=>{s(this._gateway.getSignalRTT())}),this._p2pChannel.on(v5.RequestRestartICE,async s=>{if(this.store.useP2P)return;const d=await this._p2pChannel.restartICE(s),l=await d.next();if(l.done)return;const f=l.value;let b;try{b=await this._gateway.restartICE({iceParameters:f})}catch(B){return void d.throw(B)}const{iceParameters:k}=function(B){const Wt=B.iceParameters;return{iceParameters:{iceUfrag:Wt.iceUfrag,icePwd:Wt.icePwd}}}(b);await d.next({remoteIceParameters:k})}),this._p2pChannel.on(v5.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(v5.RequestReconnectPC,async()=>{var s;const{iceParameters:d,dtlsParameters:l,rtpCapabilities:f}=await this._p2pChannel.startP2PConnection({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer}),{gatewayEstablishParams:b,gatewayAddress:k}=await this._gateway.reconnectPC({iceParameters:d,dtlsParameters:l,rtpCapabilities:f}),B=LSe(b,k);await this._p2pChannel.connect(B),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(v5.RequestUnpublishForReconnectPC,async(s,d,l)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(s,this._uid),d()):l()}),this._p2pChannel.on(v5.P2PLost,()=>{this.safeEmit(z5.P2P_LOST,this.store.uid)}),this._p2pChannel.on(v5.UpdateVideoEncoder,s=>{s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig)}),this._p2pChannel.on(v5.ConnectionTypeChange,s=>{this.safeEmit(z5.IS_USING_CLOUD_PROXY,s)}),this._p2pChannel.on(v5.RequestLowStreamParameter,s=>{s(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(v5.QueryClientConnectionState,s=>{s(this.connectionState)}),this._p2pChannel.on(v5.AudioMetadata,s=>{this.safeEmit(z5.AUDIO_METADATA,s)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(s){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const l=(d={config:s},BX("ContentInspect").create(d));this._inspect=l,this.handleVideoInspectEvents(l);const{appId:f,cname:b,sid:k,token:B,uid:Wt,cid:$O,vid:uN}=this._joinInfo;await l.init({appId:f,areaCode:"",cname:b,sid:k,token:B,uid:Wt,cid:$O,vid:uN?Number(uN):0},EK)}catch(l){throw Array.isArray(l)?l[0]:l}var d}handleVideoInspectEvents(s){s.on(MK.CONNECTION_STATE_CHANGE,(d,l)=>{if(this.safeEmit(z5.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,d,l),l===SY.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(z5.CONTENT_INSPECT_ERROR,new LH(dH.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));s.inspectImage()}}),s.on(MK.INSPECT_RESULT,(d,l)=>{var f;if((l==null?void 0:l.code)===dH.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return CN.debug("Stop inspect content because that has left channel"),this==null||(f=this._inspect)===null||f===void 0||f.close(),void(this._inspect=void 0);this.safeEmit(z5.CONTENT_INSPECT_RESULT,d,l)}),s.on(MK.CLIENT_LOCAL_VIDEO_TRACK,d=>{d(this.localTracks.filter(l=>l.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}async setImageModeration(s,d){if(O7(s,"enabled"),s){if(!d)throw new LH(dH.INVALID_PARAMS,"config is required");if($ye(d),!this._joinInfo)throw new LH(dH.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(d);else{const f=(l={config:d},BX("ImageModeration").create(l));this._moderation=f,this.handleImageModerationEvents(f);const{appId:b,cname:k,sid:B,token:Wt,uid:$O,cid:uN,vid:lN}=this._joinInfo;await f.init({appId:b,areaCode:"",cname:k,sid:B,token:Wt,uid:$O,cid:uN,vid:lN?Number(lN):0},EK)}}catch(f){throw Array.isArray(f)?f[0]:f}}else{var l;if(!this._moderation)throw new LH(dH.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(f){throw Array.isArray(f)?f[0]:f}}}handleImageModerationEvents(s){s.on(nJ.CONNECTION_STATE_CHANGE,(d,l)=>{if(this.safeEmit(z5.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,d,l),d===Y8.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new LH(dH.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");s.inspectImage()}}),s.on(nJ.CLIENT_LOCAL_VIDEO_TRACK,d=>{d(this.localTracks.filter(l=>l.trackMediaType==="video")[0])})}setP2PTransport(s){if(function(d){vK(d,"transport",["default","auto","relay","sd-rtn"])}(s),this.mode!=="p2p")throw new LH(dH.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=s,CN.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(s))}getJoinChannelServiceRecords(){return CN.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(s){O7(s,"enabled"),S6("ENABLE_PUBLISH_AUDIO_FILTER",s),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(s)}_handleResetAddStream(s,d){switch(d){case"audio":s._audio_added_=!1,s._trust_audio_stream_added_state_=!0;break;case"video":s._video_added_=!1,s._trust_video_stream_added_state_=!0}}},m5(h5.prototype,"leave",[eRe],Object.getOwnPropertyDescriptor(h5.prototype,"leave"),h5.prototype),m5(h5.prototype,"publish",[tRe],Object.getOwnPropertyDescriptor(h5.prototype,"publish"),h5.prototype),m5(h5.prototype,"unpublish",[nRe],Object.getOwnPropertyDescriptor(h5.prototype,"unpublish"),h5.prototype),m5(h5.prototype,"subscribe",[rRe],Object.getOwnPropertyDescriptor(h5.prototype,"subscribe"),h5.prototype),m5(h5.prototype,"presubscribe",[iRe],Object.getOwnPropertyDescriptor(h5.prototype,"presubscribe"),h5.prototype),m5(h5.prototype,"massSubscribe",[sRe],Object.getOwnPropertyDescriptor(h5.prototype,"massSubscribe"),h5.prototype),m5(h5.prototype,"unsubscribe",[oRe],Object.getOwnPropertyDescriptor(h5.prototype,"unsubscribe"),h5.prototype),m5(h5.prototype,"massUnsubscribe",[aRe],Object.getOwnPropertyDescriptor(h5.prototype,"massUnsubscribe"),h5.prototype),m5(h5.prototype,"setLowStreamParameter",[cRe],Object.getOwnPropertyDescriptor(h5.prototype,"setLowStreamParameter"),h5.prototype),m5(h5.prototype,"enableDualStream",[uRe],Object.getOwnPropertyDescriptor(h5.prototype,"enableDualStream"),h5.prototype),m5(h5.prototype,"disableDualStream",[dRe],Object.getOwnPropertyDescriptor(h5.prototype,"disableDualStream"),h5.prototype),m5(h5.prototype,"setClientRole",[lRe],Object.getOwnPropertyDescriptor(h5.prototype,"setClientRole"),h5.prototype),m5(h5.prototype,"_setClientRoleOptions",[hRe],Object.getOwnPropertyDescriptor(h5.prototype,"_setClientRoleOptions"),h5.prototype),m5(h5.prototype,"setProxyServer",[pRe],Object.getOwnPropertyDescriptor(h5.prototype,"setProxyServer"),h5.prototype),m5(h5.prototype,"setTurnServer",[fRe],Object.getOwnPropertyDescriptor(h5.prototype,"setTurnServer"),h5.prototype),m5(h5.prototype,"setLicense",[_Re],Object.getOwnPropertyDescriptor(h5.prototype,"setLicense"),h5.prototype),m5(h5.prototype,"startProxyServer",[ERe],Object.getOwnPropertyDescriptor(h5.prototype,"startProxyServer"),h5.prototype),m5(h5.prototype,"stopProxyServer",[mRe],Object.getOwnPropertyDescriptor(h5.prototype,"stopProxyServer"),h5.prototype),m5(h5.prototype,"setLocalAccessPointsV2",[gRe],Object.getOwnPropertyDescriptor(h5.prototype,"setLocalAccessPointsV2"),h5.prototype),m5(h5.prototype,"setLocalAccessPoints",[TRe],Object.getOwnPropertyDescriptor(h5.prototype,"setLocalAccessPoints"),h5.prototype),m5(h5.prototype,"setRemoteDefaultVideoStreamType",[SRe],Object.getOwnPropertyDescriptor(h5.prototype,"setRemoteDefaultVideoStreamType"),h5.prototype),m5(h5.prototype,"setRemoteVideoStreamType",[yRe],Object.getOwnPropertyDescriptor(h5.prototype,"setRemoteVideoStreamType"),h5.prototype),m5(h5.prototype,"setStreamFallbackOption",[RRe],Object.getOwnPropertyDescriptor(h5.prototype,"setStreamFallbackOption"),h5.prototype),m5(h5.prototype,"setEncryptionConfig",[bRe],Object.getOwnPropertyDescriptor(h5.prototype,"setEncryptionConfig"),h5.prototype),m5(h5.prototype,"renewToken",[vRe],Object.getOwnPropertyDescriptor(h5.prototype,"renewToken"),h5.prototype),m5(h5.prototype,"enableAudioVolumeIndicator",[CRe],Object.getOwnPropertyDescriptor(h5.prototype,"enableAudioVolumeIndicator"),h5.prototype),m5(h5.prototype,"startLiveStreaming",[IRe],Object.getOwnPropertyDescriptor(h5.prototype,"startLiveStreaming"),h5.prototype),m5(h5.prototype,"setLiveTranscoding",[wRe],Object.getOwnPropertyDescriptor(h5.prototype,"setLiveTranscoding"),h5.prototype),m5(h5.prototype,"stopLiveStreaming",[ARe],Object.getOwnPropertyDescriptor(h5.prototype,"stopLiveStreaming"),h5.prototype),m5(h5.prototype,"startChannelMediaRelay",[ORe],Object.getOwnPropertyDescriptor(h5.prototype,"startChannelMediaRelay"),h5.prototype),m5(h5.prototype,"updateChannelMediaRelay",[NRe],Object.getOwnPropertyDescriptor(h5.prototype,"updateChannelMediaRelay"),h5.prototype),m5(h5.prototype,"stopChannelMediaRelay",[PRe],Object.getOwnPropertyDescriptor(h5.prototype,"stopChannelMediaRelay"),h5.prototype),m5(h5.prototype,"sendCustomReportMessage",[DRe],Object.getOwnPropertyDescriptor(h5.prototype,"sendCustomReportMessage"),h5.prototype),m5(h5.prototype,"pickSVCLayer",[kRe],Object.getOwnPropertyDescriptor(h5.prototype,"pickSVCLayer"),h5.prototype),m5(h5.prototype,"setRTMConfig",[LRe],Object.getOwnPropertyDescriptor(h5.prototype,"setRTMConfig"),h5.prototype),m5(h5.prototype,"enableContentInspect",[MRe],Object.getOwnPropertyDescriptor(h5.prototype,"enableContentInspect"),h5.prototype),m5(h5.prototype,"disableContentInspect",[URe],Object.getOwnPropertyDescriptor(h5.prototype,"disableContentInspect"),h5.prototype),m5(h5.prototype,"setImageModeration",[xRe],Object.getOwnPropertyDescriptor(h5.prototype,"setImageModeration"),h5.prototype),m5(h5.prototype,"setP2PTransport",[VRe],Object.getOwnPropertyDescriptor(h5.prototype,"setP2PTransport"),h5.prototype),m5(h5.prototype,"getJoinChannelServiceRecords",[FRe],Object.getOwnPropertyDescriptor(h5.prototype,"getJoinChannelServiceRecords"),h5.prototype),m5(h5.prototype,"setPublishAudioFilterEnabled",[jRe],Object.getOwnPropertyDescriptor(h5.prototype,"setPublishAudioFilterEnabled"),h5.prototype),h5);class Fne{constructor(d,l){cH(this,"id",0),cH(this,"element",void 0),cH(this,"peerPair",void 0),cH(this,"context",void 0),cH(this,"audioPlayerElement",void 0),cH(this,"audioTrack",void 0),Fne.count+=1,this.id=Fne.count,this.element=d,this.context=l}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=d=>{const l=document.createElement("audio");l.srcObject=new MediaStream([d.track]),l.play(),this.audioPlayerElement=l}}async switchSdp(){if(!this.peerPair)return;const d=async(f,b)=>{const k=b==="offer"?await f.createOffer():await f.createAnswer();return await f.setLocalDescription(k),f.iceGatheringState==="complete"?f.localDescription:new u5(B=>{f.onicegatheringstatechange=()=>{f.iceGatheringState==="complete"&&B(f.localDescription)}})},l=async(f,b)=>await f.setRemoteDescription(b);try{const f=await d(this.peerPair[0],"offer");await l(this.peerPair[1],f);const b=await d(this.peerPair[1],"answer");await l(this.peerPair[0],b)}catch(f){throw new LH(dH.LOCAL_AEC_ERROR,f.toString()).print()}}async getTracksFromMediaElement(d){if(this.audioTrack)return this.audioTrack;let l;try{d instanceof HTMLVideoElement&&(d.captureStream?d.captureStream():d.mozCaptureStream()),l=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(d).connect(l)}catch(b){throw new LH(dH.LOCAL_AEC_ERROR,b.toString()).print()}if(!l)throw new LH(dH.LOCAL_AEC_ERROR,"no dest node when local aec").print();const f=l.stream.getAudioTracks()[0];return this.audioTrack=f,f}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const d=this.element,l=await this.getTracksFromMediaElement(d);this.peerPair&&this.peerPair[0].addTrack(l),await this.switchSdp()}close(){CN.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(d=>{d.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var GRe,Yoe;cH(Fne,"count",0);const T0e=window.AudioContext||window.webkitAudioContext,S0e=new(GRe=A5({report:T5}),m5((Yoe=class{constructor(){cH(this,"units",[]),cH(this,"context",void 0)}processExternalMediaAEC(s){if(!this._doesEnvironmentNeedAEC())return CN.debug("the system does not need to process local aec"),-1;this.context||(this.context=new T0e);let d=this.units.find(l=>l&&l.getElement()===s);return d||(d=new Fne(s,this.context),this.units.push(d)),d.startEchoCancellation(),CN.debug("start processing local audio echo cancellation, id is",d.id),d.id}_doesEnvironmentNeedAEC(){return c6().name!==p6.SAFARI}}).prototype,"processExternalMediaAEC",[GRe],Object.getOwnPropertyDescriptor(Yoe.prototype,"processExternalMediaAEC"),Yoe.prototype),Yoe);function WRe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function HRe(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?WRe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):WRe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}const Fle=window||document;function qRe(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Fle)return;const l=mK._cspEventHandlerPointer;if(l&&d)return void console.error(l,d);const f=b=>{if(!(b&&b.blockedURI&&(mK.onSecurityPolicyViolation||mK.getListeners(GJ.SECURITY_POLICY_VIOLATION).length>0)))return;const k=b.blockedURI;_H("CSP_DETECTED_HOSTNAME_LIST").some(B=>a5(k).call(k,B))&&(mK.onSecurityPolicyViolation&&typeof mK.onSecurityPolicyViolation=="function"&&mK.onSecurityPolicyViolation(b),mK.getListeners(GJ.SECURITY_POLICY_VIOLATION).length>0&&mK.safeEmit(GJ.SECURITY_POLICY_VIOLATION,b))};l&&Fle.removeEventListener("securitypolicyviolation",l),(d||s&&typeof s=="function"||mK.getListeners(GJ.SECURITY_POLICY_VIOLATION).length>0)&&Fle.addEventListener("securitypolicyviolation",f),mK._cspEventHandlerPointer=f}var y0e=dN,R0e=DEe,KRe=RegExp.prototype,b0e=function(s){return s===KRe||y0e(KRe,s)?R0e(s):s.flags},m4=h(b0e);function oee(s){let d=s.length;for(;--d>=0;)s[d]=0}const jle=256,zRe=286,jne=30,Bne=15,Ble=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Joe=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),v0e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),YRe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V7=new Array(576);oee(V7);const Gne=new Array(60);oee(Gne);const Wne=new Array(512);oee(Wne);const Hne=new Array(256);oee(Hne);const Gle=new Array(29);oee(Gle);const Xoe=new Array(jne);function Wle(s,d,l,f,b){this.static_tree=s,this.extra_bits=d,this.extra_base=l,this.elems=f,this.max_length=b,this.has_stree=s&&s.length}let JRe,XRe,QRe;function Hle(s,d){this.dyn_tree=s,this.max_code=0,this.stat_desc=d}oee(Xoe);const ZRe=s=>s<256?Wne[s]:Wne[256+(s>>>7)],qne=(s,d)=>{s.pending_buf[s.pending++]=255&d,s.pending_buf[s.pending++]=d>>>8&255},D8=(s,d,l)=>{s.bi_valid>16-l?(s.bi_buf|=d<<s.bi_valid&65535,qne(s,s.bi_buf),s.bi_buf=d>>16-s.bi_valid,s.bi_valid+=l-16):(s.bi_buf|=d<<s.bi_valid&65535,s.bi_valid+=l)},KJ=(s,d,l)=>{D8(s,l[2*d],l[2*d+1])},$Re=(s,d)=>{let l=0;do l|=1&s,s>>>=1,l<<=1;while(--d>0);return l>>>1},ebe=(s,d,l)=>{const f=new Array(16);let b,k,B=0;for(b=1;b<=Bne;b++)B=B+l[b-1]<<1,f[b]=B;for(k=0;k<=d;k++){let Wt=s[2*k+1];Wt!==0&&(s[2*k]=$Re(f[Wt]++,Wt))}},tbe=s=>{let d;for(d=0;d<zRe;d++)s.dyn_ltree[2*d]=0;for(d=0;d<jne;d++)s.dyn_dtree[2*d]=0;for(d=0;d<19;d++)s.bl_tree[2*d]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},nbe=s=>{s.bi_valid>8?qne(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},rbe=(s,d,l,f)=>{const b=2*d,k=2*l;return s[b]<s[k]||s[b]===s[k]&&f[d]<=f[l]},qle=(s,d,l)=>{const f=s.heap[l];let b=l<<1;for(;b<=s.heap_len&&(b<s.heap_len&&rbe(d,s.heap[b+1],s.heap[b],s.depth)&&b++,!rbe(d,f,s.heap[b],s.depth));)s.heap[l]=s.heap[b],l=b,b<<=1;s.heap[l]=f},ibe=(s,d,l)=>{let f,b,k,B,Wt=0;if(s.sym_next!==0)do f=255&s.pending_buf[s.sym_buf+Wt++],f+=(255&s.pending_buf[s.sym_buf+Wt++])<<8,b=s.pending_buf[s.sym_buf+Wt++],f===0?KJ(s,b,d):(k=Hne[b],KJ(s,k+jle+1,d),B=Ble[k],B!==0&&(b-=Gle[k],D8(s,b,B)),f--,k=ZRe(f),KJ(s,k,l),B=Joe[k],B!==0&&(f-=Xoe[k],D8(s,f,B)));while(Wt<s.sym_next);KJ(s,256,d)},Kle=(s,d)=>{const l=d.dyn_tree,f=d.stat_desc.static_tree,b=d.stat_desc.has_stree,k=d.stat_desc.elems;let B,Wt,$O,uN=-1;for(s.heap_len=0,s.heap_max=573,B=0;B<k;B++)l[2*B]!==0?(s.heap[++s.heap_len]=uN=B,s.depth[B]=0):l[2*B+1]=0;for(;s.heap_len<2;)$O=s.heap[++s.heap_len]=uN<2?++uN:0,l[2*$O]=1,s.depth[$O]=0,s.opt_len--,b&&(s.static_len-=f[2*$O+1]);for(d.max_code=uN,B=s.heap_len>>1;B>=1;B--)qle(s,l,B);$O=k;do B=s.heap[1],s.heap[1]=s.heap[s.heap_len--],qle(s,l,1),Wt=s.heap[1],s.heap[--s.heap_max]=B,s.heap[--s.heap_max]=Wt,l[2*$O]=l[2*B]+l[2*Wt],s.depth[$O]=(s.depth[B]>=s.depth[Wt]?s.depth[B]:s.depth[Wt])+1,l[2*B+1]=l[2*Wt+1]=$O,s.heap[1]=$O++,qle(s,l,1);while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((lN,_N)=>{const TN=_N.dyn_tree,vN=_N.max_code,uH=_N.stat_desc.static_tree,rH=_N.stat_desc.has_stree,iH=_N.stat_desc.extra_bits,lH=_N.stat_desc.extra_base,hH=_N.stat_desc.max_length;let bH,PH,OH,wH,BH,XH,d5=0;for(wH=0;wH<=Bne;wH++)lN.bl_count[wH]=0;for(TN[2*lN.heap[lN.heap_max]+1]=0,bH=lN.heap_max+1;bH<573;bH++)PH=lN.heap[bH],wH=TN[2*TN[2*PH+1]+1]+1,wH>hH&&(wH=hH,d5++),TN[2*PH+1]=wH,PH>vN||(lN.bl_count[wH]++,BH=0,PH>=lH&&(BH=iH[PH-lH]),XH=TN[2*PH],lN.opt_len+=XH*(wH+BH),rH&&(lN.static_len+=XH*(uH[2*PH+1]+BH)));if(d5!==0){do{for(wH=hH-1;lN.bl_count[wH]===0;)wH--;lN.bl_count[wH]--,lN.bl_count[wH+1]+=2,lN.bl_count[hH]--,d5-=2}while(d5>0);for(wH=hH;wH!==0;wH--)for(PH=lN.bl_count[wH];PH!==0;)OH=lN.heap[--bH],OH>vN||(TN[2*OH+1]!==wH&&(lN.opt_len+=(wH-TN[2*OH+1])*TN[2*OH],TN[2*OH+1]=wH),PH--)}})(s,d),ebe(l,uN,s.bl_count)},sbe=(s,d,l)=>{let f,b,k=-1,B=d[1],Wt=0,$O=7,uN=4;for(B===0&&($O=138,uN=3),d[2*(l+1)+1]=65535,f=0;f<=l;f++)b=B,B=d[2*(f+1)+1],++Wt<$O&&b===B||(Wt<uN?s.bl_tree[2*b]+=Wt:b!==0?(b!==k&&s.bl_tree[2*b]++,s.bl_tree[32]++):Wt<=10?s.bl_tree[34]++:s.bl_tree[36]++,Wt=0,k=b,B===0?($O=138,uN=3):b===B?($O=6,uN=3):($O=7,uN=4))},obe=(s,d,l)=>{let f,b,k=-1,B=d[1],Wt=0,$O=7,uN=4;for(B===0&&($O=138,uN=3),f=0;f<=l;f++)if(b=B,B=d[2*(f+1)+1],!(++Wt<$O&&b===B)){if(Wt<uN)do KJ(s,b,s.bl_tree);while(--Wt!=0);else b!==0?(b!==k&&(KJ(s,b,s.bl_tree),Wt--),KJ(s,16,s.bl_tree),D8(s,Wt-3,2)):Wt<=10?(KJ(s,17,s.bl_tree),D8(s,Wt-3,3)):(KJ(s,18,s.bl_tree),D8(s,Wt-11,7));Wt=0,k=b,B===0?($O=138,uN=3):b===B?($O=6,uN=3):($O=7,uN=4)}};let abe=!1;const cbe=(s,d,l,f)=>{D8(s,0+(f?1:0),3),nbe(s),qne(s,l),qne(s,~l),l&&s.pending_buf.set(s.window.subarray(d,d+l),s.pending),s.pending+=l};var C0e=s=>{abe||((()=>{let d,l,f,b,k;const B=new Array(16);for(f=0,b=0;b<28;b++)for(Gle[b]=f,d=0;d<1<<Ble[b];d++)Hne[f++]=b;for(Hne[f-1]=b,k=0,b=0;b<16;b++)for(Xoe[b]=k,d=0;d<1<<Joe[b];d++)Wne[k++]=b;for(k>>=7;b<jne;b++)for(Xoe[b]=k<<7,d=0;d<1<<Joe[b]-7;d++)Wne[256+k++]=b;for(l=0;l<=Bne;l++)B[l]=0;for(d=0;d<=143;)V7[2*d+1]=8,d++,B[8]++;for(;d<=255;)V7[2*d+1]=9,d++,B[9]++;for(;d<=279;)V7[2*d+1]=7,d++,B[7]++;for(;d<=287;)V7[2*d+1]=8,d++,B[8]++;for(ebe(V7,287,B),d=0;d<jne;d++)Gne[2*d+1]=5,Gne[2*d]=$Re(d,5);JRe=new Wle(V7,Ble,257,zRe,Bne),XRe=new Wle(Gne,Joe,0,jne,Bne),QRe=new Wle(new Array(0),v0e,0,19,7)})(),abe=!0),s.l_desc=new Hle(s.dyn_ltree,JRe),s.d_desc=new Hle(s.dyn_dtree,XRe),s.bl_desc=new Hle(s.bl_tree,QRe),s.bi_buf=0,s.bi_valid=0,tbe(s)},I0e=(s,d,l,f)=>{let b,k,B=0;s.level>0?(s.strm.data_type===2&&(s.strm.data_type=(Wt=>{let $O,uN=4093624447;for($O=0;$O<=31;$O++,uN>>>=1)if(1&uN&&Wt.dyn_ltree[2*$O]!==0)return 0;if(Wt.dyn_ltree[18]!==0||Wt.dyn_ltree[20]!==0||Wt.dyn_ltree[26]!==0)return 1;for($O=32;$O<jle;$O++)if(Wt.dyn_ltree[2*$O]!==0)return 1;return 0})(s)),Kle(s,s.l_desc),Kle(s,s.d_desc),B=(Wt=>{let $O;for(sbe(Wt,Wt.dyn_ltree,Wt.l_desc.max_code),sbe(Wt,Wt.dyn_dtree,Wt.d_desc.max_code),Kle(Wt,Wt.bl_desc),$O=18;$O>=3&&Wt.bl_tree[2*YRe[$O]+1]===0;$O--);return Wt.opt_len+=3*($O+1)+5+5+4,$O})(s),b=s.opt_len+3+7>>>3,k=s.static_len+3+7>>>3,k<=b&&(b=k)):b=k=l+5,l+4<=b&&d!==-1?cbe(s,d,l,f):s.strategy===4||k===b?(D8(s,2+(f?1:0),3),ibe(s,V7,Gne)):(D8(s,4+(f?1:0),3),((Wt,$O,uN,lN)=>{let _N;for(D8(Wt,$O-257,5),D8(Wt,uN-1,5),D8(Wt,lN-4,4),_N=0;_N<lN;_N++)D8(Wt,Wt.bl_tree[2*YRe[_N]+1],3);obe(Wt,Wt.dyn_ltree,$O-1),obe(Wt,Wt.dyn_dtree,uN-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,B+1),ibe(s,s.dyn_ltree,s.dyn_dtree)),tbe(s),f&&nbe(s)},w0e=(s,d,l)=>(s.pending_buf[s.sym_buf+s.sym_next++]=d,s.pending_buf[s.sym_buf+s.sym_next++]=d>>8,s.pending_buf[s.sym_buf+s.sym_next++]=l,d===0?s.dyn_ltree[2*l]++:(s.matches++,d--,s.dyn_ltree[2*(Hne[l]+jle+1)]++,s.dyn_dtree[2*ZRe(d)]++),s.sym_next===s.sym_end),A0e=s=>{D8(s,2,3),KJ(s,256,V7),(d=>{d.bi_valid===16?(qne(d,d.bi_buf),d.bi_buf=0,d.bi_valid=0):d.bi_valid>=8&&(d.pending_buf[d.pending++]=255&d.bi_buf,d.bi_buf>>=8,d.bi_valid-=8)})(s)},O0e={_tr_init:C0e,_tr_stored_block:cbe,_tr_flush_block:I0e,_tr_tally:w0e,_tr_align:A0e},Kne=(s,d,l,f)=>{let b=65535&s,k=s>>>16&65535,B=0;for(;l!==0;){B=l>2e3?2e3:l,l-=B;do b=b+d[f++]|0,k=k+b|0;while(--B);b%=65521,k%=65521}return b|k<<16};const N0e=new Uint32Array((()=>{let s,d=[];for(var l=0;l<256;l++){s=l;for(var f=0;f<8;f++)s=1&s?3988292384^s>>>1:s>>>1;d[l]=s}return d})());var P4=(s,d,l,f)=>{const b=N0e,k=f+l;s^=-1;for(let B=f;B<k;B++)s=s>>>8^b[255&(s^d[B])];return~s},DQ={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},aee={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:P0e,_tr_stored_block:zle,_tr_flush_block:D0e,_tr_tally:KX,_tr_align:k0e}=O0e,{Z_NO_FLUSH:zX,Z_PARTIAL_FLUSH:L0e,Z_FULL_FLUSH:M0e,Z_FINISH:CY,Z_BLOCK:ube,Z_OK:W4,Z_STREAM_END:dbe,Z_STREAM_ERROR:zJ,Z_DATA_ERROR:U0e,Z_BUF_ERROR:Yle,Z_DEFAULT_COMPRESSION:x0e,Z_FILTERED:V0e,Z_HUFFMAN_ONLY:Qoe,Z_RLE:F0e,Z_FIXED:j0e,Z_DEFAULT_STRATEGY:B0e,Z_UNKNOWN:G0e,Z_DEFLATED:Zoe}=aee,kQ=258,YJ=262,cee=42,LQ=113,zne=666,MQ=(s,d)=>(s.msg=DQ[d],d),lbe=s=>2*s-(s>4?9:0),YX=s=>{let d=s.length;for(;--d>=0;)s[d]=0},W0e=s=>{let d,l,f,b=s.w_size;d=s.hash_size,f=d;do l=s.head[--f],s.head[f]=l>=b?l-b:0;while(--d);d=b,f=d;do l=s.prev[--f],s.prev[f]=l>=b?l-b:0;while(--d)};let JX=(s,d,l)=>(d<<s.hash_shift^l)&s.hash_mask;const X8=s=>{const d=s.state;let l=d.pending;l>s.avail_out&&(l=s.avail_out),l!==0&&(s.output.set(d.pending_buf.subarray(d.pending_out,d.pending_out+l),s.next_out),s.next_out+=l,d.pending_out+=l,s.total_out+=l,s.avail_out-=l,d.pending-=l,d.pending===0&&(d.pending_out=0))},Q8=(s,d)=>{D0e(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,d),s.block_start=s.strstart,X8(s.strm)},nK=(s,d)=>{s.pending_buf[s.pending++]=d},Yne=(s,d)=>{s.pending_buf[s.pending++]=d>>>8&255,s.pending_buf[s.pending++]=255&d},Jle=(s,d,l,f)=>{let b=s.avail_in;return b>f&&(b=f),b===0?0:(s.avail_in-=b,d.set(s.input.subarray(s.next_in,s.next_in+b),l),s.state.wrap===1?s.adler=Kne(s.adler,d,b,l):s.state.wrap===2&&(s.adler=P4(s.adler,d,b,l)),s.next_in+=b,s.total_in+=b,b)},hbe=(s,d)=>{let l,f,b=s.max_chain_length,k=s.strstart,B=s.prev_length,Wt=s.nice_match;const $O=s.strstart>s.w_size-YJ?s.strstart-(s.w_size-YJ):0,uN=s.window,lN=s.w_mask,_N=s.prev,TN=s.strstart+kQ;let vN=uN[k+B-1],uH=uN[k+B];s.prev_length>=s.good_match&&(b>>=2),Wt>s.lookahead&&(Wt=s.lookahead);do if(l=d,uN[l+B]===uH&&uN[l+B-1]===vN&&uN[l]===uN[k]&&uN[++l]===uN[k+1]){k+=2,l++;do;while(uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&uN[++k]===uN[++l]&&k<TN);if(f=kQ-(TN-k),k=TN-kQ,f>B){if(s.match_start=d,B=f,f>=Wt)break;vN=uN[k+B-1],uH=uN[k+B]}}while((d=_N[d&lN])>$O&&--b!=0);return B<=s.lookahead?B:s.lookahead},uee=s=>{const d=s.w_size;let l,f,b;do{if(f=s.window_size-s.lookahead-s.strstart,s.strstart>=d+(d-YJ)&&(s.window.set(s.window.subarray(d,d+d-f),0),s.match_start-=d,s.strstart-=d,s.block_start-=d,s.insert>s.strstart&&(s.insert=s.strstart),W0e(s),f+=d),s.strm.avail_in===0)break;if(l=Jle(s.strm,s.window,s.strstart+s.lookahead,f),s.lookahead+=l,s.lookahead+s.insert>=3)for(b=s.strstart-s.insert,s.ins_h=s.window[b],s.ins_h=JX(s,s.ins_h,s.window[b+1]);s.insert&&(s.ins_h=JX(s,s.ins_h,s.window[b+3-1]),s.prev[b&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=b,b++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<YJ&&s.strm.avail_in!==0)},pbe=(s,d)=>{let l,f,b,k=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,B=0,Wt=s.strm.avail_in;do{if(l=65535,b=s.bi_valid+42>>3,s.strm.avail_out<b||(b=s.strm.avail_out-b,f=s.strstart-s.block_start,l>f+s.strm.avail_in&&(l=f+s.strm.avail_in),l>b&&(l=b),l<k&&(l===0&&d!==CY||d===zX||l!==f+s.strm.avail_in)))break;B=d===CY&&l===f+s.strm.avail_in?1:0,zle(s,0,0,B),s.pending_buf[s.pending-4]=l,s.pending_buf[s.pending-3]=l>>8,s.pending_buf[s.pending-2]=~l,s.pending_buf[s.pending-1]=~l>>8,X8(s.strm),f&&(f>l&&(f=l),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+f),s.strm.next_out),s.strm.next_out+=f,s.strm.avail_out-=f,s.strm.total_out+=f,s.block_start+=f,l-=f),l&&(Jle(s.strm,s.strm.output,s.strm.next_out,l),s.strm.next_out+=l,s.strm.avail_out-=l,s.strm.total_out+=l)}while(B===0);return Wt-=s.strm.avail_in,Wt&&(Wt>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=Wt&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-Wt,s.strm.next_in),s.strstart),s.strstart+=Wt,s.insert+=Wt>s.w_size-s.insert?s.w_size-s.insert:Wt),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),B?4:d!==zX&&d!==CY&&s.strm.avail_in===0&&s.strstart===s.block_start?2:(b=s.window_size-s.strstart,s.strm.avail_in>b&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,b+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),b>s.strm.avail_in&&(b=s.strm.avail_in),b&&(Jle(s.strm,s.window,s.strstart,b),s.strstart+=b,s.insert+=b>s.w_size-s.insert?s.w_size-s.insert:b),s.high_water<s.strstart&&(s.high_water=s.strstart),b=s.bi_valid+42>>3,b=s.pending_buf_size-b>65535?65535:s.pending_buf_size-b,k=b>s.w_size?s.w_size:b,f=s.strstart-s.block_start,(f>=k||(f||d===CY)&&d!==zX&&s.strm.avail_in===0&&f<=b)&&(l=f>b?b:f,B=d===CY&&s.strm.avail_in===0&&l===f?1:0,zle(s,s.block_start,l,B),s.block_start+=l,X8(s.strm)),B?3:1)},Xle=(s,d)=>{let l,f;for(;;){if(s.lookahead<YJ){if(uee(s),s.lookahead<YJ&&d===zX)return 1;if(s.lookahead===0)break}if(l=0,s.lookahead>=3&&(s.ins_h=JX(s,s.ins_h,s.window[s.strstart+3-1]),l=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),l!==0&&s.strstart-l<=s.w_size-YJ&&(s.match_length=hbe(s,l)),s.match_length>=3)if(f=KX(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do s.strstart++,s.ins_h=JX(s,s.ins_h,s.window[s.strstart+3-1]),l=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart;while(--s.match_length!=0);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=JX(s,s.ins_h,s.window[s.strstart+1]);else f=KX(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(f&&(Q8(s,!1),s.strm.avail_out===0))return 1}return s.insert=s.strstart<2?s.strstart:2,d===CY?(Q8(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Q8(s,!1),s.strm.avail_out===0)?1:2},dee=(s,d)=>{let l,f,b;for(;;){if(s.lookahead<YJ){if(uee(s),s.lookahead<YJ&&d===zX)return 1;if(s.lookahead===0)break}if(l=0,s.lookahead>=3&&(s.ins_h=JX(s,s.ins_h,s.window[s.strstart+3-1]),l=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,l!==0&&s.prev_length<s.max_lazy_match&&s.strstart-l<=s.w_size-YJ&&(s.match_length=hbe(s,l),s.match_length<=5&&(s.strategy===V0e||s.match_length===3&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){b=s.strstart+s.lookahead-3,f=KX(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do++s.strstart<=b&&(s.ins_h=JX(s,s.ins_h,s.window[s.strstart+3-1]),l=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart);while(--s.prev_length!=0);if(s.match_available=0,s.match_length=2,s.strstart++,f&&(Q8(s,!1),s.strm.avail_out===0))return 1}else if(s.match_available){if(f=KX(s,0,s.window[s.strstart-1]),f&&Q8(s,!1),s.strstart++,s.lookahead--,s.strm.avail_out===0)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(f=KX(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,d===CY?(Q8(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Q8(s,!1),s.strm.avail_out===0)?1:2};function JJ(s,d,l,f,b){this.good_length=s,this.max_lazy=d,this.nice_length=l,this.max_chain=f,this.func=b}const Jne=[new JJ(0,0,0,0,pbe),new JJ(4,4,8,4,Xle),new JJ(4,5,16,8,Xle),new JJ(4,6,32,32,Xle),new JJ(4,4,16,16,dee),new JJ(8,16,32,32,dee),new JJ(8,16,128,128,dee),new JJ(8,32,128,256,dee),new JJ(32,128,258,1024,dee),new JJ(32,258,258,4096,dee)];function H0e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Zoe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),YX(this.dyn_ltree),YX(this.dyn_dtree),YX(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),YX(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),YX(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Xne=s=>{if(!s)return 1;const d=s.state;return!d||d.strm!==s||d.status!==cee&&d.status!==57&&d.status!==69&&d.status!==73&&d.status!==91&&d.status!==103&&d.status!==LQ&&d.status!==zne?1:0},fbe=s=>{if(Xne(s))return MQ(s,zJ);s.total_in=s.total_out=0,s.data_type=G0e;const d=s.state;return d.pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap===2?57:d.wrap?cee:LQ,s.adler=d.wrap===2?0:1,d.last_flush=-2,P0e(d),W4},_be=s=>{const d=fbe(s);return d===W4&&(l=>{l.window_size=2*l.w_size,YX(l.head),l.max_lazy_match=Jne[l.level].max_lazy,l.good_match=Jne[l.level].good_length,l.nice_match=Jne[l.level].nice_length,l.max_chain_length=Jne[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=2,l.match_available=0,l.ins_h=0})(s.state),d},Ebe=(s,d,l,f,b,k)=>{if(!s)return zJ;let B=1;if(d===x0e&&(d=6),f<0?(B=0,f=-f):f>15&&(B=2,f-=16),b<1||b>9||l!==Zoe||f<8||f>15||d<0||d>9||k<0||k>j0e||f===8&&B!==1)return MQ(s,zJ);f===8&&(f=9);const Wt=new H0e;return s.state=Wt,Wt.strm=s,Wt.status=cee,Wt.wrap=B,Wt.gzhead=null,Wt.w_bits=f,Wt.w_size=1<<Wt.w_bits,Wt.w_mask=Wt.w_size-1,Wt.hash_bits=b+7,Wt.hash_size=1<<Wt.hash_bits,Wt.hash_mask=Wt.hash_size-1,Wt.hash_shift=~~((Wt.hash_bits+3-1)/3),Wt.window=new Uint8Array(2*Wt.w_size),Wt.head=new Uint16Array(Wt.hash_size),Wt.prev=new Uint16Array(Wt.w_size),Wt.lit_bufsize=1<<b+6,Wt.pending_buf_size=4*Wt.lit_bufsize,Wt.pending_buf=new Uint8Array(Wt.pending_buf_size),Wt.sym_buf=Wt.lit_bufsize,Wt.sym_end=3*(Wt.lit_bufsize-1),Wt.level=d,Wt.strategy=k,Wt.method=l,_be(s)};var q0e=(s,d)=>{if(Xne(s)||d>ube||d<0)return s?MQ(s,zJ):zJ;const l=s.state;if(!s.output||s.avail_in!==0&&!s.input||l.status===zne&&d!==CY)return MQ(s,s.avail_out===0?Yle:zJ);const f=l.last_flush;if(l.last_flush=d,l.pending!==0){if(X8(s),s.avail_out===0)return l.last_flush=-1,W4}else if(s.avail_in===0&&lbe(d)<=lbe(f)&&d!==CY)return MQ(s,Yle);if(l.status===zne&&s.avail_in!==0)return MQ(s,Yle);if(l.status===cee&&l.wrap===0&&(l.status=LQ),l.status===cee){let b=Zoe+(l.w_bits-8<<4)<<8,k=-1;if(k=l.strategy>=Qoe||l.level<2?0:l.level<6?1:l.level===6?2:3,b|=k<<6,l.strstart!==0&&(b|=32),b+=31-b%31,Yne(l,b),l.strstart!==0&&(Yne(l,s.adler>>>16),Yne(l,65535&s.adler)),s.adler=1,l.status=LQ,X8(s),l.pending!==0)return l.last_flush=-1,W4}if(l.status===57){if(s.adler=0,nK(l,31),nK(l,139),nK(l,8),l.gzhead)nK(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),nK(l,255&l.gzhead.time),nK(l,l.gzhead.time>>8&255),nK(l,l.gzhead.time>>16&255),nK(l,l.gzhead.time>>24&255),nK(l,l.level===9?2:l.strategy>=Qoe||l.level<2?4:0),nK(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(nK(l,255&l.gzhead.extra.length),nK(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(s.adler=P4(s.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69;else if(nK(l,0),nK(l,0),nK(l,0),nK(l,0),nK(l,0),nK(l,l.level===9?2:l.strategy>=Qoe||l.level<2?4:0),nK(l,3),l.status=LQ,X8(s),l.pending!==0)return l.last_flush=-1,W4}if(l.status===69){if(l.gzhead.extra){let b=l.pending,k=(65535&l.gzhead.extra.length)-l.gzindex;for(;l.pending+k>l.pending_buf_size;){let Wt=l.pending_buf_size-l.pending;if(l.pending_buf.set(l.gzhead.extra.subarray(l.gzindex,l.gzindex+Wt),l.pending),l.pending=l.pending_buf_size,l.gzhead.hcrc&&l.pending>b&&(s.adler=P4(s.adler,l.pending_buf,l.pending-b,b)),l.gzindex+=Wt,X8(s),l.pending!==0)return l.last_flush=-1,W4;b=0,k-=Wt}let B=new Uint8Array(l.gzhead.extra);l.pending_buf.set(B.subarray(l.gzindex,l.gzindex+k),l.pending),l.pending+=k,l.gzhead.hcrc&&l.pending>b&&(s.adler=P4(s.adler,l.pending_buf,l.pending-b,b)),l.gzindex=0}l.status=73}if(l.status===73){if(l.gzhead.name){let b,k=l.pending;do{if(l.pending===l.pending_buf_size){if(l.gzhead.hcrc&&l.pending>k&&(s.adler=P4(s.adler,l.pending_buf,l.pending-k,k)),X8(s),l.pending!==0)return l.last_flush=-1,W4;k=0}b=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,nK(l,b)}while(b!==0);l.gzhead.hcrc&&l.pending>k&&(s.adler=P4(s.adler,l.pending_buf,l.pending-k,k)),l.gzindex=0}l.status=91}if(l.status===91){if(l.gzhead.comment){let b,k=l.pending;do{if(l.pending===l.pending_buf_size){if(l.gzhead.hcrc&&l.pending>k&&(s.adler=P4(s.adler,l.pending_buf,l.pending-k,k)),X8(s),l.pending!==0)return l.last_flush=-1,W4;k=0}b=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,nK(l,b)}while(b!==0);l.gzhead.hcrc&&l.pending>k&&(s.adler=P4(s.adler,l.pending_buf,l.pending-k,k))}l.status=103}if(l.status===103){if(l.gzhead.hcrc){if(l.pending+2>l.pending_buf_size&&(X8(s),l.pending!==0))return l.last_flush=-1,W4;nK(l,255&s.adler),nK(l,s.adler>>8&255),s.adler=0}if(l.status=LQ,X8(s),l.pending!==0)return l.last_flush=-1,W4}if(s.avail_in!==0||l.lookahead!==0||d!==zX&&l.status!==zne){let b=l.level===0?pbe(l,d):l.strategy===Qoe?((k,B)=>{let Wt;for(;;){if(k.lookahead===0&&(uee(k),k.lookahead===0)){if(B===zX)return 1;break}if(k.match_length=0,Wt=KX(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++,Wt&&(Q8(k,!1),k.strm.avail_out===0))return 1}return k.insert=0,B===CY?(Q8(k,!0),k.strm.avail_out===0?3:4):k.sym_next&&(Q8(k,!1),k.strm.avail_out===0)?1:2})(l,d):l.strategy===F0e?((k,B)=>{let Wt,$O,uN,lN;const _N=k.window;for(;;){if(k.lookahead<=kQ){if(uee(k),k.lookahead<=kQ&&B===zX)return 1;if(k.lookahead===0)break}if(k.match_length=0,k.lookahead>=3&&k.strstart>0&&(uN=k.strstart-1,$O=_N[uN],$O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN])){lN=k.strstart+kQ;do;while($O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN]&&$O===_N[++uN]&&uN<lN);k.match_length=kQ-(lN-uN),k.match_length>k.lookahead&&(k.match_length=k.lookahead)}if(k.match_length>=3?(Wt=KX(k,1,k.match_length-3),k.lookahead-=k.match_length,k.strstart+=k.match_length,k.match_length=0):(Wt=KX(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++),Wt&&(Q8(k,!1),k.strm.avail_out===0))return 1}return k.insert=0,B===CY?(Q8(k,!0),k.strm.avail_out===0?3:4):k.sym_next&&(Q8(k,!1),k.strm.avail_out===0)?1:2})(l,d):Jne[l.level].func(l,d);if(b!==3&&b!==4||(l.status=zne),b===1||b===3)return s.avail_out===0&&(l.last_flush=-1),W4;if(b===2&&(d===L0e?k0e(l):d!==ube&&(zle(l,0,0,!1),d===M0e&&(YX(l.head),l.lookahead===0&&(l.strstart=0,l.block_start=0,l.insert=0))),X8(s),s.avail_out===0))return l.last_flush=-1,W4}return d!==CY?W4:l.wrap<=0?dbe:(l.wrap===2?(nK(l,255&s.adler),nK(l,s.adler>>8&255),nK(l,s.adler>>16&255),nK(l,s.adler>>24&255),nK(l,255&s.total_in),nK(l,s.total_in>>8&255),nK(l,s.total_in>>16&255),nK(l,s.total_in>>24&255)):(Yne(l,s.adler>>>16),Yne(l,65535&s.adler)),X8(s),l.wrap>0&&(l.wrap=-l.wrap),l.pending!==0?W4:dbe)},K0e=(s,d)=>{let l=d.length;if(Xne(s))return zJ;const f=s.state,b=f.wrap;if(b===2||b===1&&f.status!==cee||f.lookahead)return zJ;if(b===1&&(s.adler=Kne(s.adler,d,l,0)),f.wrap=0,l>=f.w_size){b===0&&(YX(f.head),f.strstart=0,f.block_start=0,f.insert=0);let $O=new Uint8Array(f.w_size);$O.set(d.subarray(l-f.w_size,l),0),d=$O,l=f.w_size}const k=s.avail_in,B=s.next_in,Wt=s.input;for(s.avail_in=l,s.next_in=0,s.input=d,uee(f);f.lookahead>=3;){let $O=f.strstart,uN=f.lookahead-2;do f.ins_h=JX(f,f.ins_h,f.window[$O+3-1]),f.prev[$O&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=$O,$O++;while(--uN);f.strstart=$O,f.lookahead=2,uee(f)}return f.strstart+=f.lookahead,f.block_start=f.strstart,f.insert=f.lookahead,f.lookahead=0,f.match_length=f.prev_length=2,f.match_available=0,s.next_in=B,s.input=Wt,s.avail_in=k,f.wrap=b,W4},Qne={deflateInit:(s,d)=>Ebe(s,d,Zoe,15,8,B0e),deflateInit2:Ebe,deflateReset:_be,deflateResetKeep:fbe,deflateSetHeader:(s,d)=>Xne(s)||s.state.wrap!==2?zJ:(s.state.gzhead=d,W4),deflate:q0e,deflateEnd:s=>{if(Xne(s))return zJ;const d=s.state.status;return s.state=null,d===LQ?MQ(s,U0e):W4},deflateSetDictionary:K0e,deflateInfo:"pako deflate (from Nodeca project)"};const z0e=(s,d)=>Object.prototype.hasOwnProperty.call(s,d);var mbe=function(s){const d=Array.prototype.slice.call(arguments,1);for(;d.length;){const l=d.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(const f in l)z0e(l,f)&&(s[f]=l[f])}}return s},gbe=s=>{let d=0;for(let f=0,b=s.length;f<b;f++)d+=s[f].length;const l=new Uint8Array(d);for(let f=0,b=0,k=s.length;f<k;f++){let B=s[f];l.set(B,b),b+=B.length}return l};let Tbe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Tbe=!1}const Zne=new Uint8Array(256);for(let s=0;s<256;s++)Zne[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Zne[254]=Zne[254]=1;var Qle=s=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(s);let d,l,f,b,k,B=s.length,Wt=0;for(b=0;b<B;b++)l=s.charCodeAt(b),(64512&l)==55296&&b+1<B&&(f=s.charCodeAt(b+1),(64512&f)==56320&&(l=65536+(l-55296<<10)+(f-56320),b++)),Wt+=l<128?1:l<2048?2:l<65536?3:4;for(d=new Uint8Array(Wt),k=0,b=0;k<Wt;b++)l=s.charCodeAt(b),(64512&l)==55296&&b+1<B&&(f=s.charCodeAt(b+1),(64512&f)==56320&&(l=65536+(l-55296<<10)+(f-56320),b++)),l<128?d[k++]=l:l<2048?(d[k++]=192|l>>>6,d[k++]=128|63&l):l<65536?(d[k++]=224|l>>>12,d[k++]=128|l>>>6&63,d[k++]=128|63&l):(d[k++]=240|l>>>18,d[k++]=128|l>>>12&63,d[k++]=128|l>>>6&63,d[k++]=128|63&l);return d},Y0e=(s,d)=>{const l=d||s.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(s.subarray(0,d));let f,b;const k=new Array(2*l);for(b=0,f=0;f<l;){let B=s[f++];if(B<128){k[b++]=B;continue}let Wt=Zne[B];if(Wt>4)k[b++]=65533,f+=Wt-1;else{for(B&=Wt===2?31:Wt===3?15:7;Wt>1&&f<l;)B=B<<6|63&s[f++],Wt--;Wt>1?k[b++]=65533:B<65536?k[b++]=B:(B-=65536,k[b++]=55296|B>>10&1023,k[b++]=56320|1023&B)}}return((B,Wt)=>{if(Wt<65534&&B.subarray&&Tbe)return String.fromCharCode.apply(null,B.length===Wt?B:B.subarray(0,Wt));let $O="";for(let uN=0;uN<Wt;uN++)$O+=String.fromCharCode(B[uN]);return $O})(k,b)},J0e=(s,d)=>{(d=d||s.length)>s.length&&(d=s.length);let l=d-1;for(;l>=0&&(192&s[l])==128;)l--;return l<0||l===0?d:l+Zne[s[l]]>d?l:d},Sbe=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ybe=Object.prototype.toString,{Z_NO_FLUSH:X0e,Z_SYNC_FLUSH:Q0e,Z_FULL_FLUSH:Z0e,Z_FINISH:$0e,Z_OK:$oe,Z_STREAM_END:eLe,Z_DEFAULT_COMPRESSION:tLe,Z_DEFAULT_STRATEGY:nLe,Z_DEFLATED:rLe}=aee;function $ne(s){this.options=mbe({level:tLe,method:rLe,chunkSize:16384,windowBits:15,memLevel:8,strategy:nLe},s||{});let d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sbe,this.strm.avail_out=0;let l=Qne.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(l!==$oe)throw new Error(DQ[l]);if(d.header&&Qne.deflateSetHeader(this.strm,d.header),d.dictionary){let f;if(f=typeof d.dictionary=="string"?Qle(d.dictionary):ybe.call(d.dictionary)==="[object ArrayBuffer]"?new Uint8Array(d.dictionary):d.dictionary,l=Qne.deflateSetDictionary(this.strm,f),l!==$oe)throw new Error(DQ[l]);this._dict_set=!0}}function Zle(s,d){const l=new $ne(d);if(l.push(s,!0),l.err)throw l.msg||DQ[l.err];return l.result}$ne.prototype.push=function(s,d){const l=this.strm,f=this.options.chunkSize;let b,k;if(this.ended)return!1;for(k=d===~~d?d:d===!0?$0e:X0e,typeof s=="string"?l.input=Qle(s):ybe.call(s)==="[object ArrayBuffer]"?l.input=new Uint8Array(s):l.input=s,l.next_in=0,l.avail_in=l.input.length;;)if(l.avail_out===0&&(l.output=new Uint8Array(f),l.next_out=0,l.avail_out=f),(k===Q0e||k===Z0e)&&l.avail_out<=6)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else{if(b=Qne.deflate(l,k),b===eLe)return l.next_out>0&&this.onData(l.output.subarray(0,l.next_out)),b=Qne.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===$oe;if(l.avail_out!==0){if(k>0&&l.next_out>0)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else if(l.avail_in===0)break}else this.onData(l.output)}return!0},$ne.prototype.onData=function(s){this.chunks.push(s)},$ne.prototype.onEnd=function(s){s===$oe&&(this.result=gbe(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var iLe={Deflate:$ne,deflate:Zle,deflateRaw:function(s,d){return(d=d||{}).raw=!0,Zle(s,d)},gzip:function(s,d){return(d=d||{}).gzip=!0,Zle(s,d)},constants:aee};const eae=16209;var sLe=function(s,d){let l,f,b,k,B,Wt,$O,uN,lN,_N,TN,vN,uH,rH,iH,lH,hH,bH,PH,OH,wH,BH,XH,d5;const p5=s.state;l=s.next_in,XH=s.input,f=l+(s.avail_in-5),b=s.next_out,d5=s.output,k=b-(d-s.avail_out),B=b+(s.avail_out-257),Wt=p5.dmax,$O=p5.wsize,uN=p5.whave,lN=p5.wnext,_N=p5.window,TN=p5.hold,vN=p5.bits,uH=p5.lencode,rH=p5.distcode,iH=(1<<p5.lenbits)-1,lH=(1<<p5.distbits)-1;e:do{vN<15&&(TN+=XH[l++]<<vN,vN+=8,TN+=XH[l++]<<vN,vN+=8),hH=uH[TN&iH];t:for(;;){if(bH=hH>>>24,TN>>>=bH,vN-=bH,bH=hH>>>16&255,bH===0)d5[b++]=65535&hH;else{if(!(16&bH)){if(64&bH){if(32&bH){p5.mode=16191;break e}s.msg="invalid literal/length code",p5.mode=eae;break e}hH=uH[(65535&hH)+(TN&(1<<bH)-1)];continue t}for(PH=65535&hH,bH&=15,bH&&(vN<bH&&(TN+=XH[l++]<<vN,vN+=8),PH+=TN&(1<<bH)-1,TN>>>=bH,vN-=bH),vN<15&&(TN+=XH[l++]<<vN,vN+=8,TN+=XH[l++]<<vN,vN+=8),hH=rH[TN&lH];;){if(bH=hH>>>24,TN>>>=bH,vN-=bH,bH=hH>>>16&255,16&bH){if(OH=65535&hH,bH&=15,vN<bH&&(TN+=XH[l++]<<vN,vN+=8,vN<bH&&(TN+=XH[l++]<<vN,vN+=8)),OH+=TN&(1<<bH)-1,OH>Wt){s.msg="invalid distance too far back",p5.mode=eae;break e}if(TN>>>=bH,vN-=bH,bH=b-k,OH>bH){if(bH=OH-bH,bH>uN&&p5.sane){s.msg="invalid distance too far back",p5.mode=eae;break e}if(wH=0,BH=_N,lN===0){if(wH+=$O-bH,bH<PH){PH-=bH;do d5[b++]=_N[wH++];while(--bH);wH=b-OH,BH=d5}}else if(lN<bH){if(wH+=$O+lN-bH,bH-=lN,bH<PH){PH-=bH;do d5[b++]=_N[wH++];while(--bH);if(wH=0,lN<PH){bH=lN,PH-=bH;do d5[b++]=_N[wH++];while(--bH);wH=b-OH,BH=d5}}}else if(wH+=lN-bH,bH<PH){PH-=bH;do d5[b++]=_N[wH++];while(--bH);wH=b-OH,BH=d5}for(;PH>2;)d5[b++]=BH[wH++],d5[b++]=BH[wH++],d5[b++]=BH[wH++],PH-=3;PH&&(d5[b++]=BH[wH++],PH>1&&(d5[b++]=BH[wH++]))}else{wH=b-OH;do d5[b++]=d5[wH++],d5[b++]=d5[wH++],d5[b++]=d5[wH++],PH-=3;while(PH>2);PH&&(d5[b++]=d5[wH++],PH>1&&(d5[b++]=d5[wH++]))}break}if(64&bH){s.msg="invalid distance code",p5.mode=eae;break e}hH=rH[(65535&hH)+(TN&(1<<bH)-1)]}}break}}while(l<f&&b<B);PH=vN>>3,l-=PH,vN-=PH<<3,TN&=(1<<vN)-1,s.next_in=l,s.next_out=b,s.avail_in=l<f?f-l+5:5-(l-f),s.avail_out=b<B?B-b+257:257-(b-B),p5.hold=TN,p5.bits=vN};const tae=15,oLe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),aLe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),cLe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uLe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ere=(s,d,l,f,b,k,B,Wt)=>{const $O=Wt.bits;let uN,lN,_N,TN,vN,uH,rH=0,iH=0,lH=0,hH=0,bH=0,PH=0,OH=0,wH=0,BH=0,XH=0,d5=null;const p5=new Uint16Array(16),$5=new Uint16Array(16);let e6,N6,aK,eK=null;for(rH=0;rH<=tae;rH++)p5[rH]=0;for(iH=0;iH<f;iH++)p5[d[l+iH]]++;for(bH=$O,hH=tae;hH>=1&&p5[hH]===0;hH--);if(bH>hH&&(bH=hH),hH===0)return b[k++]=20971520,b[k++]=20971520,Wt.bits=1,0;for(lH=1;lH<hH&&p5[lH]===0;lH++);for(bH<lH&&(bH=lH),wH=1,rH=1;rH<=tae;rH++)if(wH<<=1,wH-=p5[rH],wH<0)return-1;if(wH>0&&(s===0||hH!==1))return-1;for($5[1]=0,rH=1;rH<tae;rH++)$5[rH+1]=$5[rH]+p5[rH];for(iH=0;iH<f;iH++)d[l+iH]!==0&&(B[$5[d[l+iH]]++]=iH);if(s===0?(d5=eK=B,uH=20):s===1?(d5=oLe,eK=aLe,uH=257):(d5=cLe,eK=uLe,uH=0),XH=0,iH=0,rH=lH,vN=k,PH=bH,OH=0,_N=-1,BH=1<<bH,TN=BH-1,s===1&&BH>852||s===2&&BH>592)return 1;for(;;){e6=rH-OH,B[iH]+1<uH?(N6=0,aK=B[iH]):B[iH]>=uH?(N6=eK[B[iH]-uH],aK=d5[B[iH]-uH]):(N6=96,aK=0),uN=1<<rH-OH,lN=1<<PH,lH=lN;do lN-=uN,b[vN+(XH>>OH)+lN]=e6<<24|N6<<16|aK;while(lN!==0);for(uN=1<<rH-1;XH&uN;)uN>>=1;if(uN!==0?(XH&=uN-1,XH+=uN):XH=0,iH++,--p5[rH]==0){if(rH===hH)break;rH=d[l+B[iH]]}if(rH>bH&&(XH&TN)!==_N){for(OH===0&&(OH=bH),vN+=lH,PH=rH-OH,wH=1<<PH;PH+OH<hH&&(wH-=p5[PH+OH],!(wH<=0));)PH++,wH<<=1;if(BH+=1<<PH,s===1&&BH>852||s===2&&BH>592)return 1;_N=XH&TN,b[_N]=bH<<24|PH<<16|vN-k}}return XH!==0&&(b[vN+XH]=rH-OH<<24|64<<16),Wt.bits=bH,0};const{Z_FINISH:Rbe,Z_BLOCK:dLe,Z_TREES:nae,Z_OK:UQ,Z_STREAM_END:lLe,Z_NEED_DICT:hLe,Z_STREAM_ERROR:IY,Z_DATA_ERROR:bbe,Z_MEM_ERROR:vbe,Z_BUF_ERROR:pLe,Z_DEFLATED:Cbe}=aee,rae=16180,iae=16190,F7=16191,$le=16192,ehe=16194,sae=16199,oae=16200,the=16206,UK=16209,Ibe=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function fLe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const xQ=s=>{if(!s)return 1;const d=s.state;return!d||d.strm!==s||d.mode<rae||d.mode>16211?1:0},wbe=s=>{if(xQ(s))return IY;const d=s.state;return s.total_in=s.total_out=d.total=0,s.msg="",d.wrap&&(s.adler=1&d.wrap),d.mode=rae,d.last=0,d.havedict=0,d.flags=-1,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new Int32Array(852),d.distcode=d.distdyn=new Int32Array(592),d.sane=1,d.back=-1,UQ},Abe=s=>{if(xQ(s))return IY;const d=s.state;return d.wsize=0,d.whave=0,d.wnext=0,wbe(s)},Obe=(s,d)=>{let l;if(xQ(s))return IY;const f=s.state;return d<0?(l=0,d=-d):(l=5+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?IY:(f.window!==null&&f.wbits!==d&&(f.window=null),f.wrap=l,f.wbits=d,Abe(s))},Nbe=(s,d)=>{if(!s)return IY;const l=new fLe;s.state=l,l.strm=s,l.window=null,l.mode=rae;const f=Obe(s,d);return f!==UQ&&(s.state=null),f};let nhe,rhe,Pbe=!0;const _Le=s=>{if(Pbe){nhe=new Int32Array(512),rhe=new Int32Array(32);let d=0;for(;d<144;)s.lens[d++]=8;for(;d<256;)s.lens[d++]=9;for(;d<280;)s.lens[d++]=7;for(;d<288;)s.lens[d++]=8;for(ere(1,s.lens,0,288,nhe,0,s.work,{bits:9}),d=0;d<32;)s.lens[d++]=5;ere(2,s.lens,0,32,rhe,0,s.work,{bits:5}),Pbe=!1}s.lencode=nhe,s.lenbits=9,s.distcode=rhe,s.distbits=5},Dbe=(s,d,l,f)=>{let b;const k=s.state;return k.window===null&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new Uint8Array(k.wsize)),f>=k.wsize?(k.window.set(d.subarray(l-k.wsize,l),0),k.wnext=0,k.whave=k.wsize):(b=k.wsize-k.wnext,b>f&&(b=f),k.window.set(d.subarray(l-f,l-f+b),k.wnext),(f-=b)?(k.window.set(d.subarray(l-f,l),0),k.wnext=f,k.whave=k.wsize):(k.wnext+=b,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=b))),0};var ELe=(s,d)=>{let l,f,b,k,B,Wt,$O,uN,lN,_N,TN,vN,uH,rH,iH,lH,hH,bH,PH,OH,wH,BH,XH=0;const d5=new Uint8Array(4);let p5,$5;const e6=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(xQ(s)||!s.output||!s.input&&s.avail_in!==0)return IY;l=s.state,l.mode===F7&&(l.mode=$le),B=s.next_out,b=s.output,$O=s.avail_out,k=s.next_in,f=s.input,Wt=s.avail_in,uN=l.hold,lN=l.bits,_N=Wt,TN=$O,BH=UQ;e:for(;;)switch(l.mode){case rae:if(l.wrap===0){l.mode=$le;break}for(;lN<16;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(2&l.wrap&&uN===35615){l.wbits===0&&(l.wbits=15),l.check=0,d5[0]=255&uN,d5[1]=uN>>>8&255,l.check=P4(l.check,d5,2,0),uN=0,lN=0,l.mode=16181;break}if(l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&uN)<<8)+(uN>>8))%31){s.msg="incorrect header check",l.mode=UK;break}if((15&uN)!==Cbe){s.msg="unknown compression method",l.mode=UK;break}if(uN>>>=4,lN-=4,wH=8+(15&uN),l.wbits===0&&(l.wbits=wH),wH>15||wH>l.wbits){s.msg="invalid window size",l.mode=UK;break}l.dmax=1<<l.wbits,l.flags=0,s.adler=l.check=1,l.mode=512&uN?16189:F7,uN=0,lN=0;break;case 16181:for(;lN<16;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(l.flags=uN,(255&m4(l))!==Cbe){s.msg="unknown compression method",l.mode=UK;break}if(57344&m4(l)){s.msg="unknown header flags set",l.mode=UK;break}l.head&&(l.head.text=uN>>8&1),512&m4(l)&&4&l.wrap&&(d5[0]=255&uN,d5[1]=uN>>>8&255,l.check=P4(l.check,d5,2,0)),uN=0,lN=0,l.mode=16182;case 16182:for(;lN<32;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}l.head&&(l.head.time=uN),512&m4(l)&&4&l.wrap&&(d5[0]=255&uN,d5[1]=uN>>>8&255,d5[2]=uN>>>16&255,d5[3]=uN>>>24&255,l.check=P4(l.check,d5,4,0)),uN=0,lN=0,l.mode=16183;case 16183:for(;lN<16;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}l.head&&(l.head.xflags=255&uN,l.head.os=uN>>8),512&m4(l)&&4&l.wrap&&(d5[0]=255&uN,d5[1]=uN>>>8&255,l.check=P4(l.check,d5,2,0)),uN=0,lN=0,l.mode=16184;case 16184:if(1024&m4(l)){for(;lN<16;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}l.length=uN,l.head&&(l.head.extra_len=uN),512&m4(l)&&4&l.wrap&&(d5[0]=255&uN,d5[1]=uN>>>8&255,l.check=P4(l.check,d5,2,0)),uN=0,lN=0}else l.head&&(l.head.extra=null);l.mode=16185;case 16185:if(1024&m4(l)&&(vN=l.length,vN>Wt&&(vN=Wt),vN&&(l.head&&(wH=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Uint8Array(l.head.extra_len)),l.head.extra.set(f.subarray(k,k+vN),wH)),512&m4(l)&&4&l.wrap&&(l.check=P4(l.check,f,vN,k)),Wt-=vN,k+=vN,l.length-=vN),l.length))break e;l.length=0,l.mode=16186;case 16186:if(2048&m4(l)){if(Wt===0)break e;vN=0;do wH=f[k+vN++],l.head&&wH&&l.length<65536&&(l.head.name+=String.fromCharCode(wH));while(wH&&vN<Wt);if(512&m4(l)&&4&l.wrap&&(l.check=P4(l.check,f,vN,k)),Wt-=vN,k+=vN,wH)break e}else l.head&&(l.head.name=null);l.length=0,l.mode=16187;case 16187:if(4096&m4(l)){if(Wt===0)break e;vN=0;do wH=f[k+vN++],l.head&&wH&&l.length<65536&&(l.head.comment+=String.fromCharCode(wH));while(wH&&vN<Wt);if(512&m4(l)&&4&l.wrap&&(l.check=P4(l.check,f,vN,k)),Wt-=vN,k+=vN,wH)break e}else l.head&&(l.head.comment=null);l.mode=16188;case 16188:if(512&m4(l)){for(;lN<16;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(4&l.wrap&&uN!==(65535&l.check)){s.msg="header crc mismatch",l.mode=UK;break}uN=0,lN=0}l.head&&(l.head.hcrc=m4(l)>>9&1,l.head.done=!0),s.adler=l.check=0,l.mode=F7;break;case 16189:for(;lN<32;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}s.adler=l.check=Ibe(uN),uN=0,lN=0,l.mode=iae;case iae:if(l.havedict===0)return s.next_out=B,s.avail_out=$O,s.next_in=k,s.avail_in=Wt,l.hold=uN,l.bits=lN,hLe;s.adler=l.check=1,l.mode=F7;case F7:if(d===dLe||d===nae)break e;case $le:if(l.last){uN>>>=7&lN,lN-=7&lN,l.mode=the;break}for(;lN<3;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}switch(l.last=1&uN,uN>>>=1,lN-=1,3&uN){case 0:l.mode=16193;break;case 1:if(_Le(l),l.mode=sae,d===nae){uN>>>=2,lN-=2;break e}break;case 2:l.mode=16196;break;case 3:s.msg="invalid block type",l.mode=UK}uN>>>=2,lN-=2;break;case 16193:for(uN>>>=7&lN,lN-=7&lN;lN<32;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if((65535&uN)!=(uN>>>16^65535)){s.msg="invalid stored block lengths",l.mode=UK;break}if(l.length=65535&uN,uN=0,lN=0,l.mode=ehe,d===nae)break e;case ehe:l.mode=16195;case 16195:if(vN=l.length,vN){if(vN>Wt&&(vN=Wt),vN>$O&&(vN=$O),vN===0)break e;b.set(f.subarray(k,k+vN),B),Wt-=vN,k+=vN,$O-=vN,B+=vN,l.length-=vN;break}l.mode=F7;break;case 16196:for(;lN<14;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(l.nlen=257+(31&uN),uN>>>=5,lN-=5,l.ndist=1+(31&uN),uN>>>=5,lN-=5,l.ncode=4+(15&uN),uN>>>=4,lN-=4,l.nlen>286||l.ndist>30){s.msg="too many length or distance symbols",l.mode=UK;break}l.have=0,l.mode=16197;case 16197:for(;l.have<l.ncode;){for(;lN<3;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}l.lens[e6[l.have++]]=7&uN,uN>>>=3,lN-=3}for(;l.have<19;)l.lens[e6[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,p5={bits:l.lenbits},BH=ere(0,l.lens,0,19,l.lencode,0,l.work,p5),l.lenbits=p5.bits,BH){s.msg="invalid code lengths set",l.mode=UK;break}l.have=0,l.mode=16198;case 16198:for(;l.have<l.nlen+l.ndist;){for(;XH=l.lencode[uN&(1<<l.lenbits)-1],iH=XH>>>24,lH=XH>>>16&255,hH=65535&XH,!(iH<=lN);){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(hH<16)uN>>>=iH,lN-=iH,l.lens[l.have++]=hH;else{if(hH===16){for($5=iH+2;lN<$5;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(uN>>>=iH,lN-=iH,l.have===0){s.msg="invalid bit length repeat",l.mode=UK;break}wH=l.lens[l.have-1],vN=3+(3&uN),uN>>>=2,lN-=2}else if(hH===17){for($5=iH+3;lN<$5;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}uN>>>=iH,lN-=iH,wH=0,vN=3+(7&uN),uN>>>=3,lN-=3}else{for($5=iH+7;lN<$5;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}uN>>>=iH,lN-=iH,wH=0,vN=11+(127&uN),uN>>>=7,lN-=7}if(l.have+vN>l.nlen+l.ndist){s.msg="invalid bit length repeat",l.mode=UK;break}for(;vN--;)l.lens[l.have++]=wH}}if(l.mode===UK)break;if(l.lens[256]===0){s.msg="invalid code -- missing end-of-block",l.mode=UK;break}if(l.lenbits=9,p5={bits:l.lenbits},BH=ere(1,l.lens,0,l.nlen,l.lencode,0,l.work,p5),l.lenbits=p5.bits,BH){s.msg="invalid literal/lengths set",l.mode=UK;break}if(l.distbits=6,l.distcode=l.distdyn,p5={bits:l.distbits},BH=ere(2,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,p5),l.distbits=p5.bits,BH){s.msg="invalid distances set",l.mode=UK;break}if(l.mode=sae,d===nae)break e;case sae:l.mode=oae;case oae:if(Wt>=6&&$O>=258){s.next_out=B,s.avail_out=$O,s.next_in=k,s.avail_in=Wt,l.hold=uN,l.bits=lN,sLe(s,TN),B=s.next_out,b=s.output,$O=s.avail_out,k=s.next_in,f=s.input,Wt=s.avail_in,uN=l.hold,lN=l.bits,l.mode===F7&&(l.back=-1);break}for(l.back=0;XH=l.lencode[uN&(1<<l.lenbits)-1],iH=XH>>>24,lH=XH>>>16&255,hH=65535&XH,!(iH<=lN);){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(lH&&!(240&lH)){for(bH=iH,PH=lH,OH=hH;XH=l.lencode[OH+((uN&(1<<bH+PH)-1)>>bH)],iH=XH>>>24,lH=XH>>>16&255,hH=65535&XH,!(bH+iH<=lN);){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}uN>>>=bH,lN-=bH,l.back+=bH}if(uN>>>=iH,lN-=iH,l.back+=iH,l.length=hH,lH===0){l.mode=16205;break}if(32&lH){l.back=-1,l.mode=F7;break}if(64&lH){s.msg="invalid literal/length code",l.mode=UK;break}l.extra=15&lH,l.mode=16201;case 16201:if(l.extra){for($5=l.extra;lN<$5;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}l.length+=uN&(1<<l.extra)-1,uN>>>=l.extra,lN-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=16202;case 16202:for(;XH=l.distcode[uN&(1<<l.distbits)-1],iH=XH>>>24,lH=XH>>>16&255,hH=65535&XH,!(iH<=lN);){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(!(240&lH)){for(bH=iH,PH=lH,OH=hH;XH=l.distcode[OH+((uN&(1<<bH+PH)-1)>>bH)],iH=XH>>>24,lH=XH>>>16&255,hH=65535&XH,!(bH+iH<=lN);){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}uN>>>=bH,lN-=bH,l.back+=bH}if(uN>>>=iH,lN-=iH,l.back+=iH,64&lH){s.msg="invalid distance code",l.mode=UK;break}l.offset=hH,l.extra=15&lH,l.mode=16203;case 16203:if(l.extra){for($5=l.extra;lN<$5;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}l.offset+=uN&(1<<l.extra)-1,uN>>>=l.extra,lN-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){s.msg="invalid distance too far back",l.mode=UK;break}l.mode=16204;case 16204:if($O===0)break e;if(vN=TN-$O,l.offset>vN){if(vN=l.offset-vN,vN>l.whave&&l.sane){s.msg="invalid distance too far back",l.mode=UK;break}vN>l.wnext?(vN-=l.wnext,uH=l.wsize-vN):uH=l.wnext-vN,vN>l.length&&(vN=l.length),rH=l.window}else rH=b,uH=B-l.offset,vN=l.length;vN>$O&&(vN=$O),$O-=vN,l.length-=vN;do b[B++]=rH[uH++];while(--vN);l.length===0&&(l.mode=oae);break;case 16205:if($O===0)break e;b[B++]=l.length,$O--,l.mode=oae;break;case the:if(l.wrap){for(;lN<32;){if(Wt===0)break e;Wt--,uN|=f[k++]<<lN,lN+=8}if(TN-=$O,s.total_out+=TN,l.total+=TN,4&l.wrap&&TN&&(s.adler=l.check=m4(l)?P4(l.check,b,TN,B-TN):Kne(l.check,b,TN,B-TN)),TN=$O,4&l.wrap&&(m4(l)?uN:Ibe(uN))!==l.check){s.msg="incorrect data check",l.mode=UK;break}uN=0,lN=0}l.mode=16207;case 16207:if(l.wrap&&m4(l)){for(;lN<32;){if(Wt===0)break e;Wt--,uN+=f[k++]<<lN,lN+=8}if(4&l.wrap&&uN!==(4294967295&l.total)){s.msg="incorrect length check",l.mode=UK;break}uN=0,lN=0}l.mode=16208;case 16208:BH=lLe;break e;case UK:BH=bbe;break e;case 16210:return vbe;default:return IY}return s.next_out=B,s.avail_out=$O,s.next_in=k,s.avail_in=Wt,l.hold=uN,l.bits=lN,(l.wsize||TN!==s.avail_out&&l.mode<UK&&(l.mode<the||d!==Rbe))&&Dbe(s,s.output,s.next_out,TN-s.avail_out),_N-=s.avail_in,TN-=s.avail_out,s.total_in+=_N,s.total_out+=TN,l.total+=TN,4&l.wrap&&TN&&(s.adler=l.check=m4(l)?P4(l.check,b,TN,s.next_out-TN):Kne(l.check,b,TN,s.next_out-TN)),s.data_type=l.bits+(l.last?64:0)+(l.mode===F7?128:0)+(l.mode===sae||l.mode===ehe?256:0),(_N===0&&TN===0||d===Rbe)&&BH===UQ&&(BH=pLe),BH},j7={inflateReset:Abe,inflateReset2:Obe,inflateResetKeep:wbe,inflateInit:s=>Nbe(s,15),inflateInit2:Nbe,inflate:ELe,inflateEnd:s=>{if(xQ(s))return IY;let d=s.state;return d.window&&(d.window=null),s.state=null,UQ},inflateGetHeader:(s,d)=>{if(xQ(s))return IY;const l=s.state;return 2&l.wrap?(l.head=d,d.done=!1,UQ):IY},inflateSetDictionary:(s,d)=>{const l=d.length;let f,b,k;return xQ(s)?IY:(f=s.state,f.wrap!==0&&f.mode!==iae?IY:f.mode===iae&&(b=1,b=Kne(b,d,l,0),b!==f.check)?bbe:(k=Dbe(s,d,l,l),k?(f.mode=16210,vbe):(f.havedict=1,UQ)))},inflateInfo:"pako inflate (from Nodeca project)"},mLe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const kbe=Object.prototype.toString,{Z_NO_FLUSH:gLe,Z_FINISH:TLe,Z_OK:tre,Z_STREAM_END:ihe,Z_NEED_DICT:she,Z_STREAM_ERROR:SLe,Z_DATA_ERROR:Lbe,Z_MEM_ERROR:yLe}=aee;function nre(s){this.options=mbe({chunkSize:65536,windowBits:15,to:""},s||{});const d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,d.windowBits===0&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||s&&s.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&(15&d.windowBits||(d.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sbe,this.strm.avail_out=0;let l=j7.inflateInit2(this.strm,d.windowBits);if(l!==tre)throw new Error(DQ[l]);if(this.header=new mLe,j7.inflateGetHeader(this.strm,this.header),d.dictionary&&(typeof d.dictionary=="string"?d.dictionary=Qle(d.dictionary):kbe.call(d.dictionary)==="[object ArrayBuffer]"&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(l=j7.inflateSetDictionary(this.strm,d.dictionary),l!==tre)))throw new Error(DQ[l])}function ohe(s,d){const l=new nre(d);if(l.push(s),l.err)throw l.msg||DQ[l.err];return l.result}nre.prototype.push=function(s,d){const l=this.strm,f=this.options.chunkSize,b=this.options.dictionary;let k,B,Wt;if(this.ended)return!1;for(B=d===~~d?d:d===!0?TLe:gLe,kbe.call(s)==="[object ArrayBuffer]"?l.input=new Uint8Array(s):l.input=s,l.next_in=0,l.avail_in=l.input.length;;){for(l.avail_out===0&&(l.output=new Uint8Array(f),l.next_out=0,l.avail_out=f),k=j7.inflate(l,B),k===she&&b&&(k=j7.inflateSetDictionary(l,b),k===tre?k=j7.inflate(l,B):k===Lbe&&(k=she));l.avail_in>0&&k===ihe&&l.state.wrap>0&&s[l.next_in]!==0;)j7.inflateReset(l),k=j7.inflate(l,B);switch(k){case SLe:case Lbe:case she:case yLe:return this.onEnd(k),this.ended=!0,!1}if(Wt=l.avail_out,l.next_out&&(l.avail_out===0||k===ihe))if(this.options.to==="string"){let $O=J0e(l.output,l.next_out),uN=l.next_out-$O,lN=Y0e(l.output,$O);l.next_out=uN,l.avail_out=f-uN,uN&&l.output.set(l.output.subarray($O,$O+uN),0),this.onData(lN)}else this.onData(l.output.length===l.next_out?l.output:l.output.subarray(0,l.next_out));if(k!==tre||Wt!==0){if(k===ihe)return k=j7.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,!0;if(l.avail_in===0)break}}return!0},nre.prototype.onData=function(s){this.chunks.push(s)},nre.prototype.onEnd=function(s){s===tre&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=gbe(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var RLe={Inflate:nre,inflate:ohe,inflateRaw:function(s,d){return(d=d||{}).raw=!0,ohe(s,d)},ungzip:ohe,constants:aee};const{Deflate:uMe,deflate:bLe,deflateRaw:dMe,gzip:lMe}=iLe,{Inflate:hMe,inflate:vLe,inflateRaw:pMe,ungzip:fMe}=RLe;var CLe=bLe,ILe=vLe,Mbe=function(s){return s[s.ONE_BYTE=0]="ONE_BYTE",s[s.TWO_BYTE=1]="TWO_BYTE",s}(Mbe||{});class wLe{constructor(){cH(this,"_sequence",0),cH(this,"_startTime",Date.now()),cH(this,"isUseOneByte",!0)}get startTime(){const d=Date.now()-this._startTime;return d<Math.pow(2,16)?d:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(d){const l={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:d};if(d.byteLength>128){const Wt=new Uint8Array(4);Wt.set([1,0,0,0]);const $O={id:0,length:4,data:Wt.buffer},uN={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[$O]};l.commonPacketHeader.extension=1,l.extension=uN,l.payload=this.compress(d),l.commonPacketHeader.length=8+(l.extension.length+2)+l.payload.byteLength}else l.commonPacketHeader.length=8+l.payload.byteLength;_H("SHOW_DATASTREAM2_LOG")&&CN.debug("send data header: ".concat(JSON.stringify(l.commonPacketHeader)));const f=new ArrayBuffer(l.commonPacketHeader.length),b=new Uint8Array(f),k=new DataView(f);let B=0;if(k.setUint16(B,l.commonPacketHeader.extension<<15|l.commonPacketHeader.reserved<<14|l.commonPacketHeader.length,!0),B+=2,k.setUint32(B,l.commonPacketHeader.sequence,!0),B+=4,k.setUint16(B,l.commonStreamHeader,!0),B+=2,l.extension){const Wt=this.serializeExtension(l.extension);b.set(new Uint8Array(Wt),B),B+=Wt.byteLength}if(b.set(new Uint8Array(l.payload),B),B+=l.payload.byteLength,B!==l.commonPacketHeader.length)throw Error("serialize error!");return f}deserialize(d){if(d.byteLength<4)return new ArrayBuffer(0);const l=new DataView(d);let f=0;const b=l.getUint16(f,!0);f+=2;const k={length:16383&b,reserved:(16384&b)>>14,extension:(32768&b)>>15,sequence:l.getUint16(f+2,!0)<<16|l.getUint16(f,!0)};let B,Wt;if(f+=4,_H("SHOW_DATASTREAM2_LOG")&&CN.debug("receive data header: ".concat(JSON.stringify(k))),l.getUint16(f,!0),f+=2,k.extension){Wt=this.deserializeExtension(d.slice(f)),f+=2+Wt.length,B=d.slice(f);let $O=!1;if(Wt.datas.length>0){const uN=Wt.datas.find(lN=>lN.id===0);uN&&($O=!(1&~new DataView(uN.data).getUint32(0,!0)))}B=$O?this.decompress(B):B}else B=d.slice(8);return B}serializeExtension(d){const{profile:l,length:f,datas:b}=d,k=new ArrayBuffer(f+2),B=new Uint8Array(k),Wt=new DataView(k);let $O=0;if(Wt.setUint8($O++,l),Wt.setUint8($O++,f),b.forEach(uN=>{l?(Wt.setUint8($O++,uN.id),Wt.setUint8($O++,uN.length),B.set(new Uint8Array(uN.data),$O),$O+=uN.data.byteLength):(Wt.setUint8($O++,uN.id|uN.length<<4),B.set(new Uint8Array(uN.data),$O),$O+=uN.data.byteLength)}),$O!==f+2)throw Error("serialize extension error, is ".concat($O,"!==").concat(f+2));return k}deserializeExtension(d){const l=new DataView(d);let f=0;const b=l.getUint8(f);f++;const k=l.getUint8(f);f++;const B=b===Mbe.TWO_BYTE,Wt=[],$O=new DataView(d,2);let uN=0;for(;uN<k;){let lN=0,_N=0,TN=new ArrayBuffer(0);B?(lN=$O.getUint8(uN),uN++,_N=$O.getUint8(uN),uN++):(lN=15&$O.getUint8(uN),_N=$O.getUint8(uN)>>4,uN++),_N>0&&(TN=$O.buffer.slice(uN+2,uN+2+_N),uN+=TN.byteLength),Wt.push({id:lN,length:_N,data:TN})}if(uN!==k)throw Error("parse error");return{profile:b,length:k,datas:Wt}}decompress(d){return ILe(new Uint8Array(d))}compress(d){return CLe(new Uint8Array(d))}}const ALe={name:"DataStream",create:(s,d)=>{const l=d?new VDe(s):new FDe(s);return l.useDataStream(new wLe),l}};class OLe extends W6{constructor(d,l,f){super(),cH(this,"ws",void 0),cH(this,"requestId",1),cH(this,"heartBeatTimer",void 0),cH(this,"joinInfo",void 0),cH(this,"clientId",void 0),cH(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),cH(this,"onClose",b=>{this.emit("close"),this.dispose()}),cH(this,"onMessage",b=>{const k=JSON.parse(b.data);if(!k||k.command!=="serverResponse"||!k.requestId)return k&&k.command==="serverStatus"&&k.serverStatus&&k.serverStatus.command?(this.emit("status",k.serverStatus),void this.emit(k.serverStatus.command,k.serverStatus)):void 0;this.emit("req_".concat(k.requestId),k)}),this.joinInfo=d,this.clientId=l,this.ws=new Ane("cross-channel-".concat(this.clientId),f),this.ws.on(U5.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(U5.CONNECTED,this.onOpen),this.ws.on(U5.ON_MESSAGE,this.onMessage),this.ws.on(U5.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(d){const l=this.requestId++;return d.requestId=l,d.seq=l,this.ws.sendMessage(d),l}waitStatus(d){return new u5((l,f)=>{const b=window.setTimeout(()=>{f(new LH(dH.TIMEOUT,"wait status timeout, status: ".concat(d)))},5e3);this.once(d,k=>{window.clearTimeout(b),k.state&&k.state!==0?f(new LH(dH.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(d))):l(void 0)}),this.once("dispose",()=>{window.clearTimeout(b),f(new LH(dH.WS_ABORT))})})}async request(d){if(this.ws.state==="closed")throw new LH(dH.WS_DISCONNECT);const l=()=>new u5((B,Wt)=>{this.ws.once(U5.CLOSED,()=>Wt(new LH(dH.WS_ABORT))),this.ws.once(U5.CONNECTED,B)});this.ws.state!=="connected"&&await l();const f=this.sendMessage(d),b=new u5((B,Wt)=>{const $O=()=>{Wt(new LH(dH.WS_ABORT))};this.ws.once(U5.RECONNECTING,$O),this.ws.once(U5.CLOSED,$O),this.once("req_".concat(f),B),BK(3e3).then(()=>{this.removeAllListeners("req_".concat(f)),this.ws.off(U5.RECONNECTING,$O),this.ws.off(U5.CLOSED,$O),Wt(new LH(dH.TIMEOUT,"cross channel ws request timeout"))})}),k=await b;if(!k||k.code!==200)throw new LH(dH.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(k)));return k}async connect(d){this.ws.removeAllListeners(U5.REQUEST_NEW_URLS),this.ws.on(U5.REQUEST_NEW_URLS,l=>{l(d)}),await this.ws.init(d)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(d){const l=this.requestId++;return d.requestId=l,this.ws.sendMessage(d),l}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class NLe extends W6{set state(d){d!==this._state&&(d!==e8.RELAY_STATE_FAILURE&&(this.errorCode=K$.RELAY_OK),this.emit("state",d,this.errorCode),this._state=d)}get state(){return this._state}constructor(d,l,f,b,k){super(),cH(this,"joinInfo",void 0),cH(this,"sid",void 0),cH(this,"clientId",void 0),cH(this,"cancelToken",F4.CancelToken.source()),cH(this,"workerToken",void 0),cH(this,"requestId",0),cH(this,"signal",void 0),cH(this,"prevChannelMediaConfig",void 0),cH(this,"httpRetryConfig",void 0),cH(this,"_resolution",void 0),cH(this,"_state",e8.RELAY_STATE_IDLE),cH(this,"errorCode",K$.RELAY_OK),cH(this,"onStatus",B=>{CN.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(B))),B&&B.command&&(B.command==="onAudioPacketReceived"&&this.emit("event",k7.PACKET_RECEIVED_AUDIO_FROM_SRC),B.command==="onVideoPacketReceived"&&this.emit("event",k7.PACKET_RECEIVED_VIDEO_FROM_SRC),B.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=K$.SRC_TOKEN_EXPIRED,this.state=e8.RELAY_STATE_FAILURE),B.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=K$.DEST_TOKEN_EXPIRED,this.state=e8.RELAY_STATE_FAILURE))}),cH(this,"onReconnect",async()=>{CN.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",k7.NETWORK_DISCONNECTED),this.state=e8.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(B=>{this.state!==e8.RELAY_STATE_IDLE&&(CN.error("auto restart channel media relay failed",B.toString()),this.errorCode=K$.SERVER_CONNECTION_LOST,this.state=e8.RELAY_STATE_FAILURE)})}),this.joinInfo=d,this.clientId=l,this.sid=EQ(),this.signal=new OLe(this.joinInfo,this.clientId,f),this.httpRetryConfig=b,this._resolution=k}async startChannelMediaRelay(d){if(this.state!==e8.RELAY_STATE_IDLE)throw new LH(dH.INVALID_OPERATION);this.state=e8.RELAY_STATE_CONNECTING,await this.connect(),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(d)}catch(l){throw l.data&&l.data.serverResponse&&l.data.serverResponse.command==="SetSourceChannel"?new LH(dH.CROSS_CHANNEL_FAILED_JOIN_SRC):l.data&&l.data.serverResponse&&l.serverResponse.command==="SetDestChannelStatus"?new LH(dH.CROSS_CHANNEL_FAILED_JOIN_DEST):l.data&&l.data.serverResponse&&l.serverResponse.command==="StartPacketTransfer"?new LH(dH.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):l}this.prevChannelMediaConfig=d}async updateChannelMediaRelay(d){if(this.state!==e8.RELAY_STATE_RUNNING)throw new LH(dH.INVALID_OPERATION);await this.sendUpdateMessage(d),this.prevChannelMediaConfig=d}async setVideoProfile(d){if(this._resolution=d,this.state!==e8.RELAY_STATE_RUNNING)throw new LH(dH.INVALID_OPERATION);const l=this.genMessage(N4.SetVideoProfile);await this.signal.request(l),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),CN.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=e8.RELAY_STATE_IDLE,this.dispose()}dispose(){CN.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=F4.CancelToken.source(),this.state=e8.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const d=await qke(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=d.workerToken,await this.signal.connect(d.addressList),this.emit("event",k7.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(d){const l=this.genMessage(N4.StopPacketTransfer);await this.signal.request(l),await this.signal.waitStatus("Normal Quit"),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const f=this.genMessage(N4.SetSdkProfile,d);await this.signal.request(f),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const b=this.genMessage(N4.SetSourceChannel,d);await this.signal.request(b),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",k7.PACKET_JOINED_SRC_CHANNEL),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const k=this.genMessage(N4.SetSourceUserId,d);await this.signal.request(k),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const B=this.genMessage(N4.SetDestChannel,d);await this.signal.request(B),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",k7.PACKET_JOINED_DEST_CHANNEL),CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const Wt=this.genMessage(N4.StartPacketTransfer,d);await this.signal.request(Wt),this.emit("event",k7.PACKET_SENT_TO_DEST_CHANNEL),this.state=e8.RELAY_STATE_RUNNING,CN.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(d){const l=this.genMessage(N4.UpdateDestChannel,d);await this.signal.request(l),this.emit("event",k7.PACKET_UPDATE_DEST_CHANNEL),CN.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const d=this.genMessage(N4.StopPacketTransfer);await this.signal.request(d),CN.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(d,l){const f=[],b=[],k=[];this.requestId+=1;const B={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:q8,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};B.sdkVersion==="4.23.1"&&(B.sdkVersion="0.0.1");let Wt=null,$O=null;switch(d){case N4.SetSdkProfile:return B.clientRequest={command:"SetSdkProfile",type:"multi_channel"},B;case N4.SetSourceChannel:if($O=l&&l.getSrcChannelMediaInfo(),!$O)throw new LH(dH.UNEXPECTED_ERROR,"can not find source config");return B.clientRequest={command:"SetSourceChannel",uid:"0",channelName:$O.channelName,token:$O.token||this.joinInfo.appId},B;case N4.SetSourceUserId:if($O=l&&l.getSrcChannelMediaInfo(),!$O)throw new LH(dH.UNEXPECTED_ERROR,"can not find source config");return B.clientRequest={command:"SetSourceUserId",uid:$O.uid+""},B;case N4.SetDestChannel:if(Wt=l&&l.getDestChannelMediaInfo(),!Wt)throw new LH(dH.UNEXPECTED_ERROR,"can not find dest config");return Wt.forEach(uN=>{f.push(uN.channelName),b.push(uN.uid+""),k.push(uN.token||this.joinInfo.appId)}),B.clientRequest={command:"SetDestChannel",channelName:f,uid:b,token:k},B;case N4.StartPacketTransfer:return B.clientRequest={command:"StartPacketTransfer"},B;case N4.Reconnect:return B.clientRequest={command:"Reconnect"},B;case N4.StopPacketTransfer:return B.clientRequest={command:"StopPacketTransfer"},B;case N4.UpdateDestChannel:if(Wt=l&&l.getDestChannelMediaInfo(),!Wt)throw new LH(dH.UNEXPECTED_ERROR,"can not find dest config");return Wt.forEach(uN=>{f.push(uN.channelName),b.push(uN.uid+""),k.push(uN.token||this.joinInfo.appId)}),B.clientRequest={command:"UpdateDestChannel",channelName:f,uid:b,token:k},B;case N4.SetVideoProfile:B.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return B}}const PLe={name:"ChannelMediaRelay",create:function(s){return new NLe(s.joinInfo,s.clientId,s.websocketRetryConfig||EK,s.httpRetryConfig||EK,s.resolution)}};function Ube(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function rre(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?Ube(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):Ube(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}class DLe extends W6{constructor(d,l,f,b){super(),cH(this,"spec",void 0),cH(this,"token",void 0),cH(this,"websocket",void 0),cH(this,"pingpongTimer",void 0),cH(this,"reconnectMode","retry"),cH(this,"serviceMode",void 0),cH(this,"reqId",0),cH(this,"commandReqId",0),cH(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),cH(this,"handleWebSocketMessage",k=>{if(!k.data)return;const B=JSON.parse(k.data);B.requestId?this.emit("@".concat(B.requestId,"-").concat(B.sid),B):(T5.workerEvent(this.spec.sid,{actionType:"status",serverCode:B.code,workerType:this.serviceMode===D7.TRANSCODE?1:2}),this.emit(xX.PUBLISH_STREAM_STATUS,B))}),this.spec=l,this.token=d,this.serviceMode=b,this.websocket=new Ane("live-streaming",f),this.websocket.on(U5.CONNECTED,this.handleWebSocketOpen),this.websocket.on(U5.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(U5.REQUEST_NEW_URLS,(k,B)=>{YK(this,xX.REQUEST_NEW_ADDRESS).then(k).catch(B)}),this.websocket.on(U5.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(d){return this.websocket.init(d)}async request(d,l,f,b){this.reqId+=1,d==="request"&&(this.commandReqId+=1);const k=this.commandReqId,B=this.reqId;if(!B||!this.websocket)throw new LH(dH.UNEXPECTED_ERROR);const Wt=rre({command:d,sdkVersion:q8==="4.23.1"?"0.0.1":q8,seq:B,requestId:B,allocate:f,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},l);if(this.websocket.state==="closed")throw new LH(dH.WS_DISCONNECT);const $O=()=>new u5((TN,vN)=>{this.websocket.once(U5.CLOSED,()=>vN(new LH(dH.WS_ABORT))),this.websocket.once(U5.CONNECTED,TN)});this.websocket.state!=="connected"&&await $O(),Wt.clientRequest&&(Wt.clientRequest.workerToken=this.token);const uN=new u5((TN,vN)=>{const uH=()=>{vN(new LH(dH.WS_ABORT))};this.websocket.once(U5.RECONNECTING,uH),this.websocket.once(U5.CLOSED,uH),this.once("@".concat(B,"-").concat(this.spec.sid),rH=>{TN(rH)})});b&&T5.workerEvent(this.spec.sid,rre(rre({},b),{},{requestId:k,actionType:"request",payload:JSON.stringify(l.clientRequest),serverCode:0,code:0}));const lN=Date.now();this.websocket.sendMessage(Wt);let _N=null;try{_N=await uN}catch(TN){if(this.websocket.state==="closed")throw TN;return await $O(),await this.request(d,l,f)}return b&&T5.workerEvent(this.spec.sid,rre(rre({},b),{},{requestId:k,actionType:"response",payload:JSON.stringify(_N.serverResponse),serverCode:_N.code,success:_N.code===200,responseTime:Date.now()-lN})),_N.code!==200&&this.handleResponseError(_N),_N}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const d=q8==="4.23.1"?"0.0.1":q8;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:d,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(d){switch(d.code){case yK.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void CN.warning("live stream response already exists stream");case yK.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case yK.LIVE_STREAM_RESPONSE_BAD_STREAM:case yK.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new LH(dH.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:d.code}).throw();case yK.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(d.serverResponse.command==="UnpublishStream")return;throw new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yK.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new LH(dH.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:d.code}).throw();case yK.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const l=new LH(dH.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(xX.WARNING,l,d.serverResponse.url)}case yK.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const l=new LH(dH.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(xX.WARNING,l,d.serverResponse.url)}case yK.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yK.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new LH(dH.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:d.code}).throw();case yK.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const l=new LH(dH.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(xX.WARNING,l,d.serverResponse.url)}case yK.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:d.code}).throw();case yK.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case yK.LIVE_STREAM_RESPONSE_WORKER_LOST:case yK.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(d.serverResponse.command==="UnpublishStream")return;throw new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yK.ERROR_FAIL_SEND_MESSAGE:if(d.serverResponse.command==="UnpublishStream")return;if(d.serverResponse.command==="UpdateTranscoding"||d.serverResponse.command==="ControlStream")return new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:d.code}).throw();throw new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yK.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yK.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yK.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yK.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new LH(dH.LIVE_STREAMING_CDN_ERROR,"",{code:d.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Zse)},6e3)}}function xbe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function n8(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?xbe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):xbe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}class kLe extends W6{constructor(d){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:EK,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:EK;super(),cH(this,"onLiveStreamWarning",void 0),cH(this,"onLiveStreamError",void 0),cH(this,"spec",void 0),cH(this,"retryTimeout",1e4),cH(this,"connection",void 0),cH(this,"httpRetryConfig",void 0),cH(this,"wsRetryConfig",void 0),cH(this,"streamingTasks",new Map),cH(this,"isStartingStreamingTask",!1),cH(this,"taskMutex",new t4("live-streaming")),cH(this,"cancelToken",F4.CancelToken.source()),cH(this,"transcodingConfig",void 0),cH(this,"uapResponse",void 0),cH(this,"lastTaskId",1),cH(this,"statusError",new Map),this.spec=d,this.httpRetryConfig=f,this.wsRetryConfig=l}async setTranscodingConfig(d){const l=n8(n8({},Cke),d);l.videoCodecProfile!==66&&l.videoCodecProfile!==77&&l.videoCodecProfile!==100&&(CN.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(l.videoCodecProfile," -> 100")),l.videoCodecProfile=100),l.transcodingUsers||(l.transcodingUsers=l.userConfigs),l.transcodingUsers&&(l.transcodingUsers=l.transcodingUsers.map(B=>n8(n8(n8({},vke),B),{},{zOrder:B.zOrder?B.zOrder+1:1}))),function(B){z6(B.width)||b6(B.width,"config.width",0,1e4),z6(B.height)||b6(B.height,"config.height",0,1e4),z6(B.videoBitrate)||b6(B.videoBitrate,"config.videoBitrate",1,1e6),z6(B.videoFrameRate)||b6(B.videoFrameRate,"config.videoFrameRate"),z6(B.lowLatency)||O7(B.lowLatency,"config.lowLatency"),z6(B.audioSampleRate)||vK(B.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),z6(B.audioBitrate)||b6(B.audioBitrate,"config.audioBitrate",1,128),z6(B.audioChannels)||vK(B.audioChannels,"config.audioChannels",[1,2,3,4,5]),z6(B.videoGop)||b6(B.videoGop,"config.videoGop"),z6(B.videoCodecProfile)||vK(B.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),z6(B.userCount)||b6(B.userCount,"config.userCount",0,17),z6(B.backgroundColor)||b6(B.backgroundColor,"config.backgroundColor",0,16777215),z6(B.userConfigExtraInfo)||jK(B.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),B.transcodingUsers&&!z6(B.transcodingUsers)&&(N7(B.transcodingUsers,"config.transcodingUsers"),B.transcodingUsers.forEach((Wt,$O)=>{Roe(Wt.uid),z6(Wt.x)||b6(Wt.x,"transcodingUser[".concat($O,"].x"),0,1e4),z6(Wt.y)||b6(Wt.y,"transcodingUser[".concat($O,"].y"),0,1e4),z6(Wt.width)||b6(Wt.width,"transcodingUser[".concat($O,"].width"),0,1e4),z6(Wt.height)||b6(Wt.height,"transcodingUser[".concat($O,"].height"),0,1e4),z6(Wt.zOrder)||b6(Wt.zOrder-1,"transcodingUser[".concat($O,"].zOrder"),0,100),z6(Wt.alpha)||b6(Wt.alpha,"transcodingUser[".concat($O,"].alpha"),0,1,!1)})),z6(B.watermark)||ole(B.watermark,"watermark"),z6(B.backgroundImage)||ole(B.backgroundImage,"backgroundImage"),B.images&&!z6(B.images)&&(N7(B.images,"config.images"),B.images.forEach((Wt,$O)=>{ole(Wt,"images[".concat($O,"]"))}))}(l);const f=[];l.images&&f.push(...l.images.map(B=>n8(n8(n8({},sle),B),{},{zOrder:255}))),l.backgroundImage&&(f.push(n8(n8(n8({},sle),l.backgroundImage),{},{zOrder:0})),delete l.backgroundImage),l.watermark&&(f.push(n8(n8(n8({},sle),l.watermark),{},{zOrder:255})),delete l.watermark),l.images=f,l.transcodingUsers&&(l.userConfigs=l.transcodingUsers.map(B=>n8({},B)),l.userCount=l.transcodingUsers.length,delete l.transcodingUsers);const b=(l.userConfigs||[]).map(B=>typeof B.uid=="number"?u5.resolve(B.uid):nye(B.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await u5.all(b)).forEach((B,Wt)=>{l.userConfigs&&l.userConfigs[Wt]&&(l.userConfigs[Wt].uid=B)}),this.transcodingConfig=l,this.connection)try{var k;const B=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(S8(k=this.streamingTasks).call(k)).map(Wt=>Wt.taskId).join("#")});CN.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(B.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(B){if(!B.data||!B.data.retry)throw B;B.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(Wt=>{CN.warning("[".concat(this.spec.clientId,"] live streaming receive error"),B.toString(),"try to republish",Wt.url),this.startLiveStreamingTask(Wt.url,Wt.mode,B).then(()=>{CN.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(Wt.url," success"))}).catch($O=>{CN.error("[".concat(this.spec.clientId,"] live streaming republish failed"),Wt.url,$O.toString()),this.onLiveStreamError&&this.onLiveStreamError(Wt.url,$O)})})}}async startLiveStreamingTask(d,l,f){if(!this.transcodingConfig&&l===D7.TRANSCODE)throw new LH(dH.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const b={command:"PublishStream",ts:Date.now(),url:d,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};CN.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(d,", mode: ").concat(l));const k=await this.taskMutex.lock();if(!this.connection&&f)return void k();if(this.streamingTasks.get(d)&&!f)return k(),new LH(dH.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(l))}catch(Wt){throw k(),Wt}switch(l){case D7.TRANSCODE:b.transcodingConfig=n8({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(b.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const B=this.lastTaskId++;try{const Wt=new u5((uN,lN)=>{BK(this.retryTimeout).then(()=>{if(f)return lN(f);const _N=this.statusError.get(d);return _N?(this.statusError.delete(d),lN(_N)):void 0})}),$O=await u5.race([this.connection.request("request",{clientRequest:b},!0,{url:d,command:"PublishStream",workerType:l===D7.TRANSCODE?1:2,requestByUser:!f,tid:B.toString()}),Wt]);this.isStartingStreamingTask=!1,CN.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat($O.code)),this.streamingTasks.set(d,{clientRequest:b,mode:l,url:d,taskId:B}),k()}catch(Wt){if(k(),this.isStartingStreamingTask=!1,!Wt.data||!Wt.data.retry||f)throw Wt;return Wt.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(d,l,Wt)):await this.startLiveStreamingTask(d,l,Wt)}}stopLiveStreamingTask(d){return new u5((l,f)=>{const b=this.streamingTasks.get(d);if(!b||!this.connection)return new LH(dH.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const k=b.mode;b.abortTask=()=>{CN.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(d),l()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:b.url}},!1,{url:d,command:"UnPublishStream",workerType:k===D7.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(B=>{CN.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(B.code)),this.streamingTasks.delete(d),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),l()}).catch(f)})}resetAllTask(){var d;const l=Array.from(S8(d=this.streamingTasks).call(d));this.terminate();for(const f of l)this.startLiveStreamingTask(f.url,f.mode).catch(b=>{this.onLiveStreamError&&this.onLiveStreamError(f.url,b)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=F4.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(d){if(this.connection)throw new LH(dH.UNEXPECTED_ERROR,"live streaming connection has already connected");const l=await YK(this,ale.REQUEST_WORKER_MANAGER_LIST,d);return this.uapResponse=l,this.connection=new DLe(l.workerToken,this.spec,this.wsRetryConfig,d),this.connection.on(xX.WARNING,(f,b)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(b,f)),this.connection.on(xX.PUBLISH_STREAM_STATUS,f=>this.handlePublishStreamServer(f)),this.connection.on(xX.REQUEST_NEW_ADDRESS,(f,b)=>{if(!this.connection)return b(new LH(dH.UNEXPECTED_ERROR,"can not get new live streaming address list"));YK(this,ale.REQUEST_WORKER_MANAGER_LIST,d).then(k=>{this.uapResponse=k,f(k.addressList)}).catch(b)}),await this.connection.init(l.addressList),this.connection}handlePublishStreamServer(d){const l=d.serverStatus&&d.serverStatus.url||"empty_url",f=this.streamingTasks.get(l),b=d.reason;switch(d.code){case yK.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yK.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yK.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yK.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const B=new LH(dH.LIVE_STREAMING_CDN_ERROR,"",{code:d.code});if(f)return CN.error(B.toString()),this.onLiveStreamError&&this.onLiveStreamError(l,B);if(!this.isStartingStreamingTask)return;this.statusError.set(l,B)}case yK.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const B=new LH(dH.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,b);return this.onLiveStreamWarning&&this.onLiveStreamWarning(l,B)}case yK.LIVE_STREAM_RESPONSE_WORKER_LOST:case yK.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var k;if(!this.connection)return;this.connection.tryNextAddress();const B=Array.from(S8(k=this.streamingTasks).call(k));for(const Wt of B)Wt.abortTask?Wt.abortTask():(CN.warning("[".concat(this.spec.clientId,"] publish stream status code"),d.code,"try to republish",Wt.url),this.startLiveStreamingTask(Wt.url,Wt.mode,new LH(dH.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:d.code})).then(()=>{CN.debug("[".concat(this.spec.clientId,"] republish live stream success"),Wt.url)}).catch($O=>{CN.error($O.toString()),this.onLiveStreamError&&this.onLiveStreamError(Wt.url,$O)}));return}}}hasUrl(d){return this.streamingTasks.has(d)}}const LLe={name:"LiveStreaming",create:function(s){return new kLe(s.joinInfo,s.websocketRetryConfig||EK,s.httpRetryConfig||EK)}};function MLe(s){let d=jbe();return function(l,f){let b=l.appId;b!==void 0&&(T6(f,10),XJ(f,b));let k=l.cid;k!==void 0&&(T6(f,16),T6(f,k));let B=l.cname;B!==void 0&&(T6(f,26),XJ(f,B));let Wt=l.deviceId;Wt!==void 0&&(T6(f,34),XJ(f,Wt));let $O=l.elapse;$O!==void 0&&(T6(f,40),XX(f,$O));let uN=l.fileSize;uN!==void 0&&(T6(f,48),XX(f,lee(uN)));let lN=l.height;lN!==void 0&&(T6(f,56),XX(f,lee(lN)));let _N=l.jpg;_N!==void 0&&(T6(f,66),T6(f,_N.length),function(H4,qH){let o5=hee(H4,qH.length);H4.bytes.set(qH,o5)}(f,_N));let TN=l.networkType;TN!==void 0&&(T6(f,72),XX(f,lee(TN)));let vN=l.osType;vN!==void 0&&(T6(f,80),XX(f,lee(vN)));let uH=l.requestId;uH!==void 0&&(T6(f,90),XJ(f,uH));let rH=l.sdkVersion;rH!==void 0&&(T6(f,98),XJ(f,rH));let iH=l.sequence;iH!==void 0&&(T6(f,104),XX(f,lee(iH)));let lH=l.sid;lH!==void 0&&(T6(f,114),XJ(f,lH));let hH=l.timestamp;hH!==void 0&&(T6(f,120),XX(f,hH));let bH=l.uid;bH!==void 0&&(T6(f,128),T6(f,bH));let PH=l.vid;PH!==void 0&&(T6(f,136),T6(f,PH));let OH=l.width;OH!==void 0&&(T6(f,144),XX(f,lee(OH)));let wH=l.service;wH!==void 0&&(T6(f,152),T6(f,wH));let BH=l.callbackData;BH!==void 0&&(T6(f,162),XJ(f,BH));let XH=l.jpgEncryption;XH!==void 0&&(T6(f,168),T6(f,XH));let d5=l.requestType;d5!==void 0&&(T6(f,176),T6(f,d5));let p5=l.scorePorn;p5!==void 0&&(T6(f,185),lhe(f,p5));let $5=l.scoreSexy;$5!==void 0&&(T6(f,193),lhe(f,$5));let e6=l.scoreNeutral;e6!==void 0&&(T6(f,201),lhe(f,e6));let N6=l.scene;N6!==void 0&&(T6(f,208),T6(f,N6));let aK=l.ossFilePrefix;aK!==void 0&&(T6(f,218),XJ(f,aK));let eK=l.serviceVendor;if(eK!==void 0)for(let H4 of eK){T6(f,226);let qH=jbe();VLe(H4,qH),T6(f,qH.limit),GLe(f,qH),BLe(qH)}}(s,d),function(l){let f=l.bytes,b=l.limit;return f.length===b?f:f.subarray(0,b)}(d)}function ULe(s){return function(l){let f={};e:for(;!Bbe(l);){let b=QJ(l);switch(b>>>3){case 0:break e;case 1:f.code=QJ(l);break;case 2:f.msg=Gbe(l,QJ(l));break;case 3:{let k=FLe(l);f.data=xLe(l),l.limit=k;break}default:Vbe(l,7&b)}}return f}({bytes:d=s,offset:0,limit:d.length});var d}function xLe(s){let d={};e:for(;!Bbe(s);){let l=QJ(s);switch(l>>>3){case 0:break e;case 1:d.requestId=Gbe(s,QJ(s));break;case 2:d.requestType=QJ(s)>>>0;break;case 3:d.scorePorn=dhe(s);break;case 4:d.scoreSexy=dhe(s);break;case 5:d.scoreNeutral=dhe(s);break;case 6:d.requestScene=QJ(s)>>>0;break;case 7:d.scene=QJ(s)>>>0;break;default:Vbe(s,7&l)}}return d}function VLe(s,d){let l=s.service;l!==void 0&&(T6(d,8),T6(d,l));let f=s.vendor;f!==void 0&&(T6(d,16),T6(d,f));let b=s.token;b!==void 0&&(T6(d,26),XJ(d,b));let k=s.callbackUrl;k!==void 0&&(T6(d,34),XJ(d,k))}function FLe(s){let d=QJ(s),l=s.limit;return s.limit=s.offset+d,l}function Vbe(s,d){switch(d){case 0:for(;128&Wbe(s););break;case 2:che(s,QJ(s));break;case 5:che(s,4);break;case 1:che(s,8);break;default:throw new Error("Unimplemented type: "+d)}}let jLe=new Float32Array(1);new Uint8Array(jLe.buffer);let ahe=new Float64Array(1),r8=new Uint8Array(ahe.buffer);function lee(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let Fbe=[];function jbe(){const s=Fbe.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}function BLe(s){Fbe.push(s)}function che(s,d){if(s.offset+d>s.limit)throw new Error("Skip past limit");s.offset+=d}function Bbe(s){return s.offset>=s.limit}function hee(s,d){let l=s.bytes,f=s.offset,b=s.limit,k=f+d;if(k>l.length){let B=new Uint8Array(2*k);B.set(l),s.bytes=B}return s.offset=k,k>b&&(s.limit=k),f}function uhe(s,d){let l=s.offset;if(l+d>s.limit)throw new Error("Read past limit");return s.offset+=d,l}function Gbe(s,d){let l=uhe(s,d),f=String.fromCharCode,b=s.bytes,k="�",B="";for(let Wt=0;Wt<d;Wt++){let $O,uN,lN,_N,TN=b[Wt+l];128&TN?(224&TN)==192?Wt+1>=d?B+=k:($O=b[Wt+l+1],(192&$O)!=128?B+=k:(_N=(31&TN)<<6|63&$O,_N<128?B+=k:(B+=f(_N),Wt++))):(240&TN)==224?Wt+2>=d?B+=k:($O=b[Wt+l+1],uN=b[Wt+l+2],(49344&($O|uN<<8))!=32896?B+=k:(_N=(15&TN)<<12|(63&$O)<<6|63&uN,_N<2048||_N>=55296&&_N<=57343?B+=k:(B+=f(_N),Wt+=2))):(248&TN)==240?Wt+3>=d?B+=k:($O=b[Wt+l+1],uN=b[Wt+l+2],lN=b[Wt+l+3],(12632256&($O|uN<<8|lN<<16))!=8421504?B+=k:(_N=(7&TN)<<18|(63&$O)<<12|(63&uN)<<6|63&lN,_N<65536||_N>1114111?B+=k:(_N-=65536,B+=f(55296+(_N>>10),56320+(1023&_N)),Wt+=3))):B+=k:B+=f(TN)}return B}function XJ(s,d){let l=d.length,f=0;for(let B=0;B<l;B++){let Wt=d.charCodeAt(B);Wt>=55296&&Wt<=56319&&B+1<l&&(Wt=(Wt<<10)+d.charCodeAt(++B)-56613888),f+=Wt<128?1:Wt<2048?2:Wt<65536?3:4}T6(s,f);let b=hee(s,f),k=s.bytes;for(let B=0;B<l;B++){let Wt=d.charCodeAt(B);Wt>=55296&&Wt<=56319&&B+1<l&&(Wt=(Wt<<10)+d.charCodeAt(++B)-56613888),Wt<128?k[b++]=Wt:(Wt<2048?k[b++]=Wt>>6&31|192:(Wt<65536?k[b++]=Wt>>12&15|224:(k[b++]=Wt>>18&7|240,k[b++]=Wt>>12&63|128),k[b++]=Wt>>6&63|128),k[b++]=63&Wt|128)}}function GLe(s,d){let l=hee(s,d.limit),f=s.bytes,b=d.bytes;for(let k=0,B=d.limit;k<B;k++)f[k+l]=b[k]}function Wbe(s){return s.bytes[uhe(s,1)]}function Hbe(s,d){let l=hee(s,1);s.bytes[l]=d}function dhe(s){let d=uhe(s,8),l=s.bytes;return r8[0]=l[d++],r8[1]=l[d++],r8[2]=l[d++],r8[3]=l[d++],r8[4]=l[d++],r8[5]=l[d++],r8[6]=l[d++],r8[7]=l[d++],ahe[0]}function lhe(s,d){let l=hee(s,8),f=s.bytes;ahe[0]=d,f[l++]=r8[0],f[l++]=r8[1],f[l++]=r8[2],f[l++]=r8[3],f[l++]=r8[4],f[l++]=r8[5],f[l++]=r8[6],f[l++]=r8[7]}function QJ(s){let d,l=0,f=0;do d=Wbe(s),l<32&&(f|=(127&d)<<l),l+=7;while(128&d);return f}function T6(s,d){for(d>>>=0;d>=128;)Hbe(s,127&d|128),d>>>=7;Hbe(s,d)}function XX(s,d){let l=d.low>>>0,f=(d.low>>>28|d.high<<4)>>>0,b=d.high>>>24,k=b===0?f===0?l<16384?l<128?1:2:l<1<<21?3:4:f<16384?f<128?5:6:f<1<<21?7:8:b<128?9:10,B=hee(s,k),Wt=s.bytes;switch(k){case 10:Wt[B+9]=b>>>7&1;case 9:Wt[B+8]=k!==9?128|b:127&b;case 8:Wt[B+7]=k!==8?f>>>21|128:f>>>21&127;case 7:Wt[B+6]=k!==7?f>>>14|128:f>>>14&127;case 6:Wt[B+5]=k!==6?f>>>7|128:f>>>7&127;case 5:Wt[B+4]=k!==5?128|f:127&f;case 4:Wt[B+3]=k!==4?l>>>21|128:l>>>21&127;case 3:Wt[B+2]=k!==3?l>>>14|128:l>>>14&127;case 2:Wt[B+1]=k!==2?l>>>7|128:l>>>7&127;case 1:Wt[B]=k!==1?128|l:127&l}}function qbe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}const WLe=new Map([["moderation",1],["supervise",2]]);class HLe extends W6{get connectionState(){return this._connectionState}set connectionState(d){if(this._connectionState===d)return;const l=this._connectionState;this._connectionState=d,this.emit(MK.CONNECTION_STATE_CHANGE,l,d)}get inspectType(){return this._inspectType}set inspectType(d){var l;this._inspectMode=z4(l=d.map(f=>WLe.get(f)||0)).call(l,(f,b)=>f+b),this._inspectType=d}get quality(){return this._quality}set quality(d){this._quality=d>1?1:d<.1?.1:d,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(d){super(),cH(this,"name","AgoraRTCVideoContentInspect"),cH(this,"_connectionState",SY.CONNECTING),cH(this,"_innerConnectionState",void 0),cH(this,"sequence",0),cH(this,"inspectStartTime",void 0),cH(this,"workerManagerConnection",void 0),cH(this,"workerConnection",void 0),cH(this,"workerMessageLengthLimit",void 0),cH(this,"inspectIntervalMinimum",void 0),cH(this,"qualityRatio",void 0),cH(this,"_connectInfo",void 0),cH(this,"_cancelTokenSource",F4.CancelToken.source()),cH(this,"_retryConfig",void 0),cH(this,"wmSequence",0),cH(this,"inspectInterval",void 0),cH(this,"inspectTimer",null),cH(this,"ossFilePrefix",void 0),cH(this,"extraInfo",void 0),cH(this,"_inspectType",void 0),cH(this,"_inspectMode",void 0),cH(this,"_quality",1),cH(this,"qualityTimer",null),cH(this,"_inspectId",void 0),cH(this,"_needWorkUrlOnly",!1),cH(this,"inspectImage",()=>{if(this.connectionState!==SY.CONNECTED)throw new LH(dH.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===SY.CONNECTED?this.requestToInspectImage():CN.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=A6(5,"inspect-"),this.workerMessageLengthLimit=_H("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=_H("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=_H("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=d.interval,this.ossFilePrefix=d.ossFilePrefix,this.extraInfo=d.extraInfo,this.inspectType=d.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ane("worker-manager-"+this._inspectId,EK),this.on(MK.STATE_CHANGE,(l,f)=>{this._innerConnectionState=l,CN.debug("[".concat(this._inspectId,"] Inspect operation :").concat(yY[l]," ").concat(f||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ane("worker-"+this._inspectId,EK),this.handleWorkerEvents()}async init(d,l){this.emit(MK.STATE_CHANGE,yY.CONNECT_AP),this._connectInfo=d;const f=this._cancelTokenSource.token;return this._retryConfig=l,new u5((b,k)=>{this.on(MK.CONNECTION_STATE_CHANGE,(B,Wt)=>{Wt===SY.CONNECTED&&b()}),this.requestAP(d,f,l).then(B=>{this.connectWorkerManager(B)}).catch(B=>{k(B)})})}async requestAP(d,l,f){const b=_H("WEBCS_DOMAIN").map(Wt=>"https://".concat(Wt,"/api/v1")),k=await function(Wt,$O,uN,lN){let{appId:_N,areaCode:TN,cname:vN,sid:uH,token:rH,uid:iH}=$O;eee++;const lH="image_moderation_api",hH={service_name:lH,json_body:JSON.stringify({appId:_N,areaCode:TN,cname:vN,command:"allocateEdge",requestId:eee,seq:eee,sid:uH,token:rH,ts:Date.now(),uid:iH+""})};let bH,PH,OH=Wt[0];return ZY(async()=>{bH=Date.now();const wH=await rJ(OH,{data:hH,cancelToken:uN,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(PH=Date.now()-bH,wH.code!==0){const p5=new LH(dH.UNEXPECTED_RESPONSE,"image inspect ap error, code"+wH.code,{retry:!0,responseTime:PH});throw CN.error(p5.toString()),p5}const BH=JSON.parse(wH.json_body);if(BH.code!==200){const p5=new LH(dH.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(BH.code,", reason: ").concat(BH.reason),{code:BH.code,responseTime:PH});throw CN.error(p5.toString()),p5}if(!BH.servers||!Array.isArray(BH.servers)||BH.servers.length===0){const p5=new LH(dH.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:BH.code,responseTime:PH});throw CN.error(p5.toString()),p5}const XH=_H("VIDEO_INSPECT_WORKER_MANAGER_HOST"),d5=_H("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:BH.servers.map(p5=>{let{address:$5,wss:e6}=p5;if($5&&e6)return"wss://".concat($5.replace(/\./g,"-"),".").concat(XH,":").concat(d5||e6)}).filter(p5=>!!p5),workerToken:BH.workerToken,vid:BH.vid,responseTime:PH}},(wH,BH)=>(T5.apworkerEvent(uH,{success:!0,sc:200,serviceName:lH,responseDetail:JSON.stringify(wH.addressList),firstSuccess:BH===0,responseTime:PH,serverIp:Wt[BH%Wt.length]}),!1),(wH,BH)=>(T5.apworkerEvent(uH,{success:!1,sc:wH.data&&wH.data.code||200,serviceName:lH,responseTime:PH,serverIp:Wt[BH%Wt.length]}),!!(wH.code!==dH.OPERATION_ABORTED&&wH.code!==dH.UNEXPECTED_RESPONSE||wH.data&&wH.data.retry)&&(OH=Wt[(BH+1)%Wt.length],!0)),lN)}(b,d,l,f);this.emit(MK.STATE_CHANGE,yY.AP_CONNECTED);const{addressList:B}=k;return this.wmSequence++,B}async connectWorkerManager(d){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=l,this.emit(MK.STATE_CHANGE,yY.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(d,1e4)}async connectWorker(d){await this.workerConnection.init([d])}handleWorkerManagerEvents(){this.workerManagerConnection.on(U5.CONNECTED,async()=>{this.emit(MK.STATE_CHANGE,yY.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(U5.CLOSED,()=>{this._innerConnectionState<yY.GET_WORKER_MANAGER_RESPONSE&&CN.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(U5.FAILED,()=>{this._innerConnectionState<yY.GET_WORKER_MANAGER_RESPONSE&&CN.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(U5.RECONNECTING,()=>{this._innerConnectionState<yY.GET_WORKER_MANAGER_RESPONSE&&CN.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(U5.ON_MESSAGE,async d=>{this.emit(MK.STATE_CHANGE,yY.GET_WORKER_MANAGER_RESPONSE);const l=this.workerManagerConnection.url;this.workerManagerConnection.close();const f=JSON.parse(d.data);if(f.code!==200)throw CN.error("[".concat(this._inspectId,"] Unexpected code ").concat(f.code," from worker manager")),new LH(dH.UNEXPECTED_RESPONSE,"response code of worker is unexpected",f);if(!(f.serverResponse&&f.serverResponse.portWss&&l))throw CN.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(f))),new LH(dH.UNEXPECTED_RESPONSE,"response content of worker is unexpected",f);{const b=_H("VIDEO_INSPECT_WORKER_PORT")||f.serverResponse.portWss,k=l.replace(/:\d+\/?$/,":".concat(b));this.emit(MK.STATE_CHANGE,yY.CONNECT_WORKER,k),this._needWorkUrlOnly?this.emit(MK.REQUEST_NEW_WORKER_URL,k):await this.connectWorker(k)}}),this.workerManagerConnection.on(U5.WILL_RECONNECT,(d,l,f)=>{f(d)}),this.workerManagerConnection.on(U5.REQUEST_NEW_URLS,(d,l)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(d).catch(l)})}handleWorkerEvents(){this.workerConnection.on(U5.CONNECTED,async()=>{this.emit(MK.STATE_CHANGE,yY.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=SY.CONNECTED}),this.workerConnection.on(U5.ON_MESSAGE,async d=>{if(d.data instanceof ArrayBuffer){const f=ULe(new Uint8Array(d.data));if(_H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&CN.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(f)),f.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(MK.INSPECT_RESULT,void 0,void 0);if(f.data&&f.data.scorePorn&&f.data.scoreSexy&&f.data.scoreNeutral){var l;const b={porn:f.data.scorePorn,sexy:f.data.scoreSexy,neutral:f.data.scoreNeutral},k=z4(l=Object.keys(b)).call(l,(Wt,$O)=>b[Wt]>b[$O]?Wt:$O,"porn"),B=Object.keys(b).find(Wt=>Wt===k);this.emit(MK.INSPECT_RESULT,B)}else this.emit(MK.INSPECT_RESULT,void 0,new LH(dH.UNEXPECTED_RESPONSE,f.code+"","There is an unexpected data on message"))}else this.emit(MK.INSPECT_RESULT,void 0,new LH(dH.UNEXPECTED_RESPONSE,f.code+"",f.msg))}else CN.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(MK.INSPECT_RESULT,void 0,new LH(dH.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(U5.CLOSED,()=>{this.connectionState=SY.CLOSED}),this.workerConnection.on(U5.FAILED,()=>{this.connectionState=SY.CLOSED}),this.workerConnection.on(U5.RECONNECTING,()=>{this.connectionState=this.connectionState===SY.CONNECTED?SY.RECONNECTING:SY.CONNECTING}),this.workerConnection.on(U5.WILL_RECONNECT,(d,l,f)=>{d==="recover"&&f(d),f("tryNext")}),this.workerConnection.on(U5.REQUEST_NEW_URLS,(d,l)=>{this.workerManagerConnection.close(),this.once(MK.REQUEST_NEW_WORKER_URL,f=>{d([f])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(f=>{this.connectWorkerManager(f,!0)}).catch(f=>{l(f)})})}async requestToInspectImage(){this.sequence++;const d=R8(this,MK.CLIENT_LOCAL_VIDEO_TRACK),l={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(d){if(!d.isPlaying)return void this.emit(MK.INSPECT_RESULT,void 0,new LH(dH.INVALID_OPERATION,"Only the track being played can be inspected"));const f=await this.generateRequestData(d,l);this.workerConnection.sendMessage(f,!0,!0)}else this.emit(MK.INSPECT_RESULT,void 0,new LH(dH.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(d,l){let{appId:f,cname:b,cid:k,vid:B,sid:Wt,uid:$O}=l;const uN=Date.now(),lN=await d.getCurrentFrameImage("image/jpeg",this.quality),_N=await Ige(lN,f,b),TN=this.sequence+"-"+k+"-"+$O+"-"+uN+"-"+A6(12,""),vN={appId:f,cid:k,cname:b,deviceId:"",elapse:(uH=Number(uN-this.inspectStartTime),{low:uH|=0,high:uH>>31,unsigned:uH>=0}),fileSize:_N.byteLength,jpgEncryption:2,height:lN.height,width:lN.width,jpg:_N,networkType:6,osType:7,requestId:TN,sdkVersion:"4.23.1",sequence:this.sequence,sid:Wt,timestamp:Qye(uN),uid:$O,vid:B,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var uH;this.extraInfo===void 0&&delete vN.callbackData,this.ossFilePrefix===void 0&&delete vN.ossFilePrefix;const rH=MLe(vN);if(rH.byteLength<this.workerMessageLengthLimit){if(_H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const iH=function(lH){for(var hH=1;hH<arguments.length;hH++){var bH=arguments[hH]!=null?arguments[hH]:{};hH%2?qbe(Object(bH),!0).forEach(function(PH){cH(lH,PH,bH[PH])}):Object.getOwnPropertyDescriptors?Object.defineProperties(lH,Object.getOwnPropertyDescriptors(bH)):qbe(Object(bH)).forEach(function(PH){Object.defineProperty(lH,PH,Object.getOwnPropertyDescriptor(bH,PH))})}return lH}({},vN);delete iH.jpg,CN.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(iH))}return rH}{const iH=this.quality*this.qualityRatio;return this.quality=iH,await this.generateRequestData(d,{appId:f,cname:b,cid:k,vid:B,sid:Wt,uid:$O})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=F4.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=SY.CLOSED,this.emit(MK.STATE_CHANGE,yY.CLOSED)}}const qLe={name:"ContentInspect",create:function(s){let{config:d}=s;return function(l){if(!l)throw new LH(dH.INVALID_PARAMS,"inspectConfig is necessary.");if(!l.inspectType||!Array.isArray(l.inspectType))throw new LH(dH.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const f=[...new Set(l.inspectType)];f.forEach(b=>{var k;if(!a5(k=["supervise","moderation"]).call(k,b))throw new LH(dH.INVALID_PARAMS,"".concat(b," is not a valid inspect type."))}),l.inspectType=f}if(l&&l.extraInfo&&l.extraInfo.length>1024)throw new LH(dH.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(d),new HLe(d)}};var Kbe=h(M6.Object.getOwnPropertySymbols),KLe=f6,zLe=rZ.indexOf,YLe=I9,hhe=CH([].indexOf),zbe=!!hhe&&1/hhe([1],1,-0)<0;KLe({target:"Array",proto:!0,forced:zbe||!YLe("indexOf")},{indexOf:function(s){var d=arguments.length>1?arguments[1]:void 0;return zbe?hhe(this,s,d)||0:zLe(this,s,d)}});var JLe=l4("Array","indexOf"),XLe=dN,QLe=JLe,phe=Array.prototype,ZLe=function(s){var d=s.indexOf;return s===phe||XLe(phe,s)&&d===phe.indexOf?QLe:d},Ybe=h(ZLe);function $Le(s,d){if(s==null)return{};var l,f,b=function(B,Wt){if(B==null)return{};var $O,uN,lN={},_N=lSe(B);for(uN=0;uN<_N.length;uN++)$O=_N[uN],Ybe(Wt).call(Wt,$O)>=0||(lN[$O]=B[$O]);return lN}(s,d);if(Kbe){var k=Kbe(s);for(f=0;f<k.length;f++)l=k[f],Ybe(d).call(d,l)>=0||Object.prototype.propertyIsEnumerable.call(s,l)&&(b[l]=s[l])}return b}let Jbe=class{get localCapabilities(){return $6(this._localCapabilities)}get rtpCapabilities(){return $6(this._rtpCapabilities)}get candidates(){return $6(this._candidates)}get iceParameters(){return $6(this._iceParameters)}get dtlsParameters(){return $6(this._dtlsParameters)}constructor(s){cH(this,"sessionDesc",void 0),cH(this,"_localCapabilities",void 0),cH(this,"_rtpCapabilities",void 0),cH(this,"_candidates",void 0),cH(this,"_iceParameters",void 0),cH(this,"_dtlsParameters",void 0),cH(this,"setup",void 0),cH(this,"currentMidIndex",void 0),cH(this,"cname","o/i14u9pJrxRKAsu"),cH(this,"firefoxSsrcMidMap",new Map),s=$6(s);const{remoteIceParameters:d,remoteDtlsParameters:l,candidates:f,remoteRTPCapabilities:b,localCapabilities:k,direction:B,setup:Wt,videoCodec:$O,audioCodec:uN}=s;let lN;this.setup=Wt,lN=B===O4.RECEIVE_ONLY?$4(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):$4(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=b,this._candidates=f,this._iceParameters=d,this._dtlsParameters=l,this._localCapabilities=k;const _N=B===O4.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,TN=B===O4.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,vN=B===O4.RECEIVE_ONLY?b.send.videoCodecs:Pne(_5.VIDEO,_N,TN,$O),uH=B===O4.RECEIVE_ONLY?b.send.audioCodecs:Pne(_5.AUDIO,_N,TN,uN);for(const rH of lN.mediaDescriptions)rH.attributes.iceUfrag=d.iceUfrag,rH.attributes.icePwd=d.icePwd,rH.attributes.fingerprints=l.fingerprints,rH.attributes.candidates=f,rH.attributes.setup=this.setup,rH.media.mediaType==="application"&&(rH.attributes.sctpPort="5000"),rH.media.mediaType==="video"&&(rH.media.fmts=vN.map(iH=>iH.payloadType.toString(10)),rH.attributes.payloads=vN,rH.attributes.extmaps=_N.videoExtensions),rH.media.mediaType==="audio"&&(rH.media.fmts=uH.map(iH=>iH.payloadType.toString(10)),rH.attributes.payloads=uH,rH.attributes.extmaps=_N.audioExtensions,$$(rH));this.sessionDesc=lN,this.currentMidIndex=lN.mediaDescriptions.length-1}toString(){return UX(this.sessionDesc)}hasMid(s){return Array.isArray(s)?s.every(d=>this.hasMid(d)):this.sessionDesc.mediaDescriptions.some(d=>d.attributes.mid===s)}send(s,d,l,f,b){l=l.replace(/ /g,"-");const{ssrcs:k,ssrcGroups:B}=CQ(d,this.cname,_H("SYNC_GROUP")?l:void 0),Wt=this.findPreloadMediaDesc(k);if(Wt){if(Z6()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,Wt.attributes.mid),b&&(b.twcc||b.remb)){const $O=this.sessionDesc.mediaDescriptions.indexOf(Wt);return this.sessionDesc.mediaDescriptions[$O]=this.mungSendMediaDesc(Wt,b),{mid:Wt.attributes.mid,needExchangeSDP:!0}}return{mid:Wt.attributes.mid,needExchangeSDP:!1}}{const $O=this.findAvailableMediaIndex(s,k,f);let uN;return $O===-1?(uN=this.createOrRecycleSendMedia(s,k,B,"sendonly",f,b),this.updateBundleMids()):(uN=$6(this.sessionDesc.mediaDescriptions[$O]),uN.attributes.direction="sendonly",uN.attributes.ssrcs=k,uN.attributes.ssrcGroups=B,this.sessionDesc.mediaDescriptions[$O]=this.mungSendMediaDesc(uN,b)),Z6()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,uN.attributes.mid),{needExchangeSDP:!0,mid:uN.attributes.mid}}}stopSending(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>l.attributes.mid&&s.indexOf(l.attributes.mid)!==-1);if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");d.forEach(l=>{l.attributes.ssrcs=[]}),this.updateBundleMids()}receive(s,d,l){const f=[];return s.forEach(b=>{const k=b._mediaStreamTrack.kind,B=this.findAvailableRecvMediaIndex(k);let Wt,$O=!1;B===-1?($O=!0,Wt=this.createOrRecycleRecvMedia(b,[],"recvonly",d,l),this.updateBundleMids()):(Wt=$6(this.sessionDesc.mediaDescriptions[B]),Wt.attributes.direction="recvonly"),f.push({mid:Wt.attributes.mid,needCreateTransceiver:$O})}),f}stopReceiving(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>s.indexOf(l.attributes.mid)!==-1);if(d.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");d.forEach(l=>{l.media.port="0",l.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(s){const{foundation:d,protocol:l,address:f,port:b,type:k,relatedAddress:B,relatedPort:Wt,priority:$O}=new RTCIceCandidate(s),uN={foundation:d??"",componentId:"1",transport:l??"",priority:$O?$O+"":"",connectionAddress:f??"",port:b?b+"":"",type:k?k+"":"",relAddr:B??"",relPort:Wt?Wt+"":"",extension:{}};this.candidates.some(lN=>lN.priority===uN.priority&&lN.connectionAddress===uN.connectionAddress&&lN.port===uN.port)||(this._candidates.push(uN),this.sessionDesc.mediaDescriptions.forEach(lN=>{lN.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(s,d,l,f,b){const k=s._mediaStreamTrack.kind,B=this.rtpCapabilities.recv,Wt=Pne(k,B,this.localCapabilities.send,k===_5.AUDIO?b:f),$O=k===_5.VIDEO?B.videoExtensions:B.audioExtensions,uN="".concat(++this.currentMidIndex);let lN={media:{mediaType:k,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Wt.map(TN=>TN.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:$O,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Wt,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(uN)}};lN=this.mungRecvMediaDsec(lN,s);const _N=this.findFirstClosedMedia(k);if(_N){const TN=this.sessionDesc.mediaDescriptions.indexOf(_N);this.sessionDesc.mediaDescriptions[TN]=lN}else this.sessionDesc.mediaDescriptions.push(lN);return lN}muteRemote(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>a5(s).call(s,l.attributes.mid||""));if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(l=>{l.attributes.direction="inactive"})}unmuteRemote(s){const d=this.sessionDesc.mediaDescriptions.filter(l=>a5(s).call(s,l.attributes.mid||""));if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(l=>{l.attributes.direction="recvonly"})}findAvailableMediaIndex(s,d,l){return this.sessionDesc.mediaDescriptions.findIndex(f=>{const b=f.media.mediaType===s&&f.media.port!=="0"&&(f.attributes.direction==="sendonly"||f.attributes.direction==="sendrecv")&&f.attributes.ssrcs.length===0;if(Z6()){if(b){const k=this.firefoxSsrcMidMap.get(d[0].ssrcId);return!(k||f.attributes.mid!=="0"&&f.attributes.mid!=="1")||!(!k||k!==f.attributes.mid)}return!1}return b&&f.attributes.mid===l})}findAvailableRecvMediaIndex(s){return this.sessionDesc.mediaDescriptions.findIndex(d=>{const l=d.media.mediaType===s&&d.media.port!=="0"&&(d.attributes.direction==="recvonly"||d.attributes.direction==="sendrecv");return d.attributes.mid!=="0"&&d.attributes.mid!=="1"&&l})}predictReceivingMids(s){const d=[];for(let l=0;l<s;l++)d.push((this.currentMidIndex+l+1).toString(10));return d}restartICE(s){s=$6(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.iceUfrag=s.iceUfrag,d.attributes.icePwd=s.icePwd})}createOrRecycleSendMedia(s,d,l,f,b,k){const B=this.rtpCapabilities.send,Wt=s===_5.VIDEO?B.videoCodecs:B.audioCodecs,$O=s===_5.VIDEO?B.videoExtensions:B.audioExtensions;Z6()&&(b="".concat(++this.currentMidIndex));let uN={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Wt.map(_N=>_N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:$O,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:Wt,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:f,rtcpMux:!0,rtcpRsize:!0,mid:b}};uN=this.mungSendMediaDesc(uN,k);const lN=this.findFirstClosedMedia(s);if(lN){const _N=this.sessionDesc.mediaDescriptions.indexOf(lN);this.sessionDesc.mediaDescriptions[_N]=uN}else this.sessionDesc.mediaDescriptions.push(uN);return uN}mungRecvMediaDsec(s,d,l){const f=$6(s);return hle(f),Z$(f,d),ple(f,d),USe(f),Ooe(f,l,this.localCapabilities.send),f}mungSendMediaDesc(s,d){const l=$6(s);return Ooe(l,d,this.localCapabilities.recv),$$(l),l}updateRecvMedia(s,d){const l=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===s);if(l!==-1){const f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],d);this.sessionDesc.mediaDescriptions[l]=f}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>s.media.port!=="0").map(s=>s.attributes.mid)}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(d=>{var l;return((l=d.attributes)===null||l===void 0||(l=l.ssrcs[0])===null||l===void 0?void 0:l.ssrcId)===s[0].ssrcId})}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(d=>Z6()?d.media.port==="0"&&d.media.mediaType===s:d.media.port==="0")}};const eMe=["sdp"];var k6;function Xbe(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function QX(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?Xbe(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):Xbe(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}let Qbe=(k6=class fee extends mSe{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var d,l;return(d=(l=this.peerConnection.getReceivers()[0])===null||l===void 0||(l=l.transport)===null||l===void 0?void 0:l.state)!==null&&d!==void 0?d:null}get localCodecs(){return[]}set isInRestartIce(d){this._isInRestartIce=d}get isInRestartIce(){return this._isInRestartIce}constructor(d,l,f){super(d,l),cH(this,"direction",void 0),cH(this,"name",void 0),cH(this,"store",void 0),cH(this,"spec",void 0),cH(this,"peerConnection",void 0),cH(this,"initialOffer",void 0),cH(this,"transport",void 0),cH(this,"statsFilter",void 0),cH(this,"localCandidateCount",0),cH(this,"_isInRestartIce",!1),cH(this,"mutex",void 0),cH(this,"onLocalCandidate",void 0),cH(this,"remoteSDP",void 0),cH(this,"pendingCandidates",[]),cH(this,"localCapabilities",void 0),cH(this,"isReady",!1),cH(this,"restartCnt",0),cH(this,"curTurnServerIndex",0),this.store=l,this.spec=d,this.mutex=new t4("P2PConnection-mutex",l.clientId),this.peerConnection=new RTCPeerConnection(fee.resolvePCConfiguration(d,l.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=f??O4.SEND_ONLY,this.name=this.direction===O4.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=wde(this.peerConnection,_H("STATS_UPDATE_INTERVAL"),void 0,Z6()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(d){try{const l=await VSe();if(this.localCapabilities=Noe(l),d){const{sdp:f}=d,b=$Le(d,eMe),k=function(){const lN={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_N=Nne(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),TN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},vN={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},uH={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(RY(_N,lN,"videoExtensions",TN,vN,uH),RY(_N,lN,"videoCodecs",TN,vN,uH),RY(_N,lN,"audioExtensions",TN,vN,uH),RY(_N,lN,"audioCodecs",TN,vN,uH),_H("RAISE_H264_BASELINE_PRIORITY")){const rH=uH.videoCodecs.findIndex(iH=>iH.rtpMap&&iH.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&iH.fmtp&&iH.fmtp.parameters["profile-level-id"]==="42001f");if(rH!==-1){const iH=uH.videoCodecs.findIndex(lH=>lH.rtpMap&&lH.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(iH<rH){CN.debug("raising H264 baseline profile priority");const lH=uH.videoCodecs[rH];uH.videoCodecs.splice(rH,1),uH.videoCodecs.splice(iH,0,lH)}iH!==-1&&_H("FILTER_SEND_H264_BASELINE")&&(TN.videoCodecs=TN.videoCodecs.filter(lH=>!(lH.rtpMap&&lH.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&lH.fmtp&&lH.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:TN,recv:vN,sendrecv:uH}}({},{},f);this.remoteSDP=new Jbe({remoteIceParameters:b.iceParameters,remoteDtlsParameters:b.dtlsParameters,candidates:[],remoteRTPCapabilities:k,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const B=await this.peerConnection.createAnswer();if(!B.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const Wt=jX(B.sdp);await this.peerConnection.setLocalDescription(B);const $O=await FSe({},{},B.sdp);this.localCapabilities=Noe($O);const uN=this.peerConnection.getTransceivers()[0];return uN!=null&&uN.receiver&&uN.receiver.transport&&this.tryBindTransportEvents(uN.receiver.transport),QX(QX({},Wt),{},{sdp:B.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const f=await this.peerConnection.createOffer();if(!f.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const b=jX(f.sdp);return this.initialOffer=f,QX(QX({},b),{},{sdp:f.sdp})}}catch(l){throw new jH(dH.GET_LOCAL_CONNECTION_PARAMS_FAILED,l.toString())}}async connect(d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:l,iceParameters:f,dtlsParameters:b}=d,k=await FSe({},{},l);this.remoteSDP=new Jbe({remoteIceParameters:f,remoteDtlsParameters:b,candidates:[],remoteRTPCapabilities:k,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const B=this.peerConnection.getTransceivers()[0];B!=null&&B.sender&&B.sender.transport&&this.tryBindTransportEvents(B.sender.transport)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}async addRemoteCandidate(d){try{d&&this.pendingCandidates.push(d),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(l=>{this.peerConnection.addIceCandidate(l)}),this.pendingCandidates=[])}catch(l){throw new jH(dH.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(l.toString()))}}send(d,l,f){var b=this;return H8(function*(){const k=yield i6(b.mutex.lock("From P2PConnection.send"));try{if(!b.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const B=[],Wt=b.remoteSDP.receive(d,l,f);d.forEach((iH,lH)=>{if(Wt[lH].needCreateTransceiver){const hH=b.peerConnection.addTransceiver(iH._mediaStreamTrack,{direction:"sendonly"});B.push(hH),iH._updateRtpTransceiver(hH)}else{const hH=b.peerConnection.getTransceivers().find(bH=>bH.mid===Wt[lH].mid);if(!hH)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(Wt[lH].mid));B.push(hH),iH._updateRtpTransceiver(hH)}}),Z6()&&_H("SIMULCAST")===!0&&(yield i6(b.applySimulcastForFirefox(B,d)));const $O=Wt.map(iH=>iH.mid),uN=yield i6(b.peerConnection.createOffer()),lN=b.mungSendOfferSDP(uN.sdp,d,$O),_N=$4(lN),TN=$O.map(iH=>{const lH=_N.mediaDescriptions.find(hH=>hH.attributes.mid===iH);if(!lH)throw new Error("Cannot extract ssrc from mediaDescription.");return kSe(lH,_H("USE_PUB_RTX"))}),vN=B.map((iH,lH)=>{const hH=$O[lH];return{localSSRC:TN[lH],id:hH}});yield i6(b.peerConnection.setLocalDescription({type:"offer",sdp:lN}));try{yield vN}catch(iH){const lH=b.remoteSDP.toString();throw yield i6(b.peerConnection.setLocalDescription({type:"offer",sdp:lN})),yield i6(b.peerConnection.setRemoteDescription({type:"answer",sdp:lH})),yield i6(b.stopSending($O,!0)),iH}yield i6(b.applySimulcastEncodings(B,d)),yield i6(b.applySendEncodings(B,d));const uH=b.remoteSDP.toString(),rH=b.logSDPExchange(lN,"offer","local","send");return rH==null||rH(uH),yield i6(b.setRemoteDescription({type:"answer",sdp:uH})),B.map((iH,lH)=>{const hH=$O[lH];return{localSSRC:TN[lH],id:hH}})}catch(B){throw B instanceof jH?B:new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(B.toString()))}finally{k()}})()}async stopSending(d,l){const f=l?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const b=this.peerConnection.getTransceivers().filter($O=>d.indexOf($O.mid)!==-1);if(b.length!==d.length)throw new Error("Transceivers' length (".concat(b.length,") doesn't match mids' length (").concat(d.length,") when trying to call P2PConnection.stopSending."));b.map($O=>{var uN;$O.direction="inactive",(uN=$O.stop)===null||uN===void 0||uN.call($O)});const k=await this.peerConnection.createOffer(),B=this.logSDPExchange(k.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(k),this.remoteSDP.stopReceiving(d);const Wt=this.remoteSDP.toString();B==null||B(Wt),await this.setRemoteDescription({type:"answer",sdp:Wt})}catch(b){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(b.toString()))}finally{f&&f()}}async receive(d,l,f,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(d," before remoteSDP created."));const{mid:k,needExchangeSDP:B}=this.remoteSDP.send(d,l,f,b);if(B){const $O=this.remoteSDP.toString(),uN=this.logSDPExchange($O,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:$O});const lN=await this.peerConnection.createAnswer(),_N=this.mungReceiveAnswerSDP(lN.sdp,k,d);uN==null||uN(_N||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_N}),CN.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(d," by exchanging SDP."))}else CN.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(d," no need to exchange SDP."));const Wt=this.peerConnection.getTransceivers().find($O=>$O.mid===k);if(!Wt||Wt.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:Wt.receiver.track,mid:Wt.mid,transceiver:Wt}}catch(k){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(k.toString()))}}async mockReceive(d,l,f,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(d," before remoteSDP created."));const{mid:k,needExchangeSDP:B}=this.remoteSDP.send(d,l,f,b);if(B){const Wt=this.remoteSDP.toString(),$O=this.logSDPExchange(Wt,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:Wt});const uN=await this.peerConnection.createAnswer(),lN=this.mungReceiveAnswerSDP(uN.sdp,k,d);$O==null||$O(lN||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:lN}),CN.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(d," by exchanging SDP."))}else CN.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(d," no need to exchange SDP."))}catch(k){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(k.toString()))}}async stopReceiving(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(d);const l=this.remoteSDP.toString(),f=this.logSDPExchange(l,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:l});const b=await this.peerConnection.createAnswer();f==null||f(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}}async restartICE(d){try{if(this.store.p2pTransport===mQ.Auto&&(this.store.p2pTransport=mQ.SdRtn,u6().supportPCSetConfiguration&&this.peerConnection.setConfiguration(fee.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,u6().supportPCSetConfiguration&&this.peerConnection.setConfiguration(fee.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!d){this.restartCnt++,this.isReady=!1;const l=await this.peerConnection.createOffer({iceRestart:!0});if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:f}=jX(l.sdp);return this.store.descriptionStart(),this.direction===O4.SEND_ONLY&&await this.peerConnection.setLocalDescription(l),f}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(d),this.store.descriptionStart(),this.direction===O4.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:f}=jX(l.sdp);return await this.peerConnection.setLocalDescription(l),f}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}}close(){var d;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(d=this.onConnectionStateChange)===null||d===void 0||d.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(d){return this.statsFilter.getVideoIsReady(d)}async updateEncoderConfig(d,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const f=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(f.sdp,[l],[d]);this.remoteSDP.updateRecvMedia(d,l);const k=this.remoteSDP.toString(),B=this.logSDPExchange(b,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),B==null||B(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(f){throw new jH(dH.EXCHANGE_SDP_FAILED,f.toString())}}async updateSendParameters(d,l){const f=this.peerConnection.getTransceivers().filter(b=>b.mid===d);f.length===1&&(this.isVP8Simulcast(l)?Z6()||await this.applySimulcastEncodings(f,[l]):await this.applySendEncodings(f,[l]))}setStatsRemoteVideoIsReady(d,l){this.statsFilter.setVideoIsReady2(d,l)}async replaceTrack(d,l){const f=this.peerConnection.getTransceivers().find(b=>b.mid===l);f&&await f.sender.replaceTrack(d._mediaStreamTrack)}async getSelectedCandidatePair(){const d=this.peerConnection.getReceivers();if(d.length>0&&d[0].transport&&d[0].transport.iceTransport&&d[0].transport.iceTransport.getSelectedCandidatePair&&d[0].transport.iceTransport.getSelectedCandidatePair()){const l=d[0].transport.iceTransport,{local:f,remote:b}=l.getSelectedCandidatePair();return{local:QX(QX({},VJ),{},{candidateType:f.type,protocol:f.protocol,address:f.address,port:f.port}),remote:QX(QX({},VJ),{},{candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var d,l;a5(d=["connected","completed"]).call(d,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(l=this.onICEConnectionStateChange)===null||l===void 0||l.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var d;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(d=this.onConnectionStateChange)===null||d===void 0||d.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=d=>{if(d.candidate){var l;d.candidate.candidate&&((l=this.onLocalCandidate)===null||l===void 0||l.call(this,d.candidate.toJSON())),this.localCandidateCount+=1}else CN.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(d,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const b={iceServers:[]};var k;return d.iceServers?b.iceServers=d.iceServers:d.turnServer&&d.turnServer.mode!=="off"&&(mne(d.turnServer.servers)?b.iceServers=d.turnServer.servers:(b.iceServers&&b.iceServers.push(...fee.turnServerConfigToIceServers(d.turnServer.servers,l,f)),_H("USE_TURN_SERVER_OF_GATEWAY")&&b.iceServers&&d.turnServer.serversFromGateway&&b.iceServers.push(...fee.turnServerConfigToIceServers(d.turnServer.serversFromGateway,l,f)),a5(k=[mQ.Relay,mQ.SdRtn]).call(k,l)&&(b.iceTransportPolicy="relay"),_H("FORCE_TURN_TCP")?b.iceTransportPolicy="relay":d.turnServer.servers.concat(d.turnServer.serversFromGateway||[]).forEach(B=>{B.forceturn&&(b.iceTransportPolicy="relay")}))),_H("ENABLE_ENCODED_TRANSFORM")&&u6().supportWebRTCEncodedTransform&&(b.encodedInsertableStreams=!0),CN.debug("P2PConnection p2pTransport is ".concat(l)),b}static turnServerConfigToIceServers(d,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const b=[],k=d.filter(Wt=>Wt.tcpport);CN.debug("P2PConnection turnServers is ".concat(k,", current index is ").concat(f));const B=k.length>f?k[f]:k[0];switch(l){case mQ.SdRtn:const Wt=d.filter(uN=>{var lN;return a5(lN=uN.username).call(lN,"glb:")&&uN.turnServerURL==uN.turnServerURL}),$O=Wt.length>f?Wt[f]:Wt[0];$O&&(b.push({username:$O.username,credential:$O.password,credentialType:"password",urls:"turn:".concat(X$($O.turnServerURL),":").concat($O.tcpport,"?transport=udp")}),b.push({username:$O.username,credential:$O.password,credentialType:"password",urls:"turns:".concat(X$($O.turnServerURL),":").concat($O.tcpport,"?transport=tcp")}));break;case mQ.Relay:B&&(b.push({username:B.username,credential:B.password,credentialType:"password",urls:"turn:".concat(B.turnServerURL,":").concat(B.tcpport,"?transport=udp")}),b.push({username:B.username,credential:B.password,credentialType:"password",urls:"turns:".concat(X$(B.turnServerURL),":").concat(B.tcpport,"?transport=tcp")}));break;default:B&&(b.push({username:B.username,credential:B.password,credentialType:"password",urls:"turn:".concat(B.turnServerURL,":").concat(B.tcpport,"?transport=udp")}),b.push({username:B.username,credential:B.password,credentialType:"password",urls:"turns:".concat(X$(B.turnServerURL),":").concat(B.tcpport,"?transport=tcp")}),b.push({username:B.username,credential:B.password,credentialType:"password",urls:"stun:".concat(B.turnServerURL,":").concat(B.tcpport)}))}return b}tryBindTransportEvents(d){if(d){this.transport=d,d.onstatechange=()=>{var f;d!=null&&d.state&&((f=this.onDTLSTransportStateChange)===null||f===void 0||f.call(this,d.state))},d.onerror=f=>{var b;(b=this.onDTLSTransportError)===null||b===void 0||b.call(this,"error"in f?f.error:f)};const l=d.iceTransport;l&&(l.onstatechange=()=>{const f=d==null?void 0:d.iceTransport.state;var b;f&&((b=this.onICETransportStateChange)===null||b===void 0||b.call(this,f))},l.getSelectedCandidatePair&&(l.onselectedcandidatepairchange=()=>{if(l.getSelectedCandidatePair()){const{local:f,remote:b}=l.getSelectedCandidatePair();CN.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:f.type,protocol:f.protocol}),", remote ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(d,l){var f;if(l||(l=this.peerConnection.getSenders().find(lN=>lN.track===d._mediaStreamTrack)),!l)return CN.warn("[".concat(d.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(d))return CN.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!u6().supportSetRtpSenderParameters)return CN.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const b={},k={};switch(d._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}if(d._encoderConfig){var B;const{bitrateMax:lN,frameRate:_N,scaleResolutionDownBy:TN}=d._encoderConfig;lN&&(k.maxBitrate=1e3*lN),a5(B=d._hints).call(B,O6.LOW_STREAM)&&(_N&&(k.maxFramerate=h8(_N)),TN&&TN>=1&&(k.scaleResolutionDownBy=TN))}if(_H("DSCP_TYPE")&&A7()){var Wt;const lN=_H("DSCP_TYPE");a5(Wt=["very-low","low","medium","high"]).call(Wt,lN)&&(k.networkPriority=lN)}const $O=l.getParameters(),uN=(f=$O.encodings)===null||f===void 0?void 0:f[0];Z6()&&!uN&&(b.encodings=[k]),uN&&Object.assign(uN,k),Object.assign($O,b),CN.debug("[".concat(d.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify($O.encodings))),await l.setParameters($O)}async applySendEncodings(d,l){try{if(!u6().supportSetRtpSenderParameters||d.length!==l.length)return;for(let f=0;f<d.length;f++){const b=d[f],k=l[f];k instanceof x6&&!this.isVP8Simulcast(k)&&await this.updateRtpSenderEncodings(k,b.sender)}}catch{CN.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(d,l,f){const b=$4(d);return l.forEach((k,B)=>{const Wt=f[B],$O=b.mediaDescriptions.find(uN=>uN.attributes.mid===Wt);$O&&(Z$($O,k),xSe($O,k,this.store.codec))}),UX(b)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=d=>{var l;(l=this.onFirstAudioReceived)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstVideoReceived=d=>{var l;(l=this.onFirstVideoReceived)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstAudioDecoded=d=>{var l;(l=this.onFirstAudioDecoded)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstVideoDecoded=(d,l,f)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,d,l,f)},this.statsFilter.onSelectedLocalCandidateChanged=(d,l)=>{var f;(f=this.onSelectedLocalCandidateChanged)===null||f===void 0||f.call(this,d,l)},this.statsFilter.onSelectedRemoteCandidateChanged=(d,l)=>{var f;(f=this.onSelectedRemoteCandidateChanged)===null||f===void 0||f.call(this,d,l)},this.statsFilter.onFirstVideoDecodedTimeout=d=>{var l;(l=this.onFirstVideoDecodedTimeout)===null||l===void 0||l.call(this,d)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(d,l){if(d.length===l.length)for(let $O=0;$O<d.length;$O++){var f,b,k,B,Wt;const uN=d[$O],lN=l[$O];if(lN instanceof x6&&!a5(f=lN._hints).call(f,O6.LOW_STREAM)&&(b=lN._encoderConfig)!==null&&b!==void 0&&b.bitrateMax&&((k=lN._encoderConfig)===null||k===void 0?void 0:k.bitrateMax)>200&&(B=lN._scalabilityMode)!==null&&B!==void 0&&B.numSpatialLayers&&((Wt=lN._scalabilityMode)===null||Wt===void 0?void 0:Wt.numSpatialLayers)>1&&this.store.codec==="vp8"){const _N={},TN={high:1e3*(lN._encoderConfig.bitrateMax-50),medium:5e4};_N.encodings=[{rid:"m",active:!0,maxBitrate:TN.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:TN.high}];const vN=uN.sender.getParameters();await uN.sender.setParameters(Object.assign(vN,_N))}}}async applySimulcastEncodings(d,l){if(!Z6()&&d.length===l.length)for(let f=0;f<d.length;f++){const b=l[f];if(b instanceof x6&&this.isVP8Simulcast(b)){const k=d[f],B={},Wt={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};B.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:Wt.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:Wt.medium,scaleResolutionDownBy:4}];const $O=k.sender.getParameters();await k.sender.setParameters(Object.assign($O,B))}}}isVP8Simulcast(d){var l,f,b,k,B;return!!(d instanceof x6&&_H("SIMULCAST")&&this.store.codec==="vp8"&&!a5(l=d._hints).call(l,O6.LOW_STREAM)&&(f=d._encoderConfig)!==null&&f!==void 0&&f.bitrateMax&&((b=d._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&(k=d._scalabilityMode)!==null&&k!==void 0&&k.numSpatialLayers&&((B=d._scalabilityMode)===null||B===void 0?void 0:B.numSpatialLayers)>1)}logSDPExchange(d,l,f,b){if(_H("SDP_LOGGING"))return CN.upload("[".concat(this.store.clientId,"] exchanging ").concat(f," ").concat(l," SDP during P2PConnection.").concat(b,`
`),d),l==="offer"?k=>{this.logSDPExchange(k,"answer",f==="local"?"remote":"local",b)}:void 0}async muteLocal(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(B=>B.mid&&d.indexOf(B.mid)!==-1);if(l.length!==d.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(B=>{B.direction="inactive"});const f=await this.peerConnection.createOffer(),b=this.logSDPExchange(f.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(f),this.remoteSDP.muteRemote(d);const k=this.remoteSDP.toString();b==null||b(k),await this.setRemoteDescription({type:"answer",sdp:k})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(l.toString()))}}async unmuteLocal(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(B=>B.mid&&d.indexOf(B.mid)!==-1);if(l.length!==d.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(async B=>{B.direction="sendonly"});const f=await this.peerConnection.createOffer(),b=this.logSDPExchange(f.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(f),this.remoteSDP.unmuteRemote(d);const k=this.remoteSDP.toString();b==null||b(k),await this.setRemoteDescription({type:"answer",sdp:k})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(l.toString()))}}async getRemoteSSRC(d,l){var f,b;if(l=(f=l)!==null&&f!==void 0?f:(b=this.currentRemoteDescription)===null||b===void 0?void 0:b.sdp){var k;const B=(k=$4(l).mediaDescriptions.find(Wt=>Wt.attributes.mid===d))===null||k===void 0?void 0:k.attributes.ssrcs;return B==null?void 0:B[0].ssrcId}}async setRemoteDescription(d){var l;await this.peerConnection.setRemoteDescription(d),a5(l=["connected","completed"]).call(l,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(d,l,f){const b=$4(d),k=b.mediaDescriptions.find(B=>B.attributes.mid===l);return k&&f===_5.AUDIO&&k.media.mediaType==="audio"&&$$(k),UX(b)}},m5(k6.prototype,"establish",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"establish"),k6.prototype),m5(k6.prototype,"connect",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"connect"),k6.prototype),m5(k6.prototype,"receive",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"receive"),k6.prototype),m5(k6.prototype,"mockReceive",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"mockReceive"),k6.prototype),m5(k6.prototype,"stopReceiving",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"stopReceiving"),k6.prototype),m5(k6.prototype,"restartICE",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"restartICE"),k6.prototype),m5(k6.prototype,"close",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"close"),k6.prototype),m5(k6.prototype,"updateEncoderConfig",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"updateEncoderConfig"),k6.prototype),m5(k6.prototype,"updateSendParameters",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"updateSendParameters"),k6.prototype),m5(k6.prototype,"replaceTrack",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"replaceTrack"),k6.prototype),m5(k6.prototype,"muteLocal",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"muteLocal"),k6.prototype),m5(k6.prototype,"unmuteLocal",[wY],Object.getOwnPropertyDescriptor(k6.prototype,"unmuteLocal"),k6.prototype),k6);function wY(s,d,l){const f=s[d];if(typeof f!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const b=this.mutex,k=await b.lock("From P2PConnection.".concat(d));try{for(var B=arguments.length,Wt=new Array(B),$O=0;$O<B;$O++)Wt[$O]=arguments[$O];return await f.apply(this,Wt)}finally{k()}},l}let sJ=function(s){return s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY",s}({});var Zbe,$be,eve,tve,nve,rve,ive,sve,ove,ave,cve,G6;function uve(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function aae(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?uve(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):uve(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}let tMe=(Zbe=oJ(sJ.SEND_ONLY),$be=oJ(sJ.SEND_ONLY),eve=oJ(),tve=oJ(sJ.RECEIVE_ONLY),nve=oJ(sJ.RECEIVE_ONLY),rve=oJ(sJ.RECEIVE_ONLY),ive=oJ(sJ.RECEIVE_ONLY),sve=oJ(sJ.RECEIVE_ONLY),ove=oJ(sJ.RECEIVE_ONLY),ave=oJ(),cve=oJ(sJ.RECEIVE_ONLY),G6=class extends W6{get state(){return this._state}set state(s){const d=this._state;this._state=s,this.emit(v5.StateChange,d,this._state)}constructor(s,d){super(),cH(this,"isPlanB",!1),cH(this,"store",void 0),cH(this,"statsUploader",void 0),cH(this,"sendConnection",void 0),cH(this,"recvConnection",void 0),cH(this,"localTrackMap",new Map),cH(this,"remoteUserMap",new Map),cH(this,"localDataChannels",[]),cH(this,"pendingLocalTracks",[]),cH(this,"pendingRemoteTracks",[]),cH(this,"statsCollector",void 0),cH(this,"dtlsFailedCount",0),cH(this,"sendMutex",void 0),cH(this,"recvMutex",void 0),cH(this,"_state",E6.Disconnected),cH(this,"_restartStates",["disconnected","failed"]),cH(this,"reconnectInterval",void 0),cH(this,"uploadUnplinkStarted",!1),cH(this,"uploadDownlinkStarted",!1),cH(this,"uplinkStateUploadInterval",void 0),cH(this,"downlinkStatsUploadInterval",void 0),cH(this,"handleMuteLocalTrack",async(l,f,b)=>{const k=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==E6.Connected)return void b(new jH(dH.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const $O=this.filterTobeMutedTracks(l);if($O.length===0)return void f();const uN=$O.find(vN=>vN[0]==="videoLowTrack");uN&&uN[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal($O.map(vN=>{let[,{id:uH}]=vN;return uH}));let lN=!1;var B,Wt;l.trackMediaType==="video"?lN=!((B=this.localTrackMap.get(JH.LocalAudioTrack))===null||B===void 0||!B.track._muted):lN=((Wt=this.localTrackMap.get(JH.LocalVideoTrack))===null||Wt===void 0?void 0:Wt.id)===void 0;const _N=this.createMuteMessage($O);await w6(this,v5.RequestMuteLocal,_N);const TN=l.trackMediaType==="video"?VX.MUTE_LOCAL_VIDEO:VX.MUTE_LOCAL_AUDIO;await w6(this,v5.RequestP2PMuteLocal,{action:TN,message:_N,isMuteAll:lN}),f()}catch($O){b($O)}finally{k()}}),cH(this,"handleUnmuteLocalTrack",async(l,f,b)=>{const k=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==E6.Connected)return void b(new jH(dH.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const B=this.filterTobeUnmutedTracks(l);if(B.length===0)return void f();await this.sendConnection.unmuteLocal(B.map(uN=>{let[,{id:lN}]=uN;return lN}));const Wt=this.createUnmuteMessage(B),$O=l.trackMediaType==="video"?VX.UNMUTE_LOCAL_VIDEO:VX.UNMUTE_LOCAL_AUDIO;await w6(this,v5.RequestP2PMuteLocal,{action:$O,message:Wt}),f()}catch(B){b(B)}finally{k()}}),cH(this,"handleUpdateVideoEncoder",async(l,f,b,k)=>{let B;typeof k=="boolean"&&k||(B=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const $O=this.localTrackMap.get(JH.LocalVideoTrack);if(!this.sendConnection||!$O||$O.track!==l||this.state!==E6.Connected)return void f();const{id:uN,track:lN}=$O;uN&&(await this.sendConnection.updateSendParameters(uN,lN),await this.sendConnection.updateEncoderConfig(uN,lN),this.emit(v5.UpdateVideoEncoder,lN)),f()}catch($O){b($O)}finally{var Wt;(Wt=B)===null||Wt===void 0||Wt()}}),cH(this,"handleUpdateVideoSendParameters",async(l,f,b)=>{const k=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const B=this.localTrackMap.get(JH.LocalVideoTrack);if(!this.sendConnection||!B||B.track!==l||this.state!==E6.Connected)return void f();const{id:Wt,track:$O}=B;Wt&&await this.sendConnection.updateSendParameters(Wt,$O),f()}catch(B){b(B)}finally{k()}}),cH(this,"handleReplaceTrack",async(l,f,b,k)=>{let B;CN.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),typeof k=="boolean"&&k||(B=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var Wt;const uN=Array.from(this.localTrackMap.entries()).find(lN=>{let[,{track:_N}]=lN;return l===_N});if(!this.sendConnection||!uN||uN[1].id===void 0||this.state!==E6.Connected)return void f();if(await((Wt=this.sendConnection)===null||Wt===void 0?void 0:Wt.replaceTrack(l,uN[1].id)),uN[0]===JH.LocalVideoTrack&&u6().supportDualStreamEncoding){const lN=this.localTrackMap.get(JH.LocalVideoLowTrack);if(lN){const _N=l._mediaStreamTrack.clone();lN.track._originMediaStreamTrack.stop(),lN.track._mediaStreamTrack=_N,lN.track._originMediaStreamTrack=_N,await new u5((TN,vN)=>{this.handleReplaceTrack(lN.track,TN,vN,!0)})}}f()}catch(uN){b(uN)}finally{var $O;($O=B)===null||$O===void 0||$O()}}),cH(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),cH(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),cH(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),cH(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=s,this.statsCollector=d,this.statsCollector.addP2PChannel(this),this.statsUploader=new vye(s),this.bindStatsUploaderEvents(),this.sendMutex=new t4("P2PChannel2-send-mutex",s.clientId),this.recvMutex=new t4("P2PChannel2-recv-mutex",s.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(l=>{l&&(l.iceConnectionState!=="disconnected"&&l.iceConnectionState!=="failed"||this.handleDisconnect(l.direction))})},_H("ICE_RESTART_INTERVAL"))}async startP2PConnection(s,d){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(s){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(s,d){let l;try{if(d){this.recvConnection&&(CN.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),l=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Qbe(s,this.store,O4.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const f=await this.recvConnection.establish(d);return{iceParameters:f.iceParameters,dtlsParameters:f.dtlsParameters,sdp:f.sdp}}{this.state=E6.New,this.sendConnection&&(CN.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),l=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Qbe(s,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const f=await this.sendConnection.establish();return{iceParameters:f.iceParameters,dtlsParameters:f.dtlsParameters,sdp:f.sdp}}}finally{l&&l()}}async p2pConnect(s){if(!this.sendConnection)throw new jH(dH.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(s),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=E6.Connected}async addRemoteCandidate(s,d){if(d===O4.RECEIVE_ONLY){if(!this.sendConnection)throw new jH(dH.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(s)}else{if(!this.recvConnection)throw new jH(dH.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(s)}}publish(s,d,l){var f=this;return H8(function*(){const b=yield i6(f.sendMutex.lock("From P2PChannel.publish"));try{if(!f.sendConnection||f.state!==E6.Connected){f.throwIfTrackTypeNotMatch(s);const uN=s.filter(lN=>f.pendingLocalTracks.indexOf(lN)===-1);return void(f.pendingLocalTracks=f.pendingLocalTracks.concat(uN))}f.store.pubId=f.store.pubId+1,r4.markPublishStart(f.store.clientId,f.store.pubId);const k=f.filterTobePublishedTracks(s,d,l);if(k.length===0)return void(yield i6(f.tryToUnmuteAudio(s)));k.forEach(uN=>{let{track:lN,type:_N}=uN;const TN=Date.now();f.store.publish(lN.getTrackId(),_N===JH.LocalAudioTrack?"audio":"video",TN)}),f.bindLocalTrackEvents(k);const B=yield i6(f.sendConnection.send(k.map(uN=>{let{track:lN}=uN;return lN}),f.store.codec,f.store.audioCodec)),Wt=(yield i6(B.next())).value,$O=f.createGatewayPublishMessage(k,Wt);try{yield $O}catch(uN){throw B.throw(uN),(uN==null?void 0:uN.code)===dH.WS_ABORT&&k.forEach(lN=>{let{track:_N}=lN;f.pendingLocalTracks.indexOf(_N)===-1&&f.pendingLocalTracks.push(_N)}),f.unbindLocalTrackEvents(k),uN}yield i6(B.next()),k.forEach(uN=>{let{type:lN}=uN;f.statsCollector.addLocalStats(lN)}),f.statsUploader.startUploadOutboundStats(),f.assignLocalTracks(k,Wt),k.forEach(uN=>{let{track:lN,type:_N}=uN;const TN=Date.now();f.store.publish(lN.getTrackId(),_N===JH.LocalAudioTrack?"audio":"video",void 0,TN)}),f.startUploadUplinkState()}finally{b()}})()}async unpublish(s){if(!this.sendConnection||this.state!==E6.Connected)return void(s.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(b=>!a5(s).call(s,b)));const d=this.filterTobeUnpublishedTracks(s);if(d.length===0)return;const l=d.find(b=>b[0]==="videoLowTrack");l&&l[1].track.close();const f=this.createGatewayUnpublishMessage(d);if(await this.sendConnection.stopSending(d.map(b=>{let[,{id:k}]=b;return k})),this.withdrawLocalTracks(d),this.unbindLocalTrackEvents(d.map(b=>{let[k,{track:B}]=b;return{type:k,track:B}})),d.forEach(b=>{let[k]=b;this.statsCollector.removeLocalStats(k)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===E6.Connected)return l&&l[1].track.close(),f;s.forEach(b=>{const k=this.pendingLocalTracks.indexOf(b);k!==-1&&this.pendingLocalTracks.splice(k,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const s=()=>{const d=[],l=[];Array.from(this.localTrackMap.entries()).forEach(f=>{let[b,{track:k,ssrcs:B}]=f;const Wt={stream_type:Zke(k,b),ssrcs:B};k._muted||!k._enabled?d.push(Wt):l.push(Wt)}),d.length>0&&d.forEach(f=>{w6(this,v5.RequestMuteLocal,[f])}),l.length>0&&l.forEach(f=>{w6(this,v5.RequestUnmuteLocal,[f])})};s(),this.uplinkStateUploadInterval=window.setInterval(()=>{s()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(s){return H8(function*(){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(CN.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await YK(this,v5.RequestRePublish,this.pendingLocalTracks),this.emit(v5.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(s,d,l,f){var b;if(!this.recvConnection)throw new jH(dH.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((b=this.remoteUserMap.get(s))!==null&&b!==void 0&&b.has(d))return;const{track:k,mid:B,transceiver:Wt}=await this.recvConnection.receive(d,[{ssrcId:l}],String(s.uid),f);d===_5.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(k):(s._audioTrack=new G$(k,s.uid,s._uintid,this.store),CN.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),Wt&&s._audioTrack._updateRtpTransceiver(Wt),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoSSRC=l,s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(k):(s._videoTrack=new B$(k,s.uid,s._uintid,this.store),CN.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),Wt&&s._videoTrack._updateRtpTransceiver(Wt),this.bindRemoteTrackEvents(s,s._videoTrack));const $O=this.remoteUserMap.get(s);$O?$O.set(d,B):this.remoteUserMap.set(s,new Map([[d,B]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const uN=this.pendingRemoteTracks.findIndex(lN=>{let{user:_N,kind:TN}=lN;return _N.uid===s.uid&&d===TN});uN!==-1&&(this.pendingRemoteTracks.splice(uN,1),this.emit(v5.MediaReconnectEnd,s.uid))}async mockSubscribe(s,d,l,f){if(!this.recvConnection)throw new jH(dH.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(d,[{ssrcId:l}],String(s.uid),f)}async unsubscribe(s,d,l){const f=this.pendingRemoteTracks.filter(k=>{let{user:B,kind:Wt}=k;return d!==void 0?B.uid===s.uid&&d===Wt:B.uid===s.uid});if(f.forEach(k=>{const B=this.pendingRemoteTracks.indexOf(k);this.pendingRemoteTracks.splice(B,1)}),this.recvConnection||l||f.forEach(k=>{let{kind:B}=k;var Wt;if(B===_5.AUDIO)(Wt=s._audioTrack)===null||Wt===void 0||Wt._destroy(),s._audioTrack=void 0;else if(B===_5.VIDEO){var $O;($O=s._videoTrack)===null||$O===void 0||$O._destroy(),s._videoTrack=void 0}}),!this.recvConnection)return;const b=this.filterTobeUnSubscribedTracks(s,d);b.length!==0&&(await this.recvConnection.stopReceiving(b.map(k=>{let[,{id:B}]=k;return B})),this.withdrawRemoteTracks(b),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),b.forEach(k=>{let[B,{kind:Wt}]=k;var $O,uN;if(Wt===_5.VIDEO&&B._videoSSRC&&(($O=this.recvConnection)===null||$O===void 0||$O.setStatsRemoteVideoIsReady(B._videoSSRC,!1)),Wt===_5.VIDEO)this.unbindRemoteTrackEvents(B._videoTrack),l||((uN=B._videoTrack)===null||uN===void 0||uN._destroy(),B._videoTrack=void 0);else if(Wt===_5.AUDIO){var lN;this.unbindRemoteTrackEvents(B._audioTrack),!l&&((lN=B._audioTrack)===null||lN===void 0||lN._destroy(),B._audioTrack=void 0)}}),b.forEach(k=>{let[,{kind:B}]=k;w6(this,v5.RequestP2PMuteRemote,B)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const s=()=>Array.from(this.remoteUserMap.entries()).forEach(d=>{let[,l]=d;[_5.VIDEO,_5.AUDIO].forEach(f=>{l.has(f)?w6(this,v5.RequestP2PUnmuteRemote,f):w6(this,v5.RequestP2PMuteRemote,f)})});s(),this.downlinkStatsUploadInterval=window.setInterval(()=>{s()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(s){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(s){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(s){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(s){throw new jH(dH.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(s,d){if(!this.recvConnection)return;const l=this.remoteUserMap.get(s);if(!l)return void CN.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(s.uid,"."));if(!l.get(d))return void CN.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(s.uid," media type ").concat(d,"."));const f=d===_5.VIDEO?s._videoSSRC:s._audioSSRC;f!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(f,!1)}async unmuteRemote(s,d){return this.unmuteRemoteNoLock(s,d)}async unmuteRemoteNoLock(s,d){if(!this.recvConnection)return;const l=this.remoteUserMap.get(s);if(!l)return void CN.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(s.uid,"."));l.get(d)||CN.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(s.uid," media type ").concat(d,"."))}getAllTracks(s){const d=this.localTrackMap.get(JH.LocalAudioTrack);if((d==null?void 0:d.track)instanceof SK){const l=d.track;return Array.from(this.localTrackMap.entries()).filter(f=>{let[b]=f;return b!==JH.LocalAudioTrack}).filter(f=>{let[b]=f;return!(s&&b===JH.LocalVideoLowTrack)}).map(f=>{let[,{track:b}]=f;return b}).concat(l.trackList)}return Array.from(this.localTrackMap.entries()).filter(l=>{let[f]=l;return!(s&&f===JH.LocalVideoLowTrack)}).map(l=>{let[,{track:f}]=l;return f})}reportPublishEvent(s,d,l,f,b){if(s){const B=this.localTrackMap.get(JH.LocalAudioTrack),Wt=f?this.localTrackMap.get(JH.LocalVideoLowTrack):this.localTrackMap.get(JH.LocalVideoTrack);T5.publish(this.store.sessionId,{eventElapse:r4.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:s,ec:d,audioName:B==null?void 0:B.track.getTrackLabel(),videoName:Wt==null?void 0:Wt.track.getTrackLabel(),screenshare:(Wt==null?void 0:Wt.track._hints.indexOf(O6.SCREEN_TRACK))!==-1,audio:!!B,video:!!Wt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}else{var k;l||(l=[]);const B=l.find($O=>$O instanceof _q),Wt=f?(k=this.localTrackMap.get(JH.LocalVideoTrack))===null||k===void 0?void 0:k.track:l.find($O=>$O instanceof x6);T5.publish(this.store.sessionId,{eventElapse:r4.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:s,ec:d,audioName:B==null?void 0:B.getTrackLabel(),videoName:Wt==null?void 0:Wt.getTrackLabel(),screenshare:(Wt==null?void 0:Wt._hints.indexOf(O6.SCREEN_TRACK))!==-1,audio:!!B,video:!!Wt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}}reportSubscribeEvent(s,d,l,f){const b=f===_5.VIDEO?l._videoSSRC:l._audioSSRC;b&&T5.subscribe(this.store.sessionId,{succ:s,ec:d,video:f===_5.VIDEO,audio:f===_5.AUDIO,peerid:l.uid,subscribeRequestid:f===_5.VIDEO?l._videoSSRC:l._audioSSRC,p2pid:this.store.p2pId,eventElapse:r4.measureFromSubscribeStart(this.store.clientId,b)})}reset(){CN.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new t4("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new t4("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const s=this.localTrackMap.get(JH.LocalAudioTrack);if((s==null?void 0:s.track)instanceof SK){if(s.track.trackList.length>0){const d=s.track;s.track.trackList.forEach(l=>{d.removeAudioTrack(l)})}s.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=E6.Disconnected}getStats(s){var d,l;return s?(l=this.recvConnection)===null||l===void 0?void 0:l.getStats():(d=this.sendConnection)===null||d===void 0?void 0:d.getStats()}getRemoteVideoIsReady(s){var d;return((d=this.recvConnection)===null||d===void 0?void 0:d.getRemoteVideoIsReady(s))||!1}getLocalAudioVolume(){const s=this.localTrackMap.get(JH.LocalAudioTrack);if(s)return s.track.getVolumeLevel()}getLocalVideoSize(){const s=this.localTrackMap.get(JH.LocalVideoTrack);if(s)return{width:s.track.videoWidth||0,height:s.track.videoHeight||0}}getEncoderConfig(s){const d=this.localTrackMap.get(s);return d&&d.track instanceof x6||d&&d.track instanceof _q?d.track._encoderConfig:void 0}getLocalMedia(s){return this.localTrackMap.get(s)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(s,d){if(!s)return this.remoteUserMap.size>0;const l=this.remoteUserMap.get(s);return!!l&&(!d||l.has(d))}async hasRemoteMediaWithLock(s,d){if(!s)return this.remoteUserMap.size>0;const l=this.remoteUserMap.get(s);return!!l&&(!d||l.has(d))}getRemoteMedia(s){var d;const l=Array.from(v8(d=this.remoteUserMap).call(d)).find(f=>f.uid===s);return l?{audioTrack:l.audioTrack,audioSSRC:l._audioSSRC,videoTrack:l.videoTrack,videoSSRC:l._videoSSRC}:{}}getAudioLevels(){let s=Array.from(this.remoteUserMap.entries()).map(l=>{let[f]=l;return{uid:f.uid,level:f.audioTrack?100*f.audioTrack._source.getAccurateVolumeLevel():0}});const d=this.localTrackMap.get(JH.LocalAudioTrack);return d&&s.push({level:100*d.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),s=nne(s).call(s,(l,f)=>l.level-f.level),s}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(CN.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=E6.Reconnecting,_H("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(s=>{let[d]=s;var l;d._videoTrack&&d._videoTrack._player&&((l=d._videoTrack._player.getVideoElement())===null||l===void 0||l.pause(),d._videoTrack._player.isKeepLastFrame=!0,d._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(s=>{var d;let[l,{track:f}]=s;switch(l){case JH.LocalVideoTrack:a5(d=f._hints).call(d,O6.LOW_STREAM)?f.close():this.pendingLocalTracks.push(f);break;case JH.LocalAudioTrack:f instanceof SK?this.pendingLocalTracks=this.pendingLocalTracks.concat(f.trackList):this.pendingLocalTracks.push(f);case JH.LocalVideoLowTrack:}}),this.emit(v5.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(s=>{let[d,l]=s;Array.from(v8(l).call(l)).forEach(f=>{this.setPendingRemoteMedia(d,f)}),this.emit(v5.MediaReconnectStart,d.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),CN.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(s,d){for(const l of this.pendingRemoteTracks){const{user:f,kind:b}=l;if((s instanceof GX?s.uid:s)===f.uid&&d===b)return!0}return!1}setPendingRemoteMedia(s,d){this.hasPendingRemoteMedia(s,d)||this.pendingRemoteTracks.push({user:s,kind:d})}async restartICE(s,d){let l,f;if(s===O4.SEND_ONLY){if(!this.sendConnection)throw new jH(dH.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");l=await this.sendMutex.lock("From P2PChannel.restartICE"),f=this.sendConnection}else{if(!this.recvConnection)throw new jH(dH.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");l=await this.recvMutex.lock("From P2PChannel.restartICE"),f=this.recvConnection}try{if(d){const b=await f.restartICE(d);return f.isInRestartIce=!1,b}{const b=await f.restartICE();if(b){const k=await YK(this,v5.RequestP2PRestartICE,{direction:O4.RECEIVE_ONLY,iceParameter:b});await f.restartICE(k),f.isInRestartIce=!1}}}finally{l()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const s=this.sendConnection.getStats(),d=this.localTrackMap.get(JH.LocalVideoTrack),l=this.localTrackMap.get(JH.LocalAudioTrack),f=s.videoSend.find(vN=>{var uH;return vN.ssrc===(d==null||(uH=d.ssrcs)===null||uH===void 0?void 0:uH[0].ssrcId)}),b=s.audioSend.find(vN=>{var uH;return vN.ssrc===(l==null||(uH=l.ssrcs)===null||uH===void 0?void 0:uH[0].ssrcId)});if(!f||!b)return 1;const k=R8(this,v5.NeedSignalRTT),B=f?f.rttMs:void 0,Wt=b?b.rttMs:void 0,$O=B&&Wt?(B+Wt)/2:B||Wt,uN=($O&&k?($O+k)/2:$O||k)||0,lN=100*s.sendPacketLossRate*.7/50+.3*uN/1500,_N=lN<.17?1:lN<.36?2:lN<.59?3:lN<.1?4:5,TN=d==null?void 0:d.track;if(TN&&TN._encoderConfig&&TN._hints.indexOf(O6.SCREEN_TRACK)===-1){const vN=TN._encoderConfig.bitrateMax,uH=s.bitrate.actualEncoded;if(vN&&uH){const rH=(1e3*vN-uH)/(1e3*vN);return cSe[rH<.15?0:rH<.3?1:rH<.45?2:rH<.6?3:4][_N]}}return _N}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const s=this.recvConnection.getStats();let d=0;return Array.from(this.remoteUserMap.entries()).forEach(l=>{let[f]=l;const b=f._audioSSRC,k=f._videoSSRC,B=s.audioRecv.find(uH=>uH.ssrc===b),Wt=s.videoRecv.find(uH=>uH.ssrc===k);if(!B&&!Wt)return void(d+=1);const $O=R8(this,v5.NeedSignalRTT),uN=s.rtt,lN=(uN&&$O?(uN+$O)/2:uN||$O)||0,_N=B?B.jitterMs:void 0,TN=s.recvPacketLossRate;let vN=.7*TN*100/50+.3*lN/1500;_N&&(vN=.6*TN*100/50+.2*lN/1500+.2*_N/400),d+=vN<.1?1:vN<.17?2:vN<.36?3:vN<.59?4:5}),this.remoteUserMap.size>0?Math.round(d/this.remoteUserMap.size):d}async muteLocalTrack(s){return new u5((d,l)=>{this.handleMuteLocalTrack(s,d,l)})}filterTobePublishedTracks(s,d,l){const f=[],b=u6(),k=this.getAllTracks();s=O$(s=s.filter($O=>k.indexOf($O)===-1));let B=!1,Wt=!1;for(const $O of s){if($O instanceof x6&&(this.localTrackMap.has(JH.LocalVideoTrack)||B?new jH(dH.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(f.push({track:$O,type:JH.LocalVideoTrack}),B=!0),d)){const uN=this.getLowVideoTrack($O,l);f.push({track:uN,type:JH.LocalVideoLowTrack})}if($O instanceof _q){const uN=this.localTrackMap.get(JH.LocalAudioTrack);if(uN){if(!(uN.track instanceof SK))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if($O._bypassWebAudio)throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");uN.track.addAudioTrack($O),this.bindLocalAudioTrackEvents($O,!0)}else if(Wt){const lN=f.find(_N=>{let{type:TN}=_N;return TN===JH.LocalAudioTrack});if(!(lN.track instanceof SK))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if($O._bypassWebAudio)throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");lN.track.addAudioTrack($O)}else{if(!b.webAudioMediaStreamDest||$O instanceof SK||$O._bypassWebAudio)f.push({track:$O,type:JH.LocalAudioTrack});else{const lN=new SK;lN.addAudioTrack($O),f.push({track:lN,type:JH.LocalAudioTrack})}Wt=!0}}}return f}filterTobeUnpublishedTracks(s){const d=[],l=this.getAllTracks();s=O$(s=s.filter(f=>l.indexOf(f)!==-1));for(const f of s){if(f instanceof _q){const b=this.localTrackMap.get(JH.LocalAudioTrack);if(!b)continue;b.track instanceof SK?(b.track.removeAudioTrack(f),this.unbindLocalAudioTrackEvents(f),b.track.trackList.length===0&&(d.push([JH.LocalAudioTrack,b]),b.track.close())):d.push([JH.LocalAudioTrack,b])}if(f instanceof x6){const b=this.localTrackMap.get(JH.LocalVideoTrack);if(!b)continue;d.push([JH.LocalVideoTrack,b]);const k=this.localTrackMap.get(JH.LocalVideoLowTrack);k&&d.push([JH.LocalVideoLowTrack,k])}}return d}bindLocalTrackEvents(s){s.forEach(d=>{let{track:l,type:f}=d;switch(f){case JH.LocalVideoTrack:l.addListener(E5.GET_STATS,this.handleGetLocalVideoStats),l.addListener(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.addListener(E5.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.addListener(E5.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),l.addListener(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.addListener(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case JH.LocalAudioTrack:this.bindLocalAudioTrackEvents(l);case JH.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(s,d){s instanceof SK?s.trackList.forEach(l=>{l.addListener(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.addListener(E5.GET_STATS,this.handleGetLocalAudioStats),l.addListener(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.addListener(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(s.addListener(E5.GET_STATS,this.handleGetLocalAudioStats),s.addListener(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),d||s.addListener(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(s){s||(s=Array.from(this.localTrackMap.entries()).map(d=>{let[l,{track:f}]=d;return{track:f,type:l}})),s.forEach(d=>{let{track:l,type:f}=d;switch(f){case JH.LocalVideoTrack:l.off(E5.GET_STATS,this.handleGetLocalVideoStats),l.off(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.off(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.off(E5.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.off(E5.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),l.off(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.off(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.off(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case JH.LocalAudioTrack:this.unbindLocalAudioTrackEvents(l);case JH.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(s){s instanceof SK?s.trackList.forEach(d=>{d.off(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.off(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.off(E5.GET_STATS,this.handleGetLocalAudioStats),d.off(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.off(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(s.off(E5.GET_STATS,this.handleGetLocalAudioStats),s.off(E5.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(E5.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(E5.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(E5.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(E5.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(s,d){d instanceof B$&&d.addListener(E5.GET_STATS,l=>{l(this.handleGetRemoteVideoStats(s))}),d instanceof G$&&d.addListener(E5.GET_STATS,l=>{l(this.handleGetRemoteAudioStats(s))})}unbindRemoteTrackEvents(s){s&&s.removeAllListeners(E5.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(s=>{let[d,l]=s;l.has(_5.AUDIO)&&this.unbindRemoteTrackEvents(d._audioTrack),l.has(_5.VIDEO)&&this.unbindRemoteTrackEvents(d._videoTrack)})}createGatewayPublishMessage(s,d){return s.map((l,f)=>{var b;let k,{track:B,type:Wt}=l;switch(Wt){case JH.LocalAudioTrack:k=m6.Audio;break;case JH.LocalVideoTrack:k=a5(b=B._hints).call(b,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalVideoLowTrack:k=m6.Low}return{kind:Wt===JH.LocalAudioTrack?_5.AUDIO:_5.VIDEO,stream_type:k,mid:d[f].id,ssrcs:d[f].localSSRC,isMuted:B.muted||!B.enabled}})}createGatewayUnpublishMessage(s){return s.map(d=>{var l;let f,[b,{track:k,ssrcs:B,id:Wt}]=d;switch(b){case JH.LocalVideoTrack:f=a5(l=k._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoLowTrack:f=m6.Low}return{stream_type:f,ssrcs:B,mid:Wt}})}assignLocalTracks(s,d){s.forEach((l,f)=>{let{track:b,type:k}=l;this.localTrackMap.set(k,{track:b,id:d[f].id,ssrcs:d[f].localSSRC})})}withdrawLocalTracks(s){s.forEach(d=>{let[l]=d;this.localTrackMap.delete(l)})}bindConnectionEvents(s){s.onConnectionStateChange=async d=>{var l;CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(s.name,".onConnectionStateChange(").concat(d,")")),this.emit(v5.PeerConnectionStateChange,d),d!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),d==="connected"&&(s.isInRestartIce=!1),a5(l=this._restartStates).call(l,d)&&!s.isInRestartIce&&(d==="disconnected"&&await BK(800),s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))},s.onICEConnectionStateChange=d=>{d!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(d,")")),T5.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:d,tag:Y6.TRACER}).onSuccess(),this.emit(v5.IceConnectionStateChange,d)},s.onICETransportStateChange=d=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(d,")"))},s.onDTLSTransportStateChange=d=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(d,")"))},s.onDTLSTransportError=d=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(d,")"))},s.onFirstAudioDecoded=d=>{var l;const f=Array.from(v8(l=this.remoteUserMap).call(l)).find(k=>k._audioSSRC===d);var b;f&&(this.store.subscribe(f.uid,"audio",void 0,void 0,void 0,Date.now()),(b=f.audioTrack)===null||b===void 0||b.emit(U$.FIRST_FRAME_DECODED),T5.firstRemoteFrame(this.store.sessionId,OK.FIRST_AUDIO_DECODE,j6.FIRST_AUDIO_DECODE,{peer:f._uintid,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,d),subscribeRequestid:d,p2pid:this.store.p2pId}))},s.onFirstAudioReceived=d=>{var l;const f=Array.from(v8(l=this.remoteUserMap).call(l)).find(b=>b._audioSSRC===d);f&&T5.firstRemoteFrame(this.store.sessionId,OK.FIRST_AUDIO_RECEIVED,j6.FIRST_AUDIO_RECEIVED,{peer:f._uintid,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,d),subscribeRequestid:d,p2pid:this.store.p2pId})},s.onFirstVideoDecoded=(d,l,f)=>{this.reportVideoFirstFrameDecoded(d,l,f)},s.onFirstVideoReceived=d=>{var l;const f=Array.from(v8(l=this.remoteUserMap).call(l)).find(b=>b._videoSSRC===d);f&&T5.firstRemoteFrame(this.store.sessionId,OK.FIRST_VIDEO_RECEIVED,j6.FIRST_VIDEO_RECEIVED,{peer:f._uintid,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,d),subscribeRequestid:d,p2pid:this.store.p2pId})},s.onSelectedLocalCandidateChanged=(d,l)=>{const f=d.candidateType==="relay",b=l.candidateType==="relay";l.candidateType!=="unknown"&&f===b||this.emit(v5.ConnectionTypeChange,f),CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(FX(l))," -> ").concat(JSON.stringify(FX(d)),")"))},s.onSelectedRemoteCandidateChanged=(d,l)=>{CN.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(FX(l))," -> ").concat(JSON.stringify(FX(d)),")"))},s.onFirstVideoDecodedTimeout=d=>{this.reportVideoFirstFrameDecoded(d,void 0,void 0,!0)},s.onLocalCandidate=d=>{this.emit(v5.LocalCandidate,{candidate:d,direction:s.direction})}}unbindConnectionEvents(s){s.onConnectionStateChange=void 0,s.onICEConnectionStateChange=void 0,s.onICETransportStateChange=void 0,s.onDTLSTransportStateChange=void 0,s.onDTLSTransportError=void 0,s.onFirstAudioDecoded=void 0,s.onFirstAudioReceived=void 0,s.onFirstVideoDecoded=void 0,s.onFirstVideoReceived=void 0,s.onSelectedLocalCandidateChanged=void 0,s.onSelectedRemoteCandidateChanged=void 0,s.onFirstVideoDecodedTimeout=void 0,s.onLocalCandidate=void 0}async handleDisconnect(s){const d=s===O4.SEND_ONLY?this.sendConnection:this.recvConnection;d&&!d.isInRestartIce&&(d.isInRestartIce=!0,CN.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(d.name,"] start use restartICE")),s===O4.SEND_ONLY?this.restartICE(s):YK(this,v5.RequestP2PRestartICE,{direction:O4.SEND_ONLY}))}filterTobeMutedTracks(s){const d=[];if(this.getAllTracks().indexOf(s)===-1)return d;const l=this.localTrackMap.get(JH.LocalAudioTrack);if(s instanceof _q&&(l==null?void 0:l.track)instanceof SK)return l.track.isActive||d.push([JH.LocalAudioTrack,l]),d;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:k}]=b;return s===k});if(f&&(d.push(f),f[0]===JH.LocalVideoTrack)){const b=this.localTrackMap.get(JH.LocalVideoLowTrack);b&&d.push([JH.LocalVideoLowTrack,b])}return d}filterTobeUnmutedTracks(s){const d=[],l=this.localTrackMap.get(JH.LocalAudioTrack);if(s instanceof _q&&(l==null?void 0:l.track)instanceof SK)return l.track.isActive&&d.push([JH.LocalAudioTrack,l]),d;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:k}]=b;return s===k});if(f)if(f[0]===JH.LocalVideoTrack){d.push(f);const b=this.localTrackMap.get(JH.LocalVideoLowTrack);b&&d.push([JH.LocalVideoLowTrack,b])}else d.push(f);return d}createMuteMessage(s){return s.map(d=>{var l;let f,[b,{track:k,ssrcs:B,id:Wt}]=d;switch(b){case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoTrack:f=a5(l=k._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalVideoLowTrack:f=m6.Low}return{stream_type:f,ssrcs:B,mid:Wt}})}createUnmuteMessage(s){return s.map(d=>{var l;let f,[b,{track:k,ssrcs:B,id:Wt}]=d;switch(b){case JH.LocalAudioTrack:f=m6.Audio;break;case JH.LocalVideoTrack:f=a5(l=k._hints).call(l,O6.SCREEN_TRACK)?m6.Screen:m6.High;break;case JH.LocalVideoLowTrack:f=m6.Low}return{stream_type:f,ssrcs:B,mid:Wt}})}filterTobeUnSubscribedTracks(s,d){const l=[],f=this.remoteUserMap.get(s);if(!f)return l;if(d){const b=f.get(d);if(!b)return l;l.push([s,{kind:d,id:b}])}else Array.from(f.entries()).forEach(b=>{let[k,B]=b;l.push([s,{kind:k,id:B}])});return l}createUnsubscribeMessage(s){const d=[];return s.forEach(l=>{let[f,{kind:b,id:k}]=l;switch(b){case _5.VIDEO:return void(f._videoSSRC&&d.push({stream_type:_5.VIDEO,ssrcId:f._videoSSRC}));case _5.AUDIO:return void(f._audioSSRC&&d.push({stream_type:_5.AUDIO,ssrcId:f._audioSSRC}))}}),d}withdrawRemoteTracks(s){s.forEach(d=>{let[l,{kind:f}]=d;const b=this.remoteUserMap.get(l);b&&(b.delete(f),Array.from(b.entries()).length===0&&this.remoteUserMap.delete(l))})}async updateBitrateLimit(s){const d=this.localTrackMap.get(JH.LocalVideoTrack),l=this.localTrackMap.get(JH.LocalVideoLowTrack);d&&(await d.track.setBitrateLimit(s.uplink),await new u5((f,b)=>{this.handleUpdateVideoEncoder(d.track,f,b,!0)})),l&&s.low_stream_uplink&&(await l.track.setBitrateLimit({max_bitrate:s.low_stream_uplink.bitrate,min_bitrate:s.low_stream_uplink.bitrate||0}),await new u5((f,b)=>{this.handleUpdateVideoEncoder(l.track,f,b,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const s=this.sendConnection.peerConnectionState,d=this.recvConnection.peerConnectionState;return s!=="connected"&&d!=="connected"}return!0}async tryToUnmuteAudio(s){for(let d=0;d<s.length;d++)if(s[d]instanceof _q){const l=this.filterTobeUnmutedTracks(s[d]);if(l.length===0)continue;const f=this.createUnmuteMessage(l);return void await w6(this,v5.RequestUnmuteLocal,f)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=s=>this.getStats(s),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(s=>{let[,{ssrcs:d}]=s;return!!d}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=s=>{var d;return!((d=this.recvConnection)===null||d===void 0||!d.getRemoteVideoIsReady(s))},this.statsUploader.requestUpload=(s,d)=>this.emit(v5.RequestUpload,s,d),this.statsUploader.requestUploadStats=s=>this.emit(v5.RequestUploadStats,s),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await BK(yde(this.dtlsFailedCount,EK)),this.emit(v5.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(JH.LocalVideoTrack)||this.pendingLocalTracks.some(s=>s instanceof x6)}throwIfTrackTypeNotMatch(s){if(s.filter(d=>d instanceof x6).length>1)throw new jH(dH.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(s.filter(d=>d instanceof _q).length>1&&(s.some(d=>d instanceof _q&&d._bypassWebAudio)||!u6().webAudioMediaStreamDest))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const d of s){if(d instanceof x6&&this.pendingLocalTracks.some(l=>l instanceof x6))throw new jH(dH.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(d instanceof _q&&this.pendingLocalTracks.some(l=>l instanceof _q)&&(!u6().webAudioMediaStreamDest||d._bypassWebAudio||this.pendingLocalTracks.some(l=>l instanceof _q&&l._bypassWebAudio)))throw new jH(dH.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(s,d){const l=!_H("DISABLE_DUAL_STREAM_USE_ENCODING")&&u6().supportDualStreamEncoding,f=aae(aae({},{width:160,height:120,framerate:15,bitrate:50}),d);let b;b=l?s._mediaStreamTrack.clone():Ole(s,f);const k=A6(8,"track-low-"),B=new x6(b,aae(aae({},l&&{scaleResolutionDownBy:lle(f,s)}),{},{frameRate:f.framerate,bitrateMax:f.bitrate,bitrateMin:f.bitrate}),void 0,void 0,k);return B.on(gQ.TRANSCEIVER_UPDATED,Wt=>{s._updateRtpTransceiver(Wt,L$.LOW_STREAM)}),B._hints.push(O6.LOW_STREAM),s.addListener(E5.NEED_CLOSE,()=>{B.close()}),B}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(s,d,l,f){var b;const k=Array.from(v8(b=this.remoteUserMap).call(b)).find(B=>B._videoSSRC===s);if(k){f||this.store.subscribe(k.uid,"video",void 0,void 0,void 0,void 0,Date.now());const B=this.store.keyMetrics,Wt=B.subscribe.find($O=>$O.userId===k.uid&&$O.type==="video");T5.firstRemoteVideoDecode(this.store.sessionId,OK.FIRST_VIDEO_DECODE,j6.FIRST_VIDEO_DECODE,{peer:k._uintid,videowidth:d,videoheight:l,subscribeElapse:r4.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId,apEnd:B.requestAPEnd||0,apStart:B.requestAPStart||0,joinGwEnd:B.joinGatewayEnd||0,joinGwStart:B.joinGatewayStart||0,pcEnd:B.peerConnectionEnd||0,pcStart:B.peerConnectionStart||0,subscriberEnd:(Wt==null?void 0:Wt.subscribeEnd)||0,subscriberStart:(Wt==null?void 0:Wt.subscribeStart)||0,videoAddNotify:(Wt==null?void 0:Wt.streamAdded)||0,state:f?1:0})}}async remoteMediaSsrcChanged(s,d,l){if(!this.recvConnection)return!1;const f=this.remoteUserMap.get(s);if(!f)return!1;const b=f.get(d);if(!b)return!1;const k=await this.recvConnection.getRemoteSSRC(b);return k!==void 0&&k!==l}isPreSubScribe(s){return!1}async publishDataChannel(s){throw new jH(dH.NOT_SUPPORTED)}async unpublishDataChannel(s){throw new jH(dH.NOT_SUPPORTED)}async subscribeDataChannel(s,d){throw new jH(dH.NOT_SUPPORTED)}async unsubscribeDataChannel(s,d){throw new jH(dH.NOT_SUPPORTED)}hasPendingRemoteDataChannel(s,d){throw new jH(dH.NOT_SUPPORTED)}setPendingRemoteDataChannel(s,d){throw new jH(dH.NOT_SUPPORTED)}async preConnect(s){throw new jH(dH.NOT_SUPPORTED)}getEstablishParams(){throw new jH(dH.NOT_SUPPORTED)}async reSubscribe(s){throw new jH(dH.NOT_SUPPORTED)}async updateVideoStreamParameter(s,d){throw new jH(dH.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(s=>{let[d,{track:l}]=s;d===JH.LocalVideoLowTrack?l._updateRtpTransceiver(void 0,L$.LOW_STREAM):l._updateRtpTransceiver(void 0)})}},m5(G6.prototype,"p2pConnect",[Zbe],Object.getOwnPropertyDescriptor(G6.prototype,"p2pConnect"),G6.prototype),m5(G6.prototype,"unpublish",[$be],Object.getOwnPropertyDescriptor(G6.prototype,"unpublish"),G6.prototype),m5(G6.prototype,"unpublishLowStream",[eve],Object.getOwnPropertyDescriptor(G6.prototype,"unpublishLowStream"),G6.prototype),m5(G6.prototype,"subscribe",[tve],Object.getOwnPropertyDescriptor(G6.prototype,"subscribe"),G6.prototype),m5(G6.prototype,"mockSubscribe",[nve],Object.getOwnPropertyDescriptor(G6.prototype,"mockSubscribe"),G6.prototype),m5(G6.prototype,"unsubscribe",[rve],Object.getOwnPropertyDescriptor(G6.prototype,"unsubscribe"),G6.prototype),m5(G6.prototype,"muteRemote",[ive],Object.getOwnPropertyDescriptor(G6.prototype,"muteRemote"),G6.prototype),m5(G6.prototype,"unmuteRemote",[sve],Object.getOwnPropertyDescriptor(G6.prototype,"unmuteRemote"),G6.prototype),m5(G6.prototype,"hasRemoteMediaWithLock",[ove],Object.getOwnPropertyDescriptor(G6.prototype,"hasRemoteMediaWithLock"),G6.prototype),m5(G6.prototype,"disconnectForReconnect",[ave],Object.getOwnPropertyDescriptor(G6.prototype,"disconnectForReconnect"),G6.prototype),m5(G6.prototype,"remoteMediaSsrcChanged",[cve],Object.getOwnPropertyDescriptor(G6.prototype,"remoteMediaSsrcChanged"),G6.prototype),G6);function oJ(s){return function(d,l,f){const b=d[l];if(typeof b!="function")throw new Error("Cannot use mutex on object property.");return f.value=async function(){for(var k=arguments.length,B=new Array(k),Wt=0;Wt<k;Wt++)B[Wt]=arguments[Wt];switch(s){case sJ.SEND_ONLY:{const $O=await this.sendMutex.lock("From P2PChannel2.".concat(l));try{return await b.apply(this,B)}finally{$O()}}case sJ.RECEIVE_ONLY:{const $O=await this.recvMutex.lock("From P2PChannel2.".concat(l));try{return await b.apply(this,B)}finally{$O()}}default:{const $O=await this.sendMutex.lock("From P2PChannel2.".concat(l)),uN=await this.recvMutex.lock("From P2PChannel2.".concat(l));try{return await b.apply(this,B)}finally{$O(),uN()}}}},f}}class VQ extends W6{constructor(d,l){super(),cH(this,"signal",void 0),cH(this,"token",void 0),cH(this,"tokenTimeout",void 0),cH(this,"tokenInterval",void 0),cH(this,"_sequence",0),cH(this,"userMap",new Map),cH(this,"encoder",new TextEncoder),this.signal=d,this.token=l;const f=()=>{this.signal.connectionState===D6.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(f,1e3):this.tokenInterval=window.setTimeout(f,3*_H("P2P_TOKEN_INTERVAL"))};f()}async send(d,l,f,b,k){var B,Wt,$O;if(this.userMap.size===0)return;const uN=Array.from(S8(B=this.userMap).call(B))[0].token;typeof l!="string"&&(l=JSON.stringify(l)),b=(Wt=b)!==null&&Wt!==void 0?Wt:A6(6,""),k=($O=k)!==null&&$O!==void 0?$O:this._sequence++;const lN={_id:b,_type:d,_seq:k,_message:l,token:"".concat(this.token,"_").concat(uN)};_H("SHOW_P2P_LOG")&&CN.debug("send message",lN,"noNeedResponse : ".concat(f)),this.splitMessage(JSON.stringify(lN)).forEach(TN=>{this.signal.request(N5.DATA_STREAM,{payload:MX(this.encoder.encode(TN))})});const _N=new u5((TN,vN)=>{const uH=window.setTimeout(()=>{this.off("res-@".concat(b,"_ack"),rH),this.off("res-@".concat(b),lH),this.off(Y$.ABORT,iH),CN.debug("[external-signal] request timeout, type: ".concat(d,", requestId: ").concat(b)),this.userMap.size===0?vN(new jH(dH.INVALID_REMOTE_USER)):vN(new jH(dH.TIMEOUT))},_H("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),rH=()=>{uH&&window.clearTimeout(uH),this.off(Y$.ABORT,iH),f&&TN()},iH=()=>{uH&&window.clearTimeout(uH),this.off("res-@".concat(b,"_ack"),rH),this.off("res-@".concat(b),lH),vN(new jH(dH.EXTERNAL_SIGNAL_ABORT,"type: ".concat(d,", requestId: ").concat(b)))};this.once(Y$.ABORT,iH),this.once("res-@".concat(b,"_ack"),rH);const lH=(bH,PH)=>{hH=!0,uH&&window.clearTimeout(uH),this.off("res-@".concat(b,"_ack"),rH),this.off(Y$.ABORT,iH),bH==="success"?TN(PH):vN(new jH(dH.P2P_MESSAGE_FAILED,"request ".concat(d," failed, requestId: ").concat(b)))};let hH=!1;f||(this.once("res-@".concat(b),lH),BK(_H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{hH||CN.warning("external_signal request timeout, type: ".concat(d,", requestId: ").concat(b,", ").concat(lN))}))});try{return await _N}catch(TN){if(TN.code===dH.TIMEOUT)return await this.send(d,l,f,b,k);throw TN}}onMessage(d){var l;const{_uid:f}=d;let b,k=this.userMap.get(f);if(k)b=k.splitMessageMap;else{if(this.userMap.size>0||!("_type"in d)||d._type!==oK.CHECK)return;const{token:uN}=d;b=new Map,k={uid:f,isStart:!0,token:uN,splitMessageMap:b,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(f,k),this.signal.emit(J5.ON_USER_ONLINE,{uid:f}),this.handleUserOnline()}if("id"in d&&"total"in d){var B;const{id:uN,total:lN}=d,_N=(B=b.get(uN))!==null&&B!==void 0?B:[];if(_N.push(d),b.has(uN)||b.set(uN,_N),_N.length!==lN)return;{const TN=nne(_N).call(_N,(vN,uH)=>vN.index-uH.index).map(vN=>vN.payload).join("");b.delete(uN),(d=JSON.parse(TN))._uid=f}}const{_type:Wt,token:$O}=d;if(a5(l=[oK.ACK,oK.CHECK]).call(l,Wt))return Wt===oK.CHECK&&this.handleCheckToken(k,$O),void this.receiveMessage(d);$O==="".concat(k.token,"_").concat(this.token)?this.handleReceivedMessage(d):CN.debug('Receive unexpected message", '.concat($O,", cur_token: ").concat(k.token,"_").concat(this.token),d)}check(){const d={_id:A6(6,""),token:this.token,_type:oK.CHECK};_H("SHOW_P2P_LOG")&&CN.debug("send message",d),this.signal.request(N5.DATA_STREAM,{payload:MX(this.encoder.encode(JSON.stringify(d)))})}ack(d){const l={_id:d,_type:oK.ACK,token:this.token};_H("SHOW_P2P_LOG")&&CN.debug("send message",l),this.signal.request(N5.DATA_STREAM,{payload:MX(this.encoder.encode(JSON.stringify(l)))})}response(d,l,f){this.send(oK.RESPONSE,JSON.stringify({success:!f,message:l}),!0,d)}handleReceivedMessage(d){const l=()=>{this.userMap.forEach(uN=>{const{receivedMessagesMap:lN,nextExpectedSequenceNumber:_N}=uN;for(;lN.has(_N);){const TN=lN.get(_N);lN.delete(_N),this.receiveMessage(TN),uN.nextExpectedSequenceNumber++}})};if(!d)return void l();const{_uid:f,_seq:b}=d,k=this.userMap.get(f),{receivedMessagesMap:B,isStart:Wt,nextExpectedSequenceNumber:$O}=k;if(b<$O)return this.ack(d._id),void CN.debug("[external-signal] receive old message, seq: ".concat(b,", ").concat(d._message));B.set(b,d),Wt&&b===$O&&(this.receiveMessage(d),B.delete($O),k.nextExpectedSequenceNumber++,l())}receiveMessage(d){const{_id:l,_type:f,_message:b,_uid:k}=d;if(_H("SHOW_P2P_LOG")&&CN.debug("receive message",d),l){let B;switch(d._type!==oK.ACK&&(b&&(B=JSON.parse(b)),this.ack(d._id)),d._type){case oK.CANDIDATE:case oK.CONTROL:this.signal.emit(f,B,k);break;case oK.PUBLISH:case oK.UNPUBLISH:case oK.RESTART_ICE:case oK.CALL:B.uid=k,YK(this.signal,f,B).then(Wt=>{this.response(d._id,Wt)}).catch(()=>{this.response(d._id,void 0,!0)});break;case oK.ACK:this.getListeners("res-@".concat(l,"_ack")).length>0&&this.emit("res-@".concat(l,"_ack"));break;case oK.RESPONSE:{const{success:Wt,message:$O}=B;this.emit("res-@".concat(l),Wt?"success":"failed",$O);break}}}}splitMessage(d){if(d.length<VQ.MAX_MESSAGE_SIZE)return[d];const l=[],{remoteToken:f}=JSON.parse(d),b=A6(6,"");let k=0,B=800;const Wt=Math.ceil(d.length/B);for(;d.length>0;){k++;const $O={id:b,index:k,total:Wt,payload:d.slice(0,B),token:"".concat(this.token,"_").concat(f)};JSON.stringify($O).length>VQ.MAX_MESSAGE_SIZE?B-=50:(l.push($O),d=d.slice(B))}return l.map($O=>JSON.stringify($O))}handleCheckToken(d,l){return d.token!==l?(CN.debug("token changed, from ".concat(d.token," to ").concat(l)),this.reset(d.uid,l),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{CN.debug("token timeout, ".concat(l)),this.reset(d.uid)},_H("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const d=await YK(this.signal,oK.CALL,void 0),l=await this.send(oK.CALL,d);this.signal.emit(P5.P2P_CONNECTION,l,!0)}async reset(d,l){const f=this.userMap.get(d);f&&(this.emit(Y$.ABORT),this.signal.emit(J5.ON_USER_OFFLINE,{uid:f.uid,reason:Ike.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),l||(CN.debug("change local token from ".concat(l," to ").concat(l)),this.token=A6(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Y$.ABORT)}}cH(VQ,"MAX_SIZE",1),cH(VQ,"MAX_MESSAGE_SIZE",1024);class nMe extends W6{get connectionState(){return this._connectionState}set connectionState(d){d!==this._connectionState&&(this._connectionState=d,d===D6.CONNECTED?this.emit(P5.WS_CONNECTED):d===D6.RECONNECTING?this.emit(P5.WS_RECONNECTING,this._websocketReconnectReason):d===D6.CLOSED&&this.emit(P5.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(d,l){super(),cH(this,"_disconnectedReason",void 0),cH(this,"_websocketReconnectReason",void 0),cH(this,"_connectionState",D6.CLOSED),cH(this,"reconnectToken",void 0),cH(this,"p2pToken",void 0),cH(this,"websocket",void 0),cH(this,"openConnectionTime",void 0),cH(this,"clientId",void 0),cH(this,"lastMsgTime",Date.now()),cH(this,"uploadCache",[]),cH(this,"uploadCacheInterval",void 0),cH(this,"rttRolling",new Bme(5)),cH(this,"pingpongTimer",void 0),cH(this,"pingpongTimeoutCount",0),cH(this,"joinResponse",void 0),cH(this,"multiIpOption",void 0),cH(this,"initError",void 0),cH(this,"spec",void 0),cH(this,"store",void 0),cH(this,"_external_signal",void 0),cH(this,"onWebsocketMessage",f=>{if(f.data instanceof ArrayBuffer)return void this.emit(P5.ON_BINARY_DATA,f.data);const b=JSON.parse(f.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(b,"_id")){const k="res-@".concat(b._id);this.emit(k,b._result,b._message)}else if(Object.prototype.hasOwnProperty.call(b,"_type")){switch(b._type){case J5.ON_DATA_STREAM:return void this.handleDataStream(b._message);case J5.MUTE_AUDIO:case J5.MUTE_VIDEO:case J5.ON_P2P_LOST:case J5.ON_USER_ONLINE:return;case J5.ON_USER_OFFLINE:const{uid:k}=b._message;return CN.debug("[".concat(this.clientId,"] user-offline uid: ").concat(k)),void this._external_signal.reset(k)}if(this.emit(b._type,b._message),b._type===J5.ON_NOTIFICATION&&this.handleNotification(b._message),b._type===J5.ON_USER_BANNED)switch(b._message.error_code){case 14:this.close(_6.UID_BANNED);break;case 15:this.close(_6.IP_BANNED);break;case 16:this.close(_6.CHANNEL_BANNED)}if(b._type===J5.ON_USER_LICENSE_BANNED)switch(b._message.error_code){case I5.ERR_LICENSE_MISSING:this.close(_6.LICENSE_MISSING);break;case I5.ERR_LICENSE_EXPIRED:this.close(_6.LICENSE_EXPIRED);break;case I5.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_6.LICENSE_MINUTES_EXCEEDED);break;case I5.ERR_LICENSE_PERIOD_INVALID:this.close(_6.LICENSE_PERIOD_INVALID);break;case I5.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_6.LICENSE_MULTIPLE_SDK_SERVICE);break;case I5.ERR_LICENSE_ILLEGAL:this.close(_6.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=d.clientId,this.spec=d,this.store=l,this.websocket=new ule("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_H("JOIN_GATEWAY_USE_DUAL_DOMAIN"),_H("JOIN_GATEWAY_USE_443PORT_ONLY"),l),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===D6.CONNECTED&&this.reconnect("retry",zK.OFFLINE)}),this.p2pToken=A6(6,""),this._external_signal=new VQ(this,this.p2pToken)}async request(d,l,f,b){const k=A6(6,""),B={_id:k,_type:d,_message:l},Wt=this.websocket.connectionID,$O=()=>new u5((uH,rH)=>{if(this.connectionState===D6.CONNECTED)return uH();const iH=()=>{this.off(P5.WS_CLOSED,lH),uH()},lH=()=>{this.off(P5.WS_CONNECTED,iH),rH(new jH(dH.WS_ABORT))};this.once(P5.WS_CONNECTED,iH),this.once(P5.WS_CLOSED,lH)});if(this.connectionState!==D6.CONNECTING&&this.connectionState!==D6.RECONNECTING||d===N5.JOIN||d===N5.REJOIN||await $O(),this.websocket.sendMessage(B,!0),b)return;const uN=new u5((uH,rH)=>{let iH=!1;const lH=(bH,PH)=>{iH=!0,uH({isSuccess:bH==="success",message:PH||{}}),this.off(P5.WS_CLOSED,hH),this.off(P5.WS_RECONNECTING,hH),this.emit(P5.REQUEST_SUCCESS,d,l)};this.once("res-@".concat(k),lH);const hH=()=>{rH(new jH(dH.WS_ABORT,"type: ".concat(d))),this.off(P5.WS_CLOSED,hH),this.off(P5.WS_RECONNECTING,hH),this.off("res-@".concat(k),lH)};this.once(P5.WS_CLOSED,hH),this.once(P5.WS_RECONNECTING,hH),BK(_H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==Wt||iH||(CN.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(d)),this.emit(P5.REQUEST_TIMEOUT,d,l))})});let lN=null;try{lN=await uN}catch(uH){if(this.connectionState===D6.CLOSED||d===N5.LEAVE)throw new jH(dH.WS_ABORT);return!this.spec.forceWaitGatewayResponse||f?uH.throw():d===N5.JOIN||d===N5.REJOIN?null:(await $O(),await this.request(d,l))}if(lN.isSuccess)return lN.message;const _N=Number(lN.message.error_code||lN.message.code),TN=wne(_N),vN=new jH(dH.UNEXPECTED_RESPONSE,"".concat(TN.desc,": ").concat(lN.message.error_str),{code:_N,data:lN.message,desc:TN.desc});return TN.action==="success"?lN.message:(CN.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(d,", error_code: ").concat(_N,", message: ").concat(TN.desc,", action: ").concat(TN.action)),_N===I5.ERR_TOO_MANY_BROADCASTERS?((d===N5.JOIN||d===N5.REJOIN)&&(this.initError=vN,this.close()),vN.throw()):TN.action==="failed"?vN.throw():TN.action==="quit"?(this.initError=vN,this.close(),vN.throw()):(_N===I5.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=lN.message.option,CN.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zK.MULTI_IP)):this.reconnect(TN.action,zK.SERVER_ERROR),d===N5.JOIN||d===N5.REJOIN?null:await this.request(d,l)))}waitMessage(d,l){return new u5(f=>{const b=k=>{(!l||l(k))&&(this.off(d,b),f(k))};this.on(d,b)})}uploadWRTCStats(d){if(!this.store.sessionId)return void CN.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const l={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:d};this.upload(Cne.WRTC_STATS,l)}upload(d,l){const f={_type:d,_message:l};try{this.websocket.sendMessage(f)}catch{const k=_H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(f),this.uploadCache.length>k&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==D6.CONNECTED)return;const B=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(B._type,B._message)},_H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(d,l){const f={_type:d,_message:l};this.websocket.sendMessage(f)}async sendExtensionMessage(d,l,f){return await this._external_signal.send(d,l,f)}init(d){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new u5((l,f)=>{this.once(P5.WS_CONNECTED,()=>l(this.joinResponse)),this.once(P5.WS_CLOSED,()=>f(this.initError||new jH(dH.WS_ABORT))),this.connectionState=D6.CONNECTING,this.websocket.init(d).catch(f)})}close(d){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=d||_6.LEAVE,this.connectionState=D6.CLOSED,CN.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=A6(6,""),this._external_signal.clear(),this._external_signal=new VQ(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(P5.ABORT_P2P_EXECUTION);const d=await YK(this,P5.REQUEST_JOIN_INFO),l=await this.request(N5.JOIN,d);if(!l)return this.emit(P5.REPORT_JOIN_GATEWAY,dH.TIMEOUT,this.url||""),!1;this.joinResponse=l,this.emit(P5.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=D6.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(d,l){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(d,l)}handleDataStream(d){try{var l;const f=_Q(d.payload),b=new TextDecoder().decode(f),k=JSON.parse(b);"total"in k&&"id"in k||a5(l=Object.values(oK)).call(l,k._type)?(k._uid=d.uid,this._external_signal.onMessage(k)):this.emit(J5.ON_DATA_STREAM,d)}catch{this.emit(J5.ON_DATA_STREAM,d)}}handleNotification(d){CN.debug("[".concat(this.clientId,"] receive notification: "),d);const l=wne(d.code);if(l.action!=="success"){if(l.action!=="failed")return l.action==="quit"?(l.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_6.UID_BANNED),void this.close()):void this.reconnect(l.action,zK.SERVER_ERROR);CN.error("[".concat(this.clientId,"] ignore error: "),l.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const d=_H("PING_PONG_TIME_OUT"),l=Date.now();this.pingpongTimeoutCount>=d&&(CN.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(l-this.lastMsgTime,"ms")),l-this.lastMsgTime>_H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zK.TIMEOUT):this.request(N5.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const f=Date.now()-l;this.rttRolling.add(f),_H("REPORT_STATS")&&this.send(N5.PING_BACK,{pingpongElapse:f})}).catch(f=>{})}handleWebsocketEvents(){this.websocket.on(U5.RECONNECT_CREATE_CONNECTION,d=>{this.emit(P5.WS_RECONNECT_CREATE_CONNECTION,d)}),this.websocket.on(U5.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(U5.CLOSED,()=>{this.connectionState=D6.CLOSED}),this.websocket.on(U5.FAILED,()=>{this._disconnectedReason=_6.NETWORK_ERROR,this.connectionState=D6.CLOSED}),this.websocket.on(U5.RECONNECTING,d=>{this._websocketReconnectReason=d,this.joinResponse=void 0,this.connectionState===D6.CONNECTED?this.connectionState=D6.RECONNECTING:this.connectionState=D6.CONNECTING}),this.websocket.on(U5.WILL_RECONNECT,(d,l,f)=>{d!=="retry"?(CN.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(d)),this.reconnectToken=void 0):CN.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),f(d)}),this.websocket.on(U5.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(d=>{if(this.emit(P5.REPORT_JOIN_GATEWAY,d,this.url||""),d instanceof jH&&d.code===dH.UNEXPECTED_RESPONSE&&d.data.code===I5.ERR_NO_AUTHORIZED)return CN.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",zK.SERVER_ERROR);CN.error("[".concat(this.clientId,"] join gateway request failed"),d.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zK.SERVER_ERROR):(this.initError=d,this.close())})}),this.websocket.on(U5.REQUEST_NEW_URLS,(d,l)=>{YK(this,P5.REQUEST_RECOVER,this.multiIpOption).then(d).catch(l)}),this.websocket.on(U5.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(J5.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const rMe={name:"P2PChannel",create:function(s){let{store:d,statsCollector:l}=s;return new tMe(d,l)},createSubmodule:function(s){let{store:d,spec:l}=s;return new nMe(l,d)}};function dve(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function lve(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?dve(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):dve(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}class iMe{constructor(d){cH(this,"sessionDesc",void 0),cH(this,"localCapabilities",void 0),cH(this,"rtpCapabilities",void 0),cH(this,"candidates",void 0),cH(this,"_originCandidates",void 0),cH(this,"iceParameters",void 0),cH(this,"dtlsParameters",void 0),cH(this,"setup",void 0),cH(this,"currentMidIndex",void 0),cH(this,"cname",void 0),d=$6(d);const{iceParameters:l,dtlsParameters:f,candidates:b,rtpCapabilities:k,setup:B,localCapabilities:Wt,sdkCodec:$O,cname:uN}=d,lN=$4(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=k,this.candidates=b,this._originCandidates=$6(b),this.iceParameters=l,this.dtlsParameters=f,this.setup=B,this.localCapabilities=Wt,this.cname=uN;for(let _N=0;_N<lN.mediaDescriptions.length;_N++){const TN=lN.mediaDescriptions[_N];if(TN.attributes.iceUfrag=l.iceUfrag,TN.attributes.icePwd=l.icePwd,TN.attributes.fingerprints=f.fingerprints,TN.attributes.candidates=b,TN.attributes.setup=B,TN.media.mediaType==="video"){TN.media.fmts=k.videoCodecs.map(uH=>uH.payloadType.toString(10));let vN=k.videoCodecs.filter(uH=>{var rH,iH;return(rH=uH.rtpMap)===null||rH===void 0?void 0:a5(iH=rH.encodingName.toLowerCase()).call(iH,$O)});vN.length===0&&(vN=k.videoCodecs),TN.attributes.payloads=vN,TN.attributes.extmaps=k.videoExtensions}TN.media.mediaType==="audio"&&(TN.media.fmts=k.audioCodecs.map(vN=>vN.payloadType.toString(10)),TN.attributes.payloads=k.audioCodecs,TN.attributes.extmaps=k.audioExtensions),lN.mediaDescriptions[_N]=this.mungMediaDesc(TN)}this.sessionDesc=lN,this.currentMidIndex=lN.mediaDescriptions.length-1}toString(){return UX(this.sessionDesc)}send(d,l,f){const{ssrcs:b,ssrcGroups:k}=CQ(l,this.cname),B=this.sessionDesc.mediaDescriptions.find(uN=>d===_5.VIDEO?uN.media.mediaType==="video":uN.media.mediaType==="audio"),Wt=b[0].attributes.label,$O=b[0].attributes.mslabel;return B.attributes.ssrcs=B.attributes.ssrcs.concat(b),B.attributes.ssrcGroups=B.attributes.ssrcGroups.concat(k),{id:Wt,mslabel:$O}}batchSend(d){return d.map(l=>{let{kind:f,ssrcMsg:b}=l;return this.send(f,b,void 0)})}stopSending(d){this.sessionDesc.mediaDescriptions.forEach(l=>{const f=[],b=[],k=[];l.attributes.ssrcs.forEach(B=>{a5(d).call(d,B.attributes.label||"")?k.push(B):f.push(B)}),l.attributes.ssrcGroups.forEach(B=>{var Wt;a5(Wt=k.map($O=>$O.ssrcId)).call(Wt,B.ssrcIds[0])||b.push(B)}),l.attributes.ssrcs=f,l.attributes.ssrcGroups=b})}mute(d){const l=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===d);if(!l)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));l.attributes.direction="inactive"}unmute(d){const l=this.sessionDesc.mediaDescriptions.find(f=>f.attributes.mid===d);if(!l)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));l.attributes.direction="sendonly"}receive(d,l,f){d.forEach((b,k)=>{const B=b._mediaStreamTrack,Wt=this.sessionDesc.mediaDescriptions.findIndex(uN=>uN.attributes.mid===B.kind),$O=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[Wt],b);this.sessionDesc.mediaDescriptions[Wt]=$O})}stopReceiving(d){}updateCandidates(d){const l=this._originCandidates.filter(b=>b.transport==="udp"),f=[];if(l.forEach(b=>{f.push(lve(lve({},b),{},{foundation:"tcpcandidate",priority:Number(b.priority)-1+"",transport:"tcp",port:Number(b.port)+90+""}))}),l.length!==0){switch(d){case d4.TCP_RELAY:this.candidates=f;break;case d4.UDP_TCP_RELAY:case d4.RELAY:this.candidates=[...l,...f];break;default:this.candidates=l}for(const b of this.sessionDesc.mediaDescriptions)b.attributes.candidates=this.candidates}}restartICE(d){d=$6(d),this.iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.iceUfrag=d.iceUfrag,l.attributes.icePwd=d.icePwd})}predictReceivingMids(d){const l=[];for(let f=0;f<d;f++)l.push((this.currentMidIndex+f+1).toString(10));return l}mungRecvMediaDsec(d,l){const f=$6(d);return Z$(f,l),ple(f,l),f}updateRecvMedia(d,l){const f=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===d);if(f!==-1){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],l);this.sessionDesc.mediaDescriptions[f]=b}}bumpMid(d){this.currentMidIndex+=d}updateTrackLabel(d,l,f){const b=this.sessionDesc.mediaDescriptions.find(B=>d===_5.VIDEO?B.attributes.mid==="video":B.attributes.mid==="audio");if(b){const B=b.attributes.ssrcs.find(Wt=>Wt.attributes.label===l);var k;B&&(B.attributes.label=f,(k=B.attributes.msid)===null||k===void 0||k.replace(l,f))}}mungMediaDesc(d){const l=$6(d);return hle(l),function(f){const b=f.attributes.extmaps.find(k=>Aoe(k.extensionName));b&&f.attributes.extmaps.splice(f.attributes.extmaps.indexOf(b),1),f.attributes.payloads.forEach(k=>{const B=k.rtcpFeedbacks.findIndex(Wt=>Wt.type==="transport-cc");B!==-1&&k.rtcpFeedbacks.splice(B,1)})}(l),l}getSSRC(d){for(const l of this.sessionDesc.mediaDescriptions)for(const f of l.attributes.ssrcs)if(f.attributes.label===d)return[f]}}var I6;function hve(s,d){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(s);d&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(s,b).enumerable})),l.push.apply(l,f)}return l}function cae(s){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?hve(Object(l),!0).forEach(function(f){cH(s,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):hve(Object(l)).forEach(function(f){Object.defineProperty(s,f,Object.getOwnPropertyDescriptor(l,f))})}return s}let sMe=(I6=class cre extends gSe{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").filter(d=>{var l;return a5(l=Object.keys(roe)).call(l,d)}))]}constructor(d,l){super(d,l),cH(this,"store",void 0),cH(this,"peerConnection",void 0),cH(this,"remoteSDP",void 0),cH(this,"initialOffer",void 0),cH(this,"statsFilter",void 0),cH(this,"useRTX",!1),cH(this,"localCapabilities",void 0),cH(this,"localCandidateCount",0),cH(this,"allCandidatesReceived",!1),cH(this,"establishPromise",void 0),cH(this,"mutex",void 0),this.store=l,this.mutex=new t4("P2PConnection-mutex",l.clientId),this.peerConnection=new RTCPeerConnection(cre.resolvePCConfiguration(d),{optional:[{googDscp:!0}]}),this.statsFilter=wde(this.peerConnection,_H("STATS_UPDATE_INTERVAL"),void 0,Z6()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const d=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!d.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=jX(d.sdp),f=Nne(d.sdp,{filterRTX:!this.useRTX,filterVideoFec:_H("FILTER_VIDEO_FEC"),filterAudioFec:_H("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=f,this.initialOffer=d,cae(cae({},l),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:f},offerSDP:d.sdp})}catch(d){throw new jH(dH.GET_LOCAL_CONNECTION_PARAMS_FAILED,d.toString())}}async updateRemoteConnect(){}async connect(d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new iMe(cae(cae({},d),{},{rtpCapabilities:d.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(d,l){throw new jH(dH.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(d){}send(d,l){var f=this;return H8(function*(){const b=yield i6(f.mutex.lock());try{if(!f.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const k=d.map(TN=>f.peerConnection.addTrack(TN._mediaStreamTrack)),B=yield i6(f.peerConnection.createOffer()),Wt=$4(B.sdp),$O=d.map(TN=>{const vN=TN._mediaStreamTrack,uH=Wt.mediaDescriptions.find(rH=>rH.attributes.mid===vN.kind);if(!uH)throw new Error("Cannot extract ssrc from mediaDescription.");return function(rH,iH,lH){const hH=rH.attributes.ssrcs.filter(PH=>PH.attributes.label===iH),bH=rH.attributes.ssrcGroups;if(hH.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(bH&&hH.length>1){const PH=bH.find(OH=>OH.ssrcIds.indexOf(hH[0].ssrcId)!==-1);return PH?[{ssrcId:PH.ssrcIds[0],rtx:lH?PH.ssrcIds[1]:void 0}]:[{ssrcId:hH[0].ssrcId}]}return[{ssrcId:hH[0].ssrcId}]}(uH,vN.id,f.useRTX)});let uN;try{uN=yield $O}catch(TN){throw k.forEach(vN=>{KK()&&vN.replaceTrack(null),f.peerConnection.removeTrack(vN)}),TN}const lN=f.mungSendOfferSDP(B.sdp,d);f.remoteSDP.receive(d,l,uN);const _N=f.remoteSDP.toString();return yield i6(f.peerConnection.setLocalDescription({type:"offer",sdp:lN})),yield i6(f.applySendEncodings(k,d)),yield i6(f.peerConnection.setRemoteDescription({type:"answer",sdp:_N})),d.map((TN,vN)=>{const uH=TN._mediaStreamTrack.id;return{localSSRC:$O[vN],id:uH}})}catch(k){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(k.toString()))}finally{b()}})()}async stopSending(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=this.peerConnection.getSenders().filter(k=>{var B;return d.indexOf(((B=k.track)===null||B===void 0?void 0:B.id)||"")!==-1});if(l.length!==d.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(k=>{KK()&&k.replaceTrack(null),this.peerConnection.removeTrack(k)});const f=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(f),this.remoteSDP.stopReceiving(d);const b=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}}async receive(d,l,f,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(d," before remoteSDP created."));const{id:k,mslabel:B}=this.remoteSDP.send(d,l,b),Wt=new u5((lN,_N)=>{const TN=setTimeout(()=>{_N(new Error("Cannot receive track, id: ".concat(k)))},1e4),vN=uH=>{const rH=c6();if((rH.name==="Safari"&&Number(rH.version)===11||I4())&&uH.track.id!==k&&uH.streams[0].id===B){var iH;const lH=uH.streams[0].getTracks()[0];return(iH=this.remoteSDP)===null||iH===void 0||iH.updateTrackLabel(d,k,uH.track.id),this.peerConnection.removeEventListener("track",vN),clearTimeout(TN),void lN(lH)}if(uH.track.id===k)return this.peerConnection.removeEventListener("track",vN),clearTimeout(TN),void lN(uH.track)};this.peerConnection.addEventListener("track",vN)}),$O=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:$O});const uN=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(uN),{track:await Wt,id:k}}catch(k){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(k.toString()))}}async stopReceiving(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(d);const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}}async muteRemote(d){}async unmuteRemote(d){}async muteLocal(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const l=this.peerConnection.getSenders().filter(f=>{var b;return d.indexOf(((b=f.track)===null||b===void 0?void 0:b.id)||"")!==-1});if(l.length!==d.length)throw new Error("sender' length doesn't match mids' length.");l.map(f=>{if(KK()&&f.track)f.track.enabled=!1;else{const b=f.getParameters();b.encodings.forEach(k=>k.active=!1),f.setParameters(b)}})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(l.toString()))}}async unmuteLocal(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const l=this.peerConnection.getSenders().filter(k=>{var B;return d.indexOf(((B=k.track)===null||B===void 0?void 0:B.id)||"")!==-1});if(l.length!==d.length)throw new Error("Senders' length doesn't match mids' length.");l.map(async k=>{if(KK()&&k.track)k.track.enabled=!0;else{const B=k.getParameters();B.encodings.forEach(Wt=>Wt.active=!0),await k.setParameters(B)}});const f=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(f);const b=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(l.toString()))}}restartICE(d){var l=this;return H8(function*(){const f=yield i6(l.mutex.lock("From P2PConnection.restartICE"));try{if(!l.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const b=u6().supportPCSetConfiguration;if(d===d4.RELAY&&!b)return;if(b){const uN=l.peerConnection.getConfiguration(),lN=d===d4.RELAY?"relay":"all";uN.iceTransportPolicy!==lN&&(CN.debug("[".concat(l.store.clientId,"] restartICE change iceTransportPolicy from [").concat(uN.iceTransportPolicy,"] to [").concat(lN,"]")),uN.iceTransportPolicy=lN,l.peerConnection.setConfiguration(uN))}d!==d4.RELAY&&l.remoteSDP.updateCandidates(d);const k=yield i6(l.peerConnection.createOffer({iceRestart:!0}));if(!k.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const B=jX(k.sdp),{remoteIceParameters:Wt}=yield B.iceParameters;l.remoteSDP.restartICE(Wt);const $O=l.remoteSDP.toString();yield i6(l.peerConnection.setLocalDescription(k)),yield i6(l.peerConnection.setRemoteDescription({type:"answer",sdp:$O}))}catch(b){CN.warning("[".concat(l.store.clientId,"] restart ICE failed, abort operation"),b)}finally{f()}})()}close(){var d;this.peerConnection.close(),(d=this.onConnectionStateChange)===null||d===void 0||d.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(d){return this.statsFilter.getVideoIsReady(d)}async updateEncoderConfig(d,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const f=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(f.sdp,[l]);this.remoteSDP.updateRecvMedia(l._mediaStreamTrack.kind,l);const k=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(f){throw new jH(dH.EXCHANGE_SDP_FAILED,f.toString())}}async updateSendParameters(d,l){const f=this.peerConnection.getSenders().filter(b=>{var k;return((k=b.track)===null||k===void 0?void 0:k.id)===d});f.length===1&&await this.applySendEncodings(f,[l])}setStatsRemoteVideoIsReady(d,l){this.statsFilter.setVideoIsReady2(d,l)}async replaceTrack(d,l){const f=this.peerConnection.getSenders().find(b=>{var k;return((k=b.track)===null||k===void 0?void 0:k.id)===l});f&&await f.replaceTrack(d._mediaStreamTrack)}createDataChannels(d,l){throw new jH(dH.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(d){throw new jH(dH.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var d;(d=this.onICEConnectionStateChange)===null||d===void 0||d.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var d;(d=this.onConnectionStateChange)===null||d===void 0||d.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=d=>{d.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,CN.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,CN.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(d){const l={iceServers:[],sdpSemantics:"plan-b"};return d.iceServers?l.iceServers=d.iceServers:d.turnServer&&d.turnServer.mode!=="off"&&(mne(d.turnServer.servers)?l.iceServers=d.turnServer.servers:(l.iceServers&&l.iceServers.push(...cre.turnServerConfigToIceServers(d.turnServer.servers)),_H("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&d.turnServer.serversFromGateway&&l.iceServers.push(...cre.turnServerConfigToIceServers(d.turnServer.serversFromGateway)),d.turnServer.servers.concat(d.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(l.iceTransportPolicy="relay")}))),l}static turnServerConfigToIceServers(d){const l=[];return d.forEach(f=>{f.security?f.tcpport&&l.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=tcp")}):(f.udpport&&l.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.udpport,"?transport=udp")}),f.tcpport&&l.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=tcp")}))}),l}async updateRtpSenderEncodings(d,l){var f;if(l||(l=this.peerConnection.getSenders().find(uN=>{var lN;return((lN=uN.track)===null||lN===void 0?void 0:lN.id)===d._mediaStreamTrack.id})),!l)return CN.warn("[".concat(d.getTrackId(),"] no rtpSender found}"));if(!u6().supportSetRtpSenderParameters)return CN.warn("Browser not support set rtp-sender parameters");const b={},k={};if(d instanceof x6)switch(d._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}if(_H("DSCP_TYPE")&&A7()){var B;const uN=_H("DSCP_TYPE");a5(B=["very-low","low","medium","high"]).call(B,uN)&&(k.networkPriority=uN)}const Wt=l.getParameters(),$O=(f=Wt.encodings)===null||f===void 0?void 0:f[0];$O&&Object.assign($O,k),Object.assign(Wt,b),CN.debug("[".concat(d.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(Wt.encodings))),await l.setParameters(Wt)}async applySendEncodings(d,l){try{if(!u6().supportSetRtpSenderParameters||d.length!==l.length)return;for(let f=0;f<d.length;f++){const b=d[f],k=l[f];b&&k&&await this.updateRtpSenderEncodings(k,b)}}catch{CN.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(d,l){const f=$4(d);return l.forEach((b,k)=>{const B=b._mediaStreamTrack,Wt=f.mediaDescriptions.find($O=>$O.attributes.mid===B.kind);Wt&&Z$(Wt,b)}),UX(f)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=d=>{var l;(l=this.onFirstAudioReceived)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstVideoReceived=d=>{var l;(l=this.onFirstVideoReceived)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstAudioDecoded=d=>{var l;(l=this.onFirstAudioDecoded)===null||l===void 0||l.call(this,d)},this.statsFilter.onFirstVideoDecoded=(d,l,f)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,d,l,f)},this.statsFilter.onSelectedLocalCandidateChanged=(d,l)=>{var f;(f=this.onSelectedLocalCandidateChanged)===null||f===void 0||f.call(this,d,l)},this.statsFilter.onSelectedRemoteCandidateChanged=(d,l)=>{var f;(f=this.onSelectedRemoteCandidateChanged)===null||f===void 0||f.call(this,d,l)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const l=this.remoteSDP.batchSend(d).map((k,B)=>{let{id:Wt,mslabel:$O}=k;const{kind:uN}=d[B];return new u5((lN,_N)=>{const TN=setTimeout(()=>{_N(new Error("Cannot receive track, id: ".concat(Wt)))},1e4),vN=uH=>{const rH=c6();if(rH.name==="Safari"&&Number(rH.version)===11&&uH.track.id!==Wt&&uH.streams[0].id===$O){var iH;const lH=uH.streams[0].getTracks()[0];return(iH=this.remoteSDP)===null||iH===void 0||iH.updateTrackLabel(uN,Wt,uH.track.id),this.peerConnection.removeEventListener("track",vN),clearTimeout(TN),void lN({track:lH,id:Wt})}if(uH.track.id===Wt)return this.peerConnection.removeEventListener("track",vN),clearTimeout(TN),void lN({track:uH.track,id:Wt})};this.peerConnection.addEventListener("track",vN)})}),f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});const b=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(b),await u5.all(l)}catch(l){throw new jH(dH.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async getRemoteSSRC(d){if(!this.remoteSDP)return;const l=this.remoteSDP.getSSRC(d);return l==null?void 0:l[0].ssrcId}setConfiguration(d){if(u6().supportPCSetConfiguration){const l=cre.resolvePCConfiguration(d);this.peerConnection.setConfiguration(l)}}},m5(I6.prototype,"connect",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"connect"),I6.prototype),m5(I6.prototype,"stopSending",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"stopSending"),I6.prototype),m5(I6.prototype,"receive",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"receive"),I6.prototype),m5(I6.prototype,"stopReceiving",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"stopReceiving"),I6.prototype),m5(I6.prototype,"muteRemote",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"muteRemote"),I6.prototype),m5(I6.prototype,"unmuteRemote",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"unmuteRemote"),I6.prototype),m5(I6.prototype,"muteLocal",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"muteLocal"),I6.prototype),m5(I6.prototype,"unmuteLocal",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"unmuteLocal"),I6.prototype),m5(I6.prototype,"close",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"close"),I6.prototype),m5(I6.prototype,"updateEncoderConfig",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"updateEncoderConfig"),I6.prototype),m5(I6.prototype,"updateSendParameters",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"updateSendParameters"),I6.prototype),m5(I6.prototype,"replaceTrack",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"replaceTrack"),I6.prototype),m5(I6.prototype,"getRemoteSSRC",[Z8],Object.getOwnPropertyDescriptor(I6.prototype,"getRemoteSSRC"),I6.prototype),I6);function Z8(s,d,l){const f=s[d];if(typeof f!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const b=this.mutex,k=await b.lock("Locking from P2PConnection.".concat(d));try{for(var B=arguments.length,Wt=new Array(B),$O=0;$O<B;$O++)Wt[$O]=arguments[$O];return await f.apply(this,Wt)}finally{k()}},l}const oMe={name:"PlanBConnection",create:function(s){let{store:d,spec:l}=s;return new sMe(l,d)}};Ade(),S6("PROCESS_ID","process-".concat(A6(8,""),"-").concat(A6(4,""),"-").concat(A6(4,""),"-").concat(A6(4,""),"-").concat(A6(12,""))),function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(d){return void CN.error("Error loading sdk config",d.message)}if(s)try{const d=JSON.parse(window.atob(s)),l=Date.now();CN.debug("Loading global parameters from cache",d),Object.keys(d).forEach(f=>{if(Object.prototype.hasOwnProperty.call(H6,f)){const{value:b,expires:k}=d[f];if(k&&k<=l)return;$Y[f]=b,H6[f]=b}})}catch(d){CN.error("Error loading mutableParamsCache: ".concat(s),d.message)}}(),Array.isArray($Y.AREAS)&&$Y.AREAS.length>0&&gle($Y.AREAS,!0);const pve=(s,d,l)=>{CN.debug("setParameter key:".concat(s,", value:").concat(JSON.stringify(d))),S6(s,d,l)};IQ(PLe,!1),IQ(LLe,!1),IQ(m0e,!1),IQ(qLe,!1),IQ(ALe,!1),IQ(rMe,!1),IQ(oMe,!1);const mK=function(s){const d=new W6,l=s,f={getListeners:d.getListeners.bind(d),on:(b,k)=>(function(B,Wt){B===GJ.SECURITY_POLICY_VIOLATION&&qRe(Wt,!0)}(b,k),d.on.bind(d)(b,k)),addListener:d.addListener.bind(d),once:d.once.bind(d),off:d.off.bind(d),removeAllListeners:d.removeAllListeners.bind(d),emit:d.emit.bind(d),safeEmit:d.safeEmit.bind(d)};return HRe(HRe({},l),f)}({__TRACK_LIST__:k$,VERSION:q8,BUILD:Pde,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:pve,getParameter:_H,getSupportedCodec:async function(){let s={audio:[],video:[]};try{let d=new RTCPeerConnection;const l=await async function(f){let b;return u6().supportUnifiedPlan?(f.addTransceiver("video",{direction:"recvonly"}),f.addTransceiver("audio",{direction:"recvonly"}),b=(await f.createOffer()).sdp):b=(await f.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,b}(d);if(!l)return s;d.close(),d=null,s=function(f){const b={video:[],audio:[]};return f.match(/ VP8/i)&&b.video.push("VP8"),f.match(/ VP9/i)&&b.video.push("VP9"),f.match(/ AV1/i)&&b.video.push("AV1"),f.match(/ H264/i)&&b.video.push("H264"),f.match(/ H265/i)&&b.video.push("H265"),f.match(/ opus/i)&&b.audio.push("OPUS"),f.match(/ PCMU/i)&&b.audio.push("PCMU"),f.match(/ PCMA/i)&&b.audio.push("PCMA"),f.match(/ G722/i)&&b.audio.push("G722"),b}(l)}catch(d){throw new LH(dH.CREATE_OFFER_FAILED,d.toString&&d.toString()).print()}return s},checkSystemRequirements:function(){const s=T5.reportApiInvoke(null,{name:_K.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Y6.TRACER});let d=!1;try{const k=window.RTCPeerConnection,B=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,Wt=window.WebSocket;d=!!(k&&B&&Wt),d&&pde()&&Eme(75)&&new k().close()}catch(k){return CN.error("check system requirement failed: ",k),!1}let l=!1;const f=c6();f.name===p6.CHROME&&Number(f.version)>=58&&(QY.engine.name!=="WebKit"||function(){const k=c6();if(Yse()){if(k.os===AK.MAC_OS)return!0;if(k.os===AK.IOS){const B=QY.os.version&&QY.os.version.split(".");if(B&&Number(B[0])===14&&B[1]&&Number(B[1])>=3||B&&Number(B[0])>14)return!0}}return!1}())&&(l=!0),(f.name===p6.FIREFOX&&Number(f.version)>=56||f.name===p6.OPERA&&Number(f.version)>=45||f.name===p6.SAFARI&&Number(f.version)>=11||f.name==="WebKit"&&(I4()||EY())&&f.osVersion&&Number(f.osVersion.split(".")[0])>=11||Rme()||c6().name===p6.QQ)&&(l=!0),CN.debug("checkSystemRequirements, api:",d,"browser",l);const b=d&&l;return s.onSuccess(b),b},getDevices:function(s){return O8.enumerateDevices(!0,!0,s)},getMicrophones:function(s){return O8.getRecordingDevices(s)},getCameras:function(s){return O8.getCamerasDevices(s)},getElectronScreenSources:fge,getPlaybackDevices:function(s){return O8.getSpeakers(s)},createClient:function(){var s;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const l=A6(5,"client-"),f=T5.reportApiInvoke(null,{id:l,name:_K.CREATE_CLIENT,options:[d],tag:Y6.TRACER});try{(function(b){vK(b.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vK(b.mode,"config.mode",["rtc","live","p2p"]),b.audioCodec!==void 0&&vK(b.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),b.proxyServer!==void 0&&jK(b.proxyServer,"config.proxyServer",1,1e4),b.turnServer!==void 0&&Nme(b.turnServer),b.httpRetryConfig!==void 0&&Ome(b.httpRetryConfig),b.websocketRetryConfig!==void 0&&Ome(b.websocketRetryConfig)})(d)}catch(b){throw f.onError(b),b}return(gme(16,0,!0)||Tme(16,0,!0))&&(d.codec==="vp9"&&(d.codec="vp8",CN.debug("browser not support vp9, force use vp8")),S6("UNSUPPORTED_VIDEO_CODEC",["vp9"])),d.audioCodec===void 0&&(d.audioCodec="opus"),f.onSuccess(),new g0e(vY(vY({forceWaitGatewayResponse:!0},d),{},{role:a5(s=["rtc","p2p"]).call(s,d.mode)?"host":d.role||"audience"}),l)},createCameraVideoTrack:async function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const d=_H("CAMERA_CAPTURE_CONFIG"),l=A6(8,"track-cam-"),f=T5.reportApiInvoke(null,{id:l,tag:Y6.TRACER,name:_K.CREATE_CAM_VIDEO_TRACK,options:[B6({},s),d]});d&&(s.encoderConfig=d);const b=uoe(s);let k=null;CN.info("start create camera video track with config",JSON.stringify(s),"trackId",l);try{k=(await A8({video:b},l)).getVideoTracks()[0]||null}catch(Wt){throw f.onError(Wt),Wt}if(!k){const Wt=new jH(dH.UNEXPECTED_ERROR,"can not find track in media stream");return f.onError(Wt),Wt.throw(CN)}s.optimizationMode&&Yde(l,k,s,FJ(s.encoderConfig));const B=new zde(k,s,b,s.scalabiltyMode?soe(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,l);return f.onSuccess(B.getTrackId()),CN.info("create camera video success, trackId:",l),B},createCustomVideoTrack:function(s){const d=A6(8,"track-cus-"),l=T5.reportApiInvoke(null,{id:d,tag:Y6.TRACER,name:_K.CREATE_CUSTOM_VIDEO_TRACK,options:[s]}),f=new x6(s.mediaStreamTrack,{width:s.width,height:s.height,frameRate:s.frameRate,bitrateMax:s.bitrateMax,bitrateMin:s.bitrateMin},s.scalabiltyMode?soe(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,d,[O6.CUSTOM_TRACK]);return l.onSuccess(f.getTrackId()),CN.info("create custom video track success with config",s,"trackId",f.getTrackId()),f},createScreenVideoTrack:async function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const l=typeof d=="object"?function(TN){return vge(TN)}(d):void 0;l&&(d="auto");const f=A6(8,"track-scr-v-"),b=T5.reportApiInvoke(null,{id:f,tag:Y6.TRACER,name:_K.CREATE_SCREEN_VIDEO_TRACK,options:[B6({},s),d]});s.encoderConfig?typeof s.encoderConfig=="string"||s.encoderConfig.width&&s.encoderConfig.height||(s.encoderConfig.width={max:1920},s.encoderConfig.height={max:1080}):s.encoderConfig="1080p_2";const k=function(TN){const vN={};TN.screenSourceType&&(vN.mediaSource=TN.screenSourceType),TN.extensionId&&w7()&&(vN.extensionId=TN.extensionId);const{displaySurface:uH,selfBrowserSurface:rH,surfaceSwitching:iH,systemAudio:lH,preferCurrentTab:hH}=TN;(I$(107)||dde(107)||lde(93))&&(uH&&(vK(uH,"displaySurface",["browser","window","monitor"]),vN.displaySurface=uH),rH?(vK(rH,"selfBrowserSurface",["exclude","include"]),vN.selfBrowserSurface=rH):vN.selfBrowserSurface="include",iH&&(vK(iH,"surfaceSwitching",["exclude","include"]),vN.surfaceSwitching=iH)),(I$(105)||dde(105)||lde(91))&&lH&&(vK(lH,"systemAudio",["exclude","include"]),vN.systemAudio=lH),(I$(94)||dde(94)||lde(80))&&hH&&(vN.preferCurrentTab=!0),TN.electronScreenSourceId&&(vN.sourceId=TN.electronScreenSourceId);const bH=TN.encoderConfig?Ude(TN.encoderConfig):null;return vN.mandatory={chromeMediaSource:"desktop",maxWidth:bH?bH.width:void 0,maxHeight:bH?bH.height:void 0},bH&&(bH.frameRate&&(typeof bH.frameRate=="number"?(vN.mandatory.maxFrameRate=bH.frameRate,vN.mandatory.minFrameRate=bH.frameRate):(vN.mandatory.maxFrameRate=bH.frameRate.max||bH.frameRate.ideal||bH.frameRate.exact||void 0,vN.mandatory.minFrameRate=bH.frameRate.min||bH.frameRate.ideal||bH.frameRate.exact||void 0),vN.frameRate=bH.frameRate),bH.width&&(vN.width=bH.width),bH.height&&(vN.height=bH.height)),vN}(s);let B=null,Wt=null;const $O=u6();if(!$O.supportShareAudio&&d==="enable"){const TN=new jH(dH.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return b.onError(TN),TN.throw(CN)}CN.info("start create screen video track with config",s,"withAudio",d,"trackId",f);const uN=$O.supportShareAudio&&d!=="disable";try{const TN=await A8({screen:k,screenAudio:uN?l||!0:void 0},f);B=TN.getVideoTracks()[0]||null,Wt=TN.getAudioTracks()[0]||null}catch(TN){throw b.onError(TN),TN}if(!B){const TN=new jH(dH.UNEXPECTED_ERROR,"can not find track in media stream");return b.onError(TN),TN.throw(CN)}if(!Wt&&d==="enable"){B&&B.stop();const TN=new jH(dH.SHARE_AUDIO_NOT_ALLOWED);return b.onError(TN),TN.throw(CN)}s.optimizationMode||(s.optimizationMode="detail"),s.optimizationMode&&(Yde(f,B,s,s.encoderConfig&&Ude(s.encoderConfig)||void 0),s.encoderConfig&&typeof s.encoderConfig!="string"&&(s.encoderConfig.bitrateMin=s.encoderConfig.bitrateMax));const lN=new x6(B,s.encoderConfig?Ude(s.encoderConfig):{},s.scalabiltyMode?soe(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,f,[O6.SCREEN_TRACK]);if(!Wt)return b.onSuccess(lN.getTrackId()),CN.info("create screen video track success","video:",lN.getTrackId()),lN;const _N=new _q(Wt,void 0,A6(8,"track-scr-a-"),!1);return b.onSuccess([lN.getTrackId(),_N.getTrackId()]),CN.info("create screen video track success","video:",lN.getTrackId(),"audio:",_N.getTrackId()),[lN,_N]},createMicrophoneAndCameraTracks:async function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=_H("CAMERA_CAPTURE_CONFIG"),f=A6(8,"track-mic-"),b=A6(8,"track-cam-"),k=T5.reportApiInvoke(null,{id:"".concat(f,"-").concat(b),tag:Y6.TRACER,name:_K.CREATE_MIC_AND_CAM_TRACKS,options:[s,d,l]});l&&(d.encoderConfig=l);const B=uoe(d),Wt=Cge(s);let $O=null,uN=null;CN.info("start create camera video track(".concat(b,") and microphone audio track(").concat(f,") with config, audio: ").concat(JSON.stringify(s),", video: ").concat(JSON.stringify(d)));try{const TN=await A8({audio:Wt,video:B},"".concat(f,"-").concat(b));$O=TN.getAudioTracks()[0],uN=TN.getVideoTracks()[0]}catch(TN){throw k.onError(TN),TN}if(!$O||!uN){const TN=new jH(dH.UNEXPECTED_ERROR,"can not find tracks in media stream");return k.onError(TN),TN.throw(CN)}d.optimizationMode&&Yde(b,uN,d,FJ(d.encoderConfig));const lN=new doe($O,s,Wt,f),_N=new zde(uN,d,B,d.scalabiltyMode?soe(d.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},d.optimizationMode,b);return k.onSuccess([lN.getTrackId(),_N.getTrackId()]),CN.info("create camera video track(".concat(b,") and microphone audio track(").concat(f,") success")),[lN,_N]},createMicrophoneAudioTrack:async function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const d=A6(8,"track-mic-"),l=T5.reportApiInvoke(null,{id:d,tag:Y6.TRACER,name:_K.CREATE_MIC_AUDIO_TRACK,options:[s]}),f=Cge(s);let b=null;CN.info("start create microphone audio track with config",JSON.stringify(s),"trackId",d);try{b=(await A8({audio:f},d)).getAudioTracks()[0]||null}catch(B){throw l.onError(B),B}if(!b){const B=new jH(dH.UNEXPECTED_ERROR,"can not find track in media stream");return l.onError(B),B.throw(CN)}const k=new doe(b,s,f,d);return l.onSuccess(k.getTrackId()),CN.info("create microphone audio track success, trackId:",d),k},createCustomAudioTrack:function(s){const d=A6(8,"track-cus-"),l=T5.reportApiInvoke(null,{id:d,tag:Y6.TRACER,name:_K.CREATE_CUSTOM_AUDIO_TRACK,options:[s]}),f=new _q(s.mediaStreamTrack,s.encoderConfig?ooe(s.encoderConfig):{},d,!1);return CN.info("create custom audio track success with config",s,"trackId",f.getTrackId()),l.onSuccess(f.getTrackId()),f},createBufferSourceAudioTrack:async function(s){var d;const{cacheOnlineFile:l,encoderConfig:f}=s;let{source:b}=s;const k={source:b instanceof AudioBuffer?"AudioBuffer":b instanceof File?(d=File.name)!==null&&d!==void 0?d:"File":b,cacheOnlineFile:l,encoderConfig:f},B=A6(8,"track-buf-"),Wt=T5.reportApiInvoke(null,{id:B,tag:Y6.TRACER,name:_K.CREATE_BUFFER_AUDIO_TRACK,options:[k]});if(_H("DISABLE_WEBAUDIO"))throw new jH(dH.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");CN.info("start create buffer source audio track with config",JSON.stringify(k),"trackId",B);const $O=b;if(!(b instanceof AudioBuffer))try{b=await async function(_N,TN){let vN=null;if(typeof _N=="string"){const rH=lTe.get(_N);if(rH)return CN.debug("use cached audio resource: ",_N),rH;try{vN=(await ZY(()=>F4.get(_N,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(iH){throw new jH(dH.FETCH_AUDIO_FILE_FAILED,iH.toString())}}else vN=await new u5((iH,lH)=>{const hH=new FileReader;hH.onload=bH=>{bH.target?iH(bH.target.result):lH(new jH(dH.READ_LOCAL_AUDIO_FILE_ERROR))},hH.onerror=()=>{lH(new jH(dH.READ_LOCAL_AUDIO_FILE_ERROR))},hH.readAsArrayBuffer(_N)});const uH=await function(rH){const iH=F$();return new u5((lH,hH)=>{iH.decodeAudioData(rH,bH=>{lH(bH)},bH=>{hH(new jH(dH.DECODE_AUDIO_FILE_FAILED,bH.toString()))})})}(vN);return typeof _N=="string"&&TN&&lTe.set(_N,uH),uH}(b,l)}catch(_N){return Wt.onError(_N),_N.throw(CN)}const uN=new xDe(b),lN=new UDe($O,uN,f?ooe(f):{},B);return CN.info("create buffer source audio track success, trackId:",B),Wt.onSuccess(lN.getTrackId()),lN},setAppType:function(s){if(CN.debug("setAppType: ".concat(s)),!(Number.isInteger(s)&&s>=0))throw CN.debug("Invalid appType"),new LH(dH.INVALID_PARAMS,"invalid app type",s);S6("APP_TYPE",Math.floor(s))},setLogLevel:function(s){CN.setLogLevel(s)},enableLogUpload:function(){_H("USE_NEW_LOG")?S6("UPLOAD_LOG",!0):CN.enableLogUpload()},disableLogUpload:function(){_H("USE_NEW_LOG")?S6("UPLOAD_LOG",!1):CN.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new cye},checkAudioTrackIsActive:async function(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const l=T5.reportApiInvoke(null,{tag:Y6.TRACER,name:_K.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[d]});if(!(s instanceof _q||s instanceof G$)){const $O=new LH(dH.INVALID_TRACK,"the parameter is not a audio track");return l.onError($O),$O.throw()}d&&d<1e3&&(d=1e3);const f=s instanceof _q?s.getTrackLabel():"remote_track",b=s.getVolumeLevel();let k=b,B=b;const Wt=Date.now();return new u5($O=>{const uN=setInterval(()=>{const lN=s.getVolumeLevel();k=lN>k?lN:k,B=lN<B?lN:B;const _N=k-B>1e-4,TN=Date.now()-Wt;if(_N||TN>d){clearInterval(uN);const vN=_N,uH={duration:TN,deviceLabel:f,maxVolumeLevel:k,result:vN};CN.info("[track-".concat(s.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(uH))),l.onSuccess(uH),$O(vN)}},200)})},checkVideoTrackIsActive:async function(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const l=T5.reportApiInvoke(null,{tag:Y6.TRACER,name:_K.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[d]});if(!(s instanceof x6||s instanceof B$)){const _N=new LH(dH.INVALID_TRACK,"the parameter is not a video track");return l.onError(_N),_N.throw()}d&&d<1e3&&(d=1e3);const f=s instanceof x6?s.getTrackLabel():"remote_track",b=s.getMediaStreamTrack(!0),k=document.createElement("video");k.style.width="1px",k.style.height="1px",k.setAttribute("muted",""),k.muted=!0,k.setAttribute("playsinline",""),k.controls=!1,(KK()||Yse())&&(k.style.opacity="0.01",k.style.position="fixed",k.style.left="0",k.style.top="0",document.body.appendChild(k)),k.srcObject=new MediaStream([b]),k.play();const B=document.createElement("canvas");B.width=160,B.height=120;let Wt=0,$O=0;try{const _N=Date.now();Wt=await function(TN,vN,uH,rH){let iH,lH=0,hH=null;return new u5((bH,PH)=>{function OH(){lH>rH&&iH&&(iH(),bH(lH));const wH=uH.getContext("2d");if(!wH){const d5=new LH(dH.UNEXPECTED_ERROR,"can not get canvas 2d context.");return CN.error(d5.toString()),void PH(d5)}wH.drawImage(TN,0,0,160,120);const BH=wH.getImageData(0,0,uH.width,uH.height),XH=Math.floor(BH.data.length/3);if(hH){for(let d5=0;d5<XH;d5+=3)if(BH.data[d5]!==hH[d5])return lH+=1,void(hH=BH.data);hH=BH.data}else hH=BH.data}setTimeout(()=>{iH&&(iH(),bH(lH))},vN),iH=Bde(()=>{OH()},30)})}(k,d,B,4),$O=Date.now()-_N}catch(_N){throw l.onError(_N),_N}i0e===p6.SAFARI&&(k.pause(),k.remove()),k.srcObject=null;const uN=Wt>4,lN={duration:$O,changedPicNum:Wt,deviceLabel:f,result:uN};return CN.info("[track-".concat(s.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(lN))),l.onSuccess(lN),uN},setArea:gle,audioElementPlayCenter:j4,resumeAudioContext:function(){j4.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(s){S0e.processExternalMediaAEC(s)},registerExtensions:function(s){const d=_H("PLUGIN_INFO")||[];s.forEach(l=>{"name"in l&&!a5(d).call(d,l.name)&&d.push(l.name);const f=l;f.__registered__=!0,f.logger.hookLog=CN.extLog,f.reporter.hookApiInvoke=T5.extApiInvoke,f.parameters&&Object.keys(f.parameters).forEach(b=>{f.parameters[b]=_H(b)})}),pve("PLUGIN_INFO",d)},ChannelMediaRelayError:K$,ChannelMediaRelayEvent:k7,ChannelMediaRelayState:e8,RemoteStreamFallbackType:ODe,RemoteStreamType:ADe,ConnectionDisconnectedReason:_6,AudienceLatencyLevelType:sDe,AREAS:l6,preload:async function(s,d,l,f){return Mye(s,d,l,f)}});return Object.defineProperties(mK,{onAudioAutoplayFailed:{get:()=>N8.onAudioAutoplayFailed,set:s=>{N8.onAudioAutoplayFailed=s}},onAutoplayFailed:{get:()=>N8.onAutoplayFailed,set:s=>{N8.onAutoplayFailed=s}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>mK._onSecurityPolicyViolation,set(s){mK._onSecurityPolicyViolation=s,qRe(s)}},__CLIENT_LIST__:{get:()=>_H("SHOW_GLOBAL_CLIENT_LIST")?bQ:[]}}),O8.on(TQ.CAMERA_DEVICE_CHANGED,s=>{CN.info("camera device changed",JSON.stringify(s)),mK.onCameraChanged&&mK.onCameraChanged(s),mK.safeEmit(GJ.CAMERA_CHANGED,s)}),O8.on(TQ.RECORDING_DEVICE_CHANGED,s=>{CN.info("microphone device changed",JSON.stringify(s)),mK.onMicrophoneChanged&&mK.onMicrophoneChanged(s),mK.safeEmit(GJ.MICROPHONE_CHANGED,s)}),O8.on(TQ.PLAYOUT_DEVICE_CHANGED,s=>{CN.debug("playout device changed",JSON.stringify(s)),mK.onPlaybackDeviceChanged&&mK.onPlaybackDeviceChanged(s),mK.safeEmit(GJ.PLAYBACK_DEVICE_CHANGED,s)}),j4.onAutoplayFailed=()=>{CN.info("detect audio element autoplay failed"),N8.onAudioAutoplayFailed&&N8.onAudioAutoplayFailed()},y6.on("autoplay-failed",()=>{CN.info("detect webaudio autoplay failed"),N8.onAudioAutoplayFailed&&N8.onAudioAutoplayFailed(),mK.safeEmit(GJ.AUTOPLAY_FAILED)}),y6.on(WK.STATE_CHANGE,(s,d)=>{CN.info("audio context state changed: ".concat(d," => ").concat(s)),mK.onAudioContextStateChanged&&mK.onAudioContextStateChanged(s,d),mK.safeEmit(GJ.AUDIO_CONTEXT_STATE_CHANGED,s,d)}),uK.on(A$.NETWORK_STATE_CHANGE,(s,d)=>{CN.info("[network-indicator] network state changed, ".concat(d," => ").concat(s))}),window&&(window.__ARTC__=mK),mK})}(AgoraRTC_NProduction$1)),AgoraRTC_NProduction$1.exports}var AgoraRTC_NProductionExports=requireAgoraRTC_NProduction();const AgoraRTC__default=getDefaultExportFromCjs(AgoraRTC_NProductionExports);function _objectWithoutPropertiesLoose(e,r){if(e==null)return{};var i={},o=Object.keys(e),h,p;for(p=0;p<o.length;p++)h=o[p],!(r.indexOf(h)>=0)&&(i[h]=e[h]);return i}var AgoraRTCErrorCode;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient=function(r){var i;function o(){return i||(i=AgoraRTC__default.createClient(r)),i}return function(){return o()}};function createMicrophoneAndCameraTracks(e,r){var i=function(){try{return Promise.resolve(AgoraRTC__default.createMicrophoneAndCameraTracks(e,r)).then(function(p){return o=p,o})}catch(p){return Promise.reject(p)}},o=null;return function(){var p=reactExports.useState(!1),g=p[0],C=p[1],A=reactExports.useState(null),x=A[0],_e=A[1],cN=reactExports.useRef(o);return reactExports.useEffect(function(){return cN.current===null?i().then(function(dN){cN.current=dN,C(!0)},function(dN){_e(dN)}):C(!0),function(){o=null}},[]),{ready:g,tracks:cN.current,error:x}}}var AgoraVideoPlayer=function(r){var i=reactExports.useRef(null),o=r.videoTrack,h=r.config,p=_objectWithoutPropertiesLoose(r,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return i.current!==null&&o.play(i.current,h),function(){o.stop()}},[o]),React.createElement("div",Object.assign({},p,{ref:i}))},agoraRtmSdk$1={exports:{}},agoraRtmSdk=agoraRtmSdk$1.exports,hasRequiredAgoraRtmSdk;function requireAgoraRtmSdk(){return hasRequiredAgoraRtmSdk||(hasRequiredAgoraRtmSdk=1,function(module,exports){var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(e,r){module.exports=r()})(agoraRtmSdk,function(){function be(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,o)}return i}function ua(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?be(Object(i),!0).forEach(function(o){m(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function X(e){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(e)}function sl(e,r,i,o,h,p,g){try{var C=e[p](g),A=C.value}catch(x){return void i(x)}C.done?r(A):Promise.resolve(A).then(o,h)}function J(e){return function(){var r=this,i=arguments;return new Promise(function(o,h){function p(A){sl(C,o,h,p,g,"next",A)}function g(A){sl(C,o,h,p,g,"throw",A)}var C=e.apply(r,i);p(void 0)})}}function W(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function tl(e,r){for(var i=0;i<r.length;i++){var o=r[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ha(e,r,i){return r&&tl(e.prototype,r),i&&tl(e,i),e}function m(e,r,i){return r in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function la(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&df(e,r)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(e)}function df(e,r){return(df=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i})(e,r)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(e,r,i){return(Sh=ul()?Reflect.construct:function(o,h,p){var g=[null];return g.push.apply(g,h),o=new(Function.bind.apply(o,g)),p&&df(o,p.prototype),o}).apply(null,arguments)}function ef(e){var r=typeof Map=="function"?new Map:void 0;return(ef=function(i){function o(){return Sh(i,arguments,wd(this).constructor)}if(i===null||Function.toString.call(i).indexOf("[native code]")===-1)return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(i))return r.get(i);r.set(i,o)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),df(o,i)})(e)}function ff(e,r){if(e==null)return{};if(e==null)var i={};else{i={};var o,h=Object.keys(e);for(o=0;o<h.length;o++){var p=h[o];0<=r.indexOf(p)||(i[p]=e[p])}}if(Object.getOwnPropertySymbols)for(o=Object.getOwnPropertySymbols(e),p=0;p<o.length;p++)h=o[p],0<=r.indexOf(h)||Object.prototype.propertyIsEnumerable.call(e,h)&&(i[h]=e[h]);return i}function n(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var r=ul();return function(){var i=wd(e);if(r){var o=wd(this).constructor;i=Reflect.construct(i,arguments,o)}else i=i.apply(this,arguments);return i=!i||typeof i!="object"&&typeof i!="function"?n(this):i}}function Th(e,r,i){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,h,p){for(;!Object.prototype.hasOwnProperty.call(o,h)&&(o=wd(o))!==null;);if(o)return(h=Object.getOwnPropertyDescriptor(o,h)).get?h.get.call(p):h.value})(e,r,i||e)}function ra(e,r){var i=Array.isArray(e)?e:void 0;if(!i)if((i=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]))==null)i=void 0;else{var o,h=[],p=!0,g=!1;try{for(i=i.call(e);!(p=(o=i.next()).done)&&(h.push(o.value),!r||h.length!==r);p=!0);}catch(A){g=!0;var C=A}finally{try{p||i.return==null||i.return()}finally{if(g)throw C}}i=h}if(!(e=i||vl(e,r)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function G(e){var r=Array.isArray(e)?Uh(e):void 0;if(r||(r=typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null?Array.from(e):void 0),!(e=r||vl(e)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function vl(e,r){if(e){if(typeof e=="string")return Uh(e,r);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Uh(e,r)}}function Uh(e,r){(r==null||r>e.length)&&(r=e.length);for(var i=0,o=Array(r);i<r;i++)o[i]=e[i];return o}function fa(e,r,i,o,h){var p={};return Object.keys(o).forEach(function(g){p[g]=o[g]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=i.slice().reverse().reduce(function(g,C){return C(e,r,g)||g},p),h&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(h):void 0,p.initializer=void 0),p.initializer===void 0&&(Object.defineProperty(e,r,p),p=null),p}function $a(e){var r={exports:{}};return e(r,r.exports),r.exports}function wl(e,r){var i,o=3>arguments.length?e:arguments[2];return va(e)===o?e[r]:(i=Fb.f(e,r))?Q(i,"value")?i.value:i.get===void 0?void 0:i.get.call(o):ha(i=Vb(e))?wl(i,r,o):void 0}function rs(e){var r=e.charCodeAt(0)<<24,i=0|ss(~r),o=0,h=0|e.length,p="";if(5>i&&h>=i){for(r=r<<i>>>24+i,o=1;o<i;o=o+1|0)r=r<<6|63&e.charCodeAt(o);65535>=r?p+=xd(r):1114111>=r?p+=xd(55296+((r=r-65536|0)>>10)|0,56320+(1023&r)|0):o=0}for(;o<h;o=o+1|0)p+="�";return p}function xl(){}function ts(e){var r=0|e.charCodeAt(0);if(55296<=r&&56319>=r){var i=0|e.charCodeAt(1);if(!(i==i&&56320<=i&&57343>=i))return xd(239,191,189);if(65535<(r=(r-55296<<10)+i-56320+65536|0))return xd(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)}return 127>=r?e:2047>=r?xd(192|r>>>6,128|63&r):xd(224|r>>>12,128|r>>>6&63,128|63&r)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,r,i,o){ng(i);var h=e._events;if(h===void 0)h=e._events=Object.create(null),e._eventsCount=0;else{h.newListener!==void 0&&(e.emit("newListener",r,i.listener?i.listener:i),h=e._events);var p=h[r]}return p===void 0?(h[r]=i,++e._eventsCount):(typeof p=="function"?p=h[r]=o?[i,p]:[p,i]:o?p.unshift(i):p.push(i),0<(i=e._maxListeners===void 0?ea.defaultMaxListeners:e._maxListeners)&&p.length>i&&!p.warned&&(p.warned=!0,(i=Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=r,i.count=p.length,console&&console.warn&&console.warn(i))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,r,i){return e={fired:!1,wrapFn:void 0,target:e,type:r,listener:i},(r=us.bind(e)).listener=i,e.wrapFn=r}function Bl(e,r,i){if((e=e._events)===void 0)return[];if((r=e[r])===void 0)return[];if(typeof r=="function")return i?[r.listener||r]:[r];if(i)for(i=Array(r.length),e=0;e<i.length;++e)i[e]=r[e].listener||r[e];else i=Cl(r,r.length);return i}function Dl(e){var r=this._events;if(r!==void 0){if(typeof(e=r[e])=="function")return 1;if(e!==void 0)return e.length}return 0}function Cl(e,r){for(var i=Array(r),o=0;o<r;++o)i[o]=e[o];return i}function vs(e,r,i){typeof e.on=="function"&&El(e,"error",r,i)}function El(e,r,i,o){if(typeof e.on=="function")o.once?e.once(r,i):e.on(r,i);else{if(typeof e.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(r,function h(p){o.once&&e.removeEventListener(r,h),i(p)})}}function ws(e){return e?G(e):xs(function(){return[]},function(r,i){return r.push(i),r})}function Fl(e,r){var i,o,h,p;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:i=Gl(e)([Hl,Hl,function(C,A){return A}])[2],o=0;case 2:if(!(o<r.length)){g.next=17;break}if(h=r[o],!((p=i(Vh,h))instanceof og)){g.next=11;break}if((p=Wh(p.deref()))===Vh){g.next=10;break}return g.next=10,p;case 10:return g.abrupt("return");case 11:if(p===Vh){g.next=14;break}return g.next=14,p;case 14:o++,g.next=2;break;case 17:case"end":return g.stop()}},ys)}function pg(e,r){return r!=null&&typeof r[Symbol.iterator]=="function"?Fl(pg(e),r):function(i){var o=i[2];return zs(i,function(h,p){return o(h,e(p))})}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return Ac(e)==="Object"&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var r;return(r=Ac(e)==="Boolean"||Ac(e)==="Null"||Ac(e)==="Undefined")||(r=Ac(e)==="Number"&&!isNaN(e)),r||Ac(e)==="String"||Ac(e)==="Symbol"}function zd(e){var r=-1,i=e==null?0:e.length;for(this.clear();++r<i;){var o=e[r];this.set(o[0],o[1])}}function ce(e){var r=-1,i=e==null?0:e.length;for(this.clear();++r<i;){var o=e[r];this.set(o[0],o[1])}}function de(e){var r=-1,i=e==null?0:e.length;for(this.clear();++r<i;){var o=e[r];this.set(o[0],o[1])}}function gf(e){var r=-1,i=e==null?0:e.length;for(this.__data__=new qg;++r<i;)this.add(e[r])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,r,i,o,h,p){var g,C=1&r,A=2&r,x=4&r;if(i&&(g=h?i(e,o,h,p):i(e)),g!==void 0)return g;if(!lb(e))return e;if(o=Va(e)){if(g=As(e),!C)return Xh(e,g)}else{var _e=hf(e),cN=_e=="[object Function]"||_e=="[object GeneratorFunction]";if(jf(e))return Jl(e,C);if(_e=="[object Object]"||_e=="[object Arguments]"||cN&&!h){if(g=A||cN?{}:Kl(e),!C)return A?Bs(e,Cs(g,e)):Ds(e,Es(g,e))}else{if(!wa[_e])return h?e:{};g=Fs(e,_e,C)}}if(p||(p=new ge),h=p.get(e))return h;p.set(e,g),Gs(e)?e.forEach(function(fN){g.add(fe(fN,r,i,fN,e,p))}):Hs(e)&&e.forEach(function(fN,mN){g.set(mN,fe(fN,r,i,mN,e,p))}),A=x?A?Ll:Yh:A?kf:Ad;var dN=o?void 0:A(e);return Is(dN||e,function(fN,mN){dN&&(fN=e[mN=fN]),Ml(g,mN,fe(fN,r,i,mN,e,p))}),g}function Zh(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError("Expected a function");var i=function o(){var h=arguments,p=r?r.apply(this,h):h[0],g=o.cache;return g.has(p)?g.get(p):(h=e.apply(this,h),o.cache=g.set(p,h)||g,h)};return i.cache=new(Zh.Cache||qg),i}function Nl(e){if(typeof e=="string")return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var r=e+"";return r=="0"&&1/e==-1/0?"-0":r}function $h(e,r,i,o,h){var p=-1,g=e.length;for(i||(i=Ks),h||(h=[]);++p<g;){var C=e[p];i(C)?ai(h,C):h[h.length]=C}return h}function je(e,r,i,o,h){if(e===r)r=!0;else if(e==null||r==null||!gc(e)&&!gc(r))r=e!=e&&r!=r;else e:{var p=Va(e),g=Va(r),C=p?"[object Array]":hf(e),A=g?"[object Array]":hf(r),x=(C=C=="[object Arguments]"?"[object Object]":C)=="[object Object]";if(g=(A=A=="[object Arguments]"?"[object Object]":A)=="[object Object]",(A=C==A)&&jf(e)){if(!jf(r)){r=!1;break e}p=!0,x=!1}if(A&&!x)h||(h=new ge),r=p||bi(e)?Pl(e,r,i,o,je,h):Ls(e,r,C,i,o,je,h);else{if(!(1&i)&&(p=x&&Ql.call(e,"__wrapped__"),C=g&&Ql.call(r,"__wrapped__"),p||C)){e=p?e.value():e,r=C?r.value():r,h||(h=new ge),r=je(e,r,i,o,h);break e}if(A)t:if(h||(h=new ge),p=1&i,C=Yh(e),g=C.length,A=Yh(r).length,g==A||p){for(A=g;A--;){var _e=C[A];if(!(p?_e in r:Ms.call(r,_e))){r=!1;break t}}if(x=h.get(e),_e=h.get(r),x&&_e)r=x==r&&_e==e;else{x=!0,h.set(e,r),h.set(r,e);for(var cN=p;++A<g;){var dN=e[_e=C[A]],fN=r[_e];if(o)var mN=p?o(fN,dN,_e,r,e,h):o(dN,fN,_e,e,r,h);if(mN===void 0?dN!==fN&&!je(dN,fN,i,o,h):!mN){x=!1;break}cN||(cN=_e=="constructor")}x&&!cN&&(i=e.constructor)!=(o=r.constructor)&&"constructor"in e&&"constructor"in r&&!(typeof i=="function"&&i instanceof i&&typeof o=="function"&&o instanceof o)&&(x=!1),h.delete(e),h.delete(r),r=x}}else r=!1;else r=!1}}return r}function xa(e,r,i){this.low=0|e,this.high=0|r,this.unsigned=!!i}function mb(e){return(e&&e.__isLong__)===!0}function Bd(e,r){var i;if(r){if((r=0<=(e>>>=0)&&256>e)&&(i=Rl[e]))return i;i=ya(e,0>(0|e)?-1:0,!0),r&&(Rl[e]=i)}else{if((r=-128<=(e|=0)&&128>e)&&(i=Sl[e]))return i;i=ya(e,0>e?-1:0,!1),r&&(Sl[e]=i)}return i}function Gb(e,r){if(isNaN(e))return r?Cd:Hb;if(r){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-9223372036854776e3)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,r).neg():ya(e%ke|0,e/ke|0,r)}function ya(e,r,i){return new xa(e,r,i)}function ci(e,r,i){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return Hb;if(typeof r=="number"?(i=r,r=!1):r=!!r,2>(i=i||10)||36<i)throw RangeError("radix");var o;if(0<(o=e.indexOf("-")))throw Error("interior hyphen");if(o===0)return ci(e.substring(1),r,i).neg();o=Gb(sg(i,8));for(var h=Hb,p=0;p<e.length;p+=8){var g=Math.min(8,e.length-p),C=parseInt(e.substring(p,p+g),i);8>g?(g=Gb(sg(i,g)),h=h.mul(g).add(Gb(C))):h=(h=h.mul(o)).add(Gb(C))}return h.unsigned=r,h}function Wb(e,r){return typeof e=="number"?Gb(e,r):typeof e=="string"?ci(e,r):ya(e.low,e.high,typeof r=="boolean"?r:e.unsigned)}function O(e,r){function i(){this.constructor=e}di(e,r),e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}function le(e){return typeof e=="function"}function me(e){setTimeout(function(){throw e},0)}function ei(e){return e!==null&&X(e)==="object"}function Xl(e){return e.reduce(function(r,i){return r.concat(i instanceof lf?i.errors:i)},[])}function fi(e){for(;e;){var r=e.destination,i=e.isStopped;if(e.closed||i)return!1;e=r&&r instanceof ia?r:null}return!0}function Yc(e){return e}function gi(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yl(e)}function Yl(e){return e.length===0?Yc:e.length===1?e[0]:function(r){return e.reduce(function(i,o){return o(i)},r)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y(function(r){return e.schedule(function(){return r.complete()})})}function Zc(e){return e&&typeof e.schedule=="function"}function hi(e,r){return new Y(function(i){var o=new Oa,h=0;return o.add(r.schedule(function(){h===e.length?i.complete():(i.next(e[h++]),i.closed||o.add(this.schedule()))})),o})}function nf(e,r){return r?hi(e,r):new Y(am(e))}function bb(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Zc(r=e[e.length-1])?(e.pop(),hi(e,r)):nf(e)}function Z(e,r){return new Y(r?function(i){return r.schedule(Ps,0,{error:e,subscriber:i})}:function(i){return i.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,r){return r===void 0&&(r=0),function(i){return i.lift(new Rs(e,r))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,r){return function(i){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new Ss(e,r))}}function cm(e,r,i){if(r){if(!Zc(r))return function(){for(var o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];return cm(e,i).apply(void 0,o).pipe(ba(function(p){return Jb(p)?r.apply(void 0,p):r(p)}))};i=r}return function(){for(var o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];var p,g=this,C={context:g,subject:p,callbackFunc:e,scheduler:i};return new Y(function(A){if(i)return i.schedule(Ts,0,{args:o,subscriber:A,params:C});if(!p){p=new of;try{e.apply(g,o.concat([function(){for(var x=[],_e=0;_e<arguments.length;_e++)x[_e]=arguments[_e];p.next(1>=x.length?x[0]:x),p.complete()}]))}catch(x){fi(p)?p.error(x):console.warn(x)}}return p.subscribe(A)})}}function Ts(e){var r=this,i=e.args,o=e.subscriber,h=e.params;e=h.callbackFunc;var p=h.context,g=h.scheduler,C=h.subject;if(!C){C=h.subject=new of,h=function(){for(var A=[],x=0;x<arguments.length;x++)A[x]=arguments[x];r.add(g.schedule(Us,0,{value:1>=A.length?A[0]:A,subject:C}))};try{e.apply(p,i.concat([h]))}catch(A){C.error(A)}}this.add(C.subscribe(o))}function Us(e){var r=e.subject;r.next(e.value),r.complete()}function dm(e,r,i){if(r){if(!Zc(r))return function(){for(var o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];return dm(e,i).apply(void 0,o).pipe(ba(function(p){return Jb(p)?r.apply(void 0,p):r(p)}))};i=r}return function(){for(var o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];var p={subject:void 0,args:o,callbackFunc:e,scheduler:i,context:this};return new Y(function(g){var C=p.context,A=p.subject;if(i)return i.schedule(Vs,0,{params:p,subscriber:g,context:C});if(!A){A=p.subject=new of;try{e.apply(C,o.concat([function(){for(var x=[],_e=0;_e<arguments.length;_e++)x[_e]=arguments[_e];(_e=x.shift())?A.error(_e):(A.next(1>=x.length?x[0]:x),A.complete())}]))}catch(x){fi(A)?A.error(x):console.warn(x)}}return A.subscribe(g)})}}function Vs(e){var r=this,i=e.params,o=e.subscriber;e=e.context;var h=i.callbackFunc,p=i.args,g=i.scheduler,C=i.subject;if(!C){C=i.subject=new of,i=function(){for(var A=[],x=0;x<arguments.length;x++)A[x]=arguments[x];(x=A.shift())?r.add(g.schedule(em,0,{err:x,subject:C})):r.add(g.schedule(Ws,0,{value:1>=A.length?A[0]:A,subject:C}))};try{h.apply(e,p.concat([i]))}catch(A){this.add(g.schedule(em,0,{err:A,subject:C}))}}this.add(C.subscribe(o))}function Ws(e){var r=e.subject;r.next(e.value),r.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}function ji(e,r,i,o,h){if(h===void 0&&(h=new Xs(e,i,o)),!h.closed)return r instanceof Y?r.subscribe(h):pf(r)(h)}function Ys(e,r){return new Y(function(i){var o=new Oa;return o.add(r.schedule(function(){var h=e[ne]();o.add(h.subscribe({next:function(p){o.add(r.schedule(function(){return i.next(p)}))},error:function(p){o.add(r.schedule(function(){return i.error(p)}))},complete:function(){o.add(r.schedule(function(){return i.complete()}))}}))})),o})}function Zs(e,r){return new Y(function(i){var o=new Oa;return o.add(r.schedule(function(){return e.then(function(h){o.add(r.schedule(function(){i.next(h),o.add(r.schedule(function(){return i.complete()}))}))},function(h){o.add(r.schedule(function(){return i.error(h)}))})})),o})}function $s(e,r){if(!e)throw Error("Iterable cannot be null");return new Y(function(i){var o,h=new Oa;return h.add(function(){o&&typeof o.return=="function"&&o.return()}),h.add(r.schedule(function(){o=e[$c](),h.add(r.schedule(function(){if(!i.closed){try{var p=o.next(),g=p.value,C=p.done}catch(A){return void i.error(A)}C?i.complete():(i.next(g),this.schedule())}}))})),h})}function gm(e,r){if(e!=null){if(e&&typeof e[ne]=="function")return Ys(e,r);if(fm(e))return Zs(e,r);if(hm(e))return hi(e,r);if(e&&typeof e[$c]=="function"||typeof e=="string")return $s(e,r)}throw new TypeError((e!==null&&X(e)||e)+" is not observable")}function Kb(e,r){return r?gm(e,r):e instanceof Y?e:new Y(pf(e))}function ic(e,r){if(!r.closed){if(e instanceof Y)return e.subscribe(r);try{var i=pf(e)(r)}catch(o){r.error(o)}return i}}function cb(e,r,i){return i===void 0&&(i=Number.POSITIVE_INFINITY),typeof r=="function"?function(o){return o.pipe(cb(function(h,p){return Kb(e(h,p)).pipe(ba(function(g,C){return r(h,g,p,C)}))},i))}:(typeof r=="number"&&(i=r),function(o){return o.lift(new at(e,i))})}function tg(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y(function(r){try{var i=e()}catch(o){return void r.error(o)}return(i?Kb(i):mf()).subscribe(r)})}function jm(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===1){var i=e[0];if(Jb(i))return ug(i,null);if(ei(i)&&Object.getPrototypeOf(i)===Object.prototype)return ug((e=Object.keys(i)).map(function(h){return i[h]}),e)}if(typeof e[e.length-1]=="function"){var o=e.pop();return ug(e=e.length===1&&Jb(e[0])?e[0]:e,null).pipe(ba(function(h){return o.apply(void 0,h)}))}return ug(e,null)}function ug(e,r){return new Y(function(i){var o=e.length;if(o===0)i.complete();else for(var h=Array(o),p=0,g=0,C=function(x){var _e=Kb(e[x]),cN=!1;i.add(_e.subscribe({next:function(dN){cN||(cN=!0,g++),h[x]=dN},error:function(dN){return i.error(dN)},complete:function(){++p!==o&&cN||(g===o&&i.next(r?r.reduce(function(dN,fN,mN){return dN[fN]=h[mN],dN},{}):h),i.complete())}}))},A=0;A<o;A++)C(A)})}function gb(e,r,i,o){return le(i)&&(o=i,i=void 0),o?gb(e,r,i).pipe(ba(function(h){return Jb(h)?o.apply(void 0,h):o(h)})):new Y(function(h){km(e,r,function(p){1<arguments.length?h.next(Array.prototype.slice.call(arguments)):h.next(p)},h,i)})}function km(e,r,i,o,h){if(e&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"){e.addEventListener(r,i,h);var p=function(){return e.removeEventListener(r,i,h)}}else if(e&&typeof e.on=="function"&&typeof e.off=="function")e.on(r,i),p=function(){return e.off(r,i)};else if(e&&typeof e.addListener=="function"&&typeof e.removeListener=="function")e.addListener(r,i),p=function(){return e.removeListener(r,i)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var g=0,C=e.length;g<C;g++)km(e[g],r,i,o,h)}o.add(p)}function lm(e,r,i){return i?lm(e,r).pipe(ba(function(o){return Jb(o)?i.apply(void 0,o):i(o)})):new Y(function(o){var h=function(){for(var g=[],C=0;C<arguments.length;C++)g[C]=arguments[C];return o.next(g.length===1?g[0]:g)};try{var p=e(h)}catch(g){return void o.error(g)}if(le(r))return function(){return r(h,p)}})}function bt(e){var r=e.subscriber,i=e.condition;if(!r.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(p){return void r.error(p)}else e.needIterate=!0;if(i){var o=void 0;try{o=i(e.state)}catch(p){return void r.error(p)}if(!o)return void r.complete();if(r.closed)return}try{var h=e.resultSelector(e.state)}catch(p){return void r.error(p)}if(!r.closed&&(r.next(h),!r.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,r){return e===void 0&&(e=0),r===void 0&&(r=bd),(!ki(e)||0>e)&&(e=0),r&&typeof r.schedule=="function"||(r=bd),new Y(function(i){return i.add(r.schedule(ct,e,{subscriber:i,counter:0,period:e})),i})}function ct(e){var r=e.subscriber,i=e.counter;e=e.period,r.next(i),this.schedule({subscriber:r,counter:i+1,period:e},e)}function Xb(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];r=Number.POSITIVE_INFINITY;var i=null,o=e[e.length-1];return Zc(o)?(i=e.pop(),1<e.length&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof o=="number"&&(r=e.pop()),i===null&&e.length===1&&e[0]instanceof Y?e[0]:tg(r)(nf(e,i))}function li(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===0)return vb;var i=e[0],o=e.slice(1);return e.length===1&&Jb(i)?li.apply(void 0,i):new Y(function(h){var p=function(){return h.add(li.apply(void 0,o).subscribe(h))};return Kb(i).subscribe({next:function(g){h.next(g)},error:p,complete:p})})}function dt(e){var r=e.keys,i=e.index,o=e.subscriber,h=e.subscription;if(e=e.obj,!o.closed)if(i<r.length){var p=r[i];o.next([p,e[p]]),h.add(this.schedule({keys:r,index:i+1,subscriber:o,subscription:h,obj:e}))}else o.complete()}function et(e,r){function i(){return!i.pred.apply(i.thisArg,arguments)}return i.pred=e,i.thisArg=r,i}function wb(e,r){return function(i){return i.lift(new ft(e,r))}}function Ca(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===1){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var r=e.start,i=e.index,o=e.subscriber;i>=e.count?o.complete():(o.next(r),o.closed||(e.index=i+1,e.start=r+1,this.schedule(e)))}function Bc(e,r,i){e===void 0&&(e=0);var o=-1;return ki(r)?o=1>Number(r)?1:Number(r):Zc(r)&&(i=r),Zc(i)||(i=bd),new Y(function(h){var p=ki(e)?e:+e-i.now();return i.schedule(it,p,{index:0,period:o,subscriber:h})})}function it(e){var r=e.index,i=e.period,o=e.subscriber;if(o.next(r),!o.closed){if(i===-1)return o.complete();e.index=r+1,this.schedule(e,i)}}function mi(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return typeof(r=e[e.length-1])=="function"&&e.pop(),nf(e,void 0).lift(new jt(r))}function Ga(e){return function(r){var i=new kt(e);return r=r.lift(i),i.caught=r}}function ni(e,r){return cb(e,r,1)}function nm(e){return e===void 0&&(e=null),function(r){return r.lift(new lt(e))}}function cd(e,r){r===void 0&&(r=bd);var i=e instanceof Date&&!isNaN(+e)?+e-r.now():Math.abs(e);return function(o){return o.lift(new mt(i,r))}}function om(e,r){return function(i){return i.lift(new nt(e,r))}}function Dd(e){return e===void 0&&(e=ot),function(r){return r.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(r){return e===0?mf():r.lift(new qt(e))}}function pm(e,r){return r?function(i){return i.pipe(pm(function(o,h){return Kb(e(o,h)).pipe(ba(function(p,g){return r(o,p,h,g)}))}))}:function(i){return i.lift(new rt(e))}}function wg(e){return function(r){return r.lift(new st(e))}}function aa(e,r){var i=2<=arguments.length;return function(o){return o.pipe(e?wb(function(h,p){return e(h,p,o)}):Yc,Ka(1),i?nm(r):Dd(function(){return new vg}))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(r){return e===0?mf():r.lift(new vt(e))}}function qf(e){return function(r){return r.lift(new wt(e))}}function xg(e,r){var i=!1;return 2<=arguments.length&&(i=!0),function(o){return o.lift(new xt(e,r,i))}}function rm(e,r){return 2<=arguments.length?function(i){return gi(xg(e,r),qm(1),nm(r))(i)}:function(i){return gi(xg(function(o,h,p){return e(o,h,p+1)}),qm(1))(i)}}function yt(e,r){return function(i){var o=typeof e=="function"?e:function(){return e},h=Object.create(i,At);return h.source=i,h.subjectFactory=o,h}}function oe(e){return function(r){return r.lift(new Bt(e,r))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,r,i){var o=e&&X(e)==="object"?e:{bufferSize:e,windowTime:r,refCount:!1,scheduler:i};return function(h){return h.lift(Dt(o))}}function Dt(e){var r,i,o=e.bufferSize,h=o===void 0?Number.POSITIVE_INFINITY:o,p=(o=e.windowTime)===void 0?Number.POSITIVE_INFINITY:o,g=e.refCount,C=e.scheduler,A=0,x=!1,_e=!1;return function(cN){if(A++,!r||x){x=!1;var dN=(r=new qe(h,p,C)).subscribe(this);i=cN.subscribe({next:function(fN){r.next(fN)},error:function(fN){x=!0,r.error(fN)},complete:function(){_e=!0,i=void 0,r.complete()}}),_e&&(i=void 0)}else dN=r.subscribe(this);this.add(function(){A--,dN.unsubscribe(),dN=void 0,i&&!_e&&g&&A===0&&(i.unsubscribe(),r=i=void 0)})}}function Cc(e,r){return typeof r=="function"?function(i){return i.pipe(Cc(function(o,h){return Kb(e(o,h)).pipe(ba(function(p,g){return r(o,p,h,g)}))}))}:function(i){return i.lift(new Et(e))}}function ob(e){return function(r){return r.lift(new Ft(e))}}function Gt(e,r){return r===void 0&&(r=!1),function(i){return i.lift(new Ht(e,r))}}function ca(e,r,i){return function(o){return o.lift(new It(e,r,i))}}function Jt(e,r,i){return r===void 0&&(r=bd),i===void 0&&(i=Kt),function(o){return o.lift(new Lt(e,r,i.leading,i.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,r,i){return i===void 0&&(i=bd),function(o){var h=e instanceof Date&&!isNaN(+e),p=h?+e-i.now():Math.abs(e);return o.lift(new Ot(p,h,r,i))}}function hb(e,r){return r===void 0&&(r=bd),Nt(e,Z(new pb),r)}function Pt(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(i){var o;return typeof e[e.length-1]=="function"&&(o=e.pop()),i.lift(new Qt(e,o))}}function tm(e,r,i,o,h){e!==r&&um(r,function(p,g){if(h||(h=new ge),lb(p)){p=h;var C=oi(e,g),A=oi(r,g),x=p.get(A);if(x)pi(e,g,x);else{var _e=(x=o?o(C,A,g+"",e,r,p):void 0)===void 0;if(_e){var cN=Va(A),dN=!cN&&jf(A),fN=!cN&&!dN&&bi(A);x=A,cN||dN||fN?Va(C)?x=C:gc(C)&&Ed(C)?x=Xh(C):dN?(_e=!1,x=Jl(A,!0)):fN?(_e=!1,x=vm(A,!0)):x=[]:wm(A)||rf(A)?(x=C,rf(C)?x=re(C,kf(C)):lb(C)&&!qi(C)||(x=Kl(A))):_e=!1}_e&&(p.set(A,x),tm(x,A,i,o,p),p.delete(A)),pi(e,g,x)}}else(C=o?o(oi(e,g),p,g+"",e,r,h):void 0)===void 0&&(C=p),pi(e,g,C)},kf)}function Rt(e){var r=1,i=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?r=1>=arguments.length?void 0:arguments[1]:i=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(r=1>=arguments.length?void 0:arguments[1],i=2>=arguments.length?void 0:arguments[2]);var o=r||1;return function(h){return h.pipe(xg(function(p,g){var C=i.now(),A=C-e;if((p=p.filter(function(cN){return cN.until>A})).length>=o){var x=p[p.length-1],_e=p[0].until+e*Math.floor(p.length/o);p.push({delay:x.until<C?_e-C:_e-x.until,until:_e,value:g})}else p.push({delay:0,until:C,value:g});return p},[]),ba(function(p){return p[p.length-1]}),ni(function(p){var g=bb(p.value);return p.delay?g.pipe(cd(p.delay,i)):g}))}}function St(e,r){var i=(r=r===void 0?{protocols:xm,makeWebSocket:ym}:r).protocols,o=i===void 0?xm:i,h=(r=r.makeWebSocket)===void 0?ym:r;return new Y(function(p){var g,C=new Pa,A=h(e,o),x=!1,_e=!1,cN=function(dN){if(g)throw x=!0,dN=Error("Web socket message factory function called more than once"),p.error(dN),dN;return g=dN.subscribe(function(fN){A.send(fN)}),C};return A.onopen=function(){_e?(x=!0,A.close()):p.next(cN)},A.onmessage=function(dN){C.next(dN.data)},A.onerror=function(dN){x=!0,p.error(Error(dN.message))},A.onclose=function(dN){x||(x=!0,_e?(p.complete(),C.complete()):p.error(Error(dN.code===1e3?"Normal closure":dN.reason)))},function(){_e=!0,g&&g.unsubscribe(),x||(x=!0,A.close())}})}function yg(){this._listeners={}}function zm(e){return typeof Float32Array<"u"?function(){function r(A,x,_e){p[0]=A,x[_e]=g[0],x[_e+1]=g[1],x[_e+2]=g[2],x[_e+3]=g[3]}function i(A,x,_e){p[0]=A,x[_e]=g[3],x[_e+1]=g[2],x[_e+2]=g[1],x[_e+3]=g[0]}function o(A,x){return g[0]=A[x],g[1]=A[x+1],g[2]=A[x+2],g[3]=A[x+3],p[0]}function h(A,x){return g[3]=A[x],g[2]=A[x+1],g[1]=A[x+2],g[0]=A[x+3],p[0]}var p=new Float32Array([-0]),g=new Uint8Array(p.buffer),C=g[3]===128;e.writeFloatLE=C?r:i,e.writeFloatBE=C?i:r,e.readFloatLE=C?o:h,e.readFloatBE=C?h:o}():function(){function r(o,h,p,g){var C=0>h?1:0;if(C&&(h=-h),h===0)o(0<1/h?0:2147483648,p,g);else if(isNaN(h))o(2143289344,p,g);else if(34028234663852886e22<h)o((C<<31|2139095040)>>>0,p,g);else if(11754943508222875e-54>h)o((C<<31|Math.round(h/1401298464324817e-60))>>>0,p,g);else{var A=Math.floor(Math.log(h)/Math.LN2);o((C<<31|A+127<<23|8388607&Math.round(h*Math.pow(2,-A)*8388608))>>>0,p,g)}}function i(o,h,p){return p=o(h,p),o=2*(p>>31)+1,h=p>>>23&255,p&=8388607,h===255?p?NaN:1/0*o:h===0?1401298464324817e-60*o*p:o*Math.pow(2,h-150)*(p+8388608)}e.writeFloatLE=r.bind(null,Am),e.writeFloatBE=r.bind(null,Bm),e.readFloatLE=i.bind(null,Cm),e.readFloatBE=i.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function r(A,x,_e){p[0]=A,x[_e]=g[0],x[_e+1]=g[1],x[_e+2]=g[2],x[_e+3]=g[3],x[_e+4]=g[4],x[_e+5]=g[5],x[_e+6]=g[6],x[_e+7]=g[7]}function i(A,x,_e){p[0]=A,x[_e]=g[7],x[_e+1]=g[6],x[_e+2]=g[5],x[_e+3]=g[4],x[_e+4]=g[3],x[_e+5]=g[2],x[_e+6]=g[1],x[_e+7]=g[0]}function o(A,x){return g[0]=A[x],g[1]=A[x+1],g[2]=A[x+2],g[3]=A[x+3],g[4]=A[x+4],g[5]=A[x+5],g[6]=A[x+6],g[7]=A[x+7],p[0]}function h(A,x){return g[7]=A[x],g[6]=A[x+1],g[5]=A[x+2],g[4]=A[x+3],g[3]=A[x+4],g[2]=A[x+5],g[1]=A[x+6],g[0]=A[x+7],p[0]}var p=new Float64Array([-0]),g=new Uint8Array(p.buffer),C=g[7]===128;e.writeDoubleLE=C?r:i,e.writeDoubleBE=C?i:r,e.readDoubleLE=C?o:h,e.readDoubleBE=C?h:o}():function(){function r(o,h,p,g,C,A){var x=0>g?1:0;if(x&&(g=-g),g===0)o(0,C,A+h),o(0<1/g?0:2147483648,C,A+p);else if(isNaN(g))o(0,C,A+h),o(2146959360,C,A+p);else if(17976931348623157e292<g)o(0,C,A+h),o((x<<31|2146435072)>>>0,C,A+p);else if(22250738585072014e-324>g)o((g/=5e-324)>>>0,C,A+h),o((x<<31|g/4294967296)>>>0,C,A+p);else{var _e=Math.floor(Math.log(g)/Math.LN2);_e===1024&&(_e=1023),o(4503599627370496*(g*=Math.pow(2,-_e))>>>0,C,A+h),o((x<<31|_e+1023<<20|1048576*g&1048575)>>>0,C,A+p)}}function i(o,h,p,g,C){return h=o(g,C+h),g=o(g,C+p),o=2*(g>>31)+1,h=4294967296*(1048575&g)+h,(p=g>>>20&2047)===2047?h?NaN:1/0*o:p===0?5e-324*o*h:o*Math.pow(2,p-1075)*(h+4503599627370496)}e.writeDoubleLE=r.bind(null,Am,0,4),e.writeDoubleBE=r.bind(null,Bm,4,0),e.readDoubleLE=i.bind(null,Cm,0,4),e.readDoubleBE=i.bind(null,Dm,4,0)}(),e}function Am(e,r,i){r[i]=255&e,r[i+1]=e>>>8&255,r[i+2]=e>>>16&255,r[i+3]=e>>>24}function Bm(e,r,i){r[i]=e>>>24,r[i+1]=e>>>16&255,r[i+2]=e>>>8&255,r[i+3]=255&e}function Cm(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24)>>>0}function Dm(e,r){return(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0}function Wa(e,r){this.lo=e>>>0,this.hi=r>>>0}function sf(e,r,i){this.fn=e,this.len=r,this.next=void 0,this.val=i}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,r,i){r[i]=255&e}function ui(e,r){this.len=e,this.next=void 0,this.val=r}function vi(e,r,i){for(;e.hi;)r[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)r[i++]=127&e.lo|128,e.lo>>>=7;r[i++]=e.lo}function wi(e,r,i){r[i]=255&e,r[i+1]=e>>>8&255,r[i+2]=e>>>16&255,r[i+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,r,i){40>e.length?V.utf8.write(e,r,i):r.utf8Write?r.utf8Write(e,i):r.write(e,i)}function Yb(e,r){return RangeError("index out of range: "+e.pos+" + "+(r||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),r=0;if(!(4<this.len-this.pos)){for(;3>r;++r){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*r)>>>0,e}for(;4>r;++r)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(r=0,4<this.len-this.pos){for(;5>r;++r)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>r;++r){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,r){return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,r,i){if(typeof e!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!r,this.responseDelimited=!!i}function za(e){return typeof e=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&e!=="null"}function Gm(e){try{var r=e.split(".").map(function(o){return Number(o)})}catch{return!1}if(r.length!==4||r[0]===0)return!1;for(e=0;e<r.length;e++){var i=r[e];if(!Number.isInteger(i)||0>i||255<i)return!1}return!0}function Hm(e,r){if(!Array.isArray(r)||r.length===0||32<r.length||r.some(function(i){return i.length===0||32<i.length}))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var r=e.attributes,i=e.attrSizeMap,o=e.maxAttrsCount,h=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(r))throw new I("attributes must be an object",Ja);if(Object.keys(r).length>o)throw new ib("Exceed the limit of ".concat(o," attributes"),se);if(Object.keys(r).length===0)throw new I("The attributes is an empty object",Ja);var p=0,g=0;for(r=Object.entries(r);g<r.length;g++){var C=ra(r[g],2),A=C[1];C=new Blob([C[0]]).size;var x=new Blob([A]).size;if(C===0||32<C)throw new I("Invalid attribute key",Ja);if(x>h)throw new ib("Invalid attribute value, over the limit of ".concat(h," bytes"),se);if(typeof A!="string"||A.length===0)throw new I("Invalid attribute value",Ja);p+=C,p+=x}if(p>e)throw new ib("The attributes size overflow",se);if(i!==void 0){if(Object.keys(i).length>o)throw new ib("Exceed the limit of ".concat(o," attributes"),se);for(p=o=0,i=Object.entries(i);p<i.length;p++){if(g=(r=ra(i[p],2))[1],(r=new Blob([r[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(g>h)throw new ib("Invalid attribute value, over the limit of ".concat(h," bytes"),se);o+=r,o+=g}if(o>e)throw new ib("The attributes size overflow",se)}}function Ag(e,r){return Math.floor(Math.random()*(Math.floor(r)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),r=Ag(1,4294967295);return new U(e,r,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,r){return new TypeError("Unexpected ".concat(e,": ").concat(r))}function Jm(e,r){return e=e.split(".").map(function(i){return Number(i)}),r=r.split(".").map(function(i){return Number(i)}),Math.sqrt(1e3*Math.pow(e[0]-r[0],2)+100*Math.pow(e[1]-r[1],2)+10*Math.pow(e[2]-r[2],2)+1*Math.pow(e[3]-r[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,r){r="".concat(e).concat(r||"");var i=Lm.get(r)||1;return Lm.set(r,i+1),"".concat(e).concat(i)}function Mm(e,r){var i=typeof r=="number"?r:r!==void 0&&typeof r!="string"?r.code:void 0;return r=typeof r!="number"&&typeof r!="string"&&r!==void 0&&r.serverCode!==void 0?r.serverCode:void 0,i="".concat(i!==void 0?" Error Code ".concat(i):"").concat(r!==void 0?", server Code ".concat(r):""),e=typeof e=="string"&&e?Cg(e):Array.isArray(e)&&typeof e[0]=="string"&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(i===""?"":"".concat(i," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function e(r){return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(o){setTimeout(function(){o()},r)}));case 1:case"end":return i.stop()}},e)}))).apply(this,arguments)}function Pm(e){return e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"}function Dg(e){var r=255&e,i=e>>8&255,o=e>>16&255;return"".concat(e>>24&255,".").concat(o,".").concat(i,".").concat(r)}function te(e,r,i){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function e(r,i,o){var h,p,g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH,vH,AH,UH,zH,CH,HH,VH,KH;return w.wrap(function(IH){for(;;)switch(IH.prev=IH.next){case 0:if(h=i.body,p=i.headers,g=p===void 0?{}:p,C=i.timeout,A=C===void 0?1e4:C,x=i.signal,_e=i.withCredentials,cN=_e!==void 0&&_e,dN=(o||{}).useBinaryResponse,fN=dN!==void 0&&dN,(mN=new XMLHttpRequest).open("POST",r,!0),mN.responseType=fN?"arraybuffer":"text",mN.withCredentials=cN,mN.timeout=A,EN=h instanceof FormData,RN=h instanceof Uint8Array,!(1<(IN=Object.keys(g).filter(function(MH){return MH.toLowerCase()==="content-type"})).length)){IH.next=14;break}throw new RangeError("multiple content-type");case 14:IN.length===0&&(RN?g["Content-Type"]="application/octet-stream":EN||(g["Content-Type"]="application/json"));case 15:if("setRequestHeader"in mN){IH.next=46;break}return mN.abort(),IH.next=19,fetch(r,{body:EN||RN?h:JSON.stringify(h),cache:"no-cache",credentials:cN?"include":"same-origin",headers:g,method:"POST",mode:"cors",referrer:"no-referrer",signal:x});case 19:if(t0=IH.sent,!(200<=(aH=t0.status)&&300>aH||aH===304)){IH.next=31;break}if(!fN){IH.next=27;break}return IH.next=25,t0.arrayBuffer();case 25:return pH=IH.sent,IH.abrupt("return",{status:aH,responseData:pH});case 27:return IH.next=29,t0.text();case 29:return SH=IH.sent,IH.abrupt("return",{status:aH,responseText:SH});case 31:return vH=new da(["Post XHR failure, status %d",aH]),IH.prev=32,IH.next=35,t0.text();case 35:throw AH=IH.sent,vH.statusCode=aH,vH.message=AH||"Request failed, status ".concat(aH),vH;case 41:throw IH.prev=41,IH.t0=IH.catch(32),vH.statusCode=aH,vH.message="Request failed, status ".concat(aH),vH;case 46:if(Object.keys(g).length!==0)for(UH=0,zH=Object.entries(g);UH<zH.length;UH++)CH=ra(zH[UH],2),HH=CH[0],VH=CH[1],mN.setRequestHeader(HH,VH);return x!==void 0&&(KH=function MH(){mN.abort(),x.removeEventListener("abort",MH)},x.addEventListener("abort",KH)),EN||RN?mN.send(h):mN.send(JSON.stringify(h)),IH.abrupt("return",new Promise(function(MH,GH){mN.onload=function(){var yH=mN.status;if(200<=yH&&300>yH||yH===304)MH(fN?{status:yH,responseData:mN.response}:{status:yH,responseText:mN.responseText});else{var TH=new da(["Post XHR failure, status %d",yH]);TH.statusCode=yH,TH.message=mN.response||"Request failed, status ".concat(mN.status),GH(TH)}},mN.ontimeout=function(yH){GH(new db(["XHR request timed out after %d ms",A],{originalError:yH}))},mN.onerror=function(){var yH=new da(["Post XHR failure, status %d",mN.status]);yH.statusCode=mN.status,yH.message=mN.response||"Request failed, status ".concat(mN.status),GH(yH)},mN.onabort=function(){try{GH(new DOMException("The request aborted.","AbortError"))}catch{var yH=Error("The request aborted.");yH.name="AbortError",GH(yH)}}}));case 50:case"end":return IH.stop()}},e,null,[[32,41]])}))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function e(r){var i;return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return(i=new Image).src=r,o.abrupt("return",new Promise(function(h,p){i.onload=function(){h({width:i.width,height:i.height})},i.onerror=p}));case 3:case"end":return o.stop()}},e)}))).apply(this,arguments)}function Xt(e,r){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function e(r,i){var o,h,p,g,C,A,x,_e,cN,dN;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:if(o=r.thumbnailHeight,h=o===void 0?0:o,p=r.thumbnailWidth,g=p===void 0?0:p,C=r.width,A=C===void 0?0:C,x=r.height,_e=x===void 0?0:x,cN=r.thumbnail,dN=[],typeof h=="number"&&typeof g=="number"&&typeof A=="number"&&typeof _e=="number"){fN.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=A&&0>=_e&&dN.push(Rm(Sm(i)).then(function(mN){A=mN.width,_e=mN.height})),0>=g&&0>=h&&cN!==void 0&&dN.push(Ji(cN).then(function(){var mN=J(w.mark(function EN(RN){var IN;return w.wrap(function(t0){for(;;)switch(t0.prev=t0.next){case 0:return t0.next=2,Rm(Sm(RN));case 2:IN=t0.sent,g=IN.width,h=IN.height;case 5:case"end":return t0.stop()}},EN)}));return function(EN){return mN.apply(this,arguments)}}())),fN.next=9,Promise.all(dN).catch(function(){});case 9:return fN.abrupt("return",{width:A,height:_e,thumbnailWidth:g,thumbnailHeight:h});case 10:case"end":return fN.stop()}},e)}))).apply(this,arguments)}function Tm(e,r){if(!yd(e))throw new I("message object is not a plain object",r);if(e.messageType===void 0)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",e.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",r)}else{if(typeof e.text!="string")throw new I("messageType is undefined",r);if(e.messageType="TEXT",e.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",r)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function e(r){var i,o,h,p,g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH,vH;return w.wrap(function(AH){for(;;)switch(AH.prev=AH.next){case 0:if(i=r.message,o=r.peerId,h=r.toPeer,p=r.session,g=r.errorCodes,C=r.diff,A=r.logger,x=r.options,p!==void 0){AH.next=3;break}throw new K("The client is not logged in. Cannot do the operation",g.NOT_LOGGED_IN);case 3:if(_e=!1,i.messageType!=="TEXT"||!i.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!h){AH.next=11;break}if(cN=i.text.split("_"),dN=ra(cN,3),fN=dN[0],mN=dN[1],dN[2]!==void 0&&za(mN)&&fN==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){AH.next=10;break}throw new I("Message is not valid",ve);case 10:_e=!0;case 11:if(EN=Date.now(),RN=p.messageSentTimes.length-1,!((IN=p.messageSentTimes[RN])&&IN+3e3<EN)){AH.next=18;break}p.messageSentTimes=[EN],AH.next=29;break;case 18:t0=RN;case 19:if(!(0<=t0)){AH.next=28;break}if(!(p.messageSentTimes[t0]+3e3<EN)){AH.next=23;break}return p.messageSentTimes=p.messageSentTimes.slice(t0+1,RN+1),AH.abrupt("break",28);case 23:if(!(180<=RN-t0+1)){AH.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",g.TOO_OFTEN);case 25:t0--,AH.next=19;break;case 28:p.messageSentTimes.push(EN);case 29:AH.t0=i.messageType,AH.next=AH.t0==="TEXT"?32:AH.t0==="RAW"?37:AH.t0==="FILE"||AH.t0==="IMAGE"?39:40;break;case 32:if(!_e){AH.next=36;break}return aH=i.text.split("_"),pH=ra(aH,3),SH=pH[1],vH=pH[2],A.info("[rtm-API] EndCall message send api is called"),AH.abrupt("return",p.sendInvitationMessage({peerId:o,type:"CallCancel",extra:vH,channelId:SH,callId:"0"}));case 36:return AH.abrupt("return",p.sendTextMessage(i.text,o,h,x,1e4-C));case 37:return i.description===void 0&&(i.description=""),AH.abrupt("return",p.sendRawMessage(i.rawMessage,i.description,o,h,x,1e4-C));case 39:return AH.abrupt("return",p.sendMediaMessage(i.messageType,i,o,h,x,1e4-C));case 40:throw new I("Invalid message type",ve);case 41:case"end":return AH.stop()}},e)}))).apply(this,arguments)}function Yt(e){var r=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],i=e.replace(/(https?:\/\/)?(www.)?/i,"");return r||(i=i.split(".").slice(e.length-2).join(".")),i.indexOf("/")!==-1?i.split("/")[0]:i}function oa(e){if(typeof e!="string")return"[Sensitive Info]";var r=Math.floor(.7*e.length),i=e.length;return Um(e,r,i,"*".repeat(i-r))}function Vm(e,r,i){function o(h){if(e===void 0)return e;if(Il(h))return h;if(Array.isArray(h))return h.map(o);var p={},g=0;for(h=Hg(h);g<h.length;g++){var C=ra(h[g],2),A=C[0];if(typeof(C=C[1])=="string"&&i.includes(A)){p[A]=typeof C=="string"?oa(C):"[Sensitive Info]";break}r.includes(A)?p[A]="[Hidden Info]":p[A]=C==null?C:i.includes(A)?"[Sensitive Info]":o(C)}return p}return Array.isArray(e)?e.map(o):o(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach(function(r){X(r=e[r])=="object"&&r!==null&&Wm(r)}),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return new TextEncoder().encode(e).length}function Xm(){for(var e=0,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];for(r=0;r<i.length;r++)e+=i[r].length;for(e=new Uint8Array(e),o=r=0;o<i.length;o++){var h=i[o];e.set(h,r),r+=h.length}return e}function we(e,r,i){var o=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=o==null?void 0:o[1],o=o==null?void 0:o[2]){var h;for(o=o.substr(1).split("&"),h=0;h<o.length;h++)if(o[h].split("=")[0]==r){o[h]=r+"="+encodeURIComponent(i);break}return h==o.length&&o.push(r+"="+encodeURIComponent(i)),e+"?"+o.join("&")}return e+"?"+r+"="+encodeURIComponent(i)}function Ji(e){return new Promise(function(r,i){var o=new FileReader;o.onloadend=function(){var h=o.result||new ArrayBuffer(0);r(h)},o.onerror=i,o.readAsArrayBuffer(e)})}function Zt(e,r){e=e=[e],typeof(r=r||{})=="string"&&(r={type:r});try{var i=new Blob(e,r)}catch(h){if(h.name!=="TypeError")throw h;i=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var o=0;o<e.length;o+=1)i.append(e[o]);i=i.getBlob(r.type)}return i}function Um(e,r,i,o){return typeof e!="string"?"[Sensitive Info]":e.substring(0,r)+o+e.substring(i)}function Ym(e){var r=[];return function i(o){if(o===null||X(o)!=="object")return o;if(r.indexOf(o)!==-1)return"[Circular]";if(r.push(o),typeof o.toJSON=="function")try{var h=i(o.toJSON());return r.pop(),h}catch(p){return"[Throws: "+(p?p.message:"?")+"]"}return Array.isArray(o)?(h=o.map(i),r.pop(),h):(h=Object.keys(o).reduce(function(p,g){e:{if($t.call(o,g))try{var C=o[g];break e}catch(A){C="[Throws: "+(A?A.message:"?")+"]";break e}C=o[g]}return p[g]=i(C),p},{}),r.pop(),h)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var r=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}function Jg(e,r,i,o){return Math.round(e/i)+" "+o+(r>=1.5*i?"s":"")}function bu(e){var r=e.areas,i=e.excludedArea;if(r.length===1&&r[0]===F.GLOBAL&&i===F.CHINA)return xe([F.OVERSEA]);if(r.includes(F.GLOBAL)){if(e=xf(Kg).filter(function(p){return p!==F.GLOBAL&&p!==F.OVERSEA}),i in yf){r=yf[i];var o=[].concat(G(r??[]),[i]);return xe(e.filter(function(p){return!o.includes(p)}))}if(Zm(i)){var h=cu(i);return xe(e.filter(function(p){return p!==i&&p!==h}))}}if(Zm(i)||i in yf)return xe(r);throw new I("Invalid excludedArea area config")}function Ma(e,r,i){i===void 0&&(i=Object.getOwnPropertyDescriptor(e,r));var o=i.value;return i.value=function(){for(var h=this,p=arguments.length,g=Array(p),C=0;C<p;C++)g[C]=arguments[C];this.invokeTracker.apply(this,["%s: ".concat(0<g.length?"%s with args: ".concat(g.map(function(){return"%o"})):"%s"),this.name,r].concat(G(g.map(ye))));try{var A=o.apply(this,g)}catch(_e){throw this.logError.apply(this,["".concat(_e.code!==void 0?"Error Code ".concat(_e.code,": "):"","%s failed").concat(0<g.length?" with args: ".concat(g.map(function(){return"%o"})):""),r].concat(G(g.map(ye)))),_e.originalError&&this.logError(_e.originalError),this.errorTracker(_e),_e}var x=Date.now();return J(w.mark(function _e(){var cN,dN;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:return fN.prev=0,fN.next=3,A;case 3:cN=fN.sent,fN.next=12;break;case 6:return fN.prev=6,fN.t0=fN.catch(0),h.logError.apply(h,["".concat(fN.t0.code!==void 0?"Error Code ".concat(fN.t0.code,": "):"","%s failed").concat(0<g.length?" with args: ".concat(g.map(function(){return"%o"})):""),r].concat(G(g.map(ye)))),fN.t0.originalError&&h.logError(fN.t0.originalError),h.errorTracker(fN.t0),fN.abrupt("return");case 12:cN!==A?cN===void 0?h.resultTracker("%s promise resolves after %dms",r,Date.now()-x):h.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-x,ye(cN)):Ac(cN)!=="Object"||yd(cN)?h.resultTracker("%s result is %o",r,ye(cN)):h.resultTracker("%s result is %s",r,cN.name||((dN=cN.constructor)===null||dN===void 0?void 0:dN.name));case 13:case"end":return fN.stop()}},_e,null,[[0,6]])}))(),A},i}function Nb(e,r,i){i===void 0&&(i=Object.getOwnPropertyDescriptor(e,r));var o=i.value;return i.value=function(){for(var h=this,p=arguments.length,g=Array(p),C=0;C<p;C++)g[C]=arguments[C];this.invokeTracker.apply(this,["%s: ".concat(0<g.length?"%s with args: ".concat(g.map(function(){return"%o"})):"%s"),this.name,r].concat(g));try{var A=o.apply(this,g)}catch(_e){throw this.logError.apply(this,["".concat(_e.code!==void 0?"Error Code ".concat(_e.code,": "):"","%s failed").concat(0<g.length?" with args: ".concat(g.map(function(){return"%o"})):""),r].concat(g)),_e.originalError&&this.logError(_e.originalError),this.errorTracker(_e),_e}var x=Date.now();return J(w.mark(function _e(){var cN,dN;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:return fN.prev=0,fN.next=3,A;case 3:cN=fN.sent,fN.next=12;break;case 6:return fN.prev=6,fN.t0=fN.catch(0),h.logError.apply(h,["".concat(fN.t0.code!==void 0?"Error Code ".concat(fN.t0.code,": "):"","%s failed").concat(0<g.length?" with args: ".concat(g.map(function(){return"%o"})):""),r].concat(g)),fN.t0.originalError&&h.logError(fN.t0.originalError),h.errorTracker(fN.t0),fN.abrupt("return");case 12:cN!==A?cN===void 0?h.resultTracker("%s promise resolves after %dms",r,Date.now()-x):h.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-x,cN):Ac(cN)!=="Object"||yd(cN)?h.resultTracker("%s result is %o",r,cN):h.resultTracker("%s result is %s",r,cN.name||((dN=cN.constructor)===null||dN===void 0?void 0:dN.name));case 13:case"end":return fN.stop()}},_e,null,[[0,6]])}))(),A},i}function du(e,r){var i="".concat(e,"Uri");if(typeof(i=Li[i])!="number"||i===0)throw new TypeError("Got Unknown URI Name");return r=new(e=$m[e])(r),r=e.encode(r).finish(),new eu({uri:i,data:r})}function an(e,r){return"".concat(e.split(".").join("-"),".edge.").concat(r?"sd-rtn.com":"agora.io")}function eb(e,r,i){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function e(r,i,o){var h,p;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:g.next=2;break;case 2:return h=fu[r].encode(i).finish(),p=function(){var C=J(w.mark(function A(x){var _e,cN,dN,fN=arguments;return w.wrap(function(mN){for(;;)switch(mN.prev=mN.next){case 0:if(!(3<(cN=1<fN.length&&fN[1]!==void 0?fN[1]:0))){mN.next=3;break}return mN.abrupt("return");case 3:return dN=we(dN=o?"https://".concat((_e=M==null?void 0:M.PROXY_NGINX[0])!==null&&_e!==void 0?_e:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(x,"&p=6443&d=events/proto-raw"):"https://".concat(x,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),dN=we(dN,"id",gu[r].toString()),mN.next=8,te(dN,{body:h,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(EN){return p(x,cN+1)});case 8:case"end":return mN.stop()}},A)}));return function(A){return C.apply(this,arguments)}}(),g.prev=4,g.next=7,p((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:g.next=13;break;case 9:return g.prev=9,g.t0=g.catch(4),g.next=13,p(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return g.stop()}},e,null,[[4,9]])}))).apply(this,arguments)}function fb(e){return e===void 0?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(r){return parseInt(r,16)}))).replace(/={1,2}$/,"")}function Lg(e,r){return U.fromValue(e).eq(r)}function Mg(e,r){var i=r===void 0?e.val:r,o=e.isBoolean;r=e.isNumber;var h=e.oneof,p=e.len;if([o,r,h].filter(function(g){return!g}).length!==2)throw new TypeError("invalid field type");if(i!==void 0&&(e=!1,h!==void 0&&(h=Ni(h),iu(h,Lg).length===h.length&&ju(h,function(g){return Lg(i,g)})!==void 0&&(e=!0)),o=o!==void 0&&(i===0||i===1)&&p===1,r=r!==void 0&&i.toString(2).length<=p,!(e||o||r)))throw Error("invalid field value")}function cn(e){return function(){var r=e();if(!r)throw new K("Client is not logged in. Cannot do the operation");return r}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return Zb(e)=="String"?lu.call(e,""):Object(e)}:Object,jb=function(e){if(e==null)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return typeof e=="object"?e!==null:typeof e=="function"},lc=function(e,r){if(!ha(e))return e;var i,o;if(r&&typeof(i=e.toString)=="function"&&!ha(o=i.call(e))||typeof(i=e.valueOf)=="function"&&!ha(o=i.call(e))||!r&&typeof(i=e.toString)=="function"&&!ha(o=i.call(e)))return o;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,r){return mu.call(Qa(e),r)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,r){if(e=qb(e),r=lc(r,!0),fn)try{return gn(e,r)}catch{}if(Q(e,r))return dd(!zf.call(e,r),e[r])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,r,i){if(va(e),r=lc(r,!0),va(i),fn)try{return hn(e,r,i)}catch{}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(e[r]=i.value),e}},Na=ka?function(e,r,i){return Ra.f(e,r,dd(1,i))}:function(e,r,i){return e[r]=i,e},Oi=function(e,r){try{Na(y,e,r)}catch{y[e]=r}return r},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(e){(e.exports=function(r,i){return ed[r]||(ed[r]=i!==void 0?i:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(e===void 0?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,r){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return r.facade=e,tu.call(Gd,e,r),r},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,r){if(Q(e,Ce))throw new TypeError("Object already initialized");return r.facade=e,Na(e,Ce,r),r},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(r){var i;if(!ha(r)||(i=Qg(r)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return i}}},Ta=$a(function(e){var r=Za.get,i=Za.enforce,o=String(String).split("String");(e.exports=function(h,p,g,C){var A=!!C&&!!C.unsafe,x=!!C&&!!C.enumerable;if(C=!!C&&!!C.noTargetGet,typeof g=="function"){typeof p!="string"||Q(g,"name")||Na(g,"name",p);var _e=i(g);_e.source||(_e.source=o.join(typeof p=="string"?p:""))}h===y?x?h[p]=g:Oi(p,g):(A?!C&&h[p]&&(x=!0):delete h[p],x?h[p]=g:Na(h,p,g))})(Function.prototype,"toString",function(){return typeof this=="function"&&r(this).source||Pi(this)})}),mn=function(e){return typeof e=="function"?e:void 0},mc=function(e,r){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][r]||y[e]&&y[e][r]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,r){return 0>(e=$b(e))?xu(e+r,0):yu(e,r)},nn=function(e){return function(r,i,o){r=qb(r);var h=ta(r.length);if(o=xb(o,h),e&&i!=i){for(;h>o;)if((i=r[o++])!=i)return!0}else for(;h>o;o++)if((e||o in r)&&r[o]===i)return e||o||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,r){e=qb(e);var i,o=0,h=[];for(i in e)!Q(Be,i)&&Q(e,i)&&h.push(i);for(;r.length>o;)Q(e,i=r[o++])&&(~Si(h,i)||h.push(i));return h},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var r=Hd.f(va(e)),i=Bf.f;return i?r.concat(i(e)):r},rn=function(e,r){for(var i=qn(r),o=Ra.f,h=Fb.f,p=0;p<i.length;p++){var g=i[p];Q(e,g)||o(e,g,h(r,g))}},Au=/#|\.prototype\./,nc=function(e,r){return(e=Bu[Cu(e)])==Du||e!=Eu&&(typeof r=="function"?R(r):!!r)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,r){var i,o,h,p=e.target,g=e.global,C=e.stat;if(o=g?y:C?y[p]||Oi(p,{}):(y[p]||{}).prototype)for(h in r){var A=r[h],x=e.noTargetGet?(i=Fu(o,h))&&i.value:o[h];if(!(i=nc(g?h:p+(C?".":"#")+h,e.forced))&&x!==void 0){if(typeof A==typeof x)continue;rn(A,x)}(e.sham||x&&x.sham)&&Na(A,"sham",!0);try{Ta(o,h,A,e)}catch{}}},yb=function(e){if(typeof e!="function")throw TypeError(String(e)+" is not a function");return e},Id=function(e,r,i){if(yb(e),r===void 0)return e;switch(i){case 0:return function(){return e.call(r)};case 1:return function(o){return e.call(r,o)};case 2:return function(o,h){return e.call(r,o,h)};case 3:return function(o,h,p){return e.call(r,o,h,p)}}return function(){return e.apply(r,arguments)}},gd=Array.isArray||function(e){return Zb(e)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||typeof Cf[e]=="string")||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,r){if(gd(e)){var i=e.constructor;typeof i!="function"||i!==Array&&!gd(i.prototype)?ha(i)&&(i=i[Hu])===null&&(i=void 0):i=void 0}return new(i===void 0?Array:i)(r===0?0:r)},wn=[].push,jd=function(e){var r=e==1,i=e==2,o=e==3,h=e==4,p=e==6,g=e==7,C=e==5||p;return function(A,x,_e,cN){var dN=Qa(A),fN=Af(dN);x=Id(x,_e,3),_e=ta(fN.length);var mN,EN=0;for(cN=cN||Sg,A=r?cN(A,_e):i||g?cN(A,0):void 0;_e>EN;EN++)if((C||EN in fN)&&(mN=x(cN=fN[EN],EN,dN),e))if(r)A[EN]=mN;else if(mN)switch(e){case 3:return!0;case 5:return cN;case 6:return EN;case 2:wn.call(A,cN)}else switch(e){case 4:return!1;case 7:wn.call(A,cN)}return p?-1:o||h?h:A}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(e){return 51<=id||!R(function(){var r=[];return(r.constructor={})[Ku]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,r){var i=[][e];return!!i&&R(function(){i.call(null,r||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),e===void 0?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var r=e.return;if(r!==void 0)return va(r.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return e!==void 0&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,r,i){(r=lc(r))in e?Ra.f(e,r,dd(0,i)):e[r]=i},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(e){var r;if(e===void 0)var i="Undefined";else{if(e===null)var o="Null";else{e:{var h=e=Object(e);try{o=h[Uu];break e}catch{}o=void 0}o=typeof(i=o)=="string"?i:Vu?Zb(e):(r=Zb(e))=="Object"&&typeof e.callee=="function"?"Arguments":r}i=o}return i},Wu=qa("iterator"),Xi=function(e){if(e!=null)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(e){}var Tg=function(e,r){if(!r&&!Dn)return!1;var i=!1;try{(r={})[Cn]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},Yu=!Tg(function(e){Array.from(e)});N({target:"Array",stat:!0,forced:Yu},{from:function(e){var r,i=Qa(e),o=typeof this=="function"?this:Array,h=arguments.length,p=1<h?arguments[1]:void 0,g=p!==void 0,C=Xi(i),A=0;if(g&&(p=Id(p,2<h?arguments[2]:void 0,2)),C==null||o==Array&&Vi(C)){var x=ta(i.length);for(o=new o(x);x>A;A++)C=g?p(i[A],A):i[A],Ge(o,A,C)}else for(h=(i=C.call(i)).next,o=new o;!(r=h.call(i)).done;A++){if(g){C=i;var _e=p;r=[r.value,A];try{x=_e(va(r)[0],r[1])}catch(cN){throw Ui(C),cN}}else x=r.value;Ge(o,A,C=x)}return o.length=A,o}});var Fn=function(e){return function(r,i){r=String(jb(r)),i=$b(i);var o,h=r.length;if(0>i||i>=h)return e?"":void 0;var p=r.charCodeAt(i);return 55296>p||56319<p||i+1===h||56320>(o=r.charCodeAt(i+1))||57343<o?e?r.charAt(i):p:e?r.slice(i,i+2):o-56320+(p-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var e={};return Kd[Yi].call(e)!==e}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,r){va(e);for(var i,o=Dc(r),h=o.length,p=0;h>p;)Ra.f(e,i=o[p++],r[i]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,r){if(e!==null){$i.prototype=va(e);var i=new $i;$i.prototype=null,i[Mn]=e}else i=Wg();return r===void 0?i:av(i,r)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,r,i){e&&!Q(e=i?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:r})},cv=function(){return this},dv=function(e,r,i){return r+=" Iterator",e.prototype=ac(Ug,{next:dd(1,i)}),Ec(e,r,!1),Fe[r]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,r={};try{var i=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;i.call(r,[]),e=r instanceof Array}catch{}return function(o,h){if(va(o),!ha(h)&&h!==null)throw TypeError("Can't set "+String(h)+" as a prototype");return e?i.call(o,h):o.__proto__=h,o}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,r,i,o,h,p,g){dv(i,r,o),o=function(EN){if(EN===h&&dN)return dN;if(!Vg&&EN in _e)return _e[EN];switch(EN){case"keys":case"values":case"entries":return function(){return new i(this,EN)}}return function(){return new i(this)}};var C,A=r+" Iterator",x=!1,_e=e.prototype,cN=_e[Gf]||_e["@@iterator"]||h&&_e[h],dN=!Vg&&cN||o(h),fN=r=="Array"&&_e.entries||cN;if(fN&&(e=Vb(fN.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):typeof e[Gf]!="function"&&Na(e,Gf,ev)),Ec(e,A,!0))),h=="values"&&cN&&cN.name!=="values"&&(x=!0,dN=function(){return cN.call(this)}),_e[Gf]!==dN&&Na(_e,Gf,dN),Fe[r]=dN,h){var mN={values:o("values"),keys:p?dN:o("keys"),entries:o("entries")};if(g)for(C in mN)!Vg&&!x&&C in _e||Ta(_e,C,mN[C]);else N({target:r,proto:!0,forced:Vg||x},mN)}return mN},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(e){fv(this,{type:"String Iterator",string:String(e),index:0})},function(){var e=gv(this),r=e.string,i=e.index;return i>=r.length?{value:void 0,done:!0}:(r=Gn(r,i),e.index+=r.length,{value:r,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var r=String(jb(this)),i="";if(0>(e=$b(e))||e==1/0)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(r+=r))1&e&&(i+=r);return i};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,r,i){for(var o in r)Ta(e,o,r[o],i);return e},Qn=qa("species"),If=function(e){e=mc(e);var r=Ra.f;ka&&e&&!e[Qn]&&r(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,r,i){if(!(e instanceof r))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return e},Jf=function(e,r){this.stopped=e,this.result=r},Xg=function(e,r,i){var o,h=!(!i||!i.AS_ENTRIES),p=!(!i||!i.IS_ITERATOR),g=!(!i||!i.INTERRUPTED),C=Id(r,i&&i.that,1+h+g),A=function(_e){return x&&Ui(x),new Jf(!0,_e)};if(r=function(_e){return h?(va(_e),g?C(_e[0],_e[1],A):C(_e[0],_e[1])):g?C(_e,A):C(_e)},p)var x=e;else{if(typeof(p=Xi(e))!="function")throw TypeError("Target is not iterable");if(Vi(p)){for(p=0,i=ta(e.length);i>p;p++)if((o=r(e[p]))&&o instanceof Jf)return o;return new Jf(!1)}x=p.call(e)}for(e=x.next;!(p=e.call(x)).done;){try{o=r(p.value)}catch(_e){throw Ui(x),_e}if(typeof o=="object"&&o&&o instanceof Jf)return o}return new Jf(!1)},iv=qa("species"),kd=function(e,r){var i;return(e=va(e).constructor)===void 0||(i=va(e)[iv])==null?r:yb(i)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var r=Kf[e];delete Kf[e],r()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var r=[],i=1;arguments.length>i;)r.push(arguments[i++]);return Kf[++gj]=function(){(typeof e=="function"?e:Function(e)).apply(void 0,r)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var r=Md.fn;Md=Md.next;try{r()}catch(i){throw Md?$g():Mf=void 0,i}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var r,i;this.promise=new e(function(o,h){if(r!==void 0||i!==void 0)throw TypeError("Bad Promise constructor");r=o,i=h}),this.resolve=yb(r),this.reject=yb(i)},lj={f:function(e){return new nv(e)}},mj=function(e,r){return va(e),ha(r)&&r.constructor===e?r:((0,(e=lj.f(e)).resolve)(r),e.promise)},ov=function(e,r){var i=y.console;i&&i.error&&(arguments.length===1?i.error(e):i.error(e,r))},nj=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var e=Pi(zb)!==String(zb);if(!e&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var r=new zb(function(o){o(1)}),i=function(o){o(function(){},function(){})};return(r.constructor={})[qv]=i,!(jo=r.then(function(){})instanceof i)||!e&&pv&&!io}),vv=Nf||!Tg(function(e){zb.all(e).catch(function(){})}),ko=function(e){var r;return!(!ha(e)||typeof(r=e.then)!="function")&&r},qj=function(e,r){if(!e.notified){e.notified=!0;var i=e.reactions;fo(function(){for(var o=e.value,h=e.state==1,p=0;i.length>p;){var g,C=i[p++],A=h?C.ok:C.fail,x=C.resolve,_e=C.reject,cN=C.domain;try{if(A){if(h||(e.rejection===2&&wv(e),e.rejection=1),A===!0)var dN=o;else if(cN&&cN.enter(),dN=A(o),cN){cN.exit();var fN=!0}dN===C.promise?_e(ho("Promise-chain cycle")):(g=ko(dN))?g.call(dN,x,_e):x(dN)}else _e(o)}catch(mN){cN&&!fN&&cN.exit(),_e(mN)}}e.reactions=[],e.notified=!1,r&&!e.rejection&&xv(e)})}},lo=function(e,r,i){var o;if(uv){var h=oj.createEvent("Event");h.promise=r,h.reason=i,h.initEvent(e,!1,!0),y.dispatchEvent(h)}else h={promise:r,reason:i};!io&&(o=y["on"+e])?o(h):e==="unhandledrejection"&&ov("Unhandled promise rejection",i)},xv=function(e){jj.call(y,function(){var r=e.facade,i=e.value;if(e.rejection!==1&&!e.parent){var o=nj(function(){Hc?pj.emit("unhandledRejection",i,r):lo("unhandledrejection",r,i)});if(e.rejection=Hc||e.rejection!==1&&!e.parent?2:1,o.error)throw o.value}})},wv=function(e){jj.call(y,function(){var r=e.facade;Hc?pj.emit("rejectionHandled",r):lo("rejectionhandled",r,e.value)})},Ie=function(e,r,i){return function(o){e(r,o,i)}},Je=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,qj(e,!0))},rj=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw ho("Promise can't be resolved itself");var o=ko(r);o?fo(function(){var h={done:!1};try{o.call(r,Ie(rj,h,e),Ie(Je,h,e))}catch(p){Je(h,p,e)}}):(e.value=r,e.state=1,qj(e,!1))}catch(h){Je({done:!1},h,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var r=go(this);try{e(Ie(rj,r),Ie(Je,r))}catch(i){Je(r,i)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,r){var i=sv(this),o=He(kd(this,zb));return o.ok=typeof e!="function"||e,o.fail=typeof r=="function"&&r,o.domain=Hc?pj.domain:void 0,i.parent=!0,i.reactions.push(o),i.state!=0&&qj(i,!1),o.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,r=go(e);this.promise=e,this.resolve=Ie(rj,r),this.reject=Ie(Je,r)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(e,r){var i=this;return new zb(function(o,h){Av.call(i,o,h)}).then(e,r)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var r=He(this);return r.reject.call(void 0,e),r.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var r=this,i=He(r),o=i.resolve,h=i.reject,p=nj(function(){var g=yb(r.resolve),C=[],A=0,x=1;Xg(e,function(_e){var cN=A++,dN=!1;C.push(void 0),x++,g.call(r,_e).then(function(fN){dN||(dN=!0,C[cN]=fN,--x||o(C))},h)}),--x||o(C)});return p.error&&h(p.value),i.promise},race:function(e){var r=this,i=He(r),o=i.reject,h=nj(function(){var p=yb(r.resolve);Xg(e,function(g){p.call(r,g).then(i.resolve,o)})});return h.error&&o(h.value),i.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),r="";return e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.sticky&&(r+="y"),r},pc=R(function(){var e=RegExp("a","y");return e.lastIndex=2,e.exec("abcd")!=null}),Cv=R(function(){var e=RegExp("^r","gy");return e.lastIndex=2,e.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(e){var r,i=po&&this.sticky,o=tj.call(this),h=this.source,p=0,g=e;if(i){(o=o.replace("y","")).indexOf("g")===-1&&(o+="g"),g=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&e[this.lastIndex-1]!==`
`)&&(h="(?: "+h+")",g=" "+g,p++);var C=new RegExp("^(?:"+h+")",o)}if(vj&&(C=new RegExp("^"+h+"$(?!\\s)",o)),uj)var A=this.lastIndex;var x=ch.call(i?C:this,g);return i?x?(x.input=x.input.slice(p),x[0]=x[0].slice(p),x.index=this.lastIndex,this.lastIndex+=x[0].length):this.lastIndex=0:uj&&x&&(this.lastIndex=this.global?x.index+x[0].length:A),vj&&x&&1<x.length&&Dv.call(x[0],C,function(){for(r=1;r<arguments.length-2;r++)arguments[r]===void 0&&(x[r]=void 0)}),x});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var e=/./;return e.exec=function(){var r=[];return r.groups={a:"7"},r},"".replace(e,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var e=/(?:)/,r=e.exec;return e.exec=function(){return r.apply(this,arguments)},(e="ab".split(e)).length!==2||e[0]!=="a"||e[1]!=="b"}),dh=function(e,r,i,o){var h=qa(e),p=!R(function(){var x={};return x[h]=function(){return 7},""[e](x)!=7}),g=p&&!R(function(){var x=!1,_e=/a/;return e==="split"&&((_e={constructor:{}}).constructor[Ev]=function(){return _e},_e.flags="",_e[h]=/./[h]),_e.exec=function(){return x=!0,null},_e[h](""),!x});if(!p||!g||e==="replace"&&(!Fv||!qo||so)||e==="split"&&!Gv){var C=/./[h],A=(i=i(h,""[e],function(x,_e,cN,dN,fN){var mN=_e.exec;return mN===Of||mN===wj.exec?p&&!fN?{done:!0,value:C.call(_e,cN,dN)}:{done:!0,value:x.call(cN,_e,dN)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,i[0]),Ta(wj,h,r==2?function(x,_e){return A.call(x,this,_e)}:function(x){return A.call(x,this)})}o&&Na(wj[h],"sham",!0)},xj=function(e,r,i){return r+(i?Gn(e,r).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,r,i,o,h,p){var g=i+e.length,C=o.length,A=Kv;return h!==void 0&&(h=Qa(h),A=Jv),Iv.call(p,A,function(x,_e){switch(_e.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,i);case"'":return r.slice(g);case"<":x=h[_e.slice(1,-1)];break;default:var cN=+_e;if(cN===0)return x;if(cN>C)return(cN=Hv(cN/10))===0?x:cN<=C?o[cN-1]===void 0?_e.charAt(1):o[cN-1]+_e.charAt(1):x;x=o[cN-1]}return x===void 0?"":x})},Ke=function(e,r){var i=e.exec;if(typeof i=="function"){if(typeof(e=i.call(e,r))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return e}if(Zb(e)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,r)},Mv=Math.max,Nv=Math.min,Ov=function(e){return e===void 0?e:String(e)};dh("replace",2,function(e,r,i,o){var h=o.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,p=o.REPLACE_KEEPS_$0,g=h?"$":"$0";return[function(C,A){var x=jb(this),_e=C==null?void 0:C[e];return _e!==void 0?_e.call(C,x,A):r.call(String(x),C,A)},function(C,A){if(!h&&p||typeof A=="string"&&A.indexOf(g)===-1){var x=i(r,C,this,A);if(x.done)return x.value}var _e=va(C);C=String(this),(x=typeof A=="function")||(A=String(A));var cN=_e.global;if(cN){var dN=_e.unicode;_e.lastIndex=0}for(var fN=[];;){var mN=Ke(_e,C);if(mN===null||(fN.push(mN),!cN))break;String(mN[0])===""&&(_e.lastIndex=xj(C,ta(_e.lastIndex),dN))}for(dN="",cN=_e=0;cN<fN.length;cN++){mN=fN[cN];for(var EN=String(mN[0]),RN=Mv(Nv($b(mN.index),C.length),0),IN=[],t0=1;t0<mN.length;t0++)IN.push(Ov(mN[t0]));mN=mN.groups,x?(IN=[EN].concat(IN,RN,C),mN!==void 0&&IN.push(mN),mN=String(A.apply(void 0,IN))):mN=Lv(EN,C,RN,IN,mN,A),RN>=_e&&(dN+=C.slice(_e,RN)+mN,_e=RN+EN.length)}return dN+C.slice(_e)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,r){var i=qb(this),o=ta(i.length);if(e=xb(e,o),r=xb(r===void 0?o:r,o),gd(i)){var h=i.constructor;if(typeof h!="function"||h!==Array&&!gd(h.prototype)?ha(h)&&(h=h[Qv])===null&&(h=void 0):h=void 0,h===Array||h===void 0)return Rv.call(i,e,r)}for(h=new(h===void 0?Array:h)(Sv(r-e,0)),o=0;e<r;e++,o++)e in i&&Ge(h,o,i[e]);return h.length=o,h}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(e,r){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:r})},function(){var e=Uv(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,{value:void 0,done:!0}):i=="keys"?{value:o,done:!1}:i=="values"?{value:r[o],done:!1}:{value:[o,r[o]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(e){if(e===void 0)return 0;e=$b(e);var r=ta(e);if(e!==r)throw RangeError("Wrong length or index");return r},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var r=Qa(this),i=ta(r.length),o=arguments.length,h=xb(1<o?arguments[1]:void 0,i);for(i=(o=2<o?arguments[2]:void 0)===void 0?i:xb(o,i);i>h;)r[h++]=e;return r},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,r,i){var o,h=Array(i),p=(1<<(i=8*i-r-1))-1,g=p>>1,C=r===23?Ic(2,-24)-Ic(2,-77):0,A=0>e||e===0&&0>1/e?1:0,x=0;if((e=Vv(e))!=e||e===1/0){e=e!=e?1:0;var _e=p}else _e=Wv(Xv(e)/Yv),1>e*(o=Ic(2,-_e))&&(_e--,o*=2),2<=(e=1<=_e+g?e+C/o:e+C*Ic(2,1-g))*o&&(_e++,o/=2),_e+g>=p?(e=0,_e=p):1<=_e+g?(e=(e*o-1)*Ic(2,r),_e+=g):(e=e*Ic(2,g-1)*Ic(2,r),_e=0);for(;8<=r;h[x++]=255&e,e/=256,r-=8);for(_e=_e<<r|e,i+=r;0<i;h[x++]=255&_e,_e/=256,i-=8);return h[--x]|=128*A,h},xo=function(e,r){var i=e.length,o=8*i-r-1,h=(1<<o)-1,p=h>>1;o-=7,--i;var g=e[i--],C=127&g;for(g>>=7;0<o;C=256*C+e[i],i--,o-=8);var A=C&(1<<-o)-1;for(C>>=-o,o+=r;0<o;A=256*A+e[i],i--,o-=8);if(C===0)C=1-p;else{if(C===h)return A?NaN:g?-1/0:1/0;A+=Ic(2,r),C-=p}return(g?-1:1)*A*Ic(2,C-r)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,r){$v(e.prototype,r,{get:function(){return Me(this)[r]}})},md=function(e,r,i,o){i=Le(i);var h=Me(e);if(i+r>h.byteLength)throw fh("Wrong index");return e=Me(h.buffer).bytes,i+=h.byteOffset,r=e.slice(i,i+r),o?r:r.reverse()},nd=function(e,r,i,o,h,p){i=Le(i);var g=Me(e);if(i+r>g.byteLength)throw fh("Wrong index");for(e=Me(g.buffer).bytes,i+=g.byteOffset,o=o(+h),h=0;h<r;h++)e[i+h]=o[p?h:r-h-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,r){Eo.call(this,e,r<<24>>24)},setUint8:function(e,r){Eo.call(this,e,r<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,r,i){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var o=Me(e).byteLength;if(0>(r=$b(r))||r>o)throw fh("Wrong offset");if(r+(i=i===void 0?o-r:ta(i))>o)throw fh("Wrong length");uo(this,{buffer:e,byteLength:i,byteOffset:r}),ka||(this.buffer=e,this.byteLength=i,this.byteOffset=r)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var r=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(e){var r=md(this,2,e,1<arguments.length?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,r){nd(this,1,e,yo,r)},setUint8:function(e,r){nd(this,1,e,yo,r)},setInt16:function(e,r){nd(this,2,e,zo,r,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,r){nd(this,2,e,zo,r,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,r){nd(this,4,e,Ao,r,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,r){nd(this,4,e,Ao,r,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,r){nd(this,4,e,aw,r,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,r){nd(this,8,e,bw,r,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,r){if(Go!==void 0&&r===void 0)return Go.call(va(this),e);var i=va(this).byteLength;e=xb(e,i),r=xb(r===void 0?i:r,i),i=new(kd(this,Aj))(ta(r-e));for(var o=new Fo(this),h=new Fo(i),p=0;e<r;)h.setUint8(p++,o.getUint8(e++));return i}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var r in rc)if(Q(rc,Bb)){var i=y[r];if(i&&(e===i||Ko.call(i,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,r,i){if(ka){if(i)for(var o in rc){var h=y[o];if(h&&Q(h.prototype,e))try{delete h.prototype[e]}catch{}}dc[e]&&!i||Ta(dc,e,i?r:Jc&&Bj[e]||r)}},Oo=function(e,r,i){var o,h;if(ka){if(Ua){if(i){for(o in rc)if((h=y[o])&&Q(h,e))try{delete h[e]}catch{}}if(qc[e]&&!i)return;try{return Ta(qc,e,i?r:Jc&&qc[e]||r)}catch{}}for(o in rc)!(h=y[o])||h[e]&&!i||Ta(h,e,r)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(e){new Od,new Od(null),new Od(1.5),new Od(e)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(e,r){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%r)throw RangeError("Wrong offset");return e},Ej=function(e){var r=Qa(e),i=arguments.length,o=1<i?arguments[1]:void 0,h=o!==void 0,p=Xi(r);if(p!=null&&!Vi(p)){var g=p.call(r),C=g.next;for(r=[];!(p=C.call(g)).done;)r.push(p.value)}for(h&&2<i&&(o=Id(o,arguments[2],2)),p=ta(r.length),g=new(Ne(this))(p),i=0;p>i;i++)g[i]=h?o(r[i],i):r[i];return g},lh=function(e,r,i){var o,h;return Ua&&typeof(o=r.constructor)=="function"&&o!==i&&ha(h=o.prototype)&&h!==i.prototype&&Ua(e,h),e},Sf=$a(function(e){var r=Hd.f,i=Za.get,o=Za.set,h=Ra.f,p=Fb.f,g=Math.round,C=y.RangeError,A=Pf.ArrayBuffer,x=Pf.DataView,_e=function(RN,IN){var t0=0,aH=IN.length;for(RN=new(Ne(RN))(aH);aH>t0;)RN[t0]=IN[t0++];return RN},cN=function(RN,IN){h(RN,IN,{get:function(){return i(this)[IN]}})},dN=function(RN){var IN;return RN instanceof A||(IN=Ff(RN))=="ArrayBuffer"||IN=="SharedArrayBuffer"},fN=function(RN,IN){return jh(RN)&&typeof IN!="symbol"&&IN in RN&&String(+IN)==String(IN)},mN=function(RN,IN){return fN(RN,IN=lc(IN,!0))?dd(2,RN[IN]):p(RN,IN)},EN=function(RN,IN,t0){return!(fN(RN,IN=lc(IN,!0))&&ha(t0)&&Q(t0,"value"))||Q(t0,"get")||Q(t0,"set")||t0.configurable||Q(t0,"writable")&&!t0.writable||Q(t0,"enumerable")&&!t0.enumerable?h(RN,IN,t0):(RN[IN]=t0.value,RN)};ka?(Qf||(Fb.f=mN,Ra.f=EN,cN(Rf,"buffer"),cN(Rf,"byteOffset"),cN(Rf,"byteLength"),cN(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:mN,defineProperty:EN}),e.exports=function(RN,IN,t0){var aH=RN.match(/\d+$/)[0]/8,pH=RN+(t0?"Clamped":"")+"Array",SH="get"+RN,vH="set"+RN,AH=y[pH],UH=AH;RN=UH&&UH.prototype;var zH={},CH=function(HH,VH){h(HH,VH,{get:function(){var KH=i(this);return KH.view[SH](VH*aH+KH.byteOffset,!0)},set:function(KH){var IH=i(this);t0&&(KH=0>(KH=g(KH))?0:255<KH?255:255&KH),IH.view[vH](VH*aH+IH.byteOffset,KH,!0)},enumerable:!0})};Qf?Dj&&(UH=IN(function(HH,VH,KH,IH){return Gc(HH,UH,pH),lh(ha(VH)?dN(VH)?IH!==void 0?new AH(VH,kh(KH,aH),IH):KH!==void 0?new AH(VH,kh(KH,aH)):new AH(VH):jh(VH)?_e(UH,VH):Ej.call(UH,VH):new AH(Le(VH)),HH,UH)}),Ua&&Ua(UH,Po),Jd(r(AH),function(HH){HH in UH||Na(UH,HH,AH[HH])}),UH.prototype=RN):(UH=IN(function(HH,VH,KH,IH){Gc(HH,UH,pH);var MH=0,GH=0;if(ha(VH)){if(!dN(VH))return jh(VH)?_e(UH,VH):Ej.call(UH,VH);var yH=VH;if(GH=kh(KH,aH),VH=VH.byteLength,IH===void 0){if(VH%aH||0>(IH=VH-GH))throw C("Wrong length")}else if((IH=ta(IH)*aH)+GH>VH)throw C("Wrong length");VH=IH/aH}else VH=Le(VH),yH=new A(IH=VH*aH);for(o(HH,{buffer:yH,byteOffset:GH,byteLength:IH,length:VH,view:new x(yH)});MH<VH;)CH(HH,MH++)}),Ua&&Ua(UH,Po),RN=UH.prototype=ac(Rf)),RN.constructor!==UH&&Na(RN,"constructor",UH),No&&Na(RN,No,pH),zH[pH]=UH,N({global:!0,forced:UH!=AH,sham:!Qf},zH),"BYTES_PER_ELEMENT"in UH||Na(UH,"BYTES_PER_ELEMENT",aH),"BYTES_PER_ELEMENT"in RN||Na(RN,"BYTES_PER_ELEMENT",aH),If(pH)}):e.exports=function(){}});Sf("Uint8",function(e){return function(r,i,o){return e(this,r,i,o)}});var hw=Math.min,iw=[].copyWithin||function(e,r){var i=Qa(this),o=ta(i.length),h=xb(e,o),p=xb(r,o),g=2<arguments.length?arguments[2]:void 0;for(o=hw((g===void 0?o:xb(g,o))-p,o-h),g=1,p<h&&h<p+o&&(g=-1,p+=o-1,h+=o-1);0<o--;)p in i?i[h]=i[p]:delete i[h],h+=g,p+=g;return i};Aa("copyWithin",function(e,r){return iw.call(Da(this),e,r,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(e){return yj.apply(Da(this),arguments)}),Aa("filter",function(e){var r=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),i=kd(this,this.constructor),o=0,h=r.length;for(i=new(Ne(i))(h);h>o;)i[o]=r[o++];return i}),Aa("find",function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(e){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var r=qb(this),i=ta(r.length),o=i-1;for(1<arguments.length&&(o=nw(o,$b(arguments[1]))),0>o&&(o=i+o);0<=o;o--)if(o in r&&r[o]===e)return o||0;return-1}:Gj;Aa("lastIndexOf",function(e){return pw.apply(Da(this),arguments)}),Aa("map",function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,function(r,i){return new(Ne(kd(r,r.constructor)))(i)})});var Vo=function(e){return function(r,i,o,h){yb(i),r=Qa(r);var p=Af(r),g=ta(r.length),C=e?g-1:0,A=e?-1:1;if(2>o)for(;;){if(C in p){h=p[C],C+=A;break}if(C+=A,e?0>C:g<=C)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=C:g>C;C+=A)C in p&&(h=i(h,p[C],C,r));return h}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var e,r=Da(this).length,i=rw(r/2),o=0;o<i;)e=this[o],this[o++]=this[--r],this[r]=e;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(e){Da(this);var r=kh(1<arguments.length?arguments[1]:void 0,1),i=this.length,o=Qa(e),h=ta(o.length),p=0;if(h+r>i)throw RangeError("Wrong length");for(;p<h;)this[r+p]=o[p++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(e,r){e=tw.call(Da(this),e,r);var i=kd(this,this.constructor);r=0;var o=e.length;for(i=new(Ne(i))(o);o>r;)i[r]=e[r++];return i},uw),Aa("some",function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(e){return vw.call(Da(this),e)}),Aa("subarray",function(e,r){var i=Da(this),o=i.length;return e=xb(e,o),new(kd(i,i.constructor))(i.buffer,i.byteOffset+e*i.BYTES_PER_ELEMENT,ta((r===void 0?o:xb(r,o))-e))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var e=va(this),r=String(e.source),i=e.flags;return"/"+r+"/"+(e=String(i===void 0&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):i))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,r){var i,o,h=Qa(this),p=ta(h.length),g=xb(e,p),C=arguments.length;if(C===0?C=i=0:C===1?(C=0,i=p-g):(C-=2,i=Iw(Hw($b(r),0),p-g)),9007199254740991<p+C-i)throw TypeError("Maximum allowed length exceeded");var A=Sg(h,i);for(o=0;o<i;o++){var x=g+o;x in h&&Ge(A,o,h[x])}if(A.length=i,C<i){for(o=g;o<p-i;o++){var _e=o+C;(x=o+i)in h?h[_e]=h[x]:delete h[_e]}for(o=p;o>p-i+C;o--)delete h[o-1]}else if(C>i)for(o=p-i;o>g;o--)_e=o+C-1,(x=o+i-1)in h?h[_e]=h[x]:delete h[_e];for(o=0;o<C;o++)h[o+g]=arguments[o+2];return h.length=p-i+C,A}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(e,r){return e===r?e!==0||1/e==1/r:e!=e&&r!=r};dh("search",1,function(e,r,i){return[function(o){var h=jb(this),p=o==null?void 0:o[e];return p!==void 0?p.call(o,h):new RegExp(o)[e](String(h))},function(o){var h=i(r,o,this);if(h.done)return h.value;o=va(o);var p=String(this);return h=o.lastIndex,dp(h,0)||(o.lastIndex=0),p=Ke(o,p),dp(o.lastIndex,h)||(o.lastIndex=h),p===null?-1:p.index}]}),$a(function(e){(function(r,i){e.exports?e.exports=i(r):i(r)})(typeof self<"u"?self:Ya,function(r){function i(CH){return btoa(CH).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function o(CH){return CH=(CH+="===").slice(0,-CH.length%4),atob(CH.replace(/-/g,"+").replace(/_/g,"/"))}function h(CH){for(var HH=new Uint8Array(CH.length),VH=0;VH<CH.length;VH++)HH[VH]=CH.charCodeAt(VH);return HH}function p(CH){return CH instanceof ArrayBuffer&&(CH=new Uint8Array(CH)),String.fromCharCode.apply(String,CH)}function g(CH){var HH={name:(CH.name||CH||"").toUpperCase().replace("V","v")};switch(HH.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":CH.length&&(HH.length=CH.length);break;case"HMAC":CH.hash&&(HH.hash=g(CH.hash)),CH.length&&(HH.length=CH.length);break;case"RSAES-PKCS1-v1_5":CH.publicExponent&&(HH.publicExponent=new Uint8Array(CH.publicExponent)),CH.modulusLength&&(HH.modulusLength=CH.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":CH.hash&&(HH.hash=g(CH.hash)),CH.publicExponent&&(HH.publicExponent=new Uint8Array(CH.publicExponent)),CH.modulusLength&&(HH.modulusLength=CH.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return HH}function C(CH){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[CH.name][(CH.hash||{}).name||CH.length||""]}function A(CH){(CH instanceof ArrayBuffer||CH instanceof Uint8Array)&&(CH=JSON.parse(decodeURIComponent(escape(p(CH)))));var HH={kty:CH.kty,alg:CH.alg,ext:CH.ext||CH.extractable};switch(HH.kty){case"oct":HH.k=CH.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(VH){VH in CH&&(HH[VH]=CH[VH])});break;default:throw new TypeError("Unsupported key type")}return HH}function x(CH){return CH=A(CH),SH&&(CH.extractable=CH.ext,delete CH.ext),h(unescape(encodeURIComponent(JSON.stringify(CH)))).buffer}function _e(CH){var HH=cN(CH),VH=!1;switch(2<HH.length&&(VH=!0,HH.shift()),CH={ext:!0},HH[0][0]){case"1.2.840.113549.1.1.1":var KH="n e d p q dp dq qi".split(" ");for(HH=cN(HH[1]),VH&&HH.shift(),VH=0;VH<HH.length;VH++)HH[VH][0]||(HH[VH]=HH[VH].subarray(1)),CH[KH[VH]]=i(p(HH[VH]));CH.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return CH}function cN(CH,HH){if(CH instanceof ArrayBuffer&&(CH=new Uint8Array(CH)),HH||(HH={pos:0,end:CH.length}),2>HH.end-HH.pos||HH.end>CH.length)throw new RangeError("Malformed DER");var VH=CH[HH.pos++],KH=CH[HH.pos++];if(128<=KH){if(KH&=127,HH.end-HH.pos<KH)throw new RangeError("Malformed DER");for(var IH=0;KH--;)IH<<=8,IH|=CH[HH.pos++];KH=IH}if(HH.end-HH.pos<KH)throw new RangeError("Malformed DER");switch(VH){case 2:VH=CH.subarray(HH.pos,HH.pos+=KH);break;case 3:if(CH[HH.pos++])throw Error("Unsupported bit string");KH--;case 4:VH=new Uint8Array(CH.subarray(HH.pos,HH.pos+=KH)).buffer;break;case 5:VH=null;break;case 6:if(!((CH=btoa(p(CH.subarray(HH.pos,HH.pos+=KH))))in AH))throw Error("Unsupported OBJECT ID "+CH);VH=AH[CH];break;case 48:for(VH=[],KH=HH.pos+KH;HH.pos<KH;)VH.push(cN(CH,HH));break;default:throw Error("Unsupported DER tag 0x"+VH.toString(16))}return VH}function dN(CH,HH){HH||(HH=[]);var VH=HH.length+2;if(HH.push(0,0),CH instanceof Uint8Array)for(var KH=2,IH=CH.length,MH=0;MH<IH;MH++)HH.push(CH[MH]);else if(CH instanceof ArrayBuffer)for(KH=4,IH=CH.byteLength,CH=new Uint8Array(CH),MH=0;MH<IH;MH++)HH.push(CH[MH]);else if(CH===null)KH=5,IH=0;else if(typeof CH=="string"&&CH in UH)for(KH=6,IH=(CH=h(atob(UH[CH]))).length,MH=0;MH<IH;MH++)HH.push(CH[MH]);else if(CH instanceof Array){for(MH=0;MH<CH.length;MH++)dN(CH[MH],HH);KH=48,IH=HH.length-VH}else{if(!(X(CH)==="object"&&CH.tag===3&&CH.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+CH);for(KH=3,IH=(CH=new Uint8Array(CH.value)).byteLength,HH.push(0),MH=0;MH<IH;MH++)HH.push(CH[MH]);IH++}if(128<=IH){for(MH=IH,IH=4,HH.splice(VH,0,MH>>24&255,MH>>16&255,MH>>8&255,255&MH);1<IH&&!(MH>>24);)MH<<=8,IH--;4>IH&&HH.splice(VH,4-IH),IH|=128}return HH.splice(VH-2,2,KH,IH),HH}function fN(CH,HH,VH,KH){Object.defineProperties(this,{_key:{value:CH},type:{value:CH.type,enumerable:!0},extractable:{value:VH===void 0?CH.extractable:VH,enumerable:!0},algorithm:{value:HH===void 0?CH.algorithm:HH,enumerable:!0},usages:{value:KH===void 0?CH.usages:KH,enumerable:!0}})}function mN(CH){return CH==="verify"||CH==="encrypt"||CH==="wrapKey"}function EN(CH){return CH==="sign"||CH==="decrypt"||CH==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var RN=r.crypto||r.msCrypto;if(RN){var IN=RN.subtle||RN.webkitSubtle;if(IN){var t0=r.Crypto||RN.constructor||Object,aH=r.SubtleCrypto||IN.constructor||Object;r.CryptoKey||r.Key;var pH=-1<r.navigator.userAgent.indexOf("Edge/"),SH=!!r.msCrypto&&!pH,vH=!RN.subtle&&!!RN.webkitSubtle;if(SH||vH){var AH={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},UH={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(CH){var HH=IN[CH];IN[CH]=function(VH,KH,IH){var MH=[].slice.call(arguments);switch(CH){case"generateKey":var GH=g(VH),yH=KH,TH=IH;break;case"importKey":GH=g(IH),yH=MH[3],TH=MH[4],VH==="jwk"&&((KH=A(KH)).alg||(KH.alg=C(GH)),KH.key_ops||(KH.key_ops=KH.kty!=="oct"?"d"in KH?TH.filter(EN):TH.filter(mN):TH.slice()),MH[1]=x(KH));break;case"unwrapKey":GH=MH[4],yH=MH[5],TH=MH[6],MH[2]=IH._key}if(CH==="generateKey"&&GH.name==="HMAC"&&GH.hash)return GH.length=GH.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[GH.hash.name],IN.importKey("raw",RN.getRandomValues(new Uint8Array(GH.length+7>>3)),GH,yH,TH);if(vH&&CH==="generateKey"&&GH.name==="RSASSA-PKCS1-v1_5"&&(!GH.modulusLength||2048<=GH.modulusLength))return(VH=g(VH)).name="RSAES-PKCS1-v1_5",delete VH.hash,IN.generateKey(VH,!0,["encrypt","decrypt"]).then(function(gH){return Promise.all([IN.exportKey("jwk",gH.publicKey),IN.exportKey("jwk",gH.privateKey)])}).then(function(gH){return gH[0].alg=gH[1].alg=C(GH),gH[0].key_ops=TH.filter(mN),gH[1].key_ops=TH.filter(EN),Promise.all([IN.importKey("jwk",gH[0],GH,!0,gH[0].key_ops),IN.importKey("jwk",gH[1],GH,yH,gH[1].key_ops)])}).then(function(gH){return{publicKey:gH[0],privateKey:gH[1]}});if((vH||SH&&(GH.hash||{}).name==="SHA-1")&&CH==="importKey"&&VH==="jwk"&&GH.name==="HMAC"&&KH.kty==="oct")return IN.importKey("raw",h(o(KH.k)),IH,MH[3],MH[4]);if(vH&&CH==="importKey"&&(VH==="spki"||VH==="pkcs8"))return IN.importKey("jwk",_e(KH),IH,MH[3],MH[4]);if(SH&&CH==="unwrapKey")return IN.decrypt(MH[3],IH,KH).then(function(gH){return IN.importKey(VH,gH,MH[4],MH[5],MH[6])});try{var NH=HH.apply(IN,MH)}catch(gH){return Promise.reject(gH)}return SH&&(NH=new Promise(function(gH,SN){NH.onabort=NH.onerror=function(oH){SN(oH)},NH.oncomplete=function(oH){gH(oH.target.result)}})),NH=NH.then(function(gH){return GH.name!=="HMAC"||GH.length||(GH.length=8*gH.algorithm.length),GH.name.search("RSA")==0&&(GH.modulusLength||(GH.modulusLength=(gH.publicKey||gH).algorithm.modulusLength),GH.publicExponent||(GH.publicExponent=(gH.publicKey||gH).algorithm.publicExponent)),gH.publicKey&&gH.privateKey?{publicKey:new fN(gH.publicKey,GH,yH,TH.filter(mN)),privateKey:new fN(gH.privateKey,GH,yH,TH.filter(EN))}:new fN(gH,GH,yH,TH)})}}),["exportKey","wrapKey"].forEach(function(CH){var HH=IN[CH];IN[CH]=function(VH,KH,IH){var MH=[].slice.call(arguments);switch(CH){case"exportKey":MH[1]=KH._key;break;case"wrapKey":MH[1]=KH._key,MH[2]=IH._key}if((vH||SH&&(KH.algorithm.hash||{}).name==="SHA-1")&&CH==="exportKey"&&VH==="jwk"&&KH.algorithm.name==="HMAC"&&(MH[0]="raw"),!vH||CH!=="exportKey"||VH!=="spki"&&VH!=="pkcs8"||(MH[0]="jwk"),SH&&CH==="wrapKey")return IN.exportKey(VH,KH).then(function(yH){return VH==="jwk"&&(yH=h(unescape(encodeURIComponent(JSON.stringify(A(yH)))))),IN.encrypt(MH[3],IH,yH)});try{var GH=HH.apply(IN,MH)}catch(yH){return Promise.reject(yH)}return SH&&(GH=new Promise(function(yH,TH){GH.onabort=GH.onerror=function(NH){TH(NH)},GH.oncomplete=function(NH){yH(NH.target.result)}})),CH==="exportKey"&&VH==="jwk"&&(GH=GH.then(function(yH){return(vH||SH&&(KH.algorithm.hash||{}).name==="SHA-1")&&KH.algorithm.name==="HMAC"?{kty:"oct",alg:C(KH.algorithm),key_ops:KH.usages.slice(),ext:!0,k:i(p(yH))}:((yH=A(yH)).alg||(yH.alg=C(KH.algorithm)),yH.key_ops||(yH.key_ops=KH.type==="public"?KH.usages.filter(mN):KH.type==="private"?KH.usages.filter(EN):KH.usages.slice()),yH)})),!vH||CH!=="exportKey"||VH!=="spki"&&VH!=="pkcs8"||(GH=GH.then(function(yH){var TH=[["",null]],NH=!1;switch((yH=A(yH)).kty){case"RSA":for(var gH="n e d p q dp dq qi".split(" "),SN=[],oH=0;oH<gH.length&&gH[oH]in yH;oH++){var fH=SN[oH]=h(o(yH[gH[oH]]));128&fH[0]&&(SN[oH]=new Uint8Array(fH.length+1),SN[oH].set(fH,1))}2<SN.length&&(NH=!0,SN.unshift(new Uint8Array([0]))),TH[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return TH.push(new Uint8Array(dN(SN)).buffer),NH?TH.unshift(new Uint8Array([0])):TH[1]={tag:3,value:TH[1]},new Uint8Array(dN(TH)).buffer})),GH}}),["encrypt","decrypt","sign","verify"].forEach(function(CH){var HH=IN[CH];IN[CH]=function(VH,KH,IH,MH){if(SH&&(!IH.byteLength||MH&&!MH.byteLength))throw Error("Empty input is not allowed");var GH=[].slice.call(arguments),yH=g(VH);if(!SH||CH!=="sign"&&CH!=="verify"||VH!=="RSASSA-PKCS1-v1_5"&&VH!=="HMAC"||(GH[0]={name:VH}),SH&&KH.algorithm.hash&&(GH[0].hash=GH[0].hash||KH.algorithm.hash),SH&&CH==="decrypt"&&yH.name==="AES-GCM"){var TH=VH.tagLength>>3;GH[2]=(IH.buffer||IH).slice(0,IH.byteLength-TH),VH.tag=(IH.buffer||IH).slice(IH.byteLength-TH)}SH&&yH.name==="AES-GCM"&&GH[0].tagLength===void 0&&(GH[0].tagLength=128),GH[1]=KH._key;try{var NH=HH.apply(IN,GH)}catch(gH){return Promise.reject(gH)}return SH&&(NH=new Promise(function(gH,SN){NH.onabort=NH.onerror=function(oH){SN(oH)},NH.oncomplete=function(oH){if(oH=oH.target.result,CH==="encrypt"&&oH instanceof AesGcmEncryptResult){var fH=oH.ciphertext,xH=oH.tag;(oH=new Uint8Array(fH.byteLength+xH.byteLength)).set(new Uint8Array(fH),0),oH.set(new Uint8Array(xH),fH.byteLength),oH=oH.buffer}gH(oH)}})),NH}}),SH){var zH=IN.digest;IN.digest=function(CH,HH){if(!HH.byteLength)throw Error("Empty input is not allowed");try{var VH=zH.call(IN,CH,HH)}catch(KH){return Promise.reject(KH)}return VH=new Promise(function(KH,IH){VH.onabort=VH.onerror=function(MH){IH(MH)},VH.oncomplete=function(MH){KH(MH.target.result)}})},r.crypto=Object.create(RN,{getRandomValues:{value:function(CH){return RN.getRandomValues(CH)}},subtle:{value:IN}}),r.CryptoKey=fN}vH&&(RN.subtle=IN,r.Crypto=t0,r.SubtleCrypto=aH,r.CryptoKey=fN)}}}})});var Jw=qa("match"),Lj=function(e){var r;return ha(e)&&((r=e[Jw])!==void 0?!!r:Zb(e)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(e,r,i){var o="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(h,p){var g=String(jb(this));if((p=p===void 0?4294967295:p>>>0)===0)return[];if(h===void 0)return[g];if(!Lj(h))return r.call(g,h,p);var C,A,x,_e=[],cN=0;for(h=new RegExp(h.source,(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(h.sticky?"y":"")+"g");(C=Of.call(h,g))&&!((A=h.lastIndex)>cN&&(_e.push(g.slice(cN,C.index)),1<C.length&&C.index<g.length&&Kw.apply(_e,C.slice(1)),x=C[0].length,cN=A,_e.length>=p));)h.lastIndex===C.index&&h.lastIndex++;return cN===g.length?(x||!h.test(""))&&_e.push(""):_e.push(g.slice(cN)),_e.length>p?_e.slice(0,p):_e}:"0".split(void 0,0).length?function(h,p){return h===void 0&&p===0?[]:r.call(this,h,p)}:r;return[function(h,p){var g=jb(this),C=h==null?void 0:h[e];return C!==void 0?C.call(h,g,p):o.call(String(g),h,p)},function(h,p){var g=i(o,h,this,p,o!==r);if(g.done)return g.value;var C=va(h);h=String(this);var A=kd(C,RegExp);if(g=C.unicode,C=new A(pc?"^(?:"+C.source+")":C,(C.ignoreCase?"i":"")+(C.multiline?"m":"")+(C.unicode?"u":"")+(pc?"g":"y")),(p=p===void 0?4294967295:p>>>0)===0)return[];if(h.length===0)return Ke(C,h)===null?[h]:[];var x=0,_e=0;for(A=[];_e<h.length;){C.lastIndex=pc?0:_e;var cN,dN=Ke(C,pc?h.slice(_e):h);if(dN===null||(cN=Lw(ta(C.lastIndex+(pc?_e:0)),h.length))===x)_e=xj(h,_e,g);else{if(A.push(h.slice(x,_e)),A.length===p)return A;for(x=1;x<=dN.length-1;x++)if(A.push(dN[x]),A.length===p)return A;_e=x=cN}}return A.push(h.slice(x)),A}]},pc),function(e){e.console||(e.console={}),e=e.console;for(var r,i=function(){},o=["memory"],h="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");r=o.pop();)e[r]||(e[r]={});for(;r=h.pop();)e[r]||(e[r]=i)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var r=yb(this),i=ep.call(arguments,1),o=function(){var h=i.concat(ep.call(arguments));if(this instanceof o){var p=h.length;if(!(p in Mj)){for(var g=[],C=0;C<p;C++)g[C]="a["+C+"]";Mj[p]=Function("C,a","return new C("+g.join(",")+")")}h=Mj[p](r,h)}else h=r.apply(e,h);return h};return ha(r.prototype)&&(o.prototype=r.prototype),o},Nj=mc("Reflect","construct"),fp=R(function(){function e(){}return!(Nj(function(){},[],e)instanceof e)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,r){yb(e),va(r);var i=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,r,i);if(e==i){switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3])}return(i=[null]).push.apply(i,r),new(Nw.apply(e,i))}i=i.prototype,i=ac(ha(i)?i:Object.prototype);var o=Function.apply.call(e,i,r);return ha(o)?o:i}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,r){return ip(qb(e),r)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&Pw.call(e)=="[object Window]")try{var r=jp(e)}catch{r=kp.slice()}else r=jp(qb(e));return r},lp={f:qa},Qw=Ra.f,ph=function(e){var r=y.Symbol||(y.Symbol={});Q(r,e)||Qw(r,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=op(Ob,r);o&&delete Ob[r],od(e,r,i),o&&e!==Ob&&od(Ob,r,o)}:od,Uj=function(e,r){var i=Lc[e]=ac(sb.prototype);return Rw(i,{type:"Symbol",tag:e,description:r}),ka||(i.description=r),i},Vj=vn?function(e){return typeof e=="symbol"}:function(e){return Object(e)instanceof sb},qh=function(e,r,i){return e===Ob&&qh(Uf,r,i),va(e),r=lc(r,!0),va(i),Q(Lc,r)?(i.enumerable?(Q(e,rb)&&e[rb][r]&&(e[rb][r]=!1),i=ac(i,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][r]=!0),Tj(e,r,i)):od(e,r,i)},qp=function(e,r){va(e);var i=qb(r);return r=Dc(i).concat(Wj(i)),Jd(r,function(o){ka&&!Xj.call(i,o)||qh(e,o,i[o])}),e},Xj=function(e){e=lc(e,!0);var r=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(r||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||r)},rp=function(e,r){if(e=qb(e),r=lc(r,!0),e!==Ob||!Q(Lc,r)||Q(Uf,r)){var i=op(e,r);return!i||!Q(Lc,r)||Q(e,rb)&&e[rb][r]||(i.enumerable=!0),i}},sp=function(e){e=pp(qb(e));var r=[];return Jd(e,function(i){Q(Lc,i)||Q(Be,i)||r.push(i)}),r},Wj=function(e){var r=e===Ob;e=pp(r?Uf:qb(e));var i=[];return Jd(e,function(o){!Q(Lc,o)||r&&!Q(Ob,o)||i.push(Lc[o])}),i};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,r=Ae(e),i=function(o){this===Ob&&i.call(Uf,o),Q(this,rb)&&Q(this[rb],r)&&(this[rb][r]=!1),Tj(this,r,dd(1,o))};return ka&&Sj&&Tj(Ob,r,{configurable:!0,set:i}),Uj(r,e)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(e){return Uj(Ae(e),e)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(e){ph(e)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var r=sb(e);return Pj[e]=r,Qj[r]=e,r},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,r){return r===void 0?ac(e):qp(ac(e),r)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R(function(){var e=sb();return Tf([e])!="[null]"||Tf({a:e})!="{}"||Tf(Object(e))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,r,i){for(var o,h=[e],p=1;arguments.length>p;)h.push(arguments[p++]);if(o=r,(ha(r)||e!==void 0)&&!Vj(e))return gd(r)||(r=function(g,C){if(typeof o=="function"&&(C=o.call(this,g,C)),!Vj(C))return C}),h[1]=r,Tf.apply(null,h)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var e=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),r=this instanceof Vf?new Mc(e):e===void 0?Mc():Mc(e);return e===""&&(tp[r]=!0),r};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,r=Ww.call(e);return Q(tp,e)?"":(e=Xw?r.slice(7,-1):r.replace(Yw,"$1"))===""?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(dN,fN){if(!(dN instanceof fN))throw new TypeError("Cannot call a class as a function")}function r(dN,fN){for(var mN=0;mN<fN.length;mN++){var EN=fN[mN];EN.enumerable=EN.enumerable||!1,EN.configurable=!0,"value"in EN&&(EN.writable=!0),Object.defineProperty(dN,EN.key,EN)}}function i(dN,fN,mN){return fN&&r(dN.prototype,fN),dN}function o(dN,fN){if(typeof fN!="function"&&fN!==null)throw new TypeError("Super expression must either be null or a function");dN.prototype=Object.create(fN.prototype,{constructor:{value:dN,writable:!0,configurable:!0}}),p(dN,fN)}function h(dN){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(fN){return fN.__proto__||Object.getPrototypeOf(fN)})(dN)}function p(dN,fN){return(p=Object.setPrototypeOf||function(mN,EN){return mN.__proto__=EN,mN})(dN,fN)}function g(dN){if(dN===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return dN}function C(dN){var fN=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var mN=h(dN);if(fN){var EN=h(this).constructor;mN=Reflect.construct(mN,arguments,EN)}else mN=mN.apply(this,arguments);return mN=!mN||X(mN)!=="object"&&typeof mN!="function"?g(this):mN}}function A(dN,fN,mN){return(A=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(EN,RN,IN){for(;!Object.prototype.hasOwnProperty.call(EN,RN)&&(EN=h(EN))!==null;);if(EN)return(RN=Object.getOwnPropertyDescriptor(EN,RN)).get?RN.get.call(IN):RN.value})(dN,fN,mN||dN)}var x=function(){function dN(){e(this,dN),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return i(dN,[{key:"addEventListener",value:function(fN,mN,EN){fN in this.listeners||(this.listeners[fN]=[]),this.listeners[fN].push({callback:mN,options:EN})}},{key:"removeEventListener",value:function(fN,mN){if(fN in this.listeners){for(var EN=0,RN=(fN=this.listeners[fN]).length;EN<RN;EN++)if(fN[EN].callback===mN){fN.splice(EN,1);break}}}},{key:"dispatchEvent",value:function(fN){if(fN.type in this.listeners){for(var mN=this.listeners[fN.type].slice(),EN=0,RN=mN.length;EN<RN;EN++){var IN=mN[EN];try{IN.callback.call(this,fN)}catch(t0){Promise.resolve().then(function(){throw t0})}IN.options&&IN.options.once&&this.removeEventListener(fN.type,IN.callback)}return!fN.defaultPrevented}}}]),dN}(),_e=function(dN){function fN(){e(this,fN);var EN=mN.call(this);return EN.listeners||x.call(g(EN)),Object.defineProperty(g(EN),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(g(EN),"onabort",{value:null,writable:!0,configurable:!0}),EN}o(fN,dN);var mN=C(fN);return i(fN,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(EN){EN.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,EN)),A(h(fN.prototype),"dispatchEvent",this).call(this,EN)}}]),fN}(x),cN=function(){function dN(){e(this,dN),Object.defineProperty(this,"signal",{value:new _e,writable:!0,configurable:!0})}return i(dN,[{key:"abort",value:function(){try{var fN=new Event("abort")}catch{typeof document<"u"?document.createEvent?(fN=document.createEvent("Event")).initEvent("abort",!1,!1):(fN=document.createEventObject()).type="abort":fN={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(fN)}},{key:"toString",value:function(){return"[object AbortController]"}}]),dN}();typeof Symbol<"u"&&Symbol.toStringTag&&(cN.prototype[Symbol.toStringTag]="AbortController",_e.prototype[Symbol.toStringTag]="AbortSignal"),function(dN){if(dN.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var fN=!0}else fN=typeof dN.Request=="function"&&!dN.Request.prototype.hasOwnProperty("signal")||!dN.AbortController;fN&&(dN.AbortController=cN,dN.AbortSignal=_e)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var r="",i=0,o=0|(e=Zj?new ak(e):e).length;i<o;i=i+32768|0)r+=xd.apply(0,e[Zj?"slice":"subarray"](i,i+32768|0));return r.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var r=0|(e=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,i=new ak(r),o=0;o<r;o=o+1|0)i[o]=e.charCodeAt(o);return i},window.TextEncoder||(window.TextEncoder=yl),function(e){var r,i,o,h,p,g,C,A,x,_e,cN;(function(dN){dN.LOGIN="LOGIN",dN.LOGIN_SUCCESS="LOGIN_SUCCESS",dN.LOGIN_FAILURE="LOGIN_FAILURE",dN.LOGIN_TIMEOUT="LOGIN_TIMEOUT",dN.INTERRUPTED="INTERRUPTED",dN.LOGOUT="LOGOUT",dN.BANNED_BY_SERVER="BANNED_BY_SERVER",dN.REMOTE_LOGIN="REMOTE_LOGIN"})(r||(r={})),e.ConnectionChangeReason=r,function(dN){dN.DISCONNECTED="DISCONNECTED",dN.CONNECTING="CONNECTING",dN.CONNECTED="CONNECTED",dN.RECONNECTING="RECONNECTING",dN.ABORTED="ABORTED"}(i||(i={})),e.ConnectionState=i,function(dN){dN.IDLE="IDLE",dN.SENT_TO_REMOTE="SENT_TO_REMOTE",dN.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",dN.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",dN.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",dN.CANCELED="CANCELED",dN.FAILURE="FAILURE"}(o||(o={})),e.LocalInvitationState=o,function(dN){dN.INVITATION_RECEIVED="INVITATION_RECEIVED",dN.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",dN.REFUSED="REFUSED",dN.ACCEPTED="ACCEPTED",dN.CANCELED="CANCELED",dN.FAILURE="FAILURE"}(h||(h={})),e.RemoteInvitationState=h,function(dN){dN.UNKNOWN="UNKNOWN",dN.PEER_NO_RESPONSE="PEER_NO_RESPONSE",dN.INVITATION_EXPIRE="INVITATION_EXPIRE",dN.PEER_OFFLINE="PEER_OFFLINE",dN.NOT_LOGGEDIN="NOT_LOGGEDIN"}(p||(p={})),e.LocalInvitationFailureReason=p,function(dN){dN.UNKNOWN="UNKNOWN",dN.PEER_OFFLINE="PEER_OFFLINE",dN.ACCEPT_FAILURE="ACCEPT_FAILURE",dN.INVITATION_EXPIRE="INVITATION_EXPIRE"}(g||(g={})),e.RemoteInvitationFailureReason=g,function(dN){dN.ONLINE="ONLINE",dN.UNREACHABLE="UNREACHABLE",dN.OFFLINE="OFFLINE"}(C||(C={})),e.PeerOnlineState=C,(A||(A={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=A,function(dN){dN.TEXT="TEXT",dN.RAW="RAW",dN.IMAGE="IMAGE",dN.FILE="FILE"}(x||(x={})),e.MessageType=x,function(dN){dN.CN="CN",dN.NA="NA",dN.EU="EU",dN.AS="AS",dN.JP="JP",dN.IN="IN",dN.GLOB="GLOB",dN.OC="OC",dN.SA="SA",dN.AF="AF",dN.OVS="OVS"}(_e||(_e={})),e.LegacyAreaCode=_e,function(dN){dN.GLOBAL="GLOBAL",dN.INDIA="INDIA",dN.JAPAN="JAPAN",dN.ASIA="ASIA",dN.EUROPE="EUROPE",dN.CHINA="CHINA",dN.NORTH_AMERICA="NORTH_AMERICA"}(cN||(cN={})),e.AreaCode=cN}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[ex]=!1,"/./"[e](r)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(e){e=function(r){function i(IH,MH,GH){return Object.defineProperty(IH,MH,{value:GH,enumerable:!0,configurable:!0,writable:!0}),IH[MH]}function o(IH,MH,GH,yH){return MH=Object.create((MH&&MH.prototype instanceof p?MH:p).prototype),yH=new fN(yH||[]),MH._invoke=function(TH,NH,gH){var SN=AH;return function(oH,fH){if(SN===zH)throw Error("Generator is already running");if(SN===CH){if(oH==="throw")throw fH;return EN()}for(gH.method=oH,gH.arg=fH;;){if((oH=gH.delegate)&&(oH=_e(oH,gH))){if(oH===HH)continue;return oH}if(gH.method==="next")gH.sent=gH._sent=gH.arg;else if(gH.method==="throw"){if(SN===AH)throw SN=CH,gH.arg;gH.dispatchException(gH.arg)}else gH.method==="return"&&gH.abrupt("return",gH.arg);if(SN=zH,(oH=h(TH,NH,gH)).type==="normal"){if(SN=gH.done?CH:UH,oH.arg===HH)continue;return{value:oH.arg,done:gH.done}}oH.type==="throw"&&(SN=CH,gH.method="throw",gH.arg=oH.arg)}}}(IH,GH,yH),MH}function h(IH,MH,GH){try{return{type:"normal",arg:IH.call(MH,GH)}}catch(yH){return{type:"throw",arg:yH}}}function p(){}function g(){}function C(){}function A(IH){["next","throw","return"].forEach(function(MH){i(IH,MH,function(GH){return this._invoke(MH,GH)})})}function x(IH,MH){function GH(TH,NH,gH,SN){if((TH=h(IH[TH],IH,NH)).type!=="throw"){var oH=TH.arg;return(TH=oH.value)&&X(TH)==="object"&&t0.call(TH,"__await")?MH.resolve(TH.__await).then(function(fH){GH("next",fH,gH,SN)},function(fH){GH("throw",fH,gH,SN)}):MH.resolve(TH).then(function(fH){oH.value=fH,gH(oH)},function(fH){return GH("throw",fH,gH,SN)})}SN(TH.arg)}var yH;this._invoke=function(TH,NH){function gH(){return new MH(function(SN,oH){GH(TH,NH,SN,oH)})}return yH=yH?yH.then(gH,gH):gH()}}function _e(IH,MH){var GH=IH.iterator[MH.method];if(GH===RN){if(MH.delegate=null,MH.method==="throw"){if(IH.iterator.return&&(MH.method="return",MH.arg=RN,_e(IH,MH),MH.method==="throw"))return HH;MH.method="throw",MH.arg=new TypeError("The iterator does not provide a 'throw' method")}return HH}return(GH=h(GH,IH.iterator,MH.arg)).type==="throw"?(MH.method="throw",MH.arg=GH.arg,MH.delegate=null,HH):(GH=GH.arg)?GH.done?(MH[IH.resultName]=GH.value,MH.next=IH.nextLoc,MH.method!=="return"&&(MH.method="next",MH.arg=RN),MH.delegate=null,HH):GH:(MH.method="throw",MH.arg=new TypeError("iterator result is not an object"),MH.delegate=null,HH)}function cN(IH){var MH={tryLoc:IH[0]};1 in IH&&(MH.catchLoc=IH[1]),2 in IH&&(MH.finallyLoc=IH[2],MH.afterLoc=IH[3]),this.tryEntries.push(MH)}function dN(IH){var MH=IH.completion||{};MH.type="normal",delete MH.arg,IH.completion=MH}function fN(IH){this.tryEntries=[{tryLoc:"root"}],IH.forEach(cN,this),this.reset(!0)}function mN(IH){if(IH){var MH=IH[pH];if(MH)return MH.call(IH);if(typeof IH.next=="function")return IH;if(!isNaN(IH.length)){var GH=-1;return(MH=function yH(){for(;++GH<IH.length;)if(t0.call(IH,GH))return yH.value=IH[GH],yH.done=!1,yH;return yH.value=RN,yH.done=!0,yH}).next=MH}}return{next:EN}}function EN(){return{value:RN,done:!0}}var RN,IN=Object.prototype,t0=IN.hasOwnProperty,aH=typeof Symbol=="function"?Symbol:{},pH=aH.iterator||"@@iterator",SH=aH.asyncIterator||"@@asyncIterator",vH=aH.toStringTag||"@@toStringTag";try{i({},"")}catch{i=function(MH,GH,yH){return MH[GH]=yH}}r.wrap=o;var AH="suspendedStart",UH="suspendedYield",zH="executing",CH="completed",HH={};i(aH={},pH,function(){return this});var VH=Object.getPrototypeOf;(VH=VH&&VH(VH(mN([]))))&&VH!==IN&&t0.call(VH,pH)&&(aH=VH);var KH=C.prototype=p.prototype=Object.create(aH);return g.prototype=C,i(KH,"constructor",C),i(C,"constructor",g),g.displayName=i(C,vH,"GeneratorFunction"),r.isGeneratorFunction=function(IH){return!!(IH=typeof IH=="function"&&IH.constructor)&&(IH===g||(IH.displayName||IH.name)==="GeneratorFunction")},r.mark=function(IH){return Object.setPrototypeOf?Object.setPrototypeOf(IH,C):(IH.__proto__=C,i(IH,vH,"GeneratorFunction")),IH.prototype=Object.create(KH),IH},r.awrap=function(IH){return{__await:IH}},A(x.prototype),i(x.prototype,SH,function(){return this}),r.AsyncIterator=x,r.async=function(IH,MH,GH,yH,TH){TH===void 0&&(TH=Promise);var NH=new x(o(IH,MH,GH,yH),TH);return r.isGeneratorFunction(MH)?NH:NH.next().then(function(gH){return gH.done?gH.value:NH.next()})},A(KH),i(KH,vH,"Generator"),i(KH,pH,function(){return this}),i(KH,"toString",function(){return"[object Generator]"}),r.keys=function(IH){var MH,GH=[];for(MH in IH)GH.push(MH);return GH.reverse(),function yH(){for(;GH.length;){var TH=GH.pop();if(TH in IH)return yH.value=TH,yH.done=!1,yH}return yH.done=!0,yH}},r.values=mN,fN.prototype={constructor:fN,reset:function(IH){if(this.next=this.prev=0,this.sent=this._sent=RN,this.done=!1,this.delegate=null,this.method="next",this.arg=RN,this.tryEntries.forEach(dN),!IH)for(var MH in this)MH.charAt(0)==="t"&&t0.call(this,MH)&&!isNaN(+MH.slice(1))&&(this[MH]=RN)},stop:function(){this.done=!0;var IH=this.tryEntries[0].completion;if(IH.type==="throw")throw IH.arg;return this.rval},dispatchException:function(IH){function MH(oH,fH){return NH.type="throw",NH.arg=IH,GH.next=oH,fH&&(GH.method="next",GH.arg=RN),!!fH}if(this.done)throw IH;for(var GH=this,yH=this.tryEntries.length-1;0<=yH;--yH){var TH=this.tryEntries[yH],NH=TH.completion;if(TH.tryLoc==="root")return MH("end");if(TH.tryLoc<=this.prev){var gH=t0.call(TH,"catchLoc"),SN=t0.call(TH,"finallyLoc");if(gH&&SN){if(this.prev<TH.catchLoc)return MH(TH.catchLoc,!0);if(this.prev<TH.finallyLoc)return MH(TH.finallyLoc)}else if(gH){if(this.prev<TH.catchLoc)return MH(TH.catchLoc,!0)}else{if(!SN)throw Error("try statement without catch or finally");if(this.prev<TH.finallyLoc)return MH(TH.finallyLoc)}}}},abrupt:function(IH,MH){for(var GH=this.tryEntries.length-1;0<=GH;--GH){var yH=this.tryEntries[GH];if(yH.tryLoc<=this.prev&&t0.call(yH,"finallyLoc")&&this.prev<yH.finallyLoc){var TH=yH;break}}return TH&&(IH==="break"||IH==="continue")&&TH.tryLoc<=MH&&MH<=TH.finallyLoc&&(TH=null),(GH=TH?TH.completion:{}).type=IH,GH.arg=MH,TH?(this.method="next",this.next=TH.finallyLoc,HH):this.complete(GH)},complete:function(IH,MH){if(IH.type==="throw")throw IH.arg;return IH.type==="break"||IH.type==="continue"?this.next=IH.arg:IH.type==="return"?(this.rval=this.arg=IH.arg,this.method="return",this.next="end"):IH.type==="normal"&&MH&&(this.next=MH),HH},finish:function(IH){for(var MH=this.tryEntries.length-1;0<=MH;--MH){var GH=this.tryEntries[MH];if(GH.finallyLoc===IH)return this.complete(GH.completion,GH.afterLoc),dN(GH),HH}},catch:function(IH){for(var MH=this.tryEntries.length-1;0<=MH;--MH){var GH=this.tryEntries[MH];if(GH.tryLoc===IH){if((IH=GH.completion).type==="throw"){var yH=IH.arg;dN(GH)}return yH}}throw Error("illegal catch attempt")},delegateYield:function(IH,MH,GH){return this.delegate={iterator:mN(IH),resultName:MH,nextLoc:GH},this.method==="next"&&(this.arg=RN),HH}},r}(e.exports);try{regeneratorRuntime=e}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(e){var r=Ra.f,i=Ae("meta"),o=0,h=Object.isExtensible||function(){return!0},p=function(C){r(C,i,{value:{objectID:"O"+ ++o,weakData:{}}})},g=e.exports={REQUIRED:!1,fastKey:function(C,A){if(!ha(C))return typeof C=="symbol"?C:(typeof C=="string"?"S":"P")+C;if(!Q(C,i)){if(!h(C))return"F";if(!A)return"E";p(C)}return C[i].objectID},getWeakData:function(C,A){if(!Q(C,i)){if(!h(C))return!0;if(!A)return!1;p(C)}return C[i].weakData},onFreeze:function(C){return yp&&g.REQUIRED&&h(C)&&!Q(C,i)&&p(C),C}};Be[i]=!0}),zp=function(e,r,i){var o=e.indexOf("Map")!==-1,h=e.indexOf("Weak")!==-1,p=o?"set":"add",g=y[e],C=g&&g.prototype,A=g,x={},_e=function(RN){var IN=C[RN];Ta(C,RN,RN=="add"?function(t0){return IN.call(this,t0===0?0:t0),this}:RN=="delete"?function(t0){return!(h&&!ha(t0))&&IN.call(this,t0===0?0:t0)}:RN=="get"?function(t0){return h&&!ha(t0)?void 0:IN.call(this,t0===0?0:t0)}:RN=="has"?function(t0){return!(h&&!ha(t0))&&IN.call(this,t0===0?0:t0)}:function(t0,aH){return IN.call(this,t0===0?0:t0,aH),this})};if(nc(e,typeof g!="function"||!(h||C.forEach&&!R(function(){new g().entries().next()}))))A=i.getConstructor(r,e,o,p),fk.REQUIRED=!0;else if(nc(e,!0)){var cN=new A,dN=cN[p](h?{}:-0,1)!=cN,fN=R(function(){cN.has(1)}),mN=Tg(function(RN){new g(RN)}),EN=!h&&R(function(){for(var RN=new g,IN=5;IN--;)RN[p](IN,IN);return!RN.has(-0)});mN||((A=r(function(RN,IN){return Gc(RN,A,e),RN=lh(new g,RN,A),IN!=null&&Xg(IN,RN[p],{that:RN,AS_ENTRIES:o}),RN})).prototype=C,C.constructor=A),(fN||EN)&&(_e("delete"),_e("has"),o&&_e("get")),(EN||dN)&&_e(p),h&&C.clear&&delete C.clear}return x[e]=A,N({global:!0,forced:A!=g},x),Ec(A,e),h||i.setStrong(A,e,o),A},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,r,i,o){var h=e(function(A,x){Gc(A,h,r),Bp(A,{type:r,index:ac(null),first:void 0,last:void 0,size:0}),ka||(A.size=0),x!=null&&Xg(x,A[o],{that:A,AS_ENTRIES:i})}),p=gk(r),g=function(A,x,_e){var cN,dN=p(A),fN=C(A,x);return fN?fN.value=_e:(dN.last=fN={index:cN=Ap(x,!0),key:x,value:_e,previous:x=dN.last,next:void 0,removed:!1},dN.first||(dN.first=fN),x&&(x.next=fN),ka?dN.size++:A.size++,cN!=="F"&&(dN.index[cN]=fN)),A},C=function(A,x){A=p(A);var _e=Ap(x);if(_e!=="F")return A.index[_e];for(A=A.first;A;A=A.next)if(A.key==x)return A};return Hf(h.prototype,{clear:function(){for(var A=p(this),x=A.index,_e=A.first;_e;)_e.removed=!0,_e.previous&&(_e.previous=_e.previous.next=void 0),delete x[_e.index],_e=_e.next;A.first=A.last=void 0,ka?A.size=0:this.size=0},delete:function(A){var x=p(this);if(A=C(this,A)){var _e=A.next,cN=A.previous;delete x.index[A.index],A.removed=!0,cN&&(cN.next=_e),_e&&(_e.previous=cN),x.first==A&&(x.first=_e),x.last==A&&(x.last=cN),ka?x.size--:this.size--}return!!A},forEach:function(A){for(var x,_e=p(this),cN=Id(A,1<arguments.length?arguments[1]:void 0,3);x=x?x.next:_e.first;)for(cN(x.value,x.key,this);x&&x.removed;)x=x.previous},has:function(A){return!!C(this,A)}}),Hf(h.prototype,i?{get:function(A){return(A=C(this,A))&&A.value},set:function(A,x){return g(this,A===0?0:A,x)}}:{add:function(A){return g(this,A=A===0?0:A,A)}}),ka&&gx(h.prototype,"size",{get:function(){return p(this).size}}),h},setStrong:function(e,r,i){var o=r+" Iterator",h=gk(r),p=gk(o);bj(e,r,function(g,C){Bp(this,{type:o,target:g,state:h(g),kind:C,last:void 0})},function(){for(var g=p(this),C=g.kind,A=g.last;A&&A.removed;)A=A.previous;return g.target&&(g.last=A=A?A.next:g.state.first)?C=="keys"?{value:A.key,done:!1}:C=="values"?{value:A.value,done:!1}:{value:[A.key,A.value],done:!1}:(g.target=void 0,{value:void 0,done:!0})},i?"entries":"values",!i,!0),If(r)}};zp("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(r){return r=String(jb(r)),1&e&&(r=r.replace(hx,"")),2&e&&(r=r.replace(ix,"")),r}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r                　\u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r                　\u2028\u2029\uFEFF0x16`)!==22?function(e,r){return e=ik(String(e)),sh(e,r>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(e){var r,i=lc(e,!1);if(typeof i=="string"&&2<i.length){if((e=(i=ik(i)).charCodeAt(0))===43||e===45){if((e=i.charCodeAt(2))===88||e===120)return NaN}else if(e===48){switch(i.charCodeAt(1)){case 66:case 98:e=2;var o=49;break;case 79:case 111:e=8,o=55;break;default:return+i}var h=(i=i.slice(2)).length;for(r=0;r<h;r++){var p=i.charCodeAt(r);if(48>p||p>o)return NaN}return parseInt(i,e)}}return+i};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var r=1>arguments.length?0:e,i=this;return i instanceof Pd&&(nx?R(function(){th.valueOf.call(i)}):Zb(i)!="Number")?lh(new pd(Ep(r)),i,Pd):Ep(r)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var r,i=Qa(this),o=Sg(i,0),h=0,p=-1;for(r=arguments.length;p<r;p++){var g=p===-1?i:arguments[p],C=g;if(ha(C)){var A=C[Gp];C=A!==void 0?!!A:gd(C)}else C=!1;if(C){if(9007199254740991<h+(A=ta(g.length)))throw TypeError("Maximum allowed index exceeded");for(C=0;C<A;C++,h++)C in g&&Ge(o,h,g[C])}else{if(9007199254740991<=h)throw TypeError("Maximum allowed index exceeded");Ge(o,h++,g)}}return o.length=h,o}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,r,i){return yb(e),va(i),kk?kk(e,r,i):qx.call(e,r,i)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);i=e==="error";var o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var h;throw 0<r.length&&(h=r[0]),h instanceof Error?h:((r=Error("Unhandled error."+(h?" ("+h.message+")":""))).context=h,r)}if((i=o[e])===void 0)return!1;if(typeof i=="function")Hp(i,this,r);else for(o=Cl(i,h=i.length),i=0;i<h;++i)Hp(o[i],this,r);return!0},ea.prototype.addListener=function(e,r){return zl(this,e,r,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,r){return zl(this,e,r,!0)},ea.prototype.once=function(e,r){return ng(r),this.on(e,Al(this,e,r)),this},ea.prototype.prependOnceListener=function(e,r){return ng(r),this.prependListener(e,Al(this,e,r)),this},ea.prototype.removeListener=function(e,r){var i;ng(r);var o=this._events;if(o===void 0)return this;var h=o[e];if(h===void 0)return this;if(h===r||h.listener===r)--this._eventsCount==0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,h.listener||r));else if(typeof h!="function"){var p=-1;for(i=h.length-1;0<=i;i--)if(h[i]===r||h[i].listener===r){var g=h[i].listener;p=i;break}if(0>p)return this;if(p===0)h.shift();else{for(;p+1<h.length;p++)h[p]=h[p+1];h.pop()}h.length===1&&(o[e]=h[0]),o.removeListener!==void 0&&this.emit("removeListener",e,g||r)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var r=this._events;if(r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var i=Object.keys(r);for(r=0;r<i.length;++r){var o=i[r];o!=="removeListener"&&this.removeAllListeners(o)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(i=r[e])=="function")this.removeListener(e,i);else if(i!==void 0)for(r=i.length-1;0<=r;r--)this.removeListener(e,i[r]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,r){return typeof e.listenerCount=="function"?e.listenerCount(r):Dl.call(e,r)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,r){return new Promise(function(i,o){function h(g){e.removeListener(r,p),o(g)}function p(){typeof e.removeListener=="function"&&e.removeListener("error",h),i([].slice.call(arguments))}El(e,r,p,{once:!0}),r!=="error"&&vs(e,h,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol();return e[i]=7,"abcdefghijklmnopqrst".split("").forEach(function(o){r[o]=o}),Qe({},e)[i]!=7||Dc(Qe({},r)).join("")!="abcdefghijklmnopqrst"})?function(e,r){for(var i=Qa(e),o=arguments.length,h=1,p=Bf.f,g=zf;o>h;)for(var C,A=Af(arguments[h++]),x=p?Dc(A).concat(p(A)):Dc(A),_e=x.length,cN=0;_e>cN;)C=x[cN++],(!ka||g.call(A,C))&&(i[C]=A[C]);return i}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(e,r){var i,o=this instanceof Oc,h=Lj(e),p=r===void 0;return!o&&h&&e.constructor===Oc&&p||(nk?h&&!p&&(e=e.source):e instanceof Oc&&(p&&(r=tj.call(e)),e=e.source),pc&&(i=!!r&&-1<r.indexOf("y"))&&(r=r.replace(/y/g,"")),e=lh(nk?new sc(e,r):sc(e,r),o?this:lk,Oc),pc&&i&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(r){sc[e]=r}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(e){return function(r,i,o){return e(this,r,i,o)}}),Sf("Float64",function(e){return function(r,i,o){return e(this,r,i,o)}}),Sf("Uint32",function(e){return function(r,i,o){return e(this,r,i,o)}}),Sf("Uint16",function(e){return function(r,i,o){return e(this,r,i,o)}});var ok=function(e,r){return e===r?0:e==null?r==null?0:-1:r==null?e==null?0:1:typeof e.compare=="function"?e.compare(r):typeof r.compare=="function"?-r.compare(e):e<r?-1:e>r?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return e===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,r){var i;return e===r||(e==null?e==r:X(e.equiv)==="function"?e.equiv(r):r==null?e==r:X(r.equiv)==="function"?r.equiv(e):X(e)!=="string"&&X(r)!=="string"&&((i=Object.getPrototypeOf(e))!=null&&i!==Pp||(i=Object.getPrototypeOf(r))!=null&&i!==Pp?X(e)!=="function"&&e.length!==void 0&&X(r)!=="function"&&r.length!==void 0?Gx(e,r):e instanceof Set&&r instanceof Set?Hx(e,r):e instanceof Map&&r instanceof Map?Ix(e,r):e instanceof Date&&r instanceof Date?e.getTime()===r.getTime():e instanceof RegExp&&r instanceof RegExp?e.toString()===r.toString():e!=e&&r!=r:Fx(e,r)))},Gx=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,o=e.length;if(o===r.length)for(;0<=--o&&i(e[o],r[o]););return 0>o},Hx=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===r.size&&i(G(e.keys()).sort(),G(r.keys()).sort())},Ix=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===r.size&&i(G(e).sort(),G(r).sort())},Fx=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var o in e)if(!r.hasOwnProperty(o)||!i(e[o],r[o]))return!1;return!0},Qp=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(i){return i!==void 0?": "+i:""};return function(i){function o(p){return W(this,o),h.call(this,e(p)+r(p))}la(o,i);var h=ma(o);return o}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(e){throw new Jx(e)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*r}},{key:"norm",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*r}},{key:"minmax",value:function(r,i){return this.float()*(i-r)+r}}]),e}(),rk=Math.random,Lx=new(function(e){function r(){return W(this,r),i.apply(this,arguments)}la(r,e);var i=ma(r);return Ha(r,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*o}},{key:"norm",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*o}}]),r}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return e!=null&&typeof e.xform=="function"?e.xform():e},og=function(){function e(r){W(this,e),this.value=r}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,r){return[e,function(i){return i},r]},Qx=w.mark(function(e,r){var i,o,h,p,g,C;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:i=Gl(e)(ws()),o=i[1],h=i[2],p=0;case 4:if(!(p<r.length)){A.next=15;break}if(g=r[p],!((C=h([],g))instanceof og)){A.next=10;break}return A.delegateYield(Wh(o(C.deref())),"t0",9);case 9:return A.abrupt("return");case 10:if(!C.length){A.next=12;break}return A.delegateYield(C,"t1",12);case 12:p++,A.next=4;break;case 15:return A.delegateYield(Wh(o([])),"t2",16);case 16:case"end":return A.stop()}},Qx)}),ys=w.mark(Fl),zs=function(e,r){return[e[0],e[1],r]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(r){W(this,e),this._length=0,r&&this.into(r)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var r,i=this.head;i;)r=i.next,delete i.value,delete i.prev,delete i.next,i=r;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(r){var i=this._length;if(i<r._length)return-1;if(i>r._length)return 1;if(i===0)return 0;i=this.head,r=r.head;for(var o=0;i&&o==0;)o=ok(i.value,r.value),i=i.next,r=r.next;return o}},{key:"equiv",value:function(r){if(!(r instanceof e||r!=null&&typeof r!="function"&&r.length!==void 0)||this._length!==r.length)return!1;if(!this._length||this===r)return!0;for(var i=this.head,o=0;o<r.length;o++){if(!Xf(i.value,r[o]))return!1;i=i.next}return!0}},{key:Symbol.iterator,value:w.mark(function r(){var i;return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:i=this.head;case 1:if(!i){o.next=7;break}return o.next=4,i.value;case 4:i=i.next,o.next=1;break;case 7:case"end":return o.stop()}},r,this)})},{key:"seq",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(r>=i||0>r)){r=this.nthCell(r);var o=this.nthCell(i-1);return i=function h(p){return{first:function(){return p.value},next:function(){return p!==o&&p.next?h(p.next):void 0}}},r?i(r):void 0}}},{key:"cycle",value:w.mark(function r(){return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(this,"t0",2);case 2:i.next=0;break;case 4:case"end":return i.stop()}},r,this)})},{key:"$reduce",value:function(r,i){for(var o=this.head;o&&!(i instanceof og);)i=r(i,o.value),o=o.next;return i}},{key:"drop",value:function(){var r=this.head;if(r)return(this.head=r.next)?delete this.head.prev:delete this.tail,this._length--,r.value}},{key:"cons",value:function(r){return r={value:r,next:this.head},this.head?this.head.prev=r:this.tail=r,this.head=r,this._length++,this}},{key:"insertBefore",value:function(r,i){return r||vh("cell is undefined"),i={value:i,next:r,prev:r.prev},r.prev?r.prev.next=i:this.head=i,r.prev=i,this._length++,this}},{key:"insertAfter",value:function(r,i){return r||vh("cell is undefined"),i={value:i,next:r.next,prev:r},r.next?r.next.prev=i:this.tail=i,r.next=i,this._length++,this}},{key:"insertBeforeNth",value:function(r,i){if(0>r&&(r+=this._length),0>=r)return this.cons(i);if(0>r||r>=this._length)throw new qk(r);return this.insertBefore(this.nthCellUnsafe(r),i)}},{key:"insertAfterNth",value:function(r,i){if(0>r&&(r+=this._length),r>=this._length-1)return this.push(i);if(0>r||r>=this._length)throw new qk(r);return this.insertAfter(this.nthCellUnsafe(r),i)}},{key:"insertSorted",value:function(r,i){i=i||ok;for(var o=this.head;o;){if(0>=i(r,o.value))return this.insertBefore(o,r);o=o.next}return this.push(r)}},{key:"find",value:function(r){for(var i=this.head;i;){if(i.value===r)return i;i=i.next}}},{key:"findWith",value:function(r){for(var i=this.head;i;){if(r(i.value))return i;i=i.next}}},{key:"concat",value:function(){for(var r=this.copy(),i=arguments.length,o=Array(i),h=0;h<i;h++)o[h]=arguments[h];for(i=0;i<o.length;i++)r.into(o[i]);return r}},{key:"into",value:function(r){for(var i=0;i<r.length;i++)this.push(r[i])}},{key:"slice",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;r=0>r?r+this._length:r,i=0>i?i+this._length:i,(0>r||0>i)&&vh("invalid indices: ${from} / ${to}");for(var o=new e,h=this.nthCell(r);h&&++r<=i;)o.push(h.value),h=h.next;return o}},{key:"splice",value:function(r){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,o=2<arguments.length?arguments[2]:void 0;if(typeof r=="number"){if(0>r&&(r+=this._length),0>r||r>=this._length)throw new qk(r);var h=this.nthCellUnsafe(r)}else h=r;var p=new e;if(0<i)for(;h&&0<i--;)this.remove(h),p.push(h.value),h=h.next;else h&&(h=h.next);if(o)if(h)for(i=0;i<o.length;i++)this.insertBefore(h,o[i]);else for(h=0;h<o.length;h++)this.push(o[h]);return p}},{key:"remove",value:function(r){return r.prev?r.prev.next=r.next:this.head=r.next,r.next?r.next.prev=r.prev:this.tail=r.prev,this._length--,this}},{key:"swap",value:function(r,i){if(r!==i){var o=r.value;r.value=i.value,i.value=o}return this}},{key:"push",value:function(r){return this.tail?(r={value:r,prev:this.tail},this.tail=this.tail.next=r,this._length++,this):this.cons(r)}},{key:"pop",value:function(){var r=this.tail;if(r)return(this.tail=r.prev)?delete this.tail.next:delete this.head,this._length--,r.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(r){return this.head?(this.head.value=r,this):this.cons(r)}},{key:"setTail",value:function(r){return this.tail?(this.tail.value=r,this):this.push(r)}},{key:"setNth",value:function(r,i){var o=this.nthCell(r);return!o&&vh("index out of bounds: ".concat(r)),o.value=i,this}},{key:"nth",value:function(r,i){return(r=this.nthCell(r))?r.value:i}},{key:"nthCell",value:function(r){if(0>r&&(r+=this._length),!(0>r||r>=this._length))return this.nthCellUnsafe(r)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var r=this.peek();return this.pop(),this.cons(r)}}},{key:"map",value:function(r){for(var i=new e,o=this.head;o;)i.push(r(o.value)),o=o.next;return i}},{key:"filter",value:function(r){for(var i=new e,o=this.head;o;)r(o.value)&&i.push(o.value),o=o.next;return i}},{key:"reduce",value:function(r,i){for(var o=this.head;o;)i=r(i,o.value),o=o.next;return i}},{key:"shuffle",value:function(r){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(r=r??Math.ceil(1.5*Math.log2(this._length));0<r;r--)for(var o=this.head;o;){var h=o.next;.5>i.float()?this.asHead(o):this.asTail(o),o=h}return this}},{key:"sort",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var i=1;;){var o=this.head;this.tail=this.head=void 0;for(var h=0;o;){h++;for(var p=o,g=0,C=0;C<i&&(g++,p=p.next);C++);for(C=i;0<g||0<C&&p;){if(g===0){var A=p;p=p.next,C--}else p&&C!==0?0>=r(o.value,p.value)?(A=o,o=o.next,g--):(A=p,p=p.next,C--):(A=o,o=o.next,g--);this.tail?this.tail.next=A:this.head=A,A.prev=this.tail,this.tail=A}o=p}if(this.tail.next=void 0,1>=h)return this;i*=2}}},{key:"reverse",value:function(){for(var r=this.head,i=this.tail,o=(this._length>>>1)+(1&this._length);r&&i&&0<o;){var h=r.value;r.value=i.value,i.value=h,r=r.next,i=i.prev,o--}return this}},{key:"asHead",value:function(r){return r===this.head||(this.remove(r),this.head.prev=r,r.next=this.head,r.prev=void 0,this.head=r,this._length++),this}},{key:"asTail",value:function(r){return r===this.tail||(this.remove(r),this.tail.next=r,r.prev=this.tail,r.next=void 0,this.tail=r,this._length++),this}},{key:"toString",value:function(){for(var r=[],i=this.head;i;)r.push(String(i.value)),i=i.next;return r.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(r){if(r<=this._length>>1)var i=this.head,o="next";else i=this.tail,o="prev",r=this._length-r-1;for(;0<r--&&i;)i=i[o];return i}}]),e}(),tc=function(){function e(r,i){W(this,e),i=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},i),this.map=i.map(),this.items=new Rx,this._size=0,this.opts=i,r&&this.into(r)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(r){return[r.k,r]},this.items)}},{key:"keys",value:function(){return pg(function(r){return r.k},this.items)}},{key:"values",value:function(){return pg(function(r){return r.v},this.items)}},{key:"copy",value:function(){var r=this.empty();r.items=this.items.copy();for(var i=r.items.head;i;)r.map.set(i.value.k,i),i=i.next;return r}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var r=this.opts.release;if(r){for(var i;i=this.items.drop();)r(i.k,i.v);return!0}return this.items.release()}},{key:"has",value:function(r){return this.map.has(r)}},{key:"get",value:function(r,i){return(r=this.map.get(r))?this.resetEntry(r):i}},{key:"set",value:function(r,i){var o=this.opts.ksize(r)+this.opts.vsize(i),h=this.map.get(r);return this._size+=Math.max(0,o-(h?h.value.s:0)),this.ensureSize()&&this.doSetEntry(h,r,i,o),i}},{key:"into",value:function(r){for(var i=0;i<r.length;i++){var o=r[i];this.set(o[0],o[1])}return this}},{key:"getSet",value:function(r,i){var o=this,h=this.map.get(r);return h?Promise.resolve(this.resetEntry(h)):i().then(function(p){return o.set(r,p)})}},{key:"delete",value:function(r){return!!(r=this.map.get(r))&&(this.removeEntry(r),!0)}},{key:"resetEntry",value:function(r){return this.items.asTail(r),r.value.v}},{key:"ensureSize",value:function(){for(var r=this.opts.release,i=this.opts.maxsize,o=this.opts.maxlen;this._size>i||this.length>=o;){var h=this.items.drop();if(!h)return!1;this.map.delete(h.k),r&&r(h.k,h.v),this._size-=h.s}return!0}},{key:"removeEntry",value:function(r){var i=r.value;this.map.delete(i.k),this.items.remove(r),this.opts.release&&this.opts.release(i.k,i.v),this._size-=i.s}},{key:"doSetEntry",value:function(r,i,o,h){r?(r.value.v=o,r.value.s=h,this.items.asTail(r)):(this.items.push({k:i,v:o,s:h}),this.map.set(i,this.items.tail))}}]),e}(),Sx=function(e){function r(o,h){return W(this,r),h=Object.assign({ttl:36e5},h),i.call(this,o,h)}la(r,e);var i=ma(r);return Ha(r,[{key:"empty",value:function(){return new r(null,this.opts)}},{key:"has",value:function(o){return this.get(o)!==void 0}},{key:"get",value:function(o,h){if(o=this.map.get(o)){if(o.value.t>=Date.now())return this.resetEntry(o);this.removeEntry(o)}return h}},{key:"set",value:function(o,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,g=this.opts.ksize(o)+this.opts.vsize(h),C=this.map.get(o);return this._size+=Math.max(0,g-(C?C.value.s:0)),this.ensureSize()&&(p=Date.now()+p,C?(C.value.v=h,C.value.s=g,C.value.t=p,this.items.asTail(C)):(this.items.push({k:o,v:h,s:g,t:p}),this.map.set(o,this.items.tail))),h}},{key:"getSet",value:function(o,h){var p=this,g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,C=this.get(o);return C?Promise.resolve(C):h().then(function(A){return p.set(o,A,g)})}},{key:"prune",value:function(){for(var o=Date.now(),h=this.items.head;h;)h.value.t<o&&this.removeEntry(h),h=h.next}},{key:"ensureSize",value:function(){for(var o=this.opts.maxsize,h=this.opts.maxlen,p=Date.now(),g=this.items.head;g&&(this._size>o||this.length>=h);)g.value.t<p&&this.removeEntry(g),g=g.next;return Th(wd(r.prototype),"ensureSize",this).call(this)}}]),r}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(e==null)e=e===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var r=Ux.call(e,Yf),i=e[Yf];try{e[Yf]=void 0;var o=!0}catch{}var h=Vx.call(e);o&&(r?e[Yf]=i:delete e[Yf]),e=h}else e=Wx.call(e);return e},lb=function(e){var r=X(e);return e!=null&&(r=="object"||r=="function")},qi=function(e){return!!lb(e)&&((e=Qd(e))=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(e!=null){try{return Xx.call(e)}catch{}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,r){return e=e==null?void 0:e[r],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var r=this.__data__;return Zf?(e=r[e])==="__lodash_hash_undefined__"?void 0:e:$x.call(r,e)?r[e]:void 0},zd.prototype.has=function(e){var r=this.__data__;return Zf?r[e]!==void 0:ay.call(r,e)},zd.prototype.set=function(e,r){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Zf&&r===void 0?"__lodash_hash_undefined__":r,this};var $f=function(e,r){return e===r||e!=e&&r!=r},wh=function(e,r){for(var i=e.length;i--;)if($f(e[i][0],r))return i;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var r=this.__data__;return!(0>(e=wh(r,e)))&&(e==r.length-1?r.pop():by.call(r,e,1),--this.size,!0)},ce.prototype.get=function(e){var r=this.__data__;return 0>(e=wh(r,e))?void 0:r[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,r){var i=this.__data__,o=wh(i,e);return 0>o?(++this.size,i.push([e,r])):i[o][1]=r,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,r){e=e.__data__;var i=X(r);return(i=="string"||i=="number"||i=="symbol"||i=="boolean"?r!=="__proto__":r===null)?e[typeof r=="string"?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,r){var i=xh(this,e),o=i.size;return i.set(e,r),this.size+=i.size==o?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,r,i,o){var h=e.length;for(i+=-1;++i<h;)if(r(e[i],i,e))return i;return-1},cy=function(e){return e!=e},dy=function(e,r){var i;if(i=!(e==null||!e.length)){if(r==r)e:{i=-1;for(var o=e.length;++i<o;)if(e[i]===r){e=i;break e}e=-1}else e=Xp(e,cy,0);i=-1<e}return i},ey=function(e,r,i){for(var o=-1,h=e==null?0:e.length;++o<h;)if(i(r,e[o]))return!0;return!1},fy=function(e,r){return e.has(r)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var r=-1,i=Array(e.size);return e.forEach(function(o){i[++r]=o}),i},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,r,i){var o=-1,h=dy,p=e.length,g=!0,C=[],A=C;if(i)g=!1,h=ey;else if(200<=p){if(h=iy(e))return uk(h);g=!1,h=fy,A=new gf}else A=C;e:for(;++o<p;){var x=e[o],_e=x;if(x=i||x!==0?x:0,g&&_e==_e){for(var cN=A.length;cN--;)if(A[cN]===_e)continue e;C.push(x)}else h(A,_e,i)||(A!==C&&A.push(_e),C.push(x))}return C},Yp=function(e){for(var r=-1,i=e==null?0:e.length,o={};++r<i;){var h=e[r];o[h[0]]=h[1]}return o},he=function(e,r){for(var i=-1,o=e==null?0:e.length,h=Array(o);++i<o;)h[i]=r(e[i],i,e);return h};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var r=this.__data__;return e=r.delete(e),this.size=r.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,r){var i=this.__data__;if(i instanceof rg){var o=i.__data__;if(!ag||199>o.length)return o.push([e,r]),this.size=++i.size,this;i=this.__data__=new qg(o)}return i.set(e,r),this.size=i.size,this};var ge=ee,Is=function(e,r){for(var i=-1,o=e==null?0:e.length;++i<o&&r(e[i],i,e)!==!1;);return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch{}}(),bg=function(e,r,i){r=="__proto__"&&yh?yh(e,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[r]=i},jy=Object.prototype.hasOwnProperty,Ml=function(e,r,i){var o=e[r];jy.call(e,r)&&$f(o,i)&&(i!==void 0||r in e)||bg(e,r,i)},re=function(e,r,i,o){var h=!i;i||(i={});for(var p=-1,g=r.length;++p<g;){var C=r[p],A=void 0;A===void 0&&(A=e[C]),h?bg(i,C,A):Ml(i,C,A)}return i},gc=function(e){return e!=null&&X(e)=="object"},Zp=function(e){return gc(e)&&Qd(e)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(e,r){var i=(r=r&&!r.nodeType&&r)&&e&&!e.nodeType&&e;r=i&&i.exports===r?Cb.Buffer:void 0,e.exports=(r?r.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,r){var i=X(e);return!!(r=r??9007199254740991)&&(i=="number"||i!="symbol"&&ny.test(e))&&-1<e&&e%1==0&&e<r},xk=function(e){return typeof e=="number"&&-1<e&&e%1==0&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(r){return e(r)}},Se=$a(function(e,r){var i=r&&!r.nodeType&&r;i=(r=i&&e&&!e.nodeType&&e)&&r.exports===i&&Tp.process;e:{try{var o=r&&r.require&&r.require("util").types;if(o){var h=o;break e}h=i&&i.binding&&i.binding("util");break e}catch{}h=void 0}e.exports=h}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,r){var i=Va(e),o=!i&&rf(e),h=!i&&!o&&jf(e),p=!i&&!o&&!h&&bi(e);if(i=i||o||h||p){o=e.length;for(var g=String,C=-1,A=Array(o);++C<o;)A[C]=g(C);o=A}else o=[];for(var x in g=o.length,e)!r&&!py.call(e,x)||i&&(x=="length"||h&&(x=="offset"||x=="parent")||p&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||wk(x,g))||o.push(x);return o},qy=Object.prototype,yk=function(e){var r=e&&e.constructor;return e===(typeof r=="function"&&r.prototype||qy)},cq=function(e,r){return function(i){return e(r(i))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return e!=null&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var r,i=[];for(r in Object(e))sy.call(e,r)&&r!="constructor"&&i.push(r);e=i}else e=ry(e);return e},Es=function(e,r){return e&&re(r,Ad(r),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var r=yk(e),i=[];for(o in e)(o!="constructor"||!r&&ty.call(e,o))&&i.push(o);e=i}else{var o=[];if(e!=null)for(r in Object(e))o.push(r);e=o}return e},Cs=function(e,r){return e&&re(r,kf(r),e)},Jl=$a(function(e,r){var i=(r=r&&!r.nodeType&&r)&&e&&!e.nodeType&&e,o=(r=i&&i.exports===r?Cb.Buffer:void 0)?r.allocUnsafe:void 0;e.exports=function(h,p){return p?h.slice():(p=h.length,p=o?o(p):new h.constructor(p),h.copy(p),p)}}),Xh=function(e,r){var i=-1,o=e.length;for(r||(r=Array(o));++i<o;)r[i]=e[i];return r},uy=function(e,r){for(var i=-1,o=e==null?0:e.length,h=0,p=[];++i<o;){var g=e[i];r(g,i,e)&&(p[h++]=g)}return p},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return e==null?[]:(e=Object(e),uy(eq(e),function(r){return vy.call(e,r)}))}:dq,Ds=function(e,r){return re(e,zk(e),r)},ai=function(e,r){for(var i=-1,o=r.length,h=e.length;++i<o;)e[h+i]=r[i];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var r=[];e;)ai(r,zk(e)),e=Ak(e);return r}:dq,Bs=function(e,r){return re(e,fq(e),r)},gq=function(e,r,i){return r=r(e),Va(e)?r:ai(r,i(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(e){var r=Qd(e);if(e=(e=r=="[object Object]"?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return r});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var r=e.length,i=new e.constructor(r);return r&&typeof e[0]=="string"&&By.call(e,"index")&&(i.index=e.index,i.input=e.input),i},Ah=Cb.Uint8Array,Ek=function(e){var r=new e.constructor(e.byteLength);return new Ah(r).set(new Ah(e)),r},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,r){return r=r?Ek(e.buffer):e.buffer,new e.constructor(r,e.byteOffset,e.length)},Fs=function(e,r,i){var o=e.constructor;switch(r){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return r=i?Ek(e.buffer):e.buffer,new e.constructor(r,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,i);case"[object Map]":return new o;case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return(r=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,r;case"[object Set]":return new o;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(r){return lb(r)?jq?jq(r):(e.prototype=r,r=new e,e.prototype=void 0,r):{}}}(),Kl=function(e){return typeof e.constructor!="function"||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&hf(e)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&hf(e)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return X(e)=="symbol"||gc(e)&&Qd(e)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,r){if(Va(e))return!1;var i=X(e);return!(i!="number"&&i!="symbol"&&i!="boolean"&&e!=null&&!ie(e))||Hy.test(e)||!Gy.test(e)||r!=null&&e in Object(r)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var r=(e=Zh(e,function(i){return r.size===500&&r.clear(),i})).cache;return e}(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Iy,function(i,o,h,p){r.push(h?p.replace(Jy,"$1"):o||i)}),r}),mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,r){return Va(e)?e:Fk(e,r)?[e]:Ky(e==null?"":Nl(e))},cg=function(e){if(typeof e=="string"||ie(e))return e;var r=e+"";return r=="0"&&1/e==-1/0?"-0":r},Ch=function(e,r){for(var i=0,o=(r=Bh(r,e)).length;e!=null&&i<o;)e=e[cg(r[i++])];return i&&i==o?e:void 0},My=function(e,r){if(!(2>(r=Bh(r,e)).length)){var i=r,o=0,h=-1,p=-1,g=i.length;for(0>o&&(o=-o>g?0:g+o),0>(h=h>g?g:h)&&(h+=g),g=o>h?0:h-o>>>0,o>>>=0,h=Array(g);++p<g;)h[p]=i[p+o];e=Ch(e,h)}return(i=e==null)||(i=r==null?0:r.length,i=delete e[cg(i?r[i-1]:void 0)]),i},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||Qd(e)!="[object Object]")&&((e=Ak(e))===null||typeof(e=Ny.call(e,"constructor")&&e.constructor)=="function"&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return e!=null&&e.length?$h(e):[]},Ry=function(e,r,i){switch(i.length){case 0:return e.call(r);case 1:return e.call(r,i[0]);case 2:return e.call(r,i[0],i[1]);case 3:return e.call(r,i[0],i[1],i[2])}return e.apply(r,i)},pq=Math.max,qq=function(e,r,i){return r=pq(r===void 0?e.length-1:r,0),function(){for(var o=arguments,h=-1,p=pq(o.length-r,0),g=Array(p);++h<p;)g[h]=o[r+h];for(h=-1,p=Array(r+1);++h<r;)p[h]=o[h];return p[r]=i(g),Ry(e,this,p)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var r=0,i=0;return function(){var o=Ty(),h=16-(o-i);if(i=o,0<h){if(800<=++r)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}(yh?function(e,r){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(r),writable:!0})}:Dh),Gk=function(e){return rq(qq(e,void 0,Qy),e+"")}(function(e,r){var i={};if(e==null)return i;var o=!1;r=he(r,function(p){return p=Bh(p,e),o||(o=1<p.length),p}),re(e,Ll(e),i),o&&(i=fe(i,7,Py));for(var h=r.length;h--;)My(i,r[h]);return i}),Uy=function(e,r,i,o){for(var h=-1,p=e==null?0:e.length;++h<p;){var g=e[h];r(o,g,i(g),e)}return o},um=function(e,r,i){for(var o=-1,h=Object(e),p=(i=i(e)).length;p--;){var g=i[++o];if(r(h[g],g,h)===!1)break}return e},sq=function(e,r){return e&&um(e,r,Ad)},Hk=function(e,r){return function(i,o){if(i==null)return i;if(!Ed(i))return e(i,o);for(var h=i.length,p=-1,g=Object(i);++p<h&&o(g[p],p,g)!==!1;);return i}}(sq),Vy=function(e,r,i,o){return Hk(e,function(h,p,g){r(o,h,i(h),g)}),o},tq=function(e,r){for(var i=-1,o=e==null?0:e.length;++i<o;)if(r(e[i],i,e))return!0;return!1},Pl=function(e,r,i,o,h,p){var g=1&i,C=e.length,A=r.length;if(C!=A&&!(g&&A>C))return!1;A=p.get(e);var x=p.get(r);if(A&&x)return A==r&&x==e;A=-1,x=!0;var _e=2&i?new gf:void 0;for(p.set(e,r),p.set(r,e);++A<C;){var cN=e[A],dN=r[A];if(o)var fN=g?o(dN,cN,A,r,e,p):o(cN,dN,A,e,r,p);if(fN!==void 0){if(fN)continue;x=!1;break}if(_e){if(!tq(r,function(mN,EN){if(!_e.has(EN)&&(cN===mN||h(cN,mN,i,o,p)))return _e.push(EN)})){x=!1;break}}else if(cN!==dN&&!h(cN,dN,i,o,p)){x=!1;break}}return p.delete(e),p.delete(r),x},Wy=function(e){var r=-1,i=Array(e.size);return e.forEach(function(o,h){i[++r]=[h,o]}),i},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,r,i,o,h,p,g){switch(i){case"[object DataView]":if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)break;e=e.buffer,r=r.buffer;case"[object ArrayBuffer]":if(e.byteLength!=r.byteLength||!p(new Ah(e),new Ah(r)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+r);case"[object Error]":return e.name==r.name&&e.message==r.message;case"[object RegExp]":case"[object String]":return e==r+"";case"[object Map]":var C=Wy;case"[object Set]":if(C||(C=uk),e.size!=r.size&&!(1&o))break;return(i=g.get(e))?i==r:(o|=2,g.set(e,r),r=Pl(C(e),C(r),o,h,p,g),g.delete(e),r);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(r)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,r,i,o){var h=i.length,p=h;if(e==null)return!p;for(e=Object(e);h--;){var g=i[h];if(g[2]?g[1]!==e[g[0]]:!(g[0]in e))return!1}for(;++h<p;){var C=(g=i[h])[0],A=e[C],x=g[1];if(g[2]){if(A===void 0&&!(C in e))return!1}else{var _e;if(g=new ge,_e===void 0?!je(x,A,3,o,g):!_e)return!1}}return!0},Yy=function(e){for(var r=Ad(e),i=r.length;i--;){var o=r[i],h=e[o];r[i]=[o,h,h==h&&!lb(h)]}return r},vq=function(e,r){return function(i){return i!=null&&i[e]===r&&(r!==void 0||e in Object(i))}},Zy=function(e){var r=Yy(e);return r.length==1&&r[0][2]?vq(r[0][0],r[0][1]):function(i){return i===e||Xy(i,e,r)}},$y=function(e,r){return Fk(e)&&r==r&&!lb(r)?vq(cg(e),r):function(i){var o=i==null?void 0:Ch(i,e);if((o=o===void 0?void 0:o)===void 0&&o===r){if(o=i!=null){for(var h=-1,p=(o=Bh(o=e,i)).length,g=!1;++h<p;){var C=cg(o[h]);if(!(g=i!=null&&i!=null&&C in Object(i)))break;i=i[C]}g||++h!=p?o=g:o=!!(p=i==null?0:i.length)&&xk(p)&&wk(C,p)&&(Va(i)||rf(i))}C=o}else C=je(r,o,3);return C}},az=function(e){return function(r){return r==null?void 0:r[e]}},bz=function(e){return function(r){return Ch(r,e)}},Te=function(e){return typeof e=="function"?e:e==null?Dh:X(e)=="object"?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,r){return function(i,o){var h={};return(Va(i)?Uy:Vy)(i,e,Te(o),h)}}(function(e,r,i){bg(e,i,r)}),uc=function(e,r){var i={};return r=Te(r),sq(e,function(o,h,p){bg(i,h,r(o,h,p))}),i};N({target:"String",proto:!0,forced:R(function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var r=Gb(e),i=this.div(r);return r=i.mul(r).sub(this),i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}i=Gb(sg(e,6),this.unsigned),r=this;for(var o="";;){var h=r.div(i),p=(r.sub(h.mul(i)).toInt()>>>0).toString(e);if((r=h).isZero())return p+o;for(;6>p.length;)p="0"+p;o=""+p+o}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;0<r&&!(e&1<<r);r--);return this.high!=0?r+33:r+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var r=this.high>>>16,i=65535&this.high,o=this.low>>>16,h=e.high>>>16,p=65535&e.high,g=e.low>>>16;return o=(g=((e=(65535&this.low)+(65535&e.low))>>>16)+(o+g))>>>16,ya((65535&g)<<16|65535&e,(r=((o+=i+p)>>>16)+(r+h)&65535)<<16|65535&o,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var r=Qb.mul(this.low,this.high,e.low,e.high);return ya(r,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);r=this.high>>>16;var i=65535&this.high,o=this.low>>>16,h=65535&this.low,p=e.high>>>16,g=65535&e.high,C=e.low>>>16,A=h*(e=65535&e.low),x=(A>>>16)+o*e,_e=x>>>16;_e+=(x=(65535&x)+h*C)>>>16;var cN=(_e+=i*e)>>>16;return ya((65535&x)<<16|65535&A,(cN=(cN+=(_e=(65535&_e)+o*C)>>>16)+((_e=(65535&_e)+h*g)>>>16)+(r*e+i*C+o*g+h*p)&65535)<<16|65535&_e,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||e.low!==-1||e.high!==-1?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var r=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var i=this.shr(1).div(e).shl(1);if(i.eq(Hb))return e.isNegative()?Ue:Kk;var o=this.sub(e.mul(i));return i.add(o.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Hb}for(o=this;o.gte(e);){i=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));var h=Math.ceil(Math.log(i)/Math.LN2);h=48>=h?1:sg(2,h-48);for(var p=Gb(i),g=p.mul(e);g.isNegative()||g.gt(o);)g=(p=Gb(i-=h,this.unsigned)).mul(e);p.isZero()&&(p=Ue),r=r.add(p),o=o.sub(g)}return r},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),(e&=63)===0)return this;var r=this.high;return 32>e?ya(this.low>>>e|r<<32-e,r>>>e,this.unsigned):ya(e===32?r:r>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,r=this.low;return[255&r,r>>>8&255,r>>>16&255,r>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,r>>>24,r>>>16&255,r>>>8&255,255&r]},xa.fromBytes=function(e,r,i){return i?xa.fromBytesLE(e,r):xa.fromBytesBE(e,r)},xa.fromBytesLE=function(e,r){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},xa.fromBytesBE=function(e,r){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};var di=function(e,r){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var h in o)o.hasOwnProperty(h)&&(i[h]=o[h])})(e,r)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&typeof e.length=="number"},lf=function(){function e(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(i,o){return o+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(r){this.closed=!1,this._subscriptions=this._parentOrParents=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return e.prototype.unsubscribe=function(){if(!this.closed){var r=this._parentOrParents,i=this._ctorUnsubscribe,o=this._unsubscribe,h=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,r instanceof e)r.remove(this);else if(r!==null)for(var p=0;p<r.length;++p)r[p].remove(this);if(le(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(C){var g=C instanceof lf?Xl(C.errors):[C]}}if(Jb(h)){for(p=-1,r=h.length;++p<r;)if(ei(i=h[p]))try{i.unsubscribe()}catch(C){g=g||[],C instanceof lf?g=g.concat(Xl(C.errors)):g.push(C)}}if(g)throw new lf(g)}},e.prototype.add=function(r){var i=r;if(!r)return e.EMPTY;switch(X(r)){case"function":i=new e(r);case"object":if(i===this||i.closed||typeof i.unsubscribe!="function")return i;if(this.closed)return i.unsubscribe(),i;i instanceof e||(r=i,(i=new e)._subscriptions=[r]);break;default:throw Error("unrecognized teardown "+r+" added to Subscription.")}if((r=i._parentOrParents)===null)i._parentOrParents=this;else if(r instanceof e){if(r===this)return i;i._parentOrParents=[r,this]}else{if(r.indexOf(this)!==-1)return i;r.push(this)}return(r=this._subscriptions)===null?this._subscriptions=[i]:r.push(i),i},e.prototype.remove=function(r){var i=this._subscriptions;i&&(r=i.indexOf(r))!==-1&&i.splice(r,1)},e.EMPTY=function(r){return r.closed=!0,r}(new e),e}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function r(i,o,h){var p=e.call(this)||this;switch(p.syncErrorValue=null,p.syncErrorThrown=!1,p.syncErrorThrowable=!1,p.isStopped=!1,arguments.length){case 0:p.destination=Eh;break;case 1:if(!i){p.destination=Eh;break}if(X(i)==="object"){i instanceof r?(p.syncErrorThrowable=i.syncErrorThrowable,p.destination=i,i.add(p)):(p.syncErrorThrowable=!0,p.destination=new yq(p,i));break}default:p.syncErrorThrowable=!0,p.destination=new yq(p,i,o,h)}return p}return O(r,e),r.prototype[Fh]=function(){return this},r.create=function(i,o,h){return(i=new r(i,o,h)).syncErrorThrowable=!1,i},r.prototype.next=function(i){this.isStopped||this._next(i)},r.prototype.error=function(i){this.isStopped||(this.isStopped=!0,this._error(i))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(i){this.destination.next(i)},r.prototype._error=function(i){this.destination.error(i),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var i=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=i,this},r}(Oa),yq=function(e){function r(i,o,h,p){var g=e.call(this)||this;if(g._parentSubscriber=i,i=g,le(o))var C=o;else o&&(C=o.next,h=o.error,p=o.complete,o!==Eh&&(le((i=Object.create(o)).unsubscribe)&&g.add(i.unsubscribe.bind(i)),i.unsubscribe=g.unsubscribe.bind(g)));return g._context=i,g._next=C,g._error=h,g._complete=p,g}return O(r,e),r.prototype.next=function(i){if(!this.isStopped&&this._next){var o=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable?this.__tryOrSetError(o,this._next,i)&&this.unsubscribe():this.__tryOrUnsub(this._next,i)}},r.prototype.error=function(i){if(!this.isStopped){var o=this._parentSubscriber,h=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)h&&o.syncErrorThrowable?this.__tryOrSetError(o,this._error,i):this.__tryOrUnsub(this._error,i),this.unsubscribe();else if(o.syncErrorThrowable)h?(o.syncErrorValue=i,o.syncErrorThrown=!0):me(i),this.unsubscribe();else{if(this.unsubscribe(),h)throw i;me(i)}}},r.prototype.complete=function(){var i=this;if(!this.isStopped){var o=this._parentSubscriber;if(this._complete){var h=function(){return i._complete.call(i._context)};Ib.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable?this.__tryOrSetError(o,h):this.__tryOrUnsub(h)}this.unsubscribe()}},r.prototype.__tryOrUnsub=function(i,o){try{i.call(this._context,o)}catch(h){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw h;me(h)}},r.prototype.__tryOrSetError=function(i,o,h){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{o.call(this._context,h)}catch(p){return Ib.useDeprecatedSynchronousErrorHandling?(i.syncErrorValue=p,i.syncErrorThrown=!0):me(p),!0}return!1},r.prototype._unsubscribe=function(){var i=this._parentSubscriber;this._parentSubscriber=this._context=null,i.unsubscribe()},r}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function e(r){this._isScalar=!1,r&&(this._subscribe=r)}return e.prototype.lift=function(r){var i=new e;return i.source=this,i.operator=r,i},e.prototype.subscribe=function(r,i,o){var h=this.operator;e:{if(r){if(r instanceof ia)break e;if(r[Fh]){r=r[Fh]();break e}}r=r||i||o?new ia(r,i,o):new ia(Eh)}if(h?r.add(h.call(r,this.source)):r.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),Ib.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(i){Ib.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=i),fi(r)?r.error(i):console.warn(i)}},e.prototype.forEach=function(r,i){var o=this;return new(i=Zl(i))(function(h,p){var g=o.subscribe(function(C){try{r(C)}catch(A){p(A),g&&g.unsubscribe()}},p,h)})},e.prototype._subscribe=function(r){var i=this.source;return i&&i.subscribe(r)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return r.length===0?this:Yl(r)(this)},e.prototype.toPromise=function(r){var i=this;return new(r=Zl(r))(function(o,h){var p;i.subscribe(function(g){return p=g},function(g){return h(g)},function(){return o(p)})})},e.create=function(r){return new e(r)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function r(i,o){var h=e.call(this)||this;return h.subject=i,h.subscriber=o,h.closed=!1,h}return O(r,e),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var i=this.subject,o=i.observers;this.subject=null,!o||o.length===0||i.isStopped||i.closed||(i=o.indexOf(this.subscriber))!==-1&&o.splice(i,1)}},r}(Oa),Aq=function(e){function r(i){var o=e.call(this,i)||this;return o.destination=i,o}return O(r,e),r}(ia),Pa=function(e){function r(){var i=e.call(this)||this;return i.observers=[],i.closed=!1,i.isStopped=!1,i.hasError=!1,i.thrownError=null,i}return O(r,e),r.prototype[Fh]=function(){return new Aq(this)},r.prototype.lift=function(i){var o=new Bq(this,this);return o.operator=i,o},r.prototype.next=function(i){if(this.closed)throw new qd;if(!this.isStopped){var o=this.observers,h=o.length;o=o.slice();for(var p=0;p<h;p++)o[p].next(i)}},r.prototype.error=function(i){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=i,this.isStopped=!0;var o=this.observers,h=o.length;o=o.slice();for(var p=0;p<h;p++)o[p].error(i);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var i=this.observers,o=i.length;i=i.slice();for(var h=0;h<o;h++)i[h].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},r.prototype._trySubscribe=function(i){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,i)},r.prototype._subscribe=function(i){if(this.closed)throw new qd;return this.hasError?(i.error(this.thrownError),Oa.EMPTY):this.isStopped?(i.complete(),Oa.EMPTY):(this.observers.push(i),new zq(this,i))},r.prototype.asObservable=function(){var i=new Y;return i.source=this,i},r.create=function(i,o){return new Bq(i,o)},r}(Y),Bq=function(e){function r(i,o){var h=e.call(this)||this;return h.destination=i,h.source=o,h}return O(r,e),r.prototype.next=function(i){var o=this.destination;o&&o.next&&o.next(i)},r.prototype.error=function(i){var o=this.destination;o&&o.error&&this.destination.error(i)},r.prototype.complete=function(){var i=this.destination;i&&i.complete&&this.destination.complete()},r.prototype._subscribe=function(i){return this.source?this.source.subscribe(i):Oa.EMPTY},r}(Pa),Ns=function(){function e(r){this.connectable=r}return e.prototype.call=function(r,i){var o=this.connectable;return o._refCount++,r=new cz(r,o),i=i.subscribe(r),r.closed||(r.connection=o.connect()),i},e}(),cz=function(e){function r(i,o){return(i=e.call(this,i)||this).connectable=o,i}return O(r,e),r.prototype._unsubscribe=function(){var i=this.connectable;if(i){this.connectable=null;var o=i._refCount;0>=o?this.connection=null:(i._refCount=o-1,1<o?this.connection=null:(o=this.connection,i=i._connection,this.connection=null,!i||o&&i!==o||i.unsubscribe()))}else this.connection=null},r}(ia),Cq=function(e){function r(i,o){var h=e.call(this)||this;return h.source=i,h.subjectFactory=o,h._refCount=0,h._isComplete=!1,h}return O(r,e),r.prototype._subscribe=function(i){return this.getSubject().subscribe(i)},r.prototype.getSubject=function(){var i=this._subject;return i&&!i.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var i=this._connection;return i||(this._isComplete=!1,(i=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),i.closed&&(this._connection=null,i=Oa.EMPTY)),i},r.prototype.refCount=function(){return $l()(this)},r}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function r(i,o){return(i=e.call(this,i)||this).connectable=o,i}return O(r,e),r.prototype._error=function(i){this._unsubscribe(),e.prototype._error.call(this,i)},r.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var i=this.connectable;if(i){this.connectable=null;var o=i._connection;i._refCount=0,i._subject=null,i._connection=null,o&&o.unsubscribe()}},r}(Aq);(function(e){function r(i,o){return(i=e.call(this,i)||this).connectable=o,i}O(r,e),r.prototype._unsubscribe=function(){var i=this.connectable;if(i){this.connectable=null;var o=i._refCount;0>=o?this.connection=null:(i._refCount=o-1,1<o?this.connection=null:(o=this.connection,i=i._connection,this.connection=null,!i||o&&i!==o||i.unsubscribe()))}else this.connection=null}})(ia),function(e){function r(i,o,h,p,g){return(i=e.call(this,i)||this).keySelector=o,i.elementSelector=h,i.durationSelector=p,i.subjectSelector=g,i.groups=null,i.attemptedToUnsubscribe=!1,i.count=0,i}O(r,e),r.prototype._next=function(i){try{var o=this.keySelector(i)}catch(h){return void this.error(h)}this._group(i,o)},r.prototype._group=function(i,o){var h=this.groups;h||(h=this.groups=new Map);var p=h.get(o);if(this.elementSelector)try{var g=this.elementSelector(i)}catch(C){this.error(C)}else g=i;if(!p&&(p=this.subjectSelector?this.subjectSelector():new Pa,h.set(o,p),i=new Mk(o,p,this),this.destination.next(i),this.durationSelector)){i=void 0;try{i=this.durationSelector(new Mk(o,p))}catch(C){return void this.error(C)}this.add(i.subscribe(new ez(o,p,this)))}p.closed||p.next(g)},r.prototype._error=function(i){var o=this.groups;o&&(o.forEach(function(h,p){h.error(i)}),o.clear()),this.destination.error(i)},r.prototype._complete=function(){var i=this.groups;i&&(i.forEach(function(o,h){o.complete()}),i.clear()),this.destination.complete()},r.prototype.removeGroup=function(i){this.groups.delete(i)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function r(i,o,h){var p=e.call(this,o)||this;return p.key=i,p.group=o,p.parent=h,p}return O(r,e),r.prototype._next=function(i){this.complete()},r.prototype._unsubscribe=function(){var i=this.parent,o=this.key;this.key=this.parent=null,i&&i.removeGroup(o)},r}(ia),Mk=function(e){function r(i,o,h){var p=e.call(this)||this;return p.key=i,p.groupSubject=o,p.refCountSubscription=h,p}return O(r,e),r.prototype._subscribe=function(i){var o=new Oa,h=this.refCountSubscription,p=this.groupSubject;return h&&!h.closed&&o.add(new fz(h)),o.add(p.subscribe(i)),o},r}(Y),fz=function(e){function r(i){var o=e.call(this)||this;return o.parent=i,i.count++,o}return O(r,e),r.prototype.unsubscribe=function(){var i=this.parent;i.closed||this.closed||(e.prototype.unsubscribe.call(this),--i.count,i.count===0&&i.attemptedToUnsubscribe&&i.unsubscribe())},r}(Oa),gz=function(e){function r(i){var o=e.call(this)||this;return o._value=i,o}return O(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(i){var o=e.prototype._subscribe.call(this,i);return o&&!o.closed&&i.next(this._value),o},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},r.prototype.next=function(i){e.prototype.next.call(this,this._value=i)},r}(Pa),dg=function(e){function r(i,o){var h=e.call(this,i,o)||this;return h.scheduler=i,h.work=o,h.pending=!1,h}return O(r,e),r.prototype.schedule=function(i,o){if(o===void 0&&(o=0),this.closed)return this;this.state=i,i=this.id;var h=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(h,i,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(h,this.id,o),this},r.prototype.requestAsyncId=function(i,o,h){return h===void 0&&(h=0),setInterval(i.flush.bind(i,this),h)},r.prototype.recycleAsyncId=function(i,o,h){if(h===void 0&&(h=0),h!==null&&this.delay===h&&this.pending===!1)return o;clearInterval(o)},r.prototype.execute=function(i,o){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(i=this._execute(i,o))?i:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(i,o){o=!1;var h=void 0;try{this.work(i)}catch(p){o=!0,h=!!p&&p||Error(p)}if(o)return this.unsubscribe(),h},r.prototype._unsubscribe=function(){var i=this.id,o=this.scheduler,h=o.actions,p=h.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,p!==-1&&h.splice(p,1),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null},r}(function(e){function r(i,o){return e.call(this)||this}return O(r,e),r.prototype.schedule=function(i,o){return this},r}(Oa)),hz=function(e){function r(i,o){var h=e.call(this,i,o)||this;return h.scheduler=i,h.work=o,h}return O(r,e),r.prototype.schedule=function(i,o){return o===void 0&&(o=0),0<o?e.prototype.schedule.call(this,i,o):(this.delay=o,this.state=i,this.scheduler.flush(this),this)},r.prototype.execute=function(i,o){return 0<o||this.closed?e.prototype.execute.call(this,i,o):this._execute(i,o)},r.prototype.requestAsyncId=function(i,o,h){return h===void 0&&(h=0),h!==null&&0<h||h===null&&0<this.delay?e.prototype.requestAsyncId.call(this,i,o,h):i.flush(this)},r}(dg),Nk=function(){function e(r,i){i===void 0&&(i=e.now),this.SchedulerAction=r,this.now=i}return e.prototype.schedule=function(r,i,o){return i===void 0&&(i=0),new this.SchedulerAction(this,r).schedule(o,i)},e.now=function(){return Date.now()},e}(),eg=function(e){function r(i,o){o===void 0&&(o=Nk.now);var h=e.call(this,i,function(){return r.delegate&&r.delegate!==h?r.delegate.now():o()})||this;return h.actions=[],h.active=!1,h.scheduled=void 0,h}return O(r,e),r.prototype.schedule=function(i,o,h){return o===void 0&&(o=0),r.delegate&&r.delegate!==this?r.delegate.schedule(i,o,h):e.prototype.schedule.call(this,i,o,h)},r.prototype.flush=function(i){var o=this.actions;if(this.active)o.push(i);else{var h;this.active=!0;do if(h=i.execute(i.state,i.delay))break;while(i=o.shift());if(this.active=!1,h){for(;i=o.shift();)i.unsubscribe();throw h}}},r}(Nk),fg=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r}(eg))(hz),vb=new Y(function(e){return e.complete()}),am=function(e){return function(r){for(var i=0,o=e.length;i<o&&!r.closed;i++)r.next(e[i]);r.complete()}},Ok;(function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function e(r,i,o){this.kind=r,this.value=i,this.error=o,this.hasValue=r==="N"}return e.prototype.observe=function(r){switch(this.kind){case"N":return r.next&&r.next(this.value);case"E":return r.error&&r.error(this.error);case"C":return r.complete&&r.complete()}},e.prototype.do=function(r,i,o){switch(this.kind){case"N":return r&&r(this.value);case"E":return i&&i(this.error);case"C":return o&&o()}},e.prototype.accept=function(r,i,o){return r&&typeof r.next=="function"?this.observe(r):this.do(r,i,o)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(r){return r!==void 0?new e("N",r):e.undefinedValueNotification},e.createError=function(r){return new e("E",void 0,r)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(r,i){i===void 0&&(i=0),this.scheduler=r,this.delay=i}return e.prototype.call=function(r,i){return i.subscribe(new Dq(r,this.scheduler,this.delay))},e}(),Dq=function(e){function r(i,o,h){return h===void 0&&(h=0),(i=e.call(this,i)||this).scheduler=o,i.delay=h,i}return O(r,e),r.dispatch=function(i){i.notification.observe(i.destination),this.unsubscribe()},r.prototype.scheduleMessage=function(i){this.destination.add(this.scheduler.schedule(r.dispatch,this.delay,new iz(i,this.destination)))},r.prototype._next=function(i){this.scheduleMessage(Ve.createNext(i))},r.prototype._error=function(i){this.scheduleMessage(Ve.createError(i)),this.unsubscribe()},r.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},r}(ia),iz=function(e,r){this.notification=e,this.destination=r},qe=function(e){function r(i,o,h){i===void 0&&(i=Number.POSITIVE_INFINITY),o===void 0&&(o=Number.POSITIVE_INFINITY);var p=e.call(this)||this;return p.scheduler=h,p._events=[],p._infiniteTimeWindow=!1,p._bufferSize=1>i?1:i,p._windowTime=1>o?1:o,o===Number.POSITIVE_INFINITY?(p._infiniteTimeWindow=!0,p.next=p.nextInfiniteTimeWindow):p.next=p.nextTimeWindow,p}return O(r,e),r.prototype.nextInfiniteTimeWindow=function(i){if(!this.isStopped){var o=this._events;o.push(i),o.length>this._bufferSize&&o.shift()}e.prototype.next.call(this,i)},r.prototype.nextTimeWindow=function(i){this.isStopped||(this._events.push(new jz(this._getNow(),i)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,i)},r.prototype._subscribe=function(i){var o=this._infiniteTimeWindow,h=o?this._events:this._trimBufferThenGetEvents(),p=this.scheduler,g=h.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var C=Oa.EMPTY;else this.observers.push(i),C=new zq(this,i);if(p&&i.add(i=new Dq(i,p)),o)for(o=0;o<g&&!i.closed;o++)i.next(h[o]);else for(o=0;o<g&&!i.closed;o++)i.next(h[o].value);return this.hasError?i.error(this.thrownError):this.isStopped&&i.complete(),C},r.prototype._getNow=function(){return(this.scheduler||fg).now()},r.prototype._trimBufferThenGetEvents=function(){for(var i=this._getNow(),o=this._bufferSize,h=this._windowTime,p=this._events,g=p.length,C=0;C<g&&!(i-p[C].time<h);)C++;return g>o&&(C=Math.max(C,g-o)),0<C&&p.splice(0,C),p},r}(Pa),jz=function(e,r){this.time=e,this.value=r},of=function(e){function r(){var i=e!==null&&e.apply(this,arguments)||this;return i.value=null,i.hasNext=!1,i.hasCompleted=!1,i}return O(r,e),r.prototype._subscribe=function(i){return this.hasError?(i.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(i.next(this.value),i.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,i)},r.prototype.next=function(i){this.hasCompleted||(this.value=i,this.hasNext=!0)},r.prototype.error=function(i){this.hasCompleted||e.prototype.error.call(this,i)},r.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},r}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var r=kz++;return ii[r]=!0,lz.then(function(){return bm(r)&&e()}),r},clearImmediate:function(e){bm(e)}},mz=function(e){function r(i,o){var h=e.call(this,i,o)||this;return h.scheduler=i,h.work=o,h}return O(r,e),r.prototype.requestAsyncId=function(i,o,h){return h===void 0&&(h=0),h!==null&&0<h?e.prototype.requestAsyncId.call(this,i,o,h):(i.actions.push(this),i.scheduled||(i.scheduled=Eq.setImmediate(i.flush.bind(i,null))))},r.prototype.recycleAsyncId=function(i,o,h){if(h===void 0&&(h=0),h!==null&&0<h||h===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,i,o,h);i.actions.length===0&&(Eq.clearImmediate(o),i.scheduled=void 0)},r}(dg),ri=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.flush=function(i){this.active=!0,this.scheduled=void 0;var o,h=this.actions,p=-1,g=h.length;i=i||h.shift();do if(o=i.execute(i.state,i.delay))break;while(++p<g&&(i=h.shift()));if(this.active=!1,o){for(;++p<g&&(i=h.shift());)i.unsubscribe();throw o}},r}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function r(i,o){var h=e.call(this,i,o)||this;return h.scheduler=i,h.work=o,h}return O(r,e),r.prototype.requestAsyncId=function(i,o,h){return h===void 0&&(h=0),h!==null&&0<h?e.prototype.requestAsyncId.call(this,i,o,h):(i.actions.push(this),i.scheduled||(i.scheduled=requestAnimationFrame(function(){return i.flush(null)})))},r.prototype.recycleAsyncId=function(i,o,h){if(h===void 0&&(h=0),h!==null&&0<h||h===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,i,o,h);i.actions.length===0&&(cancelAnimationFrame(o),i.scheduled=void 0)},r}(dg),Fq=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.flush=function(i){this.active=!0,this.scheduled=void 0;var o,h=this.actions,p=-1,g=h.length;i=i||h.shift();do if(o=i.execute(i.state,i.delay))break;while(++p<g&&(i=h.shift()));if(this.active=!1,o){for(;++p<g&&(i=h.shift());)i.unsubscribe();throw o}},r}(eg))(oz),pz=function(e){function r(i,o){i===void 0&&(i=Gq),o===void 0&&(o=Number.POSITIVE_INFINITY);var h=e.call(this,i,function(){return h.frame})||this;return h.maxFrames=o,h.frame=0,h.index=-1,h}return O(r,e),r.prototype.flush=function(){for(var i,o,h=this.actions,p=this.maxFrames;(o=h[0])&&o.delay<=p&&(h.shift(),this.frame=o.delay,!(i=o.execute(o.state,o.delay))););if(i){for(;o=h.shift();)o.unsubscribe();throw i}},r.frameTimeFactor=10,r}(eg),Gq=function(e){function r(i,o,h){h===void 0&&(h=i.index+=1);var p=e.call(this,i,o)||this;return p.scheduler=i,p.work=o,p.index=h,p.active=!0,p.index=i.index=h,p}return O(r,e),r.prototype.schedule=function(i,o){if(o===void 0&&(o=0),!this.id)return e.prototype.schedule.call(this,i,o);this.active=!1;var h=new r(this.scheduler,this.work);return this.add(h),h.schedule(i,o)},r.prototype.requestAsyncId=function(i,o,h){return h===void 0&&(h=0),this.delay=i.frame+h,(i=i.actions).push(this),i.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(i,o,h){},r.prototype._execute=function(i,o){if(this.active===!0)return e.prototype._execute.call(this,i,o)},r.sortActions=function(i,o){return i.delay===o.delay?i.index===o.index?0:i.index>o.index?1:-1:i.delay>o.delay?1:-1},r}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(r,i){this.project=r,this.thisArg=i}return e.prototype.call=function(r,i){return i.subscribe(new qz(r,this.project,this.thisArg))},e}(),qz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).project=o,i.count=0,i.thisArg=h||i,i}return O(r,e),r.prototype._next=function(i){try{var o=this.project.call(this.thisArg,i,this.count++)}catch(h){return void this.destination.error(h)}this.destination.next(o)},r}(ia),Rk=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.notifyNext=function(i,o,h,p,g){this.destination.next(o)},r.prototype.notifyError=function(i,o){this.destination.error(i)},r.prototype.notifyComplete=function(i){this.destination.complete()},r}(ia),Xs=function(e){function r(i,o,h){var p=e.call(this)||this;return p.parent=i,p.outerValue=o,p.outerIndex=h,p.index=0,p}return O(r,e),r.prototype._next=function(i){this.parent.notifyNext(this.outerValue,i,this.outerIndex,this.index++,this)},r.prototype._error=function(i){this.parent.notifyError(i,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(ia),rz=function(e){return function(r){return e.then(function(i){r.closed||(r.next(i),r.complete())},function(i){return r.error(i)}).then(null,me),r}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(r){for(var i=e[$c]();;){var o=void 0;try{o=i.next()}catch(h){return r.error(h),r}if(o.done){r.complete();break}if(r.next(o.value),r.closed)break}return typeof i.return=="function"&&r.add(function(){i.return&&i.return()}),r}},tz=function(e){return function(r){var i=e[ne]();if(typeof i.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return i.subscribe(r)}},hm=function(e){return e&&typeof e.length=="number"&&typeof e!="function"},pf=function(e){if(e&&typeof e[ne]=="function")return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&typeof e[$c]=="function")return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(r){this.resultSelector=r}return e.prototype.call=function(r,i){return i.subscribe(new uz(r,this.resultSelector))},e}(),uz=function(e){function r(i,o){return(i=e.call(this,i)||this).resultSelector=o,i.active=0,i.values=[],i.observables=[],i}return O(r,e),r.prototype._next=function(i){this.values.push(Hq),this.observables.push(i)},r.prototype._complete=function(){var i=this.observables,o=i.length;if(o===0)this.destination.complete();else{this.toRespond=this.active=o;for(var h=0;h<o;h++)this.add(ji(this,i[h],void 0,h))}},r.prototype.notifyComplete=function(i){--this.active==0&&this.destination.complete()},r.prototype.notifyNext=function(i,o,h){var p=(i=this.values)[h];p=this.toRespond?p===Hq?--this.toRespond:this.toRespond:0,i[h]=o,p===0&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},r.prototype._tryResultSelector=function(i){try{var o=this.resultSelector.apply(this,i)}catch(h){return void this.destination.error(h)}this.destination.next(o)},r}(Rk),vc=function(e){function r(i){var o=e.call(this)||this;return o.parent=i,o}return O(r,e),r.prototype._next=function(i){this.parent.notifyNext(i)},r.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(ia);(function(e){function r(i,o,h){var p=e.call(this)||this;return p.parent=i,p.outerValue=o,p.outerIndex=h,p}O(r,e),r.prototype._next=function(i){this.parent.notifyNext(this.outerValue,i,this.outerIndex,this)},r.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.notifyNext=function(i){this.destination.next(i)},r.prototype.notifyError=function(i){this.destination.error(i)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(ia);(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}O(r,e),r.prototype.notifyNext=function(i,o,h,p){this.destination.next(o)},r.prototype.notifyError=function(i){this.destination.error(i)},r.prototype.notifyComplete=function(i){this.destination.complete()}})(ia);var at=function(){function e(r,i){i===void 0&&(i=Number.POSITIVE_INFINITY),this.project=r,this.concurrent=i}return e.prototype.call=function(r,i){return i.subscribe(new wz(r,this.project,this.concurrent))},e}(),wz=function(e){function r(i,o,h){return h===void 0&&(h=Number.POSITIVE_INFINITY),(i=e.call(this,i)||this).project=o,i.concurrent=h,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return O(r,e),r.prototype._next=function(i){this.active<this.concurrent?this._tryNext(i):this.buffer.push(i)},r.prototype._tryNext=function(i){var o=this.index++;try{var h=this.project(i,o)}catch(p){return void this.destination.error(p)}this.active++,this._innerSub(h)},r.prototype._innerSub=function(i){var o=new vc(this),h=this.destination;h.add(o),(i=ic(i,o))!==o&&h.add(i)},r.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(i){this.destination.next(i)},r.prototype.notifyComplete=function(){var i=this.buffer;this.active--,0<i.length?this._next(i.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},r}(wc),Sk=y.parseFloat,Iq=1/Sk(`	
\v\f\r                　\u2028\u2029\uFEFF-0`)!=-1/0?function(e){e=ik(String(e));var r=Sk(e);return r===0&&e.charAt(0)=="-"?-0:r}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(r,i){this.predicate=r,this.thisArg=i}return e.prototype.call=function(r,i){return i.subscribe(new xz(r,this.predicate,this.thisArg))},e}(),xz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).predicate=o,i.thisArg=h,i.count=0,i}return O(r,e),r.prototype._next=function(i){try{var o=this.predicate.call(this.thisArg,i,this.count++)}catch(h){return void this.destination.error(h)}o&&this.destination.next(i)},r}(ia),gt=function(){function e(){}return e.prototype.call=function(r,i){return i.subscribe(new yz(r))},e}(),yz=function(e){function r(i){return(i=e.call(this,i)||this).hasFirst=!1,i.observables=[],i.subscriptions=[],i}return O(r,e),r.prototype._next=function(i){this.observables.push(i)},r.prototype._complete=function(){var i=this.observables,o=i.length;if(o===0)this.destination.complete();else{for(var h=0;h<o&&!this.hasFirst;h++){var p=ji(this,i[h],void 0,h);this.subscriptions&&this.subscriptions.push(p),this.add(p)}this.observables=null}},r.prototype.notifyNext=function(i,o,h){if(!this.hasFirst){for(this.hasFirst=!0,i=0;i<this.subscriptions.length;i++)if(i!==h){var p=this.subscriptions[i];p.unsubscribe(),this.remove(p)}this.subscriptions=null}this.destination.next(o)},r}(Rk),jt=function(){function e(r){this.resultSelector=r}return e.prototype.call=function(r,i){return i.subscribe(new zz(r,this.resultSelector))},e}(),zz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).resultSelector=o,i.iterators=[],i.active=0,i.resultSelector=typeof o=="function"?o:void 0,i}return O(r,e),r.prototype._next=function(i){var o=this.iterators;Jb(i)?o.push(new Az(i)):typeof i[$c]=="function"?o.push(new Bz(i[$c]())):o.push(new Cz(this.destination,this,i))},r.prototype._complete=function(){var i=this.iterators,o=i.length;if(this.unsubscribe(),o===0)this.destination.complete();else{this.active=o;for(var h=0;h<o;h++){var p=i[h];p.stillUnsubscribed?this.destination.add(p.subscribe()):this.active--}}},r.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},r.prototype.checkIterators=function(){for(var i=this.iterators,o=i.length,h=this.destination,p=0;p<o;p++){var g=i[p];if(typeof g.hasValue=="function"&&!g.hasValue())return}var C=!1,A=[];for(p=0;p<o;p++){var x=(g=i[p]).next();if(g.hasCompleted()&&(C=!0),x.done)return void h.complete();A.push(x.value)}this.resultSelector?this._tryresultSelector(A):h.next(A),C&&h.complete()},r.prototype._tryresultSelector=function(i){try{var o=this.resultSelector.apply(this,i)}catch(h){return void this.destination.error(h)}this.destination.next(o)},r}(ia),Bz=function(){function e(r){this.iterator=r,this.nextResult=r.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var r=this.nextResult;return this.nextResult=this.iterator.next(),r},e.prototype.hasCompleted=function(){var r=this.nextResult;return!(!r||!r.done)},e}(),Az=function(){function e(r){this.array=r,this.length=this.index=0,this.length=r.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(r){r=this.index++;var i=this.array;return r<this.length?{value:i[r],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).parent=o,i.observable=h,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return O(r,e),r.prototype[$c]=function(){return this},r.prototype.next=function(){var i=this.buffer;return i.length===0&&this.isComplete?{value:null,done:!0}:{value:i.shift(),done:!1}},r.prototype.hasValue=function(){return 0<this.buffer.length},r.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},r.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(i){this.buffer.push(i),this.parent.checkIterators()},r.prototype.subscribe=function(){return ic(this.observable,new vc(this))},r}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||typeof e.lift=="function"&&typeof e.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=r=void 0;return Zc(e[e.length-1])&&(i=e.pop()),typeof e[e.length-1]=="function"&&(r=e.pop()),e.length===1&&Jb(e[0])&&(e=e[0]),nf(e,i).lift(new vz(r))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,r,i,o,h){if(arguments.length==1){var p=e.initialState;r=e.condition,i=e.iterate;var g=e.resultSelector||Yc;h=e.scheduler}else o===void 0||Zc(o)?(p=e,g=Yc,h=o):(p=e,g=o);return new Y(function(C){var A=p;if(h)return h.schedule(bt,0,{subscriber:C,iterate:i,condition:r,resultSelector:g,state:A});for(;;){if(r){var x=void 0;try{x=r(A)}catch(_e){C.error(_e);break}if(!x){C.complete();break}}x=void 0;try{x=g(A)}catch(_e){C.error(_e);break}if(C.next(x),C.closed)break;try{A=i(A)}catch(_e){C.error(_e);break}}})},iif:function(e,r,i){return r===void 0&&(r=vb),i===void 0&&(i=vb),ad(function(){return e()?r:i})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,r){return new Y(r?function(i){var o=Object.keys(e),h=new Oa;return h.add(r.schedule(dt,0,{keys:o,index:0,subscriber:i,subscription:h,obj:e})),h}:function(i){for(var o=Object.keys(e),h=0;h<o.length&&!i.closed;h++){var p=o[h];e.hasOwnProperty(p)&&i.next([p,e[p]])}i.complete()})},partition:function(e,r,i){return[wb(r,i)(new Y(pf(e))),wb(et(r,i))(new Y(pf(e)))]},race:Ca,range:function(e,r,i){return e===void 0&&(e=0),new Y(function(o){r===void 0&&(r=e,e=0);var h=0,p=e;if(i)return i.schedule(ht,0,{index:h,count:r,start:e,subscriber:o});for(;;){if(h++>=r){o.complete();break}if(o.next(p++),o.closed)break}})},throwError:Z,timer:Bc,using:function(e,r){return new Y(function(i){try{var o=e()}catch(g){return void i.error(g)}try{var h=r(o)}catch(g){return void i.error(g)}var p=(h?Kb(h):vb).subscribe(i);return function(){p.unsubscribe(),o&&o.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(r){this.selector=r}return e.prototype.call=function(r,i){return i.subscribe(new Ez(r,this.selector,this.caught))},e}(),Ez=function(e){function r(i,o,h){return(i=e.call(this,i)||this).selector=o,i.caught=h,i}return O(r,e),r.prototype.error=function(i){if(!this.isStopped){var o=void 0;try{o=this.selector(i,this.caught)}catch(h){return void e.prototype.error.call(this,h)}this._unsubscribeAndRecycle(),i=new vc(this),this.add(i),(o=ic(o,i))!==i&&this.add(o)}},r}(wc),lt=function(){function e(r){this.defaultValue=r}return e.prototype.call=function(r,i){return i.subscribe(new Fz(r,this.defaultValue))},e}(),Fz=function(e){function r(i,o){return(i=e.call(this,i)||this).defaultValue=o,i.isEmpty=!0,i}return O(r,e),r.prototype._next=function(i){this.isEmpty=!1,this.destination.next(i)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(ia),mt=function(){function e(r,i){this.delay=r,this.scheduler=i}return e.prototype.call=function(r,i){return i.subscribe(new Gz(r,this.delay,this.scheduler))},e}(),Gz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).delay=o,i.scheduler=h,i.queue=[],i.active=!1,i.errored=!1,i}return O(r,e),r.dispatch=function(i){for(var o=i.source,h=o.queue,p=i.scheduler,g=i.destination;0<h.length&&0>=h[0].time-p.now();)h.shift().notification.observe(g);0<h.length?(o=Math.max(0,h[0].time-p.now()),this.schedule(i,o)):(this.unsubscribe(),o.active=!1)},r.prototype._schedule=function(i){this.active=!0,this.destination.add(i.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:i}))},r.prototype.scheduleNotification=function(i){if(this.errored!==!0){var o=this.scheduler;i=new Hz(o.now()+this.delay,i),this.queue.push(i),this.active===!1&&this._schedule(o)}},r.prototype._next=function(i){this.scheduleNotification(Ve.createNext(i))},r.prototype._error=function(i){this.errored=!0,this.queue=[],this.destination.error(i),this.unsubscribe()},r.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},r}(ia),Hz=function(e,r){this.time=e,this.notification=r},nt=function(){function e(r,i){this.keySelector=r,this.flushes=i}return e.prototype.call=function(r,i){return i.subscribe(new Iz(r,this.keySelector,this.flushes))},e}(),Iz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).keySelector=o,i.values=new Set,h&&i.add(ic(h,new vc(i))),i}return O(r,e),r.prototype.notifyNext=function(){this.values.clear()},r.prototype.notifyError=function(i){this._error(i)},r.prototype._next=function(i){this.keySelector?this._useKeySelector(i):this._finalizeNext(i,i)},r.prototype._useKeySelector=function(i){var o=this.destination;try{var h=this.keySelector(i)}catch(p){return void o.error(p)}this._finalizeNext(h,i)},r.prototype._finalizeNext=function(i,o){var h=this.values;h.has(i)||(h.add(i),this.destination.next(o))},r}(wc),pt=function(){function e(r){this.errorFactory=r}return e.prototype.call=function(r,i){return i.subscribe(new Jz(r,this.errorFactory))},e}(),Jz=function(e){function r(i,o){return(i=e.call(this,i)||this).errorFactory=o,i.hasValue=!1,i}return O(r,e),r.prototype._next=function(i){this.hasValue=!0,this.destination.next(i)},r.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var i=void 0;try{i=this.errorFactory()}catch(o){i=o}this.destination.error(i)},r}(ia),qt=function(){function e(r){if(this.total=r,0>this.total)throw new Qk}return e.prototype.call=function(r,i){return i.subscribe(new Kz(r,this.total))},e}(),Kz=function(e){function r(i,o){return(i=e.call(this,i)||this).total=o,i.count=0,i}return O(r,e),r.prototype._next=function(i){var o=this.total,h=++this.count;h<=o&&(this.destination.next(i),h===o&&(this.destination.complete(),this.unsubscribe()))},r}(ia),rt=function(){function e(r){this.project=r}return e.prototype.call=function(r,i){return i.subscribe(new Lz(r,this.project))},e}(),Lz=function(e){function r(i,o){return(i=e.call(this,i)||this).project=o,i.hasSubscription=!1,i.hasCompleted=!1,i.index=0,i}return O(r,e),r.prototype._next=function(i){this.hasSubscription||this.tryNext(i)},r.prototype.tryNext=function(i){var o=this.index++;try{var h=this.project(i,o)}catch(p){return void this.destination.error(p)}this.hasSubscription=!0,this._innerSub(h)},r.prototype._innerSub=function(i){var o=new vc(this),h=this.destination;h.add(o),(i=ic(i,o))!==o&&h.add(i)},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(i){this.destination.next(i)},r.prototype.notifyError=function(i){this.destination.error(i)},r.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(wc),st=function(){function e(r){this.callback=r}return e.prototype.call=function(r,i){return i.subscribe(new Mz(r,this.callback))},e}(),Mz=function(e){function r(i,o){return(i=e.call(this,i)||this).add(new Oa(o)),i}return O(r,e),r}(ia),ut=function(){function e(){}return e.prototype.call=function(r,i){return i.subscribe(new Nz(r))},e}(),Nz=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype._next=function(i){},r}(ia),vt=function(){function e(r){if(this.total=r,0>this.total)throw new Qk}return e.prototype.call=function(r,i){return i.subscribe(new Oz(r,this.total))},e}(),Oz=function(e){function r(i,o){return(i=e.call(this,i)||this).total=o,i.ring=[],i.count=0,i}return O(r,e),r.prototype._next=function(i){var o=this.ring,h=this.total,p=this.count++;o.length<h?o.push(i):o[p%h]=i},r.prototype._complete=function(){var i=this.destination,o=this.count;if(0<o)for(var h=this.count>=this.total?this.total:this.count,p=this.ring,g=0;g<h;g++){var C=o++%h;i.next(p[C])}i.complete()},r}(ia),wt=function(){function e(r){this.value=r}return e.prototype.call=function(r,i){return i.subscribe(new Pz(r,this.value))},e}(),Pz=function(e){function r(i,o){return(i=e.call(this,i)||this).value=o,i}return O(r,e),r.prototype._next=function(i){this.destination.next(this.value)},r}(ia),xt=function(){function e(r,i,o){o===void 0&&(o=!1),this.accumulator=r,this.seed=i,this.hasSeed=o}return e.prototype.call=function(r,i){return i.subscribe(new Qz(r,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function r(i,o,h,p){return(i=e.call(this,i)||this).accumulator=o,i._seed=h,i.hasSeed=p,i.index=0,i}return O(r,e),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(i){this.hasSeed=!0,this._seed=i},enumerable:!0,configurable:!0}),r.prototype._next=function(i){if(this.hasSeed)return this._tryNext(i);this.seed=i,this.destination.next(i)},r.prototype._tryNext=function(i){var o=this.index++;try{var h=this.accumulator(this.seed,i,o)}catch(p){this.destination.error(p)}this.seed=h,this.destination.next(h)},r}(ia),Bt=function(){function e(r,i){this.notifier=r,this.source=i}return e.prototype.call=function(r,i){return i.subscribe(new Rz(r,this.notifier,this.source))},e}(),Rz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).notifier=o,i.source=h,i}return O(r,e),r.prototype.error=function(i){if(!this.isStopped){var o=this.errors,h=this.retries,p=this.retriesSubscription;if(h)this.retriesSubscription=this.errors=void 0;else{o=new Pa;try{h=(0,this.notifier)(o)}catch(g){return e.prototype.error.call(this,g)}p=ic(h,new vc(this))}this._unsubscribeAndRecycle(),this.errors=o,this.retries=h,this.retriesSubscription=p,o.next(i)}},r.prototype._unsubscribe=function(){var i=this.errors,o=this.retriesSubscription;i&&(i.unsubscribe(),this.errors=void 0),o&&(o.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},r.prototype.notifyNext=function(){var i=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=i,this.source.subscribe(this)},r}(wc),Et=function(){function e(r){this.project=r}return e.prototype.call=function(r,i){return i.subscribe(new Sz(r,this.project))},e}(),Sz=function(e){function r(i,o){return(i=e.call(this,i)||this).project=o,i.index=0,i}return O(r,e),r.prototype._next=function(i){var o=this.index++;try{var h=this.project(i,o)}catch(p){return void this.destination.error(p)}this._innerSub(h)},r.prototype._innerSub=function(i){var o=this.innerSubscription;o&&o.unsubscribe(),o=new vc(this);var h=this.destination;h.add(o),this.innerSubscription=ic(i,o),this.innerSubscription!==o&&h.add(this.innerSubscription)},r.prototype._complete=function(){var i=this.innerSubscription;i&&!i.closed||e.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(i){this.destination.next(i)},r}(wc),Ft=function(){function e(r){this.notifier=r}return e.prototype.call=function(r,i){r=new Tz(r);var o=ic(this.notifier,new vc(r));return o&&!r.seenValue?(r.add(o),i.subscribe(r)):r},e}(),Tz=function(e){function r(i){return(i=e.call(this,i)||this).seenValue=!1,i}return O(r,e),r.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},r.prototype.notifyComplete=function(){},r}(wc),Ht=function(){function e(r,i){this.predicate=r,this.inclusive=i}return e.prototype.call=function(r,i){return i.subscribe(new Uz(r,this.predicate,this.inclusive))},e}(),Uz=function(e){function r(i,o,h){return(i=e.call(this,i)||this).predicate=o,i.inclusive=h,i.index=0,i}return O(r,e),r.prototype._next=function(i){var o=this.destination;try{var h=this.predicate(i,this.index++)}catch(p){return void o.error(p)}this.nextOrComplete(i,h)},r.prototype.nextOrComplete=function(i,o){var h=this.destination;o?h.next(i):(this.inclusive&&h.next(i),h.complete())},r}(ia),It=function(){function e(r,i,o){this.nextOrObserver=r,this.error=i,this.complete=o}return e.prototype.call=function(r,i){return i.subscribe(new Vz(r,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function r(i,o,h,p){return(i=e.call(this,i)||this)._tapNext=hc,i._tapError=hc,i._tapComplete=hc,i._tapError=h||hc,i._tapComplete=p||hc,le(o)?(i._context=i,i._tapNext=o):o&&(i._context=o,i._tapNext=o.next||hc,i._tapError=o.error||hc,i._tapComplete=o.complete||hc),i}return O(r,e),r.prototype._next=function(i){try{this._tapNext.call(this._context,i)}catch(o){return void this.destination.error(o)}this.destination.next(i)},r.prototype._error=function(i){try{this._tapError.call(this._context,i)}catch(o){return void this.destination.error(o)}this.destination.error(i)},r.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(i){return void this.destination.error(i)}return this.destination.complete()},r}(ia),Kt={leading:!0,trailing:!1};(function(e){function r(i,o,h,p){var g=e.call(this,i)||this;return g.destination=i,g.durationSelector=o,g._leading=h,g._trailing=p,g._hasValue=!1,g}O(r,e),r.prototype._next=function(i){this._hasValue=!0,this._sendValue=i,this._throttled||(this._leading?this.send():this.throttle(i))},r.prototype.send=function(){var i=this._sendValue;this._hasValue&&(this.destination.next(i),this.throttle(i)),this._hasValue=!1,this._sendValue=void 0},r.prototype.throttle=function(i){(i=this.tryDurationSelector(i))&&this.add(this._throttled=ic(i,new vc(this)))},r.prototype.tryDurationSelector=function(i){try{return this.durationSelector(i)}catch(o){return this.destination.error(o),null}},r.prototype.throttlingDone=function(){var i=this._throttled,o=this._trailing;i&&i.unsubscribe(),this._throttled=void 0,o&&this.send()},r.prototype.notifyNext=function(){this.throttlingDone()},r.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function e(r,i,o,h){this.duration=r,this.scheduler=i,this.leading=o,this.trailing=h}return e.prototype.call=function(r,i){return i.subscribe(new Wz(r,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function r(i,o,h,p,g){return(i=e.call(this,i)||this).duration=o,i.scheduler=h,i.leading=p,i.trailing=g,i._hasTrailingValue=!1,i._trailingValue=null,i}return O(r,e),r.prototype._next=function(i){this.throttled?this.trailing&&(this._trailingValue=i,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(i):this.trailing&&(this._trailingValue=i,this._hasTrailingValue=!0))},r.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},r.prototype.clearThrottle=function(){var i=this.throttled;i&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),i.unsubscribe(),this.remove(i),this.throttled=null)},r}(ia),Ot=function(){function e(r,i,o,h){this.waitFor=r,this.absoluteTimeout=i,this.withObservable=o,this.scheduler=h}return e.prototype.call=function(r,i){return i.subscribe(new Xz(r,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function r(i,o,h,p,g){return(i=e.call(this,i)||this).absoluteTimeout=o,i.waitFor=h,i.withObservable=p,i.scheduler=g,i.scheduleTimeout(),i}return O(r,e),r.dispatchTimeout=function(i){var o=i.withObservable;i._unsubscribeAndRecycle(),i.add(ic(o,new vc(i)))},r.prototype.scheduleTimeout=function(){var i=this.action;i?this.action=i.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(i){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,i)},r.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},r}(wc),Qt=function(){function e(r,i){this.observables=r,this.project=i}return e.prototype.call=function(r,i){return i.subscribe(new Yz(r,this.observables,this.project))},e}(),Yz=function(e){function r(i,o,h){(i=e.call(this,i)||this).observables=o,i.project=h,i.toRespond=[],h=o.length,i.values=Array(h);for(var p=0;p<h;p++)i.toRespond.push(p);for(p=0;p<h;p++)i.add(ji(i,o[p],void 0,p));return i}return O(r,e),r.prototype.notifyNext=function(i,o,h){this.values[h]=o,0<(i=this.toRespond).length&&(h=i.indexOf(h))!==-1&&i.splice(h,1)},r.prototype.notifyComplete=function(){},r.prototype._next=function(i){this.toRespond.length===0&&(i=[i].concat(this.values),this.project?this._tryProject(i):this.destination.next(i))},r.prototype._tryProject=function(i){try{var o=this.project.apply(this,i)}catch(h){return void this.destination.error(h)}this.destination.next(o)},r}(Rk),Jq=$a(function(e){var r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);e.exports=function(){return r(i),i}}else{var o=Array(16);e.exports=function(){for(var h,p=0;16>p;p++)!(3&p)&&(h=4294967296*Math.random()),o[p]=h>>>((3&p)<<3)&255;return o}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,r){return r=r||0,[ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]]].join("")},Ud=function(e,r,i){if(i=r&&i||0,typeof e=="string"&&(r=e==="binary"?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,r)for(var o=0;16>o;++o)r[i+o]=e[o];return r||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,r){var i;return Hk(e,function(o,h,p){return!(i=r(o,h,p))}),!!i},Mh=function(e,r,i){if(!lb(i))return!1;var o=X(r);return!!(o=="number"?Ed(i)&&wk(r,i.length):o=="string"&&r in i)&&$f(i[r],e)},dl=function(e,r,i){var o=Va(e)?tq:DA;return o(e,Te(r))},EA=function(e,r){var i=-1,o=Ed(e)?Array(e.length):[];return Hk(e,function(h,p,g){o[++i]=r(h,p,g)}),o},FA=function(e,r){var i=e.length;for(e.sort(r);i--;)e[i]=e[i].value;return e},GA=function(e,r,i){r=r.length?he(r,function(h){return Va(h)?function(p){return Ch(p,h.length===1?h[0]:h)}:h}):[Dh];var o=-1;return r=he(r,zh(Te)),e=EA(e,function(h,p,g){return{criteria:he(r,function(C){return C(h)}),index:++o,value:h}}),FA(e,function(h,p){e:{for(var g=-1,C=h.criteria,A=p.criteria,x=C.length,_e=i.length;++g<x;){t:{var cN=C[g],dN=A[g];if(cN!==dN){var fN=cN!==void 0,mN=cN===null,EN=cN==cN,RN=ie(cN),IN=dN!==void 0,t0=dN===null,aH=dN==dN,pH=ie(dN);if(!t0&&!pH&&!RN&&cN>dN||RN&&IN&&aH&&!t0&&!pH||mN&&IN&&aH||!fN&&aH||!EN){cN=1;break t}if(!mN&&!RN&&!pH&&cN<dN||pH&&fN&&EN&&!mN&&!RN||t0&&fN&&EN||!IN&&EN||!aH){cN=-1;break t}}cN=0}if(cN){h=g>=_e?cN:cN*(i[g]=="desc"?-1:1);break e}}h=h.index-p.index}return h})},jr=function(e,r){return rq(qq(e,r,Dh),e+"")},kr=jr(function(e,r){if(e==null)return[];var i=r.length;return 1<i&&Mh(e,r[0],r[1])?r=[]:2<i&&Mh(r[0],r[1],r[2])&&(r=[r[0]]),GA(e,$h(r),[])}),lr=function(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(i){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:function(){return e[i]}})}),r}(Dz),mr=$a(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var i=[],o=function(h,p){return new WebSocket(h,p)};r.normalClosureMessage="Normal closure",r.default=function(h,p){var g=(p=p===void 0?{protocols:i,makeWebSocket:o}:p).protocols,C=g===void 0?i:g,A=(p=p.makeWebSocket)===void 0?o:p;return new lr.Observable(function(x){var _e,cN=new lr.Subject,dN=A(h,C),fN=!1,mN=!1,EN=function(RN){if(_e)throw fN=!0,RN=Error("Web socket message factory function called more than once"),x.error(RN),RN;return _e=RN.subscribe(function(IN){dN.send(IN)}),cN};return dN.onopen=function(){mN?(fN=!0,dN.close()):x.next(EN)},dN.onmessage=function(RN){cN.next(RN.data)},dN.onerror=function(RN){fN=!0,x.error(Error(RN.message))},dN.onclose=function(RN){fN||(fN=!0,mN?(x.complete(),cN.complete()):x.error(Error(RN.code===1e3?r.normalClosureMessage:RN.reason)))},function(){mN=!0,_e&&_e.unsubscribe(),fN||(fN=!0,dN.close())}})}});(function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default})(mr);var pi=function(e,r,i){(i===void 0||$f(e[r],i))&&(i!==void 0||r in e)||bg(e,r,i)},oi=function(e,r){if((r!=="constructor"||typeof e[r]!="function")&&r!="__proto__")return e[r]},HA=function(e){return jr(function(r,i){var o=-1,h=i.length,p=1<h?i[h-1]:void 0,g=2<h?i[2]:void 0;for(p=3<e.length&&typeof p=="function"?(h--,p):void 0,g&&Mh(i[0],i[1],g)&&(p=3>h?void 0:p,h=1),r=Object(r);++o<h;)(g=i[o])&&e(r,g,o,p);return r})}(function(e,r,i,o){tm(e,r,i,o)}),IA=Math.floor,JA=Math.random,nr=function(e,r){return e+IA(JA()*(r-e+1))},or=function(e){var r=e.length;return r?e[nr(0,r-1)]:void 0},KA=function(e,r){return he(r,function(i){return e[i]})},Ni=function(e){return e==null?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,r){return new WebSocket(e,r)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,r){for(var i=Array(arguments.length-1),o=0,h=2,p=!0;h<arguments.length;)i[o++]=arguments[h++];return new Promise(function(g,C){i[o]=function(A){if(p)if(p=!1,A)C(A);else{for(var x=Array(arguments.length-1),_e=0;_e<x.length;)x[_e++]=arguments[_e];g.apply(null,x)}};try{e.apply(r||null,i)}catch(A){p&&(p=!1,C(A))}})},OA=$a(function(e,r){r.length=function(h){var p=h.length;if(!p)return 0;for(var g=0;1<--p%4&&h.charAt(p)==="=";)++g;return Math.ceil(3*h.length)/4-g};var i=Array(64),o=Array(123);for(e=0;64>e;)o[i[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;r.encode=function(h,p,g){for(var C,A=null,x=[],_e=0,cN=0;p<g;){var dN=h[p++];switch(cN){case 0:x[_e++]=i[dN>>2],C=(3&dN)<<4,cN=1;break;case 1:x[_e++]=i[C|dN>>4],C=(15&dN)<<2,cN=2;break;case 2:x[_e++]=i[C|dN>>6],x[_e++]=i[63&dN],cN=0}8191<_e&&((A||(A=[])).push(String.fromCharCode.apply(String,x)),_e=0)}return cN&&(x[_e++]=i[C],x[_e++]=61,cN===1&&(x[_e++]=61)),A?(_e&&A.push(String.fromCharCode.apply(String,x.slice(0,_e))),A.join("")):String.fromCharCode.apply(String,x.slice(0,_e))},r.decode=function(h,p,g){for(var C,A=g,x=0,_e=0;_e<h.length;){var cN=h.charCodeAt(_e++);if(cN===61&&1<x)break;if((cN=o[cN])===void 0)throw Error("invalid encoding");switch(x){case 0:C=cN,x=1;break;case 1:p[g++]=C<<2|(48&cN)>>4,C=cN,x=2;break;case 2:p[g++]=(15&C)<<4|(60&cN)>>2,C=cN,x=3;break;case 3:p[g++]=(3&C)<<6|cN,x=0}}if(x===1)throw Error("invalid encoding");return g-A},r.test=function(h){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(h)}});yg.prototype.on=function(e,r,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:i||this}),this},yg.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else{e=this._listeners[e];for(var i=0;i<e.length;)e[i].fn===r?e.splice(i,1):++i}return this},yg.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var i=[],o=1;o<arguments.length;)i.push(arguments[o++]);for(o=0;o<r.length;)r[o].fn.apply(r[o++].ctx,i)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a(function(e,r){r.length=function(i){for(var o,h=0,p=0;p<i.length;++p)128>(o=i.charCodeAt(p))?h+=1:2048>o?h+=2:(64512&o)==55296&&(64512&i.charCodeAt(p+1))==56320?(++p,h+=4):h+=3;return h},r.read=function(i,o,h){if(1>h-o)return"";for(var p,g=null,C=[],A=0;o<h;)128>(p=i[o++])?C[A++]=p:191<p&&224>p?C[A++]=(31&p)<<6|63&i[o++]:239<p&&365>p?(p=((7&p)<<18|(63&i[o++])<<12|(63&i[o++])<<6|63&i[o++])-65536,C[A++]=55296+(p>>10),C[A++]=56320+(1023&p)):C[A++]=(15&p)<<12|(63&i[o++])<<6|63&i[o++],8191<A&&((g||(g=[])).push(String.fromCharCode.apply(String,C)),A=0);return g?(A&&g.push(String.fromCharCode.apply(String,C.slice(0,A))),g.join("")):String.fromCharCode.apply(String,C.slice(0,A))},r.write=function(i,o,h){for(var p,g,C=h,A=0;A<i.length;++A)128>(p=i.charCodeAt(A))?o[h++]=p:(2048>p?o[h++]=p>>6|192:((64512&p)==55296&&(64512&(g=i.charCodeAt(A+1)))==56320?(p=65536+((1023&p)<<10)+(1023&g),++A,o[h++]=p>>18|240,o[h++]=p>>12&63|128):o[h++]=p>>12|224,o[h++]=p>>6&63|128),o[h++]=63&p|128);return h-C}}),SA=function(e,r,i){var o=i||8192,h=o>>>1,p=null,g=o;return function(C){return 1>C||C>h?e(C):(g+C>o&&(p=e(o),g=0),C=r.call(p,g,g+=C),7&g&&(g=1+(7|g)),C)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(e===0)return Xd;var r=0>e;r&&(e=-e);var i=e>>>0;return e=(e-i)/4294967296>>>0,r&&(e=~e>>>0,i=~i>>>0,4294967295<++i&&(i=0,4294967295<++e&&(e=0))),new Wa(i,e)},Wa.from=function(e){if(typeof e=="number")return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?r===0?16384>e?128>e?1:2:2097152>e?3:4:16384>r?128>r?5:6:2097152>r?7:8:128>i?9:10};var V=$a(function(e,r){function i(h,p,g){for(var C=Object.keys(p),A=0;A<C.length;++A)h[C[A]]!==void 0&&g||(h[C[A]]=p[C[A]]);return h}function o(h){function p(g,C){if(!(this instanceof p))return new p(g,C);Object.defineProperty(this,"message",{get:function(){return g}}),Error.captureStackTrace?Error.captureStackTrace(this,p):Object.defineProperty(this,"stack",{value:Error().stack||""}),C&&i(this,C)}return(p.prototype=Object.create(Error.prototype)).constructor=p,Object.defineProperty(p.prototype,"name",{get:function(){return h}}),p.prototype.toString=function(){return this.name+": "+this.message},p}r.asPromise=NA,r.base64=OA,r.EventEmitter=yg,r.float=PA,r.inquire=QA,r.utf8=RA,r.pool=SA,r.LongBits=Wa,r.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),r.global=r.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h},r.isString=function(h){return typeof h=="string"||h instanceof String},r.isObject=function(h){return h&&X(h)==="object"},r.isset=r.isSet=function(h,p){var g=h[p];return!(g==null||!h.hasOwnProperty(p))&&(X(g)!=="object"||0<(Array.isArray(g)?g.length:Object.keys(g).length))},r.Buffer=function(){try{var h=r.inquire("buffer").Buffer;return h.prototype.utf8Write?h:null}catch{return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(h){return typeof h=="number"?r.Buffer?r._Buffer_allocUnsafe(h):new r.Array(h):r.Buffer?r._Buffer_from(h):typeof Uint8Array>"u"?h:new Uint8Array(h)},r.Array=typeof Uint8Array<"u"?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(h){return h?r.LongBits.from(h).toHash():r.LongBits.zeroHash},r.longFromHash=function(h,p){return h=r.LongBits.fromHash(h),r.Long?r.Long.fromBits(h.lo,h.hi,p):h.toNumber(!!p)},r.merge=i,r.lcFirst=function(h){return h.charAt(0).toLowerCase()+h.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(h){for(var p={},g=0;g<h.length;++g)p[h[g]]=1;return function(){for(var C=Object.keys(this),A=C.length-1;-1<A;--A)if(p[C[A]]===1&&this[C[A]]!==void 0&&this[C[A]]!==null)return C[A]}},r.oneOfSetter=function(h){return function(p){for(var g=0;g<h.length;++g)h[g]!==p&&delete this[h[g]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var h=r.Buffer;h?(r._Buffer_from=h.from!==Uint8Array.from&&h.from||function(p,g){return new h(p,g)},r._Buffer_allocUnsafe=h.allocUnsafe||function(p){return new h(p)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,r,i){return this.tail=this.tail.next=new sf(e,r,i),this.len+=r,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,r,i){for(;127<e;)r[i++]=127&e|128,e>>>=7;r[i]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,r,i){r.set(e,i)}:function(e,r,i){for(var o=0;o<e.length;++o)r[i+o]=e[o]};ja.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(ti,1,0);if(V.isString(e)){var i=ja.alloc(r=pr.length(e));pr.decode(e,i,0),e=i}return this.uint32(r)._push(UA,r,e)},ja.prototype.string=function(e){var r=qr.length(e);return r?this.uint32(r)._push(qr.write,r,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,r=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=r,this.len+=i),this},ja.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,r,i),i+=e.len,e=e.next;return r},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(e,r,i){r.set(e,i)}:function(e,r,i){if(e.copy)e.copy(r,i,0,e.length);else for(var o=0;o<e.length;)r[i++]=e[o++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(jc.writeBytesBuffer,r,e),this},jc.prototype.string=function(e){var r=V.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Ut,r,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(r){return V.Buffer.isBuffer(r)?new fl(r):sr(r)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),r=this.pos,i=this.pos+e;if(i>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,i):r===i?new this.buf.constructor(0):this._slice.call(this.buf,r,i)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=7&this.uint32())!=4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var r=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[r](!1)},uint64:function(){return yi.call(this)[r](!0)},sint64:function(){return yi.call(this).zzDecode()[r](!1)},fixed64:function(){return Fm.call(this)[r](!0)},sfixed64:function(){return Fm.call(this)[r](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(r,i,o,h,p){if(!h)throw TypeError("request must be specified");var g=this;if(!p)return V.asPromise(e,g,r,i,o,h);if(g.rpcImpl)try{return g.rpcImpl(r,i[g.requestDelimited?"encodeDelimited":"encode"](h).finish(),function(C,A){if(C)return g.emit("error",C,r),p(C);if(A!==null){if(!(A instanceof o))try{A=o[g.responseDelimited?"decodeDelimited":"decode"](A)}catch(x){return g.emit("error",x,r),p(x)}return g.emit("data",A,r),p(null,A)}g.end(!0)})}catch(C){g.emit("error",C,r),setTimeout(function(){p(C)},0)}else setTimeout(function(){p(Error("already ended"))},0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(e,r){r.Service=tf}),XA={},fc=$a(function(e,r){function i(){o.util._configure(),o.Writer._configure(o.BufferWriter),o.Reader._configure(o.BufferReader)}var o=r;o.build="minimal",o.Writer=xi,o.BufferWriter=jc,o.Reader=zi,o.BufferReader=Fd,o.util=V,o.rpc=WA,o.roots=XA,o.configure=i,i()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},r=Object.create(e);return r[e[0]="Unknown"]=0,r[e[1]="PingUri"]=1,r[e[2]="PongUri"]=2,r[e[11]="UserJoinUri"]=11,r[e[12]="UserRespUri"]=12,r[e[21]="UserQuitUri"]=21,r[e[22]="UserDropUri"]=22,r[e[31]="GroupEnterUri"]=31,r[e[32]="GroupLeaveUri"]=32,r[e[33]="GroupReplyUri"]=33,r[e[36]="GroupEnterNoticeUri"]=36,r[e[37]="GroupLeaveNoticeUri"]=37,r[e[38]="GroupEventNoticeUri"]=38,r[e[39]="GroupCountNoticeUri"]=39,r[e[41]="UserStatusListUri"]=41,r[e[42]="UserStatusResultUri"]=42,r[e[51]="GroupStatusListUri"]=51,r[e[52]="GroupStatusResultUri"]=52,r[e[55]="GroupAllUsersListUri"]=55,r[e[56]="GroupAllUsersResultUri"]=56,r[e[100]="MessageUri"]=100,r[e[101]="AckUri"]=101,r[e[115]="FileUploadIndexGetUri"]=115,r[e[116]="FileUploadIndexRetUri"]=116,r[e[117]="FileUploadIndexSetUri"]=117,r[e[118]="FileUploadIndexFinUri"]=118,r[e[119]="FileUploadIndexErrUri"]=119,r[e[125]="FileDownloadIndexGetUri"]=125,r[e[126]="FileDownloadIndexRetUri"]=126,r[e[127]="FileDownloadIndexErrUri"]=127,r[e[201]="UserJoinNoticeUri"]=201,r[e[202]="UserQuitNoticeUri"]=202,r[e[203]="UserWaitNoticeUri"]=203,r[e[301]="UserAttributeGetUri"]=301,r[e[302]="UserAttributeRetUri"]=302,r[e[303]="UserAttributeSetUri"]=303,r[e[304]="UserAttributeModUri"]=304,r[e[305]="UserAttributeDelUri"]=305,r[e[307]="UserAttributeRspUri"]=307,r[e[308]="UserAttributeErrUri"]=308,r[e[311]="UserAttributeKeysGetUri"]=311,r[e[312]="UserAttributeKeysRetUri"]=312,r[e[351]="GroupAttributeGetUri"]=351,r[e[352]="GroupAttributeRetUri"]=352,r[e[353]="GroupAttributeSetUri"]=353,r[e[354]="GroupAttributeModUri"]=354,r[e[355]="GroupAttributeDelUri"]=355,r[e[356]="GroupAttributeAltUri"]=356,r[e[357]="GroupAttributeRspUri"]=357,r[e[358]="GroupAttributeErrUri"]=358,r[e[361]="GroupAttributeKeysGetUri"]=361,r[e[362]="GroupAttributeKeysRetUri"]=362,r[e[401]="SubscribeUserStatusUri"]=401,r[e[402]="UnsubscribeUserStatusUri"]=402,r[e[499]="SubscribeResponseUri"]=499,r}(),Oh=t.Wrapper=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(r,i){return i||(i=L.create()),r.uri!=null&&Object.hasOwnProperty.call(r,"uri")&&i.uint32(8).int32(r.uri),r.data!=null&&Object.hasOwnProperty.call(r,"data")&&i.uint32(18).bytes(r.data),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Wrapper;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.uri=r.int32();break;case 2:o.data=r.bytes();break;default:r.skipType(7&h)}}return o},e}(),ZA=t.Ping=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&i.uint32(16).uint64(r.ms),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Ping;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.ms=r.uint64();break;default:r.skipType(7&h)}}return o},e}(),$A=t.Pong=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&i.uint32(16).uint64(r.ms),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Pong;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.ms=r.uint64();break;default:r.skipType(7&h)}}return o},e}(),aB=t.UserJoin=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.opt!=null&&Object.hasOwnProperty.call(r,"opt")&&i.uint32(16).uint64(r.opt),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(24).uint64(r.instance),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(34).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&i.uint32(42).string(r.ticket),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserJoin;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.opt=r.uint64();break;case 3:o.instance=r.uint64();break;case 4:o.account=r.string();break;case 5:o.ticket=r.string();break;default:r.skipType(7&h)}}return o},e}(),bB=t.UserResp=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(24).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserResp;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),cB=t.UserQuit=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.encode=function(r,i){return i||(i=L.create()),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserQuit;r.pos<i;){var h=r.uint32();r.skipType(7&h)}return o},e}(),dB=t.UserDrop=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(8).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserDrop;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),eB=t.GroupEnter=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupEnter;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;default:r.skipType(7&h)}}return o},e}(),fB=t.GroupLeave=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.account="",e.encode=function(r,i){return i||(i=L.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(10).string(r.account),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupLeave;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.account=r.string();break;default:r.skipType(7&h)}}return o},e}(),gB=t.GroupReply=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(24).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupReply;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),ur=t.GroupLeaveNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(40).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupLeaveNotice;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.user=r.string();break;case 3:o.group=r.string();break;case 4:o.instance=r.uint64();break;case 5:o.size=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),vr=t.GroupEnterNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(40).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupEnterNotice;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.user=r.string();break;case 3:o.group=r.string();break;case 4:o.instance=r.uint64();break;case 5:o.size=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),wr=t.Message=function(){function e(r){if(this.MiscMap={},r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){if(i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&i.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&i.uint32(24).uint64(r.sequence),r.options!=null&&Object.hasOwnProperty.call(r,"options")&&i.uint32(32).uint64(r.options),r.src!=null&&Object.hasOwnProperty.call(r,"src")&&i.uint32(42).string(r.src),r.dst!=null&&Object.hasOwnProperty.call(r,"dst")&&i.uint32(50).string(r.dst),r.payload!=null&&Object.hasOwnProperty.call(r,"payload")&&i.uint32(58).bytes(r.payload),r.MiscMap!=null&&Object.hasOwnProperty.call(r,"MiscMap"))for(var o=Object.keys(r.MiscMap),h=0;h<o.length;++h)i.uint32(66).fork().uint32(10).string(o[h]).uint32(18).bytes(r.MiscMap[o[h]]).ldelim();return r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&i.uint32(72).uint64(r.ms),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o,h,p=new t.Message;r.pos<i;)switch(o=r.uint32(),o>>>3){case 1:p.instance=r.uint64();break;case 2:p.dialogue=r.uint64();break;case 3:p.sequence=r.uint64();break;case 4:p.options=r.uint64();break;case 5:p.src=r.string();break;case 6:p.dst=r.string();break;case 7:p.payload=r.bytes();break;case 8:p.MiscMap===q.emptyObject&&(p.MiscMap={});var g=r.uint32()+r.pos;for(o="",h=[];r.pos<g;){var C=r.uint32();switch(C>>>3){case 1:o=r.string();break;case 2:h=r.bytes();break;default:r.skipType(7&C)}}p.MiscMap[o]=h;break;case 9:p.ms=r.uint64();break;default:r.skipType(7&o)}return p},e}(),xr=t.Ack=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&i.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&i.uint32(24).uint64(r.sequence),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(32).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Ack;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.instance=r.uint64();break;case 2:o.dialogue=r.uint64();break;case 3:o.sequence=r.uint64();break;case 4:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),hB=t.FileUploadIndexGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&i.uint32(18).bytes(r.hash),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(24).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexGet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.hash=r.bytes();break;case 3:o.size=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),iB=t.FileUploadIndexRet=function(){function e(r){if(this.servers=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(16).uint32(r.unit),r.servers!=null&&r.servers.length){i.uint32(26).fork();for(var o=0;o<r.servers.length;++o)i.uint32(r.servers[o]);i.ldelim()}return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexRet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.unit=r.uint32();break;case 3:if(o.servers&&o.servers.length||(o.servers=[]),(7&h)==2)for(h=r.uint32()+r.pos;r.pos<h;)o.servers.push(r.uint32());else o.servers.push(r.uint32());break;default:r.skipType(7&h)}}return o},e}(),jB=t.FileUploadIndexSet=function(){function e(r){if(this.servers=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&i.uint32(18).bytes(r.hash),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(24).uint32(r.unit),r.servers!=null&&r.servers.length){i.uint32(34).fork();for(var o=0;o<r.servers.length;++o)i.uint32(r.servers[o]);i.ldelim()}return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexSet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.hash=r.bytes();break;case 3:o.unit=r.uint32();break;case 4:if(o.servers&&o.servers.length||(o.servers=[]),(7&h)==2)for(h=r.uint32()+r.pos;r.pos<h;)o.servers.push(r.uint32());else o.servers.push(r.uint32());break;default:r.skipType(7&h)}}return o},e}(),kB=t.FileUploadIndexFin=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&i.uint32(16).uint32(r.zone),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(24).uint32(r.unit),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexFin;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.zone=r.uint32();break;case 3:o.unit=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),lB=t.FileUploadIndexErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexErr;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),mB=t.FileDownloadIndexGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&i.uint32(16).uint32(r.zone),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&i.uint32(26).bytes(r.hash),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(32).uint32(r.size),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(40).uint32(r.unit),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileDownloadIndexGet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.zone=r.uint32();break;case 3:o.hash=r.bytes();break;case 4:o.size=r.uint32();break;case 5:o.unit=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),nB=t.FileDownloadIndexRet=function(){function e(r){if(this.servers=[],this.backups=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(16).uint32(r.unit),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&i.uint32(24).uint32(r.zone),r.servers!=null&&r.servers.length){i.uint32(34).fork();for(var o=0;o<r.servers.length;++o)i.uint32(r.servers[o]);i.ldelim()}if(r.backups!=null&&r.backups.length){for(i.uint32(42).fork(),o=0;o<r.backups.length;++o)i.uint32(r.backups[o]);i.ldelim()}return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileDownloadIndexRet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.unit=r.uint32();break;case 3:o.zone=r.uint32();break;case 4:if(o.servers&&o.servers.length||(o.servers=[]),(7&h)==2)for(h=r.uint32()+r.pos;r.pos<h;)o.servers.push(r.uint32());else o.servers.push(r.uint32());break;case 5:if(o.backups&&o.backups.length||(o.backups=[]),(7&h)==2)for(h=r.uint32()+r.pos;r.pos<h;)o.backups.push(r.uint32());else o.backups.push(r.uint32());break;default:r.skipType(7&h)}}return o},e}(),oB=t.FileDownloadIndexErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileDownloadIndexErr;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),pB=t.GroupAllUsersList=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&i.uint32(24).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&i.uint32(32).uint32(r.pageNumber),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAllUsersList;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.pageSize=r.uint32();break;case 4:o.pageNumber=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),qB=t.GroupAllUsersResult=function(){function e(r){if(this.memberInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.totalSize!=null&&Object.hasOwnProperty.call(r,"totalSize")&&i.uint32(24).uint32(r.totalSize),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&i.uint32(32).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&i.uint32(40).uint32(r.pageNumber),r.memberInfos!=null&&r.memberInfos.length)for(var o=0;o<r.memberInfos.length;++o)t.GroupAllUsersResult.MemberInfo.encode(r.memberInfos[o],i.uint32(50).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAllUsersResult;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.totalSize=r.uint32();break;case 4:o.pageSize=r.uint32();break;case 5:o.pageNumber=r.uint32();break;case 6:o.memberInfos&&o.memberInfos.length||(o.memberInfos=[]),o.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.MemberInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(i,o){return o||(o=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&o.uint32(10).string(i.account),i.ts!=null&&Object.hasOwnProperty.call(i,"ts")&&o.uint32(16).uint32(i.ts),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.GroupAllUsersResult.MemberInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.account=i.string();break;case 2:h.ts=i.uint32();break;default:i.skipType(7&p)}}return h},r}(),e}(),rB=t.UserStatusList=function(){function e(r){if(this.users=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var o=0;o<r.users.length;++o)i.uint32(18).string(r.users[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserStatusList;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.users&&o.users.length||(o.users=[]),o.users.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),sB=t.UserStatusResult=function(){function e(r){if(this.userInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.userInfos!=null&&r.userInfos.length)for(var o=0;o<r.userInfos.length;++o)t.UserStatusResult.UserStatusInfo.encode(r.userInfos[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserStatusResult;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.userInfos&&o.userInfos.length||(o.userInfos=[]),o.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.UserStatusInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(i,o){return o||(o=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&o.uint32(10).string(i.account),i.ts!=null&&Object.hasOwnProperty.call(i,"ts")&&o.uint32(16).uint32(i.ts),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.UserStatusResult.UserStatusInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.account=i.string();break;case 2:h.ts=i.uint32();break;default:i.skipType(7&p)}}return h},r}(),e}(),tB=t.UserAttributeGet=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(26).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeGet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),uB=t.UserAttributeRet=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.UserAttributeRet.AttributeInfo.encode(r.attributeInfos[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeRet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.UserAttributeRet.AttributeInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;default:i.skipType(7&p)}}return h},r}(),e}(),vB=t.UserAttributeSet=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.UserAttributeSet.AttributeInfo.encode(r.attributeInfos[o],i.uint32(26).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeSet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.UserAttributeSet.AttributeInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;default:i.skipType(7&p)}}return h},r}(),e}(),wB=t.UserAttributeMod=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.UserAttributeMod.AttributeInfo.encode(r.attributeInfos[o],i.uint32(26).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeMod;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.UserAttributeMod.AttributeInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;default:i.skipType(7&p)}}return h},r}(),e}(),xB=t.UserAttributeDel=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(26).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeDel;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),yB=t.UserAttributeErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeErr;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),zB=t.UserAttributeKeysGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeKeysGet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;default:r.skipType(7&h)}}return o},e}(),AB=t.UserAttributeKeysRet=function(){function e(r){if(this.keys=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var o=0;o<r.keys.length;++o)i.uint32(18).string(r.keys[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeKeysRet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.keys&&o.keys.length||(o.keys=[]),o.keys.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),BB=t.UserAttributeRsp=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeRsp;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;default:r.skipType(7&h)}}return o},e}(),CB=t.GroupStatusList=function(){function e(r){if(this.groups=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.groups!=null&&r.groups.length)for(var o=0;o<r.groups.length;++o)i.uint32(18).string(r.groups[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupStatusList;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.groups&&o.groups.length||(o.groups=[]),o.groups.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),DB=t.GroupStatusResult=function(){function e(r){if(this.groupInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.groupInfos!=null&&r.groupInfos.length)for(var o=0;o<r.groupInfos.length;++o)t.GroupStatusResult.GroupInfo.encode(r.groupInfos[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupStatusResult;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.groupInfos&&o.groupInfos.length||(o.groupInfos=[]),o.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.GroupInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.group="",r.prototype.memberCount=0,r.encode=function(i,o){return o||(o=L.create()),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&o.uint32(10).string(i.group),i.memberCount!=null&&Object.hasOwnProperty.call(i,"memberCount")&&o.uint32(16).uint32(i.memberCount),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.GroupStatusResult.GroupInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.group=i.string();break;case 2:h.memberCount=i.uint32();break;default:i.skipType(7&p)}}return h},r}(),e}(),EB=t.GroupCountNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(26).string(r.group),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(32).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupCountNotice;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.group=r.string();break;case 4:o.size=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),FB=t.GroupAttributeGet=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(26).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeGet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),GB=t.GroupAttributeRet=function(){function e(r){if(this.attributeMaps=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.attributeMaps!=null&&r.attributeMaps.length)for(var o=0;o<r.attributeMaps.length;++o)t.GroupAttributeRet.AttributeMap.encode(r.attributeMaps[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeRet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.attributeMaps&&o.attributeMaps.length||(o.attributeMaps=[]),o.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeMap=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),i.origin!=null&&Object.hasOwnProperty.call(i,"origin")&&o.uint32(26).string(i.origin),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&o.uint32(32).uint64(i.ms),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.GroupAttributeRet.AttributeMap;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;case 3:h.origin=i.string();break;case 4:h.ms=i.uint64();break;default:i.skipType(7&p)}}return h},r}(),e}(),HB=t.GroupAttributeSet=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&i.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.GroupAttributeSet.AttributeInfo.encode(r.attributeInfos[o],i.uint32(34).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeSet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.broadcast=r.bool();break;case 4:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.GroupAttributeSet.AttributeInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;default:i.skipType(7&p)}}return h},r}(),e}(),IB=t.GroupAttributeMod=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&i.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.GroupAttributeMod.AttributeInfo.encode(r.attributeInfos[o],i.uint32(34).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeMod;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.broadcast=r.bool();break;case 4:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.GroupAttributeMod.AttributeInfo;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;default:i.skipType(7&p)}}return h},r}(),e}(),JB=t.GroupAttributeDel=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&i.uint32(24).bool(r.broadcast),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(34).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeDel;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.broadcast=r.bool();break;case 4:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),KB=t.GroupAttributeAlt=function(){function e(r){if(this.attributeMaps=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(24).uint64(r.instance),r.attributeMaps!=null&&r.attributeMaps.length)for(var o=0;o<r.attributeMaps.length;++o)t.GroupAttributeAlt.AttributeMap.encode(r.attributeMaps[o],i.uint32(34).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeAlt;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.instance=r.uint64();break;case 4:o.attributeMaps&&o.attributeMaps.length||(o.attributeMaps=[]),o.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.AttributeMap=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),i.origin!=null&&Object.hasOwnProperty.call(i,"origin")&&o.uint32(26).string(i.origin),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&o.uint32(32).uint64(i.ms),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.GroupAttributeAlt.AttributeMap;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.key=i.string();break;case 2:h.value=i.string();break;case 3:h.origin=i.string();break;case 4:h.ms=i.uint64();break;default:i.skipType(7&p)}}return h},r}(),e}(),LB=t.GroupAttributeRsp=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeRsp;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;default:r.skipType(7&h)}}return o},e}(),MB=t.GroupAttributeErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeErr;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&h)}}return o},e}(),NB=t.GroupAttributeKeysGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeKeysGet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;default:r.skipType(7&h)}}return o},e}(),OB=t.GroupAttributeKeysRet=function(){function e(r){if(this.keys=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var o=0;o<r.keys.length;++o)i.uint32(18).string(r.keys[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeKeysRet;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.keys&&o.keys.length||(o.keys=[]),o.keys.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),PB=t.SubscribeUserStatus=function(){function e(r){if(this.users=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var o=0;o<r.users.length;++o)i.uint32(18).string(r.users[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.SubscribeUserStatus;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.users&&o.users.length||(o.users=[]),o.users.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),QB=t.UnsubscribeUserStatus=function(){function e(r){if(this.users=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var o=0;o<r.users.length;++o)i.uint32(18).string(r.users[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UnsubscribeUserStatus;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.users&&o.users.length||(o.users=[]),o.users.push(r.string());break;default:r.skipType(7&h)}}return o},e}(),RB=t.UserJoinNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(26).string(r.user),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserJoinNotice;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.user=r.string();break;default:r.skipType(7&h)}}return o},e}(),SB=t.UserQuitNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(26).string(r.user),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserQuitNotice;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.user=r.string();break;default:r.skipType(7&h)}}return o},e}(),TB=t.UserWaitNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(26).string(r.user),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserWaitNotice;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.user=r.string();break;default:r.skipType(7&h)}}return o},e}(),UB=t.SubscribeResponse=function(){function e(r){if(this.errors=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.errors!=null&&r.errors.length)for(var o=0;o<r.errors.length;++o)t.SubscribeResponse.SubscribeErrorsType.encode(r.errors[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.SubscribeResponse;r.pos<i;){var h=r.uint32();switch(h>>>3){case 1:o.seq=r.uint64();break;case 2:o.errors&&o.errors.length||(o.errors=[]),o.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return o},e.SubscribeErrorsType=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.account="",r.prototype.code=0,r.encode=function(i,o){return o||(o=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&o.uint32(10).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&o.uint32(16).uint32(i.code),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var h=new t.SubscribeResponse.SubscribeErrorsType;i.pos<o;){var p=i.uint32();switch(p>>>3){case 1:h.account=i.string();break;case 2:h.code=i.uint32();break;default:i.skipType(7&p)}}return h},r}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(r,i,o){var h=(r=String(jb(r))).length;return o=o===void 0?" ":String(o),(i=ta(i))<=h||o==""?r:(i-=h,(h=Pn.call(o,WB(i/o.length))).length>i&&(h=h.slice(0,i)),e?r+h:h+r)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(r){r=qb(r);for(var i,o=Dc(r),h=o.length,p=0,g=[];h>p;)i=o[p++],ka&&!ZB.call(r,i)||g.push(e?[i,r[i]]:r[i]);return g}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var r=String(jb(this));ck(e);var i=1<arguments.length?arguments[1]:void 0,o=ta(r.length);return i=i===void 0?o:cC(ta(i),o),o=String(e),Br?Br.call(r,o,i):r.slice(i-o.length,i)===o}}),dh("match",1,function(e,r,i){return[function(o){var h=jb(this),p=o==null?void 0:o[e];return p!==void 0?p.call(o,h):new RegExp(o)[e](String(h))},function(o){var h=i(r,o,this);if(h.done)return h.value;if(o=va(o),h=String(this),!o.global)return Ke(o,h);var p=o.unicode;o.lastIndex=0;for(var g,C=[],A=0;(g=Ke(o,h))!==null;)g=String(g[0]),C[A]=g,g===""&&(o.lastIndex=xj(h,ta(o.lastIndex),p)),A++;return A===0?null:C}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var r=String(jb(this));ck(e);var i=ta(fC(1<arguments.length?arguments[1]:void 0,r.length)),o=String(e);return Dr?Dr.call(r,o,i):r.slice(i,i+o.length)===o}});var Nm=function(e){var r=/(%?)(%([jds]))/g,i=Array.prototype.slice.call(arguments,1);return i.length&&(e=e.replace(r,function(o,h,p,g){switch(p=i.shift(),g){case"s":p=""+p;break;case"d":p=Number(p);break;case"j":p=JSON.stringify(p)}return h?(i.unshift(p),o):p})),i.length&&(e+=" "+i.join(" ")),""+(e=e.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(e){for(var r=e.length;r--&&hC.test(e.charAt(r)););return r},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if(typeof e=="number")return e;if(ie(e))return Fr;if(lb(e)&&(e=typeof e.valueOf=="function"?e.valueOf():e,e=lb(e)?e+"":e),typeof e!="string")return e===0?e:+e;e=e&&e.slice(0,iC(e)+1).replace(jC,"");var r=lC.test(e);return r||mC.test(e)?nC(e.slice(2),r?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,r,i){function o(t0){var aH=A,pH=x;return A=x=void 0,fN=t0,_e=e.apply(pH,aH)}function h(t0){var aH=t0-dN;return t0-=fN,dN===void 0||aH>=r||0>aH||EN&&t0>=IN}function p(){var t0=Cb.Date.now();if(h(t0))return g(t0);var aH=setTimeout,pH=t0-fN;t0=r-(t0-dN),pH=EN?pC(t0,IN-pH):t0,cN=aH(p,pH)}function g(t0){return cN=void 0,RN&&A?o(t0):(A=x=void 0,_e)}function C(){var t0=Cb.Date.now(),aH=h(t0);if(A=arguments,x=this,dN=t0,aH){if(cN===void 0)return fN=t0=dN,cN=setTimeout(p,r),mN?o(t0):_e;if(EN)return clearTimeout(cN),cN=setTimeout(p,r),o(dN)}return cN===void 0&&(cN=setTimeout(p,r)),_e}var A,x,_e,cN,dN,fN=0,mN=!1,EN=!1,RN=!0;if(typeof e!="function")throw new TypeError("Expected a function");if(r=gl(r)||0,lb(i)){mN=!!i.leading;var IN=(EN="maxWait"in i)?oC(gl(i.maxWait)||0,r):IN;RN="trailing"in i?!!i.trailing:RN}return C.cancel=function(){cN!==void 0&&clearTimeout(cN),fN=0,A=dN=x=cN=void 0},C.flush=function(){return cN===void 0?_e:g(Cb.Date.now())},C},yc=function(e){function r(o,h){return W(this,r),m(n(o=i.call(this,Mm(o,h))),"originalError",void 0),m(n(o),"code",void 0),m(n(o),"serverCode",void 0),typeof h=="number"?o.code=h:typeof h=="string"?o.name=h:h!==void 0&&(h.originalError&&(o.originalError=h.originalError),h.code!==void 0&&(o.code=h.code),h.serverCode!==void 0&&(o.serverCode=h.serverCode)),o}la(r,e);var i=ma(r);return r}(ef(Error)),Ia=function(e){function r(o,h){return W(this,r),m(n(o=i.call(this,Mm(o,h))),"name","RtmInternalError"),m(n(o),"code",void 0),o.code=h,o}la(r,e);var i=ma(r);return r}(ef(Error)),Ph=function(){return function(e){function r(o){W(this,r);var h=Object.keys(o);return i.call(this,o[h[0]],h[0])}la(r,e);var i=ma(r);return r}(Ia)},Fa=Ph(),db=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmTimeoutError"),o}la(r,e);var i=ma(r);return r}(yc),I=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmInvalidArgumentError"),o}la(r,e);var i=ma(r);return r}(yc),K=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmInvalidStatusError"),o}la(r,e);var i=ma(r);return r}(yc),hl=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmInterruptedError"),o}la(r,e);var i=ma(r);return r}(yc),ib=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmLimitExceededError"),o}la(r,e);var i=ma(r);return r}(yc),rC=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmInvokeTooOftenError"),o}la(r,e);var i=ma(r);return r}(yc),da=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmUnavailableError"),m(n(o),"serverCode",void 0),m(n(o),"statusCode",void 0),o}la(r,e);var i=ma(r);return r}(yc),Ye=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmUnauthenticatedError"),m(n(o),"serverCode",void 0),o}la(r,e);var i=ma(r);return r}(yc),Wc=function(e){function r(){W(this,r);for(var o=arguments.length,h=Array(o),p=0;p<o;p++)h[p]=arguments[p];return m(n(o=i.call.apply(i,[this].concat(h))),"name","RtmUnknownError"),o}la(r,e);var i=ma(r);return r}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,r,i){return['Executing "%s.%s" timed out after %ds',e,r,i/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return typeof e=="string"?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var r="",i=(e=new Uint8Array(e)).byteLength,o=-1;++o<i;)r+=String.fromCharCode(e[o]);return r=btoa(r),"data:;base64,".concat(r)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var r=lc(e);return typeof r!="number"||isFinite(r)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,r,i){return JSON.stringify(Ym(e),r,i)};Gr.ensureProperties=Ym;var uC=function(e,r){r=r||{};var i=X(e);if(i==="string"&&0<e.length)return au(e);if(i==="number"&&isFinite(e))return r.long?e=864e5<=(r=Math.abs(e))?Jg(e,r,864e5,"day"):36e5<=r?Jg(e,r,36e5,"hour"):6e4<=r?Jg(e,r,6e4,"minute"):1e3<=r?Jg(e,r,1e3,"second"):e+" ms":e=864e5<=(r=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=r?Math.round(e/36e5)+"h":6e4<=r?Math.round(e/6e4)+"m":1e3<=r?Math.round(e/1e3)+"s":e+"ms",e;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function r(h){function p(){for(var A=arguments.length,x=Array(A),_e=0;_e<A;_e++)x[_e]=arguments[_e];if(p.enabled){A=Number(new Date),p.diff=A-(g||A),p.prev=g,g=p.curr=A,x[0]=r.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");var cN=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,function(dN,fN){return dN==="%%"?"%":(cN++,typeof(fN=r.formatters[fN])=="function"&&(dN=fN.call(p,x[cN]),x.splice(cN,1),cN--),dN)}),r.formatArgs.call(p,x),(p.log||r.log).apply(p,x)}}var g,C=null;return p.namespace=h,p.useColors=r.useColors(),p.color=r.selectColor(h),p.extend=i,p.destroy=r.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:function(){return C===null?r.enabled(h):C},set:function(A){C=A}}),typeof r.init=="function"&&r.init(p),p}function i(h,p){return(h=r(this.namespace+(p===void 0?":":p)+h)).log=this.log,h}function o(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(h){return h instanceof Error?h.stack||h.message:h},r.disable=function(){var h=[].concat(G(r.names.map(o)),G(r.skips.map(o).map(function(p){return"-"+p}))).join(",");return r.enable(""),h},r.enable=function(h){r.save(h),r.names=[],r.skips=[];var p,g=(typeof h=="string"?h:"").split(/[\s,]+/),C=g.length;for(p=0;p<C;p++)g[p]&&((h=g[p].replace(/\*/g,".*?"))[0]==="-"?r.skips.push(new RegExp("^"+h.substr(1)+"$")):r.names.push(new RegExp("^"+h+"$")))},r.enabled=function(h){if(h[h.length-1]==="*")return!0;var p,g=0;for(p=r.skips.length;g<p;g++)if(r.skips[g].test(h))return!1;for(g=0,p=r.names.length;g<p;g++)if(r.names[g].test(h))return!0;return!1},r.humanize=uC,r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(function(h){r[h]=e[h]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(h){for(var p=0,g=0;g<h.length;g++)p=(p<<5)-p+h.charCodeAt(g),p|=0;return r.colors[Math.abs(p)%r.colors.length]},r.enable(r.load()),r},Hr=$a(function(e,r){r.formatArgs=function(o){if(o[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+o[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var h="color: "+this.color;o.splice(1,0,h,"color: inherit");var p=0,g=0;o[0].replace(/%[a-zA-Z%]/g,function(C){C!=="%%"&&(p++,C==="%c"&&(g=p))}),o.splice(g,0,h)}},r.save=function(o){try{o?r.storage.setItem("debug",o):r.storage.removeItem("debug")}catch{}},r.load=function(){try{var o=r.storage.getItem("debug")}catch{}return!o&&typeof process<"u"&&"env"in process&&(o=define_process_env_default.DEBUG),o},r.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var i=localStorage;break e}catch{}i=void 0}r.storage=i,r.destroy=function(){var o=!1;return function(){o||(o=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),r.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),r.log=console.debug||console.log||function(){},e.exports=vC(r),e.exports.formatters.j=function(o){try{return JSON.stringify(o)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(r){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=r.processId,this.sdkVersion=r.sdkVersion,this.rtmConfig=r.rtmConfig,this.uploadRequest=r.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(r){this.LogCache.push(r),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(r){var i=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function o(){var h,p,g;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return h={sdk_version:i.sdkVersion,process_id:i.processId,payload:JSON.stringify(r)},C.prev=1,C.next=4,i.uploadRequest(h,(p=i.rtmConfig.enableCloudProxy)!==null&&p!==void 0&&p);case 4:if(!Uk){C.next=6;break}throw Error("RTM is busy");case 6:C.next=13;break;case 8:return C.prev=8,C.t0=C.catch(1),g=2>i.uploadResendCount++?2e3:1e4,setTimeout(function(){return i.postLog(i.LogsToPost)},g),C.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),i.LogCache.length!==0){C.next=17;break}return i.uploadState=Ze.Free,C.abrupt("return");case 17:i.uploadResendCount=0,i.LogsToPost=40>i.LogCache.length?i.LogCache.splice(0,i.LogCache.length):i.LogCache.splice(0,40),i.postLog(i.LogsToPost);case 20:case"end":return C.stop()}},o,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,r,i,o,h,p,g,C){var A=0;for(g=!!g&&Id(g,C,3);A<o;){if(A in i){if(C=g?g(i[A],A,r):i[A],0<p&&gd(C))h=Jr(e,r,C,ta(C.length),h,p-1)-1;else{if(9007199254740991<=h)throw TypeError("Exceed the acceptable array length");e[h]=C}h++}A++}return h},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,r=Qa(this),i=ta(r.length),o=Sg(r,0);return o.length=xC(o,r,r,i,0,e===void 0?1:$b(e)),o}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var r;return(r=Hg(yf).find(function(i){return(i=ra(i,2))[0],i[1].includes(e)}))===null||r===void 0?void 0:r[0]},AC=function(e){return e.sort(function(r,i){return Kr.indexOf(r)-Kr.indexOf(i)})},xe=function(e){var r=new Set;if((e=AC(e).slice(0,3).map(function(i){var o=Kg[i];if(o===void 0)throw new Ia("invalid area key");return i=o.CODE,o=ff(o,yC),r.add(i),o})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:r},e.reduce(function(i,o){for(var h=0,p=Hg(i);h<p.length;h++){var g=ra(p[h],2),C=g[0];g=g[1],i[C]=Array.from(new Set([].concat(G(o[C]),G(g))))}return i}))},M,Lr=function(){var e=J(w.mark(function r(i,o){var h,p,g,C,A,x=arguments;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(!(2<(p=2<x.length&&x[2]!==void 0?x[2]:0))){_e.next=3;break}return _e.abrupt("return");case 3:return g={withCredentials:!0,body:i,timeout:2e4},C=0<p?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",A=o?"https://".concat((h=M==null?void 0:M.PROXY_NGINX[0])!==null&&h!==void 0?h:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(C,"&p=443&d=upload/v1"):"https://".concat(C,"/upload/v1"),_e.next=8,te(A,g).catch(function(cN){return Lr(i,o,p+1)});case 8:case"end":return _e.stop()}},r)}));return function(r,i){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if(typeof e=="string")return oa(e);if(Array.isArray(e)&&e.every(function(p){return typeof p=="string"}))return e.map(function(p){return oa(p)});if(!Il(e)){for(var r={},i=0;i<Or.length;i++){var o=Or[i];o in e&&(r[o]=e[o])}if(0<Object.keys(r).length)return r;if(5>Object.keys(e).length){for(i=0,e=Object.entries(e);i<e.length;i++){var h=ra(e[i],2);o=h[0],h=h[1],il.includes(o)?r[o]="[Hidden Info]":r[oa(o)]=typeof h=="string"?oa(h):"[Sensitive Info]"}return r}return"[Sensitive Info]"}return e},Pr=function(e){return X(e)==="object"?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,r){return e instanceof Error?e.message:typeof e!="string"?JSON.stringify(Vm(fe(e,5),il,Nr)):(r=r.map(function(i){return i instanceof Error?i.message:X(i)==="object"?Gr(Array.isArray(i)?i.map(Pr):Pr(i)):i}),Nm.apply(void 0,[e.replace(/%[%Oo]/g,function(i){return i==="%%"?"%":i==="%o"||i==="%O"?"%s":i})].concat(G(r))))},CC=1,Rr=function(e,r,i){var o=Hr(e);return o.enabled=!0,o.log=i,o.useColors=!1,function(h){for(var p=arguments.length,g=Array(1<p?p-1:0),C=1;C<p;C++)g[C-1]=arguments[C];if(r.enableLogUpload){p=Cg(h);var A=Qr(p,g);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<A.length?A.slice(0,256):A)})}switch(p=function(x){var _e=A||Qr(Cg(h),g),cN=Nc.LOG_HANDLER;typeof cN=="function"&&cN({level:x,message:_e}),o(_e)},e){case"RTM:INFO":r.logFilter.info&&p("log");break;case"RTM:WARN":r.logFilter.warn&&p("warning");break;case"RTM:ERROR":r.logFilter.error&&p("error");break;case"RTM:TRACK":r.logFilter.track&&p("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":r.logFilter.debug&&p("debug");break;case"RTM:DEBUG":r.logFilter.debug&&p("debug")}}},jl,Sr=function(e){return function(r){var i=jl===1||e===void 0?"":"Ins#".concat(e," ");return"".concat(i).concat(r)}},kl=function(e,r,i){var o=Sr(jl);return Rr("RTM:".concat(r),i,function(h){return e(o(h))})},tb=function(){return function(e){function r(o,h){var p=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,r);var g=i.call(this);if(m(n(g),"logError",void 0),m(n(g),"invokeTracker",void 0),m(n(g),"resultTracker",void 0),m(n(g),"errorTracker",void 0),m(n(g),"eventTracker",void 0),m(n(g),"info",void 0),m(n(g),"warn",void 0),m(n(g),"log",void 0),m(n(g),"genLogger",void 0),m(n(g),"loggerId",void 0),m(n(g),"logger",void 0),m(n(g),"name",void 0),g.logger=o,g.name=h,g.loggerId=o.loggerId,g.info=o.info,g.warn=o.warn,g.logError=o.logError,g.genLogger=o.genLogger,g.log=o.genLogger("RTM:DEBUG","<".concat(h,"> ")),g.invokeTracker=o.genTracker("Invoke"),g.eventTracker=o.genTracker("Event"),g.resultTracker=o.genTracker("Result"),g.errorTracker=o.genTracker("Error"),p){var C=g.emit.bind(n(g));g.emit=function(){for(var A=arguments.length,x=Array(A),_e=0;_e<A;_e++)x[_e]=arguments[_e];A=x[0],_e=x.slice(1);var cN=BC.includes(A);g.eventTracker.apply(g,["%s: ".concat(0<_e.length?"%s emitted with args: ".concat(_e.map(function(){return"%o"})):"%s emitted"),h,A].concat(G(cN?_e.map(ye):_e)));try{C.apply(void 0,x)}catch(dN){g.logError("Caught in the callback function of the event %s",A,dN)}}}return g}la(r,e);var i=ma(r);return r}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,r){return function(i){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",h=Sr(e),p=console.debug.bind(console),g=Rr(i,r,function(C){return p(h(C))});return function(C){for(var A=arguments.length,x=Array(1<A?A-1:0),_e=1;_e<A;_e++)x[_e-1]=arguments[_e];return g.apply(void 0,[o+C].concat(x))}}},GC=function(e,r){return function(i){return Tr(e,r)("RTM:TRACK","[".concat(i,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,r){var i=-1,o=e.length,h=o-1;for(r=r===void 0?o:r;++i<r;){var p=e[o=nr(i,h)];e[o]=e[i],e[i]=p}return e.length=r,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function r(o,h,p,g,C,A){W(this,r);var x=i.call(this,C,Ai("Socket-",C.loggerId));if(m(n(x),"isActiveClose",!1),m(n(x),"loggedIn",!1),m(n(x),"useNewDomain",void 0),m(n(x),"receivedPacket",new Pa),m(n(x),"open$",void 0),m(n(x),"input$",new Pa),m(n(x),"userJoin$",new Pa),m(n(x),"attemptsSinceLastError",0),m(n(x),"message$",new Pa),m(n(x),"socket$",void 0),m(n(x),"toClose",new Pa),m(n(x),"toReconnect",new Pa),m(n(x),"sendLogger",void 0),m(n(x),"receiveLogger",void 0),m(n(x),"ip",void 0),m(n(x),"env",void 0),m(n(x),"ticket",void 0),m(n(x),"context",void 0),m(n(x),"getDomain",function(){return an(x.ip,x.useNewDomain)}),m(n(x),"socketReconnector",function(dN){var fN=function(mN){return x.attemptsSinceLastError+=1,x.warn("The %s of Env %d reconnecting %s",x.name,x.env,mN.message),Bc(3e3)};return dN.pipe(Ga(function(mN){return x.log("socket connection closed"),x.loggedIn=!1,2<=x.attemptsSinceLastError?(x.warn("socket connection failure"),x.emit("connectionFailure"),x.close(),Z(mN)):x.isActiveClose?vb:(x.emit("reconnect"),x.useNewDomain=!x.useNewDomain,Z(mN))}),oe(function(mN){return mN.pipe(Cc(fN))}))}),x.ip=o,x.env=h,x.ticket=p,x.context=g,x.useNewDomain=A??.5<=Math.random(),x.sendLogger=x.genLogger("RTM:MSG:SEND"),x.receiveLogger=x.genLogger("RTM:MSG:RECV"),h!==0&&h!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(o))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var _e=af[h];x.log("Opening websocket address %s for the Env %d",x.ip,x.env);var cN=Xb(x.input$,x.userJoin$.pipe(Rt(2)),x.message$).pipe(ba(function(dN){return Oh.encode(dN).finish()}));return o=Xb(St("",{protocols:[],makeWebSocket:function(){if(x.context.config.enableCloudProxy){if(x.context.cloudProxyServers.length===0)throw x.logError("No cloud proxy server to connect"),new da;var dN="wss://".concat(an(bn(x.context.cloudProxyServers),!1),"/");dN=we(dN,"sid",x.context.sid),dN=we(dN,"remote_port",_e.toString()),dN=we(dN,"remote_ip",x.ip),dN=we(dN,"token",x.context.key),dN=new WebSocket(dN)}else dN=new WebSocket("wss://".concat(x.getDomain(),":").concat(_e));return dN.binaryType="arraybuffer",dN}}),x.toReconnect),x.socket$=Ca(o,Tk.pipe(hb(15e3),Ga(function(dN){return Sa(dN)&&x.warn("socket open timed out"),Z(dN)}))).pipe(ba(function(dN){if(dN instanceof Error)throw x.warn("Env_%d: Force reconnect the socket",x.env),dN;return dN(cN).pipe(ba(function(fN){return Oh.decode(new Uint8Array(fN))}))}),x.socketReconnector),x.open$=x.socket$.pipe(ca(function(dN){x.log("Websocket opened",x.name),dN.subscribe(function(fN){var mN=fN.data;fN=Li[fN.uri].slice(0,-3),mN=$m[fN].decode(mN);var EN=HA({},Gk(mN,"toJSON"),function(aH,pH){return pH instanceof U?Km(pH):pH}),RN=!1;if((mN instanceof vr||mN instanceof ur)&&mN.instance.lessThanOrEqual(4294967295)&&(RN=!0),mN instanceof wr||mN instanceof xr){var IN=mN.instance,t0=mN.sequence;(mN.dialogue.lessThanOrEqual(4294967295)||IN.lessThanOrEqual(4294967295)||t0.lessThan(1))&&(RN=!0)}RN?x.warn("Env_%d: Illegal %s, abandoned %o",x.env,fN,EN):(fN!=="Pong"&&x.receiveLogger("Env_%d: %s %o",x.env,fN,EN),x.receivedPacket.next([fN,mN]))},function(){})}),qf(void 0),ob(x.toClose),pe()),x}la(r,e);var i=ma(r);return Ha(r,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(o,h){if(o!=="Ping"){var p=uc(h,function(g){return g instanceof U?Km(g):g});this.sendLogger("Env_%d: %s %o",this.env,o,p)}h=du(o,h),o==="UserJoin"?this.userJoin$.next(h):o==="Message"?this.message$.next(h):this.input$.next(h)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(o){var h=this;return this.receivedPacket.pipe(ca(function(p){var g=ra(p,2);p=g[0],g=g[1],p==="UserResp"&&(h.attemptsSinceLastError=0,h.loggedIn=!0),p==="UserDrop"&&h.emit("socketUserDrop",g)}),wb(function(p){return ra(p,1)[0]===o}),ba(function(p){return ra(p,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),r}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var r=xf(Kg);e=Yt(e);for(var i=0;i<r.length;i++){var o=Kg[r[i]];if(o!=null&&o.AP_DOMAINS.includes(e)||o!=null&&o.AP_BACKUP_DOMAINS.includes(e)||o!=null&&o.PROXY_AP.includes(e))return[o.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function r(o,h){var p=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,r);var g=i.call(this,h,"AccessPoint");return m(n(g),"handleUniLbsError",function(C,A){var x=C;if(4<C.toString().length){var _e=C.toString().padStart(8,"0"),cN=parseInt(_e.slice(0,4),10);if(_e=parseInt(_e.slice(4,8),10),cN===201)x=_e;else if(cN===101&&!QC.includes(_e))return Z(Error("service is currently unavailable"))}if(cN=x.toString(),!Object.keys(Vr).includes(cN))return(C=new da(["Login is rejected by the server. The response code is %d",C],jg)).serverCode=x,Z(C);switch(cN=Vr[cN],x=PC[cN],cN){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(A=new Ye(x,$q)).serverCode=C,Z(A);case"INVALID_USER_ID":return(A=new Ye(x,Jh)).serverCode=C,Z(A);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(A=new Ye(x,Kh)).serverCode=C,Z(A);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(A=new Ye(x,ar)).serverCode=C,Z(A);case"CANNOT_MEET_AREA_DEMAND":return(A=OC(A)).forEach(function(dN){return g.failedAreas.add(dN)}),g.failedAreas.size===(M===void 0?2:M.CODES.size)?((A=new I(x,jg)).serverCode=C,Z(A)):Z(Error("ap ".concat(A.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(A=new da(x,jg)).serverCode=C,Z(A);default:return Z(Im("ApResErrType",cN))}}),m(n(g),"getApEdgeInfo$",void 0),m(n(g),"getApEdgeInfoEndFirst$",void 0),m(n(g),"apFinish$",new Pa),m(n(g),"retryCount",0),m(n(g),"failedAreas",new Set),m(n(g),"usedUrl",[]),m(n(g),"newDomainUsed",!1),m(n(g),"backupNewDomainUsed",!1),m(n(g),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(C){return bb.apply(void 0,G(C))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(g),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(C){return bb.apply(void 0,G(C))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(g),"getApUrl$",function(C){var A,x;return g.genUrl().pipe(wb(function(_e){return(!g.newDomainUsed||!_e.includes("sd-rtn.com"))&&(_e.includes("sd-rtn.com")&&(g.newDomainUsed=!0),!dl(g.usedUrl,function(cN){var dN;return cN===((dN=_e.match(Qh))===null||dN===void 0?void 0:dN[1])}))}),ca(function(_e){var cN;M===void 0&&typeof(_e=(cN=_e.match(Qh))===null||cN===void 0?void 0:cN[1])=="string"&&g.usedUrl.push(_e)}),Ka(C?Math.max(Nc.RECONNECTING_AP_NUM,(A=M==null?void 0:M.CODES.size)!==null&&A!==void 0?A:0):(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:2),Dd(function(){return r.runOutOfUrlSymbol}),Ga(function(_e,cN){return g.newDomainUsed=!1,_e===r.runOutOfUrlSymbol?(g.usedUrl=[],cN):Z(_e)}))}),m(n(g),"getBackupApUrl$",function(C){var A,x;return g.genBackupUrl().pipe(wb(function(_e){return(!g.backupNewDomainUsed||!_e.includes("sd-rtn.com"))&&(_e.includes("sd-rtn.com")&&(g.backupNewDomainUsed=!0),!dl(g.usedUrl,function(cN){var dN;return cN===((dN=_e.match(Qh))===null||dN===void 0?void 0:dN[1])}))}),ca(function(_e){var cN;M===void 0&&typeof(_e=(cN=_e.match(Qh))===null||cN===void 0?void 0:cN[1])=="string"&&g.usedUrl.push(_e)}),Ka(C?Math.max(Nc.RECONNECTING_AP_NUM,(A=M==null?void 0:M.CODES.size)!==null&&A!==void 0?A:0):(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:2),Dd(function(){return r.runOutOfUrlSymbol}),Ga(function(_e,cN){return g.backupNewDomainUsed=!1,_e===r.runOutOfUrlSymbol?(g.usedUrl=[],cN):Z(_e)}))}),m(n(g),"getProxyApUrl$",function(C){var A,x;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(C?Math.max(Nc.RECONNECTING_AP_NUM,(A=M==null?void 0:M.CODES.size)!==null&&A!==void 0?A:0):(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:2))}),m(n(g),"context",void 0),m(n(g),"fetchCloudProxy",function(C,A){var x=Ai("AP-",g.loggerId);g.log("The AccessPoint requests %s(%s)",C,x);var _e=new AbortController;return g.apFinish$.pipe(Ka(1)).subscribe(function(){return _e.abort()}),ad(J(w.mark(function cN(){var dN;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:return dN=Ag(0,Number.MAX_SAFE_INTEGER),g.log("%s request opid: %d",x,dN),fN.abrupt("return",te(C,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:g.context.sid,opid:dN,appid:g.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:A??g.context.key,cname:g.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(mN){return mN===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):mN}).join(",")})}}]},signal:_e.signal}));case 3:case"end":return fN.stop()}},cN)}))).pipe(Ga(function(cN){return cN.name!=="AbortError"&&(g.logError(cN),g.warn("The AP server %s request failure",C,cN)),vb}),cb(function(){var cN=J(w.mark(function dN(fN){var mN,EN,RN,IN,t0,aH,pH,SH,vH,AH,UH,zH,CH,HH,VH,KH,IH,MH,GH;return w.wrap(function(yH){for(;;)switch(yH.prev=yH.next){case 0:if(mN=fN.responseText,EN=JSON.parse(mN),g.log("The %s response is %o",x,EN),((RN=EN.response_body)===void 0||RN.length===0||RN.some(function(TH){var NH;return((NH=TH.buffer)===null||NH===void 0?void 0:NH.code)===void 0||TH.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(IN=RN.filter(function(TH){return TH.buffer.code!==0})).length===0){yH.next=14;break}if((t0=IN.find(function(TH){return TH.buffer.flag===128}))===void 0){yH.next=12;break}return yH.abrupt("return",g.handleUniLbsError(t0.buffer.code,C));case 12:return g.logError("cloud proxy error response"),yH.abrupt("return",g.handleUniLbsError(IN[0].buffer.code,C));case 14:for(aH=[],pH=0;pH<RN.length;pH++)if(((AH=RN[pH])==null||(SH=AH.buffer)===null||SH===void 0?void 0:SH.flag)===262144)(UH=AH.buffer)===null||UH===void 0||(zH=UH.edges_services)===null||zH===void 0||(CH=zH.forEach)===null||CH===void 0||CH.call(zH,function(TH){Gm(TH=TH.ip)&&g.context.cloudProxyServers.indexOf(TH)===-1&&(g.log("got cloud proxy server: %s",TH),g.context.cloudProxyServers.push(TH))});else if((AH==null||(vH=AH.buffer)===null||vH===void 0?void 0:vH.flag)===128){for(IH=function(TH,NH){var gH=NH[TH];aH.some(function(SN){return SN.ip===gH.ip})||aH.push({ip:gH.ip,ticket:AH.buffer.cert})},MH=0,GH=AH.buffer.edges_services;MH<GH.length;MH++)IH(MH,GH);g.context.rtmArea=(HH=(VH=AH.buffer)===null||VH===void 0||(KH=VH.detail)===null||KH===void 0?void 0:KH[9])!==null&&HH!==void 0?HH:""}return yH.abrupt("return",bb.apply(void 0,G(aH).concat([fg])));case 19:case"end":return yH.stop()}},dN)}));return function(dN){return cN.apply(this,arguments)}}()),Ga(function(cN){return sa(cN)?Z(cN):vb}),tg(),wb(function(cN){return cN!==void 0&&typeof cN.ip=="string"&&typeof cN.ticket=="string"}))}),m(n(g),"fetchAp",function(C,A){var x=Ai("AP-",g.loggerId);g.log("The AccessPoint requests %s(%s)",C,x);var _e=new AbortController;return g.apFinish$.pipe(Ka(1)).subscribe(function(){return _e.abort()}),ad(J(w.mark(function cN(){var dN;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:return dN=Ag(0,Number.MAX_SAFE_INTEGER),g.log("%s request opid: %d",x,dN),fN.abrupt("return",te(C,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:dN,key:A||g.context.key,cname:g.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(mN){return mN===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):mN}).join(",")}),uid:0,sid:g.context.sid},signal:_e.signal}));case 3:case"end":return fN.stop()}},cN)}))).pipe(Ga(function(cN){return cN.name!=="AbortError"&&(g.logError(cN),g.warn("The AP server %s request failure",C,cN)),vb}),cb(function(){var cN=J(w.mark(function dN(fN){var mN,EN,RN,IN,t0,aH,pH;return w.wrap(function(SH){for(;;)switch(SH.prev=SH.next){case 0:if(mN=fN.responseText,EN=JSON.parse(mN),g.log("The %s response is %o",x,EN),IN=(RN=EN).code,t0=RN.addresses,aH=RN.detail,IN===0){SH.next=6;break}return SH.abrupt("return",g.handleUniLbsError(IN,C));case 6:if((pH=t0).length!==0){SH.next=11;break}return SH.abrupt("return",Z(Error("No available edge address to connect")));case 11:return g.context.rtmArea=aH==null?void 0:aH[9],SH.abrupt("return",bb.apply(void 0,G(pH).concat([fg])));case 13:case"end":return SH.stop()}},dN)}));return function(dN){return cN.apply(this,arguments)}}()),tg(),Ga(function(cN){return sa(cN)?Z(cN):vb}),wb(function(cN){return cN!==void 0&&typeof cN.ip=="string"&&typeof cN.ticket=="string"}))}),g.context=o,g.getApEdgeInfoEndFirst$=function(){var C=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,C||p?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){g.retryCount+=1}),cb(function(){return g.context.config.enableCloudProxy?g.getProxyApUrl$(C||p):(4<=g.retryCount&&(g.retryCount=0),3>=g.retryCount?g.getApUrl$(C||p):g.getBackupApUrl$(C||p))}),cb(function(A){return g.context.config.enableCloudProxy?g.fetchCloudProxy(A):g.fetchAp(A)}),Ga(function(A){return A instanceof pb&&g.warn("AP request timeout"),Z(A)}),om(function(A){return A.ip}),ob(g.apFinish$))},g.getApEdgeInfo$=function(C){return Bc(0,C||p?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){g.retryCount+=1}),cb(function(){return g.context.config.enableCloudProxy?g.getProxyApUrl$(C||p):3>=g.retryCount?g.getApUrl$(C||p):g.getBackupApUrl$(C||p)}),cb(function(A){return(g.context.config.enableCloudProxy?g.fetchCloudProxy(A):g.fetchAp(A)).pipe()}),Ga(function(A){return A instanceof pb&&g.warn("AP request timeout"),Z(A)}),om(function(A){return A.ip}),ob(g.apFinish$))},g}la(r,e);var i=ma(r);return Ha(r,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),r}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function r(o,h,p){W(this,r);var g=i.call(this,h,"Connection");m(n(g),"apClient",void 0),m(n(g),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(g),"curOpenSockets",[void 0,void 0]),m(n(g),"ipIterator",0),m(n(g),"firstEnv",.5<=Math.random()?1:0),m(n(g),"firstSocketOpener",void 0),m(n(g),"secondSocketOpener",void 0),m(n(g),"firstOpenKeeperSubject",new Pa),m(n(g),"secondOpenKeeperSubject",new Pa),m(n(g),"edgeInfoReplayed",void 0),m(n(g),"firstEnvOpenSocket",void 0),m(n(g),"firstOpenKeeperSub",void 0),m(n(g),"secondOpenKeeperSub",void 0),m(n(g),"context",void 0),m(n(g),"logger",void 0),g.context=o,g.logger=h,g.apClient=new Wr(g.context,h),g.apClient.apFinish$.subscribe(function(){g.log("Ap client fetch finished")});var C,A=[];return g.edgeInfoReplayed=g.apClient.getApEdgeInfo$(p).pipe(oe(function(x){return x.pipe(ca(function(_e){if(sa(_e))throw _e}),cd(p?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(x){return!dl(A,x)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(x){A.push(x),g.log("An edge info got %o",x)}),ca({error:function(x){g.emit("connectionInitFailure",x)}}),wg(function(){g.apClient.clearUp()}),sm()),g.firstEnvOpenSocket=g.edgeInfoReplayed.pipe(cb(function(x){if(x===void 0)return Z(Error("Invalid edge info"));var _e=new ml(x.ip,g.firstEnv,x.ticket,g.context,h,C);return g.firstEnv=g.firstEnv===1?0:1,_e.on("connectionFailure",function(){return g.onSocketConnectionFailure(_e)}),C=!_e.useNewDomain,_e.open$.pipe(qf(_e))}),ca(function(x){g.log("The websocket of ENV_%d opened to %s:%d",x.env,x.ip,af[x.env]),g.curOpenSockets[x.env]=x,g.lastOpenSockets[x.env].next(x),g.firstEnv=x.env,g.openSecondSocket(x.env,x.ip,x.useNewDomain)}),Ka(1),pe()),g.firstSocketOpener=g.firstEnvOpenSocket.pipe(cb(function(x){return x.open$.pipe(ca(function(){g.log("The websocket of first ENV_%d re-opened to %s:%d",x.env,x.ip,af[x.env]),g.curOpenSockets[x.env]=x,g.lastOpenSockets[x.env].next(x)}))})),o=g.firstOpenKeeperSubject.pipe(Cc(Yc)),g.firstOpenKeeperSub=o.subscribe({error:g.logError}),g}la(r,e);var i=ma(r);return Ha(r,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(o,h){if(![0,1].includes(o))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var p=o===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var g=this.curOpenSockets[o];this.curOpenSockets[o]=void 0,g&&(g.isActiveClose=!0,setTimeout(function(){g.close()},h)),p!==void 0&&setTimeout(function(){p==null||p.unsubscribe()},h)}},{key:"waitClosing",value:function(o){var h=this;return o.isActiveClose=!0,o.open$.pipe(tt(),Ga(function(p){return p.message===mr.normalClosureMessage?vb:Z(p)}),hb(5e3),Ga(function(p){return p instanceof pb?(h.warn("Force closing the ENV_%d connection",o.env),vb):Z(p)}))}},{key:"onSocketConnectionFailure",value:function(o){var h=[0,1].filter(function(p){return p!==o.env})[0];(h=this.curOpenSockets[h])&&h.loggedIn?this.reopenSocketWithApRequest(o.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(o,h,p){var g=this,C=o===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(A,x){return[].concat(G(A),[x])},[]),ba(function(A){return kr(A,function(x){return Jm(h,x.ip)}).slice(-1)[0]}),Ka(1),cb(function(A){if(A===void 0)return Z(Error("Invalid edge info"));var x=new ml(A.ip,C,A.ticket,g.context,g.logger,p);return x.on("connectionFailure",function(){return g.onSocketConnectionFailure(x)}),x.open$.pipe(ca(function(){g.lastOpenSockets[C].next(x),g.curOpenSockets[C]=x}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(o){var h=this,p=[0,1].filter(function(A){return A!==o})[0];if((p=this.curOpenSockets[p])!==void 0){var g,C=p.ip;p=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(A){return A.pipe(ca(function(x){if(x.code===Kh)h.emit("tokenExpired"),h.apClient.apFinish$.next(void 0);else if(sa(x))throw x}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(A){h.log("An edge info got %o",A)}),wg(function(){h.apClient.clearUp()})).pipe(rm(function(A,x){return[].concat(G(A),[x])},[]),ba(function(A){return(A=kr(A,function(x){return Jm(C,x.ip)})).length-1>=h.ipIterator?A.slice(-h.ipIterator++-1)[0]:(h.ipIterator=0,A.slice(-1)[0])}),Dd(),cb(function(A){if(A===void 0)return Z(Error("Invalid edge info"));var x=new ml(A.ip,o,A.ticket,h.context,h.logger,g);return x.on("connectionFailure",function(){return h.onSocketConnectionFailure(x)}),g=!x.useNewDomain,x.open$.pipe(qf(x))}),ca(function(A){h.log("The websocket of ENV_%d re-opened to %s:%d using ap",A.env,A.ip,af[A.env]),h.curOpenSockets[o]=A,h.lastOpenSockets[o].next(A)}),cb(function(A){return A.open$.pipe(ca(function(){h.log("The websocket of ENV_%d re-opened to %s:%d",A.env,A.ip,af[A.env]),h.curOpenSockets[o]=A,h.lastOpenSockets[o].next(A)}))}),pe()),o===this.firstEnv?this.firstOpenKeeperSubject.next(p):this.secondOpenKeeperSubject.next(p)}}}]),r}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.appId!=null&&Object.hasOwnProperty.call(r,"appId")&&i.uint32(42).string(r.appId),r.ver!=null&&Object.hasOwnProperty.call(r,"ver")&&i.uint32(50).string(r.ver),r.buildno!=null&&Object.hasOwnProperty.call(r,"buildno")&&i.uint32(56).int32(r.buildno),r.installId!=null&&Object.hasOwnProperty.call(r,"installId")&&i.uint32(66).string(r.installId),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&i.uint32(128).int32(r.os),r.did!=null&&Object.hasOwnProperty.call(r,"did")&&i.uint32(138).string(r.did),r.index!=null&&Object.hasOwnProperty.call(r,"index")&&zc.Session.CommonIndex.encode(r.index,i.uint32(162).fork()).ldelim(),r.token!=null&&Object.hasOwnProperty.call(r,"token")&&i.uint32(170).string(r.token),r.version!=null&&Object.hasOwnProperty.call(r,"version")&&i.uint32(176).int32(r.version),r.subVersion!=null&&Object.hasOwnProperty.call(r,"subVersion")&&i.uint32(184).int32(r.subVersion),i},e.CommonIndex=function(){function r(i){if(i)for(var o=Object.keys(i),h=0;h<o.length;++h)i[o[h]]!=null&&(this[o[h]]=i[o[h]])}return r.prototype.index1="",r.prototype.index2="",r.prototype.index3="",r.encode=function(i,o){return o||(o=Xc.create()),i.index1!=null&&Object.hasOwnProperty.call(i,"index1")&&o.uint32(10).string(i.index1),i.index2!=null&&Object.hasOwnProperty.call(i,"index2")&&o.uint32(18).string(i.index2),i.index3!=null&&Object.hasOwnProperty.call(i,"index3")&&o.uint32(26).string(i.index3),o},r}(),e}(),SC=zc.Link=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.ec!=null&&Object.hasOwnProperty.call(r,"ec")&&i.uint32(40).int32(r.ec),r.sc!=null&&Object.hasOwnProperty.call(r,"sc")&&i.uint32(48).int32(r.sc),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&i.uint32(58).string(r.destServerIp),r.ackedServerIp!=null&&Object.hasOwnProperty.call(r,"ackedServerIp")&&i.uint32(66).string(r.ackedServerIp),r.responseTime!=null&&Object.hasOwnProperty.call(r,"responseTime")&&i.uint32(72).int32(r.responseTime),i},e}(),TC=zc.Logout=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),i},e}(),UC=zc.KickedOff=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&i.uint32(48).int32(r.linkId),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(56).int32(r.code),r.server!=null&&Object.hasOwnProperty.call(r,"server")&&i.uint32(66).string(r.server),r.serverCode!=null&&Object.hasOwnProperty.call(r,"serverCode")&&i.uint32(72).int32(r.serverCode),i},e}(),VC=zc.ChnJoin=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&i.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&i.uint32(56).int32(r.errCode),i},e}(),WC=zc.ChnJoinRes=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&i.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&i.uint32(56).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&i.uint32(64).int32(r.serverErrCode),i},e}(),XC=zc.ChnLeave=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&i.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&i.uint32(56).int32(r.errCode),i},e}(),YC=zc.ConnectionStateChange=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.oldState!=null&&Object.hasOwnProperty.call(r,"oldState")&&i.uint32(40).int32(r.oldState),r.newState!=null&&Object.hasOwnProperty.call(r,"newState")&&i.uint32(48).int32(r.newState),r.reason!=null&&Object.hasOwnProperty.call(r,"reason")&&i.uint32(56).int32(r.reason),r.reconnId!=null&&Object.hasOwnProperty.call(r,"reconnId")&&i.uint32(64).int32(r.reconnId),i},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function r(o,h,p){return W(this,r),m(n(p=i.call(this,p,"Context")),"_token",void 0),m(n(p),"config",void 0),m(n(p),"_uid",void 0),m(n(p),"_sid",void 0),m(n(p),"_area","CN"),m(n(p),"appId",void 0),m(n(p),"enableCloudProxy",!1),m(n(p),"cloudProxyServers",[]),p.appId=o,p.config=h,p}la(r,e);var i=ma(r);return Ha(r,[{key:"token",set:function(o){this._token=typeof o=="string"&&o?o:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(o){if(this.log("The user ID is set to %s",oa(o)),!za(o))throw new Ia;this._uid=o}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(o){if(this.log("sid is set to %s",o),typeof o!="string"||!o)throw new Ia;this._sid=o}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(o){this.log("area is set to %s",o),typeof o=="string"&&o?this._area=o:this.warn("set area failed")}}]),r}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var r=kd(this,mc("Promise")),i=typeof e=="function";return this.then(i?function(o){return mj(r,e()).then(function(){return o})}:e,i?function(o){return mj(r,e()).then(function(){throw o})}:e)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark(function r(i){return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.t0=Uint8Array,o.next=3,crypto.subtle.digest("SHA-256",i);case 3:return o.t1=o.sent,o.abrupt("return",new o.t0(o.t1));case 5:case"end":return o.stop()}},r)}));return function(r){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map(function(r){return r.toString(16).padStart(2,"0")}).join("")},bD=function(e){if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var r=new Uint8Array(e.length/2),i=0;i<e.length;i+=2)r[i/2]=parseInt(e.substring(i,i+2),16);return r},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark(function r(i){var o;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,crypto.subtle.digest("SHA-1",i);case 3:o=h.sent,h.next=9;break;case 6:h.prev=6,h.t0=h.catch(0),o=sha1.arrayBuffer(i);case 9:return h.abrupt("return",as(new Uint8Array(o)));case 10:case"end":return h.stop()}},r,null,[[0,6]])}));return function(r){return e.apply(this,arguments)}}(),cs=function(e,r,i,o){o[r]=!0,i.has(e)?i.get(e).add(r):i.set(e,new Set([r]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function r(o,h,p,g){W(this,r);var C=i.call(this,p,"ChunkDownloadManager");if(m(n(C),"abortController",new AbortController),m(n(C),"downloadedSize",0),m(n(C),"successCount",0),m(n(C),"timer",void 0),m(n(C),"chunks",[]),m(n(C),"retUnit",void 0),m(n(C),"singleThread",!1),m(n(C),"initialized",!1),m(n(C),"ee",void 0),m(n(C),"chunkCount",void 0),m(n(C),"aborted",!1),m(n(C),"serverToIndices",new Map),m(n(C),"backupToIndices",new Map),m(n(C),"indexToBackupServers",[]),m(n(C),"busyBackupServers",new Map),m(n(C),"downloadingChunks",new Set),m(n(C),"metaInfo",void 0),m(n(C),"transHandler",void 0),C.metaInfo=o,C.transHandler=h,C.ee=g===void 0?new ea:g,p=o.size,o=o.unit,p===0)throw new Ia("size cannot be 0");return h.cancelSignal!==void 0&&h.cancelSignal.addEventListener("abort",function(){C.abortController.abort()},{once:!0}),C.abortController.signal.addEventListener("abort",function(){C.aborted=!0},{once:!0}),C.chunkCount=Math.ceil(p/(32768*o)),C}la(r,e);var i=ma(r);return Ha(r,[{key:"setInfoByResponse",value:function(o){var h=this,p=o.serverList,g=o.backupList;if(o=o.unit,p.length<this.chunkCount&&g.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var C=Array(this.chunkCount).fill(!1);if(p.forEach(function(A,x){return A.forEach(function(_e){return cs(_e,x,h.serverToIndices,C)})}),g.forEach(function(A,x){return A.forEach(function(_e){return cs(_e,x,h.backupToIndices,C)})}),C.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=g.map(function(A){return new Set(A)}),this.retUnit=o}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(o){var h=this,p=this.downloadedSize+o;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=p,this.timer!==void 0&&o!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){h.ee.emit("timedOut"),h.abortController.abort()},12e4)),this.initialized&&o===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var o=0,h=0,p=this.chunks;h<p.length;h++)o+=p[h].byteLength;if(o!==this.metaInfo.size)throw new Ia("invalid chunks total size");o=new Uint8Array(o),p=h=0;for(var g=this.chunks;p<g.length;p++){var C=g[p];o.set(new Uint8Array(C),h),h+=C.byteLength}return h=Array.from(o.subarray(0,4)).map(function(A){return A.toString(16)}).join("").toUpperCase(),Zt(o.buffer,cD(h))}},{key:"getDownloadUrl",value:function(o){var h=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(o).split(".").join("-"),".edge.").concat(h,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var o=J(w.mark(function h(p){var g,C=this,A=arguments;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return g=1<A.length&&A[1]!==void 0&&A[1],x.next=3,Promise.all(Array.from(p.entries()).map(function(_e){return _e=ra(_e,2),C.postDownloadRequest(_e[0],Array.from(_e[1]),g).catch(function(cN){cN.statusCode===404?(C.ee.emit("notExist"),C.abortController.abort()):cN.name!=="AbortError"&&(Sa(cN)?C.singleThread?(C.abortController.abort(),C.ee.emit("timedOut")):(C.warn("%d download timed out after %d, retrying use single thread",cN.index,C.singleThread?6e4:3e4),C.abortController.abort(),C.singleThread=!0,C.ee.emit("multiTimeOut")):(C.ee.emit("error",cN),C.abortController.abort()))})}));case 3:case"end":return x.stop()}},h)}));return function(h){return o.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var o=J(w.mark(function h(p,g,C){var A,x,_e,cN,dN,fN,mN,EN,RN,IN=this;return w.wrap(function(t0){for(;;)switch(t0.prev=t0.next){case 0:if(RN=function(){return(RN=J(w.mark(function aH(pH){var SH,vH,AH,UH,zH,CH,HH,VH,KH;return w.wrap(function(IH){for(;;)switch(IH.prev=IH.next){case 0:if(IH.prev=0,pH!==void 0||p!==0){IH.next=5;break}throw new Ia("Invalid serverIp");case 5:SH=pH===void 0?mN.getDownloadUrl(p):pH;case 6:return mN.downloadingChunks.add(A),IH.next=9,fN(SH);case 9:return vH=IH.sent,AH=vH.responseData,mN.downloadingChunks.delete(A),IH.abrupt("return",AH);case 15:if(IH.prev=15,IH.t0=IH.catch(0),mN.downloadingChunks.delete(A),g.unshift(A),mN.metaInfo.useNewDomain=!1,IH.t0.name!=="AbortError"){IH.next=22;break}throw IH.t0;case 22:if(!Sa(IH.t0)){IH.next=25;break}throw IH.t0.index=A,IH.t0;case 25:if(UH=cN,cN+=1,!(2>UH)){IH.next=30;break}return IH.t0 instanceof Ia||mN.warn("%o, %d download failed, retrying",IH.t0,A),IH.abrupt("return",EN());case 30:if(IH.t0.statusCode!==504){IH.next=34;break}throw(zH=new db("download server timed out",{originalError:IH.t0,serverCode:504})).index=A,zH;case 34:if(!C||UH!==2||dN[0]===0){IH.next=45;break}return IH.t0 instanceof Ia||mN.warn("%d download failed, using backup: %d, %o",A,dN[0],IH.t0),IH.next=38,mN.busyBackupServers.get(dN[0]);case 38:return CH=EN(mN.getDownloadUrl(dN[0])),mN.busyBackupServers.set(dN[0],CH),IH.next=42,CH;case 42:return HH=IH.sent,mN.busyBackupServers.delete(dN[0]),IH.abrupt("return",HH);case 45:if(!(C&&2<UH&&dN[1]!==void 0&&dN[1]!==0)){IH.next=56;break}return mN.warn("%d download failed, using backup 1: %d",A,dN[1]),IH.next=49,mN.busyBackupServers.get(dN[1]);case 49:return VH=EN(mN.getDownloadUrl(dN[1])),mN.busyBackupServers.set(dN[1],VH),IH.next=53,VH;case 53:return KH=IH.sent,mN.busyBackupServers.delete(dN[1]),IH.abrupt("return",KH);case 56:throw IH.t0.index=A,IH.t0;case 58:case"end":return IH.stop()}},aH,null,[[0,15]])}))).apply(this,arguments)},EN=function(aH){return RN.apply(this,arguments)},!this.aborted){t0.next=4;break}throw new Ia("download already aborted");case 4:if((A=g.shift())!==void 0){t0.next=8;break}return this.log("%s download finished",p),t0.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){t0.next=10;break}return t0.abrupt("return");case 10:if(!this.downloadingChunks.has(A)){t0.next=13;break}return this.log("%s already downloading, return",A),t0.abrupt("return");case 13:if(this.chunks[A]===void 0){t0.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",A),t0.next=18,this.postDownloadRequest(p,g,C);case 18:return t0.abrupt("return");case 19:return x=new FormData,_e={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:A},x.append("parameter",JSON.stringify(_e)),cN=0,dN=Array.from(this.indexToBackupServers[A]),fN=function(aH){return te(aH,{body:x,signal:IN.abortController.signal,timeout:IN.singleThread?12e4:3e4},{useBinaryResponse:!0})},mN=this,t0.next=28,EN().then(function(aH){return IN.chunks[A]!==void 0?IN.log("chunk %d download duplicated",A):(IN.chunks[A]=aH,IN.log("chunk %d downloaded",A),IN.successCount+=1,IN.updateProgress(IN.chunks[A].byteLength)),IN.successCount===IN.chunkCount&&(IN.log("chunks all download"),IN.ee.emit("finished")),IN.singleThread?(IN.downloadChunks(),Promise.resolve()):IN.postDownloadRequest(p,g,C)});case 28:case"end":return t0.stop()}},h,this)}));return function(h,p,g){return o.apply(this,arguments)}}()}]),r}(tb()),es=function(e){function r(o,h,p,g){W(this,r);var C=i.call(this,p,"ChunkUploadManager");if(m(n(C),"chunkCount",0),m(n(C),"chunks",[]),m(n(C),"uploadedChunks",[]),m(n(C),"totalFailures",0),m(n(C),"timer",void 0),m(n(C),"initState","uninitialized"),m(n(C),"ee",void 0),m(n(C),"unit",0),m(n(C),"uploadedSize",0),m(n(C),"singleThread",!1),m(n(C),"abortController",new AbortController),m(n(C),"servers",[]),m(n(C),"aborted",!1),m(n(C),"metaInfo",void 0),m(n(C),"transHandler",void 0),C.metaInfo=o,C.transHandler=h,C.ee=g===void 0?new ea:g,o.file.length===0)throw new I("file not found or is empty",wf);return h.cancelSignal!==void 0&&h.cancelSignal.addEventListener("abort",function(){C.abortController.abort()},{once:!0}),C.abortController.signal.addEventListener("abort",function(){C.aborted=!0},{once:!0}),C}la(r,e);var i=ma(r);return Ha(r,[{key:"initChunks",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN=this;return w.wrap(function(dN){for(;;)switch(dN.prev=dN.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){dN.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=p,g=this.sliceFile(p,this.metaInfo.file),this.chunkCount=g.length,C=[],A=function(fN,mN){var EN=(fN=ra(mN[fN],2))[0],RN=fN[1];fN=bs(RN).then(function(IN){cN.chunks[EN]={payload:RN,sha1:IN,uploadedTo:void 0,index:EN,processed:!1}}),C.push(fN)},x=0,_e=Array.from(g.entries());x<_e.length;x++)A(x,_e);return dN.next=11,Promise.all(C);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return dN.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var o=this;if(!this.aborted){for(var h=this.chunks.filter(function(C){return!C.processed}),p=function(C){var A=h[C],x=o.servers.filter(function(cN){return!cN.isUploading}).sort(function(cN,dN){return cN.successCount-dN.successCount}).sort(function(cN,dN){return cN.failureCount-dN.failureCount})[0];if(x===void 0||1<x.failureCount)return o.log("Upload server not available, waiting"),o.ee.emit("serverUsedUp"),Om(1e3).then(function(){o.totalFailures>2*o.chunkCount&&o.ee.emit("error"),o.totalFailures+=1,x!==void 0&&(x.failureCount=0),o.uploadToServers()}).catch(function(){}),"break";A.processed=!0,x.isUploading=!0,o.log("uploading chunk %d to server %s",A.index,Dg(x.ip));var _e=o.getUploadUrl(x.ip);return J(w.mark(function cN(){var dN;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:return fN.prev=0,fN.next=3,o.postChunk(A.payload,_e,A.index);case 3:dN=o.chunks.findIndex(function(mN){return mN===A}),A.uploadedTo=x.ip,o.chunks.splice(dN,1),o.uploadedChunks.push(A),x.successCount+=1,x.isUploading=!1,o.updateProgress(A.payload.byteLength),o.log("upload chunk %d successfully",A.index),fN.next=31;break;case 13:if(fN.prev=13,fN.t0=fN.catch(0),x.isUploading=!1,A.processed=!1,fN.t0.statusCode!==504&&!Sa(fN.t0)){fN.next=27;break}if(o.singleThread){fN.next=24;break}return o.warn("%d upload timed out after %d, retrying use single thread",A.index,o.singleThread?12e4:3e4),o.abortController.abort(),o.singleThread=!0,o.ee.emit("multiTimeOut"),fN.abrupt("return");case 24:return o.ee.emit("timedOut"),o.abortController.abort(),fN.abrupt("return");case 27:return o.metaInfo.useNewDomain=!1,x.failureCount+=1,fN.next=31,Om(1e3);case 31:o.uploadedChunks.length===o.chunkCount?(o.log("chunks uploaded"),o.ee.emit("finished")):(o.singleThread||o.chunks.filter(function(mN){return!mN.processed}).length===1)&&o.uploadToServers();case 32:case"end":return fN.stop()}},cN,null,[[0,13]])}))(),o.singleThread?"break":void 0},g=0;g<h.length&&p(g)!=="break";g++);h.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var o=!0,h=[],p=G(this.uploadedChunks).sort(function(A,x){return A.index-x.index}),g=0;for(p=Array.from(p.values());g<p.length;g++){var C=p[g].uploadedTo;if(C===void 0){o=!1;break}h.push(C)}if(!o)throw new Ia("some chunks not uploaded, cannot get upload server ips");return h}},{key:"addServers",value:function(o){var h=this;o.forEach(function(p){var g=h.servers.findIndex(function(C){return C.ip===p});g!==-1?h.servers[g].failureCount=0:(h.log("server %s added",Dg(p)),h.servers.push({successCount:0,isUploading:!1,ip:p,failureCount:0}))})}},{key:"updateProgress",value:function(o){var h=this,p=o!==void 0?this.uploadedSize+o:this.metaInfo.file.length;p>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=p,this.timer!==void 0&&o!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&o!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){h.ee.emit("timedOut"),h.abortController.abort()},12e4)),this.initState==="initialized"&&o===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(o,h){var p=0,g=[],C=h.length;for(o*=32768;p<C;)g.push(h.slice(p,p+o)),p+=o;return this.log("chunks split into %d",g.length),g}},{key:"postChunk",value:function(){var o=J(w.mark(function h(p,g,C){var A,x,_e,cN,dN,fN,mN,EN;return w.wrap(function(RN){for(;;)switch(RN.prev=RN.next){case 0:if(!this.aborted){RN.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){RN.next=4;break}throw new Ia("unit is undefined");case 4:return A=this.metaInfo,x=A.ticket,_e=A.instance,cN=A.loginOpt,dN=A.hashStr,RN.t0=C,RN.t1=dN,RN.next=9,bs(p);case 9:return RN.t2=RN.sent,RN.t3=this.unit,RN.t4=x,RN.t5=_e,RN.t6=cN,fN={index:RN.t0,hash:RN.t1,sha1:RN.t2,unit:RN.t3,ticket:RN.t4,instance:RN.t5,loginOpt:RN.t6},(mN=new FormData).append("parameter",JSON.stringify(fN)),mN.append("payload",new Blob([p])),RN.next=20,te(g,{headers:{Accept:"application/json"},body:mN,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(EN=RN.sent,EN.status===201){RN.next=24;break}throw new da("uploading chunk ".concat(C," failed"));case 24:case"end":return RN.stop()}},h,this)}));return function(h,p,g){return o.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(o){var h=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(o).split(".").join("-"),".edge.").concat(h,":9601/api/v1/chuck/upload")}}]),r}(tb()),fs=function(e){function r(o){W(this,r);var h=i.call(this,o,"MediaTaskManager");return m(n(h),"isProcessing",!1),m(n(h),"authInfo",void 0),m(n(h),"taskFinishers",{}),m(n(h),"mediaTasks",new Map),m(n(h),"ongoingTask",void 0),h.on("connectionStateChanged",function(p){if(p===S.ConnectionState.ABORTED||p===S.ConnectionState.DISCONNECTED){h.ongoingTask!==void 0&&h.cancelTask(h.ongoingTask),p=0;for(var g=Array.from(h.mediaTasks.entries());p<g.length;p++){var C=ra(g[p],2)[1];h.cancelTask(C)}h.mediaTasks.clear(),h.taskFinishers={}}else p===S.ConnectionState.RECONNECTING?h.ongoingTask!==void 0&&h.ongoingTask.manager.abortController.abort():p===S.ConnectionState.CONNECTED&&h.ongoingTask!==void 0&&h.ongoingTask.manager.ee.emit("reconnected")}),h}la(r,e);var i=ma(r);return Ha(r,[{key:"setAuthInfo",value:function(o){this.authInfo=o}},{key:"waitMediaTask",value:function(o){var h=this;return new Promise(function(p,g){h.taskFinishers[o]={resolve:p,reject:g},h.isProcessing||h.processMediaTask()}).finally(function(){h.ongoingTask!==void 0&&h.ongoingTask.manager.timer!==void 0&&clearTimeout(h.ongoingTask.manager.timer),delete h.taskFinishers[o],h.mediaTasks.size!==0?h.processMediaTask():h.isProcessing=!1})}},{key:"addUploadTask",value:function(o,h,p,g){var C=o.file;if(o=o.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=r.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return g=new es({hashStr:as(o),file:C,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},g,this.logger),C=Ud(),this.mediaTasks.set(C,{type:"UPLOAD",manager:g,hash:o,setter:p,fetcher:h,taskId:C}),C}},{key:"addDownloadTask",value:function(o,h,p){var g=o.hashHexStr,C=o.size,A=o.unit;if(o=o.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=r.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return p=new ds({hashHexStr:g,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:C,zone:o,unit:A},p,this.logger),g=Ud(),this.mediaTasks.set(g,{type:"DOWNLOAD",manager:p,fetcher:h,taskId:g}),g}},{key:"doDownloadTaskImpl",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN,mN,EN=this,RN=arguments;return w.wrap(function(IN){for(;;)switch(IN.prev=IN.next){case 0:return C=2<RN.length&&RN[2]!==void 0&&RN[2],x=A=p.manager,C&&(A=new ds(x.metaInfo,x.transHandler,this.logger,x.ee)),_e=p.fetcher,IN.next=7,_e();case 7:if(cN=IN.sent,dN=cN.serverList,fN=cN.backupList,mN=cN.unit,!C||mN===x.retUnit){IN.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:C&&(p.manager=A,A.downloadedSize=x.downloadedSize,A.successCount=x.successCount,A.timer=x.timer,A.chunks=x.chunks,A.initialized=x.initialized,A.singleThread=x.singleThread,A.updateProgress(0)),A.ee.once("reconnected",function(){A.ee.removeAllListeners(),EN.doDownloadTaskImpl(p,g,!0).catch(function(t0){g.reject(t0)})}),A.ee.once("multiTimeOut",function(){A.ee.removeAllListeners(),EN.doDownloadTaskImpl(p,g,!0).catch(function(t0){g.reject(t0)})}),A.ee.once("error",function(t0){A.ee.removeAllListeners(),g.reject(new da(["download file file, index %d",t0.index],{code:mg,originalError:t0}))}),A.ee.once("notExist",function(){A.abortController.abort(),A.ee.removeAllListeners(),g.reject(new da("download file not found",AA))}),A.ee.once("timedOut",function(){A.ee.removeAllListeners(),A.abortController.abort(),g.reject(new db("download timed out",zA))}),A.transHandler.cancelSignal!==void 0&&A.transHandler.cancelSignal.addEventListener("abort",function(){g.reject(new hl("Downloading canceled",ir))},{once:!0}),A.ee.once("finished",function(){g.resolve({type:"DOWNLOAD",payload:A.getPayload()})}),A.setInfoByResponse({serverList:dN,backupList:fN,unit:mN}),A.downloadChunks();case 23:case"end":return IN.stop()}},h,this)}));return function(h,p){return o.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(o,h){var p=this,g=2<arguments.length&&arguments[2]!==void 0&&arguments[2],C=o.taskId;return g||(this.mediaTasks.delete(C),this.ongoingTask=o),new Promise(function(A,x){p.doDownloadTaskImpl(o,h,g).then(A).catch(x)})}},{key:"doUploadTaskImpl",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN,mN,EN,RN=this,IN=arguments;return w.wrap(function(t0){for(;;)switch(t0.prev=t0.next){case 0:return C=2<IN.length&&IN[2]!==void 0&&IN[2],x=A=p.manager,C&&(A=new es(x.metaInfo,x.transHandler,this.logger,x.ee)),_e=p.fetcher,cN=new Pa,fN=new Promise(function(aH,pH){var SH=_e(),vH=SH.ret,AH=SH.err,UH=SH.timeout;SH.fin.pipe(ob(cN)).subscribe({next:function(zH){g.resolve({type:"UPLOAD",retUnit:zH.unit,zone:zH.zone})},complete:function(){aH({hasExist:!0}),cN.next(),cN.complete()}}),vH.pipe(ob(cN),cb(function(){var zH=J(w.mark(function CH(HH){var VH,KH;return w.wrap(function(IH){for(;;)switch(IH.prev=IH.next){case 0:if(VH=HH.servers,KH=HH.unit,C&&x.unit!==KH?g.reject(new da("upload unit is different, reject to continue",lg)):C&&(p.manager=A,A.chunkCount=x.chunkCount,A.chunks=x.chunks,A.totalFailures=x.totalFailures,A.uploadedChunks=x.uploadedChunks,A.timer=x.timer,A.initState=x.initState,A.unit=x.unit,A.uploadedSize=x.uploadedSize,A.singleThread=x.singleThread,A.updateProgress(0)),A.addServers(VH),A.initState!=="uninitialized"){IH.next=7;break}return dN=A.initChunks(KH),IH.next=7,dN;case 7:case"end":return IH.stop()}},CH)}));return function(CH){return zH.apply(this,arguments)}}())).subscribe({complete:function(){return aH({hasExist:!1})},error:pH}),SH=function(zH){A.initState!=="uninitialized"&&dN?aH(dN.then(function(){return{hasExist:!1}})):pH(zH)},AH.pipe(ob(cN)).subscribe({error:SH}),UH.pipe(ob(cN)).subscribe({error:SH})}),t0.next=9,fN;case 9:if(mN=t0.sent,!mN.hasExist){t0.next=15;break}return A.updateProgress(),this.log("file already exists, skipping upload"),t0.abrupt("return");case 15:cN.next(),cN.complete(),this.log("chunks initialization promise resolved"),EN=gb(A.ee,"serverUsedUp").pipe(Gt(function(){return A.chunkCount!==A.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return _e().ret})).subscribe(function(aH){A.addServers(aH.servers)}),A.ee.once("reconnected",function(){A.ee.removeAllListeners(),RN.doUploadTask(p,g,!0).catch(function(aH){g.reject(aH)})}),A.ee.once("multiTimeOut",function(){A.ee.removeAllListeners(),RN.doUploadTask(p,g,!0).catch(function(aH){g.reject(aH)})}),A.ee.once("timedOut",function(){EN.unsubscribe(),A.ee.removeAllListeners(),A.abortController.abort(),g.reject(new db("upload timed out",Lh))}),A.ee.once("error",function(aH){EN.unsubscribe(),A.ee.removeAllListeners(),A.abortController.abort(),g.reject(aH||new da("upload error",lg))}),A.transHandler.cancelSignal!==void 0&&A.transHandler.cancelSignal.addEventListener("abort",function(){g.reject(new hl("Uploading canceled",hr))},{once:!0}),A.ee.once("finished",J(w.mark(function aH(){var pH,SH,vH;return w.wrap(function(AH){for(;;)switch(AH.prev=AH.next){case 0:return EN.unsubscribe(),AH.next=3,p.setter(A.unit,A.getUploadServerIPs());case 3:pH=AH.sent,SH=pH.zone,vH=pH.unit,A.ee.removeAllListeners(),g.resolve({type:"UPLOAD",retUnit:vH,zone:SH});case 8:case"end":return AH.stop()}},aH)}))),A.uploadToServers();case 26:case"end":return t0.stop()}},h,this)}));return function(h,p){return o.apply(this,arguments)}}()},{key:"doUploadTask",value:function(o,h){var p=this,g=2<arguments.length&&arguments[2]!==void 0&&arguments[2],C=o.taskId;return g||(this.mediaTasks.delete(C),this.ongoingTask=o),new Promise(function(A,x){p.doUploadTaskImpl(o,h,g).then(A).catch(x)})}},{key:"processMediaTask",value:function(){var o=J(w.mark(function h(){var p,g,C;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.mediaTasks.size!==0){A.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,p=this.mediaTasks.keys().next().value,(g=this.taskFinishers[p])!==void 0){A.next=7;break}throw Error("top task not found");case 7:if((C=this.mediaTasks.get(p))!==void 0){A.next=10;break}throw new Ia("task invalid");case 10:if(C.type!=="UPLOAD"){A.next=15;break}return A.next=13,this.doUploadTask(C,g).catch(function(x){C.manager.ee.removeAllListeners(),g.reject(x)});case 13:A.next=18;break;case 15:if(C.type!=="DOWNLOAD"){A.next=18;break}return A.next=18,this.doDownloadTask(C,g).catch(function(x){C.manager.ee.removeAllListeners(),g.reject(x)});case 18:case"end":return A.stop()}},h,this)}));return function(){return o.apply(this,arguments)}}()},{key:"cancelTask",value:function(o){var h=o.type==="DOWNLOAD"?ir:hr;o.manager.ee.removeAllListeners(),o.manager.abortController.abort(),this.taskFinishers[o.taskId]!==void 0&&this.taskFinishers[o.taskId].reject(new hl("User logged out or kicked off, media task canceled",h))}}]),r}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var e=0,r=arguments.length,i=new(Ne(this))(r);r>e;)i[e]=arguments[e++];return i},Dj);var gs=1/0,dD=Math.max,ju=function(e,r,i){var o=Object(e);if(!Ed(e)){var h=Te(r);e=Ad(e),r=function(p){return h(o[p],p,o)}}return-1<(r=function(p,g,C){var A=p==null?0:p.length;if(!A)return-1;if(C==null)C=0;else{var x=(C=C?(C=gl(C))===gs||C===-1/0?17976931348623157e292*(0>C?-1:1):C==C?C:0:C===0?C:0)%1;C=C==C?x?C-x:C:0}return 0>C&&(C=dD(A+C,0)),Xp(p,Te(g),C)}(e,r,i))?o[h?e[r]:r]:void 0},iu=function(e,r){return e&&e.length?vk(e,void 0,typeof r=="function"?r:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(r,i,o){if(this.size+=o,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(i={val:0,isNumber:i==="number",isBoolean:i==="boolean",oneof:i==="number"||i==="boolean"?void 0:i,len:o}),this.fields.set(r,i)}},{key:"set",value:function(r,i){if(!(r=this.fields.get(r)))throw Error("field not found");var o=r.oneof;if(!U.isLong(i)&&typeof i!="number")if(typeof i=="boolean")i=i?1:0;else{if(o===void 0)throw Error("invalid field type");if((i=o[i])===void 0)throw Error("field type not found")}Mg(r,i),r.val=i}},{key:"toNumber",value:function(){for(var r=0,i=0,o=0,h=Array.from(this.fields);o<h.length;o++){var p=ra(h[o],2)[1],g=p.len;(p=p.val)!==void 0&&(r+=U.fromValue(p).shiftLeft(i).toNumber(),i+=g)}return r}},{key:"toLong",value:function(){for(var r=U.fromNumber(0,!0),i=0,o=0,h=Array.from(this.fields);o<h.length;o++){var p=ra(h[o],2)[1],g=p.len;(p=p.val)!==void 0&&(r=U.fromValue(p).shiftLeft(i).add(r),i+=g)}return r}},{key:"assert",value:function(r,i){function o(g){if(!U.isLong(g)&&typeof g!="number")if(typeof g=="boolean")g=g?1:0;else{if(p===void 0)throw Error("invalid field type");if((g=p[g])===void 0)throw Error("field type not found")}return Mg(h,g),Lg(g,h.val)}var h=this.fields.get(r);if(!h)throw Error("field not found");var p=h.oneof;if(!Array.isArray(i))return o(i);if(i.length===1)return o(i[0]);if(i.every(function(g){return typeof g=="string"})&&p!==void 0)return i.some(function(g){return o(g)});throw Error("invalid valueTypes")}},{key:"from",value:function(r){r=U.fromValue(r);for(var i=0,o=0,h=Array.from(this.fields);o<h.length;o++){var p=ra(h[o],2)[1],g=p.len,C=U.fromNumber(Math.pow(2,g)-1,!0).shiftLeft(i);Mg(p,C=r.and(C).shiftRightUnsigned(i)),p.val=C,i+=g}}},{key:"typeOf",value:function(r){if((r=this.fields.get(r))!==void 0){var i=r.oneof;if(r=r.val,i!==void 0){var o=0;for(i=Object.entries(i);o<i.length;o++){var h=ra(i[o],2),p=h[0];if(Lg(r,h[1]))return p}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function r(o){W(this,r);var h=i.call(this);return h.define("Rejoin","boolean",1),h.define("Unused","number",31),h.define("Platform","number",8),h.define("Version","number",12),h.define("Subversion","number",12),h.set("Platform",7),h.set("Version",4),h.set("Subversion",203),h.set("Rejoin",o),h}la(r,e);var i=ma(r);return r}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function r(o){W(this,r);var h=i.call(this);if(h.define("MessageType",fD,8),h.define("BroadcastJumps","number",2),h.define("ToCache","boolean",1),h.define("FromCache","boolean",1),h.define("CompressionMethod",gD,2),h.define("IterationNumber","number",4),h.define("BufferedMessage","boolean",1),h.define("ToArchive","boolean",1),h.define("FromArchive","boolean",1),typeof o=="number"||U.isLong(o))h.from(o);else if(o!==void 0){var p=0;for(o=Hg(o);p<o.length;p++){var g=ra(o[p],2);h.set(g[0],g[1])}}return h}la(r,e);var i=ma(r);return Ha(r,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(o){var h=this;return o!==void 0?this.assert("MessageType",o):xf(js).some(function(p){return h.assert("MessageType",p)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),r}(hs),hD=function(e){function r(o){return W(this,r),m(n(o=i.call(this,o,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),o}la(r,e);var i=ma(r);return Ha(r,[{key:"getChatInfo",value:function(o){var h=this.dialogueLru.get(o);if(this.dialogueLru.prune(),h){var p=h.dialogue,g={dialogue:p,sequence:h=h.sequence.add(1)};return this.dialogueLru.set(o,{dialogue:p,sequence:h}),g}return p={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(o,p),p}}]),r}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(e,r){var i,o=v.bin.readUshort,h=v.bin.readUint,p={};for(i=(e=new Uint8Array(e)).length-4;h(e,i)!=101010256;)i--;var g=o(e,i=i+4+4);o(e,i+=2),h(e,i+=2),i=h(e,i+=4);for(var C=0;C<g;C++){h(e,i),i+=4,i+=4,i+=4,h(e,i+=4);var A=h(e,i+=4),x=h(e,i+=4),_e=o(e,i+=4),cN=o(e,i+2),dN=o(e,i+4);i+=6;var fN=h(e,i+=8);i+=4,i+=_e+cN+dN,v._readLocal(e,fN,p,A,x,r)}return p},v._readLocal=function(e,r,i,o,h,p){var g=v.bin.readUshort,C=v.bin.readUint;C(e,r),g(e,r+=4),g(e,r+=2);var A=g(e,r+=2);C(e,r+=2),C(e,r+=4),C=g(e,r=r+4+8);var x=g(e,r+=2);if(r+=2,g=v.bin.readUTF8(e,r,C),r=r+C+x,p)i[g]={size:h,csize:o};else if(e=new Uint8Array(e.buffer,r),A==0)i[g]=new Uint8Array(e.buffer.slice(r,r+o));else{if(A!=8)throw"unknown compression method: "+A;r=new Uint8Array(h),v.inflateRaw(e,r),i[g]=r}},v.inflateRaw=function(e,r){return v.F.inflate(e,r)},v.inflate=function(e,r){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),r)},v.deflate=function(e,r){r==null&&(r={level:6});var i=0,o=new Uint8Array(50+Math.floor(1.1*e.length));return o[i]=120,o[i+1]=156,i=v.F.deflateRaw(e,o,i+2,r.level),e=v.adler(e,0,e.length),o[i+0]=e>>>24&255,o[i+1]=e>>>16&255,o[i+2]=e>>>8&255,o[i+3]=e>>>0&255,new Uint8Array(o.buffer,0,i+4)},v.deflateRaw=function(e,r){r==null&&(r={level:6});var i=new Uint8Array(50+Math.floor(1.1*e.length)),o=v.F.deflateRaw(e,i,o,r.level);return new Uint8Array(i.buffer,0,o)},v.encode=function(e,r){r==null&&(r=!1);var i,o=0,h=v.bin.writeUint,p=v.bin.writeUshort,g={};for(i in e){var C=!v._noNeed(i)&&!r,A=e[i],x=v.crc.crc(A,0,A.length);g[i]={cpr:C,usize:A.length,crc:x,file:C?v.deflateRaw(A):A}}for(i in g)o+=g[i].file.length+30+46+2*v.bin.sizeUTF8(i);for(i in e=new Uint8Array(o+22),r=0,A=[],g)x=g[i],A.push(r),r=v._writeHeader(e,r,i,x,0);for(i in o=0,C=r,g)x=g[i],A.push(r),r=v._writeHeader(e,r,i,x,1,A[o++]);return g=r-C,h(e,r,101010256),p(e,r=r+4+4,o),p(e,r+=2,o),h(e,r+=2,g),h(e,r+4,C),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(e)!=-1},v._writeHeader=function(e,r,i,o,h,p){var g=v.bin.writeUint,C=v.bin.writeUshort,A=o.file;return g(e,r,h==0?67324752:33639248),r+=4,h==1&&(r+=2),C(e,r,20),C(e,r+=2,0),C(e,r+=2,o.cpr?8:0),g(e,r+=2,0),g(e,r+=4,o.crc),g(e,r+=4,A.length),g(e,r+=4,o.usize),C(e,r+=4,v.bin.sizeUTF8(i)),C(e,r+=2,0),r+=2,h==1&&(g(e,r=r+2+2+6,p),r+=4),r+=i=v.bin.writeUTF8(e,r,i),h==0&&(e.set(A,r),r+=A.length),r},v.crc={table:function(){for(var e=new Uint32Array(256),r=0;256>r;r++){for(var i=r,o=0;8>o;o++)i=1&i?3988292384^i>>>1:i>>>1;e[r]=i}return e}(),update:function(e,r,i,o){for(var h=0;h<o;h++)e=v.crc.table[255&(e^r[i+h])]^e>>>8;return e},crc:function(e,r,i){return 4294967295^v.crc.update(4294967295,e,r,i)}},v.adler=function(e,r,i){var o=1,h=0,p=r;for(r+=i;p<r;){for(i=Math.min(p+5552,r);p<i;)h+=o+=e[p++];o%=65521,h%=65521}return h<<16|o},v.bin={readUshort:function(e,r){return e[r]|e[r+1]<<8},writeUshort:function(e,r,i){e[r]=255&i,e[r+1]=i>>8&255},readUint:function(e,r){return 16777216*e[r+3]+(e[r+2]<<16|e[r+1]<<8|e[r])},writeUint:function(e,r,i){e[r]=255&i,e[r+1]=i>>8&255,e[r+2]=i>>16&255,e[r+3]=i>>24&255},readASCII:function(e,r,i){for(var o="",h=0;h<i;h++)o+=String.fromCharCode(e[r+h]);return o},writeASCII:function(e,r,i){for(var o=0;o<i.length;o++)e[r+o]=i.charCodeAt(o)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,r,i){for(var o,h="",p=0;p<i;p++)h+="%"+v.bin.pad(e[r+p].toString(16));try{o=decodeURIComponent(h)}catch{return v.bin.readASCII(e,r,i)}return o},writeUTF8:function(e,r,i){for(var o=i.length,h=0,p=0;p<o;p++){var g=i.charCodeAt(p);if(!(4294967168&g))e[r+h]=g,h++;else if(!(4294965248&g))e[r+h]=192|g>>6,e[r+h+1]=128|g>>0&63,h+=2;else if(!(4294901760&g))e[r+h]=224|g>>12,e[r+h+1]=128|g>>6&63,e[r+h+2]=128|g>>0&63,h+=3;else{if(4292870144&g)throw"e";e[r+h]=240|g>>18,e[r+h+1]=128|g>>12&63,e[r+h+2]=128|g>>6&63,e[r+h+3]=128|g>>0&63,h+=4}}return h},sizeUTF8:function(e){for(var r=e.length,i=0,o=0;o<r;o++){var h=e.charCodeAt(o);if(!(4294967168&h))i++;else if(!(4294965248&h))i+=2;else if(!(4294901760&h))i+=3;else{if(4292870144&h)throw"e";i+=4}}return i}},v.F={},v.F.deflateRaw=function(e,r,i,o){var h=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],p=v.F.U,g=v.F._goodIndex;v.F._hash;var C=v.F._putsE,A=0;i<<=3;var x=0,_e=e.length;if(o==0){for(;A<_e;){var cN=Math.min(65535,_e-A);C(r,i,A+cN==_e?1:0),i=v.F._copyExact(e,A,cN,r,i+8),A+=cN}return i>>>3}C=p.lits,o=p.strt;var dN=p.prev,fN=0,mN=0,EN=0,RN=0,IN=0;for(2<_e&&(o[IN=v.F._hash(e,0)]=0),A=0;A<_e;A++){if(cN=IN,A+1<_e-2){IN=v.F._hash(e,A+1);var t0=A+1&32767;dN[t0]=o[IN],o[IN]=t0}if(x<=A){if((14e3<fN||26697<mN)&&100<_e-A&&(x<A&&(C[fN]=A-x,fN+=2,x=A),i=v.F._writeBlock(A==_e-1||x==_e?1:0,C,fN,RN,e,EN,A-EN,r,i),fN=mN=RN=0,EN=A),t0=0,A<_e-2&&(t0=v.F._bestMatch(e,A,dN,cN,Math.min(h[2],_e-A),h[3])),t0!=0){cN=t0>>>16,t0&=65535;var aH=g(cN,p.of0);p.lhst[257+aH]++;var pH=g(t0,p.df0);p.dhst[pH]++,RN+=p.exb[aH]+p.dxb[pH],C[fN]=cN<<23|A-x,C[fN+1]=t0<<16|aH<<8|pH,fN+=2,x=A+cN}else p.lhst[e[A]]++;mN++}}for(EN==A&&e.length!=0||(x<A&&(C[fN]=A-x,fN+=2),i=v.F._writeBlock(1,C,fN,RN,e,EN,A-EN,r,i));7&i;)i++;return i>>>3},v.F._bestMatch=function(e,r,i,o,h,p){var g=32767&r,C=i[g],A=g-C+32768&32767;if(C==g||o!=v.F._hash(e,r-A))return 0;for(var x=o=0,_e=Math.min(32767,r);A<=_e&&--p!=0&&C!=g;){if((o==0||e[r+o]==e[r+o-A])&&(g=v.F._howLong(e,r,A))>o){if(x=A,(o=g)>=h)break;A+2<g&&(g=A+2);for(var cN=0,dN=0;dN<g-2;dN++){var fN=r-A+dN+32768&32767,mN=fN-i[fN]+32768&32767;mN>cN&&(cN=mN,C=fN)}}A+=(g=C)-(C=i[g])+32768&32767}return o<<16|x},v.F._howLong=function(e,r,i){if(e[r]!=e[r-i]||e[r+1]!=e[r+1-i]||e[r+2]!=e[r+2-i])return 0;var o=r,h=Math.min(e.length,r+258);for(r+=3;r<h&&e[r]==e[r-i];)r++;return r-o},v.F._hash=function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,r,i,o,h,p,g,C,A){var x=v.F.U,_e=v.F._putsF,cN=v.F._putsE;x.lhst[256]++;var dN=v.F.getTrees(),fN=dN[0],mN=dN[1],EN=dN[2],RN=dN[3],IN=dN[4],t0=dN[5],aH=dN[6];dN=dN[7];var pH=32+(A+3&7?8-(A+3&7):0)+(g<<3),SH=o+v.F.contSize(x.fltree,x.lhst)+v.F.contSize(x.fdtree,x.dhst);o=o+v.F.contSize(x.ltree,x.lhst)+v.F.contSize(x.dtree,x.dhst),o+=14+3*t0+v.F.contSize(x.itree,x.ihst)+(2*x.ihst[16]+3*x.ihst[17]+7*x.ihst[18]);for(var vH=0;286>vH;vH++)x.lhst[vH]=0;for(vH=0;30>vH;vH++)x.dhst[vH]=0;for(vH=0;19>vH;vH++)x.ihst[vH]=0;if(pH=pH<SH&&pH<o?0:SH<o?1:2,_e(C,A,e),_e(C,A+1,pH),A+=3,pH==0){for(;7&A;)A++;A=v.F._copyExact(h,p,g,C,A)}else{if(pH==1)var AH=x.fltree,UH=x.fdtree;if(pH==2){for(v.F.makeCodes(x.ltree,fN),v.F.revCodes(x.ltree,fN),v.F.makeCodes(x.dtree,mN),v.F.revCodes(x.dtree,mN),v.F.makeCodes(x.itree,EN),v.F.revCodes(x.itree,EN),AH=x.ltree,UH=x.dtree,cN(C,A,RN-257),cN(C,A+=5,IN-1),cN(C,A+=5,t0-4),A+=4,e=0;e<t0;e++)cN(C,A+3*e,x.itree[1+(x.ordr[e]<<1)]);A=v.F._codeTiny(aH,x.itree,C,A+3*t0),A=v.F._codeTiny(dN,x.itree,C,A)}for(t0=0;t0<i;t0+=2){for(aH=(e=r[t0])>>>23,e=p+(8388607&e);p<e;)A=v.F._writeLit(h[p++],AH,C,A);aH!=0&&(e=(fN=r[t0+1])>>16,g=fN>>8&255,fN&=255,cN(C,A=v.F._writeLit(257+g,AH,C,A),aH-x.of0[g]),A+=x.exb[g],_e(C,A=v.F._writeLit(fN,UH,C,A),e-x.df0[fN]),A+=x.dxb[fN],p+=aH)}A=v.F._writeLit(256,AH,C,A)}return A},v.F._copyExact=function(e,r,i,o,h){var p=h>>>3;return o[p]=i,o[p+1]=i>>>8,o[p+2]=255-o[p],o[p+3]=255-o[p+1],p+=4,o.set(new Uint8Array(e.buffer,r,i),p),h+(i+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,r=v.F._hufTree(e.lhst,e.ltree,15),i=v.F._hufTree(e.dhst,e.dtree,15),o=[],h=v.F._lenCodes(e.ltree,o),p=[],g=v.F._lenCodes(e.dtree,p),C=0;C<o.length;C+=2)e.ihst[o[C]]++;for(C=0;C<p.length;C+=2)e.ihst[p[C]]++;C=v.F._hufTree(e.ihst,e.itree,7);for(var A=19;4<A&&e.itree[1+(e.ordr[A-1]<<1)]==0;)A--;return[r,i,C,h,g,A,o,p]},v.F.getSecond=function(e){for(var r=[],i=0;i<e.length;i+=2)r.push(e[i+1]);return r},v.F.nonZero=function(e){for(var r="",i=0;i<e.length;i+=2)e[i+1]!=0&&(r+=(i>>1)+",");return r},v.F.contSize=function(e,r){for(var i=0,o=0;o<r.length;o++)i+=r[o]*e[1+(o<<1)];return i},v.F._codeTiny=function(e,r,i,o){for(var h=0;h<e.length;h+=2){var p=e[h],g=e[h+1];o=v.F._writeLit(p,r,i,o);var C=p==16?2:p==17?3:7;15<p&&(v.F._putsE(i,o,g,C),o+=C)}return o},v.F._lenCodes=function(e,r){for(var i=e.length;i!=2&&e[i-1]==0;)i-=2;for(var o=0;o<i;o+=2){var h=e[o+1],p=o+3<i?e[o+3]:-1,g=o+5<i?e[o+5]:-1,C=o==0?-1:e[o-1];if(h==0&&p==h&&g==h){for(p=o+5;p+2<i&&e[p+2]==h;)p+=2;11>(h=Math.min(p+1-o>>>1,138))?r.push(17,h-3):r.push(18,h-11),o+=2*h-2}else if(h==C&&p==h&&g==h){for(p=o+5;p+2<i&&e[p+2]==h;)p+=2;h=Math.min(p+1-o>>>1,6),r.push(16,h-3),o+=2*h-2}else r.push(h,0)}return i>>>1},v.F._hufTree=function(e,r,i){var o=[],h=e.length,p=r.length,g=0;for(g=0;g<p;g+=2)r[g]=0,r[g+1]=0;for(g=0;g<h;g++)e[g]!=0&&o.push({lit:g,f:e[g]});if(e=o.length,h=o.slice(0),e==0)return 0;if(e==1)return r[1+((i=o[0].lit)<<1)]=1,r[1+((i==0?1:0)<<1)]=1;o.sort(function(_e,cN){return _e.f-cN.f}),g=o[0],p=o[1];var C=0,A=1,x=2;for(o[0]={lit:-1,f:g.f+p.f,l:g,r:p,d:0};A!=e-1;)g=C!=A&&(x==e||o[C].f<o[x].f)?o[C++]:o[x++],p=C!=A&&(x==e||o[C].f<o[x].f)?o[C++]:o[x++],o[A++]={lit:-1,f:g.f+p.f,l:g,r:p};for((o=v.F.setDepth(o[A-1],0))>i&&(v.F.restrictDepth(h,i,o),o=i),g=0;g<e;g++)r[1+(h[g].lit<<1)]=h[g].d;return o},v.F.setDepth=function(e,r){return e.lit!=-1?e.d=r:Math.max(v.F.setDepth(e.l,r+1),v.F.setDepth(e.r,r+1))},v.F.restrictDepth=function(e,r,i){var o=0,h=1<<i-r,p=0;for(e.sort(function(C,A){return A.d==C.d?C.f-A.f:A.d-C.d}),o=0;o<e.length&&e[o].d>r;o++){var g=e[o].d;e[o].d=r,p+=h-(1<<i-g)}for(p>>>=i-r;0<p;)(g=e[o].d)<r?(e[o].d++,p-=1<<r-g-1):o++;for(;0<=o;o--)e[o].d==r&&0>p&&(e[o].d--,p++);p!=0&&console.log("debt left")},v.F._goodIndex=function(e,r){var i=0;return r[16|i]<=e&&(i|=16),r[8|i]<=e&&(i|=8),r[4|i]<=e&&(i|=4),r[2|i]<=e&&(i|=2),r[1|i]<=e&&(i|=1),i},v.F._writeLit=function(e,r,i,o){return v.F._putsF(i,o,r[e<<1]),o+r[1+(e<<1)]},v.F.inflate=function(e,r){var i=Uint8Array;if(e[0]==3&&e[1]==0)return r||new i(0);var o=v.F,h=o._bitsF,p=o._bitsE,g=o._decodeTiny,C=o.makeCodes,A=o.codes2map,x=o._get17,_e=o.U,cN=r==null;cN&&(r=new i(e.length>>>2<<3));for(var dN,fN,mN,EN,RN=0,IN=0,t0=fN=0,aH=0;RN==0;)if(RN=h(e,aH,1),dN=h(e,aH+1,2),aH+=3,dN==0)7&aH&&(aH+=8-(7&aH)),dN=e[(aH=4+(aH>>>3))-4]|e[aH-3]<<8,cN&&(r=v.F._check(r,t0+dN)),r.set(new i(e.buffer,e.byteOffset+aH,dN),t0),aH=aH+dN<<3,t0+=dN;else{if(cN&&(r=v.F._check(r,t0+131072)),dN==1&&(mN=_e.flmap,EN=_e.fdmap,IN=511,fN=31),dN==2){for(fN=p(e,aH,5)+257,dN=p(e,aH+5,5)+1,mN=p(e,aH+10,4)+4,aH+=14,EN=0;38>EN;EN+=2)_e.itree[EN]=0,_e.itree[EN+1]=0;for(IN=1,EN=0;EN<mN;EN++){var pH=p(e,aH+3*EN,3);_e.itree[1+(_e.ordr[EN]<<1)]=pH,pH>IN&&(IN=pH)}aH+=3*mN,C(_e.itree,IN),A(_e.itree,IN,_e.imap),mN=_e.lmap,EN=_e.dmap,aH=g(_e.imap,(1<<IN)-1,fN+dN,e,aH,_e.ttree),IN=(1<<(pH=o._copyOut(_e.ttree,0,fN,_e.ltree)))-1,fN=(1<<(dN=o._copyOut(_e.ttree,fN,dN,_e.dtree)))-1,C(_e.ltree,pH),A(_e.ltree,pH,mN),C(_e.dtree,dN),A(_e.dtree,dN,EN)}for(;;)if(aH+=15&(dN=mN[x(e,aH)&IN]),(pH=dN>>>4)>>>8==0)r[t0++]=pH;else{if(pH==256)break;dN=t0+pH-254,264<pH&&(dN=t0+((pH=_e.ldef[pH-257])>>>3)+p(e,aH,7&pH),aH+=7&pH),aH+=15&(pH=EN[x(e,aH)&fN]);var SH=((pH=_e.ddef[pH>>>4])>>>4)+h(e,aH,15&pH);for(aH+=15&pH,cN&&(r=v.F._check(r,t0+131072));t0<dN;)r[t0]=r[t0++-SH],r[t0]=r[t0++-SH],r[t0]=r[t0++-SH],r[t0]=r[t0++-SH];t0=dN}}return r.length==t0?r:r.slice(0,t0)},v.F._check=function(e,r){var i=e.length;return r<=i?e:((r=new Uint8Array(Math.max(i<<1,r))).set(e,0),r)},v.F._decodeTiny=function(e,r,i,o,h,p){for(var g=v.F._bitsE,C=v.F._get17,A=0;A<i;){var x=e[C(o,h)&r];h+=15&x;var _e=x>>>4;if(15>=_e)p[A]=_e,A++;else{var cN=x=0;for(_e==16?(cN=3+g(o,h,2),h+=2,x=p[A-1]):_e==17?(cN=3+g(o,h,3),h+=3):_e==18&&(cN=11+g(o,h,7),h+=7),_e=A+cN;A<_e;)p[A]=x,A++}}return h},v.F._copyOut=function(e,r,i,o){for(var h=0,p=0,g=o.length>>>1;p<i;){var C=e[p+r];o[p<<1]=0,o[1+(p<<1)]=C,C>h&&(h=C),p++}for(;p<g;)o[p<<1]=0,o[1+(p<<1)]=0,p++;return h},v.F.makeCodes=function(e,r){var i,o,h=v.F.U,p=e.length,g=h.bl_count;for(i=0;i<=r;i++)g[i]=0;for(i=1;i<p;i+=2)g[e[i]]++;for(h=h.next_code,i=0,g[0]=0,o=1;o<=r;o++)i=i+g[o-1]<<1,h[o]=i;for(r=0;r<p;r+=2)(g=e[r+1])!=0&&(e[r]=h[g],h[g]++)},v.F.codes2map=function(e,r,i){for(var o=e.length,h=v.F.U.rev15,p=0;p<o;p+=2)if(e[p+1]!=0){var g=e[p+1],C=p>>1<<4|g,A=r-g;for(A=(g=e[p]<<A)+(1<<A);g!=A;)i[h[g]>>>15-r]=C,g++}},v.F.revCodes=function(e,r){for(var i=v.F.U.rev15,o=15-r,h=0;h<e.length;h+=2)e[h]=i[e[h]<<r-e[h+1]]>>>o},v.F._putsE=function(e,r,i){i<<=7&r,e[r>>>=3]|=i,e[r+1]|=i>>>8},v.F._putsF=function(e,r,i){i<<=7&r,e[r>>>=3]|=i,e[r+1]|=i>>>8,e[r+2]|=i>>>16},v.F._bitsE=function(e,r,i){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<i)-1},v.F._bitsF=function(e,r,i){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<i)-1},v.F._get17=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},v.F._get25=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},v.F.U=function(){var e=Uint16Array,r=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(h,p,g){for(;p--!=0;)h.push(0,g)}for(var r=v.F.U,i=0;32768>i;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,r.rev15[i]=(o>>>16|o<<16)>>>17}for(i=0;32>i;i++)r.ldef[i]=r.of0[i]<<3|r.exb[i],r.ddef[i]=r.df0[i]<<4|r.dxb[i];e(r.fltree,144,8),e(r.fltree,112,9),e(r.fltree,24,7),e(r.fltree,8,8),v.F.makeCodes(r.fltree,9),v.F.codes2map(r.fltree,9,r.flmap),v.F.revCodes(r.fltree,9),e(r.fdtree,32,5),v.F.makeCodes(r.fdtree,5),v.F.codes2map(r.fdtree,5,r.fdmap),v.F.revCodes(r.fdtree,5),e(r.itree,19,0),e(r.ltree,286,0),e(r.dtree,30,0),e(r.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function r(o,h,p,g){W(this,r);var C=i.call(this,g,"Session");return m(n(C),"chatManager",void 0),m(n(C),"joinedChannels",new Set),m(n(C),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(C),"startTime",Date.now()),m(n(C),"seq",U.fromNumber(1,!0)),m(n(C),"userJoinOptions",new is(!1)),m(n(C),"seqSentStatuses",[!1,!1]),m(n(C),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(C),"loggedOut",!1),m(n(C),"messageSentTimes",[]),m(n(C),"curLoginSockets",[void 0,void 0]),m(n(C),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(C),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(C),"dialPendingMsgSubjectMap",new Map),m(n(C),"context",void 0),m(n(C),"connection",void 0),m(n(C),"instanceId",void 0),m(n(C),"registerSocketsFailureListener",function(){C.connection.once("socketsFailure",function(){C.log("socketsFailure, creating a new connection"),ad(function(){return C.connection.removeAllListeners(),C.connection=new Yr(C.context,C.logger,!0),C.loginHandler(15e3,!0)}).pipe(oe(function(A){return A.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(C.connection.apClient.apFinish$)).subscribe(function(){C.log("new connection connected")})}),C.connection.listenerCount("tokenExpired")===0&&C.connection.on("tokenExpired",function(){C.emit("tokenExpired")})}),C.context=o,C.connection=h,C.instanceId=p,C.chatManager=new hD(g),C.log("The instanceId is %s",C.instanceId.toString()),C}la(r,e);var i=ma(r);return Ha(r,[{key:"fetchFileUploadIndexGet",value:function(o){var h=o.hash,p=o.size;if((o=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return o.forEach(function(C){C.sendPacket("FileUploadIndexGet",{seq:g,hash:h,size:p})}),{ret:Ca.apply(void 0,G(o.map(function(C){return C.fromReceived("FileUploadIndexRet").pipe(aa(function(A){return g.eq(A.seq)}))}))),fin:Ca.apply(void 0,G(o.map(function(C){return C.fromReceived("FileUploadIndexFin").pipe(aa(function(A){return g.eq(A.seq)}))}))),err:Xb.apply(void 0,G(o.map(function(C){return C.fromReceived("FileUploadIndexErr").pipe(aa(function(A){return g.eq(A.seq)}),ba(function(A){throw new da(["The media message upload failure, code %d",A.code],lg)}))}))),timeout:r.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(o){var h=o.hash,p=o.unit,g=o.servers;if((o=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return o.forEach(function(A){A.sendPacket("FileUploadIndexSet",{seq:C,servers:g,hash:h,unit:p})}),Ca.apply(void 0,[r.genTimeoutError(Lh)].concat(G(o.map(function(A){return A.fromReceived("FileUploadIndexErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["FileUploadIndexSet failure, code %d",x.code],lg)}))})),G(o.map(function(A){return A.fromReceived("FileUploadIndexFin").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(o){var h=o.size,p=o.zone,g=o.unit,C=o.hash,A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var x=this.incGetSeq();return A.forEach(function(_e){_e.sendPacket("FileDownloadIndexGet",{seq:x,size:h,zone:p,unit:g,hash:C})}),o=Ca.apply(void 0,G(A.map(function(_e){return _e.fromReceived("FileDownloadIndexRet").pipe(aa(function(cN){return x.eq(cN.seq)}))}))).pipe(ba(function(_e){var cN=_e.backups,dN=_e.servers;return _e=ff(_e,iD),ua({backupList:cN.map(function(fN){return[fN]}),serverList:dN.map(function(fN){return[fN]})},_e)}),cd(500)),A=jm(A.map(function(_e){return _e.fromReceived("FileDownloadIndexRet").pipe(aa(function(cN){return x.eq(cN.seq)}))})),Ca(o,A.pipe(ba(function(_e){return _e.reduce(function(cN,dN){var fN=cN.backupList,mN=cN.serverList;cN=dN.backups;var EN=dN.servers;return dN=ff(dN,jD),ua({backupList:cN.map(function(RN,IN){return[RN].concat(G(fN!==void 0&&Array.isArray(fN[IN])?fN[IN]:[]))}),serverList:EN.map(function(RN,IN){return[RN].concat(G(fN!==void 0&&Array.isArray(mN[IN])?mN[IN]:[]))})},dN)},{})})),r.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var o=this,h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,p=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&p)throw new K("Already logged out, request ignored");p&&this.registerSocketsFailureListener(),this.connection.initConnection();var g=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),C=Date.now();return g.forEach(function(A,x){var _e=o.loginSocketSubs[x].login;_e!==void 0&&_e.unsubscribe(),o.loginSocketSubs[x].login=A.pipe(ca(function(cN){var dN;o.curLoginSockets[x]=cN;var fN=Date.now();eb("Link",{ackedServerIp:cN.address,destServerIp:cN.ip,ec:0,sc:0,elapse:fb(o.startTime),lts:U.fromNumber(fN),responseTime:C-fN,sid:Xa(o.instanceId),userId:o.context.uid},(dN=o.context.config.enableCloudProxy)!==null&&dN!==void 0&&dN),o.emit("userJoined",cN.env),p&&o.connection.apClient.apFinish$.next(void 0)})).subscribe(o.lastLoginSockets[x])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(g).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(A){throw sa(A)||Sa(A)?A:new da("Login failure",{code:Zq,originalError:A})}))])).pipe(Ka(1),hb(h),Ga(function(A){return A instanceof pb&&o.warn("Client login timeout"),A&&A.code===Kh&&(o.connection.emit("tokenExpired"),o.connection.apClient.apFinish$.next(void 0)),o.clearSockets(0,p),Z(A)}),ca(function(){p||o.registerSocketsFailureListener()}),wg(function(){p||o.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var o=J(w.mark(function h(){var p,g,C,A=this;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),p=this.getLoginSockets(),g=p.map(function(_e){return _e.sendPacket("UserQuit",{}),A.connection.waitClosing(_e)}),this.clearSockets(5e3),C=p.map(function(_e){return _e.env}),[0,1].filter(function(_e){return!C.includes(_e)}).forEach(function(_e){A.connection.closeSocket(_e,0)}),x.abrupt("return",Xb.apply(void 0,G(g)).toPromise());case 9:case"end":return x.stop()}},h,this)}));return function(){return o.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e=this;return w.wrap(function(cN){for(;;)switch(cN.prev=cN.next){case 0:if(this.getLoginSockets().length!==0){cN.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return C=gb(this,"channelLeft").pipe(wb(function(dN){return dN===p}),Ka(1)),A=this.incGetSeq(),(x=this.lastLoginSockets.map(function(dN){return dN.pipe(Cc(function(fN,mN){mN!==0&&_e.incSeqIfNeeded(fN.env);var EN=mN===0?A:_e.seq;return fN.sendPacket("GroupEnter",{account:g,seq:EN}),fN.fromReceived("GroupReply").pipe(aa(function(RN){return EN.eq(RN.seq)}),ca(function(RN){if((RN=RN.code)!==0)throw new da(["Channel join failure. The response code is %d",RN],Rq)}))}),ob(C),pe())})).forEach(function(dN,fN){var mN=function(){return _e.loginSocketSubs[fN].channels.delete(p.channelId)};_e.loginSocketSubs[fN].channels.set(p.channelId,dN.subscribe({error:mN,complete:mN}))}),cN.next=8,Xb.apply(void 0,G(x)).pipe(Ka(1),hb(1e4),Ga(function(dN){return dN instanceof pb&&_e.warn("Channel join timeout"),Z(dN)})).toPromise();case 8:this.joinedChannels.add(p);case 9:case"end":return cN.stop()}},h,this)}));return function(h,p){return o.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(o,h){this.emit("channelLeft",o),this.joinedChannels.delete(o),this.getLoginSockets().forEach(function(p){p.sendPacket("GroupLeave",{account:h})})}},{key:"requestChannelMemberList",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("GroupAllUsersList",{group:o,pageNumber:0,pageSize:200,seq:p})}),Ca.apply(void 0,[r.genTimeoutError(Pq)].concat(G(h.map(function(g){return g.fromReceived("GroupAllUsersResult").pipe(aa(function(C){var A=C.seq;return C.group===o&&p.eq(A)}))}))))}},{key:"requestPeersOnlineStatus",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("UserStatusList",{users:o,seq:p})}),Ca.apply(void 0,[r.genTimeoutError(oA)].concat(G(h.map(function(g){return g.fromReceived("UserStatusResult").pipe(aa(function(C){return p.eq(C.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(o,h){var p=this,g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(A,x){h!==void 0&&x!==h||A.sendPacket("UserAttributeSet",{account:p.context.uid,attributeInfos:Object.entries(o).map(function(_e){return{key:(_e=ra(_e,2))[0],value:_e[1]}}),seq:C})}),Ca.apply(void 0,G(g.map(function(A){return A.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The user attributes set failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(g.map(function(A){return A.fromReceived("UserAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(o,h,p){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(A){A.sendPacket("GroupAttributeSet",{broadcast:p,group:o,attributeInfos:Object.entries(h).map(function(x){return{key:(x=ra(x,2))[0],value:x[1]}}),seq:C})}),Ca.apply(void 0,G(g.map(function(A){return A.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The group attributes set failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(g.map(function(A){return A.fromReceived("GroupAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(o){var h=this,p=this.getLoginSockets();if(p.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return p.forEach(function(C){C.sendPacket("UserAttributeMod",{account:h.context.uid,attributeInfos:Object.entries(o).map(function(A){return{key:(A=ra(A,2))[0],value:A[1]}}),seq:g})}),Ca.apply(void 0,G(p.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(A){return g.eq(A.seq)}),ba(function(A){throw new da(["The user attributes add or update failure, code %d",A.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(p.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(aa(function(A){return g.eq(A.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(o,h,p){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(A){A.sendPacket("GroupAttributeMod",{broadcast:p,group:o,attributeInfos:Object.entries(h).map(function(x){return{key:(x=ra(x,2))[0],value:x[1]}}),seq:C})}),Ca.apply(void 0,G(g.map(function(A){return A.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The group attributes add or update failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(g.map(function(A){return A.fromReceived("GroupAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(o){var h=this,p=this.getLoginSockets();if(p.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return p.forEach(function(C){C.sendPacket("UserAttributeDel",{account:h.context.uid,attributes:o,seq:g})}),Ca.apply(void 0,G(p.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(A){return g.eq(A.seq)}),ba(function(A){throw new da(["The user attributes delete failure, code %d",A.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(p.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(aa(function(A){return g.eq(A.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(o,h,p){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(A){A.sendPacket("GroupAttributeDel",{group:o,broadcast:p,attributes:h,seq:C})}),Ca.apply(void 0,G(g.map(function(A){return A.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The channel attributes delete failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(g.map(function(A){return A.fromReceived("GroupAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var o=this,h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("UserAttributeSet",{account:o.context.uid,seq:p,attributeInfos:[]})}),Ca.apply(void 0,G(h.map(function(g){return g.fromReceived("UserAttributeErr").pipe(aa(function(C){return p.eq(C.seq)}),ba(function(C){throw new da(["The user attributes clear failure, code %d",C.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(h.map(function(g){return g.fromReceived("UserAttributeRsp").pipe(aa(function(C){return p.eq(C.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(o,h){var p=this.getLoginSockets();if(p.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return p.forEach(function(C){C.sendPacket("GroupAttributeSet",{group:o,seq:g,attributeInfos:[],broadcast:h})}),Ca.apply(void 0,G(p.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(aa(function(A){return g.eq(A.seq)}),ba(function(A){throw new da(["The channel attributes clear failure, code %d",A.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(p.map(function(C){return C.fromReceived("GroupAttributeRsp").pipe(aa(function(A){return g.eq(A.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(o,h){var p=this.getLoginSockets();if(p.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return p.forEach(function(C){C.sendPacket("UserAttributeGet",{account:o,seq:g,attributes:h})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(p.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(A){return g.eq(A.seq)}),ba(function(A){throw(A=A.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",A],Sb)}))})),G(p.map(function(C){return C.fromReceived("UserAttributeRet").pipe(aa(function(A){return g.eq(A.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(o,h){var p=this.getLoginSockets();if(p.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return p.forEach(function(C){C.sendPacket("GroupAttributeGet",{group:o,seq:g,attributes:h})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(p.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(aa(function(A){return g.eq(A.seq)}),ba(function(A){throw new da(["The channel attributes get failure, code %d",A.code],Sb)}))})),G(p.map(function(C){return C.fromReceived("GroupAttributeRet").pipe(aa(function(A){return g.eq(A.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("UserAttributeKeysGet",{account:o,seq:p})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(h.map(function(g){return g.fromReceived("UserAttributeErr").pipe(aa(function(C){return p.eq(C.seq)}),ba(function(C){throw(C=C.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",C],Sb)}))})),G(h.map(function(g){return g.fromReceived("UserAttributeKeysRet").pipe(aa(function(C){return p.eq(C.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("GroupAttributeKeysGet",{group:o,seq:p})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(h.map(function(g){return g.fromReceived("GroupAttributeErr").pipe(aa(function(C){return p.eq(C.seq)}),ba(function(C){throw new Wc(["Channel attribute operation unknown error code: %d",C.code],Sb)}))})),G(h.map(function(g){return g.fromReceived("GroupAttributeKeysRet").pipe(aa(function(C){return p.eq(C.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("GroupStatusList",{groups:o,seq:p})}),Ca.apply(void 0,[r.genTimeoutError(Pq)].concat(G(h.map(function(g){return g.fromReceived("GroupStatusResult").pipe(aa(function(C){return p.eq(C.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();return h.forEach(function(g){g.sendPacket("SubscribeUserStatus",{seq:p,users:o})}),Ca.apply(void 0,[r.genTimeoutError(vA)].concat(G(h.map(function(g){return g.fromReceived("SubscribeResponse").pipe(aa(function(C){return p.eq(C.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(o){var h=this.getLoginSockets();if(h.length===0)throw new K("Client is not logged in");var p=this.incGetSeq();h.forEach(function(g){g.sendPacket("UnsubscribeUserStatus",{seq:p,users:o})})}},{key:"sendInvitationMessage",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0=this;return w.wrap(function(aH){for(;;)switch(aH.prev=aH.next){case 0:if(g=p.peerId,C=p.callId,A=p.extra,x=p.isAcceptAck,_e=p.channelId,cN=p.type,dN={callId:C},x===void 0){aH.next=6;break}if(cN==="CallAccept"){aH.next=5;break}throw Error("invalid invitation type");case 5:dN.type=x?"ack":"request";case 6:return dN.channel=_e,(cN==="CallInvite"||cN==="CallCancel"||cN==="CallReject"||cN==="CallAccept"&&x===!1)&&A!==void 0&&(dN.extra=A),fN=Bg(),this.log("The sent invitation body is %o",dN),mN=function(pH){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:fN,instance:t0.instanceId,dst:g,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:pH,MessageType:cN}).toLong(),payload:new TextEncoder().encode(JSON.stringify(dN)),src:t0.context.uid}},aH.next=14,Kb(this.sendMessageToRetry(mN,!0)).pipe(hb(1e4),Ga(function(pH){return pH instanceof pb&&t0.warn("Send invitation timeout"),Z(pH)})).toPromise();case 14:return EN=aH.sent,RN=EN.code,IN=EN.retryTimes,aH.abrupt("return",{hasPeerReceived:RN===0,hasReSent:IN!==0});case 18:case"end":return aH.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var o=J(w.mark(function h(p,g,C,A,x,_e){var cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH,vH,AH,UH,zH,CH,HH,VH,KH,IH,MH,GH,yH,TH,NH,gH,SN,oH,fH,xH=this;return w.wrap(function(l5){for(;;)switch(l5.prev=l5.next){case 0:if(dN=g.width,fN=dN===void 0?0:dN,mN=g.height,EN=mN===void 0?0:mN,RN=g.fileName,IN=RN===void 0?"":RN,t0=g.description,aH=t0===void 0?"":t0,pH=g.thumbnail,SH=pH===void 0?new Blob:pH,vH=g.thumbnailHeight,AH=vH===void 0?0:vH,UH=g.thumbnailWidth,zH=UH===void 0?0:UH,CH=g.size,HH=CH===void 0?0:CH,VH=g.mediaId,KH=x.enableOfflineMessaging,IH=x.enableHistoricalMessaging,za(C)){l5.next=4;break}throw new I("The send message arguments are not valid",A?$k:hg);case 4:if(!(32768<new Blob([IN,SH,aH]).size)){l5.next=6;break}throw new I("The size of message overflowed ",A?ve:Hh);case 6:return MH=this.chatManager.getChatInfo(C),GH=MH.dialogue,yH=MH.sequence,TH=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(TH,"-").concat(GH,"#").concat(yH,'"'),A?" peer":" channel",oa(C)),m(cN={},"media_description",aH),m(cN,"media_width",fN),m(cN,"media_height",EN),m(cN,"media_thumbnailwidth",zH),m(cN,"media_thumbnailheight",AH),m(cN,"media_size",HH),m(cN,"media_id",VH),m(cN,"media_filename",IN),NH=uc(cN,function(w5){return new TextEncoder().encode(w5.toString())}),l5.t0=Uint8Array,l5.next=14,Ji(SH);case 14:return l5.t1=l5.sent,NH.media_thumbnail=new l5.t0(l5.t1),gH=A&&p==="IMAGE"?"PeerImageMessage":A&&p==="FILE"?"PeerFileMessage":A||p!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",SN=function(w5){return{MiscMap:NH,sequence:yH,dialogue:GH,instance:TH,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:w5,CompressionMethod:"Uncompressed",MessageType:gH,ToCache:KH,ToArchive:IH}).toLong(),payload:new Uint8Array,src:xH.context.uid}},l5.next=20,Kb(this.sendMessageToRetry(SN,!0)).pipe(hb(_e===void 0?1e4:_e),Ga(function(w5){return w5 instanceof pb&&xH.warn("Send message timeout"),Z(w5)})).toPromise();case 20:if(oH=l5.sent,(fH=oH.code)!==2){l5.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return l5.abrupt("return",{hasPeerReceived:fH===0});case 25:case"end":return l5.stop()}},h,this)}));return function(h,p,g,C,A,x){return o.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var o=J(w.mark(function h(p,g,C,A,x,_e){var cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH=this;return w.wrap(function(vH){for(;;)switch(vH.prev=vH.next){case 0:if(cN=x.enableOfflineMessaging,dN=x.enableHistoricalMessaging,za(C)&&p instanceof Uint8Array&&typeof g=="string"){vH.next=3;break}throw new I("The send message arguments are not valid",A?$k:hg);case 3:if(!(32768<p.byteLength+new Blob([g]).size)){vH.next=5;break}throw new ib("The message size is over the 32KB limit",A?ve:Hh);case 5:return fN=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=p.byteLength,mN=this.chatManager.getChatInfo(C),EN=mN.dialogue,RN=mN.sequence,IN=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(IN,"-").concat(EN,"#").concat(RN,'"'),fN?" compressed":"",A?"peer":"channel",oa(C)),t0=function(AH){return{MiscMap:{description:new TextEncoder().encode(g)},sequence:RN,dialogue:EN,instance:IN,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:AH,CompressionMethod:fN?"Zlib":"Uncompressed",MessageType:A?"PeerRawMessage":"ChannelRawMessage",ToCache:cN,ToArchive:dN}).toLong(),payload:fN?ks(p):p,src:SH.context.uid}},vH.next=12,Kb(this.sendMessageToRetry(t0,!0)).pipe(hb(_e===void 0?1e4:_e),Ga(function(AH){return AH instanceof pb&&SH.warn("Send message timeout"),Z(AH)})).toPromise();case 12:return aH=vH.sent,pH=aH.code,vH.abrupt("return",{hasPeerReceived:pH===0});case 15:case"end":return vH.stop()}},h,this)}));return function(h,p,g,C,A,x){return o.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var o=J(w.mark(function h(p,g,C,A,x){var _e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH=this;return w.wrap(function(vH){for(;;)switch(vH.prev=vH.next){case 0:if(_e=A.enableOfflineMessaging,cN=A.enableHistoricalMessaging,za(g)){vH.next=3;break}throw new I("The send message arguments are not valid",C?$k:hg);case 3:if(!(32768<new Blob([p]).size)){vH.next=5;break}throw new ib("The message size is over the 32KB limit",C?ve:Hh);case 5:return dN=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([p]).size,fN=this.chatManager.getChatInfo(g),mN=fN.dialogue,EN=fN.sequence,RN=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(RN,"-").concat(mN,"#").concat(EN,'"'),dN?" compressed":"",C?"peer":"channel",oa(g)),IN=new TextEncoder().encode(p),t0=function(AH){return{MiscMap:{},sequence:EN,dialogue:mN,instance:RN,dst:g,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:AH,CompressionMethod:dN?"Zlib":"Uncompressed",MessageType:C?"PeerTextMessage":"ChannelTextMessage",ToCache:_e,ToArchive:cN}).toLong(),payload:dN?ks(IN):IN,src:SH.context.uid}},vH.next=13,Kb(this.sendMessageToRetry(t0,!0)).pipe(hb(x===void 0?1e4:x),Ga(function(AH){return AH instanceof pb&&SH.warn("Send message timeout"),Z(AH)})).toPromise();case 13:return aH=vH.sent,pH=aH.code,vH.abrupt("return",{hasPeerReceived:pH===0});case 16:case"end":return vH.stop()}},h,this)}));return function(h,p,g,C,A){return o.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(o,h){Object.entries(this.loginSocketSubs[o]).forEach(function(p){var g=(p=ra(p,2))[1];p[0]==="channels"&&h||(Array.isArray(g)||g instanceof Map?g.forEach(function(C){return C.unsubscribe()}):g&&g.unsubscribe())}),this.loginSocketSubs[o]={channels:h?this.loginSocketSubs[o].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN,mN,EN,RN=this,IN=arguments;return w.wrap(function(t0){for(;;)switch(t0.prev=t0.next){case 0:if(C=2<IN.length&&IN[2]!==void 0?IN[2]:0,this.log("Attempt to send the message ".concat(g?" with retrying, %o":"without retrying"),{retryTimes:C}),(A=this.getLoginSockets()).length!==0){t0.next=5;break}throw Error("no logged-in sockets");case 5:return x=p(C),A.forEach(function(aH){aH.sendPacket("Message",x)}),_e=x.dialogue,cN=x.sequence,dN=x.instance,fN=A.map(function(aH){return aH.fromReceived("Ack").pipe(wb(function(pH){return _e.eq(pH.dialogue)&&cN.eq(pH.sequence)&&dN.eq(pH.instance)}))}),t0.prev=9,t0.next=12,Xb.apply(void 0,G(fN)).pipe(hb(6e3),Ga(function(aH){return Sa(aH)&&RN.warn("Message send timeout, retry times %d",C),Z(aH)}),Ka(1)).toPromise();case 12:return mN=t0.sent,EN=mN.code,this.log("The message has been acked, %o",{code:EN}),t0.abrupt("return",{code:EN,retryTimes:C});case 18:if(t0.prev=18,t0.t0=t0.catch(9),!(t0.t0 instanceof pb&&g)){t0.next=22;break}return t0.abrupt("return",this.sendMessageToRetry(p,!1,C+1));case 22:throw t0.t0;case 23:case"end":return t0.stop()}},h,this,[[9,18]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var o=this;this.lastLoginSockets.map(function(h){return h.pipe(Cc(function(p){return Bc(0,2750).pipe(ca(function(){o.incSeqIfNeeded(p.env),p.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:o.seq})}))}))}).forEach(function(h,p){var g=o.loginSocketSubs[p].keepAlive;g!==void 0&&g.unsubscribe(),o.loginSocketSubs[p].keepAlive=h.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var o=this;this.lastLoginSockets.map(function(h){return h.pipe(Cc(function(p){var g,C=!1,A=p.userJoin$.pipe(ca(function(){C=!0})),x=p.input$.pipe(ca(function(_e){Li[_e.uri].slice(0,-3)!=="Ping"&&(C=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(p.receivedPacket),ca(function(_e){_e=ra(_e,2),_e=ra(_e[1],2)[1],g!==_e||C||p.forceReconnect(),g=_e})),A,x)}))}).forEach(function(h,p){var g=o.loginSocketSubs[p].keepAliveReconnector;g!==void 0&&g.unsubscribe(),o.loginSocketSubs[p].keepAliveReconnector=h.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var o=this;this.lastLoginSockets.map(function(h){return h.pipe(Cc(function(p){return Xb(gb(p,"reconnect").pipe(ca(o.onSocketReconnect(p))),p.fromReceived("Message").pipe(ca(o.onMessage(p))),p.fromReceived("GroupEnterNotice").pipe(ca(o.onGroupEnterNotice())),p.fromReceived("GroupLeaveNotice").pipe(ca(o.onGroupLeaveNotice())),p.fromReceived("GroupCountNotice").pipe(ca(o.onGroupCountNotice())),p.fromReceived("GroupAttributeAlt").pipe(ca(o.onGroupAttributeAlt())),p.fromReceived("UserJoinNotice").pipe(ca(o.onUserNotice(S.PeerOnlineState.ONLINE))),p.fromReceived("UserQuitNotice").pipe(ca(o.onUserNotice(S.PeerOnlineState.OFFLINE))),p.fromReceived("UserWaitNotice").pipe(ca(o.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(h,p){o.loginSocketSubs[p].receivers.push(h.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(o,h,p){var g=this;return im(ad(function(){g.userJoinOptions=new is(h),o.sendPacket("UserJoin",{account:g.context.uid,instance:g.instanceId,opt:g.userJoinOptions.toLong(),seq:p,ticket:o.ticket})}),o.fromReceived("UserResp").pipe(aa(function(C){return p.eq(C.seq)}),ca(function(C){if((C=C.code)!==0)throw g.clearSockets(),g.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",C],jg);g.log("ENV_%d logged in",o.env)}),qf(o),hb(15e3))).pipe(wb(function(C){return C!==void 0}),Ga(function(C){return C instanceof pb&&g.warn("Login response timeout, rejoin: %s",h),Z(C)}))}},{key:"getSocketLoginObservables",value:function(o,h){var p=this;return o.map(function(g){return g.pipe(ca(function(C){C.listenerCount("socketUserDrop")===0&&C.on("socketUserDrop",function(A){return p.onUserDrop(A,C)})}),Cc(function(C,A){return p.incSeqIfNeeded(C.env),p.requestSocketLogin(C,A!==0,A===0?h:p.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(o){if(![0,1].includes(o))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[o]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[o]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var o=this.curLoginSockets,h=-1,p=o==null?0:o.length,g=0,C=[];++h<p;){var A=o[h];A&&(C[g++]=A)}return C}},{key:"emitMessage",value:function(o,h){var p=o.options,g=o.payload,C=o.src,A=o.dst,x=o.instance,_e=o.dialogue,cN=o.sequence,dN=o.ms,fN=o.MiscMap;this.dialogueSequenceLru.set(_e.toString(),cN),x="".concat(x,"-").concat(_e,"#").concat(cN),this.msgDedupLru.has(x)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",h,x):(this.msgDedupLru.set(x,void 0),h=new ae(p),this.lastLoginSockets.forEach(function(){var mN=J(w.mark(function EN(RN){var IN;return w.wrap(function(t0){for(;;)switch(t0.prev=t0.next){case 0:return t0.next=2,RN.pipe(Ka(1)).toPromise();case 2:IN=t0.sent,r.sendMessageAck(o,IN);case 4:case"end":return t0.stop()}},EN)}));return function(EN){return mN.apply(this,arguments)}}()),p=h.isZlibCompressed(),h.isInvitation()?(A=pa(p?nl(Xm(g,Uint8Array.of(0,0,0,0))):g),A=JSON.parse(A),this.log("The received invitation body is %o",A),this.emit("invitationMessage",{body:A,type:h.getInvitationType(),peerId:C,serverReceivedTs:dN.toNumber()})):h.isTextMessage()?(fN=h.isPeerTextMessage(),g=pa(p?nl(Xm(g,Uint8Array.of(0,0,0,0))):g),this.info("Received a %s %s text message from %s to %s, %s",p?" compressed":"",fN?"peer":"channel",oa(C),oa(A),x),fN?(C={text:g,peerId:C,properties:{serverReceivedTs:dN.toNumber(),isOfflineMessage:h.isFromCache()}},this.emit("peerTextMessage",C)):this.emit("channelTextMessage",{channelId:A,memberId:C,text:g,properties:{serverReceivedTs:dN.toNumber(),isOfflineMessage:!1}})):h.isRawMessage()?(_e=h.isRawPeerMessage(),fN=(fN=fN.description)===void 0?"":pa(fN),g=p?nl(g):g,this.info("Received a %s %s raw message from %s to %s, %s",p?" compressed":"",_e?"peer":"channel",oa(C),oa(A),x),_e?(C={desc:fN,raw:g,peerId:C,properties:{serverReceivedTs:dN.toNumber(),isOfflineMessage:h.isFromCache()}},this.emit("peerRawMessage",C)):this.emit("channelRawMessage",{desc:fN,raw:g,channelId:A,memberId:C,properties:{serverReceivedTs:dN.toNumber(),isOfflineMessage:!1}})):(h.isImageMessage()||h.isFileMessage())&&(g=h.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",g?"peer":"channel",oa(C),oa(A),x),g?this.emit("peerMediaMessage",{messageType:h.isImageMessage()?"IMAGE":"FILE",details:fN,peerId:C,properties:{serverReceivedTs:dN.toNumber(),isOfflineMessage:h.isFromCache()}}):this.emit("channelMediaMessage",{messageType:h.isImageMessage()?"IMAGE":"FILE",details:fN,memberId:C,channelId:A,properties:{serverReceivedTs:dN.toNumber(),isOfflineMessage:h.isFromCache()}})))}},{key:"onSocketReconnect",value:function(o){var h=this;return function(){var p=[0,1].filter(function(g){return g!==o.env})[0];(p=h.connection.curOpenSockets[p])&&!p.loggedIn&&h.emit("connectionLost")}}},{key:"onUserDrop",value:function(o,h){var p;o=o.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(h.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:h.address,serverCode:o,sid:Xa(this.instanceId),userId:this.context.uid},(p=this.context.config.enableCloudProxy)!==null&&p!==void 0&&p),o===10006||o===10001?this.warn("Login too often and kicked off, reconnect and login"):o===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(o)&&(this.emit("userDrop",o),this.clearSockets())}},{key:"clearSockets",value:function(){var o=this,h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,p=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(g){o.cleanLoginSubs(g,p),o.connection.closeSocket(g,h)})}},{key:"onMessage",value:function(o){var h=this;return function(p){var g=p.dialogue,C=p.instance,A=p.sequence,x=p.options;if(p.src===h.context.uid)h.log("The message is from the local account, ignored");else{var _e=g.toString(),cN=h.dialPendingMsgSubjectMap.get(_e);if(g="".concat(C,"-").concat(g,"#").concat(A),cN)cN.next(p),h.log("Env_%d: The dialogue has pending messages, next: %s",o.env,g);else{var dN=h.dialogueSequenceLru.get(_e);if(cN=!dN&&A.eq(1),C=dN!==void 0&&A.sub(dN).eq(1),cN||C)h.emitMessage(p,o.env);else{if(dN){if(A.lte(dN))return;h.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",o.env,g)}else h.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",o.env,g);A=new Pa,h.dialPendingMsgSubjectMap.set(_e,A);var fN=A.pipe(Qs(Pk),xg(function(mN,EN){return[].concat(G(mN),[EN])},[]),ba(function(mN){return G(mN).sort(function(EN,RN){return EN=EN.sequence,RN=RN.sequence,EN.eq(RN)?0:EN.gt(RN)?1:-1})}),sm(1));x=!(x=new ae(x)).isFromCache()&&!x.isBufferedMessage(),fN.pipe(ob(Bc(x?750:1500)),aa(function(mN){if(2>mN.length)return!1;for(var EN=dN===void 0?U.fromNumber(1,!0):dN.add(1),RN=0;RN<mN.length;EN=EN.add(1),RN++)if(!mN[RN].sequence.eq(EN))return!1;return!0}),wg(function(){h.dialPendingMsgSubjectMap.delete(_e)})).subscribe(function(mN){mN.forEach(function(EN){h.emitMessage(EN,o.env),h.log("Env_%d: The message queue has fully ordered, emitting: %s",o.env,"".concat(EN.instance,"-").concat(EN.dialogue,"#").concat(EN.sequence))})},function(mN){mN instanceof vg&&fN.pipe(Ka(1)).subscribe(function(EN){return EN.forEach(function(RN){h.log("Env_%d: The message pending queue expired, emitting: %s",o.env,"".concat(RN.instance,"-").concat(RN.dialogue,"#").concat(RN.sequence)),h.emitMessage(RN,o.env)})})}),A.next(p)}}}}}},{key:"onGroupEnterNotice",value:function(){var o=this;return function(h){o.emit("memberNotice",{channelId:h.group,seq:h.seq,instance:h.instance,memberId:h.user,type:"MemberJoined",size:h.size})}}},{key:"onGroupLeaveNotice",value:function(){var o=this;return function(h){o.emit("memberNotice",{channelId:h.group,seq:h.seq,instance:h.instance,memberId:h.user,type:"MemberLeft",size:h.size})}}},{key:"onGroupCountNotice",value:function(){var o=this;return function(h){o.emit("memberNotice",{channelId:h.group,seq:h.seq,instance:h.instance,type:"MemberCountUpdated",size:h.size})}}},{key:"onGroupAttributeAlt",value:function(){var o=this;return function(h){var p=h.group;h=ff(h,kD),o.emit("channelAttributesUpdated",ua({channelId:p},h))}}},{key:"onUserNotice",value:function(o){var h=this;return function(p){h.emit("peerOnlineStatusChanged",{peerId:p.user,instance:p.instance,seq:p.seq,state:o})}}}],[{key:"sendMessageAck",value:function(o,h){var p=new ae(o.options);(p.isInvitation()||p.isPeerMessage())&&h.sendPacket("Ack",{code:0,dialogue:o.dialogue,instance:o.instance,sequence:o.sequence})}}]),r}(tb());m(ls,"genTimeoutError",function(e,r){return bb(void 0).pipe(cd(r===void 0?1e4:r),ba(function(){throw new db(["Request timed out after %ds",r===void 0?1e4:r],e)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(e,r,i){i=r&&i||0;var o=r||[],h=(e=e||{}).node||ms,p=e.clockseq!==void 0?e.clockseq:ol;if(h==null||p==null){var g=Jq();h==null&&(h=ms=[1|g[0],g[1],g[2],g[3],g[4],g[5]]),p==null&&(p=ol=16383&(g[6]<<8|g[7]))}g=e.msecs!==void 0?e.msecs:new Date().getTime();var C=e.nsecs!==void 0?e.nsecs:ql+1,A=g-pl+(C-ql)/1e4;if(0>A&&e.clockseq===void 0&&(p=p+1&16383),(0>A||g>pl)&&e.nsecs===void 0&&(C=0),1e4<=C)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=g,ql=C,ol=p,e=(1e4*(268435455&(g+=122192928e5))+C)%4294967296,o[i++]=e>>>24&255,o[i++]=e>>>16&255,o[i++]=e>>>8&255,o[i++]=255&e,e=g/4294967296*1e4&268435455,o[i++]=e>>>8&255,o[i++]=255&e,o[i++]=e>>>24&15|16,o[i++]=e>>>16&255,o[i++]=p>>>8|128,o[i++]=255&p,p=0;6>p;++p)o[i+p]=h[p];return r||Kq(o)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function r(o,h,p){W(this,r);var g=i.call(this,p,"RtmLocalInvitation",!0);return m(n(g),"state",Ba.IDLE),m(n(g),"localInvitationEnd$",Ca(gb(n(g),"LocalInvitationAccepted"),gb(n(g),"LocalInvitationRefused"),gb(n(g),"LocalInvitationFailure"),gb(n(g),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(g),"callId",Ud.v4()),m(n(g),"_content",""),m(n(g),"_channelId",""),m(n(g),"_response",""),m(n(g),"calleeId",void 0),m(n(g),"logger",void 0),m(n(g),"getSession",void 0),g.calleeId=o,g.getSession=h,g.logger=p,g}la(r,e);var i=ma(r);return Ha(r,[{key:"channelId",get:function(){return this._channelId},set:function(o){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=o)}},{key:"content",get:function(){return this._content},set:function(o){this.log("set content for %s",this.callId),this._content=o}},{key:"response",get:function(){return this._response},set:function(o){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var o,h=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function p(){var g,C,A;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,h.getSession().sendInvitationMessage({peerId:h.calleeId,callId:h.callId,extra:h._content,type:"CallInvite",channelId:h._channelId});case 2:if(g=x.sent,C=g.hasPeerReceived,A=g.hasReSent,!h.isLocalInvitationEnd()){x.next=7;break}throw new db("send invitation timeout");case 7:if(h.log("The local invitation has sent to the callee"),C||A){x.next=11;break}throw o=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(C){x.next=14;break}throw o=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return x.stop()}},p)}))).pipe(oe(function(p){return p.pipe(ca(function(g){if(!(g instanceof rl))throw g}),cd(2e3))}),hb(3e4),Ga(function(p){return Sa(p)&&h.warn("local invitation ack timed out"),Z(p)}),ob(this.localInvitationEnd$)).subscribe({next:function(){h.state===Ba.RECEIVED_BY_REMOTE?h.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):h.state!==Ba.SENT_TO_REMOTE?h.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(h.info("The peer received the local invitation %s.",h.callId),h.state=Ba.RECEIVED_BY_REMOTE,h.emit("LocalInvitationReceivedByPeer"),h.localInvitationEnd$.pipe(hb(6e4),Ga(function(p){return Sa(p)&&h.warn("local invitation expired"),Z(p)})).subscribe({error:function(){h.state=Ba.FAILURE,h.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(p){h.isLocalInvitationEnd()?h.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(h.state=Ba.FAILURE,Sa(p)&&o?o.code==="PEER_NOT_ONLINE"?h.emit("LocalInvitationFailure",bf.PEER_OFFLINE):o.code==="RESENT_AND_OFFLINE"&&h.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(p)?h.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):p.name==="RtmInvalidStatusError"?h.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):h.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(o){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=o,this.emit("LocalInvitationAccepted",o))}}},{key:"onRefuseReceived",value:function(o){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=o,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",o)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),r}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function r(o){var h=o.invitationChannel,p=o.extraContent,g=o.callId,C=o.callerId,A=o.logger;o=o.getSession,W(this,r);var x=i.call(this,A,"RtmRemoteInvitation",!0);return m(n(x),"state",kb.INVITATION_RECEIVED),m(n(x),"remoteInvitationEnd$",Ca(gb(n(x),"RemoteInvitationCanceled"),gb(n(x),"RemoteInvitationRefused"),gb(n(x),"RemoteInvitationAccepted"),gb(n(x),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(x),"callerId",void 0),m(n(x),"callId",void 0),m(n(x),"_getSession",void 0),m(n(x),"logger",void 0),m(n(x),"_content",void 0),m(n(x),"_channelId",void 0),m(n(x),"_response",""),x._channelId=h,x._content=p,x.callId=g,x.callerId=C,x._getSession=o,x.logger=A,x.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(_e){return Sa(_e)&&x.warn("Remote invitation expired"),Z(_e)})).subscribe({error:function(){x.state=kb.FAILURE,x.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),x}la(r,e);var i=ma(r);return Ha(r,[{key:"channelId",get:function(){return this._channelId},set:function(o){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(o){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(o){this._response=o}},{key:"accept",value:function(){var o,h=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function p(){return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",h._getSession().sendInvitationMessage({peerId:h.callerId,callId:h.callId,extra:h.response,type:"CallAccept",isAcceptAck:!1,channelId:h.channelId}));case 1:case"end":return g.stop()}},p)})))}),wb(function(p){return o=p.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(p){if(h.logError(p),h.state=kb.FAILURE,Sa(p))switch(o){case void 0:case!0:return void h.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void h.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}h.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(o){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=o,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",o))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),r}(tb()),nD=function(e){function r(o,h){W(this,r);var p=i.call(this,h,"InvitationManager");return m(n(p),"getSession",void 0),m(n(p),"invitationDispatcher",new ea.EventEmitter),m(n(p),"outgoingLocalInvitations",new Map),m(n(p),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(p),"logger",void 0),p.getSession=cn(o),p.logger=h,p.invitationDispatcher.on("remoteInvitationToManager",function(g){var C=g.callId,A=g.extra,x=g.callerId;g=g.channelId,p.receivedRemoteInvitations.has(C)||((A=new mD({callerId:x,callId:C,getSession:p.getSession,logger:h,extraContent:A,invitationChannel:g})).remoteInvitationEnd$.subscribe(function(){p.receivedRemoteInvitations.delete(C)}),p.receivedRemoteInvitations.set(C,A),p.emit("remoteInvitationInstance",A))}),p.invitationDispatcher.on("acceptAckToRemoteInvitation",function(g){(g=p.receivedRemoteInvitations.get(g.callId))&&g.onAcceptAckReceived()}),p.invitationDispatcher.on("cancelToRemoteInvitation",function(g){var C=g.extra;(g=p.receivedRemoteInvitations.get(g.callId))&&g.onCancelReceived(C)}),p.invitationDispatcher.on("acceptToLocalInvitation",function(g){var C=g.extra;(g=p.outgoingLocalInvitations.get(g.callId))&&g.onAcceptReceived(C)}),p.invitationDispatcher.on("refuseToLocalInvitation",function(g){var C=g.extra;(g=p.outgoingLocalInvitations.get(g.callId))&&g.onRefuseReceived(C)}),p}la(r,e);var i=ma(r);return Ha(r,[{key:"invitationMessageHandler",value:function(o){var h=o.body,p=h.callId,g=h.extra;g=g===void 0?"":g;var C=h.type,A=(h=h.channel)===void 0?"":h,x=o.type;switch(h=o.peerId,o=o.serverReceivedTs,x){case"CallAccept":C==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:p}):C==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:p,extra:g});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:p,callerId:h,extra:g,channelId:A});break;case"CallCancel":if(p==="0"){p="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(A,"_").concat(g),this.getSession().emit("peerTextMessage",{peerId:h,properties:{serverReceivedTs:o,isOfflineMessage:!1},text:p});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:p,extra:g});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:p,extra:g});break;default:throw Im("invitationType",x)}}},{key:"genLocalInvitation",value:function(o){var h=this,p=new lD(o,this.getSession,this.logger);return p.localInvitationEnd$.subscribe(function(){h.outgoingLocalInvitations.delete(p.callId)}),this.outgoingLocalInvitations.set(p.callId,p),p}}]),r}(tb()),oD=function(e,r,i){var o=!0,h=!0;if(typeof e!="function")throw new TypeError("Expected a function");return lb(i)&&(o="leading"in i?!!i.leading:o,h="trailing"in i?!!i.trailing:h),qC(e,r,{leading:o,maxWait:r,trailing:h})},ub,cf;(function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function r(o,h,p,g){W(this,r);var C=i.call(this,g,"RtmChannel",!0);return m(n(C),"onMemberCountUpdated",oD(function(A){A!==C.memberCount&&(C.memberCount=A,C.emit("MemberCountUpdated",A))},1e3)),m(n(C),"getSession",void 0),m(n(C),"memberCount",0),m(n(C),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(C),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(C),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(C),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(C),"channelId",void 0),m(n(C),"client",void 0),m(n(C),"onAttributesUpdated",function(A){var x=A.channelId,_e=A.attributeMaps,cN=A.seq;A=A.instance.toString();var dN=C.attributesSeqLru.get(A);if((!dN||cN.greaterThan(dN))&&(C.attributesSeqLru.set(A,cN),x===C.channelId)){for(x={},cN=0;cN<_e.length;cN++){var fN=_e[cN];A=fN.key,dN=fN.ms;var mN=fN.value;if(fN=fN.origin,typeof A!="string"||!U.isLong(dN)||typeof mN!="string"||!za(fN))break;x[A]={value:mN,lastUpdateUserId:fN,lastUpdateTs:dN.toNumber()}}C.emit("AttributesUpdated",x)}}),m(n(C),"onChannelTextMessage",function(A){var x=A.memberId,_e=A.text,cN=A.properties;A.channelId===C.channelId&&C.emit("ChannelMessage",{text:_e,messageType:S.MessageType.TEXT},x,cN)}),m(n(C),"onChannelMediaMessage",function(A){var x=A.memberId,_e=A.properties,cN=A.details,dN=A.messageType;A.channelId===C.channelId&&(dN==="FILE"?C.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(cN.media_size),10),description:pa(cN.media_description),fileName:pa(cN.media_filename),mediaId:pa(cN.media_id),thumbnail:new Blob([cN.media_thumbnail])},x,_e):dN==="IMAGE"&&C.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(cN.media_size),10),description:pa(cN.media_description),fileName:pa(cN.media_filename),mediaId:pa(cN.media_id),thumbnail:new Blob([cN.media_thumbnail]),height:parseInt(pa(cN.media_height),10),width:parseInt(pa(cN.media_width),10),thumbnailHeight:parseInt(pa(cN.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(cN.media_thumbnailwidth),10)},x,_e))}),m(n(C),"onChannelRawMessage",function(A){var x=A.desc,_e=A.raw,cN=A.memberId,dN=A.properties;A.channelId===C.channelId&&C.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:_e,description:x},cN,dN)}),m(n(C),"onMemberNotice",function(A){var x=A.memberId,_e=A.type,cN=A.size;if(A.channelId===C.channelId){var dN=A.instance.toString();A=A.seq.toString();var fN={MemberLeft:C.memberLeftLru,MemberJoined:C.memberJoinedLru,MemberCountUpdated:void 0}[_e];if(fN){if(fN.has(dN+A))return void C.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",_e,A,oa(C.channelId),oa(x||""));if(fN.set(dN+A,void 0),typeof x!="string")return;if(x!==C.getSession().context.uid&&((dN=C.memberJoinStateLru.get(x))===cf.JOINED&&_e==="MemberJoined"||dN===cf.LEFT&&_e==="MemberLeft"))return void C.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",_e,A,oa(C.channelId),oa(x||""));C.memberJoinStateLru.set(x,_e==="MemberJoined"?cf.JOINED:cf.LEFT)}C.info("Channel %s - %s, memberId: %s",_e,oa(C.channelId),_e==="MemberCountUpdated"?"[unknown]":oa(x||"")),dN=x===C.getSession().context.uid,_e==="MemberLeft"&&za(x)||_e==="MemberJoined"&&za(x)?(dN||C.emit(_e,x),C.onMemberCountUpdated(cN)):_e==="MemberCountUpdated"&&typeof cN=="number"&&C.onMemberCountUpdated(cN)}}),C.getSession=cn(h),C.channelId=o,C.client=p,C.info("A channel created, id %s",oa(o)),C}la(r,e);var i=ma(r);return Ha(r,[{key:"join",value:function(){var o=J(w.mark(function h(){var p,g,C,A,x,_e,cN;return w.wrap(function(dN){for(;;)switch(dN.prev=dN.next){case 0:if(za(this.channelId)){dN.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:dN.prev=2,p=this.getSession(),dN.next=9;break;case 6:throw dN.prev=6,dN.t0=dN.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!p.joinedChannels.has(this)){dN.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:p.context.uid,elapse:fb(p.startTime),errCode:Uq,sid:Xa(p.instanceId)},(g=this.client.context.config.enableCloudProxy)!==null&&g!==void 0&&g),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(dN.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){dN.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:p.context.uid,elapse:fb(p.startTime),errCode:Wq,sid:Xa(p.instanceId)},(x=this.client.context.config.enableCloudProxy)!==null&&x!==void 0&&x),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(p.joinedChannels.size!==20){dN.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:p.context.uid,elapse:fb(p.startTime),errCode:Tq,sid:Xa(p.instanceId)},(_e=this.client.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:p.context.uid,elapse:fb(p.startTime),errCode:0,sid:Xa(p.instanceId)},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),dN.next=23,p.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(p.startTime),errCode:0,sid:Xa(p.instanceId),serverErrCode:0,userId:p.context.uid},(A=this.client.context.config.enableCloudProxy)!==null&&A!==void 0&&A),this.info("The channel %s joined successfully",oa(this.channelId)),p.on("channelTextMessage",this.onChannelTextMessage),p.on("channelRawMessage",this.onChannelRawMessage),p.on("channelMediaMessage",this.onChannelMediaMessage),p.on("memberNotice",this.onMemberNotice),p.on("channelAttributesUpdated",this.onAttributesUpdated),dN.next=41;break;case 32:if(dN.prev=32,dN.t1=dN.catch(12),this.logError(dN.t1),!sa(dN.t1)){dN.next=37;break}throw dN.t1;case 37:if(!Sa(dN.t1)){dN.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(p.startTime),errCode:Sq,sid:Xa(p.instanceId),serverErrCode:0,userId:p.context.uid},(cN=this.client.context.config.enableCloudProxy)!==null&&cN!==void 0&&cN),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:dN.t1});case 41:case"end":return dN.stop()}},h,this,[[2,6],[12,32]])}));return function(){return o.apply(this,arguments)}}()},{key:"leave",value:function(){var o=J(w.mark(function h(){var p,g,C,A;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:x.prev=0,g=this.getSession(),x.next=7;break;case 4:throw x.prev=4,x.t0=x.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(g.joinedChannels.has(this)){x.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:x.prev=9,g.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,g.removeListener("channelTextMessage",this.onChannelTextMessage),g.removeListener("channelRawMessage",this.onChannelRawMessage),g.removeListener("channelMediaMessage",this.onChannelMediaMessage),g.removeListener("memberNotice",this.onMemberNotice),g.removeListener("channelAttributesUpdated",this.onAttributesUpdated),x.next=32;break;case 23:if(x.prev=23,x.t1=x.catch(9),this.logError(x.t1),!sa(x.t1)){x.next=30;break}throw x.t1.code===void 0&&(x.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:Yq,sid:Xa(g.instanceId),userId:g.context.uid},(A=this.client.context.config.enableCloudProxy)!==null&&A!==void 0&&A),x.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:Xq,sid:Xa(g.instanceId),userId:g.context.uid},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),new Wc("The channel leave failure",{code:Xq,originalError:x.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:0,sid:Xa(g.instanceId),userId:g.context.uid},(p=this.client.context.config.enableCloudProxy)!==null&&p!==void 0&&p);case 33:case"end":return x.stop()}},h,this,[[0,4],[9,23]])}));return function(){return o.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN=this,dN=arguments;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:g=1<dN.length&&dN[1]!==void 0?dN[1]:{},C=g.enableHistoricalMessaging,A=C!==void 0&&C,Tm(p,Hh),fN.prev=2,x=this.getSession(),fN.next=9;break;case 6:throw fN.prev=6,fN.t0=fN.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(x.joinedChannels.has(this)){fN.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){fN.next=16;break}return _e=Date.now(),fN.next=15,new Promise(function(mN,EN){var RN=function(){var t0=J(w.mark(function aH(){var pH;return w.wrap(function(SH){for(;;)switch(SH.prev=SH.next){case 0:return pH=Date.now()-_e,SH.prev=1,SH.next=4,Gg({message:p,peerId:cN.channelId,toPeer:!1,session:cN.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:pH,logger:cN.logger,options:{enableHistoricalMessaging:A,enableOfflineMessaging:!1}});case 4:mN(),SH.next=12;break;case 7:SH.prev=7,SH.t0=SH.catch(1),Sa(SH.t0)&&EN(new db(Yd(cN.name,"sendMessageToPeer",1e4),Yk)),sa(SH.t0)&&EN(SH.t0),EN(new da("Channel message send failure",{code:hg,originalError:SH.t0}));case 12:return SH.prev=12,clearTimeout(IN),SH.finish(12);case 15:case"end":return SH.stop()}},aH,null,[[1,7,12,15]])}));return function(){return t0.apply(this,arguments)}}();cN.client.internalEmitter.once("RECONNECTED",RN);var IN=setTimeout(function(){cN.client.internalEmitter.off("RECONNECTED",RN),EN(new db(Yd(cN.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return fN.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){fN.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return fN.prev=18,fN.next=21,Gg({message:p,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:A,enableOfflineMessaging:!1}});case 21:fN.next=31;break;case 23:if(fN.prev=23,fN.t1=fN.catch(18),!Sa(fN.t1)){fN.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(fN.t1)){fN.next=30;break}throw this.logError(fN.t1),fN.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return fN.stop()}},h,this,[[2,6],[18,23]])}));return function(h){return o.apply(this,arguments)}}()},{key:"getMembers",value:function(){var o=J(w.mark(function h(){var p,g,C;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:A.prev=0,A.prev=1,p=this.getSession(),A.next=8;break;case 5:throw A.prev=5,A.t0=A.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(p.joinedChannels.has(this)){A.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return g=this.getSession().requestChannelMemberList(this.channelId),A.next=13,g.pipe(ba(function(x){return x.memberInfos.map(function(_e){return _e.account})})).toPromise();case 13:return C=A.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),C.map(oa)),A.abrupt("return",C);case 18:if(A.prev=18,A.t1=A.catch(0),!sa(A.t1)){A.next=23;break}throw this.logError(A.t1),A.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return A.stop()}},h,this,[[0,18],[1,5]])}));return function(){return o.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var o=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(h){return h.channelId===o.channelId})}}]),r}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function r(o,h,p,g){W(this,r);var C=i.call(this,h,"RtmClient",!0);return m(n(C),"connectionState",T.DISCONNECTED),m(n(C),"internalEmitter",new ea),m(n(C),"context",void 0),m(n(C),"attributes",{}),m(n(C),"loginPromise",void 0),m(n(C),"attributeDrafts",new Set),m(n(C),"session",void 0),m(n(C),"lastLoginTime",void 0),m(n(C),"reconnId",0),m(n(C),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(C),"invitationManager",void 0),m(n(C),"subscribedPeerStatusCache",{}),m(n(C),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(C),"peerUnreachableTimers",{}),m(n(C),"mediaTaskManager",void 0),m(n(C),"setParameters",void 0),m(n(C),"updateConfig",void 0),m(n(C),"userDropHandler",function(A){if(C.connectionState!==T.ABORTED)switch(A){case 11:C.logError("Kicked off by remote session"),C.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:C.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[A])),C.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:C.logError("User kicked off for unknown code: ".concat(A)),C.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),C.context=new ZC(o,p,h),C.mediaTaskManager=new fs(h),C.context.config=p,C.internalEmitter.setMaxListeners(512),C.setParameters=g.bind(n(C)),C.updateConfig=g.bind(n(C)),C.invitationManager=new nD(function(){return C.session},h),C.invitationManager.on("remoteInvitationInstance",function(A){C.emit("RemoteInvitationReceived",A)}),C}la(r,e);var i=ma(r);return Ha(r,[{key:"renewToken",value:function(){var o=J(w.mark(function h(p){var g,C,A,x=this;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(typeof p=="string"&&p.length!==0){_e.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){_e.next=5;break}return _e.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){_e.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){_e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _e.prev=9,g=this.context.token,this.context.token=p,_e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(cN){return cN.pipe(ca(function(dN){if(sa(dN))throw dN}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(cN){return Sa(cN)&&x.warn("renewToken timed out"),Z(cN)})).toPromise();case 14:C=_e.sent,A=C.ticket,_e.next=27;break;case 18:if(_e.prev=18,_e.t0=_e.catch(9),this.context.token=g,_e.t0.code!==$q&&_e.t0.code!==ar){_e.next=23;break}throw new Ye("Invalid token",tA);case 23:if(_e.t0.code!==Kh){_e.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(_e.t0)){_e.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(cN){return cN!==void 0}).forEach(function(cN){return cN.ticket=A});case 28:case"end":return _e.stop()}},h,this,[[9,18]])}));return function(h){return o.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var o=J(w.mark(function h(p){var g,C,A=this;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(this.connectionState===T.CONNECTED){x.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){x.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(p)||p.length===0||p.some(function(_e){return!za(_e)})||256<p.length)){x.next=6;break}throw new I("invalid arguments",er);case 6:return x.next=8,this.session.requestPeersOnlineStatus(p).toPromise();case 8:return g=x.sent,C=uc(Jk(g.userInfos,"account"),function(_e){return!!_e.ts}),Object.keys(C).forEach(function(_e){if(_e in A.subscribedPeerStatusCache&&A.subscribedPeerStatusCache[_e]!==S.PeerOnlineState.UNREACHABLE){var cN=C[_e]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;A.emit("PeersOnlineStatusChanged",m({},_e,cN)),A.subscribedPeerStatusCache[_e]=cN}}),x.abrupt("return",C);case 12:case"end":return x.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN,dN,fN=this;return w.wrap(function(mN){for(;;)switch(mN.prev=mN.next){case 0:if(this.connectionState===T.CONNECTED){mN.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){mN.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(p)&&p.every(function(EN){return typeof EN=="string"})&&p.length!==0){mN.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<p.length)){mN.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:g=0;case 9:if(!(g<p.length)){mN.next=16;break}if(za(C=p[g])){mN.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",C],Oq);case 13:g++,mN.next=9;break;case 16:return mN.next=18,this.session.requestGetChannelMemberCount(p).toPromise();case 18:for(A=mN.sent,x=A.groupInfos,_e={},cN=function(EN){var RN=(EN=x[EN]).group,IN=EN.memberCount;za(RN)&&typeof IN=="number"&&(fN.session.joinedChannels.forEach(function(t0){t0.channelId===RN&&t0.onMemberCountUpdated(IN)}),_e[RN]=IN)},dN=0;dN<x.length;dN++)cN(dN);return mN.abrupt("return",_e);case 24:case"end":return mN.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var o=J(w.mark(function h(p){var g,C;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(uf({attributes:p,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){A.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){A.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return g=this.session.requestSetLocalUserAttributes(p).toPromise(),C={attribute:p,promise:g},this.attributeDrafts.add(C),A.prev=8,A.next=11,g;case 11:this.attributes=p,A.next=19;break;case 14:if(A.prev=14,A.t0=A.catch(8),!sa(A.t0)){A.next=18;break}throw A.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return A.prev=19,this.attributeDrafts.delete(C),A.finish(19);case 22:case"end":return A.stop()}},h,this,[[8,14,19,22]])}));return function(h){return o.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN=arguments;return w.wrap(function(fN){for(;;)switch(fN.prev=fN.next){case 0:if(C=2<dN.length&&dN[2]!==void 0?dN[2]:{},A=C.enableNotificationToChannelMembers,x=A!==void 0&&A,uf({attributes:g,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){fN.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){fN.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _e=this.session.requestSetChannelAttributes(p,g,x).toPromise(),fN.prev=7,fN.next=10,_e;case 10:cN=uc(g,function(mN){return new Blob([mN]).size}),this.channelAttributesCacheLru.set(p,cN),fN.next=19;break;case 14:if(fN.prev=14,fN.t0=fN.catch(7),!sa(fN.t0)){fN.next=18;break}throw fN.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return fN.stop()}},h,this,[[7,14]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var o=J(w.mark(function h(p){var g,C,A;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(g=ua(ua({},this.attributes),p),uf({attributes:p,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:g,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){x.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){x.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return C=this.session.requestAddOrUpdateLocalUserAttributes(p).toPromise(),A={attribute:g,promise:C},this.attributeDrafts.add(A),x.prev=10,x.next=13,C;case 13:this.attributes=g,x.next=21;break;case 16:if(x.prev=16,x.t0=x.catch(10),!sa(x.t0)){x.next=20;break}throw x.t0;case 20:throw new I("arguments is not valid",er);case 21:return x.prev=21,this.attributeDrafts.delete(A),x.finish(21);case 24:case"end":return x.stop()}},h,this,[[10,16,21,24]])}));return function(h){return o.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN,mN=arguments;return w.wrap(function(EN){for(;;)switch(EN.prev=EN.next){case 0:if(C=2<mN.length&&mN[2]!==void 0?mN[2]:{},A=C.enableNotificationToChannelMembers,x=A!==void 0&&A,_e=this.channelAttributesCacheLru.get(p,{}),cN=uc(g,function(RN){return new Blob([RN]).size}),dN=ua(ua({},_e),cN),uf({attributes:g,attrSizeMap:dN,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){EN.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){EN.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return fN=this.session.requestAddOrUpdateChannelAttributes(p,g,x).toPromise(),EN.prev=10,EN.next=13,fN;case 13:this.channelAttributesCacheLru.set(p,dN),EN.next=21;break;case 16:if(EN.prev=16,EN.t0=EN.catch(10),!sa(EN.t0)){EN.next=20;break}throw EN.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return EN.stop()}},h,this,[[10,16]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var o=J(w.mark(function h(p){var g,C,A,x;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(Array.isArray(p)&&p.length!==0&&!p.some(function(cN){return cN.length===0})){_e.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){_e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return g=this.session.requestDeleteLocalUserAttributesByKeys(p).toPromise(),C={attribute:Gk(this.attributes,p),promise:g},this.attributeDrafts.add(C),_e.prev=9,_e.next=12,g;case 12:for(A=0;A<p.length;A++)x=p[A],delete this.attributes[x];_e.next=20;break;case 15:if(_e.prev=15,_e.t0=_e.catch(9),!sa(_e.t0)){_e.next=19;break}throw _e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return _e.prev=20,this.attributeDrafts.delete(C),_e.finish(20);case 23:case"end":return _e.stop()}},h,this,[[9,15,20,23]])}));return function(h){return o.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN,mN=arguments;return w.wrap(function(EN){for(;;)switch(EN.prev=EN.next){case 0:if(C=2<mN.length&&mN[2]!==void 0?mN[2]:{},A=C.enableNotificationToChannelMembers,x=A!==void 0&&A,Array.isArray(g)&&g.length!==0&&za(p)&&!g.some(function(RN){return RN.length===0||512<RN.length})){EN.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){EN.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){EN.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _e=this.session.requestDeleteChannelAttributesByKeys(p,g,x).toPromise(),EN.prev=8,EN.next=11,_e;case 11:if(cN=this.channelAttributesCacheLru.get(p))for(dN=0;dN<g.length;dN++)fN=g[dN],delete cN[fN];EN.next=20;break;case 15:if(EN.prev=15,EN.t0=EN.catch(8),!sa(EN.t0)){EN.next=19;break}throw EN.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return EN.stop()}},h,this,[[8,15]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var o=J(w.mark(function h(){var p,g;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.connectionState===T.CONNECTED){C.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){C.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return p=this.session.requestClearLocalUserAttributes().toPromise(),g={attribute:{},promise:p},this.attributeDrafts.add(g),C.prev=7,C.next=10,p;case 10:this.attributes={},C.next=18;break;case 13:if(C.prev=13,C.t0=C.catch(7),!sa(C.t0)){C.next=17;break}throw C.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return C.prev=18,this.attributeDrafts.delete(g),C.finish(18);case 21:case"end":return C.stop()}},h,this,[[7,13,18,21]])}));return function(){return o.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e=arguments;return w.wrap(function(cN){for(;;)switch(cN.prev=cN.next){case 0:if(g=1<_e.length&&_e[1]!==void 0?_e[1]:{},C=g.enableNotificationToChannelMembers,A=C!==void 0&&C,this.connectionState===T.CONNECTED){cN.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){cN.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return x=this.session.requestClearChannelAttributes(p,A).toPromise(),cN.prev=6,cN.next=9,x;case 9:this.channelAttributesCacheLru.delete(p),cN.next=17;break;case 12:if(cN.prev=12,cN.t0=cN.catch(6),!sa(cN.t0)){cN.next=16;break}throw cN.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return cN.stop()}},h,this,[[6,12]])}));return function(h){return o.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var o=J(w.mark(function h(p){var g,C,A;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(za(p)){x.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){x.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){x.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return x.prev=6,x.next=9,this.session.requestGetUserAttributeKeys(p).toPromise();case 9:return g=x.sent,C=g.keys,x.next=13,this.session.requestGetUserAttributesByKeys(p,C.slice(0,512)).toPromise();case 13:A=x.sent,x.next=21;break;case 16:if(x.prev=16,x.t0=x.catch(6),!sa(x.t0)){x.next=20;break}throw x.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return x.abrupt("return",Yp(A.attributeInfos.map(function(_e){return[_e.key,_e.value]})));case 22:case"end":return x.stop()}},h,this,[[6,16]])}));return function(h){return o.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN,dN,fN,mN,EN,RN;return w.wrap(function(IN){for(;;)switch(IN.prev=IN.next){case 0:if(za(p)){IN.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){IN.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){IN.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return IN.prev=6,IN.next=9,this.session.requestGetChannelAttributesKeys(p).toPromise();case 9:return g=IN.sent,C=g.keys,IN.next=13,this.session.requestGetChannelAttributesByKeys(p,C).toPromise();case 13:A=IN.sent,x=A.attributeMaps,IN.next=22;break;case 17:if(IN.prev=17,IN.t0=IN.catch(6),!sa(IN.t0)){IN.next=21;break}throw IN.t0;case 21:throw new I("arguments is not valid",Ja);case 22:_e={},cN=0;case 24:if(!(cN<x.length)){IN.next=32;break}if(dN=x[cN],fN=dN.key,mN=dN.ms,EN=dN.value,RN=dN.origin,typeof fN=="string"&&U.isLong(mN)&&typeof EN=="string"&&za(RN)){IN.next=28;break}return IN.abrupt("break",32);case 28:_e[fN]={value:EN,lastUpdateUserId:RN,lastUpdateTs:mN.toNumber()};case 29:cN++,IN.next=24;break;case 32:return this.channelAttributesCacheLru.set(p,uc(_e,function(t0){return new Blob([t0.value]).size})),IN.abrupt("return",_e);case 34:case"end":return IN.stop()}},h,this,[[6,17]])}));return function(h){return o.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN,mN,EN,RN;return w.wrap(function(IN){for(;;)switch(IN.prev=IN.next){case 0:if(this.connectionState===T.CONNECTED){IN.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){IN.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(p,g),IN.prev=5,IN.next=8,this.session.requestGetChannelAttributesByKeys(p,g).toPromise();case 8:C=IN.sent,A=C.attributeMaps,IN.next=17;break;case 12:if(IN.prev=12,IN.t0=IN.catch(5),!sa(IN.t0)){IN.next=16;break}throw IN.t0;case 16:throw new I("arguments is not valid",Ja);case 17:x={},_e=this.channelAttributesCacheLru.get(p,{}),cN=0;case 20:if(!(cN<A.length)){IN.next=29;break}if(dN=A[cN],fN=dN.key,mN=dN.ms,EN=dN.value,RN=dN.origin,typeof fN=="string"&&U.isLong(mN)&&typeof EN=="string"&&za(RN)){IN.next=24;break}return IN.abrupt("break",29);case 24:_e[fN]=new Blob([EN]).size,x[fN]={value:EN,lastUpdateUserId:RN,lastUpdateTs:mN.toNumber()};case 26:cN++,IN.next=20;break;case 29:return this.channelAttributesCacheLru.set(p,_e),IN.abrupt("return",x);case 31:case"end":return IN.stop()}},h,this,[[5,12]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var o=J(w.mark(function h(p,g){var C;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.connectionState===T.CONNECTED){A.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){A.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(p,g),A.prev=5,A.next=8,this.session.requestGetUserAttributesByKeys(p,g).toPromise();case 8:C=A.sent,A.next=16;break;case 11:if(A.prev=11,A.t0=A.catch(5),!sa(A.t0)){A.next=15;break}throw A.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return A.abrupt("return",Yp(C.attributeInfos.map(function(x){return[x.key,x.value]})));case 17:case"end":return A.stop()}},h,this,[[5,11]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"login",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e=this;return w.wrap(function(cN){for(;;)switch(cN.prev=cN.next){case 0:if(Uk=!0,g=Bg(),C=p.token,p.token===this.context.appId&&(C=void 0),setTimeout(function(){var dN;eb("Session",{appId:_e.context.appId,did:navigator.userAgent,elapse:fb(_e.session&&_e.session.startTime),index:{index1:p.uid,index2:_e.context.appId,index3:"enableLogUpload=".concat(_e.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(g),token:C||"",userId:p.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(dN=_e.context.config.enableCloudProxy)!==null&&dN!==void 0&&dN)},1e4),yd(p)&&za(p.uid)){cN.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof C!="string"||!C){cN.next=11;break}this.context.token=C,cN.next=13;break;case 11:if(typeof C=="string"||C==null){cN.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return A=Date.now(),this.context.sid=Xa(g),this.loginPromise=this.loginImpl({uid:p.uid,instanceId:g}),this.info("RTM Client logging in as ".concat(oa(p.uid))),cN.prev=17,cN.next=20,this.loginPromise;case 20:cN.next=27;break;case 22:throw cN.prev=22,cN.t0=cN.catch(17),sa(cN.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:cN.t0.code||1,sc:cN.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-A,sid:Xa(g),userId:p.uid},(x=this.context.config.enableCloudProxy)!==null&&x!==void 0&&x),this.context.token=void 0,cN.t0;case 27:return cN.prev=27,this.loginPromise=void 0,cN.finish(27);case 30:Uk=!1;case 31:case"end":return cN.stop()}},h,this,[[17,22,27,30]])}));return function(h){return o.apply(this,arguments)}}()},{key:"logout",value:function(){var o=J(w.mark(function h(){var p;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!this.loginPromise){g.next=3;break}return g.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){g.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){g.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),g.abrupt("return");case 10:if(this.session!==void 0){g.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),g.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(p=this.context.config.enableCloudProxy)!==null&&p!==void 0&&p),g.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return g.stop()}},h,this)}));return function(){return o.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var o,h=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(o=this.context.config.enableCloudProxy)!==null&&o!==void 0&&o),this.session.logoutHandler().then(function(){h.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var o=J(w.mark(function h(p,g){var C,A,x,_e,cN,dN,fN=this,mN=arguments;return w.wrap(function(EN){for(;;)switch(EN.prev=EN.next){case 0:if(C=2<mN.length&&mN[2]!==void 0?mN[2]:{},A=C.enableOfflineMessaging,x=A!==void 0&&A,_e=C.enableHistoricalMessaging,cN=_e!==void 0&&_e,Tm(p,ve),this.connectionState!==T.RECONNECTING){EN.next=5;break}return dN=Date.now(),EN.abrupt("return",new Promise(function(RN,IN){var t0=function(){var pH=J(w.mark(function SH(){var vH;return w.wrap(function(AH){for(;;)switch(AH.prev=AH.next){case 0:if(fN.session!==void 0){AH.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return vH=Date.now()-dN,AH.prev=3,AH.t0=RN,AH.next=7,Gg({message:p,peerId:g,toPeer:!0,session:fN.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:vH,logger:fN.logger,options:{enableHistoricalMessaging:cN,enableOfflineMessaging:x}});case 7:AH.t1=AH.sent,(0,AH.t0)(AH.t1),AH.next=16;break;case 11:AH.prev=11,AH.t2=AH.catch(3),Sa(AH.t2)&&IN(new db(Yd(fN.name,"sendMessageToPeer",1e4),Zk)),sa(AH.t2)&&IN(AH.t2),IN(new da("Peer-to-peer message send failure",{code:cr,originalError:AH.t2}));case 16:return AH.prev=16,clearTimeout(aH),AH.finish(16);case 19:case"end":return AH.stop()}},SH,null,[[3,11,16,19]])}));return function(){return pH.apply(this,arguments)}}();fN.internalEmitter.once("RECONNECTED",t0);var aH=setTimeout(function(){fN.internalEmitter.off("RECONNECTED",t0),IN(new db(Yd(fN.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){EN.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){EN.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return EN.prev=9,EN.next=12,Gg({message:p,peerId:g,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:cN,enableOfflineMessaging:x}});case 12:return EN.abrupt("return",EN.sent);case 15:if(EN.prev=15,EN.t0=EN.catch(9),!Sa(EN.t0)){EN.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(EN.t0)){EN.next=21;break}throw EN.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:EN.t0});case 22:case"end":return EN.stop()}},h,this,[[9,15]])}));return function(h,p){return o.apply(this,arguments)}}()},{key:"createChannel",value:function(o){var h=this;if(!za(o))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:o})[0]],Zz);return new pD(o,function(){return h.session},this,this.logger)}},{key:"createLocalInvitation",value:function(o){if(!za(o))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:o})[0]],xc);return this.invitationManager.genLocalInvitation(o)}},{key:"subscribePeersOnlineStatus",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH=this;return w.wrap(function(pH){for(;;)switch(pH.prev=pH.next){case 0:if(this.connectionState===T.CONNECTED){pH.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){pH.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(p)&&p.length!==0){pH.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:g=0;case 7:if(!(g<p.length)){pH.next=14;break}if(za(C=p[g])){pH.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",C],kg);case 11:g++,pH.next=7;break;case 14:if(!(512<(A=p&&p.length?vk(p):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){pH.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return pH.next=19,this.session.requestSubscribePeersOnlineStatus(A).toPromise();case 19:x=pH.sent,_e=x.errors,cN=[],dN=[],fN=0;case 24:if(!(fN<_e.length)){pH.next=32;break}if(mN=_e[fN],EN=mN.code,typeof(RN=mN.account)=="string"){pH.next=28;break}throw new da("Returned account is invalid",fr);case 28:EN!==0&&cN.push(RN);case 29:fN++,pH.next=24;break;case 32:for(IN=0;IN<A.length;IN++)t0=A[IN],cN.includes(t0)||(dN.push(t0),this.subscribedPeerStatusCache[t0]=void 0);if(this.session.requestPeersOnlineStatus(dN).pipe(ba(function(SH){return uc(Jk(SH.userInfos,"account"),function(vH){return!!vH.ts})})).subscribe(function(SH){SH=uc(SH,function(vH,AH){return vH=vH?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,aH.subscribedPeerStatusCache[AH]=vH}),aH.emit("PeersOnlineStatusChanged",SH)}),cN.length===0){pH.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return pH.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e;return w.wrap(function(cN){for(;;)switch(cN.prev=cN.next){case 0:if(this.connectionState===T.CONNECTED){cN.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){cN.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(p)&&p.length!==0){cN.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:g=0;case 7:if(!(g<p.length)){cN.next=14;break}if(za(C=p[g])){cN.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",C],kg);case 11:g++,cN.next=7;break;case 14:if(!(512<p.length)){cN.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(A=p&&p.length?vk(p):[],this.session.requestUnsubscribePeersOnlineStatus(A),x=0;x<A.length;x++)_e=A[x],delete this.subscribedPeerStatusCache[_e];case 19:case"end":return cN.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var o=J(w.mark(function h(p){return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.connectionState===T.CONNECTED){g.next=2;break}throw new K("The client is not logged in",bl);case 2:if(p!==S.PeerSubscriptionOption.ONLINE_STATUS){g.next=4;break}return g.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return g.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"createMessage",value:function(o){return o.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},o):o.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},o):o}},{key:"downloadMedia",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH=this,SH=arguments;return w.wrap(function(vH){for(;;)switch(vH.prev=vH.next){case 0:if(g=1<SH.length&&SH[1]!==void 0?SH[1]:{},typeof p=="string"){vH.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(vH.prev=3,C=p.split("z"),A=ra(C,3),x=A[0],_e=A[1],cN=A[2],dN=x.slice(1,65),fN=bD(dN),mN=parseInt(x.slice(65),10),EN=parseInt(_e,10),RN=parseInt(cN,10),!(Number.isNaN(mN)||Number.isNaN(EN)||Number.isNaN(RN))){vH.next=12;break}throw new I("Invalid mediaId content",cl);case 12:vH.next=19;break;case 14:if(vH.prev=14,vH.t0=vH.catch(3),!sa(vH.t0)){vH.next=18;break}throw vH.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:vH.t0});case 19:if(this.connectionState===T.CONNECTED){vH.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){vH.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return IN=this.mediaTaskManager.addDownloadTask({unit:EN,zone:mN,hashHexStr:dN,size:RN},function(){if(pH.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return pH.session.requestFileDownloadIndexGet({hash:fN,zone:mN,unit:EN,size:RN}).toPromise()},g),vH.next=26,this.mediaTaskManager.waitMediaTask(IN);case 26:return t0=vH.sent,aH=t0.payload,vH.abrupt("return",aH);case 29:case"end":return vH.stop()}},h,this,[[3,14]])}));return function(h){return o.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e,cN,dN,fN,mN,EN,RN,IN,t0,aH,pH,SH,vH,AH,UH,zH,CH,HH,VH,KH,IH=this,MH=arguments;return w.wrap(function(GH){for(;;)switch(GH.prev=GH.next){case 0:if(g=1<MH.length&&MH[1]!==void 0?MH[1]:{},C=2<MH.length&&MH[2]!==void 0?MH[2]:{},yd(g)){GH.next=4;break}throw new I("Invalid params",wf);case 4:if(A="thumbnailWidth"in g||"thumbnailHeight"in g||"width"in g||"height"in g,x=g.messageType,_e=x===void 0?A?"IMAGE":"FILE":x,cN=g.description,dN=cN===void 0?"":cN,fN=g.fileName,mN=fN===void 0?"":fN,EN=g.thumbnail,typeof g.messageType=="string"&&typeof dN=="string"&&typeof mN=="string"&&(Pm(EN)||EN===void 0)&&Pm(p)){GH.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!A||_e!=="FILE"){GH.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(RN=p.size))){GH.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return GH.next=15,Ji(p);case 15:return IN=GH.sent,GH.next=18,aD(IN);case 18:if(t0=GH.sent,this.connectionState===T.CONNECTED){GH.next=21;break}throw new K("The client is not logged in",yA);case 21:if(_e!=="IMAGE"){GH.next=29;break}return GH.next=24,Xt(g,IN);case 24:aH=GH.sent,pH=aH.height,SH=aH.width,vH=aH.thumbnailWidth,AH=aH.thumbnailHeight;case 29:return UH=this.mediaTaskManager.addUploadTask({file:new Uint8Array(IN),hash:t0},function(){if(IH.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return IH.session.fetchFileUploadIndexGet({hash:t0,size:RN})},function(yH,TH){if(IH.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return IH.session.requestFileUploadIndexSet({hash:t0,unit:yH,servers:TH}).toPromise()},C),GH.next=32,this.mediaTaskManager.waitMediaTask(UH);case 32:if(zH=GH.sent,CH=zH.zone,HH=zH.retUnit,_e!=="IMAGE"){GH.next=38;break}return VH={height:pH,width:SH,fileName:mN,size:RN,description:dN,thumbnail:EN,messageType:_e,thumbnailWidth:vH,thumbnailHeight:AH,mediaId:"0".concat($r(t0)).concat(CH,"z").concat(HH,"z").concat(RN,"z").concat(pH,"z").concat(SH)},GH.abrupt("return",VH);case 38:return KH={fileName:mN,size:RN,description:dN,mediaId:"0".concat($r(t0)).concat(CH,"z").concat(HH,"z").concat(RN),thumbnail:EN,messageType:_e},GH.abrupt("return",KH);case 40:case"end":return GH.stop()}},h,this)}));return function(h){return o.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var o=J(w.mark(function h(p){var g,C,A,x,_e=this;return w.wrap(function(cN){for(;;)switch(cN.prev=cN.next){case 0:if(g=p.uid,C=p.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){cN.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){cN.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:cN.prev=6,this.context.uid=g,cN.next=13;break;case 10:throw cN.prev=10,cN.t0=cN.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:g})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=A=new ls(this.context,new Yr(this.context,this.logger,!1),C,this.logger),x=function(){_e.connectionState===T.CONNECTED&&(_e.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),_e.session)&&_e.session.once("userJoined",function(){_e.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},A.on("connectionLost",x),A.on("tokenExpired",function(){_e.emit("TokenExpired")}),A.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(dN){_e.emit("MessageFromPeer",{text:dN.text,messageType:S.MessageType.TEXT},dN.peerId,dN.properties)}),this.session.on("peerMediaMessage",function(dN){var fN=dN.peerId,mN=dN.properties,EN=dN.messageType;dN=dN.details,EN==="FILE"?_e.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(dN.media_size),10),description:pa(dN.media_description),fileName:pa(dN.media_filename),mediaId:pa(dN.media_id),thumbnail:new Blob([dN.media_thumbnail])},fN,mN):EN==="IMAGE"&&_e.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(dN.media_size),10),description:pa(dN.media_description),fileName:pa(dN.media_filename),mediaId:pa(dN.media_id),thumbnail:new Blob([dN.media_thumbnail]),height:parseInt(pa(dN.media_height),10),width:parseInt(pa(dN.media_width),10),thumbnailHeight:parseInt(pa(dN.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(dN.media_thumbnailwidth),10)},fN,mN)}),this.session.on("peerRawMessage",function(dN){_e.emit("MessageFromPeer",{rawMessage:dN.raw,description:dN.desc,messageType:S.MessageType.RAW},dN.peerId,dN.properties)}),A.on("instanceChanged",function(dN){return C=dN}),A.on("peerOnlineStatusChanged",function(dN){var fN=dN.instance.toString()+dN.state,mN=_e.peerStatusSeqLru.get(fN);!mN||dN.seq.greaterThan(mN)?(_e.peerStatusSeqLru.set(fN,dN.seq),dN.state!==_e.subscribedPeerStatusCache[dN.peerId]&&_e.emit("PeersOnlineStatusChanged",m({},dN.peerId,dN.state)),_e.subscribedPeerStatusCache[dN.peerId]=dN.state,clearTimeout(_e.peerUnreachableTimers[fN]),dN.state===S.PeerOnlineState.UNREACHABLE&&(_e.peerUnreachableTimers[fN]=setTimeout(function(){_e.subscribedPeerStatusCache[dN.peerId]===S.PeerOnlineState.UNREACHABLE&&(_e.subscribedPeerStatusCache[dN.peerId]=S.PeerOnlineState.ONLINE,_e.emit("PeersOnlineStatusChanged",m({},dN.peerId,S.PeerOnlineState.ONLINE)))},3e4))):_e.log("peerOnlineStatusChanged dedup for %s, %d",fN,dN.seq.toNumber())}),A.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),A.on("channelAttributesUpdated",function(dN){var fN=dN.channelId;dN=dN.attributeMaps;for(var mN={},EN=0;EN<dN.length;EN++){var RN=dN[EN],IN=RN.key,t0=RN.ms,aH=RN.value;if(RN=RN.origin,typeof IN!="string"||!U.isLong(t0)||typeof aH!="string"||!za(RN))break;mN[IN]=new Blob([aH]).size}_e.channelAttributesCacheLru.set(fN,mN)}),A.on("userJoined",function(dN){if(Object.keys(_e.attributes).length!==0){if(_e.session===void 0)return;_e.session.requestSetLocalUserAttributes(_e.attributes,dN).toPromise()}if(_e.attributeDrafts.size!==0)for(var fN=function(RN,IN){var t0=(RN=IN[RN]).attribute;RN.promise.then(function(){_e.session!==void 0&&_e.session.requestSetLocalUserAttributes(t0,dN).toPromise()})},mN=0,EN=Array.from(_e.attributeDrafts);mN<EN.length;mN++)fN(mN,EN);Object.keys(_e.subscribedPeerStatusCache).length!==0&&A.requestSubscribePeersOnlineStatus(Object.keys(_e.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),cN.prev=29,cN.next=32,A.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:A.connection.curOpenSockets.filter(function(dN){return dN!==void 0})[0].ticket,instance:A.instanceId,useNewDomain:.5<=Math.random(),loginOpt:A.userJoinOptions.toLong()}),cN.next=44;break;case 35:if(cN.prev=35,cN.t1=cN.catch(29),!Sa(cN.t1)){cN.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(cN.t1)){cN.next=43;break}throw cN.t1;case 43:throw new da("Login failure",{code:Zq,originalError:cN.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return cN.stop()}},h,this,[[6,10],[29,35]])}));return function(h){return o.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(o,h){var p,g=this;o===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[o],oldState:os[this.connectionState],reason:qD[h],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(p=this.context.config.enableCloudProxy)!==null&&p!==void 0&&p),this.connectionState===T.RECONNECTING&&o===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(C){return uc(Jk(C.userInfos,"account"),function(A){return!!A.ts})})).subscribe(function(C){C=uc(C,function(A,x){return A=A?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,g.subscribedPeerStatusCache[x]=A}),g.emit("PeersOnlineStatusChanged",C)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=o,o!==T.ABORTED&&o!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",o),this.emit("ConnectionStateChanged",o,h)}}]),r}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var o=Object.keys(r).filter(function(_e){return!(_e in qs)});if(o.length!==0)throw new I("Invalid RTM config: ".concat(o.join(", ")),Nq);var h=ua(ua({},qs),r);if(i!==void 0&&(!Array.isArray(i)||i.length===0))throw new I("Invalid area config");if(i!=null){if(!i.every(function(_e){return _e in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(i.filter(function(_e){return!(_e in S)}).join(", ")));M=xe(i.map(function(_e){return zC[_e]}))}i=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var p=DC(h);o=EC(h);var g=FC(h),C=GC(i,h),A=Tr(i,h),x=A("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=h,p("The Agora RTM Web SDK version is %s","1.4.3-203"),r.enableCloudProxy&&p("RTM cloud proxy enabled"),r.enableLogUpload&&p("Log upload enabled"),M&&x("Area is set to %s",Array.from(M.CODES).map(function(_e){return xf(F).find(function(cN){return F[cN]===_e})}).join(", ")),x("Creating an RtmClient instance"),x('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),x("The App ID is %s",Um(e,4,10,"*".repeat(6))),p("The process ID is %s",gg),x("The build is %s","v1.4.3-17-g1e27aa38"),x("NODE_ENV is %s","production"),new rD(e,{genLogger:A,genTracker:C,info:p,warn:o,logError:g,loggerId:i},h,function(_e){for(var cN=0,dN=xf(_e);cN<dN.length;cN++){var fN=dN[cN];try{var mN=_e[fN];mN!=null&&(_e.enableCloudProxy&&p("RTM cloud proxy enabled"),_e.enableLogUpload&&p("Log upload enabled"),h[fN]=mN)}catch{throw new I(["The %s in the arguments is invalid",fN],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,r){Object.keys(Nc).includes(e)&&(Nc[e]=r)},getParameter:function(e){return Nc[e]},setArea:function(e){var r=e.areaCodes;if(e=e.excludedArea,!Array.isArray(r)||r.length===0||!r.every(function(i){return i in S.AreaCode}))throw new I("Invalid area config");if(e!==void 0&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(e===void 0)M=xe(r.map(function(i){return F[i]}));else{if(r.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:r.map(function(i){return F[i]}),excludedArea:F[e]})}}});return Zd})}(agoraRtmSdk$1,agoraRtmSdk$1.exports)),agoraRtmSdk$1.exports}var agoraRtmSdkExports=requireAgoraRtmSdk();const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createLazyClient=function e(){var r;function i(o,h,p){return r||(r=AgoraRTM__default.createInstance(o,h,p)),r}return function(o,h,p){return i(o,h,p)}},createLazyChannel=function e(){var r;function i(o,h){return r||(r=o.createChannel(h)),r}return function(o,h){return i(o,h)}},AreaCode;(function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));function _extends(){return _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},_extends.apply(this,arguments)}typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function _catch(e,r){try{var i=e()}catch(o){return r(o)}return i&&i.then?i.then(void 0,r):i}var RtcContext=React.createContext({}),RtcProvider=RtcContext.Provider;RtcContext.Consumer;var remoteTrackState;(function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"})(remoteTrackState||(remoteTrackState={}));var layout;(function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"})(layout||(layout={}));var ToggleState;(function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"})(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=React.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=React.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=React.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=React.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function e(r,i){var o=initState,h=[].concat(r.max,r.min).map(function(x){return x.uid});switch(i.type){case"Screensharing":o=_extends({},r,{isScreensharing:i.value[0]}),console.log("!Screensharingstate",r,o);break;case"update-user-video":o={min:r.min.map(function(x){return x.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:x}),max:r.max.map(function(x){return x.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:x}),isScreensharing:r.isScreensharing};break;case"user-joined":if(h.indexOf(i.value[0].uid)===-1){var p=[].concat(r.min,[{uid:i.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);p.length===1&&r.max[0].uid===0?o={max:p,min:r.max,isScreensharing:r.isScreensharing}:o={min:p,max:r.max,isScreensharing:r.isScreensharing}}break;case"user-unpublished":if(r.max[0].uid===i.value[0].uid)o={max:[{uid:i.value[0].uid,hasAudio:i.value[1]==="audio"?remoteTrackState.no:r.max[0].hasAudio,hasVideo:i.value[1]==="video"?remoteTrackState.no:r.max[0].hasVideo}],min:r.min,isScreensharing:r.isScreensharing};else{var g=r.min.find(function(x){return x.uid===i.value[0].uid});if(g){var C=[].concat(r.min.filter(function(x){return x.uid!==i.value[0].uid}),[{uid:i.value[0].uid,hasAudio:i.value[1]==="audio"?remoteTrackState.no:g.hasAudio,hasVideo:i.value[1]==="video"?remoteTrackState.no:g.hasVideo}]);o={min:C,max:r.max,isScreensharing:r.isScreensharing}}}break;case"user-published":r.max[0].uid===i.value[0].uid?o={max:[{uid:i.value[0].uid,hasAudio:i.value[1]==="audio"?remoteTrackState.subbed:r.max[0].hasAudio,hasVideo:i.value[1]==="video"?remoteTrackState.subbed:r.max[0].hasVideo}],min:r.min,isScreensharing:r.isScreensharing}:o={min:r.min.map(function(x){return x.uid!==i.value[0].uid?x:{uid:x.uid,hasAudio:i.value[1]==="audio"?remoteTrackState.subbed:x.hasAudio,hasVideo:i.value[1]==="video"?remoteTrackState.subbed:x.hasVideo}}),max:r.max,isScreensharing:r.isScreensharing};break;case"user-left":if(r.max[0].uid===i.value[0].uid){var A=[].concat(r.min);o={max:[A.pop()],min:A,isScreensharing:r.isScreensharing}}else o={min:r.min.filter(function(x){return x.uid!==i.value[0].uid}),max:r.max,isScreensharing:r.isScreensharing};break;case"user-swap":r.max[0].uid===i.value[0].uid||(o={max:[i.value[0]],min:[].concat(r.min.filter(function(x){return x.uid!==i.value[0].uid}),[r.max[0]]),isScreensharing:r.isScreensharing});break;case"local-user-mute-video":o={min:r.min.map(function(x){return x.uid===0?{uid:0,hasAudio:x.hasAudio,hasVideo:i.value[0]}:x}),max:r.max.map(function(x){return x.uid===0?{uid:0,hasAudio:x.hasAudio,hasVideo:i.value[0]}:x}),isScreensharing:r.isScreensharing};break;case"local-user-mute-audio":o={min:r.min.map(function(x){return x.uid===0?{uid:0,hasAudio:i.value[0],hasVideo:x.hasVideo}:x}),max:r.max.map(function(x){return x.uid===0?{uid:0,hasAudio:i.value[0],hasVideo:x.hasVideo}:x}),isScreensharing:r.isScreensharing};break;case"remote-user-mute-video":o={min:r.min.map(function(x){return x.uid===i.value[0].uid?{uid:x.uid,hasVideo:i.value[1],hasAudio:x.hasAudio}:x}),max:r.max.map(function(x){return x.uid===i.value[0].uid?{uid:x.uid,hasVideo:i.value[1],hasAudio:x.hasAudio}:x}),isScreensharing:r.isScreensharing};break;case"remote-user-mute-audio":o={min:r.min.map(function(x){return x.uid===i.value[0].uid?{uid:x.uid,hasAudio:i.value[1],hasVideo:x.hasVideo}:x}),max:r.max.map(function(x){return x.uid===i.value[0].uid?{uid:x.uid,hasAudio:i.value[1],hasVideo:x.hasVideo}:x}),isScreensharing:r.isScreensharing};break;case"leave-channel":o=initState;break;case"ActiveSpeaker":r.max[0].uid===i.value[0]?o=_extends({},r):o={max:[r.min.find(function(x){return x.uid===i.value[0]})],min:[].concat(r.min.filter(function(x){return x.uid!==i.value[0]}),[r.max[0]]),isScreensharing:r.isScreensharing};break}return console.log("!state-update",_extends({},r,o),o),_extends({},r,o)},startScreenshare=function e(r,i,o,h,p,g,C){try{var A=function(){try{try{console.log(cN),g&&(cN.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(g+"/rtc/"+i+"/publisher/uid/"+fN+"/")).then(function(IN){return Promise.resolve(IN.json()).then(function(t0){var aH=t0.rtcToken;cN.renewToken(aH)})})}catch(IN){return Promise.reject(IN)}}),cN.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(g+"/rtc/"+i+"/publisher/uid/"+fN+"/")).then(function(IN){return Promise.resolve(IN.json()).then(function(t0){var aH=t0.rtcToken;cN.renewToken(aH)})})}catch(IN){return Promise.reject(IN)}})),o.on("track-ended",function(){cN.leave(),cN.removeAllListeners()})}catch(IN){console.log(IN)}return Promise.resolve()}catch(IN){return Promise.reject(IN)}},x=function(){try{cN.setClientRole("host");var IN=function(){if(g){var t0=_catch(function(){return Promise.resolve(fetch(g+"/rtc/"+i+"/publisher/uid/"+fN+"/")).then(function(aH){return Promise.resolve(aH.json()).then(function(pH){var SH=pH.rtcToken;return Promise.resolve(cN.join(r,i,SH,fN)).then(function(vH){dN=vH})})})},function(aH){console.log(aH)});if(t0&&t0.then)return t0.then(function(){})}else return Promise.resolve(cN.join(r,i,h||null,fN||0)).then(function(aH){dN=aH})}();return Promise.resolve(IN&&IN.then?IN.then(function(){}):void 0)}catch(t0){return Promise.reject(t0)}},_e=function(){try{var IN=function(){var pH=function(){if(o.enabled){var SH=function(){if(!mN)return Promise.resolve(cN.publish([o]).then(function(){mN=!0})).then(function(){})}();if(SH&&SH.then)return SH.then(function(){})}}();if(pH&&pH.then)return pH.then(function(){})},t0=function(){if(C)return Promise.resolve(cN.enableDualStream()).then(function(){})}();return Promise.resolve(t0&&t0.then?t0.then(IN):IN(t0))}catch(aH){return Promise.reject(aH)}},cN=AgoraRTC__default.createClient({mode:"live",role:"host",codec:"vp8"}),dN=0,fN=p||1,mN=!1,EN=function(){try{var IN=_catch(function(){return o.close(),Promise.resolve(cN.leave()).then(function(){cN.removeAllListeners()})},function(t0){console.log(t0)});return Promise.resolve(IN&&IN.then?IN.then(function(){}):void 0)}catch(t0){return Promise.reject(t0)}};return stopScreenshare=EN,Promise.resolve(A()).then(function(){return Promise.resolve(x()).then(function(){return Promise.resolve(_e()).then(function(){dN&&console.log(dN)})})})}catch(RN){return Promise.reject(RN)}},stopScreenshare=function e(){},useClient=createClient({codec:"vp8",mode:"live"}),RtcConfigure=function e(r){var i=reactExports.useRef(),o=reactExports.useRef(),h=reactExports.useRef(!1),p=reactExports.useContext(TracksContext),g=p.localVideoTrack,C=p.localAudioTrack,A=reactExports.useContext(PropsContext),x=A.callbacks,_e=A.rtcProps,cN=reactExports.useState(!1),dN=cN[0],fN=cN[1],mN=reactExports.useState(!1),EN=mN[0],RN=mN[1],IN=null,t0=reactExports.useRef(new Promise(function(VH,KH){IN=VH,console.log(KH)})),aH=useClient();_e.customRtcClient&&(aH.removeAllListeners(),aH=_e.customRtcClient);var pH=!1,SH=!1,vH=reactExports.useRef({}),AH=r.callActive;AH===void 0&&(AH=!0);var UH=reactExports.useReducer(reducer,initState),zH=UH[0],CH=UH[1];reactExports.useEffect(function(){var VH=function(){try{try{if(console.log(aH),aH.on("user-joined",function(){try{for(var TH=arguments.length,NH=new Array(TH),gH=0;gH<TH;gH++)NH[gH]=arguments[gH];var SN=NH[0];return SN.uid===r.screenshareUid&&h.current||SN.uid===1&&h.current||(vH.current[SN.uid]={}),CH({type:"user-joined",value:NH}),Promise.resolve()}catch(oH){return Promise.reject(oH)}}),aH.on("user-published",function(){for(var TH=arguments.length,NH=new Array(TH),gH=0;gH<TH;gH++)NH[gH]=arguments[gH];try{var SN=NH[0],oH=NH[1];return console.log("user-published",SN.uid),SN.uid===r.screenshareUid&&h.current||SN.uid===1&&h.current?CH({type:"user-published",value:NH}):aH.subscribe(SN,oH).then(function(fH){if(vH.current[SN.uid][oH+"Track"]=SN[oH+"Track"],oH==="audio"){var xH;(xH=SN.audioTrack)===null||xH===void 0||xH.play()}else _e.enableDualStream&&_e.dualStreamMode&&aH.setStreamFallbackOption(SN.uid,_e.dualStreamMode);CH({type:"user-published",value:NH})}).catch(function(fH){return console.log(fH)}),Promise.resolve()}catch(fH){return Promise.reject(fH)}}),aH.on("user-unpublished",function(){try{for(var TH=arguments.length,NH=new Array(TH),gH=0;gH<TH;gH++)NH[gH]=arguments[gH];var SN=NH[0],oH=NH[1];if(console.log("user-unpublished",SN.uid),oH==="audio"){var fH;(fH=SN.audioTrack)===null||fH===void 0||fH.stop()}return CH({type:"user-unpublished",value:NH}),Promise.resolve()}catch(xH){return Promise.reject(xH)}}),aH.on("connection-state-change",function(){try{for(var TH=arguments.length,NH=new Array(TH),gH=0;gH<TH;gH++)NH[gH]=arguments[gH];var SN=NH[0],oH=NH[1],fH=NH[2];if(console.log("connection",oH,SN,fH),SN==="CONNECTED")RN(!0);else if(SN==="DISCONNECTED"){try{stopScreenshare(),h.current=!1}catch(xH){console.log("stopscreenshare",xH)}CH({type:"leave-channel",value:null})}else RN(!1);return Promise.resolve()}catch(xH){return Promise.reject(xH)}}),aH.on("user-left",function(){for(var TH=arguments.length,NH=new Array(TH),gH=0;gH<TH;gH++)NH[gH]=arguments[gH];CH({type:"user-left",value:NH})}),_e.tokenUrl){var IH=_e.tokenUrl,MH=_e.channel,GH=_e.uid;aH.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(IH+"/rtc/"+MH+"/publisher/uid/"+(GH||0)+"/")).then(function(TH){return Promise.resolve(TH.json()).then(function(NH){var gH=NH.rtcToken;aH.renewToken(gH)})})}catch(TH){return Promise.reject(TH)}}),aH.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(IH+"/rtc/"+MH+"/publisher/uid/"+(GH||0)+"/")).then(function(TH){return Promise.resolve(TH.json()).then(function(NH){var gH=NH.rtcToken;aH.renewToken(gH)})})}catch(TH){return Promise.reject(TH)}})}if(x){var yH=Object.keys(x);yH.map(function(TH){try{aH.on(TH,function(){for(var NH=arguments.length,gH=new Array(NH),SN=0;SN<NH;SN++)gH[SN]=arguments[SN];x[TH].apply(null,gH)})}catch(NH){console.log(NH)}})}IN(!0),fN(!0)}catch(TH){console.log("!!!",TH)}return Promise.resolve()}catch(TH){return Promise.reject(TH)}};return IN?(VH(),function(){try{aH.removeAllListeners()}catch(KH){console.log(KH)}}):function(){}},[_e.appId]),reactExports.useEffect(function(){var VH=function(){try{return Promise.resolve(t0.current).then(function(){var MH=_e.tokenUrl,GH=_e.channel,yH=_e.uid,TH=_e.appId,NH=_e.token,gH=function(){if(aH&&!KH){_e.role==="audience"?aH.setClientRole(_e.role):aH.setClientRole("host");var SN=function(){if(MH){var oH=_catch(function(){return Promise.resolve(fetch(MH+"/rtc/"+GH+"/publisher/uid/"+(yH||0)+"/")).then(function(fH){return Promise.resolve(fH.json()).then(function(xH){var l5=xH.rtcToken;return Promise.resolve(aH.join(TH,GH,l5,yH||0)).then(function(w5){i.current=w5})})})},function(fH){console.log(fH)});if(oH&&oH.then)return oH.then(function(){})}else return Promise.resolve(aH.join(TH,GH,NH||null,yH||0)).then(function(fH){i.current=fH})}();if(SN&&SN.then)return SN.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(gH&&gH.then)return gH.then(function(){})})}catch(MH){return Promise.reject(MH)}},KH=!1;return AH?(VH(),console.log("Attempted join: ",_e.channel)):console.log("In precall - waiting to join"),function(){if(KH=!0,AH){console.log("Leaving channel");try{stopScreenshare(),h.current=!1}catch(IH){console.log(IH)}t0.current=aH.leave().catch(function(IH){return console.log(IH)})}}},[_e.channel,_e.uid,AH,_e.tokenUrl]),reactExports.useEffect(function(){var VH=function(){try{var IH=function(){function yH(){var NH=function(){if(g!=null&&g.enabled&&EN){var gH=function(){if(!pH)return Promise.resolve(aH.publish([g]).then(function(){pH=!0})).then(function(){})}();if(gH&&gH.then)return gH.then(function(){})}}();if(NH&&NH.then)return NH.then(function(){})}var TH=function(){if(C!=null&&C.enabled&&EN){var NH=function(){if(!SH)return Promise.resolve(aH.publish([C]).then(function(){SH=!0})).then(function(){})}();if(NH&&NH.then)return NH.then(function(){})}}();return TH&&TH.then?TH.then(yH):yH(TH)},MH=function(){if(_e.enableDualStream)return Promise.resolve(aH.enableDualStream()).then(function(){})}();return Promise.resolve(MH&&MH.then?MH.then(IH):IH(MH))}catch(GH){return Promise.reject(GH)}};console.log("Publish",g,C,AH),AH&&VH()},[AH,g==null?void 0:g.enabled,C==null?void 0:C.enabled,EN]),reactExports.useEffect(function(){g&&C!==null&&(vH.current[0]={audioTrack:C,videoTrack:g},CH({type:"update-user-video",value:[C,g]}))},[_e.channel,EN]),reactExports.useEffect(function(){EN&&_e.token&&aH.renewToken(_e.token).then(function(VH){return console.log("renewed token",VH)})},[_e.token,EN]),reactExports.useEffect(function(){_e.role&&aH.setClientRole(_e.role).then(function(VH){return console.log("changed role",VH)})},[_e.role,EN]),reactExports.useEffect(function(){var VH=function(){try{var IH=function(){if(_e.activeSpeaker&&_e.layout!==layout.grid)return aH.on("volume-indicator",function(MH){var GH=MH.reduce(function(NH,gH){return NH===null||gH.level>NH.level?gH:NH},null),yH=GH?GH.uid:void 0,TH=yH===i.current?0:yH;yH!==void 0&&CH({type:"ActiveSpeaker",value:[TH]})}),Promise.resolve(aH.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(IH&&IH.then?IH.then(function(){}):void 0)}catch(MH){return Promise.reject(MH)}};return AH&&VH(),function(){aH.removeAllListeners("volume-indicator")}},[_e.activeSpeaker,_e.layout]);var HH=function(){try{var KH=function(){try{return CH({type:"Screensharing",value:[!0]}),Promise.resolve(AgoraRTC__default.createScreenVideoTrack({},"disable")).then(function(GH){o.current=GH;var yH=_e.screenshareUid||1;return vH.current[yH]={videoTrack:o.current},o.current.on("track-ended",function(){h.current=!1,CH({type:"Screensharing",value:[!1]})}),h.current=!0,Promise.resolve(startScreenshare(_e.appId,_e.channel,o.current,_e.screenshareToken,_e.screenshareUid,_e.tokenUrl,_e.enableDualStream)).then(function(){})})}catch(GH){return Promise.reject(GH)}},IH=function(){stopScreenshare(),h.current=!1};return h.current?IH():KH(),Promise.resolve()}catch(MH){return Promise.reject(MH)}};return React.createElement(RtcProvider,{value:{client:aH,mediaStore:vH.current,localVideoTrack:g,localAudioTrack:C,dispatch:CH,localUid:i,channelJoined:EN,toggleScreensharing:HH,isScreensharing:h.current}},React.createElement(MaxUidProvider,{value:zH.max},React.createElement(MinUidProvider,{value:zH.min},dN?r.children:null)))},icons={videocam:React.createElement(React.Fragment,null,React.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),React.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:React.createElement(React.Fragment,null,React.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:React.createElement(React.Fragment,null,React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("polyline",{points:"9 21 3 21 3 15"}),React.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),React.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:React.createElement(React.Fragment,null,React.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),React.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:React.createElement(React.Fragment,null,React.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),React.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:React.createElement(React.Fragment,null,React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),React.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),React.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:React.createElement(React.Fragment,null,React.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),React.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),React.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:React.createElement(React.Fragment,null,React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function e(r){var i=r.onClick,o=r.name,h=r.disabled,p=r.style,g=reactExports.useContext(PropsContext),C=g.styleProps,A=C||{},x=A.theme,_e=A.BtnTemplateStyles,cN=A.iconSize,dN=A.customIcon;return React.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:h?"auto":"pointer",margin:4},_e,p),onClick:i},dN?React.createElement("img",{src:dN[o],alt:o}):React.createElement("svg",{style:{width:cN||24,height:cN||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:h?"0.5":"1",stroke:x||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[o]))};function EndCall(){var e=reactExports.useContext(PropsContext),r=e.styleProps,i=e.callbacks,o=r||{},h=o.localBtnStyles,p=h||{},g=p.endCall;return React.createElement(BtnTemplate,{style:g||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(i==null?void 0:i.EndCall)&&i.EndCall()}})}var LocalContext=reactExports.createContext({}),LocalUserContext=function e(r){var i=reactExports.useContext(MaxUidContext),o=reactExports.useContext(MinUidContext),h;return i[0].uid===0?h=i[0]:h=o.find(function(p){return p.uid===0}),React.createElement(LocalContext.Provider,{value:h},r.children)},muteAudio=function(e,r,i,o){try{var h=function(){if(e.uid===0){var p=e.hasAudio,g=function(){if(p===ToggleState.enabled||p===ToggleState.disabled){var C=p===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;r({type:"local-user-mute-audio",value:[C]}),o&&o["local-user-mute-audio"]&&o["local-user-mute-audio"](C);var A=_catch(function(){return Promise.resolve(i==null?void 0:i.setEnabled(p!==ToggleState.enabled)).then(function(){C=p===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,o&&o["local-user-mute-audio"]&&o["local-user-mute-audio"](C),r({type:"local-user-mute-audio",value:[p===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){r({type:"local-user-mute-audio",value:[p]})});if(A&&A.then)return A.then(function(){})}}();if(g&&g.then)return g.then(function(){})}}();return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(p){return Promise.reject(p)}};function LocalAudioMute(){var e=reactExports.useContext(PropsContext),r=e.styleProps,i=e.callbacks,o=r||{},h=o.localBtnStyles,p=h||{},g=p.muteLocalAudio,C=reactExports.useContext(RtcContext),A=C.dispatch,x=C.localAudioTrack,_e=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:g,name:_e.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return x&&muteAudio(_e,A,x,i)}}))}function Screenshare(){var e=reactExports.useContext(PropsContext),r=e.styleProps,i=r||{},o=i.localBtnStyles,h=o||{},p=h.screenshare,g=reactExports.useContext(RtcContext),C=g.toggleScreensharing,A=g.isScreensharing;return React.createElement("div",null,React.createElement(BtnTemplate,{style:p,name:A?"stop":"screen",onClick:function(){return C()}}))}var muteVideo=function(e,r,i,o){try{var h=function(){if(e.uid===0){var p=e.hasVideo,g=function(){if(p===ToggleState.enabled||p===ToggleState.disabled){var C=p===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;r({type:"local-user-mute-video",value:[C]}),o&&o["local-user-mute-video"]&&o["local-user-mute-video"](C);var A=_catch(function(){return Promise.resolve(i==null?void 0:i.setEnabled(p!==ToggleState.enabled)).then(function(){C=p===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,o&&o["local-user-mute-video"]&&o["local-user-mute-video"](C),r({type:"local-user-mute-video",value:[C]})})},function(){r({type:"local-user-mute-video",value:[p]})});if(A&&A.then)return A.then(function(){})}}();if(g&&g.then)return g.then(function(){})}}();return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(p){return Promise.reject(p)}};function LocalVideoMute(){var e=reactExports.useContext(PropsContext),r=e.styleProps,i=e.callbacks,o=r||{},h=o.localBtnStyles,p=h||{},g=p.muteLocalVideo,C=reactExports.useContext(RtcContext),A=C.dispatch,x=C.localVideoTrack,_e=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:g,name:_e.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return x&&muteVideo(_e,A,x,i)}}))}function LocalControls(){var e=reactExports.useContext(PropsContext),r=e.styleProps,i=e.rtcProps,o=r||{},h=o.localBtnContainer;return React.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},h)},i.role!=="audience"&&React.createElement(LocalVideoMute,null),i.role!=="audience"&&React.createElement(LocalAudioMute,null),i.role!=="audience"&&i.enableScreensharing&&React.createElement(Screenshare,null),React.createElement(EndCall,null))}var rtmStatusEnum;(function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"})(rtmStatusEnum||(rtmStatusEnum={}));var clientRoleRaw;(function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"})(clientRoleRaw||(clientRoleRaw={}));var mutingDevice;(function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"})(mutingDevice||(mutingDevice={}));var popUpStateEnum;(function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"})(popUpStateEnum||(popUpStateEnum={}));var RtmContext=reactExports.createContext(null),RtmProvider=RtmContext.Provider;RtmContext.Consumer;function RemoteVideoMute(e){var r=reactExports.useContext(PropsContext),i=r.styleProps,o=reactExports.useContext(RtmContext),h=o.sendMuteRequest,p=o.uidMap,g=i||{},C=g.remoteBtnStyles,A=C||{},x=A.muteRemoteVideo,_e=e.UIKitUser,cN=_e.hasVideo===remoteTrackState.no;return _e.uid!==0&&p[_e.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{name:_e.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:x,onClick:function(){return h(mutingDevice.camera,_e.uid,!cN)}})):null}function RemoteAudioMute(e){var r=reactExports.useContext(PropsContext),i=r.styleProps,o=i||{},h=o.remoteBtnStyles,p=reactExports.useContext(RtmContext),g=p.sendMuteRequest,C=p.uidMap,A=h||{},x=A.muteRemoteAudio,_e=e.UIKitUser,cN=_e.hasAudio===remoteTrackState.no;return _e.uid!==0&&C[_e.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{style:x,name:_e.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return g(mutingDevice.microphone,_e.uid,!cN)}})):null}function SwapUser(e){var r=reactExports.useContext(RtcContext),i=r.dispatch,o=e.UIKitUser;return React.createElement("div",null,React.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return i({type:"user-swap",value:[o]})}}))}var VideoPlaceholder=function e(r){var i=reactExports.useContext(PropsContext),o=i.styleProps,h=i.rtcProps,p=o||{},g=p.maxViewStyles,C=p.maxViewOverlayContainer,A=r.user,x=h.CustomVideoPlaceholder;return x?x&&x(_extends({},r),null):React.createElement("div",{key:A.uid,style:_extends({},style.max,g)},React.createElement("div",{style:style.imgContainer},React.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),r.isShown&&React.createElement("div",{style:_extends({},style.btnContainer,C)},r.showButtons&&React.createElement(React.Fragment,null,!h.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:A}),!h.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:A}),r.showSwap&&React.createElement(SwapUser,{UIKitUser:A}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function e(r){var i=reactExports.useContext(RtmContext),o=i.usernames,h=reactExports.useContext(PropsContext),p=h.rtmProps,g=h.styleProps,C=r.user;return p!=null&&p.displayUsername?React.createElement("p",{style:_extends({},styles.username,g==null?void 0:g.usernameText)},C.uid===1?"Screenshare":o[C.uid]):React.createElement(React.Fragment,null)},styles={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function e(r){var i=reactExports.useContext(RtcContext),o=i.mediaStore,h=reactExports.useContext(PropsContext),p=h.styleProps,g=h.rtcProps,C=p||{},A=C.maxViewStyles,x=C.videoMode,_e=C.maxViewOverlayContainer,cN=x==null?void 0:x.max,dN=reactExports.useState(!1),fN=dN[0],mN=dN[1],EN=r.user;return React.createElement("div",{style:_extends({},styles$1.container,r.style,A),onMouseEnter:function(){return mN(!0)},onMouseLeave:function(){return mN(!1)}},EN.hasVideo===1?React.createElement("div",{style:styles$1.videoContainer},!g.disableRtm&&React.createElement(Username,{user:EN}),React.createElement(AgoraVideoPlayer,{style:styles$1.videoplayer,config:{fit:cN||"cover"},videoTrack:o[EN.uid].videoTrack}),fN&&React.createElement("div",{style:_extends({},styles$1.overlay,_e)},!g.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:EN}),!g.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:EN}))):React.createElement("div",{style:styles$1.videoContainer},!g.disableRtm&&React.createElement(Username,{user:EN}),React.createElement(VideoPlaceholder,{user:EN,isShown:fN,showButtons:!0})))},styles$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MinVideoView=function e(r){var i=reactExports.useContext(RtcContext),o=i.mediaStore,h=reactExports.useContext(PropsContext),p=h.styleProps,g=h.rtcProps,C=p||{},A=C.minViewStyles,x=C.videoMode,_e=C.minViewOverlayContainer,cN=x==null?void 0:x.min,dN=reactExports.useState(!1),fN=dN[0],mN=dN[1],EN=r.user;return React.createElement("div",{style:_extends({},{display:"flex",flex:1},A),onMouseEnter:function(){return mN(!0)},onMouseLeave:function(){return mN(!1)}},EN.hasVideo===1?React.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},React.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:cN!==void 0?cN:"cover"},videoTrack:o[EN.uid].videoTrack}),fN&&React.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},_e)},!g.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:EN}),!g.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:EN}),React.createElement(SwapUser,{UIKitUser:EN}))):React.createElement(VideoPlaceholder,{user:EN,isShown:fN,showButtons:!0,showSwap:!0}))},styles$2={test:"_3ybTi",scrollbar:"_3Sxu7"},PinnedVideo=function e(){var r=reactExports.useContext(PropsContext),i=r.styleProps,o=r.rtcProps,h=i||{},p=h.minViewContainer,g=h.pinnedVideoContainer,C=h.maxViewContainer,A=h.scrollViewContainer,x=reactExports.useRef(null),_e=reactExports.useState(0),cN=_e[0],dN=_e[1],fN=reactExports.useState(0),mN=fN[0],EN=fN[1],RN=cN>mN;return reactExports.useEffect(function(){var IN=function(){x.current&&(dN(x.current.offsetWidth),EN(x.current.offsetHeight))};return window.addEventListener("resize",IN),x.current&&(dN(x.current.offsetWidth),EN(x.current.offsetHeight)),function(){window.removeEventListener("resize",IN)}},[]),React.createElement("div",{ref:x,style:_extends({},{display:"flex",flex:1,flexDirection:RN?"row":"column-reverse",overflow:"hidden"},g)},React.createElement("div",{style:_extends({},{display:"flex",flex:RN?5:4},C)},React.createElement(MaxUidConsumer,null,function(IN){return o.role==="audience"&&IN[0].uid===0?null:React.createElement(MaxVideoView,{user:IN[0]})})),React.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:RN?"scroll":"hidden",overflowX:RN?"hidden":"scroll",display:"flex",flex:1,flexDirection:RN?"column":"row"},A)},React.createElement(MinUidConsumer,null,function(IN){return IN.map(function(t0){return o.role==="audience"&&t0.uid===0?null:React.createElement("div",{style:_extends({},{minHeight:RN?"35vh":"99%",minWidth:RN?"99%":"40vw",margin:2,display:"flex"},p),key:t0.uid},React.createElement(MinVideoView,{user:t0}))})})))},GridVideo=function e(){var r=reactExports.useContext(PropsContext),i=r.styleProps,o=r.rtcProps,h=i||{},p=h.gridVideoCells,g=h.gridVideoContainer,C=reactExports.useContext(MaxUidContext),A=reactExports.useContext(MinUidContext),x=o.role==="audience"?[].concat(C,A).filter(function(aH){return aH.uid!==0}):[].concat(C,A),_e=reactExports.useRef(null),cN=reactExports.useState(window.innerWidth),dN=cN[0],fN=cN[1],mN=reactExports.useState(window.innerHeight),EN=mN[0],RN=mN[1],IN=dN>EN,t0="minmax(0, 1fr) ";return reactExports.useEffect(function(){var aH=function(){_e.current&&(fN(_e.current.offsetWidth),RN(_e.current.offsetHeight))};return window.addEventListener("resize",aH),_e.current&&(fN(_e.current.offsetWidth),RN(_e.current.offsetHeight)),function(){window.removeEventListener("resize",aH)}},[]),React.createElement("div",{ref:_e,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:IN?x.length>9?t0.repeat(4):x.length>4?t0.repeat(3):x.length>1?t0.repeat(2):t0:x.length>8?t0.repeat(3):x.length>2?t0.repeat(2):t0},g)},x.map(function(aH){return React.createElement(MaxVideoView,{user:aH,style:_extends({},{height:"100%",width:"100%"},p),key:aH.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function e(r){var i=reactExports.useState(!1),o=i[0],h=i[1],p=reactExports.useState(null),g=p[0],C=p[1],A=reactExports.useState(null),x=A[0],_e=A[1],cN=useTracks(),dN=cN.ready,fN=cN.tracks,mN=cN.error,EN=reactExports.useRef({});return reactExports.useEffect(function(){return fN!==null?(_e(fN[0]),C(fN[1]),EN.current[0]={audioTrack:fN[0],videoTrack:fN[1]},h(!0)):mN&&(console.error(mN),h(!1)),function(){if(fN){var RN,IN;(RN=fN[0])===null||RN===void 0||RN.close(),(IN=fN[1])===null||IN===void 0||IN.close()}}},[dN,mN]),React.createElement(TracksProvider,{value:{localVideoTrack:g,localAudioTrack:x}},o?r.children:null)},timeNow=function e(){return new Date().getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function e(r){var i=reactExports.useContext(PropsContext),o=i.rtcProps,h=i.rtmProps,p=reactExports.useState(!1),g=p[0],C=p[1],A=useClient$1(o.appId),x=useChannel(A,o.channel),_e=reactExports.useRef(""),cN=reactExports.useRef(5),dN=reactExports.useContext(LocalContext),fN=reactExports.useContext(PropsContext),mN=fN.rtmCallbacks,EN=reactExports.useState({}),RN=EN[0],IN=EN[1],t0=reactExports.useState({}),aH=t0[0],pH=t0[1],SH=reactExports.useState({}),vH=SH[0],AH=SH[1],UH=reactExports.useState(popUpStateEnum.closed),zH=UH[0],CH=UH[1],HH=reactExports.useState(rtmStatusEnum.offline),VH=HH[0],KH=HH[1],IH=reactExports.useContext(RtcContext),MH=IH.localUid,GH=IH.localAudioTrack,yH=IH.localVideoTrack,TH=IH.dispatch,NH=IH.channelJoined,gH=function L6(){try{var X5=o.tokenUrl,B5=function(){if(X5){var y5=_catch(function(){return Promise.resolve(fetch(X5+"/rtm/"+((h==null?void 0:h.uid)||_e.current))).then(function(Q5){return Promise.resolve(Q5.json()).then(function(M6){var g6=M6.rtmToken;return Promise.resolve(A.login({uid:(h==null?void 0:h.uid)||_e.current,token:g6})).then(function(){cN.current=5})})})},function(){setTimeout(function(){try{return cN.current=cN.current+cN.current,L6(),Promise.resolve()}catch(Q5){return Promise.reject(Q5)}},cN.current*1e3)});if(y5&&y5.then)return y5.then(function(){})}else{var k5=_catch(function(){return Promise.resolve(A.login({uid:(h==null?void 0:h.uid)||_e.current,token:(h==null?void 0:h.token)||void 0})).then(function(){cN.current=5})},function(){setTimeout(function(){try{return cN.current=cN.current+cN.current,L6(),Promise.resolve()}catch(Q5){return Promise.reject(Q5)}},cN.current*1e3)});if(k5&&k5.then)return k5.then(function(){})}}();return Promise.resolve(B5&&B5.then?B5.then(function(){}):void 0)}catch(y5){return Promise.reject(y5)}},SN=function L6(){try{var X5=_catch(function(){return Promise.resolve(x.join()).then(function(){cN.current=5})},function(){setTimeout(function(){try{return cN.current=cN.current+cN.current,L6(),Promise.resolve()}catch(B5){return Promise.reject(B5)}},cN.current*1e3)});return Promise.resolve(X5&&X5.then?X5.then(function(){}):void 0)}catch(B5){return Promise.reject(B5)}},oH=function(){try{if(KH(rtmStatusEnum.initialising),o.uid?_e.current=String(o.uid):_e.current=String(timeNow()),A.on("ConnectionStateChanged",function(y5,k5){console.log(y5,k5)}),A.on("TokenExpired",function(){try{var y5=o.tokenUrl;console.log("token expired - renewing");var k5=function(){if(y5){var Q5=_catch(function(){return Promise.resolve(fetch(y5+"/rtm/"+((h==null?void 0:h.uid)||_e.current))).then(function(M6){return Promise.resolve(M6.json()).then(function(g6){var W5=g6.rtmToken;return Promise.resolve(A.renewToken(W5)).then(function(){cN.current=5})})})},function(M6){console.error("TokenExpiredError",M6)});if(Q5&&Q5.then)return Q5.then(function(){})}}();return Promise.resolve(k5&&k5.then?k5.then(function(){}):void 0)}catch(Q5){return Promise.reject(Q5)}}),A.on("MessageFromPeer",function(y5,k5){l5(y5,k5)}),x.on("ChannelMessage",function(y5,k5){l5(y5,k5)}),x.on("MemberJoined",function(y5){try{return Promise.resolve(D4(fH(),y5)).then(function(){})}catch(k5){return Promise.reject(k5)}}),x.on("MemberCountUpdated",function(y5){try{return console.log("RTM-MemberCountUpdated: ",y5),Promise.resolve()}catch(k5){return Promise.reject(k5)}}),mN!=null&&mN.channel?Object.keys(mN.channel).map(function(y5){mN.channel&&x.on(y5,mN.channel[y5])}):mN!=null&&mN.client&&Object.keys(mN.client).map(function(y5){mN.client&&A.on(y5,mN.client[y5])}),o.tokenUrl){var X5=o.tokenUrl,B5=o.uid;A.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(X5+"/rtm/"+(B5||0)+"/")).then(function(y5){return Promise.resolve(y5.json()).then(function(k5){var Q5=k5.rtmToken;A.renewToken(Q5)})})}catch(y5){return Promise.reject(y5)}})}return KH(rtmStatusEnum.loggingIn),Promise.resolve(gH()).then(function(){return KH(rtmStatusEnum.loggedIn),Promise.resolve(SN()).then(function(){KH(rtmStatusEnum.connected),pH(function(y5){return _extends({},y5,{0:h==null?void 0:h.username})}),fK(fH())})})}catch(y5){return Promise.reject(y5)}},fH=function(){return{messageType:"UserData",rtmId:(h==null?void 0:h.uid)||_e.current,rtcId:MH.current,username:h==null?void 0:h.username,role:o.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:AgoraRTC__default.VERSION}}},xH=function(X5,B5,y5){var k5=(h==null?void 0:h.showPopUpBeforeRemoteMute)===!1,Q5={messageType:"MuteRequest",device:X5,rtcId:B5,mute:y5,isForceful:k5},M6=RN[B5];k5&&!y5?console.log("cannot send force unmute request"):M6?D4(Q5,M6):console.log("peer not found")},l5=function(X5,B5){var y5;if(X5.messageType==="RAW"?y5=parsePayload(X5.rawMessage):X5.messageType==="TEXT"&&(y5=JSON.parse(X5.text)),console.log(y5,B5),y5)switch(y5.messageType){case"UserData":w5(y5);break;case"MuteRequest":H5(y5);break;case"RtmDataRequest":switch(y5.type){case"ping":d6(B5);break;case"userData":C6(B5);break;default:console.log(B5)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},w5=function(X5){IN(function(B5){var y5;return _extends({},B5,(y5={},y5[X5.rtcId]=X5.rtmId,y5))}),pH(function(B5){var y5;return _extends({},B5,(y5={},y5[X5.rtcId]=X5.username,y5))}),AH(function(B5){var y5;return _extends({},B5,(y5={},y5[X5.rtmId]=X5,y5))})},H5=function(X5){MH.current===X5.rtcId&&(X5.isForceful?X5.mute?X5.device===mutingDevice.microphone?GH&&muteAudio(dN,TH,GH):X5.device===mutingDevice.camera&&yH&&muteVideo(dN,TH,yH):console.error("cannot force unmute"):X5.device===mutingDevice.microphone?X5.mute?CH(popUpStateEnum.muteMic):CH(popUpStateEnum.unmuteMic):X5.device===mutingDevice.camera&&(X5.mute?CH(popUpStateEnum.muteCamera):CH(popUpStateEnum.unmuteCamera)))},d6=function(X5){D4({messageType:"RtmDataRequest",type:"pong"},X5)},C6=function(X5){D4(fH(),X5)},fK=function(X5){try{var B5=A.createMessage({text:JSON.stringify(X5),messageType:AgoraRTM__default.MessageType.TEXT}),y5=_catch(function(){return Promise.resolve(x.sendMessage(B5)).then(function(){})},function(k5){console.error(k5)});return Promise.resolve(y5&&y5.then?y5.then(function(){}):void 0)}catch(k5){return Promise.reject(k5)}},D4=function(X5,B5){try{var y5=A.createMessage({text:JSON.stringify(X5),messageType:AgoraRTM__default.MessageType.TEXT}),k5=_catch(function(){return Promise.resolve(A.sendMessageToPeer(y5,String(B5))).then(function(){})},function(Q5){console.error(Q5)});return Promise.resolve(k5&&k5.then?k5.then(function(){}):void 0)}catch(Q5){return Promise.reject(Q5)}},i4=function(){try{return Promise.resolve(A.logout()).then(function(){return Promise.resolve(A.removeAllListeners()).then(function(){})})}catch(X5){return Promise.reject(X5)}};return reactExports.useEffect(function(){return NH&&(oH(),C(!0)),function(){NH&&i4()}},[o.channel,o.appId,NH]),React.createElement(RtmProvider,{value:{rtmStatus:VH,sendPeerMessage:D4,sendChannelMessage:fK,sendMuteRequest:xH,rtmClient:A,uidMap:RN,usernames:aH,userDataMap:vH,popUpState:zH,setPopUpState:CH}},g?r.children:React.createElement(React.Fragment,null))};new TextEncoder;var dec=new TextDecoder,parsePayload=function e(r){return JSON.parse(dec.decode(r))};function PopUp(){var e=reactExports.useContext(PropsContext),r=e.styleProps,i=reactExports.useContext(RtmContext),o=i.popUpState,h=i.setPopUpState,p=r||{},g=p.popUpContainer,C=reactExports.useContext(RtcContext),A=C.dispatch,x=C.localVideoTrack,_e=C.localAudioTrack,cN=reactExports.useContext(LocalContext);return o!==popUpStateEnum.closed?React.createElement("div",{style:_extends({},styles$3.container,g)},React.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},o===popUpStateEnum.muteCamera||o===popUpStateEnum.muteMic?"Mute ":"Unmute ",o===popUpStateEnum.muteCamera||o===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),React.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},React.createElement("div",{onClick:function(){switch(o){case popUpStateEnum.muteCamera:cN.hasVideo&&x&&muteVideo(cN,A,x);break;case popUpStateEnum.muteMic:cN.hasAudio&&_e&&muteAudio(cN,A,_e);break;case popUpStateEnum.unmuteCamera:!cN.hasVideo&&x&&muteVideo(cN,A,x);break;case popUpStateEnum.unmuteMic:!cN.hasAudio&&_e&&muteAudio(cN,A,_e);break}h(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),React.createElement("div",{style:styles$3.buttonClose,onClick:function(){return h(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function e(r){var i=r.styleProps,o=r.rtcProps,h=i||{},p=h.UIKitContainer;return React.createElement(PropsProvider,{value:r},React.createElement("div",{style:_extends({},style$1,p)},o.role==="audience"?React.createElement(VideocallUI,null):React.createElement(TracksConfigure,null,React.createElement(VideocallUI,null))))},VideocallUI=function e(){var r=reactExports.useContext(PropsContext),i=r.rtcProps;return React.createElement(RtcConfigure,{callActive:i.callActive},React.createElement(LocalUserContext,null,i.disableRtm?React.createElement(React.Fragment,null,(i==null?void 0:i.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null)):React.createElement(RtmConfigure,null,React.createElement(PopUp,null),(i==null?void 0:i.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const App=()=>{const[e,r]=reactExports.useState(!0),[i,o]=reactExports.useState(!1),h={appId:"6285cb5511dd4eab99af5c5a192aba62",channel:"asdsa",token:"007eJxTYPC9U2M9pXD5dp6DBoIHygSYt/8qXLF22VQ9nQNvjpSXC+1UYDAzsjBNTjI1NTRMSTFJTUyytExMM002TTS0NEpMSjQzUjbtSm8IZGTYl8/AwsgAgSA+K0NicUpxIgMDAGbOH1w="},p={EndCall:()=>r(!1)};return reactExports.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(g=>{const C=g.some(x=>x.kind==="videoinput"),A=g.some(x=>x.kind==="audioinput");o(C&&A)}).catch(g=>{console.error("Erro ao acessar dispositivos:",g),o(!1)})},[]),i?e?jsxRuntimeExports.jsx("div",{style:{display:"flex",width:"100vw",height:"100vh"},children:jsxRuntimeExports.jsx(AgoraUIKit,{rtcProps:h,callbacks:p})}):jsxRuntimeExports.jsx("h3",{onClick:()=>r(!0),children:"Iniciar Chamada"}):jsxRuntimeExports.jsx("h3",{children:"Dispositivos de entrada (câmera e microfone) não encontrados."})},client=U6.createClient({mode:"rtc",codec:"vp8"});clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(K5,{client,children:jsxRuntimeExports.jsx(App,{})})}));
